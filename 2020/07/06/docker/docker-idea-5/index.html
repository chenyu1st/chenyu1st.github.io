<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>深入浅出Docker原理及实战(五)——Docker网络介绍 | 宇神之息</title><meta name="description" content="深入浅出Docker原理及实战"><meta name="keywords" content="Docker,Linux,容器,网络"><meta name="author" content="Rugod"><meta name="copyright" content="Rugod"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="crossorigin"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="深入浅出Docker原理及实战(五)——Docker网络介绍"><meta name="twitter:description" content="深入浅出Docker原理及实战"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Blog/docker.jpg"><meta property="og:type" content="article"><meta property="og:title" content="深入浅出Docker原理及实战(五)——Docker网络介绍"><meta property="og:url" content="https://rugod.com/2020/07/06/docker/docker-idea-5/"><meta property="og:site_name" content="宇神之息"><meta property="og:description" content="深入浅出Docker原理及实战"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Blog/docker.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://rugod.com/2020/07/06/docker/docker-idea-5/"><link rel="prev" title="Kubernetes入门篇(一)——Kubernetes是什么" href="https://rugod.com/2020/07/07/kubernetes/Kubernetes-introduction-1/"><link rel="next" title="个人总结(毕业一年)" href="https://rugod.com/2020/07/01/summary/summary-2019.7-2020.7/"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?a29fc1f2b32c6a60aee5dbf412c89285";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-164950732-1', 'auto');
ga('send', 'pageview');
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://www.rugod.cn/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"languages":{"author":"作者: Rugod","link":"链接: ","source":"来源: 宇神之息","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: {"text":"宇神,牛逼","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Blog/Challenger.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">80</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">83</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">22</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于本人</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker网络介绍"><span class="toc-number">1.</span> <span class="toc-text">Docker网络介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#网络模式简介"><span class="toc-number">2.</span> <span class="toc-text">网络模式简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#bridge-网桥"><span class="toc-number">2.1.</span> <span class="toc-text">bridge(网桥)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#host-主机网络"><span class="toc-number">2.2.</span> <span class="toc-text">host(主机网络)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#overlay-覆盖网络"><span class="toc-number">2.3.</span> <span class="toc-text">overlay(覆盖网络)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#macvlan-物理地址网络"><span class="toc-number">2.4.</span> <span class="toc-text">macvlan(物理地址网络)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#none-禁用网络"><span class="toc-number">2.5.</span> <span class="toc-text">none(禁用网络)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何选型网络模式"><span class="toc-number">2.6.</span> <span class="toc-text">如何选型网络模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4种网络模式"><span class="toc-number">3.</span> <span class="toc-text">4种网络模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#bridge-networks"><span class="toc-number">3.1.</span> <span class="toc-text">bridge networks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#用户定义的网桥和默认网桥之间的区别"><span class="toc-number">3.1.1.</span> <span class="toc-text">用户定义的网桥和默认网桥之间的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#用户定义的网桥可在容器之间提供自动DNS解析"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">用户定义的网桥可在容器之间提供自动DNS解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#用户定义的网桥可提供更好的隔离"><span class="toc-number">3.1.1.2.</span> <span class="toc-text">用户定义的网桥可提供更好的隔离</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#容器可以随时随地从用户定义的网络连接和分离"><span class="toc-number">3.1.1.3.</span> <span class="toc-text">容器可以随时随地从用户定义的网络连接和分离</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#每个用户定义的网络都会创建一个可配置的网桥"><span class="toc-number">3.1.1.4.</span> <span class="toc-text">每个用户定义的网络都会创建一个可配置的网桥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#默认网桥网络上的链接容器共享环境变量"><span class="toc-number">3.1.1.5.</span> <span class="toc-text">默认网桥网络上的链接容器共享环境变量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用自定义网桥"><span class="toc-number">3.1.2.</span> <span class="toc-text">使用自定义网桥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#将容器连接到用户定义的网桥"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">将容器连接到用户定义的网桥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#断开容器与用户定义的网桥的连接"><span class="toc-number">3.1.2.2.</span> <span class="toc-text">断开容器与用户定义的网桥的连接</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用默认网桥"><span class="toc-number">3.1.3.</span> <span class="toc-text">使用默认网桥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#将容器连接到默认网桥"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">将容器连接到默认网桥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置默认网桥网络"><span class="toc-number">3.1.3.2.</span> <span class="toc-text">配置默认网桥网络</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#网桥底层原理"><span class="toc-number">3.1.4.</span> <span class="toc-text">网桥底层原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#开启从Docker容器到外界的转发规则"><span class="toc-number">3.1.5.</span> <span class="toc-text">开启从Docker容器到外界的转发规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#overlay-networks"><span class="toc-number">3.2.</span> <span class="toc-text">overlay networks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建覆盖网络的先决条件"><span class="toc-number">3.2.1.</span> <span class="toc-text">创建覆盖网络的先决条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用覆盖网络"><span class="toc-number">3.2.2.</span> <span class="toc-text">使用覆盖网络</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#host-networks"><span class="toc-number">3.3.</span> <span class="toc-text">host networks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#macvlan-networks"><span class="toc-number">3.4.</span> <span class="toc-text">macvlan networks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">3.5.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-Network-CLI"><span class="toc-number">4.</span> <span class="toc-text">Docker Network CLI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-network-connect"><span class="toc-number">4.1.</span> <span class="toc-text">docker network connect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-network-create"><span class="toc-number">4.2.</span> <span class="toc-text">docker network create</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#高级选项"><span class="toc-number">4.2.1.</span> <span class="toc-text">高级选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#例子"><span class="toc-number">4.2.2.</span> <span class="toc-text">例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-network-disconnect"><span class="toc-number">4.3.</span> <span class="toc-text">docker network disconnect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-network-inspect"><span class="toc-number">4.4.</span> <span class="toc-text">docker network inspect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-network-ls"><span class="toc-number">4.5.</span> <span class="toc-text">docker network ls</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-network-rm"><span class="toc-number">4.6.</span> <span class="toc-text">docker network rm</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker和Iptables-重中之重"><span class="toc-number">5.</span> <span class="toc-text">Docker和Iptables(重中之重)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#启动Docker之前添加iptables策略"><span class="toc-number">5.1.</span> <span class="toc-text">启动Docker之前添加iptables策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#限制与Docker主机的连接"><span class="toc-number">5.2.</span> <span class="toc-text">限制与Docker主机的连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#问题回顾"><span class="toc-number">5.3.</span> <span class="toc-text">问题回顾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结-1"><span class="toc-number">5.4.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结归纳"><span class="toc-number">6.</span> <span class="toc-text">总结归纳</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#容器网络"><span class="toc-number">6.1.</span> <span class="toc-text">容器网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#发布端口"><span class="toc-number">6.2.</span> <span class="toc-text">发布端口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#容器的IP地址和主机名"><span class="toc-number">6.3.</span> <span class="toc-text">容器的IP地址和主机名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS服务"><span class="toc-number">6.4.</span> <span class="toc-text">DNS服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Iptables"><span class="toc-number">6.5.</span> <span class="toc-text">Iptables</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考资料"><span class="toc-number">7.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Blog/docker.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">宇神之息</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于本人</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">深入浅出Docker原理及实战(五)——Docker网络介绍</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-07-06 20:14:13"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-07-06</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-07-30 16:08:44"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-07-30</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Docker/">Docker</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">8.2k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 29 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2020/07/06/docker/docker-idea-5/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2020/07/06/docker/docker-idea-5/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><p>声明:这是我在大学毕业后进入第一家互联网公司学习的内容</p>
<hr>
<p>深入浅出Docker原理及实战系列第五篇，我主要分享Docker的网络概念及如何合理的使用Docker网络。</p>
<h1 id="Docker网络介绍"><a href="#Docker网络介绍" class="headerlink" title="Docker网络介绍"></a>Docker网络介绍</h1><p>Docker容器和服务如此强大的原因之一是您可以将它们连接在一起，或将它们连接到非Docker环境中。</p>
<p>Docker容器和服务甚至不需要知道它们已部署在Docker上，也不必知道它们的对等对象是否也是Docker中运行。</p>
<p>无论您的Docker主机运行Linux，Windows还是两者结合，您都可以使用Docker以与平台无关的方式管理它们。</p>
<h1 id="网络模式简介"><a href="#网络模式简介" class="headerlink" title="网络模式简介"></a>网络模式简介</h1><p>Docker的网络子系统可使用驱动程序插入。默认情况下，存在几个驱动程序，它们提供核心联网功能：</p>
<h2 id="bridge-网桥"><a href="#bridge-网桥" class="headerlink" title="bridge(网桥)"></a>bridge(网桥)</h2><p>默认的网络驱动程序。如果未指定驱动程序，则这是您正在创建的网络类型。当您的应用程序在需要通信的独立容器中运行时，通常会使用网桥网络。</p>
<h2 id="host-主机网络"><a href="#host-主机网络" class="headerlink" title="host(主机网络)"></a>host(主机网络)</h2><p>对于独立容器，请删除容器与Docker主机之间的网络隔离，然后直接使用主机的网络。</p>
<h2 id="overlay-覆盖网络"><a href="#overlay-覆盖网络" class="headerlink" title="overlay(覆盖网络)"></a>overlay(覆盖网络)</h2><p>覆盖网络将多个Docker守护程序连接在一起，并使群集服务能够相互通信。您还可以使用覆盖网络来促进群集服务和独立容器之间或不同Docker守护程序上的两个独立容器之间的通信。这种策略消除了在这些容器之间进行操作系统级路由的需要。</p>
<h2 id="macvlan-物理地址网络"><a href="#macvlan-物理地址网络" class="headerlink" title="macvlan(物理地址网络)"></a>macvlan(物理地址网络)</h2><p>Macvlan网络允许您将MAC地址分配给容器，使其在网络上显示为物理设备。Docker守护程序通过其MAC地址将流量路由到容器。macvlan 在处理希望直接连接到物理网络而不是通过Docker主机的网络堆栈进行路由的旧应用程序时，使用驱动程序有时是最佳选择。</p>
<h2 id="none-禁用网络"><a href="#none-禁用网络" class="headerlink" title="none(禁用网络)"></a>none(禁用网络)</h2><p>对于此容器，请禁用所有联网。通常与自定义网络驱动程序一起使用。none不适用于群体服务。</p>
<h2 id="如何选型网络模式"><a href="#如何选型网络模式" class="headerlink" title="如何选型网络模式"></a>如何选型网络模式</h2><ul>
<li>当您需要多个容器在同一Docker主机上进行通信时，最好使用用户定义的网桥网络。</li>
<li>当容器的应用程序不能与Docker主机隔离时，但您希望容器的其他方面隔离时，主机网络是最佳选择。</li>
<li>当您需要不同Docker主机上运行的容器进行通信时，或者当多个应用程序使用集群服务一起工作时，覆盖网络是最佳的选择。</li>
<li>从VM设置迁移或需要容器看起来像网络上的物理主机（每个都有唯一的MAC地址）时，Macvlan网络是最好的。</li>
</ul>
<h1 id="4种网络模式"><a href="#4种网络模式" class="headerlink" title="4种网络模式"></a>4种网络模式</h1><h2 id="bridge-networks"><a href="#bridge-networks" class="headerlink" title="bridge networks"></a>bridge networks</h2><p>在网络方面，网桥是在网段之间转发流量的链路层设备。桥可以是在主机内核中运行的硬件设备或软件设备。</p>
<p>就Docker而言，网桥网络使用软件网桥，该软件网桥允许连接到同一网桥网络的容器进行通信，同时与未连接到该网桥网络的容器隔离。Docker网桥驱动程序会自动在主机中安装规则，以使不同网桥网络上的容器无法直接相互通信。</p>
<p>桥接网络适用于在同一 Docker守护程序主机上运行的容器。</p>
<p>启动Docker时，会自动创建一个默认的桥接网络（也称为bridge），并且除非另有说明，否则新启动的容器将连接到它。您还可以创建用户定义的自定义网桥网络。用户定义的网桥网络优于默认bridge 网络。</p>
<p>下面是一个默认网桥的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ip add</span><br><span class="line"></span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link&#x2F;ether 02:42:ec:96:8d:3a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1&#x2F;16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:ecff:fe96:8d3a&#x2F;64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">[root@localhost ~]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">45c686d33317        bridge              bridge              local</span><br></pre></td></tr></table></figure>

<h3 id="用户定义的网桥和默认网桥之间的区别"><a href="#用户定义的网桥和默认网桥之间的区别" class="headerlink" title="用户定义的网桥和默认网桥之间的区别"></a>用户定义的网桥和默认网桥之间的区别</h3><h4 id="用户定义的网桥可在容器之间提供自动DNS解析"><a href="#用户定义的网桥可在容器之间提供自动DNS解析" class="headerlink" title="用户定义的网桥可在容器之间提供自动DNS解析"></a>用户定义的网桥可在容器之间提供自动DNS解析</h4><p>默认网桥上的容器只能通过IP地址相互访问，除非您使用–link选项。在用户定义的网桥网络上，容器可以通过名称或别名相互解析。</p>
<p>如果在默认网桥上运行相同的应用程序，则需要在容器之间手动创建链接（使用–link）。这些链接需要双向创建，因此您可以看到，要进行通信的容器超过两个，这将变得很复杂。或者，您可以修改/etc/hosts容器中的文件，但这会导致难以调试的问题。</p>
<p>想象一个具有Web前端和db后端的应用程序同时放在一个用户定义好的网桥上。如果容器web调用db，则db无论应用程序在哪个Docker主机上运行，Web容器都可以通过连接到db容器。</p>
<h4 id="用户定义的网桥可提供更好的隔离"><a href="#用户定义的网桥可提供更好的隔离" class="headerlink" title="用户定义的网桥可提供更好的隔离"></a>用户定义的网桥可提供更好的隔离</h4><p>所有没有通过–network指定的容器都将连接到默认网桥网络。这可能是一种风险，因为不相关的应用/服务/容器随后能够进行通信。</p>
<p>自定义的网桥可提供局域网，其中只有连接到该网络的容器才能通信。</p>
<h4 id="容器可以随时随地从用户定义的网络连接和分离"><a href="#容器可以随时随地从用户定义的网络连接和分离" class="headerlink" title="容器可以随时随地从用户定义的网络连接和分离"></a>容器可以随时随地从用户定义的网络连接和分离</h4><p>在容器的生命周期内，您可以即时将其与自定义的网桥连接或断开连接。要从默认网桥网络中删除容器，您需要停止容器并使用其他网络选项重新创建它。</p>
<h4 id="每个用户定义的网络都会创建一个可配置的网桥"><a href="#每个用户定义的网络都会创建一个可配置的网桥" class="headerlink" title="每个用户定义的网络都会创建一个可配置的网桥"></a>每个用户定义的网络都会创建一个可配置的网桥</h4><p>如果您的容器使用默认的网桥，则可以对其进行配置，但是所有容器都使用相同的设置，例如MTU和iptables规则。此外，配置默认桥接网络发生在Docker本身之外，并且需要重新启动Docker。</p>
<p>自定义的网桥是通过 docker network create创建和配置的。如果不同的应用程序组具有不同的网络要求，则可以在创建时分别配置每个自定义的网桥。</p>
<h4 id="默认网桥网络上的链接容器共享环境变量"><a href="#默认网桥网络上的链接容器共享环境变量" class="headerlink" title="默认网桥网络上的链接容器共享环境变量"></a>默认网桥网络上的链接容器共享环境变量</h4><p>最初，在两个容器之间共享环境变量的唯一方法是使用–link链接它们。自定义网络无法进行这种类型的变量共享。但是，存在共享环境变量的高级方法。</p>
<ul>
<li>多个容器可以使用Docker卷挂载包含共享信息的文件或目录。</li>
<li>使用可以一起启动多个容器docker-compose，并且compose文件可以定义共享变量(推荐配置)。</li>
<li>您可以使用集群服务来代替独立容器，并利用共享配置(分布式共享)。</li>
</ul>
<p>连接到同一自定义网桥的容器可以有效地将所有端口彼此公开。为了使容器或不同网络上的非Docker主机可以访问该端口，必须使用-p或–publish来发布该端口。</p>
<h3 id="使用自定义网桥"><a href="#使用自定义网桥" class="headerlink" title="使用自定义网桥"></a>使用自定义网桥</h3><p>使用docker network create命令创建自定义网桥,在不选择任何配置的情况创建的就是网桥模式，您还可以指定子网，IP地址范围，网关和其他选项。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create my-net</span><br></pre></td></tr></table></figure>

<p>使用docker network rm命令删除用户定义的网桥网络。如果容器当前已连接到网络，请先断开它们的连接。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network rm my-net</span><br></pre></td></tr></table></figure>

<h4 id="将容器连接到用户定义的网桥"><a href="#将容器连接到用户定义的网桥" class="headerlink" title="将容器连接到用户定义的网桥"></a>将容器连接到用户定义的网桥</h4><p>创建新容器时，可以指定一个或多个–network参数。此示例将Nginx容器连接到my-net网络。它还将容器中的端口80发布到Docker主机上的端口8080，</p>
<p>因此外部客户端可以访问该端口。连接到my-net网络的任何其他容器都可以访问my-nginx容器上的所有端口，反之亦然。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker create --name my-nginx \</span><br><span class="line">  --network my-net \</span><br><span class="line">  --publish 8080:80 \</span><br><span class="line">  nginx:latest</span><br></pre></td></tr></table></figure>

<p>要将运行中的容器连接到现有的用户定义的网桥，请使用docker network connect命令。以下命令将一个已经在运行的my-nginx容器连接到一个已经存在的my-net网络：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect my-net my-nginx</span><br></pre></td></tr></table></figure>


<h4 id="断开容器与用户定义的网桥的连接"><a href="#断开容器与用户定义的网桥的连接" class="headerlink" title="断开容器与用户定义的网桥的连接"></a>断开容器与用户定义的网桥的连接</h4><p>要将运行中的容器与用户定义的网桥断开连接，请使用docker network断开命令。以下命令将my-nginx容器与my-net网络断开连接。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network disconnect my-net my-nginx</span><br></pre></td></tr></table></figure>


<h3 id="使用默认网桥"><a href="#使用默认网桥" class="headerlink" title="使用默认网桥"></a>使用默认网桥</h3><p>默认网桥被认为是Docker的遗留细节，不建议用于生产环境。对其进行配置需要手动操作，存在技术缺陷。</p>
<h4 id="将容器连接到默认网桥"><a href="#将容器连接到默认网桥" class="headerlink" title="将容器连接到默认网桥"></a>将容器连接到默认网桥</h4><p>如果您未使用–network标志指定网络，而是指定了网络驱动程序，则默认情况下，您的容器将连接到默认网桥网络。除非使用旧版–link标志进行链接，否则连接到默认网桥网络的容器只能通过IP地址进行通信。</p>
<h4 id="配置默认网桥网络"><a href="#配置默认网桥网络" class="headerlink" title="配置默认网桥网络"></a>配置默认网桥网络</h4><p>要配置默认的桥接网络，请在daemon.json中指定选项。这是一个daemon.json示例，其中指定了多个选项。仅指定您需要自定义的设置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;bip&quot;: &quot;192.168.1.5&#x2F;24&quot;,</span><br><span class="line">  &quot;fixed-cidr&quot;: &quot;192.168.1.5&#x2F;25&quot;,</span><br><span class="line">  &quot;fixed-cidr-v6&quot;: &quot;2001:db8::&#x2F;64&quot;,</span><br><span class="line">  &quot;mtu&quot;: 1500,</span><br><span class="line">  &quot;default-gateway&quot;: &quot;10.20.1.1&quot;,</span><br><span class="line">  &quot;default-gateway-v6&quot;: &quot;2001:db8:abcd::89&quot;,</span><br><span class="line">  &quot;dns&quot;: [&quot;10.20.1.2&quot;,&quot;10.20.1.3&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重新启动Docker以使更改生效。</p>
<h3 id="网桥底层原理"><a href="#网桥底层原理" class="headerlink" title="网桥底层原理"></a>网桥底层原理</h3><p>创建或删除用户定义的网桥或将容器与用户定义的网桥连接或断开连接时，docker使用指定操作系统的工具来管理基础网络基础结构（例如，在Linux上添加或删除桥接设备或配置iptables规则）。这些细节应视为实施细节。让Docker为您管理用户定义的网络。</p>
<h3 id="开启从Docker容器到外界的转发规则"><a href="#开启从Docker容器到外界的转发规则" class="headerlink" title="开启从Docker容器到外界的转发规则"></a>开启从Docker容器到外界的转发规则</h3><p>默认情况下，来自连接到默认网桥网络的容器的流量不会转发到外界。要启用转发，您需要更改两个设置。这些不是Docker命令，它们会影响Docker主机的内核。</p>
<ul>
<li>配置Linux内核以允许IP转发</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl net.ipv4.conf.all.forwarding&#x3D;1</span><br></pre></td></tr></table></figure>


<ul>
<li>将iptables FORWARD策略的策略从DROP更改为ACCEPT<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -P FORWARD ACCEPT</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>这些设置不会在重新启动后持续存在，因此您可能需要将它们添加到启动脚本中。</p>
<h2 id="overlay-networks"><a href="#overlay-networks" class="headerlink" title="overlay networks"></a>overlay networks</h2><p>覆盖网络驱动程序会在多个Docker守护程序主机之间创建一个分布式网络。该网络位于特定于主机的网络之上（覆盖主机网络），启用加密后，允许与其连接的容器（包括群集服务容器）进行安全通信。</p>
<p>Docker透明地处理每个数据包与正确的Docker守护程序主机和正确的目标容器之间的路由。</p>
<p>初始化群集或将Docker主机加入现有群集时，将在该Docker主机上创建两个新网络：</p>
<ul>
<li>一个名为Ingress的覆盖网络，用于处理与集群服务相关的控制和数据流量。创建群集服务并且不将其连接到用户定义的覆盖网络时，默认情况下它将连接到Ingress。</li>
<li>一个名为docker_gwbridge的网桥网络，该网络将各个服务器Docker守护程序连接到该集群中的其他守护程序。</li>
</ul>
<h3 id="创建覆盖网络的先决条件"><a href="#创建覆盖网络的先决条件" class="headerlink" title="创建覆盖网络的先决条件"></a>创建覆盖网络的先决条件</h3><p>使用覆盖网络的Docker守护程序的防火墙规则<br>您需要打开以下端口，以往返于参与覆盖网络的每个Docker主机的流量：</p>
<ul>
<li>用于群集管理通信的TCP端口2377</li>
<li>TCP和UDP端口7946，用于节点之间的通信</li>
<li>UDP端口4789，用于覆盖网络流量</li>
</ul>
<p>在创建覆盖网络之前，您需要使用初始化Docker守护程序作为swarm管理器，docker swarm init或者使用将该Docker守护程序加入现有的swarm docker swarm join。这两个都将创建默认的ingress覆盖网络，默认情况下，群集服务会使用该 覆盖网络。即使您从未计划使用群体服务，也需要这样做。之后，您可以创建其他用户定义的覆盖网络。</p>
<h3 id="使用覆盖网络"><a href="#使用覆盖网络" class="headerlink" title="使用覆盖网络"></a>使用覆盖网络</h3><p>官方文档讲了一个通俗易懂的例子：</p>
<p>需要三台物理或虚拟Docker主机，它们可以相互通信，并且都运行Docker 17.03或更高版本的新安装。本教程假定这三台主机在同一网络上运行，并且不涉及防火墙。</p>
<p>这些主机将被称为manager，worker-1和worker-2。该 manager主机将作为既是经理和工人，这意味着它可以运行服务任务和管理群。worker-1并且worker-2将作为唯一的工人</p>
<p>然后通过一系列命令，创建集群，加入集群，创建服务，连接服务即可。</p>
<p>看到这，如果你了解过kubernetes，是不是会发现Docker的覆盖网络和Kubernetes有异曲同工之妙，(虽然我还没仔细了解kubernetes的网络，但是我已经明显感觉到kubernetes就是加强版这种覆盖网络的使用，后期继续深挖主机之间的网络通信原理)</p>
<p>具体实现可以查看<br><a href="https://docs.docker.com/network/network-tutorial-overlay/" target="_blank" rel="noopener">覆盖网络官方教程</a></p>
<h2 id="host-networks"><a href="#host-networks" class="headerlink" title="host networks"></a>host networks</h2><p>如果您对容器使用主机网络模式，则该容器的网络堆栈不会与Docker主机隔离（该容器共享主机的网络名称空间），并且该容器不会分配自己的IP地址。例如，如果您运行一个绑定到端口80 host 的容器并使用网络，则该容器的应用程序在主机IP地址上的端口80上可用。</p>
<p>注意！！！</p>
<p>由于使用时容器不拥有自己的IP地址 host模式的网络，端口映射不生效，并且-p，–publish，-P，和–publish-all选项都将被忽略，并且产生一个警告：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WARNING: Published ports are discarded when using host network mode</span><br></pre></td></tr></table></figure>

<p>主机模式网络对于优化性能以及在容器需要处理大量端口的情况下很有用，因为它不需要网络地址转换（NAT），并且不会为每个端口创建”userland-proxy”。</p>
<p>通过将–network host传递给docker service create命令，您还可以将主机网络用于群集服务。在这种情况下，控制流量（与管理群集和服务有关的流量）仍会通过覆盖网络发送，但是单个群集服务容器会使用Docker守护程序的主机网络和端口发送数据。这带来了一些额外的限制。例如，如果服务容器绑定到端口80，则在给定的群集节点上只能运行一个服务容器。</p>
<p><a href="https://docs.docker.com/network/host/" target="_blank" rel="noopener">主机网络官方教程</a></p>
<h2 id="macvlan-networks"><a href="#macvlan-networks" class="headerlink" title="macvlan networks"></a>macvlan networks</h2><p>某些应用程序，尤其是旧版应用程序或监视网络流量的应用程序，期望直接连接到物理网络。在这种情况下，可以使用macvlan网络驱动程序为每个容器的虚拟网络接口分配MAC地址，使其看起来像是直接连接到物理网络的物理网络接口。在这种情况下，您需要在Docker主机上指定用于macvlan的物理接口，以及的子网和网关。</p>
<p>您甚至可以macvlan使用不同的物理网络接口隔离网络。请记住以下几点：</p>
<ul>
<li><p>由于IP地址耗尽或“ VLAN扩散”，很容易无意间损坏您的网络，在这种情况下，您的网络中有大量不正确的唯一MAC地址。</p>
</li>
<li><p>您的网络设备需要能够处理“混杂模式”，在该模式下，可以为一个物理接口分配多个MAC地址。</p>
</li>
<li><p>如果您的应用程序可以使用网桥（在单个Docker主机上）或覆盖（跨多个Docker主机进行通信）工作，那么从长远来看，这些解决方案可能会更好。</p>
</li>
</ul>
<p>具体实现可以看<br><a href="https://docs.docker.com/network/macvlan/" target="_blank" rel="noopener">macvlan网络官方教程</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>对于Docker来说，掌握好网桥模式足够，覆盖网络会有更好的替代容器编排工具(k8s),mac网络和主机网络用的也较少。</p>
<h1 id="Docker-Network-CLI"><a href="#Docker-Network-CLI" class="headerlink" title="Docker Network CLI"></a>Docker Network CLI</h1><p>管理网络。您可以使用子命令来创建，检查，列出，删除，修剪，连接和断开网络连接。</p>
<p>用法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network COMMAND</span><br></pre></td></tr></table></figure>

<p>COMMAND子命令</p>
<table>
<thead>
<tr>
<th>COMMAND</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>docker network connect</td>
<td>将容器连接到网络</td>
</tr>
<tr>
<td>docker network create</td>
<td>建立网络</td>
</tr>
<tr>
<td>docker network disconnect</td>
<td>断开容器与网络的连接</td>
</tr>
<tr>
<td>docker network inspect</td>
<td>显示网络的详细信息</td>
</tr>
<tr>
<td>docker network ls</td>
<td>列出网络</td>
</tr>
<tr>
<td>docker network rm</td>
<td>删除网络</td>
</tr>
</tbody></table>
<h2 id="docker-network-connect"><a href="#docker-network-connect" class="headerlink" title="docker network connect"></a>docker network connect</h2><p>将容器连接到网络</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect [OPTIONS] NETWORK CONTAINER</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>OPTIONS</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>–alias</td>
<td>为容器添加网络的别名</td>
</tr>
<tr>
<td>–driver-opt</td>
<td>网络的驱动程序选项</td>
</tr>
<tr>
<td>–ip</td>
<td>指定要分配给容器接口的IP地址</td>
</tr>
<tr>
<td>–link</td>
<td>将链接添加到另一个容器</td>
</tr>
</tbody></table>
<p>例子：</p>
<ul>
<li>将正在运行的容器连接到网络</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect redis-network redis</span><br></pre></td></tr></table></figure>

<ul>
<li>启动容器时将其连接到网络</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --network&#x3D;redis-network redis</span><br></pre></td></tr></table></figure>

<ul>
<li>指定容器在给定网络上将使用的IP地址</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect --ip 172.18.1.2 redis-network redis</span><br></pre></td></tr></table></figure>

<ul>
<li>为容器创建一个网络别名</li>
</ul>
<p>–alias 选项可用于通过所连接网络中的另一个名称来解析容器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect --alias redis6379 redis-network redis</span><br></pre></td></tr></table></figure>
<p>处在redis-network这个网络中的容器可以通过redis6379去连接redis</p>
<ul>
<li>使用–link选项</li>
</ul>
<p>您可以使用–link链接另一个具有首选别名的容器<br>docker network connect –link redis:redis6379 redis-network test</p>
<h2 id="docker-network-create"><a href="#docker-network-create" class="headerlink" title="docker network create"></a>docker network create</h2><p>创建一个新的网络。在DRIVER默认的网络驱动程序是bridge或者overlay。如果您安装了第三方或自己的自定义网络驱动程序，则也可以DRIVER在此处指定。如果未指定该 –driver选项，该命令将自动为您创建一个网桥。当您安装Docker Engine时，它会自动创建一个网桥。该网络对应于Docker Engine传统上依赖的网桥。当您启动一个新容器时， docker run它会自动连接到该网桥网络。您不能删除此默认网桥，但可以使用以下network create命令创建新的网桥。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create [OPTIONS] NETWORK</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>OPTIONS</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>–aux-address</td>
<td>网络驱动程序使用的辅助IPv4或IPv6地址</td>
</tr>
<tr>
<td>–driver , -d 默认是bridge</td>
<td>网络的驱动程序选项</td>
</tr>
<tr>
<td>–gateway</td>
<td>主子网的IPv4或IPv6网关</td>
</tr>
<tr>
<td>–internal</td>
<td>限制外部访问网络</td>
</tr>
<tr>
<td>–ip-range</td>
<td>从子范围分配容器ip</td>
</tr>
<tr>
<td>–subnet</td>
<td>代表网段的CIDR格式的子网</td>
</tr>
</tbody></table>
<h3 id="高级选项"><a href="#高级选项" class="headerlink" title="高级选项"></a>高级选项</h3><p>网桥是单个引擎安装上的隔离网络。如果要创建一个跨越多个运行主机的Docker主机的overlay网络，则必须创建一个网络。与网桥不同，覆盖网络需要先存在一些先决条件才能创建一个。这些条件已经在上文讲过，不再重复，这里主要讲创建网桥的具体内容。</p>
<p>创建网络时，默认情况下，引擎会为该网络创建一个不重叠的子网。该子网不是现有网络的细分。它仅用于ip寻址目的。您可以覆盖此默认值，并使用该–subnet选项直接指定子网值。</p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><ul>
<li>在 bridge网络上，您只能创建一个子网：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create --driver&#x3D;bridge --subnet&#x3D;192.168.0.0&#x2F;16 redis-network</span><br></pre></td></tr></table></figure>

<ul>
<li>此外，还可以指定–gateway –ip-range和–aux-address 选项。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker network create \</span><br><span class="line">  --driver&#x3D;bridge \</span><br><span class="line">  --subnet&#x3D;172.28.0.0&#x2F;16 \</span><br><span class="line">  --ip-range&#x3D;172.28.5.0&#x2F;24 \</span><br><span class="line">  --gateway&#x3D;172.28.5.254 \</span><br><span class="line">  redis-network</span><br></pre></td></tr></table></figure>

<h2 id="docker-network-disconnect"><a href="#docker-network-disconnect" class="headerlink" title="docker network disconnect"></a>docker network disconnect</h2><p>断开容器与网络的连接，断开容器与网络的连接。容器必须正在运行才能将其与网络断开连接。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker network disconnect [OPTIONS] NETWORK CONTAINER</span><br><span class="line"></span><br><span class="line">--force , -f 强制容器断开网络连接</span><br><span class="line"></span><br><span class="line">eg: docker network disconnect multi-host-network container1</span><br></pre></td></tr></table></figure>


<h2 id="docker-network-inspect"><a href="#docker-network-inspect" class="headerlink" title="docker network inspect"></a>docker network inspect</h2><p>显示一个或多个网络详细信息，默认情况下，此命令将所有结果呈现在JSON对象中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect [OPTIONS] NETWORK [NETWORK...]</span><br><span class="line"></span><br><span class="line">--format , -f  使用给定的Go模板格式化输出</span><br><span class="line">--verbose , -v 	详细输出以进行诊断</span><br></pre></td></tr></table></figure>

<h2 id="docker-network-ls"><a href="#docker-network-ls" class="headerlink" title="docker network ls"></a>docker network ls</h2><p>列出daemon引擎知道的所有网络。这包括跨群集中多个主机的网络。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network ls [OPTIONS]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>OPTIONS</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>–filter , -f</td>
<td>提供过滤器值（例如“ driver = bridge”）</td>
</tr>
<tr>
<td>–format</td>
<td>使用Go模板的打印网络</td>
</tr>
<tr>
<td>–no-trunc</td>
<td>不要截断输出</td>
</tr>
<tr>
<td>–quiet , -q</td>
<td>仅显示网络ID</td>
</tr>
</tbody></table>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">列出所有网络：</span><br><span class="line"></span><br><span class="line">docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER          SCOPE</span><br><span class="line">7fca4eb8c647        bridge              bridge          local</span><br><span class="line">9f904ee27bf5        none                null            local</span><br><span class="line">cf03ee007fb4        host                host            local</span><br><span class="line">78b03ee04fc4        multi-host          overlay         swarm</span><br><span class="line"></span><br><span class="line">使用--no-trunc选项显示完整的网络ID：</span><br><span class="line"></span><br><span class="line">docker network ls --no-trunc</span><br><span class="line">NETWORK ID                                                         NAME                DRIVER           SCOPE</span><br><span class="line">18a2866682b85619a026c81b98a5e375bd33e1b0936a26cc497c283d27bae9b3   none                null             local</span><br><span class="line">c288470c46f6c8949c5f7e5099b5b7947b07eabe8d9a27d79a9cbf111adcbf47   host                host             local</span><br><span class="line">7b369448dccbf865d397c8d2be0cda7cf7edc6b0945f77d2529912ae917a0185   bridge              bridge           local</span><br><span class="line">95e74588f40db048e86320c6526440c504650a1ff3e9f7d60a497c4d2163e5bd   foo                 bridge           local</span><br><span class="line">63d1ff1f77b07ca51070a8c227e962238358bd310bde1529cf62e6c307ade161   dev                 bridge           local</span><br><span class="line"></span><br><span class="line">过滤器匹配基于其驱动程序的网络。</span><br><span class="line">docker network ls --filter driver&#x3D;bridge</span><br><span class="line">NETWORK ID          NAME                DRIVER            SCOPE</span><br><span class="line">db9db329f835        test1               bridge            local</span><br><span class="line">f6e212da9dfd        test2               bridge            local</span><br></pre></td></tr></table></figure>

<h2 id="docker-network-rm"><a href="#docker-network-rm" class="headerlink" title="docker network rm"></a>docker network rm</h2><p>按名称或标识符删除一个或多个网络。要删除网络，必须首先断开连接到它的所有容器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network rm NETWORK [NETWORK...]</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network rm my-network</span><br></pre></td></tr></table></figure>


<h1 id="Docker和Iptables-重中之重"><a href="#Docker和Iptables-重中之重" class="headerlink" title="Docker和Iptables(重中之重)"></a>Docker和Iptables(重中之重)</h1><p>在Linux上，Docker操纵iptables规则以提供网络隔离。尽管这是实现的详细信息，并且您不应修改Docker在iptables策略中插入的规则，但是如果您想要拥有自己的策略（而不是由Docker管理的策略），它确实会对您需要执行的操作产生一些影响。</p>
<p>如果您在已暴露网络的主机上运行Docker，则可能需要采用iptables策略，以防止未经授权访问您主机上运行的容器或其他服务。下面主要描述如何实现此目标以及需要注意的注意事项。</p>
<h2 id="启动Docker之前添加iptables策略"><a href="#启动Docker之前添加iptables策略" class="headerlink" title="启动Docker之前添加iptables策略"></a>启动Docker之前添加iptables策略</h2><p>Docker安装了两个iptables链，名叫DOCKER-USER 和DOCKER，它确保传入的数据包始终首先由这两个链进行检查。</p>
<p>手动或通过其他基于iptables的防火墙添加到FORWARD链中的规则在这些链之后进行评估。这意味着，如果您通过Docker公开端口，则无论防火墙配置了什么规则，该端口都会公开。如果您希望即使在通过Docker公开端口时也要应用这些规则，则必须将这些规则添加到DOCKER-USER链中。</p>
<h2 id="限制与Docker主机的连接"><a href="#限制与Docker主机的连接" class="headerlink" title="限制与Docker主机的连接"></a>限制与Docker主机的连接</h2><p>默认情况，允许所有外部IP连接到Docker主机。</p>
<p>要仅允许特定的IP或网络访问容器，请在DOCKER-USER过滤器链的顶部插入一个否定的规则。例如，下面一个规则限制了除192.168.1.1之外的所有IP地址的外部访问，也就是说只能有192.168.1.1才能访问这个容器内部</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -I DOCKER-USER -i ext_if ! -s 192.168.1.1 -j DROP</span><br></pre></td></tr></table></figure>

<p>请注意，您将需要更改ext_if以与主机的实际外部接口相对应。您可以改为允许来源子网的连接。以下规则仅允许从子网192.168.1.0/24访问容器内部：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -I DOCKER-USER -i ext_if ! -s 192.168.1.0&#x2F;24 -j DROP</span><br></pre></td></tr></table></figure>

<p>iptables是复杂的，更复杂的规则不在此主题范围内。有关它的更多信息，请参见<a href="https://www.netfilter.org/documentation/HOWTO/NAT-HOWTO.html" target="_blank" rel="noopener">Netfilter.org HOWTO</a>。</p>
<p>还有几种策略具体请看 <a href="https://docs.docker.com/network/iptables/" target="_blank" rel="noopener">Docker和iptables</a></p>
<h2 id="问题回顾"><a href="#问题回顾" class="headerlink" title="问题回顾"></a>问题回顾</h2><p>正好前几天出现了一个Docker的网络问题，无法启动容器，现在来回顾一下</p>
<p>为了证明启动Docker之前添加iptables策略这点非常重要，我做了以下实验。</p>
<ul>
<li>这台主机在启动docker之前已经关闭了防火墙，并且已运行了几个容器，执行iptables 命令查看链路信息 发现存在各个容器暴露端口的链路规则</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# iptables -L</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER-USER  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-1  all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain DOCKER (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     tcp  --  anywhere             172.17.0.2           tcp dpt:6379</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.2           tcp dpt:17010</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.2           tcp dpt:ups-onlinet</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.3           tcp dpt:17011</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.3           tcp dpt:talon-disc</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.4           tcp dpt:17012</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.4           tcp dpt:talon-engine</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.5           tcp dpt:17013</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.5           tcp dpt:microtalon-dis</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.6           tcp dpt:17014</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.6           tcp dpt:microtalon-com</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.7           tcp dpt:17015</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.7           tcp dpt:talon-webserver</span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-1 (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">RETURN     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-2 (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">RETURN     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain DOCKER-USER (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">RETURN     all  --  anywhere             anywhere</span><br></pre></td></tr></table></figure>


<ul>
<li>开启防火墙，执行iptables 命令查看链路信息 发现iptables好像恢复出厂默认了</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl start firewalld</span><br><span class="line">[root@localhost ~]# iptables -L</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">INPUT_direct  all  --  anywhere             anywhere            </span><br><span class="line">INPUT_ZONES_SOURCE  all  --  anywhere             anywhere            </span><br><span class="line">INPUT_ZONES  all  --  anywhere             anywhere            </span><br><span class="line">DROP       all  --  anywhere             anywhere             ctstate INVALID</span><br><span class="line">REJECT     all  --  anywhere             anywhere             reject-with icmp-host-prohibited</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">FORWARD_direct  all  --  anywhere             anywhere            </span><br><span class="line">FORWARD_IN_ZONES_SOURCE  all  --  anywhere             anywhere            </span><br><span class="line">FORWARD_IN_ZONES  all  --  anywhere             anywhere            </span><br><span class="line">FORWARD_OUT_ZONES_SOURCE  all  --  anywhere             anywhere            </span><br><span class="line">FORWARD_OUT_ZONES  all  --  anywhere             anywhere            </span><br><span class="line">DROP       all  --  anywhere             anywhere             ctstate INVALID</span><br><span class="line">REJECT     all  --  anywhere             anywhere             reject-with icmp-host-prohibited</span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">OUTPUT_direct  all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain FORWARD_IN_ZONES (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">FWDI_public  all  --  anywhere             anywhere            [goto] </span><br><span class="line">FWDI_public  all  --  anywhere             anywhere            [goto] </span><br><span class="line"></span><br><span class="line">Chain FORWARD_IN_ZONES_SOURCE (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FORWARD_OUT_ZONES (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">FWDO_public  all  --  anywhere             anywhere            [goto] </span><br><span class="line">FWDO_public  all  --  anywhere             anywhere            [goto] </span><br><span class="line"></span><br><span class="line">Chain FORWARD_OUT_ZONES_SOURCE (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FORWARD_direct (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FWDI_public (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">FWDI_public_log  all  --  anywhere             anywhere            </span><br><span class="line">FWDI_public_deny  all  --  anywhere             anywhere            </span><br><span class="line">FWDI_public_allow  all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     icmp --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain FWDI_public_allow (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FWDI_public_deny (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FWDI_public_log (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FWDO_public (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">FWDO_public_log  all  --  anywhere             anywhere            </span><br><span class="line">FWDO_public_deny  all  --  anywhere             anywhere            </span><br><span class="line">FWDO_public_allow  all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain FWDO_public_allow (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FWDO_public_deny (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FWDO_public_log (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain INPUT_ZONES (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">IN_public  all  --  anywhere             anywhere            [goto] </span><br><span class="line">IN_public  all  --  anywhere             anywhere            [goto] </span><br><span class="line"></span><br><span class="line">Chain INPUT_ZONES_SOURCE (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain INPUT_direct (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain IN_public (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">IN_public_log  all  --  anywhere             anywhere            </span><br><span class="line">IN_public_deny  all  --  anywhere             anywhere            </span><br><span class="line">IN_public_allow  all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     icmp --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain IN_public_allow (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ssh ctstate NEW</span><br><span class="line"></span><br><span class="line">Chain IN_public_deny (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain IN_public_log (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain OUTPUT_direct (1 references)</span><br><span class="line">target     prot opt source               destination</span><br></pre></td></tr></table></figure>


<ul>
<li>关闭防火墙，执行iptables 命令查看链路信息<br>发现iptables链路信息全部被清空</li>
<li>启动容器 暴露80端口，发现启动失败</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl stop firewalld</span><br><span class="line">[root@localhost ~]# iptables -L</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker  run  -d -p 80:80 --volumes-from pmm-data --name pmm-server --restart always  percona&#x2F;pmm-server:latest</span><br><span class="line">f86d559846840468a45ec4b69b3cd4458854b2e9392e4e47b84430e420c59f7c</span><br><span class="line">docker: Error response from daemon: driver failed programming external connectivity on endpoint pmm-server (b5e49ead04279b9c1ab16609ed3fcb78d309fb2fcab001adda57a9bd45dc23d0):  (iptables failed: iptables --wait -t nat -A DOCKER -p tcp -d 0&#x2F;0 --dport 80 -j DNAT --to-destination 172.17.0.3:80 ! -i docker0: iptables: No chain&#x2F;target&#x2F;match by that name.</span><br><span class="line"> (exit status 1)).</span><br></pre></td></tr></table></figure>

<ul>
<li>重启docker服务端，执行iptables 命令查看链路信息，发现重新录入docker策略</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl restart docker</span><br><span class="line">[root@localhost ~]# iptables -L</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER-USER  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-1  all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain DOCKER (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.2           tcp dpt:17014</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.2           tcp dpt:microtalon-com</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.3           tcp dpt:17015</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.4           tcp dpt:17010</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.5           tcp dpt:17012</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.3           tcp dpt:talon-webserver</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.4           tcp dpt:ups-onlinet</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.5           tcp dpt:talon-engine</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.6           tcp dpt:17013</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.7           tcp dpt:17011</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.6           tcp dpt:microtalon-dis</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.7           tcp dpt:talon-disc</span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-1 (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">RETURN     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-2 (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">RETURN     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain DOCKER-USER (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">RETURN     all  --  anywhere             anywhere</span><br></pre></td></tr></table></figure>

<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>你一定要在启动Docker之前关闭防火墙，否则重新启动防火墙再关闭也不会让iptables加入Docker链，唯一的解决办法就是重启Docker，这对于生产环境来说是极为危险的(你这台机器上的所有容器都得重启)</p>
<h1 id="总结归纳"><a href="#总结归纳" class="headerlink" title="总结归纳"></a>总结归纳</h1><h2 id="容器网络"><a href="#容器网络" class="headerlink" title="容器网络"></a>容器网络</h2><p>容器使用的网络类型，无论是网桥，主机网络， 覆盖网络，macvlan网络还是自定义网络插件，在容器内部都是透明的。从容器的角度来看，它具有一个带有IP地址，网关，路由表，DNS服务和其他网络详细信息的网络接口（假定容器未使用none网络驱动程序）。</p>
<h2 id="发布端口"><a href="#发布端口" class="headerlink" title="发布端口"></a>发布端口</h2><p>默认情况下，创建容器时，它不会将其任何端口发布到外界。要使端口可用于Docker外部的服务或未连接到容器网络的Docker容器，请使用 –publish或-p标志。这将创建一个防火墙规则，该规则将容器端口映射到Docker主机上的端口。这里有些例子。</p>
<table>
<thead>
<tr>
<th>标志值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-p 8080:80</td>
<td>将容器中的TCP端口80映射到Docker主机上的端口8080。</td>
</tr>
<tr>
<td>-p 192.168.1.100:8080:80</td>
<td>将容器中的TCP端口80映射到Docker主机上的端口8080，以连接到主机IP 192.168.1.100。</td>
</tr>
<tr>
<td>-p 8080:80/udp</td>
<td>将容器中的UDP端口80映射到Docker主机上的端口8080。</td>
</tr>
<tr>
<td>-p 8080:80/tcp -p 8080:80/udp</td>
<td>将容器中的TCP端口80映射到Docker主机上的TCP端口8080，并将容器中的UDP端口80映射到Docker主机上的UDP端口8080。</td>
</tr>
</tbody></table>
<h2 id="容器的IP地址和主机名"><a href="#容器的IP地址和主机名" class="headerlink" title="容器的IP地址和主机名"></a>容器的IP地址和主机名</h2><p>默认情况下，为容器连接到的每个Docker网络分配一个IP地址。IP地址是在网络池中分配的，因此Docker守护程序实际上充当了每个容器的DHCP服务器。每个网络还具有默认的子网掩码和网关。</p>
<p>容器启动时，只能使用将该容器连接到单个网络 –network。但是，您可以使用将运行中的容器连接到多个网络docker network connect。使用–network标志启动容器时 ，可以使用–ip或–ip6标志指定分配给该网络上的容器的IP地址。</p>
<p>使用将现有容器连接到其他网络时 docker network connect，可以在该命令上使用–ip或–ip6标志来指定其他网络上容器的IP地址。</p>
<p>同样，容器的主机名默认为Docker中容器的ID。您可以使用覆盖主机名–hostname。使用来连接到现有网络时docker network connect，可以使用该–alias 标志为该网络上的容器指定其他网络别名。</p>
<h2 id="DNS服务"><a href="#DNS服务" class="headerlink" title="DNS服务"></a>DNS服务</h2><p>默认情况下，容器会继承/etc/resolv.conf配置文件中定义的主机的DNS设置 。使用默认网桥的容器将获得此文件的副本，而使用自定义网桥的容器将使用 Docker的嵌入式DNS服务器，该服务器会将外部DNS查找转发到主机上配置的DNS服务器。</p>
<p>自定义主机中定义的/etc/hosts不会继承。要将其他主机传递到您的容器中，请参考<a href="https://docs.docker.com/engine/reference/commandline/run/#add-entries-to-container-hosts-file---add-host" target="_blank" rel="noopener">docker run</a> 的参数设置。</p>
<h2 id="Iptables"><a href="#Iptables" class="headerlink" title="Iptables"></a>Iptables</h2><p>重要的事情说三次，你一定要在启动Docker之前关闭防火墙，你一定要在启动Docker之前关闭防火墙，你一定要在启动Docker之前关闭防火墙。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://docs.docker.com/engine/reference/commandline/network/" target="_blank" rel="noopener">Docker Network CLI</a></p>
<p><a href="https://docs.docker.com/network/" target="_blank" rel="noopener">Docker Networking overview</a></p>
<hr>
<p>版权声明：</p>
<p>原创不易，洗文可耻。除非注明，本博文章均为原创，转载请以链接形式标明本文地址。</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Rugod</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://rugod.com/2020/07/06/docker/docker-idea-5/">https://rugod.com/2020/07/06/docker/docker-idea-5/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://rugod.com" target="_blank">宇神之息</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker</a><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/%E5%AE%B9%E5%99%A8/">容器</a><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C/">网络</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Blog/kubernetes.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Blog/wechat.JPG" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Blog/alipay.JPG" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/07/07/kubernetes/Kubernetes-introduction-1/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Blog/kubernetes.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Kubernetes入门篇(一)——Kubernetes是什么</div></div></a></div><div class="next-post pull_right"><a href="/2020/07/01/summary/summary-2019.7-2020.7/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Blog/human-jump.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">个人总结(毕业一年)</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/07/19/docker/docker-idea-6/" title="深入浅出Docker原理及实战(六)——重新认识Docker容器"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Blog/docker.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-07-30</div><div class="relatedPosts_title">深入浅出Docker原理及实战(六)——重新认识Docker容器</div></div></a></div><div class="relatedPosts_item"><a href="/2020/06/29/docker/docker-idea-4/" title="深入浅出Docker原理及实战(四)——构建镜像"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Blog/docker.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-07-30</div><div class="relatedPosts_title">深入浅出Docker原理及实战(四)——构建镜像</div></div></a></div><div class="relatedPosts_item"><a href="/2020/06/27/docker/docker-idea-3/" title="深入浅出Docker原理及实战(三)——制作Dockerfile"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Blog/docker.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-07-30</div><div class="relatedPosts_title">深入浅出Docker原理及实战(三)——制作Dockerfile</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/gh/xaoxuu/volantis/js/volantis.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify: false,
  verify: false,
  appId: 'GkD8YSRxxCgXoW6LqFO3cKhd-gzGzoHsz',
  appKey: 'DbbNrHwsCuK9Ehh2wgOw6UXL',
  placeholder: '记得留下你的昵称和邮箱...可以快速收到回复哦',
  avatar: 'monsterid',
  meta: guest_info,
  pageSize: '10',
  lang: 'zh-cn',
  recordIP: false,
  serverURLs: ''
});</script></div></article></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Blog/docker.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By Rugod</div><div class="footer_custom_text">弱小的人才习惯嘲讽和否定，而内心强大的人从不吝啬赞美和鼓励</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="canvas_nest" color="255,0,0" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/third-party/ClickShowText.js"></script><script src="/js/search/local-search.js"></script></body></html>