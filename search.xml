<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Redisè¿äº‘é—®é¢˜æ€»ç»“</title>
      <link href="/2020/09/23/bug/redis.migrate-rds/"/>
      <url>/2020/09/23/bug/redis.migrate-rds/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬äºŒå®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨è‡ªå»ºRedisè¿ç§»åˆ°ElastiCache For Redisçš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°ä¸€äº›é—®é¢˜ï¼Œæœ¬æ–‡æ€»ç»“ä¸€ä¸‹ã€‚</p><h1 id="åŠ å¯†ä¼ è¾“"><a href="#åŠ å¯†ä¼ è¾“" class="headerlink" title="åŠ å¯†ä¼ è¾“"></a>åŠ å¯†ä¼ è¾“</h1><p>åˆ›å»ºElastiCache For Rediséœ€è¦å¼€å¯å¯†ç éªŒè¯</p><p>Redisåˆšåˆšå»ºå®Œï¼Œæˆ‘ç”¨å¯è§†åŒ–å·¥å…·è¿ä¸ä¸Šã€‚</p><p>ä½†æ˜¯åæ¥å‘ç°è¿™ä¸ªå¯†ç éªŒè¯æ·»åŠ äº†ä¼ è¾“ä¸­åŠ å¯†åŠŸèƒ½</p><h2 id="AWSå®˜æ–¹è§£é‡Š"><a href="#AWSå®˜æ–¹è§£é‡Š" class="headerlink" title="AWSå®˜æ–¹è§£é‡Š"></a>AWSå®˜æ–¹è§£é‡Š</h2><p>Redis å‘½ä»¤è¡Œç•Œé¢ (redis-cli) ä¸æ”¯æŒå¯ç”¨ SSL çš„å®¢æˆ·ç«¯ã€‚</p><p>è¦ä½¿ç”¨ redis-cli è®¿é—®å¯ç”¨ä¼ è¾“ä¸­åŠ å¯†åŠŸèƒ½çš„ ElastiCache for Redis èŠ‚ç‚¹ï¼ˆå·²ç¦ç”¨é›†ç¾¤æ¨¡å¼ï¼‰ï¼Œåœ¨æ‚¨çš„åŸºäº Linux çš„å®¢æˆ·ç«¯ä¸­ä½¿ç”¨ stunnel åŒ…ã€‚stunnel å‘½ä»¤ä¼šåˆ›å»ºä¸€æ¡ SSL éš§é“ï¼ŒæŒ‡å‘åœ¨ stunnel é…ç½®ä¸­æŒ‡å®šçš„ Redis èŠ‚ç‚¹ã€‚åœ¨å»ºç«‹éš§é“ä»¥åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ redis-cli è¿æ¥å¯ç”¨ä¼ è¾“ä¸­åŠ å¯†åŠŸèƒ½çš„é›†ç¾¤èŠ‚ç‚¹ã€‚</p><h2 id="AWSå®˜æ–¹è§£å†³åŠæ³•"><a href="#AWSå®˜æ–¹è§£å†³åŠæ³•" class="headerlink" title="AWSå®˜æ–¹è§£å†³åŠæ³•"></a>AWSå®˜æ–¹è§£å†³åŠæ³•</h2><h3 id="ä½¿ç”¨-SSH-è¿æ¥åˆ°-Linux-å®¢æˆ·ç«¯å®ä¾‹å¹¶å®‰è£…-stunnel-åŒ…ï¼š"><a href="#ä½¿ç”¨-SSH-è¿æ¥åˆ°-Linux-å®¢æˆ·ç«¯å®ä¾‹å¹¶å®‰è£…-stunnel-åŒ…ï¼š" class="headerlink" title="ä½¿ç”¨ SSH è¿æ¥åˆ° Linux å®¢æˆ·ç«¯å®ä¾‹å¹¶å®‰è£… stunnel åŒ…ï¼š"></a>ä½¿ç”¨ SSH è¿æ¥åˆ° Linux å®¢æˆ·ç«¯å®ä¾‹å¹¶å®‰è£… stunnel åŒ…ï¼š</h3><ul><li>åœ¨åŸºäº CentOS çš„ç³»ç»Ÿä¸Šï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sudo yum install stunnel</span><br></pre></td></tr></table></figure><ul><li>åœ¨åŸºäº Debian çš„ç³»ç»Ÿä¸Š (Ubuntu 16)ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sudo apt-get install stunnel</span><br></pre></td></tr></table></figure><h3 id="åœ¨-redis-cli-conf-æ–‡ä»¶ä¸­ï¼Œå°†-Redis-é›†ç¾¤ç»ˆç«¯èŠ‚ç‚¹æ·»åŠ åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªè¿æ¥å‚æ•°ï¼š"><a href="#åœ¨-redis-cli-conf-æ–‡ä»¶ä¸­ï¼Œå°†-Redis-é›†ç¾¤ç»ˆç«¯èŠ‚ç‚¹æ·»åŠ åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªè¿æ¥å‚æ•°ï¼š" class="headerlink" title="åœ¨ redis-cli.conf æ–‡ä»¶ä¸­ï¼Œå°† Redis é›†ç¾¤ç»ˆç«¯èŠ‚ç‚¹æ·»åŠ åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªè¿æ¥å‚æ•°ï¼š"></a>åœ¨ redis-cli.conf æ–‡ä»¶ä¸­ï¼Œå°† Redis é›†ç¾¤ç»ˆç«¯èŠ‚ç‚¹æ·»åŠ åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªè¿æ¥å‚æ•°ï¼š</h3><p>vim  /etc/stunnel/redis-cli.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fips &#x3D; no</span><br><span class="line">setuid &#x3D; root</span><br><span class="line">setgid &#x3D; root</span><br><span class="line">pid &#x3D; &#x2F;var&#x2F;run&#x2F;stunnel.pid</span><br><span class="line">debug &#x3D; 7</span><br><span class="line">options &#x3D; NO_SSLv2</span><br><span class="line">options &#x3D; NO_SSLv3</span><br><span class="line">[redis-cli]</span><br><span class="line">  client &#x3D; yes</span><br><span class="line">  accept &#x3D; 127.0.0.1:6379</span><br><span class="line">  connect &#x3D; master.ssltest.wif0lh.use1.cache.amazonaws.com:6379</span><br><span class="line">[redis-cli-replica]</span><br><span class="line">  client &#x3D; yes</span><br><span class="line">  accept &#x3D; 127.0.0.1:6380</span><br><span class="line">  connect &#x3D; ssltest-002.ssltest.wif0lh.use1.cache.amazonaws.com:6379</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œé…ç½®æ–‡ä»¶æœ‰ä¸¤ä¸ªè¿æ¥ï¼Œredis-cli å’Œ redis-cli-replicaã€‚å‚æ•°è®¾ç½®å¦‚ä¸‹ï¼š</p><p>client è®¾ç½®ä¸º yesï¼Œä»¥æŒ‡å®šæ­¤ stunnel å®ä¾‹æ˜¯å®¢æˆ·ç«¯ã€‚</p><p>accept è®¾ç½®ä¸ºå®¢æˆ·ç«¯ IPã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä¸»è¿æ¥è®¾ç½®ä¸ºé»˜è®¤åœ°å€ä¸º 127.0.0.1ï¼Œç«¯å£ä¸º 6379 çš„ Redisã€‚å‰¯æœ¬å¿…é¡»è°ƒç”¨ä¸åŒç«¯å£ï¼Œå› è€Œè®¾ç½®ä¸º 6380ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸´æ—¶ç«¯å£ 1024 åˆ° 65535ã€‚</p><p>connect è®¾ç½®ä¸º Redis æœåŠ¡å™¨ç»ˆç«¯èŠ‚ç‚¹ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æŸ¥æ‰¾è¿æ¥ç»ˆç«¯èŠ‚ç‚¹ã€‚</p><h3 id="å¼€å¯stunnelã€‚"><a href="#å¼€å¯stunnelã€‚" class="headerlink" title="å¼€å¯stunnelã€‚"></a>å¼€å¯stunnelã€‚</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo stunnel &#x2F;etc&#x2F;stunnel&#x2F;redis-cli.conf</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨ netstat å‘½ä»¤ç¡®è®¤éš§é“å·²å¯åŠ¨ï¼š</span><br><span class="line">$ netstat -tulnp | grep -i stunnel</span><br><span class="line">tcp    0      0 127.0.0.1:6379      0.0.0.0:*        LISTEN      3189&#x2F;stunnel</span><br><span class="line">tcp    0      0 127.0.0.1:6380      0.0.0.0:*        LISTEN      3189&#x2F;stunnel</span><br></pre></td></tr></table></figure><h3 id="redis-cli-é€šè¿‡éš§é“çš„æœ¬åœ°ç»ˆç«¯èŠ‚ç‚¹è¿æ¥åˆ°åŠ å¯†çš„-Redis-èŠ‚ç‚¹ï¼š"><a href="#redis-cli-é€šè¿‡éš§é“çš„æœ¬åœ°ç»ˆç«¯èŠ‚ç‚¹è¿æ¥åˆ°åŠ å¯†çš„-Redis-èŠ‚ç‚¹ï¼š" class="headerlink" title="redis-cli é€šè¿‡éš§é“çš„æœ¬åœ°ç»ˆç«¯èŠ‚ç‚¹è¿æ¥åˆ°åŠ å¯†çš„ Redis èŠ‚ç‚¹ï¼š"></a>redis-cli é€šè¿‡éš§é“çš„æœ¬åœ°ç»ˆç«¯èŠ‚ç‚¹è¿æ¥åˆ°åŠ å¯†çš„ Redis èŠ‚ç‚¹ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h localhost -p 6379 -a MySecretPassword</span><br><span class="line">localhost:6379&gt;set foo &quot;bar&quot;</span><br><span class="line">OK</span><br><span class="line">localhost:6379&gt;get foo</span><br><span class="line">&quot;bar&quot;</span><br></pre></td></tr></table></figure><p>æ­¤ç¤ºä¾‹ä½¿ç”¨ telnet è¿æ¥åˆ° Redis æœåŠ¡å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># telnet localhost 6379</span><br><span class="line">Trying 127.0.0.1...</span><br><span class="line">Connected to localhost.</span><br><span class="line">Escape character is &#39;^]&#39;.</span><br><span class="line">auth MySecretPassword</span><br><span class="line">+OKget foo</span><br><span class="line">$3</span><br><span class="line">bar</span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œ-pkill-å‘½ä»¤ä»¥åœæ­¢å’Œå…³é—­-SSL-éš§é“ï¼š"><a href="#è¿è¡Œ-pkill-å‘½ä»¤ä»¥åœæ­¢å’Œå…³é—­-SSL-éš§é“ï¼š" class="headerlink" title="è¿è¡Œ pkill å‘½ä»¤ä»¥åœæ­¢å’Œå…³é—­ SSL éš§é“ï¼š"></a>è¿è¡Œ pkill å‘½ä»¤ä»¥åœæ­¢å’Œå…³é—­ SSL éš§é“ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkill stunnel</span><br></pre></td></tr></table></figure><h1 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h1><h2 id="å°è¯•æŒ‰ç…§å®˜æ–¹çš„è§£å†³åŠæ³•"><a href="#å°è¯•æŒ‰ç…§å®˜æ–¹çš„è§£å†³åŠæ³•" class="headerlink" title="å°è¯•æŒ‰ç…§å®˜æ–¹çš„è§£å†³åŠæ³•"></a>å°è¯•æŒ‰ç…§å®˜æ–¹çš„è§£å†³åŠæ³•</h2><p>é¦–å…ˆæˆ‘åœ¨æœ¬æœºä¸‹äº†stunnelæ’ä»¶åï¼Œå‘ç°ç¡®å®Redis-cliå¯ä»¥è¿æ¥</p><p>ä½†æ˜¯é¡¹ç›®è¿˜æ˜¯è¿ä¸äº†ï¼ŒæŠ¥é”™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.data.redis.connection.PoolException: Could not get a resource from the pool; nested exception is io.lettuce.core.RedisConnectionException: Unable to connect to master..cache.amazonaws.com:6379</span><br></pre></td></tr></table></figure><p>æˆ‘æƒ³äº†ä¸‹é¡¹ç›®è¿æ¥çš„åŸç†ï¼ŒSpring-data-redisä¹Ÿæ˜¯è°ƒRedisçš„API</p><p>æŠ±ç€å°è¯•çš„æ€åº¦ï¼Œåœ¨å®¹å™¨é‡Œä¸‹è½½äº†stunnelæ’ä»¶ï¼Œç„¶åjava -jaré‡å¯å‘ç°å¯ä»¥è¿æ¥äº†</p><p>å¤ªæ£’äº†ï¼Œè¿™æ ·çš„è¯æˆ‘å°±åªç”¨åœ¨Dockerfileé‡Œå†™å¥½æ·»åŠ è¿™ä¸ªæ’ä»¶çš„æ­¥éª¤å³å¯</p><p>ç­‰ç­‰ï¼Œé‚£ä¹ˆredis-cli.confæ˜¯ä¸æ˜¯åº”è¯¥è·Ÿç€ä¸åŒçš„ç¯å¢ƒæ›´æ”¹ä¸åŒçš„é…ç½®æ–‡ä»¶å‘¢</p><p>æƒ³åˆ°è¿™é‡Œæˆ‘è§‰å¾—åˆ¶ä½œDockerfileä¹Ÿä¸èƒ½å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜</p><h2 id="AWSçš„SDK"><a href="#AWSçš„SDK" class="headerlink" title="AWSçš„SDK"></a>AWSçš„SDK</h2><p>çœ‹äº†ä¸‹AWSçš„SDKä»‹ç»</p><p>å¯ä»¥ç”¨AWSçš„SDKå»è¿æ¥Redis</p><p>ä½†æ˜¯è¿™æ ·åšæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸‡ä¸€æˆ‘å“ªå¤©ä¸ç”¨AWSçš„Rediså‘¢ï¼Œé‚£ä»£ç ä¹Ÿè¦é‡æ–°æ”¹ã€‚</p><h2 id="redissonå’Œspring-data-redis"><a href="#redissonå’Œspring-data-redis" class="headerlink" title="redissonå’Œspring-data-redis"></a>redissonå’Œspring-data-redis</h2><p>ç½‘ä¸Šæ‰¾äº†å¾ˆä¹…ï¼Œçªç„¶çœ‹åˆ°ä¸€ä¸ªäººçš„é—®é¢˜å’Œæˆ‘å¾ˆåƒã€‚</p><p>ä½†æ˜¯ä»–çš„é¡¹ç›®ç”¨çš„è½¯ä»¶åŒ…æ˜¯Redisson</p><p>è€Œæˆ‘ä»¬ç”¨çš„æ˜¯spring-data-Redis</p><p>Redissonçš„é…ç½®æ–‡ä»¶æœ‰ä¸ªsslï¼štrue</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  redis:</span><br><span class="line">    host: clustercfg.our-redis-instance-name.ssv2ov.use1.cache.amazonaws.com</span><br><span class="line">    port: 6379</span><br><span class="line">    password: ourRedisPassword</span><br><span class="line">    ssl: true</span><br><span class="line">    cluster:</span><br><span class="line">      nodes: node01.our-redis-instance-name.ssv2ov.use1.cache.amazonaws.com:6379,node02.our-redis-instance-name.ssv2ov.use1.cache.amazonaws.com:6379,node03.our-redis-instance-name.ssv2ov.use1.cache.amazonaws.com:6379</span><br></pre></td></tr></table></figure><p>åŒæ ·æ‰¾åˆ°äº†ä¸€ä¸ªspring-data-redisçš„ä¾‹å­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JedisConnectionFactory conn &#x3D;  new JedisConnectionFactory();</span><br><span class="line">conn.setHostName(redisHost);</span><br><span class="line">conn.setPort(redisPort);</span><br><span class="line">conn.setUseSsl(true);</span><br></pre></td></tr></table></figure><h2 id="æœ€ç®€å•çš„æ–¹æ³•"><a href="#æœ€ç®€å•çš„æ–¹æ³•" class="headerlink" title="æœ€ç®€å•çš„æ–¹æ³•"></a>æœ€ç®€å•çš„æ–¹æ³•</h2><p>ç”±äºç ”å‘äººå‘˜æ²¡æ—¶é—´çœ‹Redis-SDKçš„sslåŠŸèƒ½ï¼Œæˆ‘åˆä¸å¤ªäº†è§£Javaã€‚å¯¼è‡´æœ€åæˆ‘ç”¨è¿ç»´å±‚é¢çš„æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜</p><p>å°±æ˜¯ä¸è®¾å¯†ç </p><p>å¯¹ï¼Œä½ æ²¡çœ‹é”™</p><p>å°±æ˜¯ä¸åŠ å¯†ç </p><p>æˆ‘æŠŠRedisè¿æ¥çš„å®‰å…¨ç»„æ§åˆ¶åˆ°å…·ä½“çš„å†…ç½‘IPå³å¯</p><p>æœ€åä¹Ÿæ˜¯è¿™æ ·è§£å†³çš„</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å…¶å®è¿™ä¸ªé—®é¢˜åœ¨åé¢æˆ‘åæ€è¿‡ï¼ŒRedisåº”è¯¥è¿˜æ˜¯è¦ä¸Šå¯†ç çš„ï¼Œå³ä½¿Redisé‡Œæ²¡æœ‰å­˜å¾ˆæ•æ„Ÿçš„ä¿¡æ¯ï¼Œä½†æ˜¯è¿™ä¸ç¬¦åˆè§„èŒƒï¼Œåé¢åªèƒ½è®©ç ”å‘æµ‹è¯•sslåŠ å¯†çš„åŠŸèƒ½äº†ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://github.com/redisson/redisson/issues/2438" target="_blank" rel="noopener">Reddison AWS ElastiCache Redisç¾¤é›†è¿æ¥é—®é¢˜ </a></p><p><a href="https://my.oschina.net/u/1249401/blog/820277" target="_blank" rel="noopener">MySql Host is blocked because of many connection errors; unblock with â€˜mysqladmin flush-hostsâ€™ </a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Operation Manual </tag>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœåŠ¡å™¨é‡å¯ååŠ è½½ä¸äº†æ–‡ä»¶ç³»ç»Ÿ</title>
      <link href="/2020/09/17/bug/reboot-mount/"/>
      <url>/2020/09/17/bug/reboot-mount/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬äºŒå®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ç ”å‘æœ‰éœ€æ±‚è·‘3Dç¨‹åºï¼Œè®©æˆ‘åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šè£…æ˜¾å¡é©±åŠ¨ï¼Œç»“æœé‡å¯çš„æ—¶å€™æœºå™¨æ•…éšœï¼ŒåŠ è½½ä¸äº†æ–‡ä»¶ç³»ç»Ÿ</p><h1 id="ç°çŠ¶"><a href="#ç°çŠ¶" class="headerlink" title="ç°çŠ¶"></a>ç°çŠ¶</h1><p>è£…æ˜¾å¡é©±åŠ¨éœ€è¦ç¦ç”¨Nouveaué©±åŠ¨ã€æ›´æ–°å†…æ ¸ï¼Œç„¶åé‡å¯</p><p>é‡å¯æ—¶ï¼Œå‡ºç°å¦‚ä¸‹é”™è¯¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GIVE root password for maintenance (or type control-D to continue)</span><br><span class="line">Login incorrct:</span><br><span class="line">Give root password for maintenance</span><br><span class="line">(or type Control-D to continue):</span><br></pre></td></tr></table></figure><p>googleåå‘ç° </p><p>å½“Linuxç³»ç»Ÿè¢«å¼ºè¡Œå…³é—­æˆ–é‡æ–°å¯åŠ¨ï¼Œç”µè„‘çš„æ¡£æ¡ˆç³»ç»Ÿä¾¿æœ‰å¯èƒ½å—æŸï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æŸ¥å¹¶ä¿®å¤æ¡£æ¡ˆç³»ç»Ÿï¼›ä½†å½“æ¡£æ¡ˆç³»ç»Ÿæœªèƒ½è‡ªåŠ¨ä¿®å¤ï¼Œç”»é¢ä¾¿ä¼šå‡ºç°ä¸Šè¿°è®¯æ¯ã€‚</p><h1 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h1><p>å…ˆè¾“å…¥rootå¯†ç è¿›å…¥æœåŠ¡å™¨</p><p>æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">df -hT</span><br><span class="line">Filesystem              Type      Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs                devtmpfs   16G     0   16G   0% &#x2F;dev</span><br><span class="line">tmpfs                   tmpfs      16G     0   16G   0% &#x2F;dev&#x2F;shm</span><br><span class="line">tmpfs                   tmpfs      16G  9.7M   16G   1% &#x2F;run</span><br><span class="line">tmpfs                   tmpfs      16G     0   16G   0% &#x2F;sys&#x2F;fs&#x2F;cgroup</span><br><span class="line">&#x2F;dev&#x2F;mapper&#x2F;centos-root xfs       1.8T  154G  1.7T   9% &#x2F;</span><br><span class="line">&#x2F;dev&#x2F;sda2               xfs      1014M  235M  780M  24% &#x2F;boot</span><br><span class="line">&#x2F;dev&#x2F;sda1               vfat      200M   12M  189M   6% &#x2F;boot&#x2F;efi</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç¡¬ç›˜è®¾å¤‡åŠæŒ‚è½½é…ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins-harbor ~]# blkid </span><br><span class="line">&#x2F;dev&#x2F;mapper&#x2F;centos-root: UUID&#x3D;&quot;406eb28a-e11b-4361-b3eb-3244f895cbf9&quot; TYPE&#x3D;&quot;xfs&quot; </span><br><span class="line">&#x2F;dev&#x2F;sda3: UUID&#x3D;&quot;mULe6E-r4m5-3GYM-wgc2-VzxN-vomR-AP3neD&quot; TYPE&#x3D;&quot;LVM2_member&quot; PARTUUID&#x3D;&quot;fefb0fc6-b09b-4ea2-9f50-2601ce39fd62&quot; </span><br><span class="line">&#x2F;dev&#x2F;nvme0n1: PTTYPE&#x3D;&quot;gpt&quot; </span><br><span class="line">&#x2F;dev&#x2F;nvme0n1p1: UUID&#x3D;&quot;4292-32BD&quot; TYPE&#x3D;&quot;vfat&quot; PARTLABEL&#x3D;&quot;EFI System Partition&quot; PARTUUID&#x3D;&quot;b5ce22ae-35a1-4d6e-8e39-8e79c2bdf627&quot; </span><br><span class="line">&#x2F;dev&#x2F;nvme0n1p2: UUID&#x3D;&quot;d5993c22-3e0f-4cca-baca-8b41d65cf685&quot; TYPE&#x3D;&quot;ext4&quot; PARTUUID&#x3D;&quot;d0fb0bd8-f84a-44f8-b6cd-7eed306823d5&quot; </span><br><span class="line">&#x2F;dev&#x2F;nvme0n1p3: UUID&#x3D;&quot;2e9c7400-9214-4375-9818-ad5e94fbe3a6&quot; TYPE&#x3D;&quot;swap&quot; PARTUUID&#x3D;&quot;2980ef10-5cd2-4215-8e41-f6eff10d4c99&quot; </span><br><span class="line">&#x2F;dev&#x2F;sda1: SEC_TYPE&#x3D;&quot;msdos&quot; UUID&#x3D;&quot;54EC-FF86&quot; TYPE&#x3D;&quot;vfat&quot; PARTLABEL&#x3D;&quot;EFI System Partition&quot; PARTUUID&#x3D;&quot;fc41939c-89d6-4960-8cc7-d4895a06bf85&quot; </span><br><span class="line">&#x2F;dev&#x2F;sda2: UUID&#x3D;&quot;2a29efa6-1bfb-4299-bb75-fb4d2c769954&quot; TYPE&#x3D;&quot;xfs&quot; PARTUUID&#x3D;&quot;f78790e4-7d58-49d1-a714-05c0852449f4&quot; </span><br><span class="line">&#x2F;dev&#x2F;mapper&#x2F;centos-swap: UUID&#x3D;&quot;854cebfc-0956-4559-a20e-927580f29517&quot; TYPE&#x3D;&quot;swap&quot; </span><br><span class="line"></span><br><span class="line">[root@jenkins-harbor ~]# cat &#x2F;etc&#x2F;fstab</span><br><span class="line">#</span><br><span class="line"># &#x2F;etc&#x2F;fstab</span><br><span class="line"># Created by anaconda on Fri Aug 14 12:38:39 2020</span><br><span class="line">#</span><br><span class="line"># Accessible filesystems, by reference, are maintained under &#39;&#x2F;dev&#x2F;disk&#39;</span><br><span class="line"># See man pages fstab(5), findfs(8), mount(8) and&#x2F;or blkid(8) for more info</span><br><span class="line">#</span><br><span class="line">&#x2F;dev&#x2F;mapper&#x2F;centos-root &#x2F;                       xfs     defaults        0 0</span><br><span class="line">UUID&#x3D;2a29efa6-1bfb-4299-bb75-fb4d2c769954 &#x2F;boot                   xfs     defaults        0 0</span><br><span class="line">UUID&#x3D;54EC-FF86          &#x2F;boot&#x2F;efi               vfat    umask&#x3D;0077,shortname&#x3D;winnt 0 0</span><br><span class="line">UUID&#x3D;d276a0d4-c95f-4792-a222-6d1451899de2 &#x2F;home ext4    noatime,errors&#x3D;remount-ro 0 1</span><br><span class="line">&#x2F;dev&#x2F;mapper&#x2F;centos-swap swap                    swap    defaults        0 0</span><br></pre></td></tr></table></figure><p>èµ·åˆæˆ‘å¹¶æ²¡æœ‰å‘ç°æœ‰ä»€ä¹ˆé—®é¢˜</p><p>ç„¶åæŸ¥çœ‹å¼€æœºæ—¶çš„ç³»ç»Ÿæ—¥å¿—</p><p>journalctl -xb</p><p>å…¶ä¸­æœ‰è¿™ä¹ˆä¸€æ®µæŠ¥é”™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Sep 16 19:35:54 jenkins-harbor kernel: ACPI Error: [DSSP] Namespace lookup failure, AE_NOT_FOUND (20130517&#x2F;psargs-359)</span><br><span class="line">Sep 16 19:35:54 jenkins-harbor kernel: ACPI Error: Method parse&#x2F;execution failed [\_SB_.PCI0.SAT0.PRT4._GTF] (Node ffff900bf4b248d0), AE_NOT_</span><br><span class="line">Sep 16 19:35:54 jenkins-harbor kernel: ata5.00: ATA-10: WDC WD20EZAZ-00L9GB0, 80.00A80, max UDMA&#x2F;133</span><br><span class="line">Sep 16 19:35:54 jenkins-harbor kernel: ata5.00: 3907029168 sectors, multi 16: LBA48 NCQ (depth 31&#x2F;32), AA</span><br><span class="line">Sep 16 19:35:54 jenkins-harbor kernel: ACPI Error: [DSSP] Namespace lookup failure, AE_NOT_FOUND (20130517&#x2F;psargs-359)</span><br><span class="line">Sep 16 19:35:54 jenkins-harbor kernel: ACPI Error: Method parse&#x2F;execution failed [\_SB_.PCI0.SAT0.PRT4._GTF] (Node ffff900bf4b248d0), AE_NOT_</span><br><span class="line">Sep 16 19:35:54 jenkins-harbor kernel: ata5.00: configured for UDMA&#x2F;133</span><br><span class="line">Sep 16 19:35:54 jenkins-harbor kernel: scsi 4:0:0:0: Direct-Access     ATA      WDC WD20EZAZ-00L 0A80 PQ: 0 ANSI: 5</span><br><span class="line">Sep 16 19:35:54 jenkins-harbor kernel: sd 4:0:0:0: [sda] 3907029168 512-byte logical blocks: (2.00 TB&#x2F;1.81 TiB)</span><br><span class="line">Sep 16 19:35:54 jenkins-harbor kernel: sd 4:0:0:0: [sda] 4096-byte physical blocks</span><br><span class="line">Sep 16 19:35:54 jenkins-harbor kernel: sd 4:0:0:0: [sda] Write Protect is off</span><br><span class="line">Sep 16 19:35:54 jenkins-harbor kernel: sd 4:0:0:0: [sda] Mode Sense: 00 3a 00 00</span><br><span class="line">Sep 16 19:35:54 jenkins-harbor kernel: sd 4:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn&#39;t support DPO or FUA</span><br><span class="line">Sep 16 19:35:54 jenkins-harbor kernel:  sda: sda1 sda2 sda3</span><br><span class="line">Sep 16 19:35:54 jenkins-harbor kernel: sd 4:0:0:0: [sda] Attached SCSI disk</span><br><span class="line">Sep 16 19:35:54 jenkins-harbor kernel: random: fast init done</span><br></pre></td></tr></table></figure><p>åæ¥ä»”ç»†æ£€æŸ¥blkid å’Œ/etc/fstabçš„åŒºåˆ«å‘ç°</p><p>å¤šäº†ä¸€æ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UUID&#x3D;d276a0d4-c95f-4792-a222-6d1451899de2 &#x2F;home ext4    noatime,errors&#x3D;remount-ro 0 1</span><br></pre></td></tr></table></figure><p>ä¸çŸ¥é“ä»å“ªé‡Œå†’å‡ºæ¥çš„</p><p>è€Œä¸”æˆ‘æ²¡æœ‰è¿™ä¸ªè®¾å¤‡æŒ‚è½½åˆ°/homeç›®å½•ä¸‹</p><p>æœ€ç»ˆåˆ é™¤è¿™ä¸€è¡Œ</p><p>reboot</p><p>æˆåŠŸ</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™ä¸ªäº‹æƒ…å‘ç”Ÿçš„æœ‰äº›è«åå…¶å¦™ï¼Œå› ä¸ºç½‘ä¸Šè¯´å‡ºç°æ–‡ä»¶ç³»ç»ŸæŸåæ˜¯å› ä¸ºå¼ºè¡Œå…³é—­æˆ–é‡æ–°å¯åŠ¨ï¼Œæˆ‘å¯»æ€rebootä¹Ÿä¸ç®—å¼ºè¡Œé‡å¯å§ã€‚</p><p>è¿™é‡Œä¸å¾—ä¸è¯´ï¼Œä¹‹å‰é¢è¯•å¤ä¹ æ—¶ç»å¸¸è¢«é—®åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼ˆcentos6å’Œ7çš„å¯åŠ¨æµç¨‹åˆ†åˆ«æ˜¯ä»€ä¹ˆ ï¼‰å¸®äº†æˆ‘å¤§å¿™ï¼Œé€šè¿‡åˆ†æcentos7çš„å¯åŠ¨æ­¥éª¤æˆ‘ï¼Œæ‰¾åˆ°äº†é‚£å—ä¸èƒ½æŒ‚è½½çš„ç£ç›˜ï¼Œå¹¶ä¸”æ¸…é™¤æŒ‚è½½çš„é…ç½®é¡¹ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªäº‹æ•…çš„åæœåœ¨æˆ‘çœ‹æ¥ç›¸å½“ä¸¥é‡</p><p>å› ä¸ºè¿™å°æœåŠ¡å™¨éƒ¨ç½²äº†jenkinsæµæ°´çº¿+é•œåƒä»“åº“</p><p>å¯¼è‡´ä¸€å¤©çš„é¡¹ç›®æ²¡æ³•å‘å¸ƒ</p><p>æˆ‘æ·±æ·±çš„æ„Ÿåˆ°è‡ªè´£</p><p>è€Œä¸”è¿™å°æœºå™¨æœ¬èº«æ˜¯æœ‰GPUçš„ï¼Œåœ¨æˆ‘æœªæ·±å…¥è°ƒæŸ¥ä¹‹å‰å°±å°†è¿™å°æœºå™¨ä½œä¸ºäº†Devopså®æ–½çš„æœåŠ¡å™¨ï¼Œå®å±æµªè´¹èµ„æºã€‚</p><p>å¤„ç†è¿™ä¸ªé—®é¢˜çš„å¿ƒæ€æˆ‘æ˜¯éå¸¸ä¸å¥½çš„ï¼Œå› ä¸ºé©¬ä¸Šè¦å‘å¸ƒä¸‹é¡¹ç›®äº†ï¼Œä½†ç”±äºæˆ‘ä¸´æ—¶ä¸ºäº†å¸®åŠ©ä¸€ä¸ªåŒäº‹åœ¨è¿™å°æœºå™¨ä¸Šè£…æ˜¾å¡é©±åŠ¨ï¼Œå¯¼è‡´æ•´ä¸ªå…¬å¸çš„ä¸šåŠ¡æ›´æ–°ä¸­æ–­ä¸€å¤©ã€‚</p><ul><li>ä»¥åä¸èƒ½å› ä¸ºåªå¸®åŒäº‹è§£å†³é—®é¢˜è€Œç«‹å³ä¸€äº›å†’é£é™©çš„äº‹äº†ï¼ˆè¿™é‡Œä¸æ˜¯æ€ªåŒäº‹çš„æ„æ€ï¼Œçš„ç¡®æ˜¯è‡ªå·±ç–å¿½äº†ï¼‰ï¼Œè‡³å°‘å¾—è‡ªå·±å¿ƒé‡Œæœ‰æ†ç§¤ï¼Œèƒ½ä¸èƒ½å®Œæˆï¼Œä»¥åŠé‡è¦ç¨‹åº¦ã€‚</li><li>æ•°æ®å¤‡ä»½ï¼Œå…¶å®å¦‚æœè¿™å°æœåŠ¡å™¨çœŸçš„é‡å¯å¼‚å¸¸å¯¼è‡´æ–‡ä»¶ç³»ç»ŸæŸåçš„è¯ï¼Œé‚£ä¹ˆæ‰€æœ‰æ•°æ®éƒ½ä¸¢å¤±äº†ï¼Œjenkinså’Œharboræˆ‘éƒ½å¾—èŠ±å¾ˆä¹…å¾ˆä¹…ä¿®å¤ã€‚è¿™å®åœ¨äº‹å¤ªä¸åº”è¯¥äº†ã€‚</li></ul><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://www.cnblogs.com/diantong/p/10745372.html" target="_blank" rel="noopener">CentOS7å¯åŠ¨æµç¨‹</a></p><p><a href="https://unix.stackexchange.com/questions/556819/systemd-time-out-waiting-for-device-dev-mapper-vg" target="_blank" rel="noopener">ç³»ç»Ÿè¶…æ—¶ç­‰å¾…è®¾å¤‡dev-mapper-vg</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿ç§»è‡ªå»ºRedisè‡³AWSçš„ElastiCache For Redis</title>
      <link href="/2020/09/16/aws/aws-redis-migrate/"/>
      <url>/2020/09/16/aws/aws-redis-migrate/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬äºŒå®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ä¸ŠæœŸåˆšåˆšæŠŠMysqlè¿äº‘å®Œæˆï¼Œç´§æ¥ç€æˆ‘è¦æŠŠRedisè¿äº‘ã€‚AWSçš„æœåŠ¡ç»„ä»¶ElastiCache For Redis</p><p>é¢˜å¤–è¯ï¼šAWSæ˜¯å¦‚ä½•æ¨é”€Redisäº§å“çš„ï¼Ÿ</p><p>åœ¨â€œå¯¹äºæ²¡æœ‰è€å¿ƒçš„ Web ç”¨æˆ·è€Œè¨€ï¼Œä¸€çœ¨çœ¼çš„åŠŸå¤«éƒ½æ˜¾å¾—å¤ªé•¿â€ä¸­ï¼Œã€Šçº½çº¦æ—¶æŠ¥ã€‹æŠ¥é“ç”¨æˆ·ä¼šè®°ä¸‹ç«äº‰ç½‘ç«™ä¹‹é—´çš„ 250 æ¯«ç§’ï¼ˆ1/4 ç§’ï¼‰çš„å·®å¼‚ã€‚ç”¨æˆ·å°†ç¦»å¼€é€Ÿåº¦è¾ƒæ…¢çš„ç½‘ç«™å¹¶è½¬è‡³é€Ÿåº¦è¾ƒå¿«çš„ç½‘ç«™ã€‚ç½‘é¡µåŠ è½½æ—¶é—´ä¸è®¿å®¢æµå¤±ç‡çš„ç›¸å…³æ€§ä¸­å¼•ç”¨çš„ Amazon æ‰€è¿›è¡Œçš„æµ‹è¯•è¡¨æ˜ï¼ŒåŠ è½½æ—¶é—´æ¯å¢åŠ  100 æ¯«ç§’ï¼ˆ1/10 ç§’ï¼‰ï¼Œé”€å”®é¢å°±ä¼šå‡å°‘ 1%ã€‚</p><p>ç¼“å­˜ç»„ä»¶å¯¹ä¸šåŠ¡çš„ä½“éªŒæ„Ÿè‡³å…³é‡è¦ã€‚</p><h1 id="ç°çŠ¶"><a href="#ç°çŠ¶" class="headerlink" title="ç°çŠ¶"></a>ç°çŠ¶</h1><p>ç›®å‰å…¬å¸è‡ªå»ºäº†2ä¸ªRediså®ä¾‹ï¼ˆ1ä¸ªæµ‹è¯•ã€1ä¸ªç”Ÿäº§ï¼‰</p><h1 id="è°ƒç ”"><a href="#è°ƒç ”" class="headerlink" title="è°ƒç ”"></a>è°ƒç ”</h1><p>Redisçš„è°ƒç ”ç›¸æ¯”Mysqlè¿˜éº»çƒ¦è¿™æ˜¯æˆ‘æ²¡æƒ³åˆ°çš„ï¼Œä»è¿ç§»æ—¶é—´æ¥çœ‹ç¡®å®æ˜¯è¿™æ ·çš„ï¼Œè¸©çš„å‘ä¹Ÿæ¯”Mysqlå¤šå¾ˆå¤šã€‚</p><h2 id="èµ„æºè°ƒç ”"><a href="#èµ„æºè°ƒç ”" class="headerlink" title="èµ„æºè°ƒç ”"></a>èµ„æºè°ƒç ”</h2><h3 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h3><p>æµ‹è¯•ç¯å¢ƒé…ç½®ï¼š2C 8G 500Gç£ç›˜ ec2ç±»å‹t2.large</p><p>æ”¶è´¹æ ‡å‡†ï¼š</p><ul><li>æœåŠ¡å™¨ ä¸€ä¸ªæœˆ744ä¸ªå°æ—¶ ä¸€å°æ—¶0.0928ç¾å…ƒ ä¸€ä¸ªæœˆåˆè®¡69ç¾é‡‘</li><li>ç£ç›˜   ä¸€ä¸ªæœˆæ¯G 0.1ç¾å…ƒ      ä¸€ä¸ªæœˆåˆè®¡50ç¾å…ƒ</li></ul><p>ç”±äºæ²¡æœ‰Redisç›‘æ§å¹³å°ï¼Œåªèƒ½å®æ—¶çœ‹Redisä½¿ç”¨ç‡äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info memory</span><br><span class="line">used_memory:20952496</span><br><span class="line">used_memory_human:19.98M</span><br><span class="line">used_memory_rss:21577728</span><br><span class="line">used_memory_peak:24330768</span><br><span class="line">used_memory_peak_human:23.20M</span><br><span class="line">used_memory_lua:36864</span><br><span class="line">mem_fragmentation_ratio:1.03</span><br><span class="line">mem_allocator:jemalloc-3.6.0</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿäº§ç¯å¢ƒ"><a href="#ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒ"></a>ç”Ÿäº§ç¯å¢ƒ</h3><p>ç”Ÿäº§ç¯å¢ƒé…ç½® 2C 8G 500Gç£ç›˜ ec2ç±»å‹t2.large</p><p>æ”¶è´¹æ ‡å‡†ï¼š</p><ul><li>æœåŠ¡å™¨ ä¸€ä¸ªæœˆ744ä¸ªå°æ—¶ ä¸€å°æ—¶0.0928ç¾å…ƒ ä¸€ä¸ªæœˆåˆè®¡69ç¾é‡‘</li><li>ç£ç›˜   ä¸€ä¸ªæœˆæ¯G 0.1ç¾å…ƒ      ä¸€ä¸ªæœˆåˆè®¡50ç¾å…ƒ</li></ul><p>å®æ—¶çœ‹Redisä½¿ç”¨ç‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info memory</span><br><span class="line">used_memory:21552008</span><br><span class="line">used_memory_human:20.55M</span><br><span class="line">used_memory_rss:34312192</span><br><span class="line">used_memory_peak:25640992</span><br><span class="line">used_memory_peak_human:24.45M</span><br><span class="line">used_memory_lua:36864</span><br><span class="line">mem_fragmentation_ratio:1.59</span><br><span class="line">mem_allocator:jemalloc-3.6.0</span><br></pre></td></tr></table></figure><h3 id="ElastiCache"><a href="#ElastiCache" class="headerlink" title="ElastiCache"></a>ElastiCache</h3><p>æ ¹æ®æµ‹è¯•å’Œç”Ÿäº§å®é™…Redisçš„ä½¿ç”¨å¤§å°</p><p>æˆ‘é€‰æ‹©äº†AWS 1c 0.5g çš„rediså®ä¾‹ cache.t2micro</p><p>12.24ç¾å…ƒ/æœˆ</p><h3 id="å¯¹æ¯”ç»“è®º"><a href="#å¯¹æ¯”ç»“è®º" class="headerlink" title="å¯¹æ¯”ç»“è®º"></a>å¯¹æ¯”ç»“è®º</h3><p>ElastiCacheå¥½å¤„æœ‰</p><ul><li>é›†ç¾¤é«˜å¯ç”¨ </li><li>å¤‡ä»½ </li><li>å¼¹æ€§æ‰©å®¹ </li><li>ç›‘æ§</li></ul><p>é™ä½è¿ç»´æˆæœ¬</p><h2 id="è¿ç§»è°ƒç ”"><a href="#è¿ç§»è°ƒç ”" class="headerlink" title="è¿ç§»è°ƒç ”"></a>è¿ç§»è°ƒç ”</h2><p>ç»è¿‡è°ƒç ”å‘ç°AWSçš„è¿ç§»æ”¯æŒåœ¨çº¿å’Œç¦»çº¿è¿ç§»</p><h3 id="AWSçš„åœ¨çº¿Redisè¿ç§»æ­¥éª¤è¯´æ˜"><a href="#AWSçš„åœ¨çº¿Redisè¿ç§»æ­¥éª¤è¯´æ˜" class="headerlink" title="AWSçš„åœ¨çº¿Redisè¿ç§»æ­¥éª¤è¯´æ˜"></a>AWSçš„åœ¨çº¿Redisè¿ç§»æ­¥éª¤è¯´æ˜</h3><p>æ‚¨å¿…é¡»ç¡®ä¿å·²ç»æ»¡è¶³äº†ä¸‹é¢æåˆ°çš„æ‰€æœ‰å››ä¸ªå…ˆå†³æ¡ä»¶ï¼Œç„¶åæ‰èƒ½å¼€å§‹ä» ElastiCache æ§åˆ¶å°ã€API æˆ– AWS CLI å¼€å§‹è¿ç§»ã€‚</p><h4 id="ç¡®å®šç›®æ ‡-ElastiCache-éƒ¨ç½²ï¼Œå¹¶ç¡®ä¿æ‚¨å¯ä»¥å°†æ•°æ®è¿ç§»åˆ°è¯¥éƒ¨ç½²ã€‚"><a href="#ç¡®å®šç›®æ ‡-ElastiCache-éƒ¨ç½²ï¼Œå¹¶ç¡®ä¿æ‚¨å¯ä»¥å°†æ•°æ®è¿ç§»åˆ°è¯¥éƒ¨ç½²ã€‚" class="headerlink" title="ç¡®å®šç›®æ ‡ ElastiCache éƒ¨ç½²ï¼Œå¹¶ç¡®ä¿æ‚¨å¯ä»¥å°†æ•°æ®è¿ç§»åˆ°è¯¥éƒ¨ç½²ã€‚"></a>ç¡®å®šç›®æ ‡ ElastiCache éƒ¨ç½²ï¼Œå¹¶ç¡®ä¿æ‚¨å¯ä»¥å°†æ•°æ®è¿ç§»åˆ°è¯¥éƒ¨ç½²ã€‚</h4><ul><li>ä½¿ç”¨Rediså¼•æ“5.0.5æˆ–æ›´é«˜ç‰ˆæœ¬ç¦ç”¨äº†é›†ç¾¤æ¨¡å¼ã€‚</li><li>å®ƒæ—¢æ²¡æœ‰å¯ç”¨ä¼ è¾“ä¸­åŠ å¯†åŠŸèƒ½ï¼Œä¹Ÿæ²¡æœ‰å¯ç”¨é™æ€åŠ å¯†åŠŸèƒ½ã€‚</li><li>å®ƒå¯ç”¨äº†å¤šå¯ç”¨åŒºã€‚</li><li>å®ƒæœ‰è¶³å¤Ÿçš„å†…å­˜æ¥å®¹çº³æ¥è‡ªEC2å®ä¾‹ä¸ŠRedisçš„æ•°æ®ã€‚è¦é…ç½®æ­£ç¡®çš„ä¿ç•™å†…å­˜è®¾ç½®ï¼Œè¯·å‚é˜…ç®¡ç†åˆ†é…å†…å­˜ã€‚</li></ul><h4 id="ç¡®ä¿-EC2-ä¸Šçš„-Redis-ä¸-ElastiCache-for-Redis-éƒ¨ç½²çš„é…ç½®å…¼å®¹ã€‚"><a href="#ç¡®ä¿-EC2-ä¸Šçš„-Redis-ä¸-ElastiCache-for-Redis-éƒ¨ç½²çš„é…ç½®å…¼å®¹ã€‚" class="headerlink" title="ç¡®ä¿ EC2 ä¸Šçš„ Redis ä¸ ElastiCache for Redis éƒ¨ç½²çš„é…ç½®å…¼å®¹ã€‚"></a>ç¡®ä¿ EC2 ä¸Šçš„ Redis ä¸ ElastiCache for Redis éƒ¨ç½²çš„é…ç½®å…¼å®¹ã€‚</h4><p>è‡³å°‘ï¼Œç›®æ ‡ ElastiCache éƒ¨ç½²ä¸­çš„æ‰€æœ‰ä»¥ä¸‹å†…å®¹åº”ä¸ Redis é…ç½®å…¼å®¹æ‰èƒ½è¿›è¡Œ Redis å¤åˆ¶ï¼š</p><ul><li>æ‚¨çš„Redisåº”å¤„äºç¦ç”¨ç¾¤é›†æ¨¡å¼çš„é…ç½®ã€‚</li><li>æ‚¨åœ¨EC2å®ä¾‹ä¸Šçš„Redisä¸åº”å¯ç”¨Redis AUTHã€‚</li><li>Redis config protected-modeåº”è¯¥è®¾ç½®ä¸ºnoã€‚</li><li>å¦‚æœæ‚¨bindçš„Redisé…ç½®ä¸­æœ‰é…ç½®ï¼Œåˆ™åº”å¯¹å…¶è¿›è¡Œæ›´æ–°ä»¥å…è®¸æ¥è‡ªElastiCacheèŠ‚ç‚¹çš„è¯·æ±‚ã€‚</li><li>ElastiCacheèŠ‚ç‚¹ä¸Šçš„é€»è¾‘æ•°æ®åº“æ•°åº”ä¸EC2å®ä¾‹ä¸Šçš„Redisæ•°ç›¸åŒã€‚databasesåœ¨Redisé…ç½®ä¸­ä½¿ç”¨è®¾ç½®æ­¤å€¼ã€‚</li><li>æ‰§è¡Œæ•°æ®ä¿®æ”¹çš„Rediså‘½ä»¤ä¸åº”é‡å‘½åä»¥ä½¿æ•°æ®å¤åˆ¶æˆåŠŸã€‚</li><li>è¦å°†æ•°æ®ä»Redisé›†ç¾¤å¤åˆ¶åˆ°ElastiCacheï¼Œè¯·ç¡®ä¿æœ‰è¶³å¤Ÿçš„CPUå’Œå†…å­˜æ¥å¤„ç†æ­¤é¢å¤–çš„è´Ÿè½½ã€‚æ­¤è´Ÿè½½æ¥è‡ªRedisç¾¤é›†åˆ›å»ºçš„RDBæ–‡ä»¶ï¼Œå¹¶é€šè¿‡ç½‘ç»œä¼ è¾“åˆ°ElastiCacheèŠ‚ç‚¹ã€‚</li></ul><h4 id="æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼Œä»¥ç¡®ä¿-EC2-å®ä¾‹å¯ä»¥è¿æ¥åˆ°-ElastiCacheï¼š"><a href="#æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼Œä»¥ç¡®ä¿-EC2-å®ä¾‹å¯ä»¥è¿æ¥åˆ°-ElastiCacheï¼š" class="headerlink" title="æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼Œä»¥ç¡®ä¿ EC2 å®ä¾‹å¯ä»¥è¿æ¥åˆ° ElastiCacheï¼š"></a>æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼Œä»¥ç¡®ä¿ EC2 å®ä¾‹å¯ä»¥è¿æ¥åˆ° ElastiCacheï¼š</h4><ul><li>ç¡®ä¿æ‚¨çš„EC2å®ä¾‹çš„IPåœ°å€æ˜¯ç§æœ‰çš„ã€‚</li><li>åœ¨ä¸EC2å®ä¾‹ä¸Šçš„Redisç›¸åŒçš„è™šæ‹Ÿç§æœ‰äº‘ï¼ˆVPCï¼‰ä¸­åˆ†é…æˆ–åˆ›å»ºElastiCacheéƒ¨ç½²ï¼ˆæ¨èï¼‰ã€‚</li><li>å¦‚æœVPCä¸åŒï¼Œåˆ™è®¾ç½®VPCå¯¹ç­‰ä»¥å…è®¸èŠ‚ç‚¹ä¹‹é—´çš„è®¿é—®ã€‚æœ‰å…³VPCå¯¹ç­‰çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ç”¨äºè®¿é—®Amazon VPCä¸­çš„ElastiCacheé›†ç¾¤çš„è®¿é—®æ¨¡å¼ã€‚</li><li>é™„åŠ åˆ°EC2å®ä¾‹ä¸Šçš„Redisçš„å®‰å…¨ç»„åº”å…è®¸æ¥è‡ªElastiCacheèŠ‚ç‚¹çš„å…¥ç«™æµé‡ã€‚</li></ul><h4 id="åœ¨æ•°æ®è¿ç§»å®Œæˆåï¼Œç¡®ä¿åº”ç”¨ç¨‹åºå¯ä»¥å°†æµé‡ä¼ é€åˆ°-ElastiCache-èŠ‚ç‚¹ã€‚"><a href="#åœ¨æ•°æ®è¿ç§»å®Œæˆåï¼Œç¡®ä¿åº”ç”¨ç¨‹åºå¯ä»¥å°†æµé‡ä¼ é€åˆ°-ElastiCache-èŠ‚ç‚¹ã€‚" class="headerlink" title="åœ¨æ•°æ®è¿ç§»å®Œæˆåï¼Œç¡®ä¿åº”ç”¨ç¨‹åºå¯ä»¥å°†æµé‡ä¼ é€åˆ° ElastiCache èŠ‚ç‚¹ã€‚"></a>åœ¨æ•°æ®è¿ç§»å®Œæˆåï¼Œç¡®ä¿åº”ç”¨ç¨‹åºå¯ä»¥å°†æµé‡ä¼ é€åˆ° ElastiCache èŠ‚ç‚¹ã€‚</h4><h3 id="ç¦»çº¿è¿ç§»"><a href="#ç¦»çº¿è¿ç§»" class="headerlink" title="ç¦»çº¿è¿ç§»"></a>ç¦»çº¿è¿ç§»</h3><p>ç¦»çº¿è¿ç§»å¾ˆç®€å•ï¼ŒæŠŠRDBæ–‡ä»¶å­˜åœ¨S3ä¸Šï¼Œåœ¨åˆ›å»ºRedisçš„æ—¶å€™å¡«ä¸Šè¿™ä¸ªè·¯å¾„å³å¯</p><h3 id="è¿ç§»æ–¹æ¡ˆå¯¹æ¯”"><a href="#è¿ç§»æ–¹æ¡ˆå¯¹æ¯”" class="headerlink" title="è¿ç§»æ–¹æ¡ˆå¯¹æ¯”"></a>è¿ç§»æ–¹æ¡ˆå¯¹æ¯”</h3><p>åœ¨çº¿è¿ç§»ï¼šæ— ç¼æ•°æ®åŒæ­¥ï¼Œä¸ä¸­æ–­ä¸šåŠ¡ï¼Œä½†æ˜¯éœ€è¦åŸRedisä¸èƒ½å¼€å¯é›†ç¾¤ã€å¯†ç éªŒè¯ã€é…ç½®æ–‡ä»¶æ›´æ”¹ç­‰ç­‰ã€‚è¿™äº›è¦æ±‚å‡ä¸æ»¡è¶³ç°ä¸šåŠ¡é˜¶æ®µï¼Œè€Œä¸”è¦æ±‚å±å®å¤šã€‚</p><p>éš¾é“æˆ‘è¿˜è¦å…ˆå…³é—­çº¿ä¸ŠRedisï¼Œæ”¹å¥½è¿™äº›é…ç½®å†å¯åŠ¨Redisï¼Œæœ€åå®è¡Œåœ¨çº¿è¿ç§»å—ï¼Œæˆ‘æœäº†ã€‚</p><p>ç›´æ¥é€‰æ‹©ç¦»çº¿è¿ç§»ï¼Œä¸è¿‡é—®é¢˜å°±æ˜¯åœ¨bgsaveå¤‡ä»½ä¹‹åçš„æ•°æ®ä¼šä¸¢å¤±ï¼Œå’Œç ”å‘æ²Ÿé€šåè®¤ä¸ºè¿™ä¸€ä¼šçš„æ•°æ®ä¸¢å¤±å¹¶ä¸ä¼šå½±å“ä»€ä¹ˆï¼Œæ‰€ä»¥é€‰æ‹©ç¦»çº¿è¿ç§»æ–¹å¼ã€‚</p><h2 id="Redisç‰ˆæœ¬è°ƒç ”"><a href="#Redisç‰ˆæœ¬è°ƒç ”" class="headerlink" title="Redisç‰ˆæœ¬è°ƒç ”"></a>Redisç‰ˆæœ¬è°ƒç ”</h2><p>AWSå»ºè®®ä½¿ç”¨Redisç‰ˆæœ¬ä¸º5.0.6</p><p>è€Œç›®å‰è‡ªå»ºRedisç‰ˆæœ¬ä¸º4.0</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.data&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-data-redis&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;springboot.version&gt;2.1.6.RELEASE&lt;&#x2F;springboot.version&gt;</span><br></pre></td></tr></table></figure><p>å’Œç ”å‘äººå‘˜ä¸€èµ·è°ƒç ”åå‘ç°å¯ä»¥ä½¿ç”¨Redis 5.0.6çš„ç‰ˆæœ¬</p><h1 id="è¿ç§»"><a href="#è¿ç§»" class="headerlink" title="è¿ç§»"></a>è¿ç§»</h1><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="å¤‡ä»½"><a href="#å¤‡ä»½" class="headerlink" title="å¤‡ä»½"></a>å¤‡ä»½</h3><p>ç”±äºè‡ªå»ºRedisæ²¡æœ‰å¼€å¯RDBæŒä¹…åŒ–ï¼Œæ‰€ä»¥æ‰‹åŠ¨å¤‡ä»½ä¸€ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h xxx </span><br><span class="line">xxx &gt;  auth passwd</span><br><span class="line">Ok</span><br><span class="line">xxx &gt;  BGSAVE</span><br></pre></td></tr></table></figure><p>å¤‡ä»½å®Œæˆåå°†RDBæ–‡ä»¶ä¸Šä¼ åˆ°S3ä¸Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 cp dump.rdb s3:&#x2F;&#x2F;redis-dump&#x2F;dump.rdb</span><br></pre></td></tr></table></figure><p>å…·ä½“æ“ä½œå®Œå…¨å‚è€ƒ <a href="https://docs.aws.amazon.com/zh_cn/AmazonElastiCache/latest/red-ug/backups-seeding-redis.html#backups-seeding-redis-create-s3-bucket" target="_blank" rel="noopener">ä½¿ç”¨å¤–éƒ¨åˆ›å»ºçš„å¤‡ä»½ä¸ºæ–°ç¾¤é›†æ’­ç§</a></p><h3 id="åˆ›å»ºRediså®‰å…¨ç»„åŠå­ç½‘ç»„"><a href="#åˆ›å»ºRediså®‰å…¨ç»„åŠå­ç½‘ç»„" class="headerlink" title="åˆ›å»ºRediså®‰å…¨ç»„åŠå­ç½‘ç»„"></a>åˆ›å»ºRediså®‰å…¨ç»„åŠå­ç½‘ç»„</h3><p>å…ˆåˆ›å»ºRediså­ç½‘ç»„ï¼ŒèŒƒå›´æ˜¯é¡¹ç›®è¿æ¥çš„IPæ± </p><p>åˆ›å»ºå®Œåå°†å®‰å…¨ç»„å…¥ç«™è®¾ä¸ºRedisçš„å­ç½‘ç»„ï¼š6379ç«¯å£</p><h2 id="åˆ›å»º-ElastiCache-For-Redis"><a href="#åˆ›å»º-ElastiCache-For-Redis" class="headerlink" title="åˆ›å»º ElastiCache For Redis"></a>åˆ›å»º ElastiCache For Redis</h2><p>ç‚¹å‡»ElastiCacheæ§åˆ¶å° &gt; åˆ›å»ºRedis &gt;  ç¦ç”¨é›†ç¾¤æ¨¡å¼ &gt; å¼•æ“ç‰ˆæœ¬å…¼å®¹æ€§é€‰æ‹©5.0.6 &gt; ç«¯å£6379 &gt; å‚æ•°ç»„é€‰æ‹©å·²ç»è°ƒä¼˜è¿‡çš„Redis5.0ç»„ &gt; èŠ‚ç‚¹ç±»å‹é€‰æ‹© cache.t3.medium &gt; å‰¯æœ¬æ•°é‡ä¸º0ï¼Œå…³é—­å¤šå¯ç”¨åŒº &gt; é€‰æ‹©å­ç½‘ç»„ &gt; é€‰æ‹©å®‰å…¨ç»„ &gt; é€‰æ‹©ä¼ è¾“ä¸­åŠ å¯†åè®®ï¼Œå¹¶æ·»åŠ å¯†ç  &gt; é€‰æ‹©S3çš„RDBå¤‡ä»½æ–‡ä»¶è·¯å¾„ &gt; å¼€å¯è‡ªåŠ¨å¤‡ä»½ï¼Œå¤‡ä»½ä¿ç•™7å¤©</p><p>åˆ›å»ºï¼</p><p>å¤§çº¦5åˆ†é’Ÿåå¯ä»¥ä½¿ç”¨</p><h2 id="redis-cli"><a href="#redis-cli" class="headerlink" title="redis-cli"></a>redis-cli</h2><p>redis-cli è¿æ¥æµ‹è¯•æ•°æ®ä¸€è‡´æ€§</p><p>éªŒè¯å®Œæˆ</p><h2 id="è·¯ç”±åˆ‡æ¢"><a href="#è·¯ç”±åˆ‡æ¢" class="headerlink" title="è·¯ç”±åˆ‡æ¢"></a>è·¯ç”±åˆ‡æ¢</h2><p>å°†è€è·¯ç”±æ˜ å°„å…³ç³»æ›´æ–°åˆ°RDSçš„åŸŸåä¸Š</p><p>å³åœ¨DNS CNAMEé‡ŒæŒ‡å‘</p><p>æ¯”å¦‚ç°åœ¨çš„DNSæ˜¯redis.xxx.com &gt;&gt; 192.168.1.1</p><p>æˆ‘å°†å®ƒæ”¹ä¸º</p><p>redis.xxx.com &gt;&gt; Redisçš„åŸŸå</p><p>ä¿å­˜è®¾ç½®</p><p>è¿‡ä¸€æ®µæ—¶é—´è§£æ</p><p>ping redis.xxx.com å‘ç°å·²ç»æ›´æ–°æŒ‡å‘çš„åœ°å€ä¸ºRedis</p><p>é‡å¯åº”ç”¨</p><p>å› ä¸ºåº”ç”¨çš„è¿æ¥åœ°å€æ˜¯redis.xxx.com</p><p>æ‰€ä»¥ç›´æ¥é‡å¯æœåŠ¡å³å¯</p><h2 id="éªŒè¯åŠŸèƒ½"><a href="#éªŒè¯åŠŸèƒ½" class="headerlink" title="éªŒè¯åŠŸèƒ½"></a>éªŒè¯åŠŸèƒ½</h2><p>åˆ‡æ¢Redisåå†éªŒè¯ä¸€ä¸‹ä¸šåŠ¡çš„æ ¸å¿ƒæµç¨‹ï¼ŒæˆåŠŸã€‚</p><h2 id="åŒç†è¿ç§»ç”Ÿäº§ç¯å¢ƒRedisæµç¨‹ä¸€è‡´"><a href="#åŒç†è¿ç§»ç”Ÿäº§ç¯å¢ƒRedisæµç¨‹ä¸€è‡´" class="headerlink" title="åŒç†è¿ç§»ç”Ÿäº§ç¯å¢ƒRedisæµç¨‹ä¸€è‡´"></a>åŒç†è¿ç§»ç”Ÿäº§ç¯å¢ƒRedisæµç¨‹ä¸€è‡´</h2><p>ç¬¬äºŒæ¬¡è¿ç§»é€Ÿåº¦æ›´å¿«äº†</p><h1 id="è‡³æ­¤ï¼ŒRedisè¿ç§»å®Œæˆã€‚"><a href="#è‡³æ­¤ï¼ŒRedisè¿ç§»å®Œæˆã€‚" class="headerlink" title="è‡³æ­¤ï¼ŒRedisè¿ç§»å®Œæˆã€‚"></a>è‡³æ­¤ï¼ŒRedisè¿ç§»å®Œæˆã€‚</h1><p>è¿ç§»åï¼ŒèŠ‚çœè´¹ç”¨ä¸º</p><p>106.76ç¾é‡‘/æœˆ*2 å°=213.5ç¾é‡‘/æœˆ</p><p>æ¯ä¸ªæœˆå›ºå®šå‡å°‘213.5ç¾é‡‘ï¼Œè€Œä¸”ä¸ç”¨æ‹…å¿ƒæ•°æ®ä¸¢å¤±ï¼Œå¤‡ä»½ç­‰é—®é¢˜</p><p>åˆç†åˆ©ç”¨èµ„æºï¼Œæ‹¥æŠ¤æ˜å¤©â€”â€”â€”â€”SRE</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/GettingStarted.html" target="_blank" rel="noopener">Amazon ElastiCache for Rediså…¥é—¨</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> AWS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWS </tag>
            
            <tag> ElastiCache </tag>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysqlè¿äº‘é—®é¢˜æ€»ç»“</title>
      <link href="/2020/09/14/bug/mysql-migrate-rds/"/>
      <url>/2020/09/14/bug/mysql-migrate-rds/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬äºŒå®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨è‡ªå»ºMysqlè¿ç§»åˆ°RDSçš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°ä¸€äº›é—®é¢˜ï¼Œæœ¬æ–‡æ€»ç»“ä¸€ä¸‹ã€‚</p><h1 id="é—®é¢˜ä¸€ï¼šerrorCode-1045-state-28000"><a href="#é—®é¢˜ä¸€ï¼šerrorCode-1045-state-28000" class="headerlink" title="é—®é¢˜ä¸€ï¼šerrorCode 1045,state 28000"></a>é—®é¢˜ä¸€ï¼šerrorCode 1045,state 28000</h1><p>è¿™ä¸ªæ˜¯åœ¨åˆšåˆšè¿ç§»å®ŒRDSåï¼Œé¡¹ç›®è¿æ¥æŠ¥é”™ã€‚</p><p>springbooté›†æˆdruidç™»é™†mysqlå‘ç”ŸerrorCode 1045, state 28000é”™è¯¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java.log</span><br><span class="line"></span><br><span class="line">errorCode 1045,state 28000 java sql.SQLException:Access denied for user &#39;root&#39;@&#39;192.168.1.1&#39;</span><br></pre></td></tr></table></figure><p>æ‰¾äº†å¤§æ¦‚2ä¸ªå°æ—¶ï¼Œæ‰å‘ç°Mysqlçš„é¡¹ç›®è¿æ¥å¯†ç ä¸å¯¹ã€‚</p><p>å¥½å§ï¼Œä¹‹å‰åŒäº‹ç»™æˆ‘çš„æ–‡æ¡£æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒè´¦å·å¯†ç æåäº†</p><p>googleä¸€ä¸‹è¿™ç§é—®é¢˜å‡ºç°é¢‘ç‡æœ€é«˜çš„2ç§åŸå› </p><ul><li>mysqlç”¨æˆ·å¯†ç é”™è¯¯</li><li>mysqlç”¨æˆ·æƒé™</li></ul><p>æ ¹æœ¬åŸå› è¿˜æ˜¯å¯†ç é”™è¯¯</p><p>ä¸‹æ¬¡å†å‡ºç°è¿™ä¸ªé—®é¢˜ç›´æ¥æœ¬æœºè¿è´¦å·å¯†ç ï¼Œä¸è¡Œå°±æ”¹å¯†ç </p><h1 id="é—®é¢˜äºŒï¼šHost-is-blocked-because-of-many-connection-errors-unblock-with-â€˜mysqladmin-flush-hostsâ€™"><a href="#é—®é¢˜äºŒï¼šHost-is-blocked-because-of-many-connection-errors-unblock-with-â€˜mysqladmin-flush-hostsâ€™" class="headerlink" title="é—®é¢˜äºŒï¼šHost is blocked because of many connection errors; unblock with â€˜mysqladmin flush-hostsâ€™"></a>é—®é¢˜äºŒï¼šHost is blocked because of many connection errors; unblock with â€˜mysqladmin flush-hostsâ€™</h1><p>å’Œä¸Šä¸ªé—®é¢˜æœ‰ç€ç´§å¯†å…³ç³»</p><p>ç”±äºä¸€å¼€å§‹é¡¹ç›®çš„å¯†ç é”™è¯¯å¯¼è‡´è¿™å°æœåŠ¡å™¨çš„IPé‡è¿å¾ˆå¤šæ¬¡ï¼Œæœ€åè¢«Mysqlæ‹’ç»è®¿é—®äº†</p><p>å®˜æ–¹è§£é‡Šï¼š<br>åŒä¸€ä¸ªipåœ¨çŸ­æ—¶é—´å†…äº§ç”Ÿå¤ªå¤šï¼ˆè¶…è¿‡mysqlæ•°æ®åº“max_connection_errorsçš„æœ€å¤§å€¼ï¼‰ä¸­æ–­çš„æ•°æ®åº“è¿æ¥è€Œå¯¼è‡´çš„é˜»å¡ï¼›</p><p>è§£å†³é—®é¢˜</p><h2 id="æé«˜å…è®¸çš„max-connection-errorsæ•°é‡ï¼ˆæ²»æ ‡ä¸æ²»æœ¬ï¼‰ï¼š"><a href="#æé«˜å…è®¸çš„max-connection-errorsæ•°é‡ï¼ˆæ²»æ ‡ä¸æ²»æœ¬ï¼‰ï¼š" class="headerlink" title="æé«˜å…è®¸çš„max_connection_errorsæ•°é‡ï¼ˆæ²»æ ‡ä¸æ²»æœ¬ï¼‰ï¼š"></a>æé«˜å…è®¸çš„max_connection_errorsæ•°é‡ï¼ˆæ²»æ ‡ä¸æ²»æœ¬ï¼‰ï¼š</h2><ul><li>è¿›å…¥Mysqlæ•°æ®åº“æŸ¥çœ‹max_connection_errorsï¼š </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%max_connection_errors%&#39;;</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹max_connection_errorsçš„æ•°é‡ä¸º1000ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global max_connect_errors &#x3D; 1000;</span><br></pre></td></tr></table></figure></li></ul><ul><li>æŸ¥çœ‹æ˜¯å¦ä¿®æ”¹æˆåŠŸï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%max_connection_errors%&#39;;</span><br></pre></td></tr></table></figure></li></ul><h2 id="ä½¿ç”¨mysqladmin-flush-hosts"><a href="#ä½¿ç”¨mysqladmin-flush-hosts" class="headerlink" title="ä½¿ç”¨mysqladmin flush-hosts"></a>ä½¿ç”¨mysqladmin flush-hosts</h2><p>å‘½ä»¤æ¸…ç†ä¸€ä¸‹hostsæ–‡ä»¶ï¼ˆä¸çŸ¥é“mysqladminåœ¨å“ªä¸ªç›®å½•ä¸‹å¯ä»¥ä½¿ç”¨å‘½ä»¤æŸ¥æ‰¾ï¼šwhereis mysqladminï¼‰ï¼›</p><p>åœ¨æŸ¥æ‰¾åˆ°çš„ç›®å½•ä¸‹ä½¿ç”¨å‘½ä»¤ä¿®æ”¹ï¼š/usr/bin/mysqladmin flush-hosts -h192.168.1.1 -P3306 -uroot -p;</p><p>å¤‡æ³¨ï¼š</p><p>å…¶ä¸­ç«¯å£å·ï¼Œç”¨æˆ·åï¼Œå¯†ç éƒ½å¯ä»¥æ ¹æ®éœ€è¦æ¥æ·»åŠ å’Œä¿®æ”¹ï¼›</p><p>é…ç½®æœ‰master/slaveä¸»ä»æ•°æ®åº“çš„è¦æŠŠä¸»åº“å’Œä»åº“éƒ½ä¿®æ”¹ä¸€éçš„</p><p>ç¬¬äºŒæ­¥ä¹Ÿå¯ä»¥åœ¨æ•°æ®åº“ä¸­è¿›è¡Œï¼Œå‘½ä»¤å¦‚ä¸‹ï¼šflush hosts;ã€€ã€€ã€€ã€€</p><p>æˆ‘ç”¨çš„æ˜¯flush hosts</p><h1 id="é—®é¢˜ä¸‰ï¼šåˆæ˜¯æ•°æ®å¯¼å…¥çš„é—®é¢˜"><a href="#é—®é¢˜ä¸‰ï¼šåˆæ˜¯æ•°æ®å¯¼å…¥çš„é—®é¢˜" class="headerlink" title="é—®é¢˜ä¸‰ï¼šåˆæ˜¯æ•°æ®å¯¼å…¥çš„é—®é¢˜"></a>é—®é¢˜ä¸‰ï¼šåˆæ˜¯æ•°æ®å¯¼å…¥çš„é—®é¢˜</h1><p>ä¹‹å‰æˆ‘æœ‰ç¯‡æ–‡ç« åˆ†æäº†å¯¼å…¥å¤§é‡æ•°æ®çš„é—®é¢˜ï¼Œè¿™æ¬¡åˆè¸©åˆ°ä¸Šæ¬¡æ²¡è¸©åˆ°çš„å‘äº†ã€‚</p><h2 id="èœœæ±æ“ä½œï¼šnavicat"><a href="#èœœæ±æ“ä½œï¼šnavicat" class="headerlink" title="èœœæ±æ“ä½œï¼šnavicat"></a>èœœæ±æ“ä½œï¼šnavicat</h2><p>navicatçš„åœ¨çº¿åŒæ­¥å·¥å…·çœŸçš„åƒåœ¾</p><p>å¯¼æ•°æ®çœŸçš„æ…¢ï¼Œå†ç”¨ç æ‰‹ã€‚</p><p>å¯¼äº†åŠä¸ªå°æ—¶ï¼Œå¤§æ¦‚260wæ¡æ•°æ®çš„æ—¶å€™ï¼Œçªç„¶å‡æ­»ä¸€ä¸‹ï¼ˆæˆ‘äººç›´æ¥æ°”å‚»äº†ï¼‰</p><p>è€Œä¸”å¯¼å…¥çš„è¿›ç¨‹ä¸­æ–­äº†è¿˜æ²¡ç”¨ï¼Œè¿˜åœ¨ç»§ç»­æ‰§è¡Œã€‚</p><p>æ²¡åŠæ³•æˆ‘åªèƒ½åˆ åº“è·‘è·¯äº†ï¼Œå†å»ºä¸€ä¸ªRDS</p><h2 id="mysqldumpå¯¼å‡º"><a href="#mysqldumpå¯¼å‡º" class="headerlink" title="mysqldumpå¯¼å‡º"></a>mysqldumpå¯¼å‡º</h2><p>å¯¼å‡ºæ—¶è­¦å‘Šäº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p userdb &gt; userdb.sql</span><br><span class="line">Warning: A partial dump from a server that has GTIDs will by default include the GTIDs of all transactions, even those that changed suppressed parts of the database. If you don&#39;t want to restore GTIDs, pass --set-gtid-purged&#x3D;OFF. To make a complete dump, pass --all-databases --triggers --routines --events</span><br></pre></td></tr></table></figure><p>googleæŸ¥çœ‹åŸå› </p><p>mysqlæç¤º: å½“å‰æ•°æ®åº“å®ä¾‹ä¸­å¼€å¯äº† GTID åŠŸèƒ½, åœ¨å¼€å¯æœ‰ GTID åŠŸèƒ½çš„æ•°æ®åº“å®ä¾‹ä¸­, å¯¼å‡ºå…¶ä¸­ä»»ä½•ä¸€ä¸ªåº“, å¦‚æœæ²¡æœ‰æ˜¾ç¤ºåœ°æŒ‡å®šâ€“set-gtid-purgedå‚æ•°, éƒ½ä¼šæç¤ºè¿™ä¸€è¡Œä¿¡æ¯. æ„æ€æ˜¯é»˜è®¤æƒ…å†µä¸‹, å¯¼å‡ºçš„åº“ä¸­å«æœ‰ GTID ä¿¡æ¯ã€‚</p><p>å¯¼å…¥çš„æ—¶å€™ä¹Ÿåˆ†ä¸¤ç§, ä¸€ç§æ˜¯å¯¼å…¥å¸¦æœ‰ GTID çš„ä¿¡æ¯çš„åº“, ä¸€ç§æ˜¯å¯¼å…¥ä¸å¸¦æœ‰ GTID ä¿¡æ¯çš„åº“</p><ul><li>ä¸å¸¦æœ‰ GTID ä¿¡æ¯</li></ul><p>ä¸å¸¦æœ‰ GTID ä¿¡æ¯çš„ dump æ–‡ä»¶, ä¸ç®¡ç›®æ ‡æ•°æ®åº“å®ä¾‹æ˜¯å¦å¼€å¯äº† GTID åŠŸèƒ½, ä¸”ä¸ç®¡æ•°æ®åº“å®ä¾‹æ˜¯å¦å·²æœ‰å…¶ä»– GTID ä¿¡æ¯, éƒ½å¯ä»¥é¡ºåˆ©å¯¼å…¥</p><ul><li>å¸¦æœ‰ GTID ä¿¡æ¯æ—¶</li></ul><p>å¸¦æœ‰ GTID ä¿¡æ¯çš„ dump æ–‡ä»¶, è¦æ±‚ç›®æ ‡æ•°æ®åº“å®ä¾‹å¿…é¡»å¼€å¯ GTID åŠŸèƒ½, ä¸”å½“å‰æ•°æ®åº“ä¸­æ— å…¶ä»– GTID ä¿¡æ¯. å¦‚æœç›®æ ‡æ•°æ®åº“ä¸­å·²ç»è®°å½•äº†ä¸€æ¡æˆ–ä¸€æ¡ä»¥ä¸Šçš„ GTID ä¿¡æ¯, é‚£ä¹ˆåœ¨å¯¼å…¥æ•°æ®åº“æ—¶ä¼šæŠ¥å‡ºç±»ä¼¼å¦‚ä¸‹çš„é”™è¯¯âŒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p userdb &lt; userdb.sql</span><br><span class="line">Password:xxxxxxxx</span><br><span class="line">ERROR 1840 (HY000) at line 24: @@GLOBAL.GTID_PURGED can only be set when @@GLOBAL.GTID_EXECUTED is empty.</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•</p><ul><li>é‡æ–° dump æ•°æ®åº“, ä½¿ç”¨â€“set-gtid-purged=OFFçš„å‚æ•°ç¦æ­¢ğŸš«å¯¼å‡º GTID ä¿¡æ¯,å† load è¿›ç›®æ ‡æ•°æ®åº“</li><li>åœ¨ç›®æ ‡æ•°æ®åº“ä¸­æ‰§è¡Œmysql&gt; reset slave all; mysql&gt; reset master; æ¸…ç©ºæ‰€æœ‰ GTID ä¿¡æ¯ä¹‹åå°±å¯ä»¥å¯¼å…¥äº†</li></ul><p>æˆ‘æ˜¯ç”¨çš„ç¬¬ä¸€ç§æ–¹å¼</p><p>å³ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p --set-gtid-purged&#x3D;OFF  userdb &gt; userdb.sql</span><br></pre></td></tr></table></figure><h2 id="mysqlå¯¼å…¥"><a href="#mysqlå¯¼å…¥" class="headerlink" title="mysqlå¯¼å…¥"></a>mysqlå¯¼å…¥</h2><p>mysqldumpç¡®å®å¿«ï¼Œä¸è¿‡ä¸­é—´é‡åˆ°ä¸€ä¸ªé—®é¢˜</p><p>åœ¨æ•°æ®å³å°†å¯¼å®Œçš„æ—¶å€™æŠ¥é”™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ERROR 2006 (HY000): MySQL server has gone away</span><br><span class="line"></span><br><span class="line">ERROR 1231 (42000): Variable &#39;time_zone&#39; can&#39;t be set to the value of &#39;NULL&#39;</span><br><span class="line">ERROR 1231 (42000): Variable &#39;sql_mode&#39; can&#39;t be set to the value of &#39;NULL&#39;</span><br><span class="line">ERROR 1231 (42000): Variable &#39;foreign_key_checks&#39; can&#39;t be set to the value of &#39;NULL&#39;</span><br><span class="line">ERROR 1231 (42000): Variable &#39;unique_checks&#39; can&#39;t be set to the value of &#39;NULL&#39;</span><br><span class="line">ERROR 1231 (42000): Variable &#39;character_set_client&#39; can&#39;t be set to the value of &#39;NULL&#39;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">ERROR 1231 (42000): Variable &#39;collation_connection&#39; can&#39;t be set to the value of &#39;NULL&#39;</span><br><span class="line">ERROR 1231 (42000): Variable &#39;sql_notes&#39; can&#39;t be set to the value of &#39;NULL&#39;</span><br></pre></td></tr></table></figure><p>googleäº†ä¸€ä¸‹å‘ç°</p><p>Mysqlçš„å‚æ•°max_allowed_packeté»˜è®¤æ˜¯4M</p><p>è¿™ä¸ªå‚æ•°å¯ä»¥ä½¿clientç«¯åˆ°serverç«¯ä¼ é€’å¤§æ•°æ®æ—¶ï¼Œç³»ç»Ÿèƒ½å¤Ÿåˆ†é…æ›´å¤šçš„æ‰©å±•å†…å­˜æ¥å¤„ç†ã€‚</p><p>æ ¹æ®ç½‘ä¸Šçš„å¤„ç†å»ºè®®æˆ‘è®¾ç½®ä¸ºäº†256M</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set global max_allowed_packet&#x3D;268435456;</span><br><span class="line"></span><br><span class="line">ERROR 1419 (HY000): You do not have the SUPER Privilege  and Binary  Logging is  Enabled</span><br></pre></td></tr></table></figure><p>æˆ‘å¿ƒæ€å´©äº†ï¼Œæ‰“å¼€ç”¨æˆ·æƒé™åˆå‘ç°AWSçš„RDSæ²¡æœ‰ç»™ä½ Superæƒé™</p><p>è¿™æ˜¯ä¸ªæ¯›çš„ä¸»è´¦å·å•Šï¼Œç³»ç»Ÿçš„å‚æ•°éƒ½ä¸èƒ½æ”¹</p><p>æ²¡åŠæ³•ï¼Œæˆ‘åˆåªèƒ½åœ¨æ§åˆ¶å°æ”¹RDSçš„å‚æ•°ç»„</p><p>æŠ˜è…¾äº†å¥½ä¹…å</p><p>é‡æ–°å¯¼å…¥æ•°æ®</p><p>æ²¡æœ‰æŠ¥é”™ï¼Œæœ€åå®Œæˆæœ¬æ¬¡è¿ç§»å·¥ä½œ</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å…³äºæ•°æ®åº“æ–¹é¢çš„æˆ‘åªèƒ½è¯´ï¼Œå³ä½¿è¿™ä¹ˆéº»çƒ¦ï¼Œæœªæ¥çš„ä¸»æµè¶‹åŠ¿è‚¯å®šè¿˜æ˜¯ä¸Šäº‘ï¼Œä¸ç„¶çº¿ä¸‹ç»´æŠ¤è¿™äº›é—®é¢˜ä¸è¯·ä¸“ä¸šçš„DBAæä¸å®šã€‚</p><p>ä¸Šäº‘åï¼Œåƒæˆ‘è¿™æ ·çš„å°èœé¸¡ä¹Ÿèƒ½è½»æ¾è¿ç»´å•¦ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://stackoverflow.com/questions/43842396/mysql-error-variable-collation-connection-cant-be-set-to-the-value-of-null" target="_blank" rel="noopener">MySQL error : Variable â€˜collation_connectionâ€™ canâ€™t be set to the value of â€˜NULLâ€™ when dump .sql file</a></p><p><a href="https://my.oschina.net/u/1249401/blog/820277" target="_blank" rel="noopener">MySql Host is blocked because of many connection errors; unblock with â€˜mysqladmin flush-hostsâ€™ </a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> AWS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWS </tag>
            
            <tag> RDS </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ªäººæ€»ç»“(2020.8)</title>
      <link href="/2020/09/11/summary/summary-2020-8/"/>
      <url>/2020/09/11/summary/summary-2020-8/</url>
      
        <content type="html"><![CDATA[<h1 id="æ„Ÿæ…¨"><a href="#æ„Ÿæ…¨" class="headerlink" title="æ„Ÿæ…¨"></a>æ„Ÿæ…¨</h1><p>èµšé’±ä¸æ˜“</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿›å…¥å…¬å¸çš„ç¬¬ä¸€ä¸ªæœˆï¼Œæˆ‘çš„å¿ƒæ€æ€æƒ³åˆæœ‰äº†å¾ˆå¤§çš„å˜åŒ–</p><h2 id="æ€æƒ³"><a href="#æ€æƒ³" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h2><p>è¿›å…¥å…¬å¸çš„ç¬¬ä¸€ä¸ªæ˜ŸæœŸï¼Œå°±æœ‰äº†æƒ³ç¦»å¼€çš„æ‰“ç®—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><p>å…¬å¸äººä¸å¤šï¼Œè¿ç»´å°±åªæœ‰æˆ‘ä¸€ä¸ªäººï¼Œæ¶æ„æ¯”è¾ƒæ—§ï¼Œéšä¾¿ä¸¾å‡ ä¸ªä¾‹å­ï¼Œä»£ç çš„é…ç½®æ–‡ä»¶æ²¡æœ‰æ‹¿å‡ºæ¥ï¼Œæ¯æ¬¡ä¿®æ”¹é…ç½®æ–‡ä»¶éƒ½å¾—é‡æ–°æ‰“åŒ…ï¼Œæœ¬åœ°æ²¡æœ‰DNSæœåŠ¡å™¨ï¼Œç½‘ç»œæ¶æ„æ··ä¹±ï¼Œå‡ ä¹æ²¡æœ‰DockeråŒ–çš„é¡¹ç›®ï¼Œå…¨éƒ¨ç‰©ç†æœºéƒ¨ç½²ï¼Œå„ç§ä¸­é—´ä»¶æ··åˆå’Œé¡¹ç›®å…±ç”¨ï¼ŒSSLè¯ä¹¦ä¹±ä¸ƒå…«ç³Ÿï¼Œå‡ ä¹æ¯å°æœåŠ¡å™¨éƒ½å­˜åœ¨ä¸€ä¸ªNginxæœåŠ¡å™¨ï¼Œå¯†é’¥ç®¡ç†ä¹Ÿä¸å…¨ï¼Œäººäººéƒ½å¯ä»¥ç›´è¿ç”Ÿäº§æœåŠ¡å™¨ï¼Œæ²¡æœ‰å¼€å‘ç¯å¢ƒï¼Œæµç¨‹ç®¡ç†å¾ˆä¹±ç­‰ç­‰ç­‰ç­‰</p><p>æˆ‘æ„Ÿè§‰å°±æ˜¯ä¸€ä¸ªå¤§çƒ‚æ‘Šå­ç­‰ç€æˆ‘æ”¶æ‹¾</p><p>ä½†å’Œå‰é¢†å¯¼ä¸€ç•ªæ²Ÿé€šåï¼Œä»–é¼“åŠ±æˆ‘ï¼Œå…¬å¸èŠ±æ›´å¤šé’±æ˜¯è®©ä½ è§£å†³è¿™äº›é—®é¢˜çš„ï¼Œè¦æ˜¯æ²¡æœ‰è¿™ä¹ˆå¤šé—®é¢˜ï¼Œè®©ä½ æ¥å¹²å˜›ï¼Ÿæˆ‘æƒ³æƒ³ä¹Ÿæ˜¯ã€‚é¢†å¯¼ç»§ç»­è¯´ï¼Œè¿™æ­£æ˜¯ä¸€ä¸ªæœºä¼šï¼Œè¯æ˜ä½ ç¡®å®æœ‰èƒ½åŠ›ç‹¬å½“ä¸€é¢çš„æœºä¼šï¼Œä½ åº”è¯¥çæƒœã€‚</p><p>ç¡®å®ï¼Œåœ¨å‡ ä¸ªofferé¢å‰æˆ‘é€‰æ‹©è¿™å®¶ä¸ä»…ä»…æ˜¯å› ä¸ºå·¥èµ„é«˜ï¼Œè¿˜æœ‰ä¸€ç‚¹æ˜¯åˆ›ä¸šå‹å…¬å¸æ²¡æœ‰å¤§å…¬å¸é‚£ä¹ˆå¤šç¹æ–‡ç¼›èŠ‚ã€‚</p><p>æˆ‘å¸Œæœ›ä¿æŒæŠ€æœ¯çš„çº¯ç²¹æ€§ï¼Œé‚£ä¹ˆè¿˜æ‹…å¿ƒè¿™ä¹ˆå¤šçš„é—®é¢˜æ²¡æ³•è§£å†³ä¹ˆï¼Ÿ</p><h2 id="æŠ€æœ¯"><a href="#æŠ€æœ¯" class="headerlink" title="æŠ€æœ¯"></a>æŠ€æœ¯</h2><p>æˆ‘å†³å®šå¥½å¥½è¯æ˜æˆ‘çš„ä»·å€¼äº†ï¼Œç¬¬ä¸€ä¸ªæ˜ŸæœŸæˆ‘å°±æå‡ºäº†è‡ªåŠ¨åŒ–æµæ°´çº¿çš„æ„å»ºï¼Œä»¥åŠDockeråŒ–æ‰€æœ‰é¡¹ç›®ï¼Œè‡³ä»Šä¸ºæ­¢ï¼Œæˆ‘å·²ç»åšå®Œäº†è¿™2ä¸ªå†…å®¹ã€‚</p><p>ç†Ÿæ‚‰AWSæ˜¯ä¸€ä»¶å¾ˆä¸å®¹æ˜“çš„è¿‡ç¨‹ï¼Œæ¯•ç«ŸAWSæ˜¯é¢å‘ä¸–ç•Œçš„äº‘å¹³å°ï¼Œè€Œé˜¿é‡Œäº‘ä»…ä»…åªæ˜¯å›½å†…çš„å¤§å“¥ï¼Œæˆ–è€…è¯´å¤ªç¬¦åˆå›½äººçš„æ“ä½œé£æ ¼äº†ï¼Œç”¨èµ·æ¥æ‰å¾—å¿ƒåº”æ‰‹ã€‚</p><p>ä¸€ä¸ªæœˆçš„æ—¶é—´å·®ä¸å¤šæŠŠAWSåŸºç¡€ç»„ä»¶ç†Ÿæ‚‰å®Œäº†ï¼Œå¯ä»¥åœ¨äº‘ä¸Šè¿ç»´éƒ¨åˆ†ç»„ä»¶ã€‚</p><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘åŸºäºå…¬å¸çš„ä¸šåŠ¡ï¼Œå¤§èƒ†çš„ç äº†4å°æ²¡æœ‰å¿…è¦çš„æœåŠ¡å™¨ã€‚æˆ‘æ— æ³•æƒ³è±¡ä¹‹å‰çš„è¿ç»´æ˜¯æ€ä¹ˆç®¡ç†äº‘æœåŠ¡å™¨çš„ï¼Œ4å°å®Œå…¨å·²ç»ææµ…çš„æœåŠ¡å™¨ï¼Œä»»ç”±AWSæ”¶å‰²è´¹ç”¨ï¼Œè€æ¿éƒ½ä¸å¿ƒç–¼ã€‚</p><p>ç¼©å‡åï¼Œç»™å…¬å¸çœä¸‹çš„1000ç¾é‡‘/æœˆçš„æ°¸ä¹…æ”¯å‡º</p><p>ä¸‹ä¸ªæœˆå‡†å¤‡å¾€AWSçš„EKSï¼ˆæ‰˜ç®¡å‹K8S)å‘å±•ï¼Œç„¶åæ•°æ®åº“ä¸ŠRDSï¼Œå¢åŠ SLBï¼Œå°†è‡ªå»ºçš„æœåŠ¡å…¨éƒ½ç”¨å…¬æœ‰äº‘ç»„ä»¶ï¼Œäº‘ä¸Šåªéƒ¨ç½²è‡ªå·±çš„ä¸šåŠ¡ä»£ç å³å¯ã€‚</p><h2 id="æ ¼å±€"><a href="#æ ¼å±€" class="headerlink" title="æ ¼å±€"></a>æ ¼å±€</h2><p>æ¥æ·±åœ³ä¸€ä¸ªæœˆï¼Œæƒ³çš„å¤ªå¤šäº†ï¼Œå¤§åŸå¸‚çœŸå®è¯±æƒ‘æ— é™ã€‚</p><p>30å²ä¹‹å‰é è‡ªå·±æ”’åˆ°100Wç„¶åå›æ­¦æ±‰ä¹°æˆ¿ç»“å©šçš„æƒ³æ³•ç®€ç›´å¤ªlowäº†ã€‚ç¡®å®ï¼Œæˆ‘åœ¨ä»Šå¹´6æœˆä¹‹å‰è¿˜æœ‰ç‚¹ä¸æ•¢æƒ³æŠŠè¿™ä¸ªç›®æ ‡å®šä¸ºæˆ‘çš„é•¿æœŸç›®æ ‡ã€‚</p><p>å› ä¸ºæˆ‘ç°åœ¨å·²ç»23äº†ï¼Œè¿˜æœ‰7å¹´ï¼Œä¸€å¹´æ”’14wå¤šï¼Œä½ å¾—ä¸€å¹´æ”¶å…¥å¤šå°‘ï¼Ÿæœˆè–ªèµ·ç å¾—2w+å§ï¼Œè™½ç„¶ä½ çš„å·¥èµ„ä¼šè¶Šæ¥è¶Šé«˜ï¼Œä½†æ˜¯æ”’é’±çœŸæ˜¯ä¸€ä¸ªéš¾äº‹ã€‚</p><p>ç„¶ååˆç»è¿‡é«˜äººæŒ‡ç‚¹äº†ç°åœ¨ä¸­å›½çš„ç¤¾ä¼šé˜¶å±‚ï¼Œæˆ‘æ‰äº†è§£åˆ°ï¼Œç¡®å®å¦‚ä»–æ‰€è¯´ï¼Œåœ¨ä¸­å›½ï¼Œè¦ä¹ˆæˆä¸ºè¢«å‰¥å‰Šè€…ï¼Œè¦ä¹ˆå°±æ˜¯åœ¨æˆä¸ºå‰¥å‰Šè€…çš„è·¯ä¸Šã€‚</p><p>çœŸæ­£çš„èµ„æœ¬å®¶åªä¼šæŠŠ996å½“ä½œç¦æŠ¥æ¥åƒæ´—è„‘ä¸€æ ·å‘Šè¯‰ä½ ï¼Œæˆ‘çªç„¶åœ¨æƒ³ä¸ºä»€ä¹ˆè¦æ‹¼å‘½å·¥ä½œï¼Œä¸å°±æ˜¯ä¸ºäº†å°†æ¥ï¼Œæ´»å¾—æœ‰ç‚¹å°Šä¸¥å—ï¼Ÿä¸ä¼šå†ä¸ºäº†ç©·ï¼Œè€Œä¸èƒ½åšè¿™ä¸èƒ½åšé‚£ã€‚</p><p>ç¡®å®ï¼Œç©·å°±æ˜¯åŸç½ªï¼Œå¯å¯Œäººéƒ½ä¼šè¯´ï¼Œæˆ‘å¯¹é’±æ²¡æœ‰å…´è¶£ï¼Œé’±å°±æ˜¯ç‹å…«è›‹ã€‚ç¡®å®åˆ°äº†é‚£ç§é˜¶å±‚çš„äººï¼Œé’±å¯¹ä»–ä»¬æ¥è¯´æ„ä¹‰å·²ç»ä¸å¤§äº†ï¼Œæ€ä¹ˆå®ç°è‡ªå·±çš„ä»·å€¼ï¼Œç•™ä¸‹ä¸€ä¸ªå¾ˆå¥½çš„åå£°æ‰æ˜¯æœ€é‡è¦çš„</p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘çš„ç›®æ ‡æ”¹å˜äº†</p><p>3å¹´å†…ï¼Œæˆ‘ç«­å°½æ‰€èƒ½ä¸ºèµ„æœ¬å®¶èµšé’±</p><p>6å¹´å†…ï¼Œæˆ‘èƒ½å¤Ÿè½¬å˜æˆä¸ºè‡ªå·±èµšé’±</p><p>9å¹´ç”šè‡³æ›´ä¹…åï¼Œæˆ‘ä¹Ÿè¦æˆä¸ºèµ„æœ¬å®¶ï¼Œè®©åˆ«äººä¸ºæˆ‘èµšé’±</p><h1 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>8æœˆæ˜¯æˆ‘å…¥èŒçš„ç¬¬ä¸€ä¸ªæœˆï¼Œæˆ‘ä»å¼€å§‹çš„æƒ³ç¦»å¼€è½¬å˜ä¸ºè¦å¤§å±•æ‹³è„šè¯æ˜è‡ªå·±ã€‚åŒäº‹ä»¬éƒ½ç‰¹åˆ«çƒ­æƒ…ï¼Œæˆ‘ä¹Ÿè§‰å¾—æ²¡æœ‰å›°éš¾èƒ½é˜»æŒ¡ä¸€ä¸ªçƒ­è¡€çš„å›¢é˜Ÿï¼Œä¸ºæ­¤æˆ‘è¿™ä¸ªæœˆå°±åŒ…å¤œ3æ¬¡ï¼ŒåŠ ç­å¹²ï¼Œå¸®åŠ©å›¢é˜Ÿè§£å†³ä¸€äº›è¿ç»´ä¸Šçš„å›°éš¾ï¼Œæˆ‘å¾ˆæœ‰æˆå°±æ„Ÿã€‚</p><p>å·¥ä½œä¸Šæˆ‘è¦å‘æŒ¥å‡ºè‡ªå·±æœ€å¤§çš„åŠªåŠ›ï¼Œåšå¥½æ¯ä¸€ä»¶äº‹æƒ…ï¼Œæ”¹å–„ï¼Œæ”¹å–„ï¼Œå†æ”¹å–„ï¼Œæ°¸è¿œä¸è¦è®©è‡ªå·±æ»¡æ„â€”â€”SRE</p><p>é™¤äº†æŠ€æœ¯æˆ‘å¼€å§‹åœ¨æƒ³æ€ä¹ˆå®ç°æˆ‘çš„æ–°ç›®æ ‡ï¼šå¦‚ä½•æˆä¸ºèµ„æœ¬å®¶ï¼Ÿè¿™æ˜¯ä¸€ä¸ªå¥½é—®é¢˜ï¼Œç›®å‰å¹¶æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ–¹å‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ä¸ªäººæ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¸ªäººæ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿ç§»è‡ªå»ºMysqlè‡³AWSçš„RDS</title>
      <link href="/2020/09/11/aws/aws-rds-migrate/"/>
      <url>/2020/09/11/aws/aws-rds-migrate/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬äºŒå®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>éšç€å…¬å¸ä¸šåŠ¡çš„å¢å¤§ï¼Œè‡ªå»ºMysqlé£é™©è¶Šæ¥è¶Šé«˜ï¼Œè¿ç»´æˆæœ¬ä¹Ÿè¶Šæ¥è¶Šå¤§ï¼ˆæ•°æ®åº“ç›‘æ§ã€å¤‡ä»½ã€è¿ç§»ç­‰ï¼‰ã€‚æœåŠ¡ä¸Šäº‘æ˜¯æ•´ä¸ªäº’è”ç½‘ä¼ä¸šçš„è¶‹åŠ¿ï¼Œç”±äºAWSå’Œé˜¿é‡Œäº‘çš„RDSè¿˜æ˜¯æœ‰ä¸€å®šåŒºåˆ«çš„ï¼Œä¸‹é¢å¼€å§‹è®°å½•æˆ‘æ•´ä¸ªè¿äº‘è®¡åˆ’åŠéƒ¨ç½²çš„å®æ“è¿‡ç¨‹ã€‚</p><h1 id="ç°çŠ¶"><a href="#ç°çŠ¶" class="headerlink" title="ç°çŠ¶"></a>ç°çŠ¶</h1><p>ç›®å‰å…¬å¸è‡ªå»ºäº†2ä¸ªæ•°æ®åº“å®ä¾‹ï¼ˆ1ä¸ªæµ‹è¯•ã€1ä¸ªç”Ÿäº§ï¼‰</p><h2 id="èµ„æºè°ƒç ”"><a href="#èµ„æºè°ƒç ”" class="headerlink" title="èµ„æºè°ƒç ”"></a>èµ„æºè°ƒç ”</h2><p>é¦–å…ˆè°ƒå–ä¸€ä¸ªæœˆå†…æ•°æ®åº“èµ„æºç›‘æ§æŒ‡æ ‡</p><h3 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h3><p>æµ‹è¯•ç¯å¢ƒé…ç½®ï¼š2C 8G 500Gç£ç›˜ ec2ç±»å‹t2.large</p><p>æ”¶è´¹æ ‡å‡†ï¼š</p><ul><li>æœåŠ¡å™¨ ä¸€ä¸ªæœˆ744ä¸ªå°æ—¶ ä¸€å°æ—¶0.0928ç¾å…ƒ ä¸€ä¸ªæœˆåˆè®¡69ç¾é‡‘</li><li>ç£ç›˜   ä¸€ä¸ªæœˆæ¯G 0.1ç¾å…ƒ      ä¸€ä¸ªæœˆåˆè®¡50ç¾å…ƒ</li></ul><p>å¹³å‡ä¸€ä¸ªæœˆä½¿ç”¨ç‡</p><ul><li>å†…å­˜ å¹³å‡ä½¿ç”¨1.16G å³°å€¼1.24G ä½¿ç”¨ç‡14.5%</li><li>CPU  å¹³å‡ä½¿ç”¨0.012C å³°å€¼0.74C ä½¿ç”¨ç‡0.07%</li><li>IOPS å¹³å‡ä½¿ç”¨2 iops å³°å€¼57</li><li>ç»Ÿè®¡æ•°æ®åº“æ€»ç©ºé—´1.46G</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select (sum(data_length) + sum(index_length))&#x2F;1024&#x2F;1024&#x2F;1024  db_gbsize</span><br><span class="line">from information_schema.tables;</span><br><span class="line"></span><br><span class="line">db_gbsize</span><br><span class="line">1.467038034461</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿäº§ç¯å¢ƒ"><a href="#ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒ"></a>ç”Ÿäº§ç¯å¢ƒ</h3><p>ç”Ÿäº§ç¯å¢ƒé…ç½® 2C 8G 500Gç£ç›˜ ec2ç±»å‹t2.large</p><p>æ”¶è´¹æ ‡å‡†ï¼š</p><ul><li>æœåŠ¡å™¨ ä¸€ä¸ªæœˆ744ä¸ªå°æ—¶ ä¸€å°æ—¶0.0928ç¾å…ƒ ä¸€ä¸ªæœˆåˆè®¡69ç¾é‡‘</li><li>ç£ç›˜   ä¸€ä¸ªæœˆæ¯G 0.1ç¾å…ƒ      ä¸€ä¸ªæœˆåˆè®¡50ç¾å…ƒ</li></ul><p>å¹³å‡ä¸€ä¸ªæœˆä½¿ç”¨ç‡</p><ul><li>å†…å­˜ å¹³å‡ä½¿ç”¨1.7G å³°å€¼1.9G ä½¿ç”¨ç‡14.5%</li><li>CPU  å¹³å‡ä½¿ç”¨0.02C å³°å€¼0.2C ä½¿ç”¨ç‡0.1%</li><li>IOPS å¹³å‡ä½¿ç”¨5 iops å³°å€¼60</li><li>ç»Ÿè®¡æ•°æ®åº“æ€»ç©ºé—´3.15G</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select (sum(data_length) + sum(index_length))&#x2F;1024&#x2F;1024&#x2F;1024  db_gbsize</span><br><span class="line">from information_schema.tables;</span><br><span class="line"></span><br><span class="line">db_gbsize</span><br><span class="line">3.152370004915</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜¾ç„¶ï¼Œè‡ªå»ºçš„Mysqlæœºå™¨æ€§èƒ½è¿‡äºæµªè´¹ï¼Œå…¶ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„åŸå› å°±æ˜¯ç£ç›˜ä½¿ç”¨ç‡ç‡å¾ˆä½ï¼Œéƒ½å¿«èµ¶ä¸Šä¸€å°æœåŠ¡å™¨çš„ä»·æ ¼äº†ã€‚</p><p>æˆ‘ä»¬å†æ¥å¯¹æ¯”ä¸€ä¸‹RDSçš„ä»·æ ¼</p><h2 id="RDSæ”¶è´¹"><a href="#RDSæ”¶è´¹" class="headerlink" title="RDSæ”¶è´¹"></a>RDSæ”¶è´¹</h2><p>2c 8g 500G SSD IOPSæœ€å¤§1000  æœºå™¨å‹å· db.m4.large </p><p>æ•°æ®åº“å®ä¾‹<br>127.75 USD/æœˆ</p><p>å­˜å‚¨<br>57.50 USD/æœˆ</p><p>æ€»è®¡<br>185.25 USD/æœˆ</p><p>1c 2g 20G SSD IOPS 60 æœºå™¨å‹å· db.t2.small</p><p>æ•°æ®åº“å®ä¾‹<br>24.82 USD/æœˆ</p><p>å­˜å‚¨<br>2.30 USD/æœˆ</p><p>æ€»è®¡<br>27.12 USD/æœˆ</p><h2 id="å¯¹æ¯”ç»“è®º"><a href="#å¯¹æ¯”ç»“è®º" class="headerlink" title="å¯¹æ¯”ç»“è®º"></a>å¯¹æ¯”ç»“è®º</h2><p>åŒç±»å‹ec2è‡ªå»ºmysqlçš„ä»·æ ¼æ˜¯æ¯”RDSä¾¿å®œçš„ï¼Œä½†æ˜¯RDSçš„å¥½å¤„åœ¨äºï¼š</p><ul><li>è‡ªåŠ¨æ‰©å®¹ç£ç›˜</li><li>Mysqlè°ƒä¼˜</li><li>å¯çªå¢CPUã€IOPSä¸´æ—¶å¤§å°</li><li>è‡ªåŠ¨å¤‡ä»½</li><li>å¤šåœ°éƒ¨ç½²</li><li>è¿ç»´ç®€å•ï¼ˆåªç”¨æ§åˆ¶å°è¿ç»´å³å¯ï¼‰</li><li>ç›‘æ§</li></ul><p>è€Œè¿™æ¬¡æˆ‘é€šè¿‡ç°åœ¨çš„Mysqlèµ„æºä½¿ç”¨ç‡é€‰å‹RDSä¸ºä»¥ä¸‹é…ç½®</p><p>1c 2g 20G SSD IOPS 60 æœºå™¨å‹å· db.t2.small </p><h1 id="è¿ç§»"><a href="#è¿ç§»" class="headerlink" title="è¿ç§»"></a>è¿ç§»</h1><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><ul><li>æ¢³ç†ç°æœ‰DBã€ç”¨æˆ·ã€å®‰å…¨ç»„</li><li>Mysqldumpå…¨åº“æ•°æ®</li></ul><p>å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“çš„ç»“æ„ä»¥åŠæ•°æ®</p><p>mysqldump dbname -uroot -p &gt; dbname.sql</p><p>å¯¼å‡ºå¤šä¸ªæ•°æ®åº“çš„ç»“æ„ä»¥åŠæ•°æ®</p><p>mysqldump -B dbname1 dbname2 -uroot -p &gt; dbname.sql</p><h2 id="åˆ›å»ºRDS"><a href="#åˆ›å»ºRDS" class="headerlink" title="åˆ›å»ºRDS"></a>åˆ›å»ºRDS</h2><p>ç‚¹å‡»RDSæ§åˆ¶å° &gt; åˆ›å»ºæ•°æ®åº“ &gt; é€‰æ‹©mysql &gt; ç‰ˆæœ¬é€‰æ‹©5.7.28 &gt; é€‰æ‹©ç”Ÿäº§æ¨¡æ¿ &gt; è®¾ç½®ä¸»ç”¨æˆ·(æœ€é«˜æƒé™ç”¨æˆ·ï¼Œè°¨æ…ä¿ç®¡) &gt; é€‰æ‹©å®ä¾‹ç±»å‹(å¯çªå¢å‹db.t2.small) &gt; é€‰æ‹©å¯ç”¨æ€§ä¸æŒä¹…æ€§(å¤šåŒºåŸŸéƒ¨ç½²) &gt; é€‰æ‹©å­ç½‘å’Œå®‰å…¨ç»„ &gt; é€‰æ‹©å¯†ç èº«ä»½éªŒè¯</p><p>åˆ›å»ºï¼</p><p>å¤§æ¦‚10åˆ†é’Ÿåå¯ä»¥ä½¿ç”¨</p><h2 id="åŒæ­¥æ•°æ®"><a href="#åŒæ­¥æ•°æ®" class="headerlink" title="åŒæ­¥æ•°æ®"></a>åŒæ­¥æ•°æ®</h2><p>åˆæ¥åˆ°äº†æˆ‘ä»¬çš„ä¸»è§’navicatï¼Œé€‰æ‹©navicatçš„å·¥å…·&gt;æ•°æ®åŒæ­¥&gt;é€‰æ‹©åº“è¡¨ï¼Œå¼€å§‹åŒæ­¥</p><p>å¤§çº¦è¿‡äº†12åˆ†é’Ÿæ‰åŒæ­¥å¥½ï¼Œä¸å¾—ä¸å¾—è¯´è¿˜æ˜¯æŒºæ…¢çš„ã€‚</p><p>å½“ç„¶æˆ‘ä¹Ÿç”¨MysqldumpåŒæ­¥äº†ï¼Œæ—¶é—´ä»…ä»…åªè¦3åˆ†é’Ÿã€‚</p><p>å·®è·ç«‹åˆ»æ‹‰å¼€ï¼Œå“ˆå“ˆ</p><h2 id="åˆ›å»ºç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·</h2><p>ç»™RDSåˆ›å»ºé¡¹ç›®è¿æ¥çš„ç”¨æˆ·å¹¶æˆæƒ</p><h2 id="æµ‹è¯•è‡ªåŠ¨åŒ–SQLå·¥å…·æ­£å¸¸"><a href="#æµ‹è¯•è‡ªåŠ¨åŒ–SQLå·¥å…·æ­£å¸¸" class="headerlink" title="æµ‹è¯•è‡ªåŠ¨åŒ–SQLå·¥å…·æ­£å¸¸"></a>æµ‹è¯•è‡ªåŠ¨åŒ–SQLå·¥å…·æ­£å¸¸</h2><p>dbmate  -s db/schema-prod.sql migrate</p><p>æˆåŠŸ</p><h2 id="è·¯ç”±åˆ‡æ¢"><a href="#è·¯ç”±åˆ‡æ¢" class="headerlink" title="è·¯ç”±åˆ‡æ¢"></a>è·¯ç”±åˆ‡æ¢</h2><p>å°†è€è·¯ç”±æ˜ å°„å…³ç³»æ›´æ–°åˆ°RDSçš„åŸŸåä¸Š</p><p>å³åœ¨DNS CNAMEé‡ŒæŒ‡å‘</p><p>æ¯”å¦‚ç°åœ¨çš„DNSæ˜¯<br>mysql.xxx.com &gt;&gt; 192.168.1.1</p><p>æˆ‘å°†å®ƒæ”¹ä¸º</p><p>mysql.xxx.com &gt;&gt; RDSçš„åŸŸå</p><p>ä¿å­˜è®¾ç½®</p><p>è¿‡ä¸€æ®µæ—¶é—´è§£æ</p><p>ping mysql.xxx.com å‘ç°å·²ç»æ›´æ–°æŒ‡å‘çš„åœ°å€ä¸ºRDS</p><h2 id="é‡å¯åº”ç”¨"><a href="#é‡å¯åº”ç”¨" class="headerlink" title="é‡å¯åº”ç”¨"></a>é‡å¯åº”ç”¨</h2><p>å› ä¸ºåº”ç”¨çš„è¿æ¥åœ°å€æ˜¯mysql.xxx.com</p><p>æ‰€ä»¥ç›´æ¥é‡å¯æœåŠ¡å³å¯</p><h2 id="éªŒè¯åŠŸèƒ½"><a href="#éªŒè¯åŠŸèƒ½" class="headerlink" title="éªŒè¯åŠŸèƒ½"></a>éªŒè¯åŠŸèƒ½</h2><p>åˆ‡æ¢RDSåå†éªŒè¯ä¸€ä¸‹ä¸šåŠ¡çš„æ ¸å¿ƒæµç¨‹ï¼ŒæˆåŠŸã€‚</p><h2 id="åŒç†è¿ç§»ç”Ÿäº§ç¯å¢ƒRDSæµç¨‹ä¸€è‡´"><a href="#åŒç†è¿ç§»ç”Ÿäº§ç¯å¢ƒRDSæµç¨‹ä¸€è‡´" class="headerlink" title="åŒç†è¿ç§»ç”Ÿäº§ç¯å¢ƒRDSæµç¨‹ä¸€è‡´"></a>åŒç†è¿ç§»ç”Ÿäº§ç¯å¢ƒRDSæµç¨‹ä¸€è‡´</h2><p>ç¬¬äºŒæ¬¡è¿ç§»é€Ÿåº¦æ›´å¿«äº†</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è‡³æ­¤ï¼ŒRDSè¿ç§»å®Œæˆã€‚</p><p>è¿ç§»åï¼ŒèŠ‚çœè´¹ç”¨ä¸º</p><p>90ç¾é‡‘/æœˆ*2 å°=180ç¾é‡‘/æœˆ</p><p>æ¯ä¸ªæœˆå›ºå®šå‡å°‘180ç¾é‡‘ï¼Œè€Œä¸”ä¸ç”¨æ‹…å¿ƒæ•°æ®ä¸¢å¤±ï¼Œå¤‡ä»½ç­‰é—®é¢˜</p><p>åˆç†åˆ©ç”¨èµ„æºï¼Œæ‹¥æŠ¤æ˜å¤©â€”â€”â€”â€”SRE</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_GettingStarted.html" target="_blank" rel="noopener">Amazon RDSå…¥é—¨</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> AWS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWS </tag>
            
            <tag> RDS </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿ç»´æ‰‹å†Œâ€”â€”Dockerfileçš„JDKç‰ˆæœ¬æ›´æ¢</title>
      <link href="/2020/09/05/bug/dockerfile-jdk-version/"/>
      <url>/2020/09/05/bug/dockerfile-jdk-version/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬äºŒå®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æœ€è¿‘åŒäº‹åé¦ˆé¡¹ç›®æŠ¥é”™ï¼ŒæŸ¥çœ‹æ—¥å¿—å‘ç°æˆ‘ç»™å…¬å¸é¡¹ç›®åšçš„Dockerfileçš„jdkç‰ˆæœ¬å‡ºç°é—®é¢˜ï¼Œå¯¼è‡´FontConfiguration.getVersionæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸</p><h1 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h1><p>åŸDockefile</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install -y java-1.8.0-openjdk</span><br><span class="line"></span><br><span class="line">è¿›å…¥å®¹å™¨åjava -versionçš„ç‰ˆæœ¬æ˜¯1.8.0_265</span><br><span class="line"></span><br><span class="line">root@b9907f6d3a04:&#x2F;# java -version</span><br><span class="line">openjdk version &quot;1.8.0_265&quot;</span><br><span class="line">OpenJDK Runtime Environment (AdoptOpenJDK)(build 1.8.0_265-b01)</span><br><span class="line">OpenJDK 64-Bit Server VM (AdoptOpenJDK)(build 25.265-b01, mixed mode)</span><br></pre></td></tr></table></figure><h1 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h1><h2 id="ä¸´æ—¶è§£å†³"><a href="#ä¸´æ—¶è§£å†³" class="headerlink" title="ä¸´æ—¶è§£å†³"></a>ä¸´æ—¶è§£å†³</h2><p>çœ‹äº†ä¸‹ç½‘ä¸Šçš„é—®é¢˜åˆ†æï¼Œå¤§éƒ¨åˆ†æ˜¯ç›´æ¥å®‰è£… fontconfigç»„ä»¶ï¼Œå³</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">centosç³»ç»Ÿä½¿ç”¨  yum install fontconfig</span><br><span class="line"></span><br><span class="line">debianç³»ç»Ÿä½¿ç”¨ apt-get install fontconfig</span><br></pre></td></tr></table></figure><p>æœªéªŒè¯</p><h2 id="æ°¸ä¹…è§£å†³"><a href="#æ°¸ä¹…è§£å†³" class="headerlink" title="æ°¸ä¹…è§£å†³"></a>æ°¸ä¹…è§£å†³</h2><p>ä¸ºäº†ä¿è¯å’Œå¼€å‘JDKç‰ˆæœ¬ä¸€è‡´</p><p>æˆ‘ä½¿ç”¨äº†å¼€å‘äººå‘˜çš„JDKå®‰è£…åŒ…ï¼Œè€Œä¸é‡‡ç”¨yumæˆ–aptç›´æ¥å®‰è£…</p><p>é‡åšDockerfile</p><p>å…ˆè‡ªå·±ä¸‹è½½jdk-8u201-linux-x64.tar.gz</p><p><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html#license-lightbox" target="_blank" rel="noopener">https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html#license-lightbox</a></p><p>é€‰æ‹©jdk-8u201-linux-x64.tar.gz</p><p>ä¸‹è½½åæ”¾åˆ°å’ŒDockerfileåŒçº§ç›®å½•</p><p>Dockerfileå¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER rugod.cn</span><br><span class="line">RUN mkdir &#x2F;usr&#x2F;local&#x2F;java</span><br><span class="line">ADD jdk-8u201-linux-x64.tar.gz &#x2F;usr&#x2F;local&#x2F;java&#x2F;</span><br><span class="line">ENV JAVA_HOME &#x2F;usr&#x2F;local&#x2F;java&#x2F;jdk1.8.0_201</span><br><span class="line">ENV JRE_HOME $JAVA_HOME&#x2F;jre</span><br><span class="line">ENV PATH $JAVA_HOME&#x2F;bin:$PATH</span><br></pre></td></tr></table></figure><p>åˆ¶ä½œJDK8é•œåƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker build -t&#x3D;&quot;jdk8&#x2F;jdk8:1.0.0&quot; .</span><br><span class="line"></span><br><span class="line">docker images -a</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">jdk8&#x2F;jdk8           1.0.0               9c5f587a8384        27 hours ago        546MB</span><br><span class="line"></span><br><span class="line">docker run -it --rm jdk8&#x2F;jdk8:1.0.0 java -version</span><br><span class="line">java version &quot;1.8.0_201&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_201-b09)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.201-b09, mixed mode)</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠè¿™ä¸ªjdké‡æ–°pushåˆ°Harborè¦†ç›–ä¹‹å‰jdkçš„é•œåƒå³å¯</p>]]></content>
      
      
      <categories>
          
          <category> JDK </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Operation Manual </tag>
            
            <tag> JDK </tag>
            
            <tag> Dockerfile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿ç»´æ‰‹å†Œâ€”â€”RedisæŒä¹…åŒ–å ç”¨ç£ç›˜è¿‡é«˜</title>
      <link href="/2020/09/05/bug/redis-aof/"/>
      <url>/2020/09/05/bug/redis-aof/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬äºŒå®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>å…¬å¸æœåŠ¡å™¨ESå†™ç´¢å¼•å¼‚å¸¸ï¼ŒæŸ¥çœ‹åŸå› ï¼Œå‘ç°ESæ•°æ®æ‰€åœ¨ç›®å½•ç£ç›˜ç©ºé—´ä½¿ç”¨ç‡è¶…è¿‡ç™¾åˆ†ä¹‹90åï¼ŒESå°†ä¿®æ”¹ä¸ºåªè¯»çŠ¶æ€ï¼Œæ‰€ä»¥åˆ¤æ–­æ˜¯ç£ç›˜ç©ºé—´æ»¡äº†ã€‚ç„¶åæˆ‘ä¸ŠæœåŠ¡å™¨çœ‹ï¼ŒRediså ç”¨äº†300G+ç£ç›˜ï¼Œä¸”RedisåšAOFå’ŒRDBæ··åˆæŒä¹…åŒ–ï¼ŒAOF 137G RDB 123G</p><h1 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h1><h2 id="æŸ¥é˜…RedisæŒä¹…åŒ–æœºåˆ¶"><a href="#æŸ¥é˜…RedisæŒä¹…åŒ–æœºåˆ¶" class="headerlink" title="æŸ¥é˜…RedisæŒä¹…åŒ–æœºåˆ¶"></a>æŸ¥é˜…RedisæŒä¹…åŒ–æœºåˆ¶</h2><p>Redisæä¾›äº†ä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆï¼šRDBæŒä¹…åŒ–å’ŒAOFæŒä¹…åŒ–ï¼Œä¸€ä¸ªæ˜¯å¿«ç…§çš„æ–¹å¼ï¼Œä¸€ä¸ªæ˜¯ç±»ä¼¼æ—¥å¿—è¿½åŠ çš„æ–¹å¼</p><h3 id="RDBå¿«ç…§æŒä¹…åŒ–"><a href="#RDBå¿«ç…§æŒä¹…åŒ–" class="headerlink" title="RDBå¿«ç…§æŒä¹…åŒ–"></a>RDBå¿«ç…§æŒä¹…åŒ–</h3><p>RDBæŒä¹…åŒ–æ˜¯é€šè¿‡å¿«ç…§çš„æ–¹å¼ï¼Œå³åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ã€‚åœ¨åˆ›å»ºå¿«ç…§ä¹‹åï¼Œç”¨æˆ·å¯ä»¥å¤‡ä»½è¯¥å¿«ç…§ï¼Œå¯ä»¥å°†å¿«ç…§å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ä»¥åˆ›å»ºç›¸åŒæ•°æ®çš„æœåŠ¡å™¨å‰¯æœ¬ï¼Œæˆ–è€…åœ¨é‡å¯æœåŠ¡å™¨åæ¢å¤æ•°æ®ã€‚RDBæ˜¯Redisé»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼</p><p>RDBæŒä¹…åŒ–ä¼šç”ŸæˆRDBæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªå‹ç¼©è¿‡çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡è¯¥æ–‡ä»¶è¿˜åŸå¿«ç…§æ—¶çš„æ•°æ®åº“çŠ¶æ€ï¼Œå³ç”Ÿæˆè¯¥RDBæ–‡ä»¶æ—¶çš„æœåŠ¡å™¨æ•°æ®ã€‚RDBæ–‡ä»¶é»˜è®¤ä¸ºå½“å‰å·¥ä½œç›®å½•ä¸‹çš„dump.rdbï¼Œå¯ä»¥æ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„dbfilenameå’Œdirè®¾ç½®RDBçš„æ–‡ä»¶åå’Œæ–‡ä»¶ä½ç½®</p><h4 id="è§¦å‘RDBæŒä¹…åŒ–çš„æ—¶æœº"><a href="#è§¦å‘RDBæŒä¹…åŒ–çš„æ—¶æœº" class="headerlink" title="è§¦å‘RDBæŒä¹…åŒ–çš„æ—¶æœº"></a>è§¦å‘RDBæŒä¹…åŒ–çš„æ—¶æœº</h4><ul><li>æ‰§è¡Œsaveå’Œbgsaveå‘½ä»¤</li><li>é…ç½®æ–‡ä»¶è®¾ç½®save <seconds> <changes>è§„åˆ™ï¼Œè‡ªåŠ¨é—´éš”æ€§æ‰§è¡Œbgsaveå‘½ä»¤</li><li>ä¸»ä»å¤åˆ¶æ—¶ï¼Œä»åº“å…¨é‡å¤åˆ¶åŒæ­¥ä¸»åº“æ•°æ®ï¼Œä¸»åº“ä¼šæ‰§è¡Œbgsave</li><li>æ‰§è¡Œflushallå‘½ä»¤æ¸…ç©ºæœåŠ¡å™¨æ•°æ®</li><li>æ‰§è¡Œshutdownå‘½ä»¤å…³é—­Redisæ—¶ï¼Œä¼šæ‰§è¡Œsaveå‘½ä»¤</li></ul><h4 id="saveå’Œbgsaveå‘½ä»¤"><a href="#saveå’Œbgsaveå‘½ä»¤" class="headerlink" title="saveå’Œbgsaveå‘½ä»¤"></a>saveå’Œbgsaveå‘½ä»¤</h4><p>æ‰§è¡Œsaveå’Œbgsaveå‘½ä»¤ï¼Œå¯ä»¥æ‰‹åŠ¨è§¦å‘å¿«ç…§ï¼Œç”ŸæˆRDBæ–‡ä»¶ï¼Œä¸¤è€…çš„åŒºåˆ«å¦‚ä¸‹</p><p>ä½¿ç”¨saveå‘½ä»¤ä¼šé˜»å¡RedisæœåŠ¡å™¨è¿›ç¨‹ï¼ŒæœåŠ¡å™¨è¿›ç¨‹åœ¨RDBæ–‡ä»¶åˆ›å»ºå®Œæˆä¹‹å‰æ˜¯ä¸èƒ½å¤„ç†ä»»ä½•çš„å‘½ä»¤è¯·æ±‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; save</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><p>å¤åˆ¶ä»£ç è€Œä½¿ç”¨bgsaveå‘½ä»¤ä¸åŒçš„æ˜¯ï¼Œbasaveå‘½ä»¤ä¼šforkä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åè¯¥å­è¿›ç¨‹ä¼šè´Ÿè´£åˆ›å»ºRDBæ–‡ä»¶ï¼Œè€ŒæœåŠ¡å™¨è¿›ç¨‹ä¼šç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; bgsave</span><br><span class="line">Background saving started</span><br></pre></td></tr></table></figure><p>fork()æ˜¯ç”±æ“ä½œç³»ç»Ÿæä¾›çš„å‡½æ•°ï¼Œä½œç”¨æ˜¯åˆ›å»ºå½“å‰è¿›ç¨‹çš„ä¸€ä¸ªå‰¯æœ¬ä½œä¸ºå­è¿›ç¨‹</p><p>forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹ä¼šæŠŠæ•°æ®é›†å…ˆå†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œå†™å…¥æˆåŠŸä¹‹åï¼Œå†æ›¿æ¢ä¹‹å‰çš„RDBæ–‡ä»¶ï¼Œç”¨äºŒè¿›åˆ¶å‹ç¼©å­˜å‚¨ï¼Œè¿™æ ·å¯ä»¥ä¿è¯RDBæ–‡ä»¶å§‹ç»ˆå­˜å‚¨çš„æ˜¯å®Œæ•´çš„æŒä¹…åŒ–å†…å®¹ã€‚</p><p>å¦‚å›¾æ‰€ç¤º</p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Redis/rdb.png"  alt="rdb.png"></p><h4 id="è‡ªåŠ¨é—´éš”è§¦å‘"><a href="#è‡ªåŠ¨é—´éš”è§¦å‘" class="headerlink" title="è‡ªåŠ¨é—´éš”è§¦å‘"></a>è‡ªåŠ¨é—´éš”è§¦å‘</h4><p>åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®save <seconds> <changes>è§„åˆ™ï¼Œå¯ä»¥è‡ªåŠ¨é—´éš”æ€§æ‰§è¡Œbgsaveå‘½ä»¤ï¼Œä¸”ä¸ä¼šé€ æˆRediså µå¡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">################################ SNAPSHOTTING  ################################</span><br><span class="line">#</span><br><span class="line"># Save the DB on disk:</span><br><span class="line">#</span><br><span class="line">#   save &lt;seconds&gt; &lt;changes&gt;</span><br><span class="line">#</span><br><span class="line">#   Will save the DB if both the given number of seconds and the given</span><br><span class="line">#   number of write operations against the DB occurred.</span><br><span class="line">#</span><br><span class="line">#   In the example below the behaviour will be to save:</span><br><span class="line">#   after 900 sec (15 min) if at least 1 key changed</span><br><span class="line">#   after 300 sec (5 min) if at least 10 keys changed</span><br><span class="line">#   after 60 sec if at least 10000 keys changed</span><br><span class="line">#</span><br><span class="line">#   Note: you can disable saving completely by commenting out all &quot;save&quot; lines.</span><br><span class="line">#</span><br><span class="line">#   It is also possible to remove all the previously configured save</span><br><span class="line">#   points by adding a save directive with a single empty string argument</span><br><span class="line">#   like in the following example:</span><br><span class="line">#</span><br><span class="line">#   save &quot;&quot;</span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure><p>save <seconds> <changes>è¡¨ç¤ºåœ¨secondsç§’å†…ï¼Œè‡³å°‘æœ‰changesæ¬¡å˜åŒ–ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘gbsaveå‘½ä»¤</p><ul><li>save 900 1  å½“æ—¶é—´åˆ°900ç§’æ—¶ï¼Œå¦‚æœè‡³å°‘æœ‰1ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘bgsaveå‘½ä»¤åˆ›å»ºå¿«ç…§</li><li>save 300 10  å½“æ—¶é—´åˆ°300ç§’æ—¶ï¼Œå¦‚æœè‡³å°‘æœ‰10ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘bgsaveå‘½ä»¤åˆ›å»ºå¿«ç…§</li><li>save 60 10000    å½“æ—¶é—´åˆ°60ç§’æ—¶ï¼Œå¦‚æœè‡³å°‘æœ‰10000ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘bgsaveå‘½ä»¤åˆ›å»ºå¿«ç…§</li></ul><h3 id="AOFæŒä¹…åŒ–"><a href="#AOFæŒä¹…åŒ–" class="headerlink" title="AOFæŒä¹…åŒ–"></a>AOFæŒä¹…åŒ–</h3><p>é™¤äº†RDBæŒä¹…åŒ–ï¼ŒRedisè¿˜æä¾›äº†AOFï¼ˆAppend Only Fileï¼‰æŒä¹…åŒ–åŠŸèƒ½ï¼ŒAOFæŒä¹…åŒ–ä¼šæŠŠè¢«æ‰§è¡Œçš„å†™å‘½ä»¤å†™åˆ°AOFæ–‡ä»¶çš„æœ«å°¾ï¼Œè®°å½•æ•°æ®çš„å˜åŒ–ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedisæ˜¯æ²¡æœ‰å¼€å¯AOFæŒä¹…åŒ–çš„ï¼Œå¼€å¯åï¼Œæ¯æ‰§è¡Œä¸€æ¡æ›´æ”¹Redisæ•°æ®çš„å‘½ä»¤ï¼Œéƒ½ä¼šæŠŠè¯¥å‘½ä»¤è¿½åŠ åˆ°AOFæ–‡ä»¶ä¸­ï¼Œè¿™æ˜¯ä¼šé™ä½Redisçš„æ€§èƒ½ï¼Œä½†å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿™ä¸ªå½±å“æ˜¯èƒ½å¤Ÿæ¥å—çš„ï¼Œå¦å¤–ä½¿ç”¨è¾ƒå¿«çš„ç¡¬ç›˜å¯ä»¥æé«˜AOFçš„æ€§èƒ½</p><h4 id="è§¦å‘AOFæŒä¹…åŒ–çš„æ—¶æœº"><a href="#è§¦å‘AOFæŒä¹…åŒ–çš„æ—¶æœº" class="headerlink" title="è§¦å‘AOFæŒä¹…åŒ–çš„æ—¶æœº"></a>è§¦å‘AOFæŒä¹…åŒ–çš„æ—¶æœº</h4><ul><li>é…ç½®æ–‡ä»¶å¼€å¯AOFå³å¯</li></ul><p>é…ç½®æ–‡ä»¶å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># appendonlyå‚æ•°å¼€å¯AOFæŒä¹…åŒ–</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"># AOFæŒä¹…åŒ–çš„æ–‡ä»¶åï¼Œé»˜è®¤æ˜¯appendonly.aof</span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line"></span><br><span class="line"># AOFæ–‡ä»¶çš„ä¿å­˜ä½ç½®å’ŒRDBæ–‡ä»¶çš„ä½ç½®ç›¸åŒï¼Œéƒ½æ˜¯é€šè¿‡dirå‚æ•°è®¾ç½®çš„</span><br><span class="line">dir .&#x2F;</span><br><span class="line"></span><br><span class="line"># åŒæ­¥ç­–ç•¥</span><br><span class="line"># appendfsync always</span><br><span class="line">appendfsync everysec</span><br><span class="line"># appendfsync no</span><br><span class="line"></span><br><span class="line"># aofé‡å†™æœŸé—´æ˜¯å¦åŒæ­¥</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># åŠ è½½aofå‡ºé”™å¦‚ä½•å¤„ç†</span><br><span class="line">aof-load-truncated yes</span><br><span class="line"></span><br><span class="line"># æ–‡ä»¶é‡å†™ç­–ç•¥</span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br></pre></td></tr></table></figure><h4 id="AOFçš„å®ç°"><a href="#AOFçš„å®ç°" class="headerlink" title="AOFçš„å®ç°"></a>AOFçš„å®ç°</h4><p>AOFéœ€è¦è®°å½•Redisçš„æ¯ä¸ªå†™å‘½ä»¤ï¼Œæ­¥éª¤ä¸ºï¼šå‘½ä»¤è¿½åŠ ï¼ˆappendï¼‰ã€æ–‡ä»¶å†™å…¥ï¼ˆwriteï¼‰å’Œæ–‡ä»¶åŒæ­¥ï¼ˆsyncï¼‰</p><ul><li>å‘½ä»¤è¿½åŠ (append)</li></ul><p>å¼€å¯AOFæŒä¹…åŒ–åŠŸèƒ½åï¼ŒæœåŠ¡å™¨æ¯æ‰§è¡Œä¸€ä¸ªå†™å‘½ä»¤ï¼Œéƒ½ä¼šæŠŠè¯¥å‘½ä»¤ä»¥åè®®æ ¼å¼å…ˆè¿½åŠ åˆ°aof_bufç¼“å­˜åŒºçš„æœ«å°¾ï¼Œè€Œä¸æ˜¯ç›´æ¥å†™å…¥æ–‡ä»¶ï¼Œé¿å…æ¯æ¬¡æœ‰å‘½ä»¤éƒ½ç›´æ¥å†™å…¥ç¡¬ç›˜ï¼Œå‡å°‘ç¡¬ç›˜IOæ¬¡æ•°</p><ul><li>æ–‡ä»¶å†™å…¥(write)å’Œæ–‡ä»¶åŒæ­¥(sync)</li></ul><p>å¯¹äºä½•æ—¶æŠŠaof_bufç¼“å†²åŒºçš„å†…å®¹å†™å…¥ä¿å­˜åœ¨AOFæ–‡ä»¶ä¸­ï¼ŒRedisæä¾›äº†å¤šç§ç­–ç•¥</p><p>appendfsync alwaysï¼šå°†aof_bufç¼“å†²åŒºçš„æ‰€æœ‰å†…å®¹å†™å…¥å¹¶åŒæ­¥åˆ°AOFæ–‡ä»¶ï¼Œæ¯ä¸ªå†™å‘½ä»¤åŒæ­¥å†™å…¥ç£ç›˜</p><p>appendfsync everysecï¼šå°†aof_bufç¼“å­˜åŒºçš„å†…å®¹å†™å…¥AOFæ–‡ä»¶ï¼Œæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œè¯¥æ“ä½œç”±ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨è´Ÿè´£</p><p>appendfsync noï¼šå°†aof_bufç¼“å­˜åŒºçš„å†…å®¹å†™å…¥AOFæ–‡ä»¶ï¼Œä»€ä¹ˆæ—¶å€™åŒæ­¥ç”±æ“ä½œç³»ç»Ÿæ¥å†³å®š</p><p>appendfsyncé€‰é¡¹çš„é»˜è®¤é…ç½®ä¸ºeverysecï¼Œå³æ¯ç§’æ‰§è¡Œä¸€æ¬¡åŒæ­¥</p><p>å…³äºAOFçš„åŒæ­¥ç­–ç•¥æ˜¯æ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿçš„writeå‡½æ•°å’Œfsyncå‡½æ•°çš„ï¼Œåœ¨ã€ŠRedisè®¾è®¡ä¸å®ç°ã€‹ä¸­æ˜¯è¿™æ ·è¯´æ˜çš„</p><p>ä¸ºäº†æé«˜æ–‡ä»¶å†™å…¥æ•ˆç‡ï¼Œåœ¨ç°ä»£æ“ä½œç³»ç»Ÿä¸­ï¼Œå½“ç”¨æˆ·è°ƒç”¨writeå‡½æ•°ï¼Œå°†ä¸€äº›æ•°æ®å†™å…¥æ–‡ä»¶æ—¶ï¼Œæ“ä½œç³»ç»Ÿé€šå¸¸ä¼šå°†æ•°æ®æš‚å­˜åˆ°ä¸€ä¸ªå†…å­˜ç¼“å†²åŒºé‡Œï¼Œå½“ç¼“å†²åŒºçš„ç©ºé—´è¢«å¡«æ»¡æˆ–è¶…è¿‡äº†æŒ‡å®šæ—¶é™åï¼Œæ‰çœŸæ­£å°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ°ç£ç›˜é‡Œã€‚</p><p>è¿™æ ·çš„æ“ä½œè™½ç„¶æé«˜äº†æ•ˆç‡ï¼Œä½†ä¹Ÿä¸ºæ•°æ®å†™å…¥å¸¦æ¥äº†å®‰å…¨é—®é¢˜ï¼šå¦‚æœè®¡ç®—æœºåœæœºï¼Œå†…å­˜ç¼“å†²åŒºä¸­çš„æ•°æ®ä¼šä¸¢å¤±ã€‚ä¸ºæ­¤ï¼Œç³»ç»Ÿæä¾›äº†fsyncã€fdatasyncåŒæ­¥å‡½æ•°ï¼Œå¯ä»¥å¼ºåˆ¶æ“ä½œç³»ç»Ÿç«‹åˆ»å°†ç¼“å†²åŒºä¸­çš„æ•°æ®å†™å…¥åˆ°ç¡¬ç›˜é‡Œï¼Œä»è€Œç¡®ä¿å†™å…¥æ•°æ®çš„å®‰å…¨æ€§ã€‚</p><p>ä»ä¸Šé¢çš„ä»‹ç»æˆ‘ä»¬çŸ¥é“ï¼Œæˆ‘ä»¬å†™å…¥çš„æ•°æ®ï¼Œæ“ä½œç³»ç»Ÿå¹¶ä¸ä¸€å®šä¼šé©¬ä¸ŠåŒæ­¥åˆ°ç£ç›˜ï¼Œæ‰€ä»¥Redisæ‰æä¾›äº†appendfsyncçš„é€‰é¡¹é…ç½®ã€‚å½“è¯¥é€‰é¡¹æ—¶ä¸ºalwaysæ—¶ï¼Œæ•°æ®å®‰å…¨æ€§æ˜¯æœ€é«˜çš„ï¼Œä½†æ˜¯ä¼šå¯¹ç£ç›˜è¿›è¡Œå¤§é‡çš„å†™å…¥ï¼ŒRediså¤„ç†å‘½ä»¤çš„é€Ÿåº¦ä¼šå—åˆ°ç£ç›˜æ€§èƒ½çš„é™åˆ¶ï¼›appendfsync everysecé€‰é¡¹åˆ™å…¼é¡¾äº†æ•°æ®å®‰å…¨å’Œå†™å…¥æ€§èƒ½ï¼Œä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡åŒæ­¥AOFæ–‡ä»¶ï¼Œå³ä¾¿å‡ºç°ç³»ç»Ÿå´©æºƒï¼Œæœ€å¤šåªä¼šä¸¢å¤±ä¸€ç§’å†…äº§ç”Ÿçš„æ•°æ®ï¼›å¦‚æœæ˜¯appendfsync noé€‰é¡¹ï¼ŒRedisä¸ä¼šå¯¹AOFæ–‡ä»¶æ‰§è¡ŒåŒæ­¥æ“ä½œï¼Œè€Œæ˜¯æœ‰æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶åŒæ­¥ï¼Œä¸ä¼šå¯¹Redisçš„æ€§èƒ½å¸¦æ¥å½±å“ï¼Œä½†å‡å¦‚ç³»ç»Ÿå´©æºƒï¼Œå¯èƒ½ä¼šä¸¢å¤±ä¸å®šæ•°é‡çš„æ•°æ®</p><h4 id="AOFé‡å†™-rewrite"><a href="#AOFé‡å†™-rewrite" class="headerlink" title="AOFé‡å†™(rewrite)"></a>AOFé‡å†™(rewrite)</h4><p>ç”±äºAOFçš„æœºåˆ¶ï¼Œæ¯æ¡å†™å‘½ä»¤éƒ½éœ€è¦è¢«è®°å½•ï¼Œå¦‚æœä¸€å¯¹kvå…ˆè¢«åˆ›å»ºï¼Œç„¶åè¢«ä¿®æ”¹4æ¬¡ï¼Œæœ€åè¢«åˆ é™¤ï¼Œé‚£ä¹ˆAOFä¼šå­˜åœ¨6ä¸ªæ­¤kvçš„è®°å½•ã€‚</p><p>å¦‚æœæ­¤æ—¶Redisé‡å¯ï¼Œè¯»å–AOFï¼Œé‚£ä¹ˆæœ€ç»ˆè¿˜æ˜¯ä¸ä¼šå­˜åœ¨è¿™å¯¹kvï¼Œä½†æ˜¯AOFçš„æ–‡ä»¶å¤§å°ä¼šå¢å¤§ï¼ˆå› ä¸ºè®°å½•äº†è¿™6æ¡å‘½ä»¤ï¼‰</p><p>ä¸ºäº†ä¸è®©AOFä¸€ç›´å¢å¤§è‡³æ— é™å¤§ï¼ŒRedisåº”è¯¥è®©åˆ é™¤è¿™äº›ä¸å¿…è¦çš„å‘½ä»¤ï¼ˆå†—ä½™å‘½ä»¤ï¼‰ã€‚æ¯”å¦‚ï¼šè¿‡æœŸæ•°æ®çš„å‘½ä»¤ã€æ— æ•ˆçš„å‘½ä»¤ï¼ˆé‡å¤è®¾ç½®ã€åˆ é™¤ï¼‰ã€å¤šä¸ªå‘½ä»¤å¯åˆå¹¶ä¸ºä¸€ä¸ªå‘½ä»¤ï¼ˆæ‰¹å¤„ç†å‘½ä»¤ï¼‰</p><p>AOFé‡å†™çš„ç›®çš„å°±æ˜¯å‡å°AOFæ–‡ä»¶çš„ä½“ç§¯ï¼Œä¸è¿‡å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šAOFæ–‡ä»¶é‡å†™å¹¶ä¸éœ€è¦å¯¹ç°æœ‰çš„AOFæ–‡ä»¶è¿›è¡Œä»»ä½•è¯»å–ã€åˆ†äº«å’Œå†™å…¥æ“ä½œï¼Œè€Œæ˜¯é€šè¿‡è¯»å–æœåŠ¡å™¨å½“å‰çš„æ•°æ®åº“çŠ¶æ€æ¥å®ç°çš„</p><p>æ–‡ä»¶é‡å†™å¯åˆ†ä¸ºæ‰‹åŠ¨è§¦å‘å’Œè‡ªåŠ¨è§¦å‘ï¼Œæ‰‹åŠ¨è§¦å‘æ‰§è¡Œbgrewriteaofå‘½ä»¤ï¼Œè¯¥å‘½ä»¤çš„æ‰§è¡Œè·Ÿbgsaveè§¦å‘å¿«ç…§æ—¶ç±»ä¼¼çš„ï¼Œéƒ½æ˜¯å…ˆforkä¸€ä¸ªå­è¿›ç¨‹åšå…·ä½“çš„å·¥ä½œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; bgrewriteaof</span><br><span class="line">Background append only file rewriting started</span><br></pre></td></tr></table></figure><p>è‡ªåŠ¨è§¦å‘ä¼šæ ¹æ®auto-aof-rewrite-percentageå’Œauto-aof-rewrite-min-size 64mbé…ç½®æ¥è‡ªåŠ¨æ‰§è¡Œbgrewriteaofå‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># é‡å†™è§¦å‘é…ç½®</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé…ç½®è¡¨ç¤ºå½“AOFæ–‡ä»¶çš„ä½“ç§¯å¤§äº64MBï¼Œä¸”AOFæ–‡ä»¶çš„ä½“ç§¯æ¯”ä¸Šä¸€æ¬¡é‡å†™åçš„ä½“ç§¯å¤§äº†ä¸€å€ï¼ˆ100%ï¼‰æ—¶ï¼Œä¼šæ‰§è¡Œ<code>bgrewriteaof</code>å‘½ä»¤</p><h4 id="bgrewriteaof"><a href="#bgrewriteaof" class="headerlink" title="bgrewriteaof"></a>bgrewriteaof</h4><p>é‡å†™ä¼šæœ‰å¤§é‡çš„å†™å…¥æ“ä½œï¼Œæ‰€ä»¥æœåŠ¡å™¨è¿›ç¨‹ä¼šforkä¸€ä¸ªå­è¿›ç¨‹æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„AOFæ–‡ä»¶</p><p>åœ¨é‡å†™æœŸé—´ï¼ŒæœåŠ¡å™¨è¿›ç¨‹ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ï¼Œå¦‚æœæœ‰å†™å…¥çš„å‘½ä»¤ï¼Œè¿½åŠ åˆ°aof_bufçš„åŒæ—¶ï¼Œè¿˜ä¼šè¿½åŠ åˆ°aof_rewrite_buf AOFé‡å†™ç¼“å†²åŒº</p><p>å½“å­è¿›ç¨‹å®Œæˆé‡å†™ä¹‹åï¼Œä¼šç»™çˆ¶è¿›ç¨‹ä¸€ä¸ªä¿¡å·ï¼Œç„¶åçˆ¶è¿›ç¨‹ä¼šæŠŠAOFé‡å†™ç¼“å†²åŒºçš„å†…å®¹å†™è¿›æ–°çš„AOFä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå†å¯¹æ–°çš„AOFæ–‡ä»¶æ”¹åå®Œæˆæ›¿æ¢ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ–°çš„AOFæ–‡ä»¶ä¸å½“å‰æ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§</p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Redis/aof.png"  alt="aof.png"></p><h3 id="AOFå’ŒRDBçš„ä¼˜ç¼ºç‚¹"><a href="#AOFå’ŒRDBçš„ä¼˜ç¼ºç‚¹" class="headerlink" title="AOFå’ŒRDBçš„ä¼˜ç¼ºç‚¹"></a>AOFå’ŒRDBçš„ä¼˜ç¼ºç‚¹</h3><h4 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h4><p>ä¼˜ç‚¹ï¼š</p><ul><li>RDB æ˜¯ä¸€ä¸ªéå¸¸ç´§å‡‘ï¼ˆcompactï¼‰çš„æ–‡ä»¶ï¼Œä½“ç§¯å°ï¼Œå› æ­¤åœ¨ä¼ è¾“é€Ÿåº¦ä¸Šæ¯”è¾ƒå¿«ï¼Œå› æ­¤é€‚åˆç¾éš¾æ¢å¤ã€‚ </li><li>RDB å¯ä»¥æœ€å¤§åŒ– Redis çš„æ€§èƒ½ï¼šçˆ¶è¿›ç¨‹åœ¨ä¿å­˜ RDB æ–‡ä»¶æ—¶å”¯ä¸€è¦åšçš„å°±æ˜¯ fork å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åè¿™ä¸ªå­è¿›ç¨‹å°±ä¼šå¤„ç†æ¥ä¸‹æ¥çš„æ‰€æœ‰ä¿å­˜å·¥ä½œï¼Œçˆ¶è¿›ç¨‹æ— é¡»æ‰§è¡Œä»»ä½•ç£ç›˜ I/O æ“ä½œã€‚</li><li>RDB åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯” AOF çš„æ¢å¤é€Ÿåº¦è¦å¿«ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>RDBæ˜¯ä¸€ä¸ªå¿«ç…§è¿‡ç¨‹ï¼Œæ— æ³•å®Œæ•´çš„ä¿å­˜æ‰€ä»¥æ•°æ®ï¼Œå°¤å…¶åœ¨æ•°æ®é‡æ¯”è¾ƒå¤§æ—¶å€™ï¼Œä¸€æ—¦å‡ºç°æ•…éšœä¸¢å¤±çš„æ•°æ®å°†æ›´å¤šã€‚</li><li>å½“redisä¸­æ•°æ®é›†æ¯”è¾ƒå¤§æ—¶å€™ï¼ŒRDBç”±äºRDBæ–¹å¼éœ€è¦å¯¹æ•°æ®è¿›è¡Œå®Œæˆæ‹·è´å¹¶ç”Ÿæˆå¿«ç…§æ–‡ä»¶ï¼Œforkçš„å­è¿›ç¨‹ä¼šè€—CPUï¼Œå¹¶ä¸”æ•°æ®è¶Šå¤§ï¼ŒRDBå¿«ç…§ç”Ÿæˆä¼šè¶Šè€—æ—¶ã€‚</li><li>RDBæ–‡ä»¶æ˜¯ç‰¹å®šçš„æ ¼å¼ï¼Œé˜…è¯»æ€§å·®ï¼Œç”±äºæ ¼å¼å›ºå®šï¼Œå¯èƒ½å­˜åœ¨ä¸å…¼å®¹æƒ…å†µã€‚</li></ul><h4 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h4><p>ä¼˜ç‚¹ï¼š</p><ul><li>æ•°æ®æ›´å®Œæ•´ï¼Œç§’çº§æ•°æ®ä¸¢å¤±(å–å†³äºè®¾ç½®fsyncç­–ç•¥)ã€‚</li><li>å…¼å®¹æ€§è¾ƒé«˜ï¼Œç”±äºæ˜¯åŸºäºredisé€šè®¯åè®®è€Œå½¢æˆçš„å‘½ä»¤è¿½åŠ æ–¹å¼ï¼Œæ— è®ºä½•ç§ç‰ˆæœ¬çš„rediséƒ½å…¼å®¹ï¼Œå†è€…aofæ–‡ä»¶æ˜¯æ˜æ–‡çš„ï¼Œå¯é˜…è¯»æ€§è¾ƒå¥½ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ•°æ®æ–‡ä»¶ä½“ç§¯è¾ƒå¤§,å³ä½¿æœ‰é‡å†™æœºåˆ¶ï¼Œä½†æ˜¯åœ¨ç›¸åŒçš„æ•°æ®é›†æƒ…å†µä¸‹ï¼ŒAOFæ–‡ä»¶é€šå¸¸æ¯”RDBæ–‡ä»¶å¤§ã€‚</li><li>ç›¸å¯¹RDBæ–¹å¼ï¼ŒAOFé€Ÿåº¦æ…¢äºRDBï¼Œå¹¶ä¸”åœ¨æ•°æ®é‡å¤§æ—¶å€™ï¼Œæ¢å¤é€Ÿåº¦AOFé€Ÿåº¦ä¹Ÿæ˜¯æ…¢äºRDBã€‚</li><li>ç”±äºé¢‘ç¹åœ°å°†å‘½ä»¤åŒæ­¥åˆ°æ–‡ä»¶ä¸­ï¼ŒAOFæŒä¹…åŒ–å¯¹æ€§èƒ½çš„å½±å“ç›¸å¯¹RDBè¾ƒå¤§ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬æ¥è¯´æ˜¯å¯ä»¥æ¥å—çš„ã€‚</li></ul><h4 id="åæ€"><a href="#åæ€" class="headerlink" title="åæ€"></a>åæ€</h4><p>é€šè¿‡AOFå’ŒRDBçš„ä¼˜ç¼ºç‚¹æ¯”è¾ƒï¼Œå…¶å®æˆ‘å…³æ³¨çš„é‡ç‚¹å°±æ˜¯æ•°æ®æ¢å¤çš„å¯é æ€§ã€‚</p><p>ä¸€å°æœåŠ¡å™¨å¦‚æœä½ èƒ½ä¿è¯æ°¸ä¹…ä¸å…³æœºã€ä¸ä¸­æ–­æœåŠ¡ã€‚é‚£ä¹ˆè¿™å°æœºå™¨å°±ä¸éœ€è¦åšä»»ä½•å¤‡ä»½ï¼ˆå®é™…åŸºæœ¬ä¸Šä¸å­˜åœ¨è¿™ç§ï¼‰</p><p>é‚£ä¹ˆä¸€æ—¦å‡ºç°ä¸­æ–­æœåŠ¡ã€æˆ–å…³æœºã€æˆ–ç¡¬ç›˜æŸå¤±ã€‚æˆ‘ä»¬å°±åº”è¯¥å…³æ³¨å¦‚ä½•è®©è¿™ä¸ªæœåŠ¡æ¢å¤åˆ°æ­£å¸¸çŠ¶æ€æœ€ä½³ã€‚</p><p>è¿™ä¸ªæœ€ä½³çš„å®šä¹‰ï¼Œåœ¨å­¦ä¹ SREçš„æ€æƒ³åï¼Œæˆ‘æ˜¯è¿™æ ·çœ‹çš„</p><ul><li>æ•°æ®å°½é‡ä¸ä¸¢å¤±</li><li>æ¢å¤çš„æ—¶é—´å°½å¿«</li></ul><p>è¿™æ ·æ‰èƒ½å¯¹ç”Ÿäº§å½±å“æœ€å°ã€‚</p><p>åŸºäºè¿™ä¸ªåŸåˆ™ï¼ŒRedisçš„å¤‡ä»½ç­–ç•¥åº”è¯¥å¸æ”¶RDB(æ¢å¤é€Ÿåº¦å¿«)ã€AOF(æ•°æ®ä¸ä¸¢å¤±)è¿™2ä¸ªæœ€é‡è¦çš„ä¼˜ç‚¹ã€‚</p><p>ä»”ç»†ç ”ç©¶å‘ç°è¿™ä¸ªå¤‡ä»½ç­–ç•¥å·²ç»å®ç°äº†ï¼Œé‚£å°±æ˜¯Redisçš„æ··åˆæŒä¹…åŒ–</p><h3 id="Redisæ··åˆæŒä¹…åŒ–"><a href="#Redisæ··åˆæŒä¹…åŒ–" class="headerlink" title="Redisæ··åˆæŒä¹…åŒ–"></a>Redisæ··åˆæŒä¹…åŒ–</h3><p>Redis4.0å¼€å§‹æ”¯æŒRDBå’ŒAOFçš„æ··åˆæŒä¹…åŒ–ï¼ˆå¯ä»¥é€šè¿‡é…ç½®é¡¹ aof-use-rdb-preamble å¼€å¯ï¼‰5.0ä¹‹åé»˜è®¤å¼€å¯æ··åˆæŒä¹…åŒ–</p><p>æ··åˆæŒä¹…åŒ–åŒæ ·ä¹Ÿæ˜¯é€šè¿‡bgrewriteaofå®Œæˆçš„ï¼Œä¸åŒçš„æ˜¯å½“å¼€å¯æ··åˆæŒä¹…åŒ–æ—¶ï¼Œforkå‡ºçš„å­è¿›ç¨‹å…ˆå°†å…±äº«çš„å†…å­˜å‰¯æœ¬å…¨é‡çš„ä»¥RDBæ–¹å¼å†™å…¥aofæ–‡ä»¶ï¼Œç„¶ååœ¨å°†aof_rewrite_bufé‡å†™ç¼“å†²åŒºçš„å¢é‡å‘½ä»¤ä»¥AOFæ–¹å¼å†™å…¥åˆ°æ–‡ä»¶ï¼Œå†™å…¥å®Œæˆåé€šçŸ¥ä¸»è¿›ç¨‹æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼Œå¹¶å°†æ–°çš„å«æœ‰RDBæ ¼å¼å’ŒAOFæ ¼å¼çš„AOFæ–‡ä»¶æ›¿æ¢æ—§çš„çš„AOFæ–‡ä»¶ã€‚ç®€å•çš„è¯´ï¼šæ–°çš„AOFæ–‡ä»¶å‰åŠæ®µæ˜¯RDBæ ¼å¼çš„å…¨é‡æ•°æ®ååŠæ®µæ˜¯AOFæ ¼å¼çš„å¢é‡æ•°æ®ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Redis/aof-use-rdb-preamble.png"  alt="aof-use-rdb-preamble.png"></p><p>é‚£ä¹ˆé‡å¯æ—¶redisæŒ‰ç…§ä»¥ä¸‹è§„åˆ™è¯»å–æ•°æ®</p><ul><li>å¦‚æœæ˜¯redisè¿›ç¨‹æŒ‚æ‰ï¼Œé‚£ä¹ˆé‡å¯redisè¿›ç¨‹å³å¯ï¼Œç›´æ¥åŸºäºAOFæ—¥å¿—æ–‡ä»¶æ¢å¤æ•°æ®</li><li>å¦‚æœæ˜¯redisè¿›ç¨‹æ‰€åœ¨æœºå™¨æŒ‚æ‰ï¼Œé‚£ä¹ˆé‡å¯æœºå™¨åï¼Œå°è¯•é‡å¯redisè¿›ç¨‹ï¼Œå°è¯•ç›´æ¥åŸºäºAOFæ—¥å¿—æ–‡ä»¶è¿›è¡Œæ•°æ®æ¢å¤ï¼Œå¦‚æœAOFæ–‡ä»¶ç ´æŸï¼Œé‚£ä¹ˆç”¨redis-check-aof fixå‘½ä»¤ä¿®å¤</li><li>å¦‚æœæ²¡æœ‰AOFæ–‡ä»¶ï¼Œä¼šå»åŠ è½½RDBæ–‡ä»¶</li><li>å¦‚æœrediså½“å‰æœ€æ–°çš„AOFå’ŒRDBæ–‡ä»¶å‡ºç°äº†ä¸¢å¤±/æŸåï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•åŸºäºè¯¥æœºå™¨ä¸Šå½“å‰çš„æŸä¸ªæœ€æ–°çš„RDBæ•°æ®å‰¯æœ¬è¿›è¡Œæ•°æ®æ¢å¤</li></ul><p>é€šè¿‡è¿™äº›è§„åˆ™æˆ‘ä»¬å¯ä»¥çŸ¥é“å³ä½¿æ˜¯æ··åˆæŒä¹…åŒ–ï¼Œåœ¨ä¸ä¸¢å¤±/ç ´åAOFçš„æƒ…å†µä¸‹ï¼Œå†æŒä¹…åŒ–ä¸€ä»½RDBå‡ ä¹æ²¡ç”¨ã€‚å› ä¸ºå¼€å¯äº†æ··åˆæ¨¡å¼åçš„aofæ–‡ä»¶é‡ŒåŒ…å«äº†rdbçš„å¤´+aofçš„å¢é‡æ–‡ä»¶ï¼Œè€Œæ¯æ¬¡é‡å¯è¯»å–çš„éƒ½æ˜¯aofæ–‡ä»¶ã€‚</p><h2 id="ç°çŠ¶"><a href="#ç°çŠ¶" class="headerlink" title="ç°çŠ¶"></a>ç°çŠ¶</h2><p>ç›®å‰RedisæœåŠ¡å™¨æ˜¯åšäº†AOFå’ŒRDBæ··åˆæŒä¹…åŒ–ã€‚ç£ç›˜439G å†…å­˜256G</p><p>æˆ‘ä»¬å…ˆæŸ¥çœ‹æœåŠ¡å™¨çŠ¶æ€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ free -h</span><br><span class="line">              total        used        free      shared  buff&#x2F;cache   available</span><br><span class="line">Mem:           251G        151G        858M        730M         99G         97G</span><br><span class="line">$ df -h</span><br><span class="line">Filesystem    Size  Used Avail Use% Mounted on</span><br><span class="line">udev          126G     0  126G   0% &#x2F;dev</span><br><span class="line">tmpfs         26G   1.7G   24G   7%  &#x2F;run</span><br><span class="line">&#x2F;dev&#x2F;sdc2     439G  400G  38G   91% &#x2F;</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; INFO Memory</span><br><span class="line"># Memory</span><br><span class="line">used_memory:144520234248</span><br><span class="line">used_memory_human:134.59G</span><br><span class="line">used_memory_rss:151639486464</span><br><span class="line">used_memory_rss_human:141.23G</span><br><span class="line">used_memory_peak:145837846640</span><br><span class="line">used_memory_peak_human:135.82G</span><br><span class="line">used_memory_peak_perc:99.10%</span><br><span class="line">used_memory_overhead:46702054</span><br><span class="line">used_memory_startup:786608</span><br><span class="line">used_memory_dataset:144473532194</span><br><span class="line">used_memory_dataset_perc:99.97%</span><br><span class="line">total_system_memory:270115205120</span><br><span class="line">total_system_memory_human:251.56G</span><br><span class="line">used_memory_lua:37888</span><br><span class="line">used_memory_lua_human:37.00K</span><br><span class="line">maxmemory:0</span><br><span class="line">maxmemory_human:0B</span><br><span class="line">maxmemory_policy:volatile-ttl</span><br><span class="line">mem_fragmentation_ratio:1.05</span><br><span class="line">mem_allocator:jemalloc-4.0.3</span><br><span class="line">active_defrag_running:0</span><br><span class="line">lazyfree_pending_objects:0</span><br></pre></td></tr></table></figure><p>å¥½å®¶ä¼™ï¼ŒRediså®é™…ä½¿ç”¨äº†134.59G</p><p>é‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹Redisçš„å¤‡ä»½æ–‡ä»¶å¤§å°å§ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ll -rth</span><br><span class="line">total 383G</span><br><span class="line">drwxrwxr-x 2 ubuntu ubuntu 4.0K 6æœˆ  18 18:44 log&#x2F;</span><br><span class="line">-rw-rw-r-- 1 ubuntu ubuntu  41K 7æœˆ  11 13:25 redis.conf</span><br><span class="line">-rw-r--r-- 1 root   root   866M 9æœˆ   3 12:22 temp-1.rdb</span><br><span class="line">drwxr-xr-x 3 root   root   4.0K 9æœˆ   3 12:29 ..&#x2F;</span><br><span class="line">-rw-r--r-- 1 root   root   123G 9æœˆ   4 20:10 dump.rdb</span><br><span class="line">drwxrwxr-x 3 ubuntu ubuntu 4.0K 9æœˆ   4 20:15 .&#x2F;</span><br><span class="line">-rw-r--r-- 1 root   root   137G 9æœˆ   4 20:38 appendonly.aof</span><br><span class="line">-rw-r--r-- 1 root   root   123G 9æœˆ   4 20:39 temp-75.rdb</span><br></pre></td></tr></table></figure><p>çœŸçš„å¾ˆé¡¶ 383G</p><p>é€šè¿‡dump.rdbå’Œtemp-75.rdbæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒRedisç¡®å®æ˜¯ä¸€ç›´åœ¨å¤‡ä»½çš„ï¼Œä¸”AOFçš„å¤§å°æ¯”RDBå¤§</p><p>é‚£æˆ‘ä»¬ç»§ç»­çœ‹çœ‹è¿™ä¸ªredisçš„å¤‡ä»½ç­–ç•¥å§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">save 300 10</span><br><span class="line">auto-aof-rewrite-percentage 30</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå°±è¯´æ˜äº† æ¯6åˆ†é’Ÿåªè¦å­˜åœ¨ 10å¯¹kvå‘ç”Ÿäº†æ”¹å˜å°±ä¼šå¤‡ä»½RDBæ–‡ä»¶</p><p>æ¯å½“å®æ—¶çš„AOFæ–‡ä»¶å¤§å°æ¯”ä¸Šæ¬¡é‡å†™çš„AOFæ–‡ä»¶å¤§ç™¾åˆ†ä¹‹30ï¼Œå°±ä¼šé‡å†™AOF</p><p>å¯¹äºä¸€ä¸ªç»å¸¸å‘ç”Ÿæ›´æ”¹çš„Redisæ¥è¯´</p><p>save 300 10çš„é…ç½®ï¼Œæ¯6åˆ†é’Ÿå°±è¦åˆ·ä¸€æ¬¡ç›˜ï¼Œè¿™ä¸ªé…ç½®çœŸæ˜¯è®©äººçª’æ¯ã€‚</p><h1 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h1><h2 id="Redis-å†™ç£ç›˜å‡ºé”™-Cannot-allocate-memory"><a href="#Redis-å†™ç£ç›˜å‡ºé”™-Cannot-allocate-memory" class="headerlink" title="Redis å†™ç£ç›˜å‡ºé”™ Cannot allocate memory"></a>Redis å†™ç£ç›˜å‡ºé”™ Cannot allocate memory</h2><p>å…ˆæŸ¥çœ‹Redisæ—¥å¿—ï¼Œå‘ç°å­˜åœ¨å¤§é‡æŠ¥é”™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1:M 03 Sep 02:55:23.877 # Can&#39;t rewrite append only file in background: fork: Cannot allocate memory</span><br><span class="line">1:M 03 Sep 02:55:23.978 * Starting automatic rewriting of AOF on 198% growth</span><br><span class="line">1:M 03 Sep 02:55:23.978 # Can&#39;t rewrite append only file in background: fork: Cannot allocate memory</span><br><span class="line">1:M 03 Sep 02:55:24.078 * 10 changes in 300 seconds. Saving...</span><br><span class="line">1:M 03 Sep 02:55:24.079 # Can&#39;t save in background: fork: Cannot allocate memory</span><br><span class="line">1:M 03 Sep 02:55:24.079 * Starting automatic rewriting of AOF on 198% growth</span><br><span class="line">1:M 03 Sep 02:55:24.079 # Can&#39;t rewrite append only file in background: fork: Cannot allocate memory</span><br><span class="line">1:M 03 Sep 02:55:24.179 * Starting automatic rewriting of AOF on 198% growth</span><br><span class="line">1:M 03 Sep 02:55:24.179 # Can&#39;t rewrite append only file in background: fork: Cannot allocate memory</span><br><span class="line">1:M 03 Sep 02:55:24.280 * Starting automatic rewriting of AOF on 198% growth</span><br></pre></td></tr></table></figure><p>googleæŸ¥çœ‹åŸå› </p><p>å¼‚æ­¥å›å†™(BGSAVE), ä¸»è¿›ç¨‹forkå, å¤åˆ¶è‡ªèº«å¹¶é€šè¿‡è¿™ä¸ªæ–°çš„è¿›ç¨‹å›å†™ç£ç›˜, å›å†™ç»“æŸåæ–°è¿›ç¨‹è‡ªè¡Œå…³é—­.</p><p>ç”±äº BGSAVE ä¸éœ€è¦ä¸»è¿›ç¨‹é˜»å¡, ç³»ç»Ÿä¹Ÿä¸ä¼šå‡æ­», ä¸€èˆ¬ä¼šé‡‡ç”¨ BGSAVE æ¥å®ç°æ•°æ®å›å†™.</p><h3 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p>åœ¨ç¦»çº¿ä½œä¸šè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œéšç€listä¸­æ•°æ®é‡å¢åŠ ï¼ŒRediså†…å­˜å ç”¨é€æ¸å¢åŠ ï¼›</p><p>å½“ç³»ç»Ÿå‰©ä½™å†…å­˜ä¸è¶³ä»¥forkå­è¿›ç¨‹æ—¶ï¼ŒAOFé‡å†™å­è¿›ç¨‹å¯åŠ¨å¤±è´¥ï¼Œæ­¤æ—¶é”™è¯¯logä¸ºâ€œCanâ€™t rewrite append only file in background: fork: Cannot allocate memoryâ€ï¼Œè€Œç”¨äºçˆ¶å­è¿›ç¨‹é€šä¿¡çš„pipeä¸çŸ¥ä»€ä¹ˆåŸå› æ²¡æœ‰å…³é—­ï¼›</p><p>Redisä¸æ–­å°è¯•å¯åŠ¨AOFé‡å†™å­è¿›ç¨‹ï¼Œç»ˆäºåœ¨æ•°å°æ—¶åå°†å…è®¸çš„fdæ•°è€—å°½ï¼Œæ­¤æ—¶é”™è¯¯logä¸ºâ€œError opening /setting AOF rewrite IPC pipes: Numerical result out of rangeâ€ï¼›</p><p>ä¸æ­¤åŒæ—¶ï¼Œéšç€ç¦»çº¿ä½œä¸šçš„å®Œæˆï¼Œå†…å­˜å ç”¨å·²ç»ä¸‹é™ï¼Œä½†ç”±äºfdä¸è¶³ï¼ŒAOFé‡å†™å­è¿›ç¨‹è¿˜æ˜¯ä¸èƒ½å¯åŠ¨ï¼›</p><h3 id="è§£å†³é—®é¢˜-1"><a href="#è§£å†³é—®é¢˜-1" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h3><p>æœ€åå‚è€ƒç½‘ä¸Šèµ„æ–™</p><p>ä¸æ”¹ä»£ç çš„è§„é¿æ–¹æ¡ˆï¼š</p><ul><li>è®¾ç½®linuxç³»ç»Ÿçš„vm.overcommit_memory = 1ï¼ˆå…¶æ„ä¹‰å¯æŸ¥é˜…manæ‰‹å†Œï¼Œæœ¬æ–‡ä¸å†å±•å¼€ï¼‰ï¼Œå°½é‡å‡å°‘å­è¿›ç¨‹forkå¤±è´¥çš„æƒ…å†µï¼›</li><li>è®¾ç½®Redisçš„maxmemoryé™åˆ¶ï¼Œå½“å†…å­˜ä½¿ç”¨è¾¾åˆ°ä¸€å®šæ¯”ä¾‹æ—¶ä¸å†æ¥å—æ–°çš„æ•°æ®ï¼›</li><li>ä½¿ç”¨ä¸»ä»å¤‡ä»½ï¼Œæˆ–bgsaveæŒä¹…åŒ–ï¼ˆRDBæ–¹å¼æ— æ­¤é—®é¢˜ï¼‰ï¼Œå…³é—­AOFæŒä¹…åŒ–ï¼Œç­‰ä¸‹ä¸€ç‰ˆæœ¬å‘å¸ƒã€‚</li></ul><p>é¦–å…ˆRedisæ˜¯maxmemoryé™åˆ¶ï¼ŒåŒæ—¶è¯´è¿‡é¢†å¯¼è¦æ±‚ä¸é™åˆ¶Redisçš„æœ€å¤§ä½¿ç”¨ç‡ï¼Œä¸è€ƒè™‘</p><p>ç›®å‰Rediså•æœºï¼Œæ”¹æˆä¸»ä»æˆ–è€…é›†ç¾¤ä¸æ˜¾ç¤ºï¼Œä¸è€ƒè™‘</p><p>é‚£ä¹ˆåªæœ‰æ”¹vm.overcommit_memoryäº†</p><p>è¿™ä¸ªæ¶‰åŠåˆ°äº†linuxå†…æ ¸çš„çŸ¥è¯†</p><p>ç®€å•è¯´ä¸‹ vm.overcommit_memoryè¿™ä¸ªå‚æ•°</p><ul><li>vm.overcommit_memory = 1ï¼Œç›´æ¥æ”¾è¡Œ</li><li>vm.overcommit_memory = 0ï¼šåˆ™æ¯”è¾ƒ æ­¤æ¬¡è¯·æ±‚åˆ†é…çš„è™šæ‹Ÿå†…å­˜å¤§å°å’Œç³»ç»Ÿå½“å‰ç©ºé—²çš„ç‰©ç†å†…å­˜åŠ ä¸Šswapï¼Œå†³å®šæ˜¯å¦æ”¾è¡Œã€‚</li><li>vm.overcommit_memory = 2ï¼šåˆ™ä¼šæ¯”è¾ƒè¿›ç¨‹æ‰€æœ‰å·²åˆ†é…çš„è™šæ‹Ÿå†…å­˜åŠ ä¸Šæ­¤æ¬¡è¯·æ±‚åˆ†é…çš„è™šæ‹Ÿå†…å­˜å’Œç³»ç»Ÿå½“å‰çš„ç©ºé—²ç‰©ç†å†…å­˜åŠ ä¸Šswapï¼Œå†³å®šæ˜¯å¦æ”¾è¡Œã€‚</li></ul><p>é‚£ä¹ˆæŸ¥çœ‹æœåŠ¡å™¨çš„é…ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sysctl -a|grep  vm.overcommit_memory</span><br><span class="line">vm.overcommit_memory &#x3D; 0</span><br></pre></td></tr></table></figure><p>å°†å…¶æ”¹ä¸º1å³å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo echo &#39;vm.overcommit_memory &#x3D; 1&#39; &gt;&gt; &#x2F;etc&#x2F;sysctl.conf</span><br><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure><h2 id="ç£ç›˜ä¸å¤Ÿçš„é—®é¢˜"><a href="#ç£ç›˜ä¸å¤Ÿçš„é—®é¢˜" class="headerlink" title="ç£ç›˜ä¸å¤Ÿçš„é—®é¢˜"></a>ç£ç›˜ä¸å¤Ÿçš„é—®é¢˜</h2><p>è§£å†³å®Œä¸Šé¢ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘å‘ç°Redisçš„æ—¥å¿—å¼€å§‹é‡å†™äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1:M 03 Sep 02:55:30.710 * Background append only file rewriting started by pid 3025</span><br><span class="line">1:M 03 Sep 03:19:51.718 * AOF rewrite child asks to stop sending diffs.</span><br><span class="line">3025:C 03 Sep 03:19:51.719 * Parent agreed to stop sending diffs. Finalizing AOF...</span><br><span class="line">3025:C 03 Sep 03:19:51.719 * Concatenating 18.88 MB of AOF diff received from parent.</span><br><span class="line">3025:C 03 Sep 03:19:51.871 * SYNC append only file rewrite performed</span><br><span class="line">3025:C 03 Sep 03:19:54.247 * AOF rewrite: 965 MB of memory used by copy-on-write</span><br><span class="line">1:M 03 Sep 03:19:57.266 * Background AOF rewrite terminated with success</span><br><span class="line">1:M 03 Sep 03:19:57.266 * Residual parent diff successfully flushed to the rewritten AOF (0.00 MB)</span><br><span class="line">1:M 03 Sep 03:19:57.266 * Background AOF rewrite finished successfully</span><br><span class="line">1:M 03 Sep 03:19:57.367 * 10 changes in 300 seconds. Saving...</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚èŠ±äº†25åˆ†é’Ÿæ—¶é—´ï¼Œæ‰æŠŠ100å¤šGçš„æ–‡ä»¶å¤‡ä»½ä¸‹æ¥</p><p>åœ¨ç¬¬äºŒæ¬¡é‡å†™çš„æ—¶å€™æˆ‘å‘ç°ç£ç›˜å·²ç»æ‰“æ»¡äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1:M 03 Sep 03:20:01.234 * Background saving started by pid 3032</span><br><span class="line">3032:C 03 Sep 03:40:25.708 * DB saved on disk</span><br><span class="line">3032:C 03 Sep 03:40:28.021 * RDB: 667 MB of memory used by copy-on-write</span><br><span class="line">1:M 03 Sep 03:40:30.921 * Background saving terminated with success</span><br><span class="line">1:M 03 Sep 03:45:31.094 * 10 changes in 300 seconds. Saving...</span><br><span class="line">1:M 03 Sep 03:45:35.168 * Background saving started by pid 3033</span><br><span class="line">3033:C 03 Sep 04:05:47.989 # Write error saving DB on disk: No space left on device</span><br></pre></td></tr></table></figure><p>å› ä¸ºRDBå¤‡ä»½æ˜¯åœ¨ä¿å­˜ä¸€ä»½çš„æƒ…å†µï¼Œé‡å†™ä¸€ä¸ªRDBæ–‡ä»¶ï¼Œç„¶ååˆ é™¤ä¹‹å‰çš„æ–‡ä»¶ã€‚è¿™å°±æ„å‘³ç€åœ¨æœ€é«˜å³°çš„æ—¶å€™ä½ å¾—å­˜åœ¨2å€å†…å­˜å¤§å°çš„ç£ç›˜æ–‡ä»¶ï¼Œç„¶åå†åŠ ä¸Šä¸€ä¸ªAOFæ–‡ä»¶</p><p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœå†…å­˜ä¸­å­˜äº†100Gï¼Œä½ è¦ä¿è¯ç£ç›˜ç©ºé—´å¤§äº130*3=390G ç”šè‡³æ›´å¤šã€‚</p><h2 id="é…ç½®æ–‡ä»¶ä¿®æ”¹"><a href="#é…ç½®æ–‡ä»¶ä¿®æ”¹" class="headerlink" title="é…ç½®æ–‡ä»¶ä¿®æ”¹"></a>é…ç½®æ–‡ä»¶ä¿®æ”¹</h2><p>ç”±äºä¸Šé¢åˆ†æçš„æ··åˆå­˜å‚¨çš„æœºåˆ¶ï¼Œä¸éœ€è¦å†å•ç‹¬å¤‡ä»½RDBäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©æ ¹æœ¬è§£å†³é—®é¢˜ï¼Œå…³é—­å•ç‹¬å¤‡ä»½RDBç­–ç•¥ã€‚</p><p>å°†redis.confæ–‡ä»¶saveæ³¨é‡Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">save &quot;&quot;</span><br><span class="line"></span><br><span class="line">#save 900 1</span><br><span class="line">#save 300 10</span><br><span class="line">#save 60 10000</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ²¡æœ‰é‡å¯redisï¼ˆå› ä¸ºé‡å¯é€Ÿåº¦å¤ªæ…¢äº†ï¼‰</p><p>è¿›å…¥redisâ€”cli</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config set save &quot;&quot;</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨rediså­˜æ”¾æ–‡ä»¶çš„ç›®å½•ä¸‹åˆ é™¤å·²ç”Ÿæˆçš„æ–‡ä»¶ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;data&#x2F;redis&#x2F;data$ rm -rf *.rdb</span><br></pre></td></tr></table></figure><p>tail -f redis-server.log</p><p>å‘ç°æœ€åä¸€æ¬¡ç”Ÿæˆåï¼Œå†ä¸å­˜åœ¨è‡ªåŠ¨å¤‡ä»½rdbçš„æ—¥å¿—äº†</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>é—®é¢˜æœ€ç»ˆæ˜¯è§£å†³äº†ï¼ŒESå·²ç»å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼Œå¤ç›˜è¿™ä¸ªé—®é¢˜å¾€å¾€æ‰æ˜¯æœ€è®©äººæˆé•¿çš„æ—¶åˆ»ã€‚</p><p>å…³äºè¿™ä¸ªæ¡ˆä¾‹ï¼Œä»å®šä½åˆ°è§£å†³é—®é¢˜æˆ‘åˆ†äº†3æ­¥</p><ul><li>å¼€å‘äººå‘˜åé¦ˆçº¿ä¸ŠåŠŸèƒ½å¼‚å¸¸ï¼ŒæŸ¥çœ‹ä»£ç æ–‡ä»¶å‘ç°ESä¸å¯ç”¨ï¼Œåˆ†æåŸå› æ˜¯ç£ç›˜å ç”¨ç‡è¶…è¿‡ç™¾åˆ†ä¹‹90å¯¼è‡´</li><li>æˆ‘æ”¶åˆ°è¿™ä¸ªå¼‚å¸¸åé¦ˆï¼Œè¿›å…¥æœåŠ¡å™¨ï¼ŒæŸ¥çœ‹æœåŠ¡å™¨èµ„æºä½¿ç”¨é‡ï¼Œå†…å­˜å ç”¨è¿‡é«˜ï¼Œç£ç›˜å ç”¨å¿«æ»¡äº†ï¼Œç®€å•æŸ¥è¯¢èµ„æ–™ï¼Œåˆ†æå¾—å‡ºåˆ é™¤RDBæ–‡ä»¶å¹¶ä¸”å…³é—­RDBæŒä¹…åŒ–ç­–ç•¥</li><li>é€šçŸ¥åŒäº‹ï¼ŒæœåŠ¡å™¨ä¼šä¿®å¤ä¸€æ®µæ—¶é—´ï¼Œå¯èƒ½é€ æˆåœæœºçš„é—®é¢˜ï¼Œå®Œæˆå¼‚å¸¸ä¿®å¤</li></ul><h1 id="æ”¹è¿›æ–¹æ¡ˆ"><a href="#æ”¹è¿›æ–¹æ¡ˆ" class="headerlink" title="æ”¹è¿›æ–¹æ¡ˆ"></a>æ”¹è¿›æ–¹æ¡ˆ</h1><p>è¦æˆä¸ºä¸€ä¸ªSREï¼Œè¿™ä¸ªé—®é¢˜çš„è§£å†³è‚¯å®šä¸æ­¢äºæ­¤ã€‚</p><p>è¿ç»´ç«™çš„è§’åº¦è¶Šé«˜ï¼Œçœ‹çš„é—®é¢˜è¶Šæ¸…æ™°ã€‚</p><h2 id="ç¬¬ä¸€å±‚ï¼šå¢åŠ ç¡¬ç›˜"><a href="#ç¬¬ä¸€å±‚ï¼šå¢åŠ ç¡¬ç›˜" class="headerlink" title="ç¬¬ä¸€å±‚ï¼šå¢åŠ ç¡¬ç›˜"></a>ç¬¬ä¸€å±‚ï¼šå¢åŠ ç¡¬ç›˜</h2><p>ç”±äºRediså†…å­˜å ç”¨å¾ˆé«˜ï¼Œå¤‡ä»½æ–‡ä»¶ç£ç›˜ä¹Ÿè‡ªç„¶å¾ˆå¤§ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº†åŠ ä¸€å—ç¡¬ç›˜ï¼Œç„¶åå°†Redisçš„æ—¥å¿—diræŒ‚è½½åˆ°è¿™å—ç›˜é‡Œã€‚</p><p>æ­¥éª¤</p><ul><li>å…ˆæ·»åŠ ä¸€å—ç¡¬ç›˜å¹¶æ ¼å¼åŒ–</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ fdisk -l</span><br><span class="line">Disk &#x2F;dev&#x2F;sda: 7.3 TiB, 8001563222016 bytes, 15628053168 sectors</span><br><span class="line">Units: sectors of 1 * 512 &#x3D; 512 bytes</span><br><span class="line">Sector size (logical&#x2F;physical): 512 bytes &#x2F; 4096 bytes</span><br><span class="line">I&#x2F;O size (minimum&#x2F;optimal): 4096 bytes &#x2F; 4096 bytes</span><br><span class="line"></span><br><span class="line">$ fdisk &#x2F;dev&#x2F;sda </span><br><span class="line">$ mkfs.ext4 &#x2F;dev&#x2F;sda1</span><br><span class="line">$ mount &#x2F;dev&#x2F;sda1 &#x2F;data</span><br><span class="line"></span><br><span class="line">$ vim  &#x2F;etc&#x2F;fstab æ·»åŠ ä¸€è¡Œå¼€æœºè‡ªåŠ¨æŒ‚è½½ </span><br><span class="line">&#x2F;dev&#x2F;sdb1 &#x2F;data ext4 defaults  0  2</span><br><span class="line"></span><br><span class="line">$ fdisk -l</span><br><span class="line">Disk &#x2F;dev&#x2F;sda: 7.3 TiB, 8001563222016 bytes, 15628053168 sectors</span><br><span class="line">Units: sectors of 1 * 512 &#x3D; 512 bytes</span><br><span class="line">Sector size (logical&#x2F;physical): 512 bytes &#x2F; 4096 bytes</span><br><span class="line">I&#x2F;O size (minimum&#x2F;optimal): 4096 bytes &#x2F; 4096 bytes</span><br><span class="line">Disklabel type: dos</span><br><span class="line">Disk identifier: 0xb95afa0a</span><br><span class="line"></span><br><span class="line">Device     Boot Start        End    Sectors Size Id Type</span><br><span class="line">&#x2F;dev&#x2F;sda1        2048 4294967294 4294965247   2T 83 Linux</span><br></pre></td></tr></table></figure><ul><li><p>å°†åŸæ¥Rediså­˜å‚¨æ–‡ä»¶æ”¾åˆ°æ–°æ·»åŠ çš„ç¡¬ç›˜é‡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ mv &#x2F;opt&#x2F;redis&#x2F;data&#x2F; &#x2F;data&#x2F;redis&#x2F;</span><br><span class="line">$ df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">udev            126G     0  126G   0% &#x2F;dev</span><br><span class="line">tmpfs           26G   1.7G  24G    7% &#x2F;run</span><br><span class="line">&#x2F;dev&#x2F;sdc2       439G  104G  313G  25% &#x2F;</span><br><span class="line">&#x2F;dev&#x2F;sda1       2.0T  153G  1.8T   8% &#x2F;data</span><br></pre></td></tr></table></figure></li><li><p>é‡å¯redisï¼Œå¼€å¯æ–°ç”Ÿæ´»å§~</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -ti -v &#x2F;data&#x2F;redis&#x2F;data:&#x2F;data&#x2F; -p 6379:6379 --name redis -d redis:4.0.14 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;redis-server &#x2F;data&#x2F;redis.conf</span><br></pre></td></tr></table></figure><h2 id="ç¬¬äºŒå±‚ï¼šå•çº¿ç¨‹çš„Redis"><a href="#ç¬¬äºŒå±‚ï¼šå•çº¿ç¨‹çš„Redis" class="headerlink" title="ç¬¬äºŒå±‚ï¼šå•çº¿ç¨‹çš„Redis"></a>ç¬¬äºŒå±‚ï¼šå•çº¿ç¨‹çš„Redis</h2><p>æˆ‘åœ¨è§‚å¯Ÿredis.logæ—¶è¿˜å‘ç°ä¸€äº›å¼‚å¸¸ï¼Œå¹¶ä¸”é¢‘ç‡å¾ˆé«˜ï¼ŒæŠ±ç€å¯»æ ¹é—®åº•çš„æ€æƒ³å»æŸ¥çœ‹è¿™ä¸ªé—®é¢˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Asynchronous AOF fsync is taking too long (disk is busy?). Writing the AOF buffer without waiting for fsync to complete, this may slow down Redis.</span><br></pre></td></tr></table></figure><p>googleåå‘ç°<br>è¯¥é”™è¯¯å¯èƒ½ä¼šé€ æˆ redis server ä¸Šçš„å¤„ç†å»¶è¿Ÿï¼Œè€Œä¸”å®¢æˆ·ç«¯ä¸Šä¹Ÿå¯èƒ½å‘ç”Ÿå¼‚å¸¸æˆ–è¿æ¥è¶…æ—¶ã€‚</p><p>è¿™å¦¥å¦¥çš„æ˜¯ä¸€ä¸ªç”Ÿäº§BUGå•Š</p><p>ç»§ç»­æ·±å…¥å‘ç°ï¼Œè¿™æ˜¯å› ä¸ºå¯ç”¨äº†RDB SAVE 300 10</p><p>ä¹Ÿå°±æ˜¯æ¯300ç§’å‡ºç°10ä¸ªkvæ›´æ”¹å°±ä¼šåˆ·ç›˜çš„å¤‡ä»½ç­–ç•¥</p><p>é€ æˆçš„ç£ç›˜ I/O è´Ÿè½½é«˜ã€‚</p><p>è™½ç„¶è¿™ä¸ªé—®é¢˜å·²ç»è¢«æˆ‘è§£å†³äº†ï¼Œä½†æ˜¯æˆ‘ç»§ç»­äº†è§£äº†Redisçš„å†…éƒ¨æœºåˆ¶åå‘ç°è¿™å…¶å®æ˜¯ä¸€ä¸ªä½¿ç”¨Redisä¸åˆ°ä½çš„ç¼ºé™·ã€‚</p><p>å¤§å®¶å¾€å¾€ä½¿ç”¨Redisæ˜¯å› ä¸ºRediså¿«â€”â€”æ•°æ®éƒ½æ˜¯åŠ è½½åœ¨å†…å­˜ä¸­çš„ï¼Œä½†æ˜¯å¾ˆå°‘æœ‰äººä¼šæ·±å…¥äº†è§£Redisçš„å®ç°é€»è¾‘ã€‚</p><p>Redis æ˜¯ä¸€ä¸ªå¤šè·¯å¤ç”¨çš„å•è¿›ç¨‹åº”ç”¨ç¨‹åºã€‚å¤šè·¯ï¼ŒæŒ‡çš„æ˜¯å¤šä¸ªç½‘ç»œåœ°å€ï¼Œå¤ç”¨æ˜¯æŒ‡é‡å¤åˆ©ç”¨å•ä¸ªçº¿ç¨‹ã€‚</p><p>å½“æ‰“å¼€æŒä¹…åŒ–åŠŸèƒ½åï¼Œ Redis å¤„ç†å®Œæ¯ä¸ªäº‹ä»¶åä¼šè°ƒç”¨ write(2) å°†å˜åŒ–å†™å…¥ kernel çš„ bufferï¼Œå¦‚æœæ­¤æ—¶ write(2) è¢«é˜»å¡ï¼ŒRedis å°±ä¸èƒ½å¤„ç†ä¸‹ä¸€ä¸ªäº‹ä»¶ã€‚Linux è§„å®šæ‰§è¡Œ write(2) æ—¶ï¼Œå¦‚æœå¯¹åŒä¸€ä¸ªæ–‡ä»¶æ­£åœ¨æ‰§è¡Œfdatasync(2)å°† kernel bufferå†™å…¥ç‰©ç†ç£ç›˜ï¼Œæˆ–è€…æœ‰system wide syncåœ¨æ‰§è¡Œï¼Œwrite(2)ä¼šè¢«Blockä½ï¼Œæ•´ä¸ªRedisè¢«Blockä½ã€‚</p><p>å¦‚æœç³»ç»ŸIO ç¹å¿™ï¼Œæ¯”å¦‚æœ‰åˆ«çš„åº”ç”¨åœ¨å†™ç›˜ï¼Œæˆ–è€…Redisè‡ªå·±åœ¨é‡å†™AOF æˆ–å¤‡ä»½RDBï¼Œå°±å¯èƒ½å¯¼è‡´ fdatasync(2) è¿Ÿè¿Ÿæœªèƒ½å®Œæˆä»è€Œ Block ä½ write(2)ï¼ŒBlock ä½æ•´ä¸ª Redisã€‚</p><p>ä¸ºæ­¤Redisæä¾›äº†ä¸€ä¸ªè‡ªæ•‘çš„æ–¹å¼ï¼Œå½“å‘ç°æ–‡ä»¶æœ‰åœ¨æ‰§è¡Œ fdatasync(2) æ—¶ï¼Œå°±å…ˆä¸è°ƒç”¨ write(2)ï¼Œåªå­˜åœ¨ cache é‡Œï¼Œå…å¾—è¢« Blockã€‚ä½†å¦‚æœå·²ç»è¶…è¿‡ä¸¤ç§’éƒ½è¿˜æ˜¯è¿™ä¸ªæ ·å­ï¼Œåˆ™ä¼šç¡¬ç€å¤´çš®æ‰§è¡Œ write(2)ï¼Œå³ä½¿ redis ä¼šè¢« Block ä½ã€‚æ­¤æ—¶é‚£å¥è¦å‘½çš„ log ä¼šæ‰“å°ï¼šâ€Asynchronous AOF fsync is taking too long (disk is busy?). Writing the AOF buffer without waiting for fsync to complete, this may slow down Redis.â€ã€‚ä¹‹åç”¨redis-cli INFO å¯ä»¥çœ‹åˆ° aof_delayed_fsync çš„å€¼è¢«åŠ 1ã€‚å› æ­¤ï¼Œå¯¹äº fsync è®¾ä¸º everysec æ—¶ä¸¢å¤±æ•°æ®çš„å¯èƒ½æ€§çš„æœ€ä¸¥è°¨è¯´æ³•æ˜¯ï¼šå¦‚æœæœ‰ fdatasync åœ¨é•¿æ—¶é—´çš„æ‰§è¡Œï¼Œæ­¤æ—¶ redis æ„å¤–å…³é—­ä¼šé€ æˆæ–‡ä»¶é‡Œä¸å¤šäºä¸¤ç§’çš„æ•°æ®ä¸¢å¤±ã€‚å¦‚æœ fdatasync è¿è¡Œæ­£å¸¸ï¼Œredis æ„å¤–å…³é—­æ²¡æœ‰å½±å“ï¼Œåªæœ‰å½“æ“ä½œç³»ç»Ÿ crash æ—¶æ‰ä¼šé€ æˆå°‘äº1ç§’çš„æ•°æ®ä¸¢å¤±ã€‚</p><p>è¿™ä¸ªé—®é¢˜è¿˜æ˜¯æ¯”è¾ƒéš¾ç†è§£çš„ï¼Œæˆ‘æ€»ç»“ä¸‹å³ä½¿æ˜¯AOFå¼€å¯äº†everysecï¼šç§’çº§å¤‡ä»½ï¼Œä»ç„¶ä¼šä¸¢æ•°æ®çš„é—®é¢˜ï¼Œæ˜¯ç”±äºå­˜åœ¨ç£ç›˜IOè¿‡é«˜é€ æˆè¯·æ±‚å µå¡çš„æƒ…å†µã€‚</p><p>è€Œç½‘ä¸Šå¯¹è¿™ä¸ªé—®é¢˜ç»™å‡ºçš„è§£å†³æ„è§ä¹Ÿå¾ˆçœŸå®</p><p>å‚è€ƒæ–‡çŒ®<br><a href="https://segmentfault.com/a/1190000016096933" target="_blank" rel="noopener">å…³äºRedisçš„aofæŒä¹…åŒ–çš„äºŒä¸‰äº‹</a></p><ul><li>å…³é—­ RDB æˆ– AOF æŒä¹…åŒ–</li></ul><p>è€Œå·²ç»å¼€å¯äº†æ··åˆæŒä¹…åŒ–ç­–ç•¥çš„Redisç›´æ¥å…³é—­RDBå¤‡ä»½å³å¯è§£å†³</p><ul><li>ä»æ“ä½œç³»ç»Ÿå±‚é¢ä¼˜åŒ–ï¼šä¿®æ”¹å†…æ ¸å‚æ•°</li></ul><p>åˆåˆ°äº†å­¦ä¹ linuxå†…æ ¸å‚æ•°çš„æ—¶å€™äº†ï¼Œå“ˆå“ˆ</p><p>AOF rewriteæ˜¯ä¸€ç›´åŸ‹å¤´çš„è°ƒç”¨ write(2)ï¼Œç”±ç³»ç»Ÿè‡ªå·±å»è§¦å‘ syncã€‚</p><p>é»˜è®¤é…ç½®vm.dirty_background_ratio=10ï¼Œä¹Ÿå°±æ˜¯å ç”¨äº† 10% çš„å¯ç”¨å†…å­˜æ‰ä¼šå¼€å§‹åå° flushï¼Œ256*10%=25.6G</p><p>å¾ˆæ˜æ˜¾ä¸€æ¬¡flushå¤ªå¤šæ•°æ®ä¼šé€ æˆå µå¡</p><p>çœ‹äº†ä¸‹ç½‘ä¸Šçš„å»ºè®®éƒ½æ˜¯å°†åˆ·æ–°å¤§å°å†™ä¸º32M</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sysctl -a | grep dirty_background_ratio</span><br><span class="line">vm.dirty_background_ratio &#x3D; 10</span><br><span class="line"> </span><br><span class="line">$ sysctl -a | grep vm.dirty_bytes</span><br><span class="line">vm.dirty_bytes &#x3D; 0</span><br><span class="line"></span><br><span class="line">$ echo &quot;vm.dirty_bytes&#x3D;33554432&quot; &gt;&gt; &#x2F;etc&#x2F;sysctl.conf</span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸‰å±‚ï¼šä»æŠ€æœ¯é€‰å‹ä¸Šæ€è€ƒ"><a href="#ç¬¬ä¸‰å±‚ï¼šä»æŠ€æœ¯é€‰å‹ä¸Šæ€è€ƒ" class="headerlink" title="ç¬¬ä¸‰å±‚ï¼šä»æŠ€æœ¯é€‰å‹ä¸Šæ€è€ƒ"></a>ç¬¬ä¸‰å±‚ï¼šä»æŠ€æœ¯é€‰å‹ä¸Šæ€è€ƒ</h2><p>è¿™ä¸€å±‚å…¶å®æ˜¯æœ€éš¾çš„ï¼Œæˆ‘åœ¨æ€è€ƒä¸ºä»€ä¹ˆRedisä¼šå­˜ä¸Šç™¾Gçš„æ–‡ä»¶ï¼Œè¿˜æ˜¯ç”¨çš„å•æœºDockerå®‰è£…çš„ã€‚åŒäº‹å‘Šè¯‰æˆ‘Redisæ˜¯å­˜å›¾ç‰‡ï¼Œæˆ‘å¯»æ€å­˜å›¾ç‰‡ä¸æ˜¯ç”¨æ–‡ä»¶å­˜å‚¨æœåŠ¡å™¨å—ï¼ˆæ¯”å¦‚é˜¿é‡Œäº‘çš„OSSã€AWSçš„S3ã€æˆ–è€…æœ¬åœ°è‡ªå»ºçš„æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼ŸåŒäº‹å‘Šè¯‰æˆ‘å›¾ç‰‡æ˜¯å­˜å‚¨åœ¨AWSçš„S3ä¸Šçš„ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºåœ¨å›½å†…ï¼Œç›´æ¥è®¿é—®å›¾ç‰‡é€Ÿåº¦å¾ˆæ…¢</p><p>åæ¥äº†è§£åˆ°ï¼Œç”±äºæ¶æ„éœ€è¦ï¼Œä¸­ç¾ä¹‹é—´çš„ç½‘ç»œä¼ è¾“é€Ÿåº¦æ…¢ã€ä¸ç¨³å®šï¼Œå¯¼è‡´åº”ç”¨æœåŠ¡ä¸èƒ½ç›´æ¥ä»S3è®¿é—®ï¼Œè€Œä¸”AWSçš„CDNä¹Ÿæ²¡æœ‰å¼€æ”¾å›½å†…çš„ç«™ç‚¹åŠ é€Ÿï¼Œä¸€å¼ å›¾ç‰‡20å¤šMåŠ è½½é€Ÿåº¦æ…¢ï¼Œç¡®å®å¾ˆéš¾å¤„ç†ã€‚</p><p>è€Œä¸”ç¨‹åºä¼ å›¾ç‰‡ä¸€èˆ¬æ˜¯åœ¨å›½å†…æ™šä¸Šï¼Œä»S3ä¸Šæ‹‰å›¾ç‰‡ç»è¿‡ç¨‹åºæœ€ç»ˆå­˜åˆ°Redisé‡Œï¼Œç„¶ååœ¨ç™½å¤©çš„æ—¶å€™ï¼Œé¡¹ç›®äººå‘˜å¯ä»¥ç›´æ¥è®¿é—®Redisé‡Œçš„å›¾ç‰‡ï¼Œé€Ÿåº¦ä¼šæ¯”ç›´æ¥ä»S3è®¿é—®å¿«å¾ˆå¤šã€‚</p><p>ä½†æ˜¯ç”¨Rediså¤ªæµªè´¹èµ„æºäº†ï¼Œä¸€å°32c 256gçš„æœåŠ¡å™¨å°±è£…äº†Redisï¼Œä½œä¸ºä¸€ä¸ªç‰¹åˆ«å–œæ¬¢è–…ç¾Šæ¯›çš„è¿ç»´å·¥ç¨‹å¸ˆï¼Œæˆ‘å¯¹æ­¤è¡¨ç¤ºï¼šçœŸçš„æœ‰é’±ã€‚</p><p>å› æ­¤æˆ‘æŸ¥çœ‹äº†ç½‘ä¸Šçš„èµ„æ–™ï¼Œå¾—å‡º2ä¸ªè§£å†³æ­¤é—®é¢˜çš„åŠæ³•</p><ul><li>å¢åŠ å…¬å¸ç½‘ç»œå¸¦å®½ï¼Œç¡¬æ–¹æ³•å¤„ç†</li><li>æœ¬åœ°è‡ªå»ºæ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼Œç”¨å›¾ç‰‡ç¼“å­˜åŠŸèƒ½ï¼Œä¿è¯ç”¨æˆ·æ¯æ¬¡è¯·æ±‚åŒæ ·çš„èµ„æºä¸ç”¨å»Redisé‡Œè¯»å–ï¼Œè€Œåº”è¯¥ç›´æ¥è¯»å›¾ç‰‡ç¼“å­˜æœåŠ¡å™¨ï¼Œæœ€ç»å…¸çš„ä¾‹å­å°±æ˜¯Nginxåšé™æ€èµ„æºæœåŠ¡å™¨ã€‚</li></ul><p>ç¬¬ä¸‰å±‚çš„å¤„ç†è¿‡ç¨‹æˆ‘ä»¬ç•™åœ¨ä¸‹æœŸè¿ç»´å®è·µé‡Œç»†è¯´å§</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://redis.io/topics/persistence" target="_blank" rel="noopener">Rediså®˜ç½‘æŒä¹…åŒ–è¯´æ˜</a></p><p><a href="https://www.cnblogs.com/wdliu/p/9377278.html" target="_blank" rel="noopener">Redis4.0æ·±å…¥æŒä¹…åŒ–</a></p><p><a href="https://zhuanlan.zhihu.com/p/39412293" target="_blank" rel="noopener">RedisæŒä¹…åŒ–æ–¹æ¡ˆè¯¥å¦‚ä½•é€‰å‹</a></p><p><a href="https://www.jianshu.com/p/d03216c0150b" target="_blank" rel="noopener">Redis å†™ç£ç›˜å‡ºé”™ Cannot allocate memory</a></p><p><a href="https://segmentfault.com/a/1190000016096933" target="_blank" rel="noopener">å…³äºRedisçš„aofæŒä¹…åŒ–çš„äºŒä¸‰äº‹</a></p>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Operation Manual </tag>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos7å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDAä»¥åŠDocker-GPUç¯å¢ƒ</title>
      <link href="/2020/08/28/gpu/nvidia-install/"/>
      <url>/2020/08/28/gpu/nvidia-install/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬äºŒå®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>é¢†å¯¼æœ‰éœ€æ±‚è®©åœ¨AWSä¸Šä¹°ä¸€å°GPUçš„æœåŠ¡å™¨ï¼Œè¿›è¡Œå®‰è£…éƒ¨ç½²3Då»ºæ¨¡é¡¹ç›®çš„é›†æˆå¼€å‘ç¯å¢ƒ</p><h1 id="å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDA"><a href="#å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDA" class="headerlink" title="å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDA"></a>å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDA</h1><p>æˆ‘è´­ä¹°äº†ä¸€å°g3s.xlargeå‹å·çš„ec2ï¼Œé€‰æ‹©centos7 é…ç½®å¥½ç½‘ç»œã€ç£ç›˜ã€å®‰å…¨ç»„å’Œæ ‡ç­¾å°±å‡†å¤‡å¼€æœºå®‰è£…äº†</p><h2 id="æŸ¥çœ‹æ˜¾å¡å‹å·"><a href="#æŸ¥çœ‹æ˜¾å¡å‹å·" class="headerlink" title="æŸ¥çœ‹æ˜¾å¡å‹å·"></a>æŸ¥çœ‹æ˜¾å¡å‹å·</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@loaclhost ~]# yum install pciutils -y</span><br><span class="line">[root@loaclhost ~]# lspci | grep -i NVIDIA</span><br><span class="line">00:1e.0 VGA compatible controller: NVIDIA Corporation GM204GL [Tesla M60] (rev a1)</span><br></pre></td></tr></table></figure><p>Googleåå‘ç°</p><p>NVIDIAÂ® TeslaÂ® GPUæ˜¯é€‚ç”¨äºæœåŠ¡å™¨çš„ TESLA æ•°æ®ä¸­å¿ƒçš„ GPU</p><p>å®ƒå¯ä»¥æ›´å¿«é€Ÿåœ°å¤„ç†è¦æ±‚æœ€ä¸¥æ ¼çš„é«˜æ€§èƒ½è®¡ç®— (HPC) å’Œè¶…å¤§è§„æ¨¡æ•°æ®ä¸­å¿ƒå·¥ä½œè´Ÿè½½ã€‚</p><h2 id="åœ¨Linuxå®ä¾‹ä¸Šå®‰è£…NVIDIA-GRIDé©±åŠ¨ç¨‹åº"><a href="#åœ¨Linuxå®ä¾‹ä¸Šå®‰è£…NVIDIA-GRIDé©±åŠ¨ç¨‹åº" class="headerlink" title="åœ¨Linuxå®ä¾‹ä¸Šå®‰è£…NVIDIA GRIDé©±åŠ¨ç¨‹åº"></a>åœ¨Linuxå®ä¾‹ä¸Šå®‰è£…NVIDIA GRIDé©±åŠ¨ç¨‹åº</h2><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>å®‰è£…NVIDIA GRIDé©±åŠ¨ç¨‹åºçš„ä¾èµ–ä»¥åŠAWS CLI</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum update -y</span><br><span class="line">yum install -y lrzsz vim wget ntpdate yum-utils zip unzip tree  gcc gcc-c++  epel-release</span><br><span class="line">curl &quot;https:&#x2F;&#x2F;awscli.amazonaws.com&#x2F;awscli-exe-linux-x86_64.zip&quot; -o &quot;awscliv2.zip&quot;</span><br><span class="line">unzip awscliv2.zip</span><br><span class="line">sudo .&#x2F;aws&#x2F;install</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>é…ç½®AWSå¹¶ç¡®ä¿IAMç”¨æˆ·å¿…é¡»å…·æœ‰AmazonS3ReadOnlyAccess ç­–ç•¥æˆäºˆçš„æƒé™ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws configure</span><br></pre></td></tr></table></figure><p>ä¸ºæ‚¨å½“å‰æ­£åœ¨è¿è¡Œçš„å†…æ ¸ç‰ˆæœ¬å®‰è£…gccç¼–è¯‘å™¨å’Œå†…æ ¸å¤´æ–‡ä»¶åŒ…ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc kernel-devel-$(uname -r)</span><br></pre></td></tr></table></figure><p>ç¦ç”¨nouveauNVIDIAå›¾å½¢å¡çš„å¼€æºé©±åŠ¨ç¨‹åºã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">æ·»åŠ nouveauåˆ° &#x2F;etc&#x2F;modprobe.d&#x2F;blacklist.confé»‘åå•æ–‡ä»¶ã€‚</span><br><span class="line">cat &lt;&lt; EOF | sudo tee --append &#x2F;etc&#x2F;modprobe.d&#x2F;blacklist.conf</span><br><span class="line">blacklist vga16fb</span><br><span class="line">blacklist nouveau</span><br><span class="line">blacklist rivafb</span><br><span class="line">blacklist nvidiafb</span><br><span class="line">blacklist rivatv</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">ç¼–è¾‘&#x2F;etc&#x2F;default&#x2F;grubæ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹è¡Œï¼š</span><br><span class="line">GRUB_CMDLINE_LINUX&#x3D;&quot;rdblacklist&#x3D;nouveau&quot;</span><br><span class="line"></span><br><span class="line">é‡å»ºGrubé…ç½®</span><br><span class="line">grub2-mkconfig -o &#x2F;boot&#x2F;grub2&#x2F;grub.cfg</span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹è½½GRIDé©±åŠ¨ç¨‹åºå®‰è£…å®ç”¨ç¨‹åº</span><br><span class="line">aws s3 cp --recursive s3:&#x2F;&#x2F;ec2-linux-nvidia-drivers&#x2F;latest&#x2F; .</span><br><span class="line">chmod +x NVIDIA-Linux-x86_64*.run</span><br><span class="line">sudo &#x2F;bin&#x2F;sh .&#x2F;NVIDIA-Linux-x86_64*.run</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><p>å‡ºç°æç¤ºæ—¶ï¼Œæ¥å—è®¸å¯åè®®å¹¶æ ¹æ®éœ€è¦æŒ‡å®šå®‰è£…é€‰é¡¹</p><p>éƒ¨ç½²å®Œæˆåæ‰§è¡Œè¯´æ˜å®‰è£…æˆåŠŸ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@ ~]# nvidia-smi </span><br><span class="line">Thu Aug 27 06:15:12 2020       </span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 450.51.05    Driver Version: 450.51.05    CUDA Version: 11.0     |</span><br><span class="line">|-------------------------------+----------------------+----------------------+</span><br><span class="line">| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp  Perf  Pwr:Usage&#x2F;Cap|         Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|                               |                      |               MIG M. |</span><br><span class="line">|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;+&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;+&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|</span><br><span class="line">|   0  Tesla M60           On   | 00000000:00:1E.0 Off |                    0 |</span><br><span class="line">| N&#x2F;A   33C    P8    15W &#x2F; 150W |      0MiB &#x2F;  7618MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N&#x2F;A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">                                                                               </span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| Processes:                                                                  |</span><br><span class="line">|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |</span><br><span class="line">|        ID   ID                                                   Usage      |</span><br><span class="line">|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|</span><br><span class="line">|  No running processes found                                                 |</span><br></pre></td></tr></table></figure><h1 id="è¿è¡Œ3Dç¨‹åº"><a href="#è¿è¡Œ3Dç¨‹åº" class="headerlink" title="è¿è¡Œ3Dç¨‹åº"></a>è¿è¡Œ3Dç¨‹åº</h1><p>ç›®å‰å…¬å¸çš„3Dé¡¹ç›®å¯ä»¥å·²ç»ç”¨Dockeréƒ¨ç½²ï¼ŒæŸ¥é˜…dockerå®˜ç½‘å‘ç°dockeråœ¨19ç‰ˆæœ¬ååœ¨docker run â€“gpus all å³å¯(è¡¨ç¤ºä½¿ç”¨æ‰€æœ‰çš„gpuï¼Œå¦‚æœè¦ä½¿ç”¨2ä¸ªgpuï¼šâ€“gpus 2ï¼Œä¹Ÿå¯ç›´æ¥æŒ‡å®šå“ªå‡ ä¸ªå¡ï¼šâ€“gpus â€˜â€œdevice=1,2â€â€™</p><p>åœ¨docker19ä¹‹å‰éœ€è¦å•ç‹¬ä¸‹è½½nvidia-docker1æˆ–nvidia-docker2æ¥å¯åŠ¨å®¹å™¨</p><p>ç›®å‰æœ€æ–°çš„dockerç‰ˆæœ¬æ˜¯19.03.12ï¼Œå³ä¸éœ€è¦é¢å¤–å®‰è£…nvidia-docker</p><h2 id="å®‰è£…Docker"><a href="#å®‰è£…Docker" class="headerlink" title="å®‰è£…Docker"></a>å®‰è£…Docker</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ ~]# yum install -y yum-utils </span><br><span class="line">[root@ ~]# yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">[root@ ~]# yum install -y docker-ce docker-ce-cli containerd.io</span><br><span class="line">[root@ ~]# systemctl start docker</span><br><span class="line">[root@ ~]# docker -v</span><br><span class="line">Docker version 19.03.12, build 48a66213fe</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…GPUå®¹å™¨è¿è¡Œæ—¶"><a href="#å®‰è£…GPUå®¹å™¨è¿è¡Œæ—¶" class="headerlink" title="å®‰è£…GPUå®¹å™¨è¿è¡Œæ—¶"></a>å®‰è£…GPUå®¹å™¨è¿è¡Œæ—¶</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">distribution&#x3D;$(. &#x2F;etc&#x2F;os-release;echo $ID$VERSION_ID)</span><br><span class="line">curl -s -L https:&#x2F;&#x2F;nvidia.github.io&#x2F;nvidia-docker&#x2F;$distribution&#x2F;nvidia-docker.repo | sudo tee &#x2F;etc&#x2F;yum.repos.d&#x2F;nvidia-docker.repo</span><br><span class="line"></span><br><span class="line">sudo yum install -y nvidia-container-toolkit</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="éªŒè¯dockerå¯ä»¥ä½¿ç”¨GPU"><a href="#éªŒè¯dockerå¯ä»¥ä½¿ç”¨GPU" class="headerlink" title="éªŒè¯dockerå¯ä»¥ä½¿ç”¨GPU"></a>éªŒè¯dockerå¯ä»¥ä½¿ç”¨GPU</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker run --help | grep -i gpus</span><br><span class="line">      --gpus gpu-request               GPU devices to add to the container (&#39;all&#39; to pass all GPUs)</span><br><span class="line">      </span><br><span class="line">docker run -it --rm --gpus all ubuntu nvidia-smi</span><br><span class="line">Thu Aug 27 09:57:43 2020       </span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 450.51.05    Driver Version: 450.51.05    CUDA Version: N&#x2F;A      |</span><br><span class="line">|-------------------------------+----------------------+----------------------+</span><br><span class="line">| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp  Perf  Pwr:Usage&#x2F;Cap|         Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|                               |                      |               MIG M. |</span><br><span class="line">|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;+&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;+&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|</span><br><span class="line">|   0  Tesla M60           On   | 00000000:00:1E.0 Off |                    0 |</span><br><span class="line">| N&#x2F;A   32C    P8    15W &#x2F; 150W |      0MiB &#x2F;  7618MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N&#x2F;A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">                                                                               </span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| Processes:                                                                  |</span><br><span class="line">|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |</span><br><span class="line">|        ID   ID                                                   Usage      |</span><br><span class="line">|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|</span><br><span class="line">|  No running processes found                                                 |</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure><p>è¯´æ˜å¯ä»¥è¿è¡Œ</p><h1 id="æŠ¥é”™æ€»ç»“"><a href="#æŠ¥é”™æ€»ç»“" class="headerlink" title="æŠ¥é”™æ€»ç»“"></a>æŠ¥é”™æ€»ç»“</h1><p>æ‰§è¡Œsudo /bin/sh ./NVIDIA-Linux-x86_64*.runæ—¶æŠ¥é”™</p><h2 id="Nouveau-kernel-driver"><a href="#Nouveau-kernel-driver" class="headerlink" title="Nouveau kernel driver"></a>Nouveau kernel driver</h2><p>ERROR: The Nouveau kernel driver is currently in use by your system.  This driver is incompatible with the NVIDIA driver, and must be disabled before proceeding.  Please consult<br>         the NVIDIA driver README and your Linux distributionâ€™s documentation for details on how to correctly disable the Nouveau kernel driver. </p><p>è¿™ä¸ªé©±åŠ¨æ­£åœ¨è¢«ç³»ç»Ÿä½¿ç”¨,è¿™ä¸ªé©±åŠ¨å’ŒNvidiaé©±åŠ¨å†²çª,è¦æƒ³ç»§ç»­å®‰è£…,åˆ™å¿…é¡»ç¦ç”¨æ­¤é©±åŠ¨ï¼å› ä¸ºcentos ç³»ç»Ÿé»˜è®¤è£…çš„æ˜¾å¡é©±åŠ¨å°±æ˜¯Nouveau .ã€€Nouveauæ˜¯ä¸€ä¸ªç”±çˆ±å¥½è€…ç»„ç»‡çš„é’ˆå¯¹NVIDIAæ˜¾å¡å¼€å‘ç¬¬ä¸‰æ–¹å¼€æº3Dé©±åŠ¨çš„å…±åŒé¡¹ç›®ï¼Œå¹¶ä¸”Nouveauæ˜¯åœ¨å®Œå…¨æ²¡æœ‰å¾—åˆ°NVIDIAä»»ä½•æ”¯ æŒçš„æƒ…å†µä¸‹è¿›è¡Œå¼€å‘çš„ï¼ŒNouveauç®—æ˜¯X.OrgåŸºé‡‘ä¼šçš„ä¸€ä¸ªé¡¹ç›®.</p><p>è§£å†³åŠæ³•å¦‚ä¸‹ï¼š</p><p>å³å…³é—­Nouveauï¼š         </p><p>æ£€æŸ¥nouveau driverç¡®ä¿æ²¡æœ‰è¢«åŠ è½½ï¼</p><p>lsmod | grep nouveau</p><h2 id="å®‰è£…å®ŒGPUå®¹å™¨è¿è¡Œæ—¶æŠ¥é”™"><a href="#å®‰è£…å®ŒGPUå®¹å™¨è¿è¡Œæ—¶æŠ¥é”™" class="headerlink" title="å®‰è£…å®ŒGPUå®¹å™¨è¿è¡Œæ—¶æŠ¥é”™"></a>å®‰è£…å®ŒGPUå®¹å™¨è¿è¡Œæ—¶æŠ¥é”™</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@ ~]# docker run -it --rm --gpus all ubuntu nvidia-smi</span><br><span class="line">Unable to find image &#39;ubuntu:latest&#39; locally</span><br><span class="line">latest: Pulling from library&#x2F;ubuntu</span><br><span class="line">54ee1f796a1e: Pull complete </span><br><span class="line">f7bfea53ad12: Pull complete </span><br><span class="line">46d371e02073: Pull complete </span><br><span class="line">b66c17bbf772: Pull complete </span><br><span class="line">Digest: sha256:31dfb10d52ce76c5ca0aa19d10b3e6424b830729e32a89a7c6eee2cda2be67a5</span><br><span class="line">Status: Downloaded newer image for ubuntu:latest</span><br><span class="line">docker: Error response from daemon: could not select device driver &quot;&quot; with capabilities: [[gpu]].</span><br></pre></td></tr></table></figure><p>è§£å†³åŠæ³•ï¼Œé‡å¯docker</p><p>systemctl restart docker</p><p>å¦‚æœè¿˜ä¸è¡Œï¼Œè¯´æ˜ä½ æ²¡æœ‰å®‰è£…GPUå®¹å™¨è¿è¡Œæ—¶</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/install-nvidia-driver.html#nvidia-GRID-driver" target="_blank" rel="noopener">åœ¨Linuxå®ä¾‹ä¸Šå®‰è£…NVIDIAé©±åŠ¨ç¨‹åº</a></p><p><a href="https://github.com/NVIDIA/nvidia-docker" target="_blank" rel="noopener">nvidia-docker</a></p>]]></content>
      
      
      <categories>
          
          <category> NVIDIA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> NVIDIA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos7å®‰è£…Nodejs-v12.6.0</title>
      <link href="/2020/08/22/nodejs/nodejs-install/"/>
      <url>/2020/08/22/nodejs/nodejs-install/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬äºŒå®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="å®‰è£…Nodejs"><a href="#å®‰è£…Nodejs" class="headerlink" title="å®‰è£…Nodejs"></a>å®‰è£…Nodejs</h1><p><a href="https://nodejs.org/en/" target="_blank" rel="noopener">Nodejså®˜ç½‘ä¸‹è½½</a></p><p><a href="https://nodejs.org/dist/" target="_blank" rel="noopener">Nodejsåˆ—è¡¨</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;opt</span><br><span class="line">wget https:&#x2F;&#x2F;nodejs.org&#x2F;dist&#x2F;v12.6.0&#x2F;node-v12.6.0-linux-x64.tar.gz</span><br><span class="line">tar -zxvf node-v12.6.0-linux-x64.tar.gz</span><br><span class="line">mv node-v12.6.0-linux-x64 nodejs</span><br><span class="line">ln -s &#x2F;opt&#x2F;nodejs&#x2F;bin&#x2F;npm &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br><span class="line">ln -s &#x2F;opt&#x2F;nodejs&#x2F;bin&#x2F;node &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹å®‰è£…çš„ç‰ˆæœ¬</span><br><span class="line">[root@localhost]# node -v</span><br><span class="line">v12.6.0</span><br><span class="line">[root@localhost]# npm -v </span><br><span class="line">6.9.0</span><br></pre></td></tr></table></figure><h1 id="nodejs-installæŠ¥é”™"><a href="#nodejs-installæŠ¥é”™" class="headerlink" title="nodejs installæŠ¥é”™"></a>nodejs installæŠ¥é”™</h1><h2 id="æ‰§è¡Œnpm-istall-å‘½ä»¤æ—¶ï¼Œå‡ºç°äº†npm-ERR-cb-never-called-é”™è¯¯"><a href="#æ‰§è¡Œnpm-istall-å‘½ä»¤æ—¶ï¼Œå‡ºç°äº†npm-ERR-cb-never-called-é”™è¯¯" class="headerlink" title="æ‰§è¡Œnpm istall å‘½ä»¤æ—¶ï¼Œå‡ºç°äº†npm ERR! cb() never called!é”™è¯¯"></a>æ‰§è¡Œnpm istall å‘½ä»¤æ—¶ï¼Œå‡ºç°äº†npm ERR! cb() never called!é”™è¯¯</h2><p>è§£å†³æ–¹æ¡ˆï¼šæ¸…é™¤npmç¼“å­˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm ERR! cb() never called!</span><br></pre></td></tr></table></figure><h2 id="æ‰“åŒ…å‡ºç°node-modules-node-sass-vendoræ–‡ä»¶å¤¹permission-deniedæƒé™ä¸è¶³çš„é—®é¢˜"><a href="#æ‰“åŒ…å‡ºç°node-modules-node-sass-vendoræ–‡ä»¶å¤¹permission-deniedæƒé™ä¸è¶³çš„é—®é¢˜" class="headerlink" title="æ‰“åŒ…å‡ºç°node_modules/node-sass/vendoræ–‡ä»¶å¤¹permission deniedæƒé™ä¸è¶³çš„é—®é¢˜"></a>æ‰“åŒ…å‡ºç°node_modules/node-sass/vendoræ–‡ä»¶å¤¹permission deniedæƒé™ä¸è¶³çš„é—®é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">node-sass@4.13.1 install &#x2F;starlab&#x2F;www&#x2F;cloudtest&#x2F;node_modules&#x2F;node-sass</span><br><span class="line">&gt; node scripts&#x2F;install.js</span><br><span class="line"></span><br><span class="line">Unable to save binary &#x2F;starlab&#x2F;www&#x2F;cloudtest&#x2F;node_modules&#x2F;node-sass&#x2F;vendor&#x2F;linux-x64-64 : &#123; Error: EACCES: permission denied, mkdir &#39;&#x2F;starlab&#x2F;www&#x2F;cloudtest&#x2F;node_modules&#x2F;node-sass&#x2F;vendor&#39;</span><br><span class="line">    at Object.mkdirSync (fs.js:757:3)</span><br><span class="line">    at sync (&#x2F;starlab&#x2F;www&#x2F;cloudtest&#x2F;node_modules&#x2F;mkdirp&#x2F;index.js:71:13)</span><br><span class="line">    at Function.sync (&#x2F;starlab&#x2F;www&#x2F;cloudtest&#x2F;node_modules&#x2F;mkdirp&#x2F;index.js:77:24)</span><br><span class="line">    at checkAndDownloadBinary (&#x2F;starlab&#x2F;www&#x2F;cloudtest&#x2F;node_modules&#x2F;node-sass&#x2F;scripts&#x2F;install.js:114:11)</span><br><span class="line">    at Object.&lt;anonymous&gt; (&#x2F;starlab&#x2F;www&#x2F;cloudtest&#x2F;node_modules&#x2F;node-sass&#x2F;scripts&#x2F;install.js:157:1)</span><br><span class="line">    at Module._compile (internal&#x2F;modules&#x2F;cjs&#x2F;loader.js:778:30)</span><br><span class="line">    at Object.Module._extensions..js (internal&#x2F;modules&#x2F;cjs&#x2F;loader.js:789:10)</span><br><span class="line">    at Module.load (internal&#x2F;modules&#x2F;cjs&#x2F;loader.js:653:32)</span><br><span class="line">    at tryModuleLoad (internal&#x2F;modules&#x2F;cjs&#x2F;loader.js:593:12)</span><br><span class="line">    at Function.Module._load (internal&#x2F;modules&#x2F;cjs&#x2F;loader.js:585:3)</span><br><span class="line">  errno: -13,</span><br><span class="line">  syscall: &#39;mkdir&#39;,</span><br><span class="line">  code: &#39;EACCES&#39;,</span><br><span class="line">  path: &#39;&#x2F;starlab&#x2F;www&#x2F;cloudtest&#x2F;node_modules&#x2F;node-sass&#x2F;vendor&#39; &#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆé€ æˆè¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ï¼š<br>npmä¼šæœ‰ç”Ÿå‘½å‘¨æœŸï¼ŒæŸä¸ªåŒ…ä¼šæœ‰ç”Ÿå‘½å‘¨æœŸæ¥æ‰§è¡Œä¸€äº›ä¸œè¥¿ï¼Œå®‰å…¨èµ·è§ä¼šè‡ªåŠ¨é™çº§å¯¼è‡´æ²¡æœ‰æƒé™æ‰§è¡Œä¸€äº›æ“ä½œï¼Œé€šè¿‡â€“unsafe-permå‚æ•°æ¥è§£é”è¯¥é™åˆ¶ã€‚</p><p>npm lifecycle å‘½ä»¤åœ¨æ‰§è¡Œå‰ï¼Œä¼šåˆ¤æ–­é…ç½®unsafe-permä¸ºtrue æ—¶æ‰ç»§ç»­ï¼Œå¦åˆ™ä¼šæå‰é€€å‡ºã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; lib&#x2F;utils&#x2F;lifecycle.js</span><br><span class="line">   unsafe &#x3D; unsafe || npm.config.get(&#39;unsafe-perm&#39;)</span><br><span class="line">   if ((wd.indexOf(npm.dir) !&#x3D;&#x3D; 0 || _incorrectWorkingDirectory(wd, pkg)) &amp;&amp; !unsafe &amp;&amp; pkg.scripts[stage]) &#123;</span><br><span class="line">     log.warn(&#39;lifecycle&#39;, logid(pkg, stage), &#39;cannot run in wd&#39;,</span><br><span class="line">       &#39;%s %s (wd&#x3D;%s)&#39;, pkg._id, pkg.scripts[stage], wd</span><br><span class="line">     )</span><br><span class="line">     return cb()</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>é…ç½®çš„è¯»å–é¡ºåºå¤§è‡´å‚è€ƒï¼šnpm-configï¼Œå³cli -&gt; env -&gt; npmrc -&gt; defaultã€‚</p><p>defaultä¸­å…³äºunsafe-permçš„åˆå§‹åŒ–å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; lib&#x2F;config&#x2F;defaults.js</span><br><span class="line">    &#39;unsafe-perm&#39;: process.platform &#x3D;&#x3D;&#x3D; &#39;win32&#39; ||</span><br><span class="line">                     process.platform &#x3D;&#x3D;&#x3D; &#39;cygwin&#39; ||</span><br><span class="line">                     !(process.getuid &amp;&amp; process.setuid &amp;&amp;</span><br><span class="line">                       process.getgid &amp;&amp; process.setgid) ||</span><br><span class="line">                     process.getuid() !&#x3D;&#x3D; 0</span><br></pre></td></tr></table></figure><p>é’ˆå¯¹unix å¹³å°ï¼Œä½¿ç”¨root ç”¨æˆ·æ‰§è¡Œnpm å‘½ä»¤æ—¶å¾—åˆ°çš„é»˜è®¤å€¼éƒ½ä¼šæ˜¯falseã€‚</p><p>è§£å†³åŠæ³•ï¼š</p><p>ä¸´æ—¶è§£å†³ï¼šnpm install â€“unsafe-perm</p><p>æ°¸ä¹…è§£å†³ï¼šnpm config set unsafe-perm true</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://www.cnblogs.com/chrissong/p/10961521.html" target="_blank" rel="noopener">node-sasså®‰è£…å¤±è´¥çš„é—®é¢˜ stack Error: EACCES: permission denied, mkdir</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿ç»´æ‰‹å†Œâ€”â€”Mysqlç´¢å¼•å­—æ®µé•¿åº¦å¤ªé•¿æŠ¥é”™</title>
      <link href="/2020/08/22/bug/mysql-key-long/"/>
      <url>/2020/08/22/bug/mysql-key-long/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬äºŒå®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>Mysqlæ‰§è¡ŒCreate Tableè¯­å¥æ—¶æŠ¥é”™</p><p>Specified key was too long; max key length is 1536 bytes</p><h1 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h1><p>ä¹‹å‰é‡åˆ°è¿‡æŠ¥é”™ä¿¡æ¯â€œERROR 1071 (42000): Specified key was too long; max key length is 767 bytesâ€ï¼Œå…¶å®æ„æ€å°±æ˜¯â€œç´¢å¼•å­—æ®µé•¿åº¦å¤ªé•¿ï¼Œè¶…è¿‡äº†767bytesâ€ã€‚</p><p>mysqlçš„varcharä¸»é”®åªæ”¯æŒä¸è¶…è¿‡767ä¸ªå­—èŠ‚æˆ–è€…768/2=384ä¸ªåŒå­—èŠ‚ æˆ–è€…767/3=255ä¸ªä¸‰å­—èŠ‚çš„å­—æ®µ è€ŒGBKæ˜¯åŒå­—èŠ‚çš„ï¼ŒUTF8æ˜¯ä¸‰å­—èŠ‚çš„ã€‚</p><p>å¯æ˜¯è¿™æ¬¡å±…ç„¶è¶…è¿‡äº†è¿™ä¸ªé•¿åº¦1536ï¼Œä»”ç»†å‘ç°1536/2=768 ä¸ºä»€ä¹ˆæ˜¯768ï¼Ÿ</p><p>ç„¶åæˆ‘ä»”ç»†çœ‹äº†ä¸‹DDLè¯­å¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;QRTZ_BLOB_TRIGGERS&#96; (</span><br><span class="line">  &#96;SCHED_NAME&#96; varchar(120) COLLATE utf8mb4_unicode_ci NOT NULL,</span><br><span class="line">  &#96;TRIGGER_NAME&#96; varchar(190) COLLATE utf8mb4_unicode_ci NOT NULL,</span><br><span class="line">  &#96;TRIGGER_GROUP&#96; varchar(190) COLLATE utf8mb4_unicode_ci NOT NULL,</span><br><span class="line">  &#96;BLOB_DATA&#96; mediumblob,</span><br><span class="line">  PRIMARY KEY (&#96;SCHED_NAME&#96;,&#96;TRIGGER_NAME&#96;,&#96;TRIGGER_GROUP&#96;) USING BTREE,</span><br><span class="line">  KEY &#96;SCHED_NAME&#96; (&#96;SCHED_NAME&#96;,&#96;TRIGGER_NAME&#96;,&#96;TRIGGER_GROUP&#96;) USING BTREE,</span><br><span class="line">  CONSTRAINT &#96;QRTZ_BLOB_TRIGGERS_ibfk_1&#96; FOREIGN KEY (&#96;SCHED_NAME&#96;, &#96;TRIGGER_NAME&#96;, &#96;TRIGGER_GROUP&#96;) REFERENCES &#96;QRTZ_TRIGGERS&#96; (&#96;SCHED_NAME&#96;, &#96;TRIGGER_NAME&#96;, &#96;TRIGGER_GROUP&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4 COLLATE&#x3D;utf8mb4_unicode_ci ROW_FORMAT&#x3D;DYNAMIC;</span><br></pre></td></tr></table></figure><p>æˆ‘çš„å¤©ï¼Œè¿™ä¸ªè”åˆç´¢å¼•å±…ç„¶é•¿åº¦ä¸€å…±æ˜¯500ä¸ªå­—ç¬¦ï¼Œä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆè¡¨ç»“æ„å‘¢ï¼Ÿæ„Ÿè§‰ä¸ä¼¦ä¸ç±»ï¼Œå¼€å‘åŒäº‹å›å¤è¯´æ˜¯å¼•ç”¨ç¬¬ä¸‰æ–¹è¡¨çš„DDLï¼Œå¥½å§ï¼Œä¸ºäº†ä¿æŒè¿™ä¸ªè¡¨ç»“æ„ï¼Œæˆ‘åªèƒ½ä»æ•°æ®åº“åº•å±‚ä¼˜åŒ–æŸ¥èµ·ã€‚</p><p>å› ä¸º InnoDB è¡¨å¼•æ“çš„é™åˆ¶ï¼š</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç´¢å¼•å‰ç¼€é•¿åº¦é™åˆ¶ä¸º 767 å­—èŠ‚ï¼Œå½“å¼€å¯äº† innodb_large_prefix é€‰é¡¹æ—¶ï¼Œç´¢å¼•å‰ç¼€é•¿åº¦æ‰©å±•åˆ° 3072 å­—èŠ‚ã€‚</p><p>æŸ¥è¯¢èµ„æ–™å‘ç°ç›´æ¥ä¸‹é¢è¯­å¥å³å¯æ›´æ”¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set global innodb_large_prefix&#x3D;1;</span><br><span class="line">set global innodb_file_format&#x3D;BARRACUDA;</span><br></pre></td></tr></table></figure><p>è¡¥å……ä¸€ä¸ªé¢å¤–çŸ¥è¯†</p><p>å¦‚æœè¡¨çš„å­—ç¬¦é›†æ˜¯ utf8mb4 æ—¶ï¼Œä¸€ä¸ªå­—ç¬¦å°†å ç”¨ 4 ä¸ªå­—èŠ‚ã€‚è¿™æ„å‘³ç€è¿™ä¸ªè¡¨çš„ç´¢å¼•éœ€è¦å 500*4=2000ä¸ªå­—èŠ‚ è¶…è¿‡äº†1536ï¼Œç„¶åæˆ‘ä»¬å†æ¥çœ‹çœ‹1536æ˜¯æ€ä¹ˆæ¥çš„ã€‚</p><p>ç”±äºä¹‹å‰ä¼˜åŒ–è¿‡my.cnf,å…¶ä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªå‚æ•°innodb_page_size<br>æˆ‘è®¾ç½®çš„æ˜¯8kb</p><p>innodb_page_size é€‰é¡¹é»˜è®¤æ˜¯ 16KB çš„æ—¶å€™ï¼Œæœ€é•¿ç´¢å¼•å‰ç¼€é•¿åº¦æ˜¯ 3072 å­—èŠ‚ï¼Œå¦‚æœæ˜¯ 8KB çš„æ—¶å€™ï¼Œæœ€é•¿ç´¢å¼•å‰ç¼€é•¿åº¦æ˜¯ 1536 å­—èŠ‚ï¼Œ4KB çš„æ—¶å€™ï¼Œæ˜¯ 768 å­—èŠ‚ã€‚</p><h1 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h1><ul><li>ä¿®æ”¹DDLè¯­å¥</li></ul><p>è§£å†³æ ¹æœ¬åŸå› ï¼Œå³ä½¿ç”¨çš„æ˜¯ç¬¬ä¸‰æ–¹æä¾›çš„ï¼Œæ˜æ˜æœ‰é—®é¢˜ä¸ºå•¥ä¸å°è¯•æ”¹æ”¹å‘¢ï¼Ÿ</p><ul><li><p>æ›´æ”¹innodb_large_prefixï¼Œä¸éœ€è¦é‡å¯æ•°æ®åº“</p></li><li><p>æ›´æ”¹innodb_page_sizeï¼Œéœ€è¦é‡å¯æ•°æ®åº“</p></li></ul><p>å…¶ä¸­ç¬¬ä¸‰ç§æ–¹æ³•åˆå¼•å‡ºäº†å¦ä¸€ä¸ªé—®é¢˜ï¼Œé‡å¯MysqlæŠ¥é”™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Data file &#39;.&#x2F;ibdata1&#39; uses page size 8192, but the innodb_page_size start-up parameter is 16384</span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾ç½‘ä¸Šèµ„æ–™å‘ç°åŸå› </p><p>å½“innodbå·²ç»è¿è¡Œæ—¶ï¼Œinnodb_page_sizeä¸ºåªè¯»ï¼Œå› ä¸ºå¿…é¡»åœ¨å¯åŠ¨InnoDBä¹‹å‰è®¾ç½®è¯¥å‚æ•°ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„è¡¨ç©ºé—´ç³»ç»Ÿã€‚å½“InnoDBåœ¨æ•°æ®ç›®å½•ä¸­æ‰¾ä¸åˆ°ibdata1æ—¶ï¼Œä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚</p><p>è§£å†³åŠæ³•ï¼š</p><p>å¤‡ä»½åŸæ•°æ®åº“ï¼Œé‡å»ºæ•°æ®åº“ï¼Œåœ¨å¯åŠ¨å‘½ä»¤çš„etc/my.cnfé‡Œæ·»åŠ innodb_page_sizeçš„å€¼ï¼Œå¯åŠ¨ï¼Œå¯¼å…¥åŸæ•°æ®åº“ã€‚ï¼ˆå…¶å®è¿™ç§æ–¹æ³•å¾ˆè ¢ï¼Œä½†æ˜¯å½“å‰æ•°æ®åº“æ˜¯æµ‹è¯•ç¯å¢ƒçš„ï¼Œæ‰€ä»¥è¿™æ ·æ“ä½œæ²¡å•¥é—®é¢˜ï¼Œè¦æ˜¯ç”Ÿäº§å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œåªèƒ½GGï¼‰</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://bugs.mysql.com/bug.php?id=88746" target="_blank" rel="noopener">é”™è¯¯ï¼ƒ88746    ç®€åŒ–InnoDBé¡µé¢å¤§å°çš„é…ç½®</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Operation Manual </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®‰è£…AWS CLIåŠé…ç½®</title>
      <link href="/2020/08/21/aws/aws-install/"/>
      <url>/2020/08/21/aws/aws-install/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬äºŒå®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>AWS Command Line Interfaceï¼ˆAWS CLIï¼‰æ˜¯ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œä½¿æ‚¨èƒ½å¤Ÿä½¿ç”¨å‘½ä»¤è¡Œå¤–å£³ä¸­çš„å‘½ä»¤ä¸AWSæœåŠ¡è¿›è¡Œäº¤äº’ã€‚é€šè¿‡æœ€å°‘çš„é…ç½®ï¼ŒAWS CLIä½¿æ‚¨èƒ½å¤Ÿä»æ‚¨å–œæ¬¢çš„ç»ˆç«¯ç¨‹åºä¸­çš„å‘½ä»¤æç¤ºç¬¦å¤„å¯åŠ¨è¿è¡Œä¸åŸºäºæµè§ˆå™¨çš„AWSç®¡ç†æ§åˆ¶å°æä¾›çš„åŠŸèƒ½ç­‰æ•ˆçš„å‘½ä»¤ã€‚</p><p>ç›®å‰å…¬å¸å¾ˆå¤šäº‘å¹³å°ç»„ä»¶çš„æ§åˆ¶æ–¹æ³•éƒ½æ˜¯åŸºäºAWS CLIï¼ˆå†™åœ¨è‡ªåŠ¨åŒ–è„šæœ¬é‡Œï¼‰å®Œæˆçš„</p><h1 id="å®‰è£…AWS-CLIç‰ˆæœ¬2"><a href="#å®‰è£…AWS-CLIç‰ˆæœ¬2" class="headerlink" title="å®‰è£…AWS CLIç‰ˆæœ¬2"></a>å®‰è£…AWS CLIç‰ˆæœ¬2</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl &quot;https:&#x2F;&#x2F;awscli.amazonaws.com&#x2F;awscli-exe-linux-x86_64.zip&quot; -o &quot;awscliv2.zip&quot;</span><br><span class="line">unzip awscliv2.zip</span><br><span class="line">sudo .&#x2F;aws&#x2F;install</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨get-login-passwordå°†Dockerè®¤è¯åˆ°Amazon-ECRæ³¨å†Œè¡¨"><a href="#ä½¿ç”¨get-login-passwordå°†Dockerè®¤è¯åˆ°Amazon-ECRæ³¨å†Œè¡¨" class="headerlink" title="ä½¿ç”¨get-login-passwordå°†Dockerè®¤è¯åˆ°Amazon ECRæ³¨å†Œè¡¨"></a>ä½¿ç”¨get-login-passwordå°†Dockerè®¤è¯åˆ°Amazon ECRæ³¨å†Œè¡¨</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws ecr get-login-password --region region | docker login --username AWS --password-stdin aws_account_id.dkr.ecr.region.amazonaws.com</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨AWS-Configureå¿«é€Ÿé…ç½®"><a href="#ä½¿ç”¨AWS-Configureå¿«é€Ÿé…ç½®" class="headerlink" title="ä½¿ç”¨AWS Configureå¿«é€Ÿé…ç½®"></a>ä½¿ç”¨AWS Configureå¿«é€Ÿé…ç½®</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ aws configure</span><br><span class="line">AWS Access Key ID [None]: AKIAIOSFODNN7EXAMPLE</span><br><span class="line">AWS Secret Access Key [None]: wJalrXUtnFEMI&#x2F;K7MDENG&#x2F;bPxRfiCYEXAMPLEKEY</span><br><span class="line">Default region name [None]: us-west-2</span><br><span class="line">Default output format [None]: json</span><br></pre></td></tr></table></figure><p>è®¿é—®å¯†é’¥IDå’Œç§˜å¯†è®¿é—®å¯†é’¥<br>è®¿é—®å¯†é’¥ç”±è®¿é—®å¯†é’¥IDå’Œç§˜å¯†è®¿é—®å¯†é’¥ç»„æˆï¼Œç”¨äºç­¾ç½²æ‚¨å¯¹AWSå‘å‡ºçš„ç¼–ç¨‹è¯·æ±‚ã€‚å¦‚æœæ‚¨æ²¡æœ‰è®¿é—®å¯†é’¥ï¼Œåˆ™å¯ä»¥ä»AWSç®¡ç†æ§åˆ¶å°ä¸­åˆ›å»ºå®ƒä»¬ã€‚æœ€ä½³åšæ³•æ˜¯ï¼Œä¸è¦å¯¹ä¸éœ€è¦æ‰§è¡Œä»»ä½•ä»»åŠ¡çš„ä»»åŠ¡ä½¿ç”¨AWSè´¦æˆ·rootç”¨æˆ·è®¿é—®å¯†é’¥ã€‚è€Œæ˜¯ ä½¿ç”¨æ‚¨è‡ªå·±çš„è®¿é—®å¯†é’¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜IAMç”¨æˆ·ã€‚</p><p>åˆ›å»ºå¯†é’¥æ—¶ï¼Œå”¯ä¸€å¯ä»¥æŸ¥çœ‹æˆ–ä¸‹è½½ç§˜å¯†è®¿é—®å¯†é’¥çš„æ—¶é—´ã€‚æ‚¨ä»¥åå°†æ— æ³•æ¢å¤å®ƒä»¬ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥éšæ—¶åˆ›å»ºæ–°çš„è®¿é—®å¯†é’¥ã€‚æ‚¨è¿˜å¿…é¡»å…·æœ‰æ‰§è¡Œæ‰€éœ€çš„IAMæ“ä½œçš„æƒé™ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… ã€ŠIAMç”¨æˆ·æŒ‡å—ã€‹ä¸­çš„è®¿é—®IAMèµ„æºæ‰€éœ€çš„æƒé™ã€‚</p><h1 id="ä¸ªäººèµ„æ–™"><a href="#ä¸ªäººèµ„æ–™" class="headerlink" title="ä¸ªäººèµ„æ–™"></a>ä¸ªäººèµ„æ–™</h1><p>è®¾ç½®çš„é›†åˆç§°ä¸ºé…ç½®æ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒAWS CLIä½¿ç”¨ defaulté…ç½®æ–‡ä»¶ã€‚æ‚¨å¯ä»¥é€šè¿‡æŒ‡å®šâ€“profileé€‰é¡¹å¹¶åˆ†é…åç§°æ¥åˆ›å»ºå’Œä½¿ç”¨å…·æœ‰ä¸åŒå‡­æ®å’Œè®¾ç½®çš„å…¶ä»–å‘½åé…ç½®æ–‡ä»¶ã€‚é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨$HOME/.aws/ä¸‹</p><p>ä»¥ä¸‹ç¤ºä¾‹åˆ›å»ºä¸€ä¸ªåä¸ºçš„é…ç½®æ–‡ä»¶produserã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ aws configure --profile produser</span><br><span class="line">AWS Access Key ID [None]: AKIAI44QH8DHBEXAMPLE</span><br><span class="line">AWS Secret Access Key [None]: je7MtGbClwBF&#x2F;2Zp9Utk&#x2F;h3yCo8nvbEXAMPLEKEY</span><br><span class="line">Default region name [None]: us-east-1</span><br><span class="line">Default output format [None]: text</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæ‚¨å¯ä»¥æŒ‡å®ša å¹¶ä½¿ç”¨ä»¥è¯¥åç§°å­˜å‚¨çš„å‡­æ®å’Œè®¾ç½®ã€‚ â€“profile profilename</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ aws s3 ls --profile produser</span><br></pre></td></tr></table></figure><p>è¦æ›´æ–°è¿™äº›è®¾ç½®ï¼Œè¯·aws configureå†æ¬¡è¿è¡Œï¼ˆæœ‰æ—  â€“profileå‚æ•°ï¼Œå–å†³äºæ‚¨è¦æ›´æ–°çš„é…ç½®æ–‡ä»¶ï¼‰ï¼Œç„¶åæ ¹æ®éœ€è¦è¾“å…¥æ–°å€¼ã€‚ä¸‹ä¸€èŠ‚åŒ…å«æœ‰å…³aws configureåˆ›å»ºçš„æ–‡ä»¶ï¼Œå…¶ä»–è®¾ç½®å’Œå‘½åçš„é…ç½®æ–‡ä»¶çš„æ›´å¤šä¿¡æ¯ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html" target="_blank" rel="noopener">é…ç½®AWS CLI</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> AWS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¡¶çº§ç†è§£ä¹‹å¤©ä¸‹æ²¡æœ‰ä¸æ•£çš„ç­µå¸­</title>
      <link href="/2020/08/04/king/king-job-hopping/"/>
      <url>/2020/08/04/king/king-job-hopping/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è¸å‡ºç†Ÿæ‚‰çš„å…¬å¸å¤§é—¨ï¼Œæˆ‘å›å¤´ï¼ŒçŸ¥é“ä»¥ååº”è¯¥ä¸ä¼šç»å¸¸å›æ¥ï¼ŒæŠ¬æ‰‹ï¼Œæ‹ç…§ï¼Œæœ‹å‹åœˆé‡Œï¼Œæˆ‘ç•™ä¸‹äº†â€œè«æ„å‰è·¯æ— çŸ¥å·±ï¼Œå¤©ä¸‹è°äººä¸è¯†å›â€çš„æ–‡å­—ã€‚              -ã€Š  <a href="http://wuwenliang.net/" target="_blank" rel="noopener">ç²¾è¯šæ‰€è‡³,æˆ‘çš„è·³æ§½ä¹‹è·¯</a>ã€‹</p></blockquote><p>è¿™æ˜¯ä¸€ä½å‰å…¬å¸JAVAå¤§ç‰›åœ¨ç¦»èŒå‰çš„æ„Ÿæ¦‚ï¼Œæˆ‘ä»¬è™½ç„¶åªä¸€èµ·å¤„è¿‡çŸ­çŸ­ä¸¤å¤©ï¼Œä½†æ˜¯æˆ‘ä¸€ç›´ä»¥ä»–ä¸ºæ¦œæ ·ã€‚</p><p>å†è§äº†ï¼Œè€ä¸œå®¶ï¼Œå†è§äº†ï¼Œæ­¦æ±‰ï¼Œæˆ‘å¼€å¯æˆ‘çš„å—æ¼‚ä¹‹æ—…â€”â€”æ·±åœ³ã€‚</p><hr><p>2020å¹´æ³¨å®šä¸å¹³å‡¡ï¼Œç–«æƒ…åœ¨æ­¦æ±‰çˆ†å‘ï¼Œæˆ‘å‘¨å›´æœ‰å¾ˆå¤šæœ‹å‹å› æ­¤å¤±ä¸šäº†ï¼Œä¹Ÿæœ‰ä¸å°‘æœ‹å‹å› æ–°è¡Œä¸šå´›èµ·è€Œå‘è´¢çš„ï¼Œè¿˜æœ‰å¦‚æˆ‘ä¸€èˆ¬åœ¨å®¶é‡Œæµ‘æµ‘å™©å™©åº¦è¿‡äº†2ä¸ªæœˆçš„ã€‚</p><p>ç–«æƒ…ä¹‹åå¤å·¥çš„ä¸€ä¸ªæ˜ŸæœŸï¼Œæˆ‘çš„å¯¼å¸ˆç¦»èŒï¼Œç„¶åå…¬å¸ç¦»èŒçš„äººæ¥è¿ä¸æ–­ï¼Œæˆ‘å‡ºäºæœ¬èƒ½åœ°æ…Œäº†ï¼Œçªç„¶åœ¨æ€è€ƒä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚</p><p>æˆ‘çš„ç›®æ ‡åœ¨å“ªï¼Ÿ</p><p>æˆ‘çš„å¸Œæœ›åœ¨å“ªï¼Ÿ</p><p>æˆ‘çš„æœªæ¥åœ¨å“ªï¼Ÿ</p><p>æˆ‘æ‰å‘ç°æˆ‘æ ¹æœ¬ä¸çŸ¥é“</p><p>æˆ‘ä¹Ÿæ›¾æƒ³ç€å­¦è¿™ä½å¤§ç‰›ä¸€æ ·è·‘ï¼Œä½†æ˜¯ä¸€å¹´çš„å·¥ä½œç»éªŒè®©æˆ‘è§‰å¾—çœ‹ä¼¼ä¼šçš„ä¸œè¥¿å¾ˆå¤šï¼Œå®é™…åœ¨æ²¡æœ‰æ€»ç»“å’Œç³»ç»Ÿæ€§å¤ä¹ çš„æƒ…å†µä¸‹ï¼Œæ ¹æœ¬æ²¡æœ‰äººä¼šè¦æˆ‘ã€‚</p><p>5æœˆ4æ—¥ï¼Œæˆ‘æœ‰å¹¸çœ‹åˆ°äº†ã€Šåæµªã€‹</p><p>å›½å®¶ä¸€çº§æ¼”å‘˜ä½•å†°ç™»å°æ¼”è®²ï¼Œè®¤å¯ã€èµç¾ä¸å¯„è¯­å¹´è½»ä¸€ä»£ï¼šâ€œä½ ä»¬æœ‰å¹¸é‡è§è¿™æ ·çš„æ—¶ä»£ï¼Œä½†æ—¶ä»£æ›´æœ‰å¹¸é‡è§è¿™æ ·çš„ä½ ä»¬ã€‚â€ </p><p>æˆ‘æ‰å‘ç°ï¼ŒåŸæ¥ï¼Œä¸–ç•Œä¸Šæœ‰é‚£ä¹ˆå¤šç¾å¥½çš„äº‹æƒ…ç­‰ç€æˆ‘ä»¬å»åšï¼Œä¸–ç•Œä¸Šæœ‰é‚£ä¹ˆå¤šæ¡è·¯ä¾›æˆ‘ä»¬é€‰æ‹©ï¼Œæˆ‘ä»¬çœŸçš„å¾ˆå¹¸è¿ã€‚</p><p>ä»é‚£å¤©èµ·ï¼Œæˆ‘å¼€å§‹å¯»æ‰¾è´¢å¯Œå¯†ç ã€‚</p><p>é‚£æ®µæ—¶é—´æˆ‘æ¥å—äº†å¾ˆå¤šæ–°æ€æƒ³ã€æ–°çŸ¥è¯†ã€æ–°æ–‡åŒ–ï¼Œä½†æ˜¯æˆ‘å§‹ç»ˆåœ¨çŠ¹è±«ï¼Œå¯¹å…¬å¸ä¾æ—§æŠ±æœ‰æ¶¨è–ªå¹»æƒ³ï¼Œæœ€ç»ˆï¼Œè¿™ä¸ªå¹»æƒ³è¢«ä¸æ–­åœ°æ‰“ç ´ï¼Œæœ€ç»ˆæˆ‘ç¡®å®šäº†ä¸€ä¸ªå°ç›®æ ‡ï¼Œé‚£å°±æ˜¯ä¸€å®šè¦å»æ‰¾ä¸€ä¸ªæ›´èƒ½è‚¯å®šæˆ‘ä»·å€¼ï¼Œèƒ½æä¾›æ›´é«˜å¹³å°çš„å…¬å¸ã€‚</p><p>ä¸ºæ­¤æˆ‘åˆ¶å®šäº†ä¸€ç³»åˆ—æ–¹æ¡ˆï¼ˆåŒ…æ‹¬åŸå¸‚ã€å…¬å¸ç±»å‹ã€å…¬å¸æŠ€æœ¯é€‰å‹ã€å‘å±•ç©ºé—´ã€ä¸ªäººä»·å€¼çš„è‚¯å®šç­‰ç­‰ï¼‰</p><p>æˆ‘å‚è€ƒå¤§ä½¬çš„åšå®¢ç»™è‡ªå·±åˆ¶å®šäº†ä¸€ä¸ªä¸ªæ¨¡å—å¤ä¹ </p><ul><li>å®¹å™¨ç¼–æ’ï¼šæ·±å…¥äº†è§£dockerã€kubernetesåº•å±‚çŸ¥è¯†ã€å¸¸ç”¨è¿ç»´å‘½ä»¤ä»¥åŠå®æˆ˜çš„æ¡ˆä¾‹æ€»ç»“</li><li>ç½‘ç»œåè®®ï¼šé‡ç‚¹å¤ä¹ OSIã€TCP/IPåè®®ã€è·¯ç”±äº¤æ¢ã€å­ç½‘åˆ’åˆ†ã€å®¹å™¨ç½‘ç»œ</li><li>Linuxï¼šé‡ç‚¹å¤ä¹ Linuxå¸¸ç”¨å‘½ä»¤ã€å†…æ ¸ã€é˜²ç«å¢™</li><li>è´Ÿè½½å‡è¡¡ã€ä¸­é—´ä»¶ï¼šNginxã€LVSã€MQå‡ ä¹æ˜¯å¿…è€ƒé¢˜</li><li>Mysqlï¼šé‡ç‚¹çœ‹ç´¢å¼•ã€é”ã€MVCCã€ä¼˜åŒ–ã€å¤‡ä»½ã€ç›‘æ§</li><li>CI/CDï¼šé‡ç‚¹å¤ä¹ gitlabã€jenkinsã€ansible</li><li>ç›‘æ§ï¼šå¤ä¹ prometheusï¼ˆé¡ºä¾¿è¯´ä¸‹ï¼Œzabbixå·²è¿‡æ—¶ï¼Œå¯ä»¥è¯´æ‹œæ‹œäº†ï¼‰</li><li>æ—¥å¿—ç³»ç»Ÿï¼šç®€å•äº†è§£ELKå’Œå„ç§äº‘äº§å“çš„æ—¥å¿—æœåŠ¡å®‰è£…é…ç½®å³å¯</li><li>è¿ç»´æ‰‹å†Œï¼šç§¯ç´¯è¿ç»´æ’é”™æ€è·¯åˆ†æåŠæ¡ˆä¾‹æ•´ç†ï¼Œç§¯ç´¯è‡ªå·±çš„å¿ƒå¾—ä½“ä¼š </li><li>è„šæœ¬è¯­è¨€ï¼šé‡ç‚¹å¤ä¹ pythonçš„è¯­æ³•ï¼Œç®€å•å¤ä¹ ä¸‹shellå³å¯ï¼Œæ¯•ç«ŸPythonçš„ç¬¬ä¸‰æ–¹åº“å¤šï¼Œå¾ˆå¤šæˆç†Ÿçš„åŠŸèƒ½å¥—ä»¶å¼€ç®±å³ç”¨</li><li>ç®—æ³•æ•°æ®ç»“æ„ï¼šè¿ç»´å’Œå¼€å‘ä¸ä¸€æ ·ï¼Œè¿™ä¸ªä¸œè¥¿ä½ è¯´ä¸äº†è§£å§ä¹Ÿä¸è¡Œï¼ŒèŠ±æ—¶é—´åœ¨ç®—æ³•ä¸Šé¢å¤ªå¤šåˆå®¹æ˜“å‡ºç°é¢è¯•é€ ç«ç®­,å…¥èŒæ‹§èºä¸çš„æƒ…å†µï¼Œå› äººè€Œå¼‚å§ã€‚</li></ul><p>è¿™äº›æ¨¡å—æ˜¯æˆ‘ä¸€æ­¥æ­¥å¤ä¹ æ€»ç»“å‡ºæ¥çš„ï¼Œä¹Ÿå¤ä¹ è¿‡å¾ˆå¤šä¸å¤ªæœ‰ç”¨çš„æ¨¡å—ï¼ˆæ¯”å¦‚ç®—æ³•å’Œæ•°æ®ç»“æ„ä»¥åŠäº‘å¹³å°ç®¡ç†ç­‰ï¼‰ï¼Œç›¸æ¯”ä¹‹ä¸‹æµªè´¹è¾ƒå¤šæ—¶é—´ã€‚</p><p>ç»è¿‡ä¸€ä¸ªæœˆçš„é¢è¯•ï¼Œæˆ‘å‘ç°åœ¨è¿ç»´æ–¹é¢ï¼Œç½‘ç»œåè®®å’ŒLinuxåŸºç¡€æ˜¯é‡ä¸­ä¹‹é‡ï¼Œå°¤å…¶æ˜¯ç½‘ç»œåè®®è¿™å—ï¼Œä¸€ä¸ªTCP/IPå°±å¤Ÿä½ å¤ä¹ å¾ˆä¹…ï¼Œæœ€é‡è¦çš„æ˜¯ä½ å¤ä¹ çš„æˆæœéœ€è¦ç”±ä¸€ä¸ªä¸€ä¸ªæ¡ˆä¾‹è¾“å‡ºæ‰èƒ½ä½“ç°å‡ºæ¥ã€‚</p><p>å¾ˆç®€å•çš„ä¾‹å­ï¼š</p><p>åœ¨æµè§ˆå™¨æ‰“å¼€<a href="http://www.baidu.comç»è¿‡äº†å“ªäº›æ­¥éª¤" target="_blank" rel="noopener">www.baidu.comç»è¿‡äº†å“ªäº›æ­¥éª¤</a></p><p>ä¸€ä¸ªç½‘é¡µæ‰“å¼€å¾ˆå¡ï¼Œæ’æŸ¥è¿™ä¸ªåŸå› å¹¶æå‡ºè§£å†³æ–¹æ¡ˆ</p><p>æœåŠ¡å™¨ç‰¹åˆ«å¡ï¼Œä½†æ˜¯TOPå‘ç°æ²¡æœ‰å¾ˆå¤šèµ„æºè¢«å ç”¨ï¼Œåº”è¯¥æ€ä¹ˆè§£å†³</p><p>é¢å¯¹è¿™ç±»é¢è¯•å¸¸è€ƒçš„é—®é¢˜ï¼Œä½ ä¸å…‰å¸¦ç€é—®é¢˜å»å­¦ä¹ ï¼Œæ›´å¾—æ·±å…¥åœ°äº†è§£å„ä¸ªåº•å±‚çŸ¥è¯†ï¼Œé›†ä¸­èµ·æ¥ï¼Œé¢å¯¹é—®é¢˜ä½ æ‰èƒ½å¿«å‡†ç‹ åœ°å®šä½å¹¶è§£å†³é—®é¢˜ã€‚</p><p>æœ€åå†è®²ä¸€ä¸‹é¢è¯•éœ€è¦æ³¨æ„çš„ä¸œè¥¿ï¼Œå¦‚ä½•åœ¨é¢è¯•ä¸­å±•ç¤ºè‡ªå·±çš„äº®ç‚¹ï¼Œè®©è‡ªå·±èƒ½å¤Ÿå¸å¼•é¢è¯•å®˜çš„æ³¨æ„å‘¢ï¼Ÿ</p><p>é‚£ä½å¤§ç‰›çš„åšå®¢å·²ç»å†™äº†å¾ˆå¥½ç­”æ¡ˆäº†ï¼Œæˆ‘è¿™é‡Œå°±ä¸å†å¤è¿°ç›¸åŒçš„ï¼Œåªåšè¡¥å……ï¼š</p><p>ç®€å†ç¯‡</p><ul><li>ä¸€å®šè¦æŒæ¡è‡ªå·±çš„ç®€å†ï¼šè¾¾åˆ°ç†Ÿç»ƒåœ°è‡ªæˆ‘ä»‹ç»ï¼Œé¡¹ç›®ã€æŠ€æœ¯æœ‰æ¡ä¸ç´Šçš„è®²å‡ºæ¥</li><li>å®äº‹æ±‚æ˜¯ï¼šä»…ä»…ç”¨è¿‡çš„æŠ€æœ¯å°±ä¸è¦å†™ç†Ÿç»ƒï¼Œä»…ä»…æ˜¯å¹³å¸¸ç”¨çš„è¾ƒå¤šçš„æŠ€æœ¯å°±ä¸è¦å†™ç²¾é€šï¼Œåªæœ‰åˆ°è¾¾äº†æ·±å…¥ç†è§£å¹¶ç†Ÿç»ƒè¿ç”¨æŠ€æœ¯çš„æ°´å¹³æ‰èƒ½å†™ç²¾é€šï¼ˆä¾‹å¦‚åº•å±‚åŸç†ï¼Œæ‰©å±•æ–¹æ¡ˆï¼Œå®ç°åœºæ™¯ï¼‰ï¼Œå¦åˆ™é¢è¯•å®˜ä¼šé—®çš„ä½ æ¼æ´ç™¾å‡º</li></ul><p>å‘å±•ç¯‡</p><ul><li>èŒä¸šè§„åˆ’ï¼Œä¸ªäººç›®æ ‡ï¼Œä¸è¦å¤ªæ³›ï¼Œå¤ªè™šï¼ˆä¾‹å¦‚æˆ‘è¦æˆä¸ºæŸæŸé¢†åŸŸæœ€ç‰›é€¼çš„äººï¼Œæˆ‘è¦ç»™å…¬å¸åˆ›é€ å¤šå¤§å¤šå¤§çš„ä»·å€¼ï¼Œå¹å‘¢ï¼‰ï¼Œä¸€å®šè¦è®²å®é™…ä¾‹å­ï¼Œæ¯”å¦‚æŸæ¡ˆä¾‹ï¼Œæˆ‘æ˜¯æ€ä¹ˆæƒ³çš„ï¼Œåšäº†ä»€ä¹ˆï¼ŒèŠ±äº†å¤šå°‘å¿ƒè¡€ï¼Œæœ€ç»ˆæ”¶è·äº†ä»€ä¹ˆï¼Œå¸®åŠ©å›¢é˜Ÿæˆé•¿äº†ä»€ä¹ˆï¼Œæ€»ç»“åæ€äº†ä»€ä¹ˆã€‚</li><li>ç¦»èŒåŸå› æƒ³æ¸…æ¥šæ€ä¹ˆè¯´ï¼Œå¿…ç­”é¢˜ï¼Œä¸è¦å¤ªè‚¤æµ…ï¼ˆå…¬å¸ä¸ç»™æˆ‘æ¶¨é’±ï¼‰ï¼Œä¹Ÿä¸è¦å¤ªå‡ï¼ˆæˆ‘è¦ä¸å…¬å¸å…±å­˜äº¡ï¼Œæåº¦è®¤åŒå…¬å¸æ–‡åŒ–ï¼Œä½†æ˜¯å…¬å¸æŠŠæˆ‘å¼€é™¤äº†ç­‰ç­‰ï¼‰</li></ul><p>åŒæ ·ï¼Œæˆä¹‹ä»¥é±¼ä¸å¦‚æˆä¹‹ä»¥æ¸”ã€‚</p><p>æˆ‘æƒ³å‘Šè¯‰æœªæ¥æœ‰å¹¸èƒ½çœ‹åˆ°æˆ‘è¿™ç¯‡æ–‡ç« çš„æœ‹å‹ä»¬ï¼Œå¦‚æœä½ ä»¬ä¹Ÿä¸æ»¡ç°çŠ¶ï¼Œä¸æ»¡è‡ªå·±çš„ä»·å€¼ä¸è¢«æ‰¿è®¤ï¼Œä¸æ»¡è‡ªå·±æµ‘æµ‘å™©å™©åœ°è¿‡æ—¥å­ï¼Œé‚£ä¹ˆä½ åº”è¯¥å­¦ä¼š</p><ul><li>æ€è€ƒï¼ˆè‡ªä¸»æ€è€ƒï¼Œå°±è·Ÿæœºå™¨å­¦ä¹ ä¸€æ ·ï¼Œè‡ªå·±æœ‰æ„è¯†åœ°å»æ€è€ƒï¼‰</li><li>çæƒœæ—¶é—´ï¼Œå°‘ç©æ¸¸æˆå°‘æ”¾æ¾ï¼Œåˆ¶ä½œä¸€å¥—åˆ‡å®å¯è¡Œçš„æ—¶é—´ç®¡ç†è¡¨</li><li>å¤šç»“äº¤/å…³æ³¨ç‰›é€¼çš„äººï¼ˆé«˜å­¦å†ï¼ŒçŸ¥åå¤§å‚çš„ä¼˜ç§€å‘˜å·¥ï¼‰å­¦å­¦åˆ«äººæˆåŠŸçš„ç»éªŒ</li><li>ä¿æŒæŠ€æœ¯çš„çº¯ç²¹ï¼Œä¸è¦å¤ªæ—©è¢«ä¸–ä¿—å½±å“</li><li>æ¯æ—¥ä¸‰çœå¾èº«ï¼Œæ¯å‘¨è‡ªæˆ‘å°ç»“ï¼Œæ¯æœˆè‡ªæˆ‘æ€»ç»“ï¼Œä¸è¦æŠŠè¿™ä¸ªå½“ä½œä¸€å¥ç©ºè¯</li><li>å…ˆå®šä¸€ä¸ªå°ç›®æ ‡ï¼Œ1-5å¹´å®Œæˆï¼Œå†å®šä¸€ä¸ªå¤§ç›®æ ‡ï¼Œ10å¹´ç”šè‡³ä¸€ç”Ÿ</li><li>æŠ•èµ„ï¼ˆç†è´¢ã€è‡ªå·±çš„èº«ä½“ã€äººè„‰ï¼‰</li></ul><p>é¡ºä¾¿ç»™ä½ ä»¬ä¹Ÿç»™æœªæ¥çš„è‡ªå·±æ—¶åˆ»æ•²å“è­¦é’Ÿï¼šä¸æ±‚æ•ˆæœä¸çœ‹æ•ˆç‡çš„å‹¤å¥‹æ¯”æ‡’æƒ°æ›´å¯æ€•ã€‚</p><p>è¦ç›¸ä¿¡ï¼Œä»˜å‡ºä¸€å®šä¼šæœ‰æ”¶è·ï¼Œæ”¶è·å¯èƒ½ä¼šè¿Ÿåˆ°ï¼Œä½†ä¸€å®šä¸ä¼šç¼ºå¸­ã€‚</p><p>å†™åˆ°è¿™é‡Œæˆ‘è¿˜æ˜¯å¾—è¯´é‚£å¥è€ç”Ÿå¸¸è°ˆçš„è¯ï¼šç§ä¸€æ£µæ ‘æœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ï¼Œå…¶æ¬¡æ˜¯ç°åœ¨ã€‚å¦‚æœæœ‰é—æ†¾ï¼Œé‚£ä¹ˆç°åœ¨ä¸€å®šè¦å»æŒ½ç•™ã€‚</p><p>æœ€åæˆ‘è¿˜æ˜¯éœ€è¦æ„Ÿè°¢è€ä¸œå®¶ï¼Œåœ¨è¿™é‡Œæˆ‘å­¦ä¹ åˆ°äº†å¾ˆå¤šæŠ€æœ¯ï¼Œè®¤è¯†äº†å¾ˆå¤šå¤§ä½¬ï¼Œæˆ‘çš„ä¸‰è§‚åœ¨è¿™é‡Œé€æ¸åœ°å½¢æˆã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘æ‹¼æè¿‡ï¼Œæˆ‘é€šå®µè¿‡ï¼Œæˆ‘ä¸æœè¿‡ï¼Œæˆ‘è¢«äººåˆ©ç”¨è¿‡ï¼Œæˆ‘è¯æ˜è¿‡ï¼Œæˆ‘çˆ±è¿‡ã€æ¨è¿‡ã€‚</p><p>é¢†å¯¼èµ°ä¹‹å‰å˜±å’æˆ‘â€å¤©ä¸‹æ²¡æœ‰ä¸æ•£çš„ç­µå¸­â€ã€â€åšäººè¦å¤§å¤§æ–¹æ–¹çš„æ¥ï¼Œå¤§å¤§æ–¹æ–¹çš„èµ°â€ã€â€ä¸èƒ½äººèµ°èŒ¶å‡‰ï¼Œå…³ç³»æ˜¯éœ€è¦ç»´æŠ¤çš„â€ã€â€åšæŒè‡ªå·±çš„åŸåˆ™ï¼Œå“ªæ€•ä½ æŠ—è¡¡çš„æ˜¯æ•´ä¸ªä¸–ç•Œâ€</p><p>æˆ‘è¡·å¿ƒåœ°æ„Ÿè°¢åœ¨è€ä¸œå®¶è®¤è¯†çš„æ¯ä¸€ä¸ªäººã€‚</p><p>æˆ‘å·²ç»ä¸çŸ¥é“åº”è¯¥è¿™ç¯‡æ–‡ç« åˆ°åº•è¦è¡¨è¾¾ä»€ä¹ˆä¸­å¿ƒæ€æƒ³ï¼Œå¦‚æœè¦è¯´ä¸€å¥é¼“åŠ±çš„è¯ï¼Œé‚£ä¹ˆï¼Œ</p><p>å¥”æ¶Œå§ï¼Œåæµªï¼RuGodï¼Œç°åœ¨æ‰åˆšåˆšå¼€å§‹ï¼</p><h1 id="å¤ä¹ èµ„æ–™"><a href="#å¤ä¹ èµ„æ–™" class="headerlink" title="å¤ä¹ èµ„æ–™"></a>å¤ä¹ èµ„æ–™</h1><h2 id="ç³»ç»Ÿå¤ä¹ è¯¾"><a href="#ç³»ç»Ÿå¤ä¹ è¯¾" class="headerlink" title="ç³»ç»Ÿå¤ä¹ è¯¾"></a>ç³»ç»Ÿå¤ä¹ è¯¾</h2><ul><li>MySQLå®æˆ˜45è®²ï¼ˆæå®¢æ—¶é—´ï¼‰</li><li>è¶£è°ˆç½‘ç»œåè®®ï¼ˆæå®¢æ—¶é—´ï¼‰</li><li>æ·±å…¥å‰–æKubernetesï¼ˆæå®¢æ—¶é—´ï¼‰</li></ul><h2 id="ä¹¦ç±ç±»"><a href="#ä¹¦ç±ç±»" class="headerlink" title="ä¹¦ç±ç±»"></a>ä¹¦ç±ç±»</h2><ul><li>SRE Googleè¿ç»´è§£å¯† </li><li>Kubernetesæƒå¨æŒ‡å—</li><li>é¸Ÿå“¥çš„Linuxç§æˆ¿èœ åŸºç¡€å­¦ä¹ ç¯‡ ç¬¬å››ç‰ˆ</li><li>äº‘åŸç”ŸæœåŠ¡ç½‘æ ¼Istio</li><li>é«˜æ€§èƒ½MySQLï¼ˆç¬¬3ç‰ˆï¼‰</li><li>CCNAå­¦ä¹ æŒ‡å— 640-802 ç¬¬7ç‰ˆ</li><li>æ·±å…¥æµ…å‡ºPrometheus</li></ul><h2 id="é¢è¯•æ€»ç»“ç±»"><a href="#é¢è¯•æ€»ç»“ç±»" class="headerlink" title="é¢è¯•æ€»ç»“ç±»"></a>é¢è¯•æ€»ç»“ç±»</h2><ul><li><a href="https://blog.csdn.net/ThinkWon/article/details/104588679###" target="_blank" rel="noopener">Linuxé¢è¯•é¢˜ï¼ˆ2020æœ€æ–°ç‰ˆï¼‰</a></li><li><a href="https://www.nowcoder.com/discuss/431440?type=5" target="_blank" rel="noopener">è®¡ç®—æœºç½‘ç»œå­¦ä¹ è·¯çº¿å’Œå¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆå­—èŠ‚è·³åŠ¨é¢è¯•å¿…å¤‡ï¼‰</a></li><li><a href="https://www.cnblogs.com/wuwuyong/p/12198928.html" target="_blank" rel="noopener">è®¡ç®—æœºç½‘ç»œå¸¸è§é¢è¯•é¢˜</a></li><li><a href="https://developer.aliyun.com/article/715486?spm=a2c6h.12873639.0.0.792939dfi0wzR1&groupCode=interview" target="_blank" rel="noopener">7å¤§æ¿å—ï¼Œ200+é¢è¯•é¢˜ï¼ŒåŠ©ä½ æ‹¿ä¸‹offer | è¿ç»´å·¥ç¨‹å¸ˆé¢è¯•å®å…¸</a></li><li><a href="https://www.cs.usfca.edu/~galles/visualization/Algorithms.html" target="_blank" rel="noopener">ç®—æ³•å®è·µ</a></li><li><a href="https://www.jianshu.com/p/346d3c30eb2c" target="_blank" rel="noopener">MySQL åŠ é”å¤„ç†åˆ†æ</a></li><li><a href="https://zhuanlan.zhihu.com/p/54430650" target="_blank" rel="noopener">110é“Pythoné¢è¯•é¢˜ï¼ˆçœŸé¢˜ï¼‰</a></li></ul><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¡¶çº§ç†è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¶çº§ç†è§£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ªäººæ€»ç»“(2020.7)</title>
      <link href="/2020/08/04/summary/summary-2020-7/"/>
      <url>/2020/08/04/summary/summary-2020-7/</url>
      
        <content type="html"><![CDATA[<h1 id="æ„Ÿæ…¨"><a href="#æ„Ÿæ…¨" class="headerlink" title="æ„Ÿæ…¨"></a>æ„Ÿæ…¨</h1><p>2020çš„7æœˆå¯èƒ½æ˜¯æˆ‘çš„æ•´ä¸ªäººç”Ÿçš„è½¬æŠ˜ç‚¹</p><p>7æœˆæˆ‘ç»å†äº†å…¬å¸éƒ¨é—¨çš„éœ‡åŠ¨ï¼ˆç›´å±é¢†å¯¼ç¦»èŒã€åç§‘å¤§ä½¬ç¦»èŒã€å¤§æ•°æ®å¤§ä½¬ä»¬ç¦»èŒï¼‰ï¼Œæˆ‘åæ€äº†å¾ˆå¤šï¼ŒåŒ…æ‹¬ä»–ä»¬ä¸ºä»€ä¹ˆä¼šç¦»èŒï¼Œä»¥åŠè‡ªå·±çš„å¤„å¢ƒå’Œå‘å±•ç©ºé—´ã€‚</p><p>æœ€ç»ˆæˆ‘è®¤ä¸ºæˆ‘ä¸èƒ½æŒ‰ç…§åŸè®¡åˆ’æ‰§è¡Œäº†ï¼ˆ9æœˆå¼€å§‹æŠ•ç®€å†ï¼‰ï¼Œæˆ‘éœ€è¦åŠ å¿«æˆ‘çš„å¤ä¹ è¿›åº¦ä»¥åŠç°åœ¨å°±å¼€å§‹è®­ç»ƒè‡ªå·±çš„é¢è¯•èƒ½åŠ›ã€‚</p><p>ä¸ºæ­¤æˆ‘åˆ¶å®šäº†ä¸€ç³»åˆ—æ–¹æ¡ˆï¼ˆåç»­ä¼šä¸“é—¨å†™ç¯‡æ–‡ç« åˆ†äº«æˆ‘çš„è·³æ§½ä¹‹æ—…ï¼‰ä»¥åŠå¦‚ä½•è½å®ï¼ˆè¿™ä¸ªå¾ˆéš¾ï¼‰</p><p>æœ€ç»ˆæˆ‘åœ¨è¿™ä¸ªæœˆå†…é¢è¯•äº†20å‡ å®¶å…¬å¸ï¼ˆæœ‰æ­¦æ±‰æ·±åœ³æ­å·çš„ï¼‰ä¹Ÿæ‹¿äº†å‡ ä¸ªä¸é”™çš„offerï¼Œæœ€ç»ˆåœ¨æœˆåº•é”ä¸‹äº†ä¸€å®¶æ·±åœ³çš„åˆ›ä¸šå‹å…¬å¸ã€‚8æœˆ6æ—¥é£æ·±åœ³ï¼Œå¼€å§‹å—æ¼‚ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="æŠ€æœ¯"><a href="#æŠ€æœ¯" class="headerlink" title="æŠ€æœ¯"></a>æŠ€æœ¯</h2><h3 id="æ–‡ç« "><a href="#æ–‡ç« " class="headerlink" title="æ–‡ç« "></a>æ–‡ç« </h3><p>7æœˆæˆ‘ä¸€å…±å‘å¸ƒäº†14ç¯‡æ–‡ç« .</p><p>ä¸»è¦å…³äºK8Sã€SREã€Dockerçš„æ–‡ç« ã€‚</p><h3 id="å­¦ä¹ ï¼š"><a href="#å­¦ä¹ ï¼š" class="headerlink" title="å­¦ä¹ ï¼š"></a>å­¦ä¹ ï¼š</h3><p>ä¹°äº†æå®¢æ—¶é—´ å¼ ç£Šè€å¸ˆçš„æ·±å…¥å‰–æKubernetes</p><p>è™½ç„¶æ˜¯2å¹´å‰çš„è¯¾ï¼Œä½†æ˜¯çœ‹å®Œ+å®˜æ–¹æ–‡æ¡£çš„å­¦ä¹ ï¼Œèƒ½å¯¹K8Sæ•´ä¸ªæŠ€æœ¯æ¶æ„æœ‰äº†æ›´åŠ æ·±åˆ»çš„äº†è§£</p><p>ä¹°äº†æœ¬SREã€ŠSite Reliability Engineering ã€‹ï¼Œå­¦ä¹ ä¸‹è°·æ­Œçš„è¿ç»´å›¢é˜Ÿçš„æ€æƒ³</p><h2 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h2><h3 id="ä½œæ¯æ—¶é—´"><a href="#ä½œæ¯æ—¶é—´" class="headerlink" title="ä½œæ¯æ—¶é—´"></a>ä½œæ¯æ—¶é—´</h3><p>7æœˆæˆ‘çš„ç”Ÿæ´»æ˜¯å¾ˆè¾›è‹¦çš„ï¼Œé«˜é¢‘ç‡çš„é¢è¯•ä½¿å¾—æˆ‘æ¯å¤©éƒ½åœ¨åå¤åœ°æ€»ç»“ï¼Œå¤ä¹ ï¼Œè¿›æ­¥ã€‚è¿™ä¸ªæœˆè¶…è¿‡12ç‚¹ç¡è§‰ä¸€å…±æœ‰22å¤©ï¼Œå¹³å‡ç¡è§‰æ—¶é•¿ä¸º6å°æ—¶21åˆ†é’Ÿã€‚æˆ‘æ¯å¤©å¤ä¹ é¢è¯•é¢˜ã€æ ¸å¿ƒçŸ¥è¯†ç»†èŠ‚ï¼Œç”šè‡³å‡ æ¬¡æ™šä¸ŠæŠ±ç€ä¹¦è¿›å…¥æ¢¦ä¹¡ã€‚</p><h3 id="åšé¥­"><a href="#åšé¥­" class="headerlink" title="åšé¥­"></a>åšé¥­</h3><p>è¿™ä¸ªæœˆæ²¡æ—¶é—´åšé¥­ï¼Œå¤©å¤©åƒå¤–å–ï¼Œç¡®å®æœ‰ç‚¹ä¸å¤ªå¥åº·ã€‚</p><h3 id="é”»ç‚¼"><a href="#é”»ç‚¼" class="headerlink" title="é”»ç‚¼"></a>é”»ç‚¼</h3><p>è¿™ä¸ªæœˆåªé”»ç‚¼äº†3å¤©ï¼Œå’ŒåŒ—äº¬å‡ºå·®çš„æœ‹å‹æ‰“è¿‡ç¯®çƒï¼Œå¸¦åŒ—äº¬çš„æœ‹å‹å»çœ‹äº†ä¸€æ¬¡é»„é¹¤æ¥¼ã€‚</p><h1 id="å¯¹è‡ªå·±è¯´"><a href="#å¯¹è‡ªå·±è¯´" class="headerlink" title="å¯¹è‡ªå·±è¯´"></a>å¯¹è‡ªå·±è¯´</h1><p>7æœˆçš„å®‡ç¥è¾›è‹¦äº†ï¼Œæ¯å¤©ä¸æ–­åœ°å‡†å¤‡é¢è¯•ä»¥åŠå›æ”¾é¢è¯•çš„ç”µè¯å½•éŸ³ï¼Œæ•´ä¸ª7æœˆæˆ‘å°±åšä¸¤ä»¶äº‹ã€‚</p><p>å¤ä¹ â€”â€”é¢è¯•â€”â€”å†å¤ä¹ â€”â€”å†é¢è¯•</p><p>æœ€å¥½çš‡å¤©ä¸è´Ÿæœ‰å¿ƒäººï¼Œç»“æœæ˜¯æˆ‘æ¯”è¾ƒæ»¡æ„çš„</p><h1 id="å‘å‰çœ‹"><a href="#å‘å‰çœ‹" class="headerlink" title="å‘å‰çœ‹"></a>å‘å‰çœ‹</h1><p>8æœˆæˆ‘ä¼šåœ¨æ·±åœ³å—å±±åŒºç§‘æŠ€å›­å·¥ä½œï¼Œé‚£é‡Œéƒ½æ˜¯é«˜ç§‘æŠ€äº§ä¸šå…¬å¸ã€‚æˆ‘ä¸€è¾¹ä¼šå¿«é€Ÿèå…¥æ–°çš„å…¬å¸å®Œæˆè‡ªå·±çš„æœ¬èŒå·¥ä½œï¼Œä¸€è¾¹ä¹Ÿä¼šå»æ·±å¤§é™„ä»¶èµ°èµ°çœ‹çœ‹ï¼Œæ„Ÿå—å¤§åŸå¸‚çš„ç§‘æŠ€é­…åŠ›ã€‚</p><h1 id="åè¨€å…±å‹‰"><a href="#åè¨€å…±å‹‰" class="headerlink" title="åè¨€å…±å‹‰"></a>åè¨€å…±å‹‰</h1><p>è«æ„å‰è·¯æ— çŸ¥å·±ã€å¤©ä¸‹è°äººä¸è¯†å›</p><p>å¤©ä¸‹æ²¡æœ‰ä¸æ•£çš„ç­µå¸­</p>]]></content>
      
      
      <categories>
          
          <category> ä¸ªäººæ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¸ªäººæ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mongodb4.2å‰¯æœ¬é›†å®‰è£…</title>
      <link href="/2020/07/30/mongodb/mongodb4.2-install/"/>
      <url>/2020/07/30/mongodb/mongodb4.2-install/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>å…¬å¸éœ€è¦å®‰è£…mongdbå‰¯æœ¬é›†ï¼Œä¿è¯å’Œé˜¿é‡Œäº‘çš„ç”Ÿäº§ç¯å¢ƒä¸€æ ·ï¼Œç‰ˆæœ¬è¿˜æ˜¯4.2ï¼Œè¯´å®è¯æˆ‘ä»¬æ ¹æœ¬ç”¨ä¸åˆ°å‰¯æœ¬é›†äº‹åŠ¡å’Œé«˜å¯ç”¨çš„å¤‡ä»½ã€‚è¿˜æ˜¯ä¹–ä¹–å¬é¢†å¯¼çš„è¯éƒ¨ç½²å§</p><h1 id="Monodbå‰¯æœ¬é›†ä»‹ç»"><a href="#Monodbå‰¯æœ¬é›†ä»‹ç»" class="headerlink" title="Monodbå‰¯æœ¬é›†ä»‹ç»"></a>Monodbå‰¯æœ¬é›†ä»‹ç»</h1><ul><li>å‰¯æœ¬é›†åœ¨mongodbä¸­æ˜¯æ˜¯ä¸€ç»„ mongodä¿æŒç›¸åŒçš„æ•°æ®é›†è¿‡ç¨‹ï¼Œå‰¯æœ¬é›†æä¾›å†—ä½™å’Œé«˜å¯ç”¨æ€§ï¼Œå¹¶ä¸”æ˜¯æ‰€æœ‰ç”Ÿäº§éƒ¨ç½²çš„åŸºç¡€ã€‚</li><li>å¤åˆ¶æä¾›å†—ä½™å¹¶å¢åŠ æ•°æ®å¯ç”¨æ€§ï¼Œåœ¨ä¸ç”¨æ•°æ®åº“æœåŠ¡å™¨ä¸Šå…·æœ‰å¤šä¸ªæ•°æ®å‰¯æœ¬æ˜¯ï¼Œå¤åˆ¶å¯ä»¥æä¾›ä¸€ä¸ªçº§åˆ«çš„å•ä¸€æ•°æ®åº“æœåŠ¡å™¨ä¸¢å¤±çš„å®¹é”™èƒ½åŠ›ã€‚</li><li>å‰¯æœ¬é›†å¯ä»¥æ”¯æ’‘æ›´é«˜çš„è¯»æ“ä½œï¼Œå› ä¸ºå®¢æˆ·ç«¯å¯ä»¥å‘ä¸åŒçš„æœåŠ¡å™¨å‘é€è¯»å–æ“ä½œï¼Œå¯ä»¥é…ç½®åœ¨ä¸åŒçš„æ•°æ®ä¸­å¿ƒç”¨ä½œé­éš¾æ¢å¤æˆ–è€…æŠ¥å‘Šï¼Œå¤‡ä»½ã€‚</li><li>å‰¯æœ¬é›†æˆå‘˜æœ€å¤š50ä¸ªï¼Œåªæœ‰7ä¸ªæˆå‘˜å¯ä»¥å‚ä¸é€‰ä¸¾æŠ•ç¥¨ï¼Œå¤šä¸­å¿ƒå®¹ç¾èƒ½åŠ›ï¼Œè‡ªåŠ¨æ¢å¤ï¼Œæ»šåŠ¨å¼å‡çº§æœåŠ¡</li></ul><h1 id="éƒ¨ç½²Mongodb"><a href="#éƒ¨ç½²Mongodb" class="headerlink" title="éƒ¨ç½²Mongodb"></a>éƒ¨ç½²Mongodb</h1><p>é˜¿é‡Œäº‘çš„ç”Ÿäº§ç¯å¢ƒMongodbéƒ¨ç½²æ¨¡å¼ä¸ºä¸€ä¸»ä¸€ä»ä¸€ä»²è£ï¼Œçº¿ä¸‹ä¿æŒä¸€è‡´ã€‚</p><h2 id="æœåŠ¡å™¨ä¿¡æ¯"><a href="#æœåŠ¡å™¨ä¿¡æ¯" class="headerlink" title="æœåŠ¡å™¨ä¿¡æ¯"></a>æœåŠ¡å™¨ä¿¡æ¯</h2><p>ä¸‰å°æœºå™¨ä¸€æ ·é…ç½®8æ ¸32Gå†…å­˜ å­˜å‚¨ç›˜500G</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;host&quot; : &quot;172.31.28.23:27020&quot;   ä¸»</span><br><span class="line">&quot;host&quot; : &quot;172.31.28.24:27020&quot;   ä»</span><br><span class="line">&quot;host&quot; : &quot;172.31.28.25:27020&quot;   ä»²è£</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…Mongodb"><a href="#å®‰è£…Mongodb" class="headerlink" title="å®‰è£…Mongodb"></a>å®‰è£…Mongodb</h2><p>è¿›å…¥ä¸»èŠ‚ç‚¹æœºå™¨172.31.28.23</p><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-28-23 ~]# wget https:&#x2F;&#x2F;fastdl.mongodb.org&#x2F;linux&#x2F;mongodb-linux-x86_64-rhel70-4.2.8.tgz</span><br><span class="line">[root@VM-28-23 ~]# tar -zxvf mongodb-linux-x86_64-rhel70-4.2.8.tgz -C &#x2F;data&#x2F;</span><br><span class="line">[root@VM-28-23 ~]# mkdir &#x2F;data&#x2F;mongodb&#x2F;&#123;data,logs,pid,conf&#125; -p</span><br><span class="line">[root@VM-28-23 ~]# vim &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;mongodb.conf</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: &#x2F;data&#x2F;mongodb&#x2F;logs&#x2F;mongod.log</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  dbPath: &#x2F;data&#x2F;mongodb&#x2F;data</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">  directoryPerDB: true</span><br><span class="line">  wiredTiger:</span><br><span class="line">     engineConfig:</span><br><span class="line">        cacheSizeGB: 24   #å¦‚æœä¸€å°æœºå™¨å¯åŠ¨ä¸€ä¸ªå®ä¾‹è¿™ä¸ªå¯ä»¥æ³¨é‡Šé€‰æ‹©é»˜è®¤ï¼Œå¦‚æœä¸€å°æœºå™¨å¯åŠ¨å¤šä¸ªå®ä¾‹ï¼Œéœ€è¦è®¾ç½®å†…å­˜å¤§å°ï¼Œé¿å…äº’ç›¸æŠ¢å å†…å­˜</span><br><span class="line">        directoryForIndexes: true</span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true</span><br><span class="line">  pidFilePath: &#x2F;data&#x2F;mongodb&#x2F;pid&#x2F;mongod.pid</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27020</span><br><span class="line">  bindIp: 172.31.28.23     #ä¿®æ”¹ä¸ºæœ¬æœºIPåœ°å€</span><br><span class="line">  maxIncomingConnections: 5000</span><br><span class="line"></span><br><span class="line">#security:</span><br><span class="line">  #keyFile: &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;keyfile</span><br><span class="line">  #authorization: enabled</span><br><span class="line">replication: #å‰¯æœ¬é›†ç”¨åˆ°çš„é…ç½®</span><br><span class="line">   oplogSizeMB: 1024   #å¤åˆ¶æ“ä½œæ—¥å¿—çš„å¤§å°</span><br><span class="line">   replSetName: rs02  #å‰¯æœ¬é›†åç§°ï¼ŒåŒä¸€ä¸ªå‰¯æœ¬é›†çš„æ‰€æœ‰ä¸»æœºå¿…é¡»è®¾ç½®ç›¸åŒçš„åç§°</span><br></pre></td></tr></table></figure><h2 id="å°†é…ç½®å¤åˆ¶åˆ°å…¶ä»–æœºå™¨"><a href="#å°†é…ç½®å¤åˆ¶åˆ°å…¶ä»–æœºå™¨" class="headerlink" title="å°†é…ç½®å¤åˆ¶åˆ°å…¶ä»–æœºå™¨"></a>å°†é…ç½®å¤åˆ¶åˆ°å…¶ä»–æœºå™¨</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-28-23 ~]# scp -r &#x2F;data&#x2F; root@172.31.28.24:&#x2F;data&#x2F;</span><br><span class="line">[root@VM-28-23 ~]# scp -r &#x2F;data&#x2F; root@172.31.28.25:&#x2F;data&#x2F;</span><br></pre></td></tr></table></figure><p>å°†/data/mongodb/conf/mongodb.confæ–‡ä»¶ä¸­çš„bindIpä¿®æ”¹æˆå„è‡ªæœºå™¨çš„IP</p><h2 id="å¯åŠ¨Mongodb"><a href="#å¯åŠ¨Mongodb" class="headerlink" title="å¯åŠ¨Mongodb"></a>å¯åŠ¨Mongodb</h2><p>ä¸‹é¢æ“ä½œéœ€è¦åœ¨æ¯å°æœºå™¨ä¸Šæ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-28-23 ~]# groupadd mongod</span><br><span class="line">[root@VM-28-23 ~]# useradd -g mongod mongod</span><br><span class="line">[root@VM-28-23 ~]# yum install -y libcurl openssl glibc</span><br><span class="line">[root@VM-28-23 ~]# cd &#x2F;data</span><br><span class="line">[root@VM-28-23 ~]# ln -s mongodb-linux-x86_64-rhel70-4.2.8 mongodb-4.2</span><br><span class="line">[root@VM-28-23 ~]# chown -R mongod.mongod &#x2F;data</span><br><span class="line">[root@VM-28-23 ~]# sudo -u mongod &#x2F;data&#x2F;mongodb-4.2&#x2F;bin&#x2F;mongod -f &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;mongodb.conf</span><br></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–é›†ç¾¤"><a href="#åˆå§‹åŒ–é›†ç¾¤" class="headerlink" title="åˆå§‹åŒ–é›†ç¾¤"></a>åˆå§‹åŒ–é›†ç¾¤</h2><p>å‡†å¤‡ä¸€ä¸ªconfig</p><p>config = { _id:â€rs02â€, members:[<br>â€¦ â€¦                      {_id:0,host:â€172.31.28.23:27020â€,priority:90},<br>â€¦ â€¦                      {_id:1,host:â€172.31.28.24:27020â€,priority:90},<br>â€¦ â€¦                      {_id:2,host:â€172.31.28.25:27020â€,arbiterOnly:true}<br>â€¦ â€¦               ]<br>â€¦ â€¦ }</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-28-23 ~] #cd &#x2F;data&#x2F;mongodb-4.2&#x2F;bin</span><br><span class="line">[root@VM-28-23 bin]# .&#x2F;mongo 172.31.28.23:27020</span><br><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt; config &#x3D; &#123; _id:&quot;rs02&quot;, members:[</span><br><span class="line">... ...                      &#123;_id:0,host:&quot;172.31.28.23:27020&quot;,priority:90&#125;,</span><br><span class="line">... ...                      &#123;_id:1,host:&quot;172.31.28.24:27020&quot;,priority:90&#125;,</span><br><span class="line">... ...                      &#123;_id:2,host:&quot;172.31.28.25:27020&quot;,arbiterOnly:true&#125;</span><br><span class="line">... ...               ]</span><br><span class="line">... ... &#125;</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : &quot;rs02&quot;,</span><br><span class="line">&quot;members&quot; : [</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : 0,</span><br><span class="line">&quot;host&quot; : &quot;172.31.28.23:27020&quot;,</span><br><span class="line">&quot;priority&quot; : 90</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : 1,</span><br><span class="line">&quot;host&quot; : &quot;172.31.28.24:27020&quot;,</span><br><span class="line">&quot;priority&quot; : 90</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : 2,</span><br><span class="line">&quot;host&quot; : &quot;172.31.28.25:27020&quot;,</span><br><span class="line">&quot;arbiterOnly&quot; : true</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&gt; rs.initiate(config);</span><br><span class="line">&#123;</span><br><span class="line">&quot;ok&quot; : 1,</span><br><span class="line">&quot;$clusterTime&quot; : &#123;</span><br><span class="line">&quot;clusterTime&quot; : Timestamp(1595209506, 1),</span><br><span class="line">&quot;signature&quot; : &#123;</span><br><span class="line">&quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA&#x3D;&quot;),</span><br><span class="line">&quot;keyId&quot; : NumberLong(0)</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;operationTime&quot; : Timestamp(1595209506, 1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€"><a href="#æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€"></a>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">rs02:SECONDARY&gt; rs.status()</span><br><span class="line">&#123;</span><br><span class="line">&quot;set&quot; : &quot;rs02&quot;,</span><br><span class="line">&quot;date&quot; : ISODate(&quot;2020-07-20T01:45:29.117Z&quot;),</span><br><span class="line">&quot;myState&quot; : 1,</span><br><span class="line">&quot;term&quot; : NumberLong(1),</span><br><span class="line">&quot;syncingTo&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncSourceHost&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncSourceId&quot; : -1,</span><br><span class="line">&quot;heartbeatIntervalMillis&quot; : NumberLong(2000),</span><br><span class="line">&quot;majorityVoteCount&quot; : 2,</span><br><span class="line">&quot;writeMajorityCount&quot; : 2,</span><br><span class="line">&quot;optimes&quot; : &#123;</span><br><span class="line">&quot;lastCommittedOpTime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1595209518, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;lastCommittedWallTime&quot; : ISODate(&quot;2020-07-20T01:45:18.603Z&quot;),</span><br><span class="line">&quot;readConcernMajorityOpTime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1595209518, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;readConcernMajorityWallTime&quot; : ISODate(&quot;2020-07-20T01:45:18.603Z&quot;),</span><br><span class="line">&quot;appliedOpTime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1595209518, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;durableOpTime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1595209518, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;lastAppliedWallTime&quot; : ISODate(&quot;2020-07-20T01:45:18.603Z&quot;),</span><br><span class="line">&quot;lastDurableWallTime&quot; : ISODate(&quot;2020-07-20T01:45:18.603Z&quot;)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;lastStableRecoveryTimestamp&quot; : Timestamp(1595209517, 3),</span><br><span class="line">&quot;lastStableCheckpointTimestamp&quot; : Timestamp(1595209517, 3),</span><br><span class="line">&quot;electionCandidateMetrics&quot; : &#123;</span><br><span class="line">&quot;lastElectionReason&quot; : &quot;electionTimeout&quot;,</span><br><span class="line">&quot;lastElectionDate&quot; : ISODate(&quot;2020-07-20T01:45:17.641Z&quot;),</span><br><span class="line">&quot;electionTerm&quot; : NumberLong(1),</span><br><span class="line">&quot;lastCommittedOpTimeAtElection&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(0, 0),</span><br><span class="line">&quot;t&quot; : NumberLong(-1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;lastSeenOpTimeAtElection&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1595209506, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(-1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;numVotesNeeded&quot; : 2,</span><br><span class="line">&quot;priorityAtElection&quot; : 90,</span><br><span class="line">&quot;electionTimeoutMillis&quot; : NumberLong(10000),</span><br><span class="line">&quot;numCatchUpOps&quot; : NumberLong(0),</span><br><span class="line">&quot;newTermStartDate&quot; : ISODate(&quot;2020-07-20T01:45:17.693Z&quot;),</span><br><span class="line">&quot;wMajorityWriteAvailabilityDate&quot; : ISODate(&quot;2020-07-20T01:45:18.590Z&quot;)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;members&quot; : [</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : 0,</span><br><span class="line">&quot;name&quot; : &quot;172.31.28.23:27020&quot;,</span><br><span class="line">&quot;health&quot; : 1,</span><br><span class="line">&quot;state&quot; : 1,</span><br><span class="line">&quot;stateStr&quot; : &quot;PRIMARY&quot;,</span><br><span class="line">&quot;uptime&quot; : 246,</span><br><span class="line">&quot;optime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1595209518, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;optimeDate&quot; : ISODate(&quot;2020-07-20T01:45:18Z&quot;),</span><br><span class="line">&quot;syncingTo&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncSourceHost&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncSourceId&quot; : -1,</span><br><span class="line">&quot;infoMessage&quot; : &quot;could not find member to sync from&quot;,</span><br><span class="line">&quot;electionTime&quot; : Timestamp(1595209517, 1),</span><br><span class="line">&quot;electionDate&quot; : ISODate(&quot;2020-07-20T01:45:17Z&quot;),</span><br><span class="line">&quot;configVersion&quot; : 1,</span><br><span class="line">&quot;self&quot; : true,</span><br><span class="line">&quot;lastHeartbeatMessage&quot; : &quot;&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : 1,</span><br><span class="line">&quot;name&quot; : &quot;172.31.28.24:27020&quot;,</span><br><span class="line">&quot;health&quot; : 1,</span><br><span class="line">&quot;state&quot; : 2,</span><br><span class="line">&quot;stateStr&quot; : &quot;SECONDARY&quot;,</span><br><span class="line">&quot;uptime&quot; : 22,</span><br><span class="line">&quot;optime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1595209518, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;optimeDurable&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1595209518, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;optimeDate&quot; : ISODate(&quot;2020-07-20T01:45:18Z&quot;),</span><br><span class="line">&quot;optimeDurableDate&quot; : ISODate(&quot;2020-07-20T01:45:18Z&quot;),</span><br><span class="line">&quot;lastHeartbeat&quot; : ISODate(&quot;2020-07-20T01:45:27.655Z&quot;),</span><br><span class="line">&quot;lastHeartbeatRecv&quot; : ISODate(&quot;2020-07-20T01:45:28.551Z&quot;),</span><br><span class="line">&quot;pingMs&quot; : NumberLong(1),</span><br><span class="line">&quot;lastHeartbeatMessage&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncingTo&quot; : &quot;172.31.28.23:27020&quot;,</span><br><span class="line">&quot;syncSourceHost&quot; : &quot;172.31.28.23:27020&quot;,</span><br><span class="line">&quot;syncSourceId&quot; : 0,</span><br><span class="line">&quot;infoMessage&quot; : &quot;&quot;,</span><br><span class="line">&quot;configVersion&quot; : 1</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : 2,</span><br><span class="line">&quot;name&quot; : &quot;172.31.28.25:27020&quot;,</span><br><span class="line">&quot;health&quot; : 1,</span><br><span class="line">&quot;state&quot; : 7,</span><br><span class="line">&quot;stateStr&quot; : &quot;ARBITER&quot;,</span><br><span class="line">&quot;uptime&quot; : 22,</span><br><span class="line">&quot;lastHeartbeat&quot; : ISODate(&quot;2020-07-20T01:45:27.654Z&quot;),</span><br><span class="line">&quot;lastHeartbeatRecv&quot; : ISODate(&quot;2020-07-20T01:45:27.393Z&quot;),</span><br><span class="line">&quot;pingMs&quot; : NumberLong(0),</span><br><span class="line">&quot;lastHeartbeatMessage&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncingTo&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncSourceHost&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncSourceId&quot; : -1,</span><br><span class="line">&quot;infoMessage&quot; : &quot;&quot;,</span><br><span class="line">&quot;configVersion&quot; : 1</span><br><span class="line">&#125;</span><br><span class="line">],</span><br><span class="line">&quot;ok&quot; : 1,</span><br><span class="line">&quot;$clusterTime&quot; : &#123;</span><br><span class="line">&quot;clusterTime&quot; : Timestamp(1595209518, 1),</span><br><span class="line">&quot;signature&quot; : &#123;</span><br><span class="line">&quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA&#x3D;&quot;),</span><br><span class="line">&quot;keyId&quot; : NumberLong(0)</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;operationTime&quot; : Timestamp(1595209518, 1)</span><br><span class="line">&#125;</span><br><span class="line">rs02:PRIMARY&gt;</span><br></pre></td></tr></table></figure><h2 id="éªŒè¯å‰¯æœ¬é›†æ•°æ®å¤åˆ¶åŠŸèƒ½"><a href="#éªŒè¯å‰¯æœ¬é›†æ•°æ®å¤åˆ¶åŠŸèƒ½" class="headerlink" title="éªŒè¯å‰¯æœ¬é›†æ•°æ®å¤åˆ¶åŠŸèƒ½"></a>éªŒè¯å‰¯æœ¬é›†æ•°æ®å¤åˆ¶åŠŸèƒ½</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#ä¸»èŠ‚ç‚¹</span><br><span class="line">use test</span><br><span class="line">db.createCollection(&#39;user&#39;)</span><br><span class="line">db.user.insert(&#123;&#39;name&#39;:&#39;james&#39;&#125;)</span><br><span class="line"> </span><br><span class="line">#ä»èŠ‚ç‚¹</span><br><span class="line">use test</span><br><span class="line">show collections</span><br><span class="line">db.user.find()</span><br></pre></td></tr></table></figure><p>å‘ç°ä¸»èŠ‚ç‚¹çš„æ•°æ®åœ¨ä»èŠ‚ç‚¹èƒ½è¯»åˆ°ã€‚</p><p>è‡³æ­¤Mongodbå‰¯æœ¬é›†ç®—æ˜¯å®‰è£…å®Œäº†ï¼Œå¦‚æœéœ€è¦å¼€æƒé™è®¤è¯ï¼Œè¯·å¾€åçœ‹~</p><h1 id="Mongodbæƒé™è®¤è¯"><a href="#Mongodbæƒé™è®¤è¯" class="headerlink" title="Mongodbæƒé™è®¤è¯"></a>Mongodbæƒé™è®¤è¯</h1><h2 id="å‰¯æœ¬é›†é…ç½®ç”¨æˆ·å’Œå¯†ç ï¼Œç™»å½•ä¸»èŠ‚ç‚¹-æ·»åŠ admin-ç”¨æˆ·ã€‚"><a href="#å‰¯æœ¬é›†é…ç½®ç”¨æˆ·å’Œå¯†ç ï¼Œç™»å½•ä¸»èŠ‚ç‚¹-æ·»åŠ admin-ç”¨æˆ·ã€‚" class="headerlink" title="å‰¯æœ¬é›†é…ç½®ç”¨æˆ·å’Œå¯†ç ï¼Œç™»å½•ä¸»èŠ‚ç‚¹,æ·»åŠ admin ç”¨æˆ·ã€‚"></a>å‰¯æœ¬é›†é…ç½®ç”¨æˆ·å’Œå¯†ç ï¼Œç™»å½•ä¸»èŠ‚ç‚¹,æ·»åŠ admin ç”¨æˆ·ã€‚</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt; db.createUser(&#123; user: &quot;admin&quot;, pwd: &quot;123456&quot;, roles: [&#123; role: &quot;root&quot;, db: &quot;admin&quot; &#125;] &#125;)</span><br><span class="line">Successfully added user: &#123;</span><br><span class="line">    &quot;user&quot; : &quot;admin&quot;,</span><br><span class="line">    &quot;roles&quot; : [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;role&quot; : &quot;root&quot;,</span><br><span class="line">            &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åœ¨ä¸»èŠ‚ç‚¹ç”Ÿæˆ-keyflie-å¹¶å¤åˆ¶åˆ°å…¶å®ƒä¸¤ä¸ªèŠ‚ç‚¹"><a href="#åœ¨ä¸»èŠ‚ç‚¹ç”Ÿæˆ-keyflie-å¹¶å¤åˆ¶åˆ°å…¶å®ƒä¸¤ä¸ªèŠ‚ç‚¹" class="headerlink" title="åœ¨ä¸»èŠ‚ç‚¹ç”Ÿæˆ keyflie å¹¶å¤åˆ¶åˆ°å…¶å®ƒä¸¤ä¸ªèŠ‚ç‚¹"></a>åœ¨ä¸»èŠ‚ç‚¹ç”Ÿæˆ keyflie å¹¶å¤åˆ¶åˆ°å…¶å®ƒä¸¤ä¸ªèŠ‚ç‚¹</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># ç”Ÿæˆ keyFile</span><br><span class="line">openssl rand -base64 90 -out &#x2F;data&#x2F;mongodb-4.2&#x2F;keyfile</span><br><span class="line"></span><br><span class="line"># å¤åˆ¶åˆ°å…¶å®ƒä¸¤ä¸ªèŠ‚ç‚¹</span><br><span class="line">scp keyfile root@172.31.28.24:&#x2F;data&#x2F;mongodb-4.2&#x2F;</span><br><span class="line">scp keyfile root@172.31.28.25:&#x2F;data&#x2F;mongodb-4.2&#x2F;</span><br><span class="line"></span><br><span class="line"># æ›´æ”¹ä¸‰ä¸ªèŠ‚ç‚¹çš„ keyFile æ–‡ä»¶æƒé™å’Œæ‰€æœ‰è€…</span><br><span class="line">chmod 600 &#x2F;data&#x2F;mongodb-4.2&#x2F;keyfile</span><br><span class="line">chown mongod:mongod &#x2F;data&#x2F;mongodb-4.2&#x2F;keyfile</span><br></pre></td></tr></table></figure><h2 id="æ›´æ”¹ä¸‰ä¸ªèŠ‚ç‚¹çš„-mongodb-conf-é…ç½®æ–‡ä»¶"><a href="#æ›´æ”¹ä¸‰ä¸ªèŠ‚ç‚¹çš„-mongodb-conf-é…ç½®æ–‡ä»¶" class="headerlink" title="æ›´æ”¹ä¸‰ä¸ªèŠ‚ç‚¹çš„ mongodb.conf é…ç½®æ–‡ä»¶"></a>æ›´æ”¹ä¸‰ä¸ªèŠ‚ç‚¹çš„ mongodb.conf é…ç½®æ–‡ä»¶</h2><p>å°† security çš„å‚æ•° authorization è®¾ç½®ä¸º enabledï¼Œå¹¶é…ç½®<br>keyFile çš„è·¯å¾„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;mongodb.conf</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">   authorization: &quot;enabled&quot;</span><br><span class="line">   keyFile: &#39;&#x2F;data&#x2F;mongodb-4.2&#x2F;keyfile&#39;</span><br><span class="line">   clusterAuthMode: &quot;keyFile&quot;</span><br><span class="line">   </span><br><span class="line">ç„¶åä¾æ¬¡é‡å¯mongdb01ã€02ã€03</span><br><span class="line"></span><br><span class="line"># å…³é—­</span><br><span class="line">sudo -u mongod &#x2F;data&#x2F;mongodb-4.2&#x2F;bin&#x2F;mongod --shutdown   --dbpath &#x2F;data&#x2F;mongodb&#x2F;data</span><br><span class="line"></span><br><span class="line"># å¯åŠ¨</span><br><span class="line">sudo -u mongod &#x2F;data&#x2F;mongodb-4.2&#x2F;bin&#x2F;mongod -f &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;mongodb.conf</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•æƒé™éªŒè¯"><a href="#æµ‹è¯•æƒé™éªŒè¯" class="headerlink" title="æµ‹è¯•æƒé™éªŒè¯"></a>æµ‹è¯•æƒé™éªŒè¯</h2><p>ç™»é™†ä¸»èŠ‚ç‚¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; show dbs</span><br><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt; db.auth(&#39;admin&#39;,&#39;123456&#39;)</span><br><span class="line">1</span><br><span class="line">&gt; show dbs</span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">local   0.002GB</span><br><span class="line">test    0.000GB</span><br></pre></td></tr></table></figure><p>æƒé™è®¤è¯åˆ™éªŒè¯å®Œæˆ</p><h1 id="Mongodbå¸¸ç”¨ç®¡ç†å‘½ä»¤"><a href="#Mongodbå¸¸ç”¨ç®¡ç†å‘½ä»¤" class="headerlink" title="Mongodbå¸¸ç”¨ç®¡ç†å‘½ä»¤"></a>Mongodbå¸¸ç”¨ç®¡ç†å‘½ä»¤</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"># å‰¯æœ¬é›†åˆå§‹åŒ–</span><br><span class="line">rs.initiate( &#123;</span><br><span class="line">   _id : &quot;rs0&quot;,</span><br><span class="line">   members: [</span><br><span class="line">      &#123; _id: 0, host: &quot;mongodb0.example.net:27017&quot; &#125;,</span><br><span class="line">      &#123; _id: 1, host: &quot;mongodb1.example.net:27017&quot; &#125;,</span><br><span class="line">      &#123; _id: 2, host: &quot;mongodb2.example.net:27017&quot; &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;)</span><br><span class="line"># å‰¯æœ¬é›†æ·»åŠ æˆå‘˜</span><br><span class="line">rs.add(&#39;mongodb3.example.net:27017&#39;)</span><br><span class="line"># å‰¯æœ¬é›†æ·»åŠ ä»²è£èŠ‚ç‚¹</span><br><span class="line">rs.addArb(&#39;mongodb4.example.net:27017&#39;)</span><br><span class="line"># ç§»é™¤èŠ‚ç‚¹</span><br><span class="line">rs.remove(&#39;hostportstr&#39;)</span><br><span class="line"># æŸ¥çœ‹å½“å‰çš„é…ç½®</span><br><span class="line">rs.conf()</span><br><span class="line"># æŸ¥çœ‹å„ä¸ªèŠ‚ç‚¹çŠ¶æ€å’Œèº«ä»½</span><br><span class="line">rs.status()</span><br><span class="line"># è®¾å®šæŸä¸ªèŠ‚ç‚¹å¤šå°‘ç§’ä¸å¯æˆä¸ºä¸»èŠ‚ç‚¹</span><br><span class="line">rs.freeze(secs)</span><br><span class="line"># è®¾ç½®æ¬¡èŠ‚ç‚¹ä»æŒ‡å®šèŠ‚ç‚¹åŒæ­¥æ•°æ®</span><br><span class="line">rs.syncFrom(hostportstr)</span><br><span class="line"># é™ä½ä¸»èŠ‚ç‚¹ä¸ºæ¬¡èŠ‚ç‚¹ï¼Œåªèƒ½åœ¨ä¸»èŠ‚ç‚¹ä¸Šè¿è¡Œ</span><br><span class="line">rs.stepDown([stepdownSecs, catchUpSecs])</span><br><span class="line"># æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">rs.help()</span><br><span class="line"># æ¬¡èŠ‚ç‚¹æ‰§è¡Œï¼Œè¡¨ç¤ºå…è®¸æ¬¡èŠ‚ç‚¹è¯»å–æ•°æ®</span><br><span class="line">rs.slaveOk()</span><br><span class="line"># åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦æ˜¯ä¸»èŠ‚ç‚¹</span><br><span class="line">rs.isMaster()</span><br><span class="line"># æŸ¥çœ‹ Oplog ä¿¡æ¯</span><br><span class="line">rs.printReplicationInfo()</span><br><span class="line">#  æŸ¥çœ‹å‰¯æœ¬é›†çš„æ¬¡èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹å»¶è¿Ÿ</span><br><span class="line">db.printSlaveReplicationInfo()</span><br><span class="line"># ç§»é™¤åŸæœ‰å‰¯æœ¬é›†å‘½ä»¤</span><br><span class="line">use local</span><br><span class="line">db.system.replset.remove(&#123;&#125;)</span><br><span class="line"># å…³é—­ mongodbè¿›ç¨‹æœåŠ¡</span><br><span class="line">use admin</span><br><span class="line">db.shutdownServer()</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://blog.51cto.com/jiachen/2485887" target="_blank" rel="noopener">Mongodb 4.2ç‰ˆæœ¬å‰¯æœ¬é›†é…ç½®</a></p><p><a href="https://www.cnblogs.com/operationhome/p/10744712.html" target="_blank" rel="noopener">MongoDB-å‰¯æœ¬é›†æ­å»ºä¸ç®¡ç†</a></p>]]></content>
      
      
      <categories>
          
          <category> Mongodb </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mongodb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éƒ¨ç½²å¼€æºAPIç½‘å…³â€”â€”kong</title>
      <link href="/2020/07/30/slb/kong-install/"/>
      <url>/2020/07/30/slb/kong-install/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><h1 id="kongç®€ä»‹"><a href="#kongç®€ä»‹" class="headerlink" title="kongç®€ä»‹"></a>kongç®€ä»‹</h1><p>Kongæ˜¯å…¨çƒæœ€å—æ¬¢è¿çš„å¼€æºAPIç½‘å…³ã€‚ä¸“ä¸ºå¤šäº‘å’Œæ··åˆè€Œå»ºï¼Œé’ˆå¯¹å¾®æœåŠ¡å’Œåˆ†å¸ƒå¼æ¶æ„è¿›è¡Œäº†ä¼˜åŒ–ã€‚</p><hr><p>åŠŸèƒ½</p><ul><li>è®¤è¯æ–¹å¼<br>é€šè¿‡èº«ä»½éªŒè¯å±‚ä¿æŠ¤æ‚¨çš„æœåŠ¡</li><li>äº¤é€šç®¡åˆ¶<br>ç®¡ç†ï¼Œé™åˆ¶å’Œé™åˆ¶å…¥ç«™å’Œå‡ºç«™APIæµé‡</li><li>åˆ†æå·¥å…·<br>å¯è§†åŒ–ï¼Œæ£€æŸ¥å’Œç›‘è§†APIå’Œå¾®æœåŠ¡æµé‡</li><li>è½¬å‘<br>å³æ—¶è½¬å‘è¯·æ±‚å’Œå“åº”</li><li>è®°å½•ä¸­<br>å°†è¯·æ±‚å’Œå“åº”æ•°æ®æµå¼ä¼ è¾“åˆ°æ—¥å¿—è®°å½•è§£å†³æ–¹æ¡ˆ</li><li>æ— æœåŠ¡å™¨<br>é€šè¿‡APIè°ƒç”¨æ— æœåŠ¡å™¨åŠŸèƒ½</li></ul><hr><p>ä¼˜ç‚¹</p><ul><li>æ— ä¸ä¼¦æ¯”çš„æ€§èƒ½ï¼šå€ŸåŠ©Kongçš„è¶…é«˜æ€§èƒ½å†…æ ¸ï¼Œå¯å®ç°ä¸šç•Œæœ€ä½³çš„å»¶è¿Ÿæ€§èƒ½ã€‚ç¡®ä¿æ‰€æœ‰æœåŠ¡ä¹‹é—´çš„æ— ç¼é€šä¿¡ï¼Œæ— è®ºå®ƒä»¬åœ¨ä½•å¤„è¿è¡Œã€‚</li><li>ä¸“ä¸ºäº‘è§„æ¨¡è®¾è®¡ï¼šå€ŸåŠ©Kongçš„è½»é‡çº§æ ¸å¿ƒï¼Œå¯æœ€å¤§ç¨‹åº¦åœ°æé«˜èµ„æºæ•ˆç‡å¹¶æœ€å°åŒ–å åœ°é¢ç§¯ã€‚çº¿æ€§æ‰©å±•KongèŠ‚ç‚¹ä»¥å¤„ç†æ•°ä¸‡äº¿æ¬¡APIè°ƒç”¨ï¼Œè€Œæ€§èƒ½æˆ–ç¨³å®šæ€§é™ä½ä¸ºé›¶ã€‚</li><li>æ— ä¸ä¼¦æ¯”çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼šåœ¨ä»è£¸æœºåˆ°äº‘ï¼Œä»å®¹å™¨åˆ°Kubernetesçš„ä»»ä½•ç¯å¢ƒï¼Œå¹³å°å’Œä»»ä½•å®æ–½æ¨¡å¼ä¸‹å‡å¯è¿è¡ŒKongã€‚ä½¿ç”¨è‡ªå®šä¹‰æ’ä»¶è½»æ¾æ‰©å±•Kongä»¥ä½¿å…¶é€‚åˆä»»ä½•ç”¨ä¾‹ã€‚</li></ul><p>ä¸ªäººç†è§£ï¼šæˆ‘ç†è§£çš„kongå°±æ˜¯ä¸€ä¸ªåŠ å¼ºç‰ˆçš„Nginxï¼Œæœ‰ç€æ¯”è´Ÿè½½å‡è¡¡å™¨æ›´ä¸ºå¼ºå¤§çš„åŠŸèƒ½(ä½¿ç”¨æœåŠ¡å’Œè·¯ç”±å¯¹è±¡å…¬å¼€æœåŠ¡ã€è®¾ç½®é€Ÿç‡é™åˆ¶å’Œä»£ç†ç¼“å­˜ã€é€šè¿‡å¯†é’¥éªŒè¯æ¥ä¿æŠ¤æœåŠ¡ã€è´Ÿè½½å‡è¡¡æµé‡)åŠå¯è§†åŒ–ç•Œé¢çš„é…ç½®</p><p>kong-admin<br>kong-proxy</p><p>konga-ui</p><h1 id="å‡†å¤‡æ¡ä»¶"><a href="#å‡†å¤‡æ¡ä»¶" class="headerlink" title="å‡†å¤‡æ¡ä»¶"></a>å‡†å¤‡æ¡ä»¶</h1><p>ä¸€å°æœåŠ¡å™¨è£…PGSQLæ•°æ®åº“ï¼ˆéå¿…é¡»ï¼‰</p><p>ä¸€ä¸ªK8Sé›†ç¾¤</p><p>é›†ç¾¤å‡å¯ä»¥è¿å¤–ç½‘</p><p>helmåŒ…å¦‚ä¸‹</p><p>é“¾æ¥: <a href="https://pan.baidu.com/s/12IcxKic_fpVFfQzohiVLkw" target="_blank" rel="noopener">https://pan.baidu.com/s/12IcxKic_fpVFfQzohiVLkw</a> æå–ç : iqcz å¤åˆ¶è¿™æ®µå†…å®¹åæ‰“å¼€ç™¾åº¦ç½‘ç›˜æ‰‹æœºAppï¼Œæ“ä½œæ›´æ–¹ä¾¿å“¦</p><h1 id="éƒ¨ç½²kong"><a href="#éƒ¨ç½²kong" class="headerlink" title="éƒ¨ç½²kong"></a>éƒ¨ç½²kong</h1><h2 id="å®‰è£…kong-database"><a href="#å®‰è£…kong-database" class="headerlink" title="å®‰è£…kong-database"></a>å®‰è£…kong-database</h2><p>é€‰æ‹©ä¸€å°æœåŠ¡å™¨è£…PGSQLæ•°æ®åº“</p><p>å»ºè®®ä½¿ç”¨Dockerå®‰è£…postgresã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºdockerç½‘ç»œ</span><br><span class="line">docker network create kong-net</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºæ•°æ®åº“</span><br><span class="line">docker run -d --restart always  --name kong-database \</span><br><span class="line">               --network&#x3D;kong-net \</span><br><span class="line">               -v &#x2F;data&#x2F;pgsql:&#x2F;var&#x2F;lib&#x2F;postgresql&#x2F;data \</span><br><span class="line">               -p 5432:5432 \</span><br><span class="line">               -e &quot;POSTGRES_USER&#x3D;kong&quot; \</span><br><span class="line">               -e &quot;POSTGRES_DB&#x3D;kong&quot; \</span><br><span class="line">               -e &quot;POSTGRES_PASSWORD&#x3D;kong&quot; \</span><br><span class="line">               postgres:9.6</span><br><span class="line">æ³¨æ„ä¿®æ”¹å‚æ•°ï¼š POSTGRES_USERï¼ŒPOSTGRES_PASSWORDã€‚</span><br><span class="line"></span><br><span class="line"># åˆå§‹åŒ–Kongè¿æ¥æ•°æ®åº“çš„é»˜è®¤ç»“æ„</span><br><span class="line">docker run --rm \</span><br><span class="line">     --network&#x3D;kong-net \</span><br><span class="line">     -e &quot;KONG_DATABASE&#x3D;postgres&quot; \</span><br><span class="line">     -e &quot;KONG_PG_HOST&#x3D;kong-database&quot; \</span><br><span class="line">     -e &quot;KONG_PG_USER&#x3D;kong&quot; \</span><br><span class="line">     -e &quot;KONG_PG_PASSWORD&#x3D;kong&quot; \</span><br><span class="line">     -e &quot;KONG_CASSANDRA_CONTACT_POINTS&#x3D;kong-database&quot; \</span><br><span class="line">     kong:latest kong migrations bootstrap</span><br><span class="line">æ³¨æ„ä¿®æ”¹å‚æ•°ï¼šKONG_PG_HOSTï¼ŒKONG_PG_PASSWORD</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹kongé¡¹ç›®é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹kongé¡¹ç›®é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹kongé¡¹ç›®é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹kongé¡¹ç›®é…ç½®æ–‡ä»¶</h2><p>ä¿®æ”¹kongé¡¹ç›® helméƒ¨ç½²æ–‡ä»¶å¤¹é‡Œçš„values.yamlæ–‡ä»¶</p><h3 id="Kong-é…ç½®æ–‡ä»¶"><a href="#Kong-é…ç½®æ–‡ä»¶" class="headerlink" title="Kong é…ç½®æ–‡ä»¶"></a>Kong é…ç½®æ–‡ä»¶</h3><p>é‡‡ç”¨k8så¤–çš„postgresæ•°æ®åº“ï¼Œå› æ­¤å…³é—­hemlè„šæœ¬ä¸­çš„è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">env:</span><br><span class="line">  database: &quot;postgres&quot;</span><br><span class="line">  PG_HOST: &quot;172.31.21.32&quot;</span><br><span class="line">  PG_PASSWORD: &quot;kong&quot;</span><br><span class="line">  CASSANDRA_CONTACT_POINTS: &quot;kong-database&quot;</span><br><span class="line"></span><br><span class="line">runMigrations: false</span><br></pre></td></tr></table></figure><h3 id="Kong-admin-é…ç½®æ–‡ä»¶"><a href="#Kong-admin-é…ç½®æ–‡ä»¶" class="headerlink" title="Kong admin é…ç½®æ–‡ä»¶"></a>Kong admin é…ç½®æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">admin:</span><br><span class="line">  # æ§åˆ¶k8s æ˜¯å¦ç”ŸæˆService</span><br><span class="line">  enabled: true</span><br><span class="line"> </span><br><span class="line">  http:</span><br><span class="line">    # enabled æ§åˆ¶ deployment æ˜¯å¦ç”Ÿæˆç›¸åº” docker http containerPortï¼Œå¦‚ä½¿ç”¨nodeport </span><br><span class="line">    enabled: true</span><br><span class="line">    servicePort: 8001</span><br><span class="line">    containerPort: 8001</span><br><span class="line">    # å¦‚ä½¿ç”¨é˜¿é‡Œäº‘SLBç›´æ¥åˆ°nodeport è¯·è®¾ç½®nodePortç«¯å£,ä¿è¯é›†ç¾¤å†…å”¯ä¸€</span><br><span class="line">    nodePort: 30001</span><br><span class="line">  </span><br><span class="line">  tls:</span><br><span class="line">    enabled: true</span><br><span class="line">    servicePort: 8444</span><br><span class="line">    containerPort: 8444</span><br><span class="line"></span><br><span class="line">  # ç”Ÿäº§ç¯å¢ƒ å¦‚å€ŸåŠ©é˜¿é‡Œäº‘SLBæœåŠ¡ï¼Œè®¾ç½®NodePortæ¨¡å¼ï¼Œ</span><br><span class="line">  type: NodePort</span><br><span class="line"></span><br><span class="line">  ingress:</span><br><span class="line">    # ingress éƒ¨åˆ†æ ¹æ®å®é™…æƒ…å†µé…ç½®åŸŸåå’Œç«¯å£ï¼Œå»ºè®®æ‰“å¼€ï¼›å¦‚ä½¿ç”¨nodeportæ¨¡å¼ï¼Œä½¿ç”¨é˜¿é‡Œäº‘slbæœåŠ¡ï¼Œå¯ä»¥è®¾ç½®ä¸ºFalseã€‚</span><br><span class="line">    enabled: False</span><br></pre></td></tr></table></figure><h3 id="Kong-proxy-é…ç½®æ–‡ä»¶"><a href="#Kong-proxy-é…ç½®æ–‡ä»¶" class="headerlink" title="Kong proxy é…ç½®æ–‡ä»¶"></a>Kong proxy é…ç½®æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">proxy: </span><br><span class="line">  enabled: true</span><br><span class="line">  http:</span><br><span class="line">    enabled: true</span><br><span class="line">    servicePort: 80</span><br><span class="line">    containerPort: 8000   </span><br><span class="line">    # å¦‚ä½¿ç”¨é˜¿é‡Œäº‘SLBç›´æ¥åˆ°nodeport è¯·è®¾ç½®nodePortç«¯å£,ä¿è¯é›†ç¾¤å†…å”¯ä¸€</span><br><span class="line">    nodePort: 30000</span><br><span class="line"></span><br><span class="line">  tls:</span><br><span class="line">    enabled: true</span><br><span class="line">    servicePort: 443</span><br><span class="line">    containerPort: 8443</span><br><span class="line">  </span><br><span class="line">  # ç”Ÿäº§ç¯å¢ƒ å¦‚å€ŸåŠ©é˜¿é‡Œäº‘SLBæœåŠ¡ï¼Œè®¾ç½®NodePortæ¨¡å¼ï¼Œ</span><br><span class="line">  type: NodePort</span><br><span class="line"></span><br><span class="line">  ingress:</span><br><span class="line">    # ingress éƒ¨åˆ†æ ¹æ®å®é™…æƒ…å†µé…ç½®åŸŸåå’Œç«¯å£ï¼Œå»ºè®®æ‰“å¼€ï¼›å¦‚ä½¿ç”¨nodeportæ¨¡å¼ï¼Œä½¿ç”¨é˜¿é‡Œäº‘slbæœåŠ¡ï¼Œå¯ä»¥è®¾ç½®ä¸ºFalseã€‚</span><br><span class="line">    enabled: false</span><br></pre></td></tr></table></figure><h3 id="kong-ingressController"><a href="#kong-ingressController" class="headerlink" title="kong ingressController"></a>kong ingressController</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ingressController: true</span><br></pre></td></tr></table></figure><h2 id="helméƒ¨ç½²å‘½ä»¤"><a href="#helméƒ¨ç½²å‘½ä»¤" class="headerlink" title="helméƒ¨ç½²å‘½ä»¤"></a>helméƒ¨ç½²å‘½ä»¤</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">è¿›å…¥kongçš„æ–‡ä»¶å¤¹</span><br><span class="line"></span><br><span class="line">[root@localhost kong]tree</span><br><span class="line">â”œâ”€â”€ kong-k8s</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ Chart.yaml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ FAQs.md</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ README.md</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ templates</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ admission-webhook.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ config-custom-server-blocks.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ config-dbless.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ controller-rbac-resources.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ controller-service-account.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ custom-resource-definitions.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ deployment.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ _helpers.tpl</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ingress-admin.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ingress-manager.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ingress-portal-api.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ingress-portal.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ingress-proxy.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ migrations-post-upgrade.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ migrations-pre-upgrade.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ migrations.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ NOTES.txt</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ pdb.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ psp.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ service-kong-admin.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ service-kong-manager.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ service-kong-portal-api.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ service-kong-portal.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ service-kong-proxy.yaml</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ servicemonitor.yaml</span><br><span class="line">â”‚Â Â  â””â”€â”€ values.yaml</span><br><span class="line"></span><br><span class="line"># ç¬¬ä¸€æ¬¡éƒ¨ç½²</span><br><span class="line">helm install -n kong .&#x2F;kong-k8s --values .&#x2F;kong-k8s&#x2F;values.yaml --namespace kong</span><br><span class="line"></span><br><span class="line">å¦‚æœä½ è¦å°†kongéƒ¨ç½²åˆ°ä¸€ä¸ªå•ç‹¬çš„å‘½åç©ºé—´ï¼Œè¯·æŒ‡å®šnamespace</span><br><span class="line">å¯é€‰å‚æ•° --namespace kong</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹yamlæ–‡ä»¶ï¼Œæˆ–è€…æ›´æ–°é•œåƒ</span><br><span class="line">helm upgrade kong .&#x2F;kong-k8s --values .&#x2F;kong-k8s&#x2F;values.yaml --namespace kong</span><br><span class="line"></span><br><span class="line">å¯é€‰å‚æ•° --namespace kong</span><br></pre></td></tr></table></figure><h1 id="kong-ui"><a href="#kong-ui" class="headerlink" title="kong-ui"></a>kong-ui</h1><h2 id="åˆå§‹åŒ–kong-uiçš„æ•°æ®åº“"><a href="#åˆå§‹åŒ–kong-uiçš„æ•°æ®åº“" class="headerlink" title="åˆå§‹åŒ–kong-uiçš„æ•°æ®åº“"></a>åˆå§‹åŒ–kong-uiçš„æ•°æ®åº“</h2><ul><li>ä½ éœ€è¦å‡†å¤‡ä¸€ä¸ªç”¨æˆ·ï¼Œå¯ä»¥å’Œkongçš„ä¸€æ ·ï¼Œè´¦å·å¯†ç ä¸ºkong/kong</li><li>è¿›å…¥postgresæ•°æ®åº“æ‰§è¡Œå»ºåº“è¯­å¥</li></ul><p>CREATE DATABASE â€œkongaâ€ WITH ENCODING=â€™UTF8â€™;</p><ul><li>åˆå§‹åŒ–åŒ–æ•°æ®åº“<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm pantsel&#x2F;konga:latest -c prepare -a &#123;&#123;adapter&#125;&#125; -u &#123;&#123;connection-uri&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">argumentdescriptiondefault</span><br><span class="line">-c        command-</span><br><span class="line">-a        adapter (can be postgres or mysql)-</span><br><span class="line">-u        full database connection url-</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚æˆ‘çš„ç¤ºä¾‹å‘½ä»¤ï¼š</span><br><span class="line"></span><br><span class="line">docker run --rm  --network&#x3D;kong-net  pantsel&#x2F;konga:latest -c prepare -a postgres -u postgresql:&#x2F;&#x2F;kong:kong@10.66.2.134:5432&#x2F;konga</span><br></pre></td></tr></table></figure></li></ul><h2 id="åˆ›å»ºkonga"><a href="#åˆ›å»ºkonga" class="headerlink" title="åˆ›å»ºkonga"></a>åˆ›å»ºkonga</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install -n konga-ui .&#x2F;konga-ui-k8s --values .&#x2F;konga-ui-k8s&#x2F;values.yaml --namespace kong</span><br></pre></td></tr></table></figure><h1 id="é—®é¢˜è®°å½•"><a href="#é—®é¢˜è®°å½•" class="headerlink" title="é—®é¢˜è®°å½•"></a>é—®é¢˜è®°å½•</h1><h2 id="ç›®å‰å·²çŸ¥å¯ä»¥PGSQLè¿ç§»çš„ç‰ˆæœ¬"><a href="#ç›®å‰å·²çŸ¥å¯ä»¥PGSQLè¿ç§»çš„ç‰ˆæœ¬" class="headerlink" title="ç›®å‰å·²çŸ¥å¯ä»¥PGSQLè¿ç§»çš„ç‰ˆæœ¬"></a>ç›®å‰å·²çŸ¥å¯ä»¥PGSQLè¿ç§»çš„ç‰ˆæœ¬</h2><p>PGSQLä¸º9.6 10 çš„è¿™2ä¸ªç‰ˆæœ¬å¯ä»¥æ‰§è¡Œ åˆå§‹åŒ–Kongè¿æ¥æ•°æ®åº“çš„é»˜è®¤ç»“æ„</p><p>PGSQL:12ç‰ˆæœ¬ç›®å‰ä¸æ”¯æŒï¼Œå…·ä½“åŸå› æœªçŸ¥</p><p>ç°è±¡å¦‚ä¸‹ï¼šä½ æ•°æ®åº“è¿ç§»å‘½ä»¤æˆåŠŸ</p><p>ä½†æ˜¯å®é™…ä¸Šè¡¨å´æ²¡æœ‰åˆ›å»º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">migrating rate-limiting on database &#39;kong&#39;...</span><br><span class="line">rate-limiting migrated up to: 000_base_rate_limiting (executed)</span><br><span class="line">rate-limiting migrated up to: 003_10_to_112 (executed)</span><br><span class="line">rate-limiting migrated up to: 004_200_to_210 (executed)</span><br><span class="line">migrating hmac-auth on database &#39;kong&#39;...</span><br><span class="line">hmac-auth migrated up to: 000_base_hmac_auth (executed)</span><br><span class="line">hmac-auth migrated up to: 002_130_to_140 (executed)</span><br><span class="line">hmac-auth migrated up to: 003_200_to_210 (executed)</span><br><span class="line">migrating oauth2 on database &#39;kong&#39;...</span><br><span class="line">oauth2 migrated up to: 000_base_oauth2 (executed)</span><br><span class="line">oauth2 migrated up to: 003_130_to_140 (executed)</span><br><span class="line">oauth2 migrated up to: 004_200_to_210 (executed)</span><br><span class="line">migrating ip-restriction on database &#39;kong&#39;...</span><br><span class="line">ip-restriction migrated up to: 001_200_to_210 (executed)</span><br><span class="line">migrating jwt on database &#39;kong&#39;...</span><br><span class="line">jwt migrated up to: 000_base_jwt (executed)</span><br><span class="line">jwt migrated up to: 002_130_to_140 (executed)</span><br><span class="line">jwt migrated up to: 003_200_to_210 (executed)</span><br><span class="line">migrating basic-auth on database &#39;kong&#39;...</span><br><span class="line">basic-auth migrated up to: 000_base_basic_auth (executed)</span><br><span class="line">basic-auth migrated up to: 002_130_to_140 (executed)</span><br><span class="line">basic-auth migrated up to: 003_200_to_210 (executed)</span><br><span class="line">migrating key-auth on database &#39;kong&#39;...</span><br><span class="line">key-auth migrated up to: 000_base_key_auth (executed)</span><br><span class="line">key-auth migrated up to: 002_130_to_140 (executed)</span><br><span class="line">key-auth migrated up to: 003_200_to_210 (executed)</span><br><span class="line">migrating session on database &#39;kong&#39;...</span><br><span class="line">session migrated up to: 000_base_session (executed)</span><br><span class="line">migrating acl on database &#39;kong&#39;...</span><br><span class="line">acl migrated up to: 000_base_acl (executed)</span><br><span class="line">acl migrated up to: 002_130_to_140 (executed)</span><br><span class="line">acl migrated up to: 003_200_to_210 (executed)</span><br><span class="line">migrating response-ratelimiting on database &#39;kong&#39;...</span><br><span class="line">response-ratelimiting migrated up to: 000_base_response_rate_limiting (executed)</span><br><span class="line">migrating bot-detection on database &#39;kong&#39;...</span><br><span class="line">bot-detection migrated up to: 001_200_to_210 (executed)</span><br><span class="line">migrating acme on database &#39;kong&#39;...</span><br><span class="line">acme migrated up to: 000_base_acme (executed)</span><br><span class="line">34 migrations processed</span><br><span class="line">34 executed</span><br><span class="line">Database is up-to-date</span><br></pre></td></tr></table></figure><h2 id="ç½‘ç»œé—®é¢˜"><a href="#ç½‘ç»œé—®é¢˜" class="headerlink" title="ç½‘ç»œé—®é¢˜"></a>ç½‘ç»œé—®é¢˜</h2><p>å¦‚æœåˆå§‹åŒ–çš„æ•°æ®åº“ä¸æ˜¯ä»¥å®¹å™¨æ–¹å¼è¿è¡Œï¼ˆä¾‹å¦‚è´­ä¹°rdsçš„PGSQLï¼‰</p><p>é‚£ä¹ˆä½ éœ€è¦æå‰åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·kong ç„¶åç›´æ¥æ‰§è¡Œdockeråˆå§‹åŒ–å‘½ä»¤ï¼Œå¹¶ä¸”å‚æ•°éœ€è¦å»æ‰</p><p> â€“network=  </p><p> å¹¶ä¸”ä¿®æ”¹KONG_PG_HOSTçš„å®é™…IP</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm \</span><br><span class="line">     -e &quot;KONG_DATABASE&#x3D;postgres&quot; \</span><br><span class="line">     -e &quot;KONG_PG_HOST&#x3D;æ•°æ®åº“çš„å®é™…ip&quot; \</span><br><span class="line">     -e &quot;KONG_PG_USER&#x3D;kong&quot; \</span><br><span class="line">     -e &quot;KONG_PG_PASSWORD&#x3D;kong&quot; \</span><br><span class="line">     -e &quot;KONG_CASSANDRA_CONTACT_POINTS&#x3D;kong-database&quot; \</span><br><span class="line">     kong:latest kong migrations bootstrap</span><br></pre></td></tr></table></figure><h2 id="PGSQLç™½åå•é—®é¢˜"><a href="#PGSQLç™½åå•é—®é¢˜" class="headerlink" title="PGSQLç™½åå•é—®é¢˜"></a>PGSQLç™½åå•é—®é¢˜</h2><p>éƒ¨ç½²kongçš„æ—¶å€™éœ€è¦åˆå§‹åŒ–ä¸€ä¸ªå®¹å™¨ waiting for db</p><p>æˆ‘ç”¨PGSQL10ç‰ˆæœ¬æŠ¥é”™å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Run with --v (verbose) or --vv (debug) for more details</span><br><span class="line">waiting for db</span><br><span class="line">Error: [PostgreSQL error] failed to retrieve PostgreSQL server_version_num: timeout</span><br></pre></td></tr></table></figure><p>è¿æ¥è¶…æ—¶ï¼Œç„¶åæˆ‘è¯•äº†ä¸‹ping pgsqlçš„ipæ˜¯å¯ä»¥çš„</p><p>çªç„¶çµæœºä¸€åŠ¨</p><p>RDSä¸€èˆ¬éƒ½è¦æ·»åŠ ç™½åå•çš„ï¼Œæˆ‘æ·»åŠ äº†è¯•ä¸‹ï¼ŒæˆåŠŸ</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://konghq.com/get-started/#install" target="_blank" rel="noopener">kong-install</a></p><p><a href="https://github.com/Kong/kong" target="_blank" rel="noopener">kong-github</a></p>]]></content>
      
      
      <categories>
          
          <category> SLB </category>
          
      </categories>
      
      
        <tags>
            
            <tag> API </tag>
            
            <tag> SLB </tag>
            
            <tag> è´Ÿè½½å‡è¡¡ </tag>
            
            <tag> Kong </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ŠSREï¼šGoogleè¿ç»´è§£å¯†ã€‹è¯»ä¹¦å¿ƒå¾—(äºŒ)â€”â€”Googleç”Ÿäº§ç¯å¢ƒï¼šSREè§†è§’</title>
      <link href="/2020/07/23/sre/google-sre-2/"/>
      <url>/2020/07/23/sre/google-sre-2/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¡¬ä»¶"><a href="#ç¡¬ä»¶" class="headerlink" title="ç¡¬ä»¶"></a>ç¡¬ä»¶</h1><ul><li>ç‰©ç†æœåŠ¡å™¨ï¼šä»£è¡¨å…·ä½“çš„ç¡¬ä»¶ï¼ˆæœ‰æ—¶å€™ä¹Ÿä»£è¡¨ä¸€ä¸ªVMè™šæ‹Ÿæœºï¼‰</li><li>è½¯ç”²ä½ æœåŠ¡å™¨ï¼šä»£è¡¨å¯¹å¤–æä¾›å“¦é‚£ä¸ªæœåŠ¡çš„è½¯ä»¶ç³»ç»Ÿ</li></ul><p>é€šå¸¸å¯¹äºä¸€ä¸ªè½¯ä»¶ä¸šåŠ¡æ¥è¯´ï¼Œè½¯ä»¶æœåŠ¡å™¨å’Œç‰©ç†æœåŠ¡å™¨æ˜¯ç´§å¯†ç›¸è¿ã€å¯†ä¸å¯åˆ†çš„ã€‚</p><p>ä½†æ˜¯Googleè®¤ä¸ºï¼šè½¯ä»¶ä¸åº”è¯¥ä¹Ÿä¸ä¼šä¸ç¡¬ä»¶æœ‰ç€å¼ºé€»è¾‘è”ç³»</p><h1 id="ç®¡ç†ç‰©ç†æœåŠ¡å™¨çš„ç³»ç»Ÿç®¡ç†è½¯ä»¶"><a href="#ç®¡ç†ç‰©ç†æœåŠ¡å™¨çš„ç³»ç»Ÿç®¡ç†è½¯ä»¶" class="headerlink" title="ç®¡ç†ç‰©ç†æœåŠ¡å™¨çš„ç³»ç»Ÿç®¡ç†è½¯ä»¶"></a>ç®¡ç†ç‰©ç†æœåŠ¡å™¨çš„ç³»ç»Ÿç®¡ç†è½¯ä»¶</h1><p>Borgï¼Œé‡‡ç”¨ä¸€å¥—åˆ†å¸ƒå¼é›†ç¾¤æ“ä½œç³»ç»Ÿç®¡ç†ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…ã€‚</p><p>å®ƒçš„ä¸‹ä¸€ä»£äº§å“ï¼šKubernetesï¼Œå¼€æºå®¹å™¨åŒ–é›†ç¾¤ç¼–æ’ç³»ç»Ÿã€‚</p><p>Borgå¯ä»¥åˆ›å»ºè‹¥å¹²ä¸ªä»»åŠ¡å®ä¾‹(å®¹å™¨)ï¼Œè¿™äº›ä»»åŠ¡å®ä¾‹å’Œç‰©ç†æœåŠ¡å™¨æ²¡æœ‰ä¸€å¯¹ä¸€çš„å›ºå®šå¯¹åº”å…³ç³»ã€‚</p><p>åœ¨Borgä¹‹ä¸Šï¼Œæœ‰ä¸€ä¸ªæŠ½è±¡å±‚ã€‚æ¯å½“Borgå¯åŠ¨ä¸€ä¸ªä»»åŠ¡å®ä¾‹çš„é€‚åˆï¼Œå®ƒä¼šç»™æ¯ä¸ªå…·ä½“çš„ä»»åŠ¡å®ä¾‹åˆ†é…ä¸€ä¸ªåå­—å’Œä¸€ä¸ªç¼–å·ï¼Œè¿™ä¸ªç³»ç»Ÿç§°ä¸ºBorgåç§°è§£æç³»ç»Ÿ(BNS)ã€‚å½“å…¶ä»–ä»»åŠ¡å®ä¾‹è¿æ¥åˆ°æŸä¸ªä»»åŠ¡å®ä¾‹æ—¶ï¼Œä½¿ç”¨BNSåç§°å»ºç«‹è¿æ¥ã€‚</p><p>ä¸€ä¸ªBNSåœ°å€å¯èƒ½æ˜¯è¿™æ ·ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š/bns/&lt;é›†ç¾¤å&gt;/&lt;ç”¨æˆ·å&gt;/&lt;ä»»åŠ¡å&gt;/&lt;å®ä¾‹å&gt;ï¼Œè¿™ä¸ªBNSåœ°å€æœ€ç»ˆå°†ä¼šè¢«è§£ææˆIPåœ°å€ï¼šç«¯å£ã€‚</p><p>Borgè¿˜è´Ÿè´£å°†å…·ä½“èµ„æºåˆ†é…ç»™æŸä¸ªä»»åŠ¡ã€‚å¯èƒ½æ˜¯CPUã€å†…å­˜ç­‰</p><h1 id="å­˜å‚¨"><a href="#å­˜å‚¨" class="headerlink" title="å­˜å‚¨"></a>å­˜å‚¨</h1><p>æ¯ä¸ªä»»åŠ¡å®ä¾‹å¯ä»¥åˆ©ç”¨é›†ç¾¤çº§åˆ«çš„å­˜å‚¨ç³»ç»Ÿå­˜å‚¨æ–‡ä»¶ã€‚</p><p>Googleçš„å­˜å‚¨ç³»ç»Ÿè´Ÿè´£å‘ç”¨æˆ·æä¾›ä¸€å¥—ç®€å•æ˜“ç”¨ã€å¯é çš„é›†ç¾¤å­˜å‚¨æœåŠ¡ã€‚</p><ul><li>æœ€åº•å±‚ç”±DæœåŠ¡æä¾›ï¼ŒDæ˜¯ä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨ï¼Œå‡ ä¹è¿è¡Œåœ¨æ•´ä¸ªé›†ç¾¤çš„æ‰€æœ‰ç‰©ç†æœåŠ¡å™¨ä¸Šã€‚</li><li>DæœåŠ¡ä¹‹ä¸Šè¢«ç§°ä¸ºColossusï¼ŒColossuså»ºç«‹äº†ä¸€ä¸ªè¦†ç›–æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…å«äº†ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œæ¥å£ï¼Œè¿˜æ”¯æŒå¤åˆ¶ä¸åŠ å¯†</li><li>åœ¨Colossusä¹‹ä¸Šï¼Œæ˜¯è°·æ­Œè‡ªä¸»ç ”å‘çš„å‡ ç§æ•°æ®åº“</li><li>Aï¼šBigtableæ˜¯ä¸€ä¸ªNosqlæ•°æ®åº“ï¼Œå®ƒå¯ä»¥å¤„ç†é«˜è¾¾PBçš„æ•°æ®ã€‚Bigtableæ˜¯ä¸€ä¸ªæ¾æ•£å­˜å‚¨çš„ã€åˆ†å¸ƒå¼çš„ã€æœ‰åºçš„ã€æŒä¹…åŒ–çš„å¤šç»´æ˜ å°„è¡¨ã€‚</li><li>B.Spanneræ˜¯å¯ä»¥æä¾›SQLæ¥å£æ»¡è¶³ä¸€è‡´æ€§è¦æ±‚çš„å…¨çƒæ•°æ®åº“</li><li>C.å…¶ä»–å‡ ç§æ•°æ®åº“ç³»ç»Ÿ</li></ul><h1 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h1><p>Googleçš„ç½‘ç»œç¡¬ä»¶è®¾å¤‡æ˜¯ç”±ä¸€ä¸ªåŸºäºOpenFlowåè®®çš„è½¯ä»¶å®šä¹‰ç½‘ç»œï¼ˆSDNï¼‰æ§åˆ¶çš„ã€‚</p><p>Googleæ²¡æœ‰ä½¿ç”¨é«˜çº§æ™ºèƒ½è·¯ç”±å™¨ï¼Œè€Œæ˜¯é‡‡ç”¨æ™®é€šçš„éæ™ºèƒ½äº¤æ¢ç»„ä»¶ç»“åˆé›†ä¸­åŒ–ï¼ˆæœ‰å¤‡ä»½çš„ï¼‰çš„æ§åˆ¶å™¨è¿æ¥æ–¹å¼ã€‚</p><p>è¯¥æ§åˆ¶å™¨è®¡ç®—ç½‘ç»œä¸­çš„æœ€ä½³è·¯å¾„ã€‚</p><p>è¿™ç§ç³»ç»Ÿå¯ä»¥å°†å¤æ‚çš„è·¯ç”±è®¡ç®—ä»å…·ä½“ç¡¬ä»¶ä¸Šåˆ†ç¦»å‡ºæ¥ï¼Œé™ä½æˆæœ¬ã€‚</p><p>å¸¦å®½æ§åˆ¶å™¨ï¼ˆBandwidth Enforcerï¼ŒBwEï¼‰è´Ÿè´£ç®¡ç†æ‰€æœ‰å¯ç”¨å¸¦å®½ã€‚åˆ©ç”¨ä¸­å¿ƒåŒ–çš„è·¯ç”±è®¡ç®—ï¼Œæœ‰è§£å†³ä»¥å‰åœ¨åˆ†å¸ƒå¼è·¯ç”±æ¨¡å¼ä¸‹éš¾ä»¥è§£å†³çš„æµé‡é—®é¢˜ã€‚</p><p>Googleçš„å…¨çƒè´Ÿè½½å‡è¡¡å™¨åœ¨ä¸‰ä¸ªå±‚é¢ä¸Šè´Ÿè´£å·¥ä½œï¼š</p><ul><li>åˆ©ç”¨åœ°ç†ä½ç½®ä¿¡æ¯è¿›è¡Œè´Ÿè½½å‡è¡¡çš„DNSè¯·æ±‚ï¼Œä¾‹å¦‚è§£æï¼ˆ<a href="http://www.google.com" target="_blank" rel="noopener">www.google.com</a>)</li><li>åœ¨ç”¨æˆ·æœåŠ¡å±‚é¢è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä¾‹å¦‚YouTubeå’ŒGoogle Maps</li><li>åœ¨è¿œç¨‹è°ƒç”¨ï¼ˆRPCï¼‰å±‚é¢è¿›è¡Œè´Ÿè½½å‡è¡¡</li></ul><h1 id="å…¶ä»–è½¯ä»¶ç³»ç»Ÿ"><a href="#å…¶ä»–è½¯ä»¶ç³»ç»Ÿ" class="headerlink" title="å…¶ä»–è½¯ä»¶ç³»ç»Ÿ"></a>å…¶ä»–è½¯ä»¶ç³»ç»Ÿ</h1><h2 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h2><p>Chubbyé›†ç¾¤é”æä¾›ä¸€ä¸ªAPIæ¥æ“ä½œé”ï¼Œå®ƒå¯ä»¥å¤„ç†å¼‚åœ°ã€è·¨æœºæˆ¿çº§åˆ«é”çš„è¯·æ±‚ã€‚</p><p>Chubbyä½¿ç”¨Paxosåè®®æ¥æä¾›åˆ†å¸ƒå¼ä¸€è‡´æ€§ã€‚</p><p>é€‚åˆæ”¾å¯¹ä¸€è‡´æ€§è¦æ±‚éå¸¸é«˜çš„æ•°æ®ã€‚ä¾‹å¦‚BNSæœåŠ¡å°±ä½¿ç”¨çš„Chubbyå­˜æ”¾è·¯å¾„ä¸IPåœ°å€ï¼šç«¯å£çš„å¯¹åº”å…³ç³»ã€‚</p><h2 id="ç›‘æ§ä¸æŠ¥è­¦ç³»ç»Ÿ"><a href="#ç›‘æ§ä¸æŠ¥è­¦ç³»ç»Ÿ" class="headerlink" title="ç›‘æ§ä¸æŠ¥è­¦ç³»ç»Ÿ"></a>ç›‘æ§ä¸æŠ¥è­¦ç³»ç»Ÿ</h2><ul><li>å¯¹çœŸå®é—®é¢˜æŠ¥è­¦</li><li>å¯¹æ¯”æ›´æ–°åº”ç”¨å‰åï¼Œæ–°ç‰ˆæœ¬æ˜¯å¦è®©è½¯ä»¶æœåŠ¡æ›´å¿«äº†</li><li>æ£€æŸ¥èµ„æºä½¿ç”¨é‡ï¼Œå¯¹åˆ¶å®šå‡é™é…è®¡åˆ’å¾ˆæœ‰æ•ˆ</li></ul><h2 id="åŸºç¡€è½¯ä»¶è®¾æ–½"><a href="#åŸºç¡€è½¯ä»¶è®¾æ–½" class="headerlink" title="åŸºç¡€è½¯ä»¶è®¾æ–½"></a>åŸºç¡€è½¯ä»¶è®¾æ–½</h2><p>æ‰€æœ‰çš„GoogleæœåŠ¡ç”¨RPCé€šä¿¡ï¼Œç§°ä¸ºStubbyã€‚ç›®å‰å…¬å¸ƒäº†ä¸€ä¸ªå¼€æºå®ç°ï¼šgRPCã€‚</p><p>Protocol Bufferæ˜¯Google RPCçš„ä¼ è¾“æ ¼å¼ï¼Œç›¸æ¯”XMLæœ‰å¾ˆå¤šä¼˜åŠ¿ï¼Œç®€å•æ˜“ç”¨ï¼Œæ•°æ®å¤§å°æ¯”XMLå°3-10å€ï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–å¿«100å€ï¼Œå¹¶ä¸”åè®®æ˜ç¡®ã€‚</p><h2 id="ç ”å‘ç¯å¢ƒ"><a href="#ç ”å‘ç¯å¢ƒ" class="headerlink" title="ç ”å‘ç¯å¢ƒ"></a>ç ”å‘ç¯å¢ƒ</h2><p>è§„åˆ™ï¼šæ›´æ–°å³éœ€å®¡æ ¸ï¼Œå³ä½¿è¿™ä¸ªæ›´æ–°æ˜¯è‡ªå·±çš„ä»£ç ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å–è‡ªã€ŠSREï¼šGoogleè¿ç»´è§£å¯†ã€‹å‰10-20é¡µï¼Œæ€»ç»“å½’çº³çš„å¿ƒå¾—ã€‚</p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Sre </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Sre </tag>
            
            <tag> Google </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿ç»´æ‰‹å†Œâ€”â€”Kuberneteså®¹å™¨æ—¶åŒºä¸åŒæ­¥</title>
      <link href="/2020/07/22/bug/dockerfile-time-zone/"/>
      <url>/2020/07/22/bug/dockerfile-time-zone/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>Kuberneteså®¹å™¨æ—¶é—´ä¸åŒæ­¥,æœ€è¿‘å¼€å‘ååº”è¯´å®¹å™¨é‡Œçš„æ—¶é—´ä¸å¯¹ï¼Œå·®äº†8ä¸ªå°æ—¶ï¼Œæˆ‘å¯»æ€ä¸æ˜¯åº”è¯¥æ—¶åŒºä¸å¯¹å—ï¼Œå¼€å§‹äº†æ’é”™ä¹‹æ—…</p><h1 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker exec -it test date</span><br><span class="line">Tue Jul 21 09:32:03 Asia 2020</span><br><span class="line">[root@localhost ~]# date</span><br><span class="line">Tue Jul 21 17:32:05 CST 2020</span><br></pre></td></tr></table></figure><h1 id="ä»å®¹å™¨çš„å¯åŠ¨å‘½ä»¤æŸ¥èµ·"><a href="#ä»å®¹å™¨çš„å¯åŠ¨å‘½ä»¤æŸ¥èµ·" class="headerlink" title="ä»å®¹å™¨çš„å¯åŠ¨å‘½ä»¤æŸ¥èµ·"></a>ä»å®¹å™¨çš„å¯åŠ¨å‘½ä»¤æŸ¥èµ·</h1><p>æˆ‘æŸ¥çœ‹è¿™ä¸ªé¡¹ç›®deployment.yamlæ–‡ä»¶,åªå±•ç¤ºå®¹å™¨éƒ¨åˆ†é…ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">containers:</span><br><span class="line">      - args:</span><br><span class="line">        - -jar</span><br><span class="line">        - -Xms4096m</span><br><span class="line">        - -Xmx4096m</span><br><span class="line">        - -Xmn256m</span><br><span class="line">        - -Xss256k</span><br><span class="line">        - -Duser.timezone&#x3D;GMT+08</span><br><span class="line">        - -XX:+DisableExplicitGC</span><br><span class="line">        - -XX:+UseConcMarkSweepGC</span><br><span class="line">        - -XX:+UseParNewGC</span><br><span class="line">        - -XX:+CMSParallelRemarkEnabled</span><br><span class="line">        - -XX:+CMSClassUnloadingEnabled</span><br><span class="line">        - -XX:LargePageSizeInBytes&#x3D;128m</span><br><span class="line">        - -XX:+UseFastAccessorMethods</span><br><span class="line">        - -XX:+UseCMSInitiatingOccupancyOnly</span><br><span class="line">        - -XX:CMSInitiatingOccupancyFraction&#x3D;80</span><br><span class="line">        - -XX:SoftRefLRUPolicyMSPerMB&#x3D;0</span><br><span class="line">        - -XX:+PrintClassHistogram</span><br><span class="line">        - -Dfile.encoding&#x3D;UTF8</span><br><span class="line">        - -Dsun.jnu.encoding&#x3D;UTF8</span><br><span class="line">        - app.jar</span><br><span class="line">        - --spring.profiles.active&#x3D;dev</span><br><span class="line">        command:</span><br><span class="line">        - java</span><br><span class="line">        env:</span><br><span class="line">        - name: PATH</span><br><span class="line">          value: &#x2F;usr&#x2F;local&#x2F;maven&#x2F;bin:&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin</span><br><span class="line">        image: xxxx</span><br><span class="line">        imagePullPolicy: Always</span><br><span class="line">        name: cjbbasecore</span><br><span class="line">        resources: &#123;&#125;</span><br><span class="line">        securityContext:</span><br><span class="line">          privileged: false</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: &#x2F;etc&#x2F;localtime</span><br><span class="line">          name: time</span><br><span class="line">          readOnly: true</span><br><span class="line">        workingDir: &#x2F;</span><br><span class="line">      dnsPolicy: ClusterFirst</span><br><span class="line">      restartPolicy: Always</span><br><span class="line">      securityContext: &#123;&#125;</span><br><span class="line">      serviceAccountName: &quot;&quot;</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br><span class="line">      volumes:</span><br><span class="line">      - hostPath:</span><br><span class="line">          path: &#x2F;etc&#x2F;localtime</span><br><span class="line">        name: time</span><br><span class="line">status: &#123;&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘å‘ç°å†™è¿™ä¸ªyamlæ–‡ä»¶çš„åŒäº‹å·²ç»è€ƒè™‘åˆ°äº†æ—¶é—´åŒæ­¥çš„é—®é¢˜ï¼Œå·²ç»æŠŠæœ¬æœºLocattimeæŒ‚è½½è¿›å»äº†ï¼Œéš¾é“æœ‰å…¶ä»–é—®é¢˜ï¼Ÿ        </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    volumeMounts:</span><br><span class="line">    - mountPath: &#x2F;etc&#x2F;localtime</span><br><span class="line">      name: time</span><br><span class="line">      readOnly: true</span><br><span class="line">volumes:</span><br><span class="line">    - hostPath:</span><br><span class="line">      path: &#x2F;etc&#x2F;localtime</span><br><span class="line">    name: time</span><br></pre></td></tr></table></figure><h1 id="æŸ¥Dockerfile"><a href="#æŸ¥Dockerfile" class="headerlink" title="æŸ¥Dockerfile"></a>æŸ¥Dockerfile</h1><p>æˆ‘ä»¬å®¹å™¨çš„åŸºç¡€é•œåƒçš„æ˜¯Ubuntu:18.04ï¼Œ</p><p>æˆ‘æ‰¾åˆ°äº†JDKé•œåƒä¸­çš„åº•å±‚é•œåƒï¼Œæˆ‘å‘ç°äº†ç¯å¢ƒå˜é‡ä¸­çš„TZ=â€Asia/Shanghaiâ€è®¾ç½®çš„æ²¡æœ‰é—®é¢˜ï¼Œè¯•ä¸€ä¸‹å¯åŠ¨è¿™ä¸ªåŸºç¡€é•œåƒå§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">############################################</span><br><span class="line"># desc : å½“å‰ç‰ˆæœ¬å®‰è£…çš„sshï¼Œwgetï¼Œcurlï¼Œsupervisor </span><br><span class="line">############################################</span><br><span class="line"># è®¾ç½®ç»§æ‰¿è‡ªubuntuå®˜æ–¹é•œåƒ18</span><br><span class="line">FROM ubuntu:bionic </span><br><span class="line"></span><br><span class="line">ENV LANG&#x3D;C.UTF-8 \</span><br><span class="line">    TZ&#x3D;&quot;Asia&#x2F;Shanghai&quot; \</span><br><span class="line">    TINI_VERSION&#x3D;&quot;v0.19.0&quot;</span><br><span class="line"></span><br><span class="line"># Add mirror source</span><br><span class="line">RUN cp &#x2F;etc&#x2F;apt&#x2F;sources.list &#x2F;etc&#x2F;apt&#x2F;sources.list.bak &amp;&amp; \</span><br><span class="line">    sed -i &#39;s http:&#x2F;&#x2F;.*.ubuntu.com http:&#x2F;&#x2F;mirrors.aliyun.com g&#39; &#x2F;etc&#x2F;apt&#x2F;sources.list</span><br><span class="line"></span><br><span class="line"># Fix base image</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends \</span><br><span class="line">libidn2-0 \</span><br><span class="line">ca-certificates \</span><br><span class="line">tar \</span><br><span class="line">gzip \</span><br><span class="line">unzip \</span><br><span class="line">locales \</span><br><span class="line">wget \</span><br><span class="line">        curl \</span><br><span class="line">        vim \</span><br><span class="line">gnupg \</span><br><span class="line">&amp;&amp; rm -rf &#x2F;var&#x2F;lib&#x2F;apt&#x2F;lists&#x2F;*</span><br><span class="line"></span><br><span class="line"># grab gosu for easy step-down from root</span><br><span class="line">ENV GOSU_VERSION 1.7</span><br><span class="line">RUN set -x \</span><br><span class="line">&amp;&amp; wget -O &#x2F;usr&#x2F;local&#x2F;bin&#x2F;gosu &quot;https:&#x2F;&#x2F;gh.api.99988866.xyz&#x2F;https:&#x2F;&#x2F;github.com&#x2F;tianon&#x2F;gosu&#x2F;releases&#x2F;download&#x2F;$GOSU_VERSION&#x2F;gosu-$(dpkg --print-architecture)&quot; \</span><br><span class="line">&amp;&amp; wget -O &#x2F;usr&#x2F;local&#x2F;bin&#x2F;gosu.asc &quot;https:&#x2F;&#x2F;gh.api.99988866.xyz&#x2F;https:&#x2F;&#x2F;github.com&#x2F;tianon&#x2F;gosu&#x2F;releases&#x2F;download&#x2F;$GOSU_VERSION&#x2F;gosu-$(dpkg --print-architecture).asc&quot; \</span><br><span class="line">&amp;&amp; export GNUPGHOME&#x3D;&quot;$(mktemp -d)&quot; \</span><br><span class="line">&amp;&amp; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \</span><br><span class="line">&amp;&amp; gpg --batch --verify &#x2F;usr&#x2F;local&#x2F;bin&#x2F;gosu.asc &#x2F;usr&#x2F;local&#x2F;bin&#x2F;gosu \</span><br><span class="line">&amp;&amp; rm -r &quot;$GNUPGHOME&quot; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;gosu.asc \</span><br><span class="line">&amp;&amp; chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;gosu \</span><br><span class="line">&amp;&amp; gosu nobody true</span><br><span class="line"></span><br><span class="line">## å®‰è£…tini</span><br><span class="line">RUN set -x \</span><br><span class="line">  &amp;&amp; wget -O &#x2F;usr&#x2F;local&#x2F;bin&#x2F;tini \</span><br><span class="line">         &quot;https:&#x2F;&#x2F;gh.api.99988866.xyz&#x2F;https:&#x2F;&#x2F;github.com&#x2F;krallin&#x2F;tini&#x2F;releases&#x2F;download&#x2F;$&#123;TINI_VERSION&#125;&#x2F;tini-static-amd64&quot; &amp;&amp; \</span><br><span class="line">      wget -O &#x2F;usr&#x2F;local&#x2F;bin&#x2F;tini.asc \</span><br><span class="line">         &quot;https:&#x2F;&#x2F;gh.api.99988866.xyz&#x2F;https:&#x2F;&#x2F;github.com&#x2F;krallin&#x2F;tini&#x2F;releases&#x2F;download&#x2F;$&#123;TINI_VERSION&#125;&#x2F;tini-static-amd64.asc&quot; &amp;&amp; \</span><br><span class="line">    gpg --batch --keyserver hkp:&#x2F;&#x2F;p80.pool.sks-keyservers.net:80 \</span><br><span class="line">          --recv-keys 595E85A6B1B4779EA4DAAEC70B588DFF0527A9B7 &amp;&amp; \</span><br><span class="line">      gpg --batch --verify &#x2F;usr&#x2F;local&#x2F;bin&#x2F;tini.asc &#x2F;usr&#x2F;local&#x2F;bin&#x2F;tini &amp;&amp; \</span><br><span class="line">      rm -r &#x2F;usr&#x2F;local&#x2F;bin&#x2F;tini.asc &amp;&amp; \</span><br><span class="line">      chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;tini &amp;&amp; \</span><br><span class="line">      tini --version</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;tini&quot;, &quot;--&quot;]</span><br></pre></td></tr></table></figure><h1 id="å¯åŠ¨è¿™ä¸ªåŸºç¡€é•œåƒ"><a href="#å¯åŠ¨è¿™ä¸ªåŸºç¡€é•œåƒ" class="headerlink" title="å¯åŠ¨è¿™ä¸ªåŸºç¡€é•œåƒ"></a>å¯åŠ¨è¿™ä¸ªåŸºç¡€é•œåƒ</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -itd xxx.com&#x2F;javabase:0.1.0 </span><br><span class="line">[root@localhost ~]# docker exec -it llible_jones date</span><br><span class="line">Tue Jul 21 09:32:03 Asia 2020</span><br><span class="line">[root@localhost ~]# date</span><br><span class="line">Tue Jul 21 17:32:05 CST 2020</span><br></pre></td></tr></table></figure><p>å‘ç°è¿˜æ˜¯ä¸è¡Œï¼Œç„¶åé€‰æ‹©ç½‘ä¸Šå»ºè®®çš„å‡ ç§ä¿®æ”¹æ—¶åŒºçš„æ–¹æ³•</p><h2 id="tzselectå‘½ä»¤æ‰§è¡Œ"><a href="#tzselectå‘½ä»¤æ‰§è¡Œ" class="headerlink" title="tzselectå‘½ä»¤æ‰§è¡Œ"></a>tzselectå‘½ä»¤æ‰§è¡Œ</h2><p>æ‰§è¡Œtzselectå‘½ä»¤ â€“&gt; é€‰æ‹©Asia â€“&gt; é€‰æ‹©China â€“&gt; é€‰æ‹©east China - Beijing, Guangdong, Shanghai, etcâ€“&gt;ç„¶åè¾“å…¥1ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@12aa3e0a3573:&#x2F;# tzselect</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;tzselect: line 180: &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;iso3166.tab: No such file or directory</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;tzselect: time zone files are not set up correctly</span><br></pre></td></tr></table></figure><p>ç»“æœç›´æ¥å‘ç°æ‰¾ä¸åˆ°è¿™ä¸ªä¾èµ–</p><h2 id="ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥ä¿®æ”¹æ—¶åŒº"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥ä¿®æ”¹æ—¶åŒº" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥ä¿®æ”¹æ—¶åŒº"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥ä¿®æ”¹æ—¶åŒº</h2><p>å¤åˆ¶ä¸»æœºçš„localtime</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai 12aa3e0a3573:&#x2F;etc&#x2F;localtime</span><br></pre></td></tr></table></figure><p>ç»“æœè¿˜æ˜¯ä¸è¡Œ</p><h2 id="æœ€ç»ˆæ–¹æ³•"><a href="#æœ€ç»ˆæ–¹æ³•" class="headerlink" title="æœ€ç»ˆæ–¹æ³•"></a>æœ€ç»ˆæ–¹æ³•</h2><p>ç»è¿‡æœç´¢å„ç§æ–‡ä»¶ä¿®æ”¹æ—¶åŒºçš„æ–¹æ³•åï¼Œåªæœ‰ä¸€ç§æˆ‘è¯•è¿‡æ˜¯æˆåŠŸçš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install -y tzdata</span><br><span class="line">echo &quot;Asia&#x2F;Shanghai&quot; &gt; &#x2F;etc&#x2F;timezone</span><br><span class="line">rm -f &#x2F;etc&#x2F;localtime</span><br><span class="line">dpkg-reconfigure -f noninteractive tzdata</span><br></pre></td></tr></table></figure><h1 id="é‡æ–°åˆ¶ä½œé•œåƒ"><a href="#é‡æ–°åˆ¶ä½œé•œåƒ" class="headerlink" title="é‡æ–°åˆ¶ä½œé•œåƒ"></a>é‡æ–°åˆ¶ä½œé•œåƒ</h1><p>å†å¼€å¯å¦å¤–æœ‰ä¸€ä¸ªçª—å£,æäº¤è¿™ä¸ªå®¹å™¨çš„å½“å‰çŠ¶æ€ä¸ºä¸€ä¸ªæ–°çš„ç‰ˆæœ¬é•œåƒï¼Œæ¨é€è¿™ä¸ªé•œåƒåˆ°é•œåƒä»“åº“é‡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker commit test xxx.com&#x2F;javabase:0.1.1</span><br><span class="line">docker pull xxx.com&#x2F;javabase:0.1.1</span><br></pre></td></tr></table></figure><p>æœ€åå†æ›´æ”¹åŸjdk Dockerfileé‡Œçš„from xxx.com/javabase:0.1.1</p><p>é‡æ–°æ‰“åŒ…æ„å»ºé¡¹ç›®å³å¯æ¢å¤æ­£å¸¸çš„æ—¶åŒº</p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Operation Manual </tag>
            
            <tag> Dockerfile </tag>
            
            <tag> Timezone </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥æµ…å‡ºDockeråŸç†åŠå®æˆ˜(å…­)â€”â€”é‡æ–°è®¤è¯†Dockerå®¹å™¨</title>
      <link href="/2020/07/19/docker/docker-idea-6/"/>
      <url>/2020/07/19/docker/docker-idea-6/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><p>æ·±å…¥æµ…å‡ºDockeråŸç†åŠå®æˆ˜ç³»åˆ—ç¬¬å…­ç¯‡ï¼Œæˆ‘ä¸»è¦è®²ä¸€ä¸‹Dockerå®¹å™¨çš„æœ¬è´¨ã€‚</p><p>ä»è¿›ç¨‹è¯´èµ·ã€‚</p><h1 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h1><p>å‡å¦‚ï¼Œç°åœ¨ä½ è¦å†™ä¸€ä¸ªè®¡ç®—åŠ æ³•çš„å°ç¨‹åºï¼Œè¿™ä¸ªç¨‹åºéœ€è¦çš„è¾“å…¥æ¥è‡ªäºä¸€ä¸ªæ–‡ä»¶ï¼Œè®¡ç®—å®Œæˆåçš„ç»“æœåˆ™è¾“å‡ºåˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p><p>ç”±äºè®¡ç®—æœºåªè®¤è¯† 0 å’Œ 1ï¼Œæ‰€ä»¥æ— è®ºç”¨å“ªç§è¯­è¨€ç¼–å†™è¿™æ®µä»£ç ï¼Œæœ€åéƒ½éœ€è¦é€šè¿‡æŸç§æ–¹å¼ç¿»è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ‰èƒ½åœ¨è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸­è¿è¡Œèµ·æ¥ã€‚</p><p>è€Œä¸ºäº†èƒ½å¤Ÿè®©è¿™äº›ä»£ç æ­£å¸¸è¿è¡Œï¼Œæˆ‘ä»¬å¾€å¾€è¿˜è¦ç»™å®ƒæä¾›æ•°æ®ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™ä¸ªåŠ æ³•ç¨‹åºæ‰€éœ€è¦çš„è¾“å…¥æ–‡ä»¶ã€‚è¿™äº›æ•°æ®åŠ ä¸Šä»£ç æœ¬èº«çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ”¾åœ¨ç£ç›˜ä¸Šï¼Œå°±æ˜¯æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„ä¸€ä¸ªâ€œç¨‹åºâ€ï¼Œä¹Ÿå«ä»£ç çš„å¯æ‰§è¡Œé•œåƒï¼ˆexecutable imageï¼‰ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è®¡ç®—æœºä¸Šè¿è¡Œè¿™ä¸ªâ€œç¨‹åºâ€äº†ã€‚</p><p>é¦–å…ˆï¼Œæ“ä½œç³»ç»Ÿä»â€œç¨‹åºâ€ä¸­å‘ç°è¾“å…¥æ•°æ®ä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥è¿™äº›æ•°æ®å°±ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­å¾…å‘½ã€‚åŒæ—¶ï¼Œæ“ä½œç³»ç»Ÿåˆè¯»å–åˆ°äº†è®¡ç®—åŠ æ³•çš„æŒ‡ä»¤ï¼Œè¿™æ—¶ï¼Œå®ƒå°±éœ€è¦æŒ‡ç¤º CPU å®ŒæˆåŠ æ³•æ“ä½œã€‚è€Œ CPU ä¸å†…å­˜åä½œè¿›è¡ŒåŠ æ³•è®¡ç®—ï¼Œåˆä¼šä½¿ç”¨å¯„å­˜å™¨å­˜æ”¾æ•°å€¼ã€å†…å­˜å †æ ˆä¿å­˜æ‰§è¡Œçš„å‘½ä»¤å’Œå˜é‡ã€‚åŒæ—¶ï¼Œè®¡ç®—æœºé‡Œè¿˜æœ‰è¢«æ‰“å¼€çš„æ–‡ä»¶ï¼Œä»¥åŠå„ç§å„æ ·çš„ I/O è®¾å¤‡åœ¨ä¸æ–­åœ°è°ƒç”¨ä¸­ä¿®æ”¹è‡ªå·±çš„çŠ¶æ€ã€‚</p><p>å°±è¿™æ ·ï¼Œä¸€æ—¦â€œç¨‹åºâ€è¢«æ‰§è¡Œèµ·æ¥ï¼Œå®ƒå°±ä»ç£ç›˜ä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå˜æˆäº†è®¡ç®—æœºå†…å­˜ä¸­çš„æ•°æ®ã€å¯„å­˜å™¨é‡Œçš„å€¼ã€å †æ ˆä¸­çš„æŒ‡ä»¤ã€è¢«æ‰“å¼€çš„æ–‡ä»¶ï¼Œä»¥åŠå„ç§è®¾å¤‡çš„çŠ¶æ€ä¿¡æ¯çš„ä¸€ä¸ªé›†åˆã€‚åƒè¿™æ ·ä¸€ä¸ªç¨‹åºè¿è¡Œèµ·æ¥åçš„è®¡ç®—æœºæ‰§è¡Œç¯å¢ƒçš„æ€»å’Œï¼Œå°±æ˜¯æˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’ï¼šè¿›ç¨‹ã€‚</p><p>æ‰€ä»¥ï¼Œå¯¹äºè¿›ç¨‹æ¥è¯´ï¼Œå®ƒçš„é™æ€è¡¨ç°å°±æ˜¯ç¨‹åºï¼Œå¹³å¸¸éƒ½å®‰å®‰é™é™åœ°å¾…åœ¨ç£ç›˜ä¸Šï¼›è€Œä¸€æ—¦è¿è¡Œèµ·æ¥ï¼Œå®ƒå°±å˜æˆäº†è®¡ç®—æœºé‡Œçš„æ•°æ®å’ŒçŠ¶æ€çš„æ€»å’Œï¼Œè¿™å°±æ˜¯å®ƒçš„åŠ¨æ€è¡¨ç°ã€‚</p><p>è€Œå®¹å™¨æŠ€æœ¯çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå°±æ˜¯é€šè¿‡çº¦æŸå’Œä¿®æ”¹è¿›ç¨‹çš„åŠ¨æ€è¡¨ç°ï¼Œä»è€Œä¸ºå…¶åˆ›é€ å‡ºä¸€ä¸ªâ€œè¾¹ç•Œâ€ã€‚</p><h1 id="Dockerçš„åº•å±‚åŸç†"><a href="#Dockerçš„åº•å±‚åŸç†" class="headerlink" title="Dockerçš„åº•å±‚åŸç†"></a>Dockerçš„åº•å±‚åŸç†</h1><p>æˆ‘ä»¬åœ¨å‰é¢è®²è¿‡Dockerçš„åº•å±‚åŸç†å…¶å®å°±æ˜¯å‡ ä¸ªæ¦‚å¿µ</p><ul><li>NameSpace å‘½åç©ºé—´</li><li>Cgroups æ§åˆ¶ç»„</li><li>Union file systems è”åˆæ–‡ä»¶ç³»ç»Ÿ</li><li>Container format å®¹å™¨æ ¼å¼ã€‚</li></ul><p>å¯¹äº Docker ç­‰å¤§å¤šæ•° Linux å®¹å™¨æ¥è¯´ï¼ŒCgroups æŠ€æœ¯æ˜¯ç”¨æ¥åˆ¶é€ çº¦æŸçš„ä¸»è¦æ‰‹æ®µï¼Œè€Œ Namespace æŠ€æœ¯åˆ™æ˜¯ç”¨æ¥ä¿®æ”¹è¿›ç¨‹è§†å›¾çš„ä¸»è¦æ–¹æ³•ï¼ŒUnion file systems æŠ€æœ¯å­˜æ”¾äº†é¡¹ç›®(ä»£ç )å¯åŠ¨çš„æ‰€æœ‰ç¯å¢ƒä¾èµ–ã€‚</p><h2 id="NameSpace"><a href="#NameSpace" class="headerlink" title="NameSpace"></a>NameSpace</h2><p>Linux namespaces æ˜¯å¯¹å…¨å±€ç³»ç»Ÿèµ„æºçš„ä¸€ç§å°è£…éš”ç¦»ï¼Œä½¿å¾—å¤„äºä¸åŒ namespace çš„è¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„å…¨å±€ç³»ç»Ÿèµ„æºï¼Œæ”¹å˜ä¸€ä¸ª namespace ä¸­çš„ç³»ç»Ÿèµ„æºåªä¼šå½±å“å½“å‰ namespace é‡Œçš„è¿›ç¨‹ï¼Œå¯¹å…¶ä»– namespace ä¸­çš„è¿›ç¨‹æ²¡æœ‰å½±å“ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªå®¹å™¨æ¥è¯•è¯•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it busybox &#x2F;bin&#x2F;sh&#x2F;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤æ˜¯ Docker é¡¹ç›®æœ€é‡è¦çš„ä¸€ä¸ªæ“ä½œï¼Œå³å¤§åé¼é¼çš„ docker runã€‚</p><p>è€Œ -it å‚æ•°å‘Šè¯‰äº† Docker é¡¹ç›®åœ¨å¯åŠ¨å®¹å™¨åï¼Œéœ€è¦ç»™æˆ‘ä»¬åˆ†é…ä¸€ä¸ªæ–‡æœ¬è¾“å…¥ / è¾“å‡ºç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯ TTYï¼Œè·Ÿå®¹å™¨çš„æ ‡å‡†è¾“å…¥ç›¸å…³è”ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å’Œè¿™ä¸ª Docker å®¹å™¨è¿›è¡Œäº¤äº’äº†ã€‚</p><p>è€Œ /bin/sh å°±æ˜¯æˆ‘ä»¬è¦åœ¨ Docker å®¹å™¨é‡Œè¿è¡Œçš„ç¨‹åºã€‚</p><p>æ‰€ä»¥ï¼Œä¸Šé¢è¿™æ¡æŒ‡ä»¤ç¿»è¯‘æˆäººç±»çš„è¯­è¨€å°±æ˜¯ï¼šè¯·å¸®æˆ‘å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œåœ¨å®¹å™¨é‡Œæ‰§è¡Œ /bin/shï¼Œå¹¶ä¸”ç»™æˆ‘åˆ†é…ä¸€ä¸ªå‘½ä»¤è¡Œç»ˆç«¯è·Ÿè¿™ä¸ªå®¹å™¨äº¤äº’ã€‚</p><h3 id="å®¹å™¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹"><a href="#å®¹å™¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹" class="headerlink" title="å®¹å™¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹"></a>å®¹å™¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹</h3><p>æˆ‘ä»¬åœ¨è®²Dockerfileåˆ¶ä½œçš„æ—¶å€™æåˆ°è¿‡ï¼Œä¸€ä¸ªDockerfileåªèƒ½ä¸€ä¸ªCMDæŒ‡ä»¤ã€‚å¦‚æœå‡ºç°å¤šä¸ªCMD åˆ™åªæœ‰æœ€åä¸€ä¸ªCMDæ‰ä¼šç”Ÿæ•ˆã€‚å› ä¸ºå®¹å™¨å¯åŠ¨çš„æ—¶å€™ç¬¬ä¸€æ¡å‘½ä»¤å°±æ˜¯å®¹å™¨å†…éƒ¨çš„ç¬¬ä¸€å·è¿›ç¨‹ã€‚</p><p>æ¥ç€ä¸Šæ–‡ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å®¹å™¨é‡Œæ‰§è¡Œä¸€ä¸‹ ps æŒ‡ä»¤ï¼Œå°±ä¼šå‘ç°ä¸€äº›æ›´æœ‰è¶£çš„äº‹æƒ…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F; # ps</span><br><span class="line">PID USER TIME COMMAND </span><br><span class="line">1 root 0:00 &#x2F;bin&#x2F;sh </span><br><span class="line">10 root 0:00 ps</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨ Docker é‡Œæœ€å¼€å§‹æ‰§è¡Œçš„ /bin/shï¼Œå°±æ˜¯è¿™ä¸ªå®¹å™¨å†…éƒ¨çš„ç¬¬ 1 å·è¿›ç¨‹ï¼ˆPID=1ï¼‰ï¼Œè€Œè¿™ä¸ªå®¹å™¨é‡Œä¸€å…±åªæœ‰ä¸¤ä¸ªè¿›ç¨‹åœ¨è¿è¡Œã€‚è¿™å°±æ„å‘³ç€ï¼Œå‰é¢æ‰§è¡Œçš„ /bin/shï¼Œä»¥åŠæˆ‘ä»¬åˆšåˆšæ‰§è¡Œçš„ psï¼Œå·²ç»è¢« Docker éš”ç¦»åœ¨äº†ä¸€ä¸ªè·Ÿå®¿ä¸»æœºå®Œå…¨ä¸åŒçš„ä¸–ç•Œå½“ä¸­ã€‚</p><h3 id="NameSpaceçš„éšœçœ¼æ³•"><a href="#NameSpaceçš„éšœçœ¼æ³•" class="headerlink" title="NameSpaceçš„éšœçœ¼æ³•"></a>NameSpaceçš„éšœçœ¼æ³•</h3><p>æœ¬æ¥ï¼Œæ¯å½“æˆ‘ä»¬åœ¨å®¿ä¸»æœºä¸Šè¿è¡Œäº†ä¸€ä¸ª /bin/sh ç¨‹åºï¼Œæ“ä½œç³»ç»Ÿéƒ½ä¼šç»™å®ƒåˆ†é…ä¸€ä¸ªè¿›ç¨‹ç¼–å·ï¼Œæ¯”å¦‚ PID=100ã€‚è¿™ä¸ªç¼–å·æ˜¯è¿›ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œå°±åƒå‘˜å·¥çš„å·¥ç‰Œä¸€æ ·ã€‚</p><p>æ‰€ä»¥ PID=100ï¼Œå¯ä»¥ç²—ç•¥åœ°ç†è§£ä¸ºè¿™ä¸ª /bin/sh æ˜¯æˆ‘ä»¬å…¬å¸é‡Œçš„ç¬¬ 100 å·å‘˜å·¥ï¼Œè€Œç¬¬ 1 å·å‘˜å·¥å°±è‡ªç„¶æ˜¯æ¯”å°” Â· ç›–èŒ¨è¿™æ ·ç»Ÿé¢†å…¨å±€çš„äººç‰©ã€‚</p><p>è€Œç°åœ¨ï¼Œæˆ‘ä»¬è¦é€šè¿‡ Docker æŠŠè¿™ä¸ª /bin/sh ç¨‹åºè¿è¡Œåœ¨ä¸€ä¸ªå®¹å™¨å½“ä¸­ã€‚è¿™æ—¶å€™ï¼ŒDocker å°±ä¼šåœ¨è¿™ä¸ªç¬¬ 100 å·å‘˜å·¥å…¥èŒæ—¶ç»™ä»–æ–½ä¸€ä¸ªâ€œéšœçœ¼æ³•â€ï¼Œè®©ä»–æ°¸è¿œçœ‹ä¸åˆ°å‰é¢çš„å…¶ä»– 99 ä¸ªå‘˜å·¥ï¼Œæ›´çœ‹ä¸åˆ°æ¯”å°” Â· ç›–èŒ¨ã€‚è¿™æ ·ï¼Œä»–å°±ä¼šé”™è¯¯åœ°ä»¥ä¸ºè‡ªå·±å°±æ˜¯å…¬å¸é‡Œçš„ç¬¬ 1 å·å‘˜å·¥ã€‚</p><p>è¿™ç§æœºåˆ¶ï¼Œå…¶å®å°±æ˜¯å¯¹è¢«éš”ç¦»åº”ç”¨çš„è¿›ç¨‹ç©ºé—´åšäº†æ‰‹è„šï¼Œä½¿å¾—è¿™äº›è¿›ç¨‹åªèƒ½çœ‹åˆ°é‡æ–°è®¡ç®—è¿‡çš„è¿›ç¨‹ç¼–å·ï¼Œæ¯”å¦‚ PID=1ã€‚å¯å®é™…ä¸Šï¼Œä»–ä»¬åœ¨å®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿé‡Œï¼Œè¿˜æ˜¯åŸæ¥çš„ç¬¬ 100 å·è¿›ç¨‹ã€‚</p><p>è¿™ç§æŠ€æœ¯ï¼Œå°±æ˜¯ Linux é‡Œé¢çš„ Namespace æœºåˆ¶ã€‚è€Œ Namespace çš„ä½¿ç”¨æ–¹å¼ä¹Ÿéå¸¸æœ‰æ„æ€ï¼šå®ƒå…¶å®åªæ˜¯ Linux åˆ›å»ºæ–°è¿›ç¨‹çš„ä¸€ä¸ªå¯é€‰å‚æ•°ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ Linux ç³»ç»Ÿä¸­åˆ›å»ºçº¿ç¨‹çš„ç³»ç»Ÿè°ƒç”¨æ˜¯ clone()ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int pid &#x3D; clone(main_function, stack_size, SIGCHLD, NULL);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç³»ç»Ÿè°ƒç”¨å°±ä¼šä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œå¹¶ä¸”è¿”å›å®ƒçš„è¿›ç¨‹å· pidã€‚</p><p>è€Œå½“æˆ‘ä»¬ç”¨ clone() ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹æ—¶ï¼Œå°±å¯ä»¥åœ¨å‚æ•°ä¸­æŒ‡å®š CLONE_NEWPID å‚æ•°ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int pid &#x3D; clone(main_function, stack_size, CLONE_NEWPID | SIGCHLD, NULL);</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œæ–°åˆ›å»ºçš„è¿™ä¸ªè¿›ç¨‹å°†ä¼šâ€œçœ‹åˆ°â€ä¸€ä¸ªå…¨æ–°çš„è¿›ç¨‹ç©ºé—´ï¼Œåœ¨è¿™ä¸ªè¿›ç¨‹ç©ºé—´é‡Œï¼Œå®ƒçš„ PID æ˜¯ 1ã€‚ä¹‹æ‰€ä»¥è¯´â€œçœ‹åˆ°â€ï¼Œæ˜¯å› ä¸ºè¿™åªæ˜¯ä¸€ä¸ªâ€œéšœçœ¼æ³•â€ï¼Œåœ¨å®¿ä¸»æœºçœŸå®çš„è¿›ç¨‹ç©ºé—´é‡Œï¼Œè¿™ä¸ªè¿›ç¨‹çš„ PID è¿˜æ˜¯çœŸå®çš„æ•°å€¼ï¼Œæ¯”å¦‚ 100ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¤šæ¬¡æ‰§è¡Œä¸Šé¢çš„ clone() è°ƒç”¨ï¼Œè¿™æ ·å°±ä¼šåˆ›å»ºå¤šä¸ª PID Namespaceï¼Œè€Œæ¯ä¸ª Namespace é‡Œçš„åº”ç”¨è¿›ç¨‹ï¼Œéƒ½ä¼šè®¤ä¸ºè‡ªå·±æ˜¯å½“å‰å®¹å™¨é‡Œçš„ç¬¬ 1 å·è¿›ç¨‹ï¼Œå®ƒä»¬æ—¢çœ‹ä¸åˆ°å®¿ä¸»æœºé‡ŒçœŸæ­£çš„è¿›ç¨‹ç©ºé—´ï¼Œä¹Ÿçœ‹ä¸åˆ°å…¶ä»– PID Namespace é‡Œçš„å…·ä½“æƒ…å†µã€‚</p><h3 id="NameSpaceå°ç»“"><a href="#NameSpaceå°ç»“" class="headerlink" title="NameSpaceå°ç»“"></a>NameSpaceå°ç»“</h3><p>è€Œé™¤äº†æˆ‘ä»¬åˆšåˆšç”¨åˆ°çš„ PID Namespaceï¼ŒLinux æ“ä½œç³»ç»Ÿè¿˜æä¾›äº† Mountã€UTSã€IPCã€Network å’Œ User è¿™äº› Namespaceï¼Œç”¨æ¥å¯¹å„ç§ä¸åŒçš„è¿›ç¨‹ä¸Šä¸‹æ–‡è¿›è¡Œâ€œéšœçœ¼æ³•â€æ“ä½œã€‚</p><p>è¿™ï¼Œå°±æ˜¯ Linux å®¹å™¨æœ€åŸºæœ¬çš„å®ç°åŸç†äº†ã€‚æ‰€ä»¥ï¼ŒDocker å®¹å™¨è¿™ä¸ªå¬èµ·æ¥ç„è€Œåˆç„çš„æ¦‚å¿µï¼Œå®é™…ä¸Šæ˜¯åœ¨åˆ›å»ºå®¹å™¨è¿›ç¨‹æ—¶ï¼ŒæŒ‡å®šäº†è¿™ä¸ªè¿›ç¨‹æ‰€éœ€è¦å¯ç”¨çš„ä¸€ç»„ Namespace å‚æ•°ã€‚è¿™æ ·ï¼Œå®¹å™¨å°±åªèƒ½â€œçœ‹â€åˆ°å½“å‰ Namespace æ‰€é™å®šçš„èµ„æºã€æ–‡ä»¶ã€è®¾å¤‡ã€çŠ¶æ€ï¼Œæˆ–è€…é…ç½®ã€‚è€Œå¯¹äºå®¿ä¸»æœºä»¥åŠå…¶ä»–ä¸ç›¸å…³çš„ç¨‹åºï¼Œå®ƒå°±å®Œå…¨çœ‹ä¸åˆ°äº†ã€‚</p><p>åœ¨ç†è§£äº† Namespace çš„å·¥ä½œæ–¹å¼ä¹‹åï¼Œä½ å°±ä¼šæ˜ç™½ï¼Œè·ŸçœŸå®å­˜åœ¨çš„è™šæ‹Ÿæœºä¸åŒï¼Œåœ¨ä½¿ç”¨ Docker çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªçœŸæ­£çš„â€œDocker å®¹å™¨â€è¿è¡Œåœ¨å®¿ä¸»æœºé‡Œé¢ã€‚Docker é¡¹ç›®å¸®åŠ©ç”¨æˆ·å¯åŠ¨çš„ï¼Œè¿˜æ˜¯åŸæ¥çš„åº”ç”¨è¿›ç¨‹ï¼Œåªä¸è¿‡åœ¨åˆ›å»ºè¿™äº›è¿›ç¨‹æ—¶ï¼ŒDocker ä¸ºå®ƒä»¬åŠ ä¸Šäº†å„ç§å„æ ·çš„ Namespace å‚æ•°ã€‚è¿™æ—¶ï¼Œè¿™äº›è¿›ç¨‹å°±ä¼šè§‰å¾—è‡ªå·±æ˜¯å„è‡ª PID Namespace é‡Œçš„ç¬¬ 1 å·è¿›ç¨‹ï¼Œåªèƒ½çœ‹åˆ°å„è‡ª Mount Namespace é‡ŒæŒ‚è½½çš„ç›®å½•å’Œæ–‡ä»¶ï¼Œåªèƒ½è®¿é—®åˆ°å„è‡ª Network Namespace é‡Œçš„ç½‘ç»œè®¾å¤‡ï¼Œå°±ä»¿ä½›è¿è¡Œåœ¨ä¸€ä¸ªä¸ªâ€œå®¹å™¨â€é‡Œé¢ï¼Œä¸ä¸–éš”ç»ã€‚</p><h2 id="Cgroups"><a href="#Cgroups" class="headerlink" title="Cgroups"></a>Cgroups</h2><p>Linux Cgroups çš„å…¨ç§°æ˜¯ Linux Control Groupã€‚å®ƒæœ€ä¸»è¦çš„ä½œç”¨ï¼Œå°±æ˜¯é™åˆ¶ä¸€ä¸ªè¿›ç¨‹ç»„èƒ½å¤Ÿä½¿ç”¨çš„èµ„æºä¸Šé™ï¼ŒåŒ…æ‹¬ CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œå¸¦å®½ç­‰ç­‰ã€‚</p><p>æ­¤å¤–ï¼ŒCgroups è¿˜èƒ½å¤Ÿå¯¹è¿›ç¨‹è¿›è¡Œä¼˜å…ˆçº§è®¾ç½®ã€å®¡è®¡ï¼Œä»¥åŠå°†è¿›ç¨‹æŒ‚èµ·å’Œæ¢å¤ç­‰æ“ä½œã€‚</p><h3 id="æ“ä½œCgroups"><a href="#æ“ä½œCgroups" class="headerlink" title="æ“ä½œCgroups"></a>æ“ä½œCgroups</h3><p>åœ¨ Linux ä¸­ï¼ŒCgroups ç»™ç”¨æˆ·æš´éœ²å‡ºæ¥çš„æ“ä½œæ¥å£æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œå³å®ƒä»¥æ–‡ä»¶å’Œç›®å½•çš„æ–¹å¼ç»„ç»‡åœ¨æ“ä½œç³»ç»Ÿçš„ /sys/fs/cgroup è·¯å¾„ä¸‹ã€‚</p><p>æŒ‡ä»¤æŠŠå®ƒä»¬å±•ç¤ºå‡ºæ¥ï¼Œè¿™æ¡å‘½ä»¤æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-28-16 ~]# mount -t cgroup</span><br><span class="line">cgroup on &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,release_agent&#x3D;&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;systemd-cgroups-agent,name&#x3D;systemd)</span><br><span class="line">cgroup on &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;hugetlb type cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb)</span><br><span class="line">cgroup on &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;devices type cgroup (rw,nosuid,nodev,noexec,relatime,devices)</span><br><span class="line">cgroup on &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;cpu,cpuacct type cgroup (rw,nosuid,nodev,noexec,relatime,cpuacct,cpu)</span><br><span class="line">cgroup on &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;pids type cgroup (rw,nosuid,nodev,noexec,relatime,pids)</span><br><span class="line">cgroup on &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;perf_event type cgroup (rw,nosuid,nodev,noexec,relatime,perf_event)</span><br><span class="line">cgroup on &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,net_prio,net_cls)</span><br><span class="line">cgroup on &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;blkio type cgroup (rw,nosuid,nodev,noexec,relatime,blkio)</span><br><span class="line">cgroup on &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;cpuset type cgroup (rw,nosuid,nodev,noexec,relatime,cpuset)</span><br><span class="line">cgroup on &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;memory type cgroup (rw,nosuid,nodev,noexec,relatime,memory)</span><br><span class="line">cgroup on &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;freezer type cgroup (rw,nosuid,nodev,noexec,relatime,freezer)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ /sys/fs/cgroup ä¸‹é¢æœ‰å¾ˆå¤šè¯¸å¦‚ cpusetã€cpuã€ memory è¿™æ ·çš„å­ç›®å½•ï¼Œä¹Ÿå«å­ç³»ç»Ÿã€‚</p><p>è¿™äº›éƒ½æ˜¯æˆ‘è¿™å°æœºå™¨å½“å‰å¯ä»¥è¢« Cgroups è¿›è¡Œé™åˆ¶çš„èµ„æºç§ç±»ã€‚è€Œåœ¨å­ç³»ç»Ÿå¯¹åº”çš„èµ„æºç§ç±»ä¸‹ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°è¯¥ç±»èµ„æºå…·ä½“å¯ä»¥è¢«é™åˆ¶çš„æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œå¯¹ CPU å­ç³»ç»Ÿæ¥è¯´ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å‡ ä¸ªé…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæŒ‡ä»¤æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-28-16 ~]# ls &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;cpu</span><br><span class="line">cgroup.clone_children  cpuacct.usage         cpu.rt_runtime_us  kubepods.slice     user.slice</span><br><span class="line">cgroup.event_control   cpuacct.usage_percpu  cpu.shares         notify_on_release</span><br><span class="line">cgroup.procs           cpu.cfs_period_us     cpu.stat           release_agent</span><br><span class="line">cgroup.sane_behavior   cpu.cfs_quota_us      docker             system.slice</span><br><span class="line">cpuacct.stat           cpu.rt_period_us      kubepods           tasks</span><br></pre></td></tr></table></figure><p>å¦‚æœç†Ÿæ‚‰ Linux CPU ç®¡ç†çš„è¯ï¼Œä½ å°±ä¼šåœ¨å®ƒçš„è¾“å‡ºé‡Œæ³¨æ„åˆ° cfs_period å’Œ cfs_quota è¿™æ ·çš„å…³é”®è¯ã€‚è¿™ä¸¤ä¸ªå‚æ•°éœ€è¦ç»„åˆä½¿ç”¨ï¼Œå¯ä»¥ç”¨æ¥é™åˆ¶è¿›ç¨‹åœ¨é•¿åº¦ä¸º cfs_period çš„ä¸€æ®µæ—¶é—´å†…ï¼Œåªèƒ½è¢«åˆ†é…åˆ°æ€»é‡ä¸º cfs_quota çš„ CPU æ—¶é—´ã€‚</p><p>è€Œè¿™æ ·çš„é…ç½®æ–‡ä»¶åˆå¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿ</p><p>ä½ éœ€è¦åœ¨å¯¹åº”çš„å­ç³»ç»Ÿä¸‹é¢åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬ç°åœ¨è¿›å…¥ /sys/fs/cgroup/cpu ç›®å½•ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-28-16 cpu]# mkdir test</span><br><span class="line">[root@VM-28-16 cpu]# cd test&#x2F;</span><br><span class="line">[root@VM-28-16 test]# ll</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 18 17:31 cgroup.clone_children</span><br><span class="line">--w--w--w- 1 root root 0 Jul 18 17:31 cgroup.event_control</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 18 17:31 cgroup.procs</span><br><span class="line">-r--r--r-- 1 root root 0 Jul 18 17:31 cpuacct.stat</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 18 17:31 cpuacct.usage</span><br><span class="line">-r--r--r-- 1 root root 0 Jul 18 17:31 cpuacct.usage_percpu</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 18 17:31 cpu.cfs_period_us</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 18 17:31 cpu.cfs_quota_us</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 18 17:31 cpu.rt_period_us</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 18 17:31 cpu.rt_runtime_us</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 18 17:31 cpu.shares</span><br><span class="line">-r--r--r-- 1 root root 0 Jul 18 17:31 cpu.stat</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 18 17:31 notify_on_release</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 18 17:31 tasks</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç›®å½•å°±ç§°ä¸ºä¸€ä¸ªâ€œæ§åˆ¶ç»„â€ã€‚ä½ ä¼šå‘ç°ï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨ä½ æ–°åˆ›å»ºçš„ test ç›®å½•ä¸‹ï¼Œè‡ªåŠ¨ç”Ÿæˆè¯¥å­ç³»ç»Ÿå¯¹åº”çš„èµ„æºé™åˆ¶æ–‡ä»¶ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨åå°æ‰§è¡Œè¿™æ ·ä¸€æ¡è„šæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-28-16 test]# while : ; do : ; done &amp;</span><br><span class="line">[1] 32705</span><br><span class="line">[root@VM-28-16 test]# top</span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                    </span><br><span class="line">32705 root      20   0  116496   1632    140 R 100.0  0.0   3:58.89 bash</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°CPUçš„æ‰“æ»¡äº†ï¼ˆ%Cpu0 :100.0 usï¼‰</p><p>è€Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹ test ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œçœ‹åˆ° container æ§åˆ¶ç»„é‡Œçš„ CPU quota è¿˜æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼ˆå³ï¼š-1ï¼‰ï¼ŒCPU period åˆ™æ˜¯é»˜è®¤çš„ 100 msï¼ˆ100000 usï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-28-16 test]# cat cpu.cfs_quota_us </span><br><span class="line">-1</span><br><span class="line">[root@VM-28-16 test]# cat cpu.cfs_period_us </span><br><span class="line">100000</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™äº›æ–‡ä»¶çš„å†…å®¹æ¥è®¾ç½®é™åˆ¶ã€‚æ¯”å¦‚ï¼Œå‘ test ç»„é‡Œçš„ cfs_quota æ–‡ä»¶å†™å…¥ 20 msï¼ˆ20000 usï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-28-16 test]# echo 20000 &gt; &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;cpu&#x2F;test&#x2F;cpu.cfs_quota_us</span><br></pre></td></tr></table></figure><p>ç»“åˆå‰é¢çš„ä»‹ç»ï¼Œä½ åº”è¯¥èƒ½æ˜ç™½è¿™ä¸ªæ“ä½œçš„å«ä¹‰ï¼Œå®ƒæ„å‘³ç€åœ¨æ¯ 100 ms çš„æ—¶é—´é‡Œï¼Œè¢«è¯¥æ§åˆ¶ç»„é™åˆ¶çš„è¿›ç¨‹åªèƒ½ä½¿ç”¨ 20 ms çš„ CPU æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¿›ç¨‹åªèƒ½ä½¿ç”¨åˆ° 20% çš„ CPU å¸¦å®½ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠè¢«é™åˆ¶çš„è¿›ç¨‹çš„ PID å†™å…¥ test ç»„é‡Œçš„ tasks æ–‡ä»¶ï¼Œä¸Šé¢çš„è®¾ç½®å°±ä¼šå¯¹è¯¥è¿›ç¨‹ç”Ÿæ•ˆäº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-28-16 test]# echo 32705 &gt; &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;cpu&#x2F;test&#x2F;tasks</span><br><span class="line"></span><br><span class="line">[root@VM-28-16 test]# top</span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                    </span><br><span class="line">32705 root      20   0  116496   1632    140 R  20.1  0.0   8:01.77 bash</span><br></pre></td></tr></table></figure><p>è®¡ç®—æœºçš„ CPU ä½¿ç”¨ç‡ç«‹åˆ»é™åˆ°äº† 20%ï¼ˆ%Cpu0 : 20.8 usï¼‰ã€‚</p><h3 id="Cgroupsçš„è®¾è®¡"><a href="#Cgroupsçš„è®¾è®¡" class="headerlink" title="Cgroupsçš„è®¾è®¡"></a>Cgroupsçš„è®¾è®¡</h3><p>é™¤ CPU å­ç³»ç»Ÿå¤–ï¼ŒCgroups çš„æ¯ä¸€ä¸ªå­ç³»ç»Ÿéƒ½æœ‰å…¶ç‹¬æœ‰çš„èµ„æºé™åˆ¶èƒ½åŠ›ï¼Œæ¯”å¦‚ï¼š</p><ul><li>blkioï¼Œä¸ºå—è®¾å¤‡è®¾å®šI/O é™åˆ¶ï¼Œä¸€èˆ¬ç”¨äºç£ç›˜ç­‰è®¾å¤‡</li><li>cpusetï¼Œä¸ºè¿›ç¨‹åˆ†é…å•ç‹¬çš„ CPU æ ¸å’Œå¯¹åº”çš„å†…å­˜èŠ‚ç‚¹</li><li>memoryï¼Œä¸ºè¿›ç¨‹è®¾å®šå†…å­˜ä½¿ç”¨çš„é™åˆ¶ã€‚</li></ul><p>Linux Cgroups çš„è®¾è®¡è¿˜æ˜¯æ¯”è¾ƒæ˜“ç”¨çš„ï¼Œç®€å•ç²—æš´åœ°ç†è§£å‘¢ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå­ç³»ç»Ÿç›®å½•åŠ ä¸Šä¸€ç»„èµ„æºé™åˆ¶æ–‡ä»¶çš„ç»„åˆã€‚è€Œå¯¹äº Docker ç­‰ Linux å®¹å™¨é¡¹ç›®æ¥è¯´ï¼Œå®ƒä»¬åªéœ€è¦åœ¨æ¯ä¸ªå­ç³»ç»Ÿä¸‹é¢ï¼Œä¸ºæ¯ä¸ªå®¹å™¨åˆ›å»ºä¸€ä¸ªæ§åˆ¶ç»„ï¼ˆå³åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼‰ï¼Œç„¶ååœ¨å¯åŠ¨å®¹å™¨è¿›ç¨‹ä¹‹åï¼ŒæŠŠè¿™ä¸ªè¿›ç¨‹çš„ PID å¡«å†™åˆ°å¯¹åº”æ§åˆ¶ç»„çš„ tasks æ–‡ä»¶ä¸­å°±å¯ä»¥äº†ã€‚</p><p>è€Œè‡³äºåœ¨è¿™äº›æ§åˆ¶ç»„ä¸‹é¢çš„èµ„æºæ–‡ä»¶é‡Œå¡«ä¸Šä»€ä¹ˆå€¼ï¼Œå°±é ç”¨æˆ·æ‰§è¡Œ docker run æ—¶çš„å‚æ•°æŒ‡å®šäº†ï¼Œæ¯”å¦‚è¿™æ ·ä¸€æ¡å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --cpu-period&#x3D;100000 --cpu-quota&#x3D;20000 ubuntu &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>åœ¨å¯åŠ¨è¿™ä¸ªå®¹å™¨åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹ Cgroups æ–‡ä»¶ç³»ç»Ÿä¸‹ï¼ŒCPU å­ç³»ç»Ÿä¸­ï¼Œâ€œdockerâ€è¿™ä¸ªæ§åˆ¶ç»„é‡Œçš„èµ„æºé™åˆ¶æ–‡ä»¶çš„å†…å®¹æ¥ç¡®è®¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;cpu&#x2F;docker&#x2F;5d5c9f67d&#x2F;cpu.cfs_period_us </span><br><span class="line">100000</span><br><span class="line">$ cat &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;cpu&#x2F;docker&#x2F;5d5c9f67d&#x2F;cpu.cfs_quota_us </span><br><span class="line">20000</span><br></pre></td></tr></table></figure><p>è¿™å°±æ„å‘³ç€è¿™ä¸ª Docker å®¹å™¨ï¼Œåªèƒ½ä½¿ç”¨åˆ° 20% çš„ CPU å¸¦å®½ã€‚</p><h3 id="Cgroupså°ç»“"><a href="#Cgroupså°ç»“" class="headerlink" title="Cgroupså°ç»“"></a>Cgroupså°ç»“</h3><p>ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ Docker å®¹å™¨ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå¯ç”¨äº†å¤šä¸ª Linux Namespace çš„åº”ç”¨è¿›ç¨‹ï¼Œè€Œè¿™ä¸ªè¿›ç¨‹èƒ½å¤Ÿä½¿ç”¨çš„èµ„æºé‡ï¼Œåˆ™å— Cgroups é…ç½®çš„é™åˆ¶ã€‚</p><h2 id="Union-File-System"><a href="#Union-File-System" class="headerlink" title="Union File System"></a>Union File System</h2><p>ä½œä¸ºä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼Œæˆ‘ä»¬å¸Œæœ›ï¼šæ¯å½“åˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨æ—¶ï¼Œå®¹å™¨é‡Œçš„åº”ç”¨è¿›ç¨‹ï¼Œç†åº”çœ‹åˆ°ä¸€ä»½å®Œå…¨ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿã€‚è¿™æ ·ï¼Œå®ƒå°±å¯ä»¥åœ¨è‡ªå·±çš„å®¹å™¨ç›®å½•ï¼ˆæ¯”å¦‚ /tmpï¼‰ä¸‹è¿›è¡Œæ“ä½œï¼Œè€Œå®Œå…¨ä¸ä¼šå—å®¿ä¸»æœºä»¥åŠå…¶ä»–å®¹å™¨çš„å½±å“ã€‚æ€ä¹ˆæ‰èƒ½åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿ</p><p>ä¸Šæ–‡æåˆ°äº†Namespaceé‡Œå­˜åœ¨ä¸€ç§Mount Namespace</p><p>å®ƒçš„å­˜åœ¨ä½¿æˆ‘ä»¬å¯ä»¥åœ¨å®¹å™¨è¿›ç¨‹å¯åŠ¨ä¹‹å‰é‡æ–°æŒ‚è½½å®ƒçš„æ•´ä¸ªæ ¹ç›®å½•â€œ/â€ã€‚<br>è¿™ä¸ªæŒ‚è½½å¯¹å®¿ä¸»æœºä¸å¯è§ï¼Œæ‰€ä»¥å®¹å™¨è¿›ç¨‹å°±å¯ä»¥åœ¨é‡Œé¢éšä¾¿æŠ˜è…¾äº†ã€‚</p><h3 id="chroot"><a href="#chroot" class="headerlink" title="chroot"></a>chroot</h3><p>åœ¨ Linux æ“ä½œç³»ç»Ÿé‡Œï¼Œæœ‰ä¸€ä¸ªåä¸º chroot çš„å‘½ä»¤å¯ä»¥å¸®åŠ©ä½ åœ¨ shell ä¸­æ–¹ä¾¿åœ°å®Œæˆè¿™ä¸ªå·¥ä½œã€‚é¡¾åæ€ä¹‰ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å¸®ä½ â€œchange root file systemâ€ï¼Œå³æ”¹å˜è¿›ç¨‹çš„æ ¹ç›®å½•åˆ°ä½ æŒ‡å®šçš„ä½ç½®ã€‚å®ƒçš„ç”¨æ³•ä¹Ÿéå¸¸ç®€å•ã€‚</p><p>å‡è®¾ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ª $HOME/test ç›®å½•ï¼Œæƒ³è¦æŠŠå®ƒä½œä¸ºä¸€ä¸ª /bin/bash è¿›ç¨‹çš„æ ¹ç›®å½•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª test ç›®å½•å’Œå‡ ä¸ª lib æ–‡ä»¶å¤¹ï¼š</span><br><span class="line"></span><br><span class="line">mkdir -p $HOME&#x2F;test</span><br><span class="line">mkdir -p $HOME&#x2F;test&#x2F;&#123;bin,lib64,lib&#125;</span><br><span class="line"></span><br><span class="line">ç„¶åï¼ŒæŠŠ bash å‘½ä»¤æ‹·è´åˆ° test ç›®å½•å¯¹åº”çš„ bin è·¯å¾„ä¸‹</span><br><span class="line"></span><br><span class="line">cp -v &#x2F;bin&#x2F;&#123;bash,ls&#125; $HOME&#x2F;test&#x2F;bin</span><br><span class="line"></span><br><span class="line">æ¥ä¸‹æ¥ï¼ŒæŠŠ bash å‘½ä»¤éœ€è¦çš„æ‰€æœ‰ so æ–‡ä»¶ï¼Œä¹Ÿæ‹·è´åˆ° test ç›®å½•å¯¹åº”çš„ lib è·¯å¾„ä¸‹ã€‚æ‰¾åˆ° so æ–‡ä»¶å¯ä»¥ç”¨ ldd å‘½ä»¤ï¼š</span><br><span class="line"></span><br><span class="line">T&#x3D;$HOME&#x2F;test</span><br><span class="line">list&#x3D;&quot;$(ldd &#x2F;bin&#x2F;ls | egrep -o &#39;&#x2F;lib.*\.[0-9]&#39;)&quot;</span><br><span class="line">for i in $list; do cp -v &quot;$i&quot; &quot;$&#123;T&#125;$&#123;i&#125;&quot;; done</span><br><span class="line"></span><br><span class="line">æœ€åï¼Œæ‰§è¡Œ chroot å‘½ä»¤ï¼Œå‘Šè¯‰æ“ä½œç³»ç»Ÿï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ $HOME&#x2F;test ç›®å½•ä½œä¸º &#x2F;bin&#x2F;bash è¿›ç¨‹çš„æ ¹ç›®å½•ï¼š</span><br><span class="line"></span><br><span class="line">chroot $HOME&#x2F;test &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œä½ å¦‚æœæ‰§è¡Œ â€œls /â€œï¼Œå°±ä¼šçœ‹åˆ°ï¼Œå®ƒè¿”å›çš„éƒ½æ˜¯ $HOME/test ç›®å½•ä¸‹é¢çš„å†…å®¹ï¼Œè€Œä¸æ˜¯å®¿ä¸»æœºçš„å†…å®¹ã€‚</p><p>æ›´é‡è¦çš„æ˜¯ï¼Œå¯¹äºè¢« chroot çš„è¿›ç¨‹æ¥è¯´ï¼Œå®ƒå¹¶ä¸ä¼šæ„Ÿå—åˆ°è‡ªå·±çš„æ ¹ç›®å½•å·²ç»è¢«â€œä¿®æ”¹â€æˆ $HOME/test äº†ã€‚</p><h3 id="rootfs"><a href="#rootfs" class="headerlink" title="rootfs"></a>rootfs</h3><p>å®é™…ä¸Šï¼ŒMount Namespace æ­£æ˜¯åŸºäºå¯¹ chroot çš„ä¸æ–­æ”¹è‰¯æ‰è¢«å‘æ˜å‡ºæ¥çš„ï¼Œå®ƒä¹Ÿæ˜¯ Linux æ“ä½œç³»ç»Ÿé‡Œçš„ç¬¬ä¸€ä¸ª Namespaceã€‚</p><p>è€Œè¿™ä¸ªæŒ‚è½½åœ¨å®¹å™¨æ ¹ç›®å½•ä¸Šã€ç”¨æ¥ä¸ºå®¹å™¨è¿›ç¨‹æä¾›éš”ç¦»åæ‰§è¡Œç¯å¢ƒçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå°±æ˜¯æ‰€è°“çš„â€œå®¹å™¨é•œåƒâ€ã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªæ›´ä¸ºä¸“ä¸šçš„åå­—ï¼Œå«ä½œï¼šrootfsï¼ˆæ ¹æ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚</p><p>æ‰€ä»¥ï¼Œä¸€ä¸ªæœ€å¸¸è§çš„ rootfsï¼Œæˆ–è€…è¯´å®¹å™¨é•œåƒï¼Œä¼šåŒ…æ‹¬å¦‚ä¸‹æ‰€ç¤ºçš„ä¸€äº›ç›®å½•å’Œæ–‡ä»¶ï¼Œæ¯”å¦‚ /binï¼Œ/etcï¼Œ/proc ç­‰ç­‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls &#x2F;</span><br><span class="line">bin dev etc home lib lib64 mnt opt proc root run sbin sys tmp usr var</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä½ åº”è¯¥å¯ä»¥ç†è§£ï¼Œå¯¹ Docker é¡¹ç›®æ¥è¯´ï¼Œå®ƒæœ€æ ¸å¿ƒçš„åŸç†å®é™…ä¸Šå°±æ˜¯ä¸ºå¾…åˆ›å»ºçš„ç”¨æˆ·è¿›ç¨‹ï¼š</p><ul><li>å¯ç”¨ Linux Namespace é…ç½®ï¼›</li><li>è®¾ç½®æŒ‡å®šçš„ Cgroups å‚æ•°</li><li>åˆ‡æ¢è¿›ç¨‹çš„æ ¹ç›®å½•ï¼ˆChange Rootï¼‰ã€‚</li></ul><p>å¦å¤–ï¼Œéœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œrootfs åªæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿæ‰€åŒ…å«çš„æ–‡ä»¶ã€é…ç½®å’Œç›®å½•ï¼Œå¹¶ä¸åŒ…æ‹¬æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚</p><p>åœ¨ Linux æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿™ä¸¤éƒ¨åˆ†æ˜¯åˆ†å¼€å­˜æ”¾çš„ï¼Œæ“ä½œç³»ç»Ÿåªæœ‰åœ¨å¼€æœºå¯åŠ¨æ—¶æ‰ä¼šåŠ è½½æŒ‡å®šç‰ˆæœ¬çš„å†…æ ¸é•œåƒã€‚</p><h3 id="å®¹å™¨çš„ä¸€è‡´æ€§"><a href="#å®¹å™¨çš„ä¸€è‡´æ€§" class="headerlink" title="å®¹å™¨çš„ä¸€è‡´æ€§"></a>å®¹å™¨çš„ä¸€è‡´æ€§</h3><p>æ­£æ˜¯ç”±äº rootfs çš„å­˜åœ¨ï¼Œå®¹å™¨æ‰æœ‰äº†ä¸€ä¸ªè¢«åå¤å®£ä¼ è‡³ä»Šçš„é‡è¦ç‰¹æ€§ï¼šä¸€è‡´æ€§ã€‚</p><p>ä»€ä¹ˆæ˜¯å®¹å™¨çš„â€œä¸€è‡´æ€§â€å‘¢ï¼Ÿ</p><p>ç”±äº rootfs é‡Œæ‰“åŒ…çš„ä¸åªæ˜¯åº”ç”¨ï¼Œè€Œæ˜¯æ•´ä¸ªæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶å’Œç›®å½•ï¼Œä¹Ÿå°±æ„å‘³ç€ï¼Œåº”ç”¨ä»¥åŠå®ƒè¿è¡Œæ‰€éœ€è¦çš„æ‰€æœ‰ä¾èµ–ï¼Œéƒ½è¢«å°è£…åœ¨äº†ä¸€èµ·ã€‚</p><p>æœ‰äº†å®¹å™¨é•œåƒâ€œæ‰“åŒ…æ“ä½œç³»ç»Ÿâ€çš„èƒ½åŠ›ï¼Œè¿™ä¸ªæœ€åŸºç¡€çš„ä¾èµ–ç¯å¢ƒä¹Ÿç»ˆäºå˜æˆäº†åº”ç”¨æ²™ç›’çš„ä¸€éƒ¨åˆ†ã€‚è¿™å°±èµ‹äºˆäº†å®¹å™¨æ‰€è°“çš„ä¸€è‡´æ€§ï¼šæ— è®ºåœ¨æœ¬åœ°ã€äº‘ç«¯ï¼Œè¿˜æ˜¯åœ¨ä¸€å°ä»»ä½•åœ°æ–¹çš„æœºå™¨ä¸Šï¼Œç”¨æˆ·åªéœ€è¦è§£å‹æ‰“åŒ…å¥½çš„å®¹å™¨é•œåƒï¼Œé‚£ä¹ˆè¿™ä¸ªåº”ç”¨è¿è¡Œæ‰€éœ€è¦çš„å®Œæ•´çš„æ‰§è¡Œç¯å¢ƒå°±è¢«é‡ç°å‡ºæ¥äº†ã€‚</p><p>è¿™ç§æ·±å…¥åˆ°æ“ä½œç³»ç»Ÿçº§åˆ«çš„è¿è¡Œç¯å¢ƒä¸€è‡´æ€§ï¼Œæ‰“é€šäº†åº”ç”¨åœ¨æœ¬åœ°å¼€å‘å’Œè¿œç«¯æ‰§è¡Œç¯å¢ƒä¹‹é—´éš¾ä»¥é€¾è¶Šçš„é¸¿æ²Ÿã€‚</p><h3 id="è”åˆæ–‡ä»¶ç³»ç»Ÿï¼ˆUnion-File-Systemï¼‰åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹"><a href="#è”åˆæ–‡ä»¶ç³»ç»Ÿï¼ˆUnion-File-Systemï¼‰åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹" class="headerlink" title="è”åˆæ–‡ä»¶ç³»ç»Ÿï¼ˆUnion File Systemï¼‰åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹"></a>è”åˆæ–‡ä»¶ç³»ç»Ÿï¼ˆUnion File Systemï¼‰åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹</h3><p>Docker åœ¨é•œåƒçš„è®¾è®¡ä¸­ï¼Œå¼•å…¥äº†å±‚ï¼ˆlayerï¼‰çš„æ¦‚å¿µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·åˆ¶ä½œé•œåƒçš„æ¯ä¸€æ­¥æ“ä½œï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªå±‚ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¢é‡ rootfsã€‚</p><p>Union File System ä¹Ÿå« UnionFSï¼Œæœ€ä¸»è¦çš„åŠŸèƒ½æ˜¯å°†å¤šä¸ªä¸åŒä½ç½®çš„ç›®å½•è”åˆæŒ‚è½½ï¼ˆunion mountï¼‰åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹ã€‚æ¯”å¦‚ï¼Œæˆ‘ç°åœ¨æœ‰ä¸¤ä¸ªç›®å½• A å’Œ Bï¼Œå®ƒä»¬åˆ†åˆ«æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost test1]# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ A</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ a</span><br><span class="line">â”‚Â Â  â””â”€â”€ x</span><br><span class="line">â””â”€â”€ B</span><br><span class="line">    â”œâ”€â”€ b</span><br><span class="line">    â””â”€â”€ x</span><br><span class="line"></span><br><span class="line">ç„¶åï¼Œæˆ‘ä½¿ç”¨è”åˆæŒ‚è½½çš„æ–¹å¼ï¼Œå°†è¿™ä¸¤ä¸ªç›®å½•æŒ‚è½½åˆ°ä¸€ä¸ªå…¬å…±çš„ç›®å½• C ä¸Šï¼š</span><br><span class="line"></span><br><span class="line">[root@localhost test1]# mkdir C</span><br><span class="line">[root@localhost test1]# mount -t aufs -o dirs&#x3D;.&#x2F;A:.&#x2F;B none .&#x2F;C</span><br><span class="line">[root@localhost test1]# tree .&#x2F;C</span><br><span class="line">.&#x2F;C</span><br><span class="line">â”œâ”€â”€ a</span><br><span class="line">â”œâ”€â”€ b</span><br><span class="line">â””â”€â”€ x</span><br><span class="line"></span><br><span class="line">å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªåˆå¹¶åçš„ç›®å½• C é‡Œï¼Œæœ‰ aã€bã€x ä¸‰ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸” x æ–‡ä»¶åªæœ‰ä¸€ä»½ã€‚</span><br><span class="line"></span><br><span class="line">è¿™ï¼Œå°±æ˜¯â€œåˆå¹¶â€çš„å«ä¹‰ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ åœ¨ç›®å½• C é‡Œå¯¹ aã€bã€x æ–‡ä»¶åšä¿®æ”¹ï¼Œè¿™äº›ä¿®æ”¹ä¹Ÿä¼šåœ¨å¯¹åº”çš„ç›®å½• Aã€B ä¸­ç”Ÿæ•ˆã€‚</span><br></pre></td></tr></table></figure><h3 id="Docker-Imageçš„åº•å±‚åŸç†"><a href="#Docker-Imageçš„åº•å±‚åŸç†" class="headerlink" title="Docker Imageçš„åº•å±‚åŸç†"></a>Docker Imageçš„åº•å±‚åŸç†</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªå®¹å™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -d ubuntu:latest sleep 3600</span><br><span class="line">693d8e17e996e08819c0504ce01f0b58c7e67918e8346255b3cf2fddfb8800af</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶çš„Docker Imageï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª Ubuntu æ“ä½œç³»ç»Ÿçš„ rootfsï¼Œå®ƒçš„å†…å®¹æ˜¯ Ubuntu æ“ä½œç³»ç»Ÿçš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ã€‚</p><p>ä¸è¿‡ï¼Œä¸ä¹‹å‰æˆ‘ä»¬è®²è¿°çš„ rootfs ç¨å¾®ä¸åŒçš„æ˜¯ï¼ŒDocker é•œåƒä½¿ç”¨çš„ rootfsï¼Œå¾€å¾€ç”±å¤šä¸ªâ€œå±‚â€ç»„æˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost test1]# docker image inspect ubuntu:latest</span><br><span class="line">...</span><br><span class="line">        &quot;RootFS&quot;: &#123;</span><br><span class="line">            &quot;Type&quot;: &quot;layers&quot;,</span><br><span class="line">            &quot;Layers&quot;: [</span><br><span class="line">                &quot;sha256:e1c75a5e0bfa094c407e411eb6cc8a159ee8b060cbd0398f1693978b4af9af10&quot;,</span><br><span class="line">                &quot;sha256:9e97312b63ff63ad98bb1f3f688fdff0721ce5111e7475b02ab652f10a4ff97d&quot;,</span><br><span class="line">                &quot;sha256:ec1817c93e7c08d27bfee063f0f1349185a558b87b2d806768af0a8fbbf5bc11&quot;,</span><br><span class="line">                &quot;sha256:05f3b67ed530c5b55f6140dfcdfb9746cdae7b76600de13275197d009086bb3d&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Metadata&quot;: &#123;</span><br><span class="line">            &quot;LastTagTime&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ª Ubuntu é•œåƒï¼Œå®é™…ä¸Šç”±å››å±‚ç»„æˆã€‚è¿™å››å±‚å°±æ˜¯å››ä¸ªå¢é‡ rootfsï¼Œæ¯ä¸€å±‚éƒ½æ˜¯ Ubuntu æ“ä½œç³»ç»Ÿæ–‡ä»¶ä¸ç›®å½•çš„ä¸€éƒ¨åˆ†ï¼›è€Œåœ¨ä½¿ç”¨é•œåƒæ—¶ï¼ŒDocker ä¼šæŠŠè¿™äº›å¢é‡è”åˆæŒ‚è½½åœ¨ä¸€ä¸ªç»Ÿä¸€çš„æŒ‚è½½ç‚¹ä¸Šï¼ˆç­‰ä»·äºå‰é¢ä¾‹å­é‡Œçš„â€œ/Câ€ç›®å½•ï¼‰ã€‚</p><p>overlay2æ˜¯æœ€æ–°çš„Docker CEç‰ˆæœ¬18.06.0ä¸Šçš„é»˜è®¤å­˜å‚¨é©±åŠ¨ã€‚</p><p>è¿™ä¸ªæŒ‚è½½ç‚¹å°±æ˜¯/var/lib/docker/overlay2</p><p>æ¯”å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#ä¸‹è½½Ubuntuåçš„å›¾å±‚</span><br><span class="line">[root@localhost overlay2]# ll</span><br><span class="line">total 0</span><br><span class="line">drwx------ 4 root root     72 Jul 19 19:22 02dccddd7184a977f6a105f849ecfa69753e62e3931628325249bf2fa013524f</span><br><span class="line">drwx------ 4 root root     55 Jul 19 19:22 930e827392a2b099d8b2d4c4431b1a6b8685bbfdca55b97c5522906170c78f72</span><br><span class="line">brw------- 1 root root 253, 0 Jun  1 15:10 backingFsBlockDev</span><br><span class="line">drwx------ 4 root root     72 Jul 19 19:22 cc3d690e853be0c422705cd4e449a30bdc4a121db5fc9d8e1c433f6071756111</span><br><span class="line">drwx------ 3 root root     47 Jul 19 19:22 fecbaa2f5e0fff06b09a6164443a50bad7829c484d5c5db732fd51abc4506beb</span><br><span class="line">drwx------ 2 root root    142 Jul 19 19:22 l</span><br><span class="line"></span><br><span class="line">#å¯åŠ¨ä¸€ä¸ªUbuntué•œåƒçš„å®¹å™¨</span><br><span class="line">[root@localhost overlay2]# docker run -d ubuntu:latest sleep 3600</span><br><span class="line"></span><br><span class="line">#å¯åŠ¨åçš„å›¾å±‚</span><br><span class="line">[root@localhost overlay2]# ll</span><br><span class="line">total 0</span><br><span class="line">drwx------ 4 root root     72 Jul 19 19:22 02dccddd7184a977f6a105f849ecfa69753e62e3931628325249bf2fa013524f</span><br><span class="line">drwx------ 4 root root     72 Jul 19 20:12 930e827392a2b099d8b2d4c4431b1a6b8685bbfdca55b97c5522906170c78f72</span><br><span class="line">brw------- 1 root root 253, 0 Jun  1 15:10 backingFsBlockDev</span><br><span class="line">drwx------ 4 root root     72 Jul 19 19:22 cc3d690e853be0c422705cd4e449a30bdc4a121db5fc9d8e1c433f6071756111</span><br><span class="line">drwx------ 5 root root     69 Jul 19 20:12 e9165a3fd83378e53b1dfe4c72c3c5003d4d165a4acfd80b265f8c455bb31bbc</span><br><span class="line">drwx------ 4 root root     72 Jul 19 20:12 e9165a3fd83378e53b1dfe4c72c3c5003d4d165a4acfd80b265f8c455bb31bbc-init</span><br><span class="line">drwx------ 3 root root     47 Jul 19 19:22 fecbaa2f5e0fff06b09a6164443a50bad7829c484d5c5db732fd51abc4506beb</span><br><span class="line">drwx------ 2 root root    210 Jul 19 20:12 l</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä½ ä¼šå‘ç°æ–°å¢äº†2ä¸ªç›®å½•ï¼Œå³è¢«è”åˆæŒ‚è½½ä¹‹åå½¢æˆæ–°çš„ç›®å½•</span><br><span class="line">è¿›å…¥ç›®å½•åå¯ä»¥çœ‹è§ï¼Œè¿™ä¸ªé‡Œé¢å°±æ˜¯å®¹å™¨é‡Œçš„ä¸œè¥¿</span><br><span class="line"></span><br><span class="line">[root@localhost merged]# pwd</span><br><span class="line">&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;e9165a3fd83378e53b1dfe4c72c3c5003d4d165a4acfd80b265f8c455bb31bbc&#x2F;merged</span><br><span class="line">[root@localhost merged]# ll</span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root  7 Jul  3 09:56 bin -&gt; usr&#x2F;bin</span><br><span class="line">drwxr-xr-x 2 root root  6 Apr 15 19:09 boot</span><br><span class="line">drwxr-xr-x 1 root root 43 Jul 19 20:12 dev</span><br><span class="line">drwxr-xr-x 1 root root 66 Jul 19 20:12 etc</span><br><span class="line">drwxr-xr-x 2 root root  6 Apr 15 19:09 home</span><br><span class="line">lrwxrwxrwx 1 root root  7 Jul  3 09:56 lib -&gt; usr&#x2F;lib</span><br><span class="line">lrwxrwxrwx 1 root root  9 Jul  3 09:56 lib32 -&gt; usr&#x2F;lib32</span><br><span class="line">lrwxrwxrwx 1 root root  9 Jul  3 09:56 lib64 -&gt; usr&#x2F;lib64</span><br><span class="line">lrwxrwxrwx 1 root root 10 Jul  3 09:56 libx32 -&gt; usr&#x2F;libx32</span><br><span class="line">drwxr-xr-x 2 root root  6 Jul  3 09:57 media</span><br><span class="line">drwxr-xr-x 2 root root  6 Jul  3 09:57 mnt</span><br><span class="line">drwxr-xr-x 2 root root  6 Jul  3 09:57 opt</span><br><span class="line">drwxr-xr-x 2 root root  6 Apr 15 19:09 proc</span><br><span class="line">drwx------ 2 root root 37 Jul  3 10:00 root</span><br><span class="line">drwxr-xr-x 1 root root 21 Jul  7 05:56 run</span><br><span class="line">lrwxrwxrwx 1 root root  8 Jul  3 09:56 sbin -&gt; usr&#x2F;sbin</span><br><span class="line">drwxr-xr-x 2 root root  6 Jul  3 09:57 srv</span><br><span class="line">drwxr-xr-x 2 root root  6 Apr 15 19:09 sys</span><br><span class="line">drwxrwxrwt 2 root root  6 Jul  3 10:00 tmp</span><br><span class="line">drwxr-xr-x 1 root root 18 Jul  3 09:57 usr</span><br><span class="line">drwxr-xr-x 1 root root 17 Jul  3 10:00 var</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œå‰é¢æåˆ°çš„äº”ä¸ªé•œåƒå±‚ï¼Œåˆæ˜¯å¦‚ä½•è¢«è”åˆæŒ‚è½½æˆè¿™æ ·ä¸€ä¸ªå®Œæ•´çš„ Ubuntu æ–‡ä»¶ç³»ç»Ÿçš„å‘¢ï¼Ÿ</p><p>å¯ä»¥æŸ¥è¯¢æŒ‚è½½çš„ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost merged]# cat &#x2F;proc&#x2F;mounts| grep overlay2</span><br><span class="line">overlay &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;e9165a3fd83378e53b1dfe4c72c3c5003d4d165a4acfd80b265f8c455bb31bbc&#x2F;merged </span><br><span class="line">overlay rw,relatime,</span><br><span class="line">lowerdir&#x3D;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;l&#x2F;X644A6N6JAYX6FLP76U6HFD3HQ:&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;l&#x2F;K4OIX32VD6WIAQ7R6LLXJXRVLQ:&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;l&#x2F;IJGD7NOFAJBGJFMMOCZVG7OXNC:&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;l&#x2F;OR4MXA5Z63JQCCXOQRSCFYMY2U:&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;l&#x2F;CPSWVQCU3X4JZWB3XEXL7TULDW,</span><br><span class="line">upperdir&#x3D;&#x2F;var&#x2F;lib&#x2F;dockeroverlay2&#x2F;e9165a3fd83378e53b1dfe4c72c3c5003d4d165a4acfd80b265f8c455bb31bbc&#x2F;diff,</span><br><span class="line">workdir&#x3D;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;e9165a3fd83378e53b1dfe4c72c3c5003d4d165a4acfd80b265f8c455bb31bbc&#x2F;work 0 0</span><br><span class="line"></span><br><span class="line">[root@localhost overlay2]# df -h</span><br><span class="line">overlay                  200G  4.3G  196G   3% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;e9165a3fd83378e53b1dfe4c72c3c5003d4d165a4acfd80b265f8c455bb31bbc&#x2F;merged</span><br></pre></td></tr></table></figure><h3 id="ä¸€ä¸ªå®¹å™¨çš„ç»„æˆéƒ¨åˆ†"><a href="#ä¸€ä¸ªå®¹å™¨çš„ç»„æˆéƒ¨åˆ†" class="headerlink" title="ä¸€ä¸ªå®¹å™¨çš„ç»„æˆéƒ¨åˆ†"></a>ä¸€ä¸ªå®¹å™¨çš„ç»„æˆéƒ¨åˆ†</h3><p>OverlayFSåœ¨å•ä¸ªLinuxä¸»æœºä¸Šåˆ†å±‚ä¸¤ä¸ªç›®å½•ï¼Œå¹¶å°†å®ƒä»¬æ˜¾ç¤ºä¸ºå•ä¸ªç›®å½•ã€‚è¿™äº›ç›®å½•ç§°ä¸ºå›¾å±‚ï¼Œç»Ÿä¸€è¿‡ç¨‹ç§°ä¸ºè”åˆå®‰è£…ã€‚OverlayFSæŒ‡çš„æ˜¯ä¸‹å±‚lowerdirç›®å½•aå’Œä¸Šå±‚ç›®å½•a upperdirã€‚ç»Ÿä¸€è§†å›¾é€šè¿‡å…¶è‡ªå·±çš„ç›®å½•å…¬å¼€mergedã€‚</p><p>é•œåƒå±‚ï¼ˆåªè¯»ï¼‰æ˜¯lowerdirï¼Œå®¹å™¨å±‚ï¼ˆè¯»å†™ï¼‰æ˜¯upperdir</p><ul><li>loweræ–‡ä»¶æŒ‡å‘é•œåƒå±‚ï¼Œå³Oveâ€‹â€‹rlayFS lowerdirã€‚</li><li>upperæ–‡ä»¶æŒ‡å‘å®¹å™¨å±‚ï¼Œè¯¥å±‚å¯¹åº”äºOverlayFS upperdirã€‚</li><li>mergedç›®å½•æ˜¯è”åˆå®‰è£…çš„lowerdirå’Œupperdirçš„æŒ‚è½½ç‚¹ï¼Œè¯¥æ–¹æ³•åŒ…æ‹¬ä»æ­£åœ¨è¿è¡Œçš„å®¹å™¨å†…çš„æ–‡ä»¶ç³»ç»Ÿçš„é•œåƒã€‚</li><li>workç›®å½•åœ¨OverlayFSå†…éƒ¨ã€‚ç”¨äºå®ç°copy_upæ“ä½œã€‚</li></ul><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Docker/overlay_constructs.jpg"  alt="overlay_constructs.jpg"></p><p>å¯åŠ¨åçš„å®¹å™¨åˆ†ä¸º3å±‚</p><ul><li>ç¬¬ä¸€éƒ¨åˆ†ï¼Œåªè¯»å±‚ã€‚</li></ul><p>å®ƒæ˜¯è¿™ä¸ªå®¹å™¨çš„ rootfs æœ€ä¸‹é¢çš„å››å±‚ï¼Œå¯¹åº”çš„æ­£æ˜¯ ubuntu:latest é•œåƒçš„å››å±‚ã€‚å®ƒä»¬çš„æŒ‚è½½æ–¹å¼éƒ½æ˜¯åªè¯»çš„ï¼ˆro+whï¼Œå³ readonly+whiteoutï¼Œè‡³äºä»€ä¹ˆæ˜¯ whiteoutï¼Œæˆ‘ä¸‹é¢é©¬ä¸Šä¼šè®²åˆ°ï¼‰ã€‚è¿™äº›å±‚ï¼Œéƒ½ä»¥å¢é‡çš„æ–¹å¼åˆ†åˆ«åŒ…å«äº† Ubuntu æ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚</p><ul><li>ç¬¬äºŒéƒ¨åˆ†ï¼Œå¯è¯»å†™å±‚ã€‚</li></ul><p>å®ƒæ˜¯è¿™ä¸ªå®¹å™¨çš„ rootfs æœ€ä¸Šé¢çš„ä¸€å±‚ï¼ˆ6e3be5d2ecccae7ccï¼‰ï¼Œå®ƒçš„æŒ‚è½½æ–¹å¼ä¸ºï¼šrwï¼Œå³ read writeã€‚</p><p>å¯æ˜¯ï¼Œä½ æœ‰æ²¡æœ‰æƒ³åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæˆ‘ç°åœ¨è¦åšçš„ï¼Œæ˜¯åˆ é™¤åªè¯»å±‚é‡Œçš„ä¸€ä¸ªæ–‡ä»¶å‘¢ï¼Ÿ</p><p>ä¸ºäº†å®ç°è¿™æ ·çš„åˆ é™¤æ“ä½œï¼ŒAuFS ä¼šåœ¨å¯è¯»å†™å±‚åˆ›å»ºä¸€ä¸ª whiteout æ–‡ä»¶ï¼ŒæŠŠåªè¯»å±‚é‡Œçš„æ–‡ä»¶â€œé®æŒ¡â€èµ·æ¥ã€‚</p><p>æ¯”å¦‚ï¼Œä½ è¦åˆ é™¤åªè¯»å±‚é‡Œä¸€ä¸ªåå« foo çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªåˆ é™¤æ“ä½œå®é™…ä¸Šæ˜¯åœ¨å¯è¯»å†™å±‚åˆ›å»ºäº†ä¸€ä¸ªåå«.wh.foo çš„æ–‡ä»¶ã€‚è¿™æ ·ï¼Œå½“è¿™ä¸¤ä¸ªå±‚è¢«è”åˆæŒ‚è½½ä¹‹åï¼Œfoo æ–‡ä»¶å°±ä¼šè¢«.wh.foo æ–‡ä»¶â€œé®æŒ¡â€èµ·æ¥ï¼Œâ€œæ¶ˆå¤±â€äº†ã€‚è¿™ä¸ªåŠŸèƒ½ï¼Œå°±æ˜¯â€œro+whâ€çš„æŒ‚è½½æ–¹å¼ï¼Œå³åªè¯» +whiteout çš„å«ä¹‰ã€‚æˆ‘å–œæ¬¢æŠŠ whiteout å½¢è±¡åœ°ç¿»è¯‘ä¸ºï¼šâ€œç™½éšœâ€ã€‚</p><p>åœ¨æ²¡æœ‰å†™å…¥æ–‡ä»¶ä¹‹å‰ï¼Œè¿™ä¸ªç›®å½•æ˜¯ç©ºçš„ã€‚è€Œä¸€æ—¦åœ¨å®¹å™¨é‡Œåšäº†å†™æ“ä½œï¼Œä½ ä¿®æ”¹äº§ç”Ÿçš„å†…å®¹å°±ä¼šä»¥å¢é‡çš„æ–¹å¼å‡ºç°åœ¨è¿™ä¸ªå±‚ä¸­ã€‚æœ€ä¸Šé¢è¿™ä¸ªå¯è¯»å†™å±‚çš„ä½œç”¨ï¼Œå°±æ˜¯ä¸“é—¨ç”¨æ¥å­˜æ”¾ä½ ä¿®æ”¹ rootfs åäº§ç”Ÿçš„å¢é‡ï¼Œæ— è®ºæ˜¯å¢ã€åˆ ã€æ”¹ï¼Œéƒ½å‘ç”Ÿåœ¨è¿™é‡Œã€‚è€Œå½“æˆ‘ä»¬ä½¿ç”¨å®Œäº†è¿™ä¸ªè¢«ä¿®æ”¹è¿‡çš„å®¹å™¨ä¹‹åï¼Œè¿˜å¯ä»¥ä½¿ç”¨ docker commit å’Œ push æŒ‡ä»¤ï¼Œä¿å­˜è¿™ä¸ªè¢«ä¿®æ”¹è¿‡çš„å¯è¯»å†™å±‚ï¼Œå¹¶ä¸Šä¼ åˆ° Docker Hub ä¸Šï¼Œä¾›å…¶ä»–äººä½¿ç”¨ï¼›è€Œä¸æ­¤åŒæ—¶ï¼ŒåŸå…ˆçš„åªè¯»å±‚é‡Œçš„å†…å®¹åˆ™ä¸ä¼šæœ‰ä»»ä½•å˜åŒ–ã€‚è¿™ï¼Œå°±æ˜¯å¢é‡ rootfs çš„å¥½å¤„ã€‚</p><ul><li>ç¬¬ä¸‰éƒ¨åˆ†ï¼ŒInit å±‚ã€‚å®ƒæ˜¯ä¸€ä¸ªä»¥â€œ-initâ€ç»“å°¾çš„å±‚ï¼Œå¤¹åœ¨åªè¯»å±‚å’Œè¯»å†™å±‚ä¹‹é—´ã€‚Init å±‚æ˜¯ Docker é¡¹ç›®å•ç‹¬ç”Ÿæˆçš„ä¸€ä¸ªå†…éƒ¨å±‚ï¼Œä¸“é—¨ç”¨æ¥å­˜æ”¾ /etc/hostsã€/etc/resolv.conf ç­‰ä¿¡æ¯ã€‚éœ€è¦è¿™æ ·ä¸€å±‚çš„åŸå› æ˜¯ï¼Œè¿™äº›æ–‡ä»¶æœ¬æ¥å±äºåªè¯»çš„ Ubuntu é•œåƒçš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯ç”¨æˆ·å¾€å¾€éœ€è¦åœ¨å¯åŠ¨å®¹å™¨æ—¶å†™å…¥ä¸€äº›æŒ‡å®šçš„å€¼æ¯”å¦‚ hostnameï¼Œæ‰€ä»¥å°±éœ€è¦åœ¨å¯è¯»å†™å±‚å¯¹å®ƒä»¬è¿›è¡Œä¿®æ”¹ã€‚å¯æ˜¯ï¼Œè¿™äº›ä¿®æ”¹å¾€å¾€åªå¯¹å½“å‰çš„å®¹å™¨æœ‰æ•ˆï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›æ‰§è¡Œ docker commit æ—¶ï¼ŒæŠŠè¿™äº›ä¿¡æ¯è¿åŒå¯è¯»å†™å±‚ä¸€èµ·æäº¤æ‰ã€‚æ‰€ä»¥ï¼ŒDocker åšæ³•æ˜¯ï¼Œåœ¨ä¿®æ”¹äº†è¿™äº›æ–‡ä»¶ä¹‹åï¼Œä»¥ä¸€ä¸ªå•ç‹¬çš„å±‚æŒ‚è½½äº†å‡ºæ¥ã€‚è€Œç”¨æˆ·æ‰§è¡Œ docker commit åªä¼šæäº¤å¯è¯»å†™å±‚ï¼Œæ‰€ä»¥æ˜¯ä¸åŒ…å«è¿™äº›å†…å®¹çš„ã€‚æœ€ç»ˆï¼Œè¿™ 7 ä¸ªå±‚éƒ½è¢«è”åˆæŒ‚è½½åˆ° /var/lib/docker/aufs/mnt ç›®å½•ä¸‹ï¼Œè¡¨ç°ä¸ºä¸€ä¸ªå®Œæ•´çš„ Ubuntu æ“ä½œç³»ç»Ÿä¾›å®¹å™¨ä½¿ç”¨ã€‚</li></ul><p>å…·ä½“ç»†èŠ‚åé¢æˆ‘ä¼šæ·±å…¥è®²è§£ï¼Œè¿™é‡Œå°±ä¸é‡ç‚¹è®²äº†</p><p>å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href="https://docs.docker.com/storage/storagedriver/overlayfs-driver/" target="_blank" rel="noopener">ä½¿ç”¨OverlayFSå­˜å‚¨é©±åŠ¨ç¨‹åº</a></p><p>æ‰€ä»¥ææ¸…æ¥šä¸€ç‚¹å³å¯</p><p>é•œåƒçš„å±‚éƒ½æ”¾ç½®åœ¨ /var/lib/docker/overlay2/åˆ†å±‚ID/diff ç›®å½•ä¸‹ï¼Œç„¶åå¯åŠ¨å®¹å™¨åè¢«è”åˆæŒ‚è½½åœ¨  /var/lib/docker/overlay2/è”åˆå±‚ID/merge é‡Œé¢ã€‚</p><h3 id="UFSå°ç»“"><a href="#UFSå°ç»“" class="headerlink" title="UFSå°ç»“"></a>UFSå°ç»“</h3><p>å®¹å™¨é•œåƒï¼Œä¹Ÿå«ä½œï¼šufsï¼ˆæœ‰çš„äººå–œæ¬¢å«rootfsï¼‰ã€‚å®ƒåªæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œå¹¶ä¸åŒ…å«å†…æ ¸ï¼Œæœ€å¤šä¹Ÿå°±å‡ ç™¾å…†ã€‚è€Œç›¸æ¯”ä¹‹ä¸‹ï¼Œä¼ ç»Ÿè™šæ‹Ÿæœºçš„é•œåƒå¤§å¤šæ˜¯ä¸€ä¸ªç£ç›˜çš„â€œå¿«ç…§â€ï¼Œç£ç›˜æœ‰å¤šå¤§ï¼Œé•œåƒå°±è‡³å°‘æœ‰å¤šå¤§ã€‚</p><p>é€šè¿‡ç»“åˆä½¿ç”¨ Mount Namespace å’Œ rootfsï¼Œå®¹å™¨å°±èƒ½å¤Ÿä¸ºè¿›ç¨‹æ„å»ºå‡ºä¸€ä¸ªå®Œå–„çš„æ–‡ä»¶ç³»ç»Ÿéš”ç¦»ç¯å¢ƒã€‚å½“ç„¶ï¼Œè¿™ä¸ªåŠŸèƒ½çš„å®ç°è¿˜å¿…é¡»æ„Ÿè°¢ chroot å’Œ pivot_root è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨åˆ‡æ¢è¿›ç¨‹æ ¹ç›®å½•çš„èƒ½åŠ›ã€‚</p><p>è€Œåœ¨ rootfs çš„åŸºç¡€ä¸Šï¼ŒDocker å…¬å¸åˆ›æ–°æ€§åœ°æå‡ºäº†ä½¿ç”¨å¤šä¸ªå¢é‡ rootfs è”åˆæŒ‚è½½ä¸€ä¸ªå®Œæ•´ rootfs çš„æ–¹æ¡ˆï¼Œè¿™å°±æ˜¯å®¹å™¨é•œåƒä¸­â€œå±‚â€çš„æ¦‚å¿µã€‚</p><p>é€šè¿‡â€œåˆ†å±‚é•œåƒâ€çš„è®¾è®¡ï¼Œä»¥ Docker é•œåƒä¸ºæ ¸å¿ƒï¼Œæ¥è‡ªä¸åŒå…¬å¸ã€ä¸åŒå›¢é˜Ÿçš„æŠ€æœ¯äººå‘˜è¢«ç´§å¯†åœ°è”ç³»åœ¨äº†ä¸€èµ·ã€‚è€Œä¸”ï¼Œç”±äºå®¹å™¨é•œåƒçš„æ“ä½œæ˜¯å¢é‡å¼çš„ï¼Œè¿™æ ·æ¯æ¬¡é•œåƒæ‹‰å–ã€æ¨é€çš„å†…å®¹ï¼Œæ¯”åŸæœ¬å¤šä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿçš„å¤§å°è¦å°å¾—å¤šï¼›è€Œå…±äº«å±‚çš„å­˜åœ¨ï¼Œå¯ä»¥ä½¿å¾—æ‰€æœ‰è¿™äº›å®¹å™¨é•œåƒéœ€è¦çš„æ€»ç©ºé—´ï¼Œä¹Ÿæ¯”æ¯ä¸ªé•œåƒçš„æ€»å’Œè¦å°ã€‚è¿™æ ·å°±ä½¿å¾—åŸºäºå®¹å™¨é•œåƒçš„å›¢é˜Ÿåä½œï¼Œè¦æ¯”åŸºäºåŠ¨åˆ™å‡ ä¸ª GB çš„è™šæ‹Ÿæœºç£ç›˜é•œåƒçš„åä½œè¦æ•æ·å¾—å¤šã€‚</p><p>æ›´é‡è¦çš„æ˜¯ï¼Œä¸€æ—¦è¿™ä¸ªé•œåƒè¢«å‘å¸ƒï¼Œé‚£ä¹ˆä½ åœ¨å…¨ä¸–ç•Œçš„ä»»ä½•ä¸€ä¸ªåœ°æ–¹ä¸‹è½½è¿™ä¸ªé•œåƒï¼Œå¾—åˆ°çš„å†…å®¹éƒ½å®Œå…¨ä¸€è‡´ï¼Œå¯ä»¥å®Œå…¨å¤ç°è¿™ä¸ªé•œåƒåˆ¶ä½œè€…å½“åˆçš„å®Œæ•´ç¯å¢ƒã€‚è¿™ï¼Œå°±æ˜¯å®¹å™¨æŠ€æœ¯â€œå¼ºä¸€è‡´æ€§â€çš„é‡è¦ä½“ç°ã€‚</p><h1 id="Dockerå­˜åœ¨çš„é—®é¢˜"><a href="#Dockerå­˜åœ¨çš„é—®é¢˜" class="headerlink" title="Dockerå­˜åœ¨çš„é—®é¢˜"></a>Dockerå­˜åœ¨çš„é—®é¢˜</h1><p>æˆ‘ä»¬æ—¢ç„¶è¦é‡æ–°äº†è§£Dockerï¼Œå®ƒçš„ä¸€äº›ç¼ºç‚¹æ³¨å®šæ˜¯æˆ‘ä»¬ç»•ä¸è¿‡å»çš„ï¼Œé¦–å…ˆï¼Œå®¹å™¨ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œä¸ç„¶è¦è™šæ‹Ÿæœºå¹²å˜›ã€‚æˆ‘ä¹Ÿæ˜¯é€šè¿‡å®¹å™¨çš„3ä¸ªæŠ€æœ¯åˆ†æå®ƒä»¬çš„åŠ£åŠ¿</p><h2 id="Namespace"><a href="#Namespace" class="headerlink" title="Namespace"></a>Namespace</h2><ul><li>Namespaceéš”ç¦»å¾—ä¸å½»åº•ï¼Œé¦–å…ˆï¼Œæ—¢ç„¶å®¹å™¨åªæ˜¯è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šçš„ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹ï¼Œé‚£ä¹ˆå¤šä¸ªå®¹å™¨ä¹‹é—´ä½¿ç”¨çš„å°±è¿˜æ˜¯åŒä¸€ä¸ªå®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚</li><li>åœ¨ Linux å†…æ ¸ä¸­ï¼Œæœ‰å¾ˆå¤šèµ„æºå’Œå¯¹è±¡æ˜¯ä¸èƒ½è¢« Namespace åŒ–çš„ï¼Œæœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯ï¼šæ—¶é—´ã€‚</li></ul><p>å¦‚æœä½ çš„å®¹å™¨ä¸­çš„ç¨‹åºä½¿ç”¨ settimeofday(2) ç³»ç»Ÿè°ƒç”¨ä¿®æ”¹äº†æ—¶é—´ï¼Œæ•´ä¸ªå®¿ä¸»æœºçš„æ—¶é—´éƒ½ä¼šè¢«éšä¹‹ä¿®æ”¹ï¼Œè¿™æ˜¾ç„¶ä¸ç¬¦åˆç”¨æˆ·çš„é¢„æœŸã€‚ç›¸æ¯”äºåœ¨è™šæ‹Ÿæœºé‡Œé¢å¯ä»¥éšä¾¿æŠ˜è…¾çš„è‡ªç”±åº¦ï¼Œåœ¨å®¹å™¨é‡Œéƒ¨ç½²åº”ç”¨çš„æ—¶å€™ï¼Œâ€œä»€ä¹ˆèƒ½åšï¼Œä»€ä¹ˆä¸èƒ½åšâ€ï¼Œå°±æ˜¯ç”¨æˆ·å¿…é¡»è€ƒè™‘çš„ä¸€ä¸ªé—®é¢˜ã€‚</p><p>ç”±äºä¸€ä¸ªå®¹å™¨çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œç”¨æˆ·çš„åº”ç”¨è¿›ç¨‹å®é™…ä¸Šå°±æ˜¯å®¹å™¨é‡Œ PID=1 çš„è¿›ç¨‹ï¼Œä¹Ÿæ˜¯å…¶ä»–åç»­åˆ›å»ºçš„æ‰€æœ‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚è¿™å°±æ„å‘³ç€ï¼Œåœ¨ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œä½ æ²¡åŠæ³•åŒæ—¶è¿è¡Œä¸¤ä¸ªä¸åŒçš„åº”ç”¨ï¼Œé™¤éä½ èƒ½äº‹å…ˆæ‰¾åˆ°ä¸€ä¸ªå…¬å…±çš„ PID=1 çš„ç¨‹åºæ¥å……å½“ä¸¤ä¸ªä¸åŒåº”ç”¨çš„çˆ¶è¿›ç¨‹ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¾ˆå¤šäººéƒ½ä¼šç”¨ systemd æˆ–è€… supervisord è¿™æ ·çš„è½¯ä»¶æ¥ä»£æ›¿åº”ç”¨æœ¬èº«ä½œä¸ºå®¹å™¨çš„å¯åŠ¨è¿›ç¨‹ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨åé¢åˆ†äº«å®¹å™¨è®¾è®¡æ¨¡å¼æ—¶ï¼Œæˆ‘è¿˜ä¼šæ¨èå…¶ä»–æ›´å¥½çš„è§£å†³åŠæ³•ã€‚è¿™æ˜¯å› ä¸ºå®¹å™¨æœ¬èº«çš„è®¾è®¡ï¼Œå°±æ˜¯å¸Œæœ›å®¹å™¨å’Œåº”ç”¨èƒ½å¤ŸåŒç”Ÿå‘½å‘¨æœŸï¼Œè¿™ä¸ªæ¦‚å¿µå¯¹åç»­çš„å®¹å™¨ç¼–æ’éå¸¸é‡è¦ã€‚å¦åˆ™ï¼Œä¸€æ—¦å‡ºç°ç±»ä¼¼äºâ€œå®¹å™¨æ˜¯æ­£å¸¸è¿è¡Œçš„ï¼Œä½†æ˜¯é‡Œé¢çš„åº”ç”¨æ—©å·²ç»æŒ‚äº†â€çš„æƒ…å†µï¼Œç¼–æ’ç³»ç»Ÿå¤„ç†èµ·æ¥å°±éå¸¸éº»çƒ¦äº†ã€‚</p><h2 id="Cgroups-1"><a href="#Cgroups-1" class="headerlink" title="Cgroups"></a>Cgroups</h2><p>Cgroups å¯¹èµ„æºçš„é™åˆ¶èƒ½åŠ›ä¹Ÿæœ‰å¾ˆå¤šä¸å®Œå–„çš„åœ°æ–¹ï¼Œè¢«æåŠæœ€å¤šçš„è‡ªç„¶æ˜¯ /proc æ–‡ä»¶ç³»ç»Ÿçš„é—®é¢˜ã€‚</p><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒLinux ä¸‹çš„ /proc ç›®å½•å­˜å‚¨çš„æ˜¯è®°å½•å½“å‰å†…æ ¸è¿è¡ŒçŠ¶æ€çš„ä¸€ç³»åˆ—ç‰¹æ®Šæ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è®¿é—®è¿™äº›æ–‡ä»¶ï¼ŒæŸ¥çœ‹ç³»ç»Ÿä»¥åŠå½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ CPU ä½¿ç”¨æƒ…å†µã€å†…å­˜å ç”¨ç‡ç­‰ï¼Œè¿™äº›æ–‡ä»¶ä¹Ÿæ˜¯ top æŒ‡ä»¤æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯çš„ä¸»è¦æ•°æ®æ¥æºã€‚</p><p>ä½†æ˜¯ï¼Œä½ å¦‚æœåœ¨å®¹å™¨é‡Œæ‰§è¡Œ top æŒ‡ä»¤ï¼Œå°±ä¼šå‘ç°ï¼Œå®ƒæ˜¾ç¤ºçš„ä¿¡æ¯å±…ç„¶æ˜¯å®¿ä¸»æœºçš„ CPU å’Œå†…å­˜æ•°æ®ï¼Œè€Œä¸æ˜¯å½“å‰å®¹å™¨çš„æ•°æ®ã€‚é€ æˆè¿™ä¸ªé—®é¢˜çš„åŸå› å°±æ˜¯ï¼Œ/proc æ–‡ä»¶ç³»ç»Ÿå¹¶ä¸çŸ¥é“ç”¨æˆ·é€šè¿‡ Cgroups ç»™è¿™ä¸ªå®¹å™¨åšäº†ä»€ä¹ˆæ ·çš„èµ„æºé™åˆ¶ï¼Œå³ï¼š/proc æ–‡ä»¶ç³»ç»Ÿä¸äº†è§£ Cgroups é™åˆ¶çš„å­˜åœ¨ã€‚</p><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªé—®é¢˜å¿…é¡»è¿›è¡Œä¿®æ­£ï¼Œå¦åˆ™åº”ç”¨ç¨‹åºåœ¨å®¹å™¨é‡Œè¯»å–åˆ°çš„ CPU æ ¸æ•°ã€å¯ç”¨å†…å­˜ç­‰ä¿¡æ¯éƒ½æ˜¯å®¿ä¸»æœºä¸Šçš„æ•°æ®ï¼Œè¿™ä¼šç»™åº”ç”¨çš„è¿è¡Œå¸¦æ¥éå¸¸å¤§çš„å›°æƒ‘å’Œé£é™©ã€‚</p><h2 id="UFS"><a href="#UFS" class="headerlink" title="UFS"></a>UFS</h2><p>ä¸Šé¢çš„è¯»å†™å±‚é€šå¸¸ä¹Ÿç§°ä¸ºå®¹å™¨å±‚ï¼Œä¸‹é¢çš„åªè¯»å±‚ç§°ä¸ºé•œåƒå±‚ï¼Œæ‰€æœ‰çš„å¢åˆ æŸ¥æ”¹æ“ä½œéƒ½åªä¼šä½œç”¨åœ¨å®¹å™¨å±‚ï¼Œç›¸åŒçš„æ–‡ä»¶ä¸Šå±‚ä¼šè¦†ç›–æ‰ä¸‹å±‚ã€‚</p><p>çŸ¥é“è¿™ä¸€ç‚¹ï¼Œå°±ä¸éš¾ç†è§£é•œåƒæ–‡ä»¶çš„ä¿®æ”¹ï¼Œæ¯”å¦‚ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šä»ä¸Šåˆ°ä¸‹æŸ¥æ‰¾æœ‰æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰¾åˆ°ï¼Œå°±å¤åˆ¶åˆ°å®¹å™¨å±‚ä¸­ï¼Œä¿®æ”¹ï¼Œä¿®æ”¹çš„ç»“æœå°±ä¼šä½œç”¨åˆ°ä¸‹å±‚çš„æ–‡ä»¶ï¼Œè¿™ç§æ–¹å¼ä¹Ÿè¢«ç§°ä¸ºcopy-on-writeã€‚</p><p>ä½†æ˜¯å¦‚æœä½ çš„åº•å±‚é•œåƒå‘ç”Ÿå˜åŒ–ï¼Œå¯èƒ½ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚å› ä¸ºå…¶ä»–çš„é•œåƒå¦‚æœéƒ½æŒ‰ç…§ä¸€ä¸ªåŸºç¡€é•œåƒçš„åˆ¶ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªæ”¹å˜ä¼šå½±å“å¾ˆå¤šç°æœ‰é•œåƒã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨javaé¡¹ç›®çš„ç¯å¢ƒä¾èµ–jdk1.7ï¼Œç”±äºé¡¹ç›®çš„å‡çº§åŠå…¶ä»–åŸå› ï¼Œå¯¼è‡´äº†jdk1.7å¿…é¡»å‡çº§åˆ°1.8æ‰èƒ½å®Œæˆï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„é¡¹ç›®éƒ½éœ€è¦å‡çº§ã€‚</p><p>åº”å¯¹è¿™ç§æƒ…å†µå°±å¿…é¡»è¦æ›´åŠ ç»†è‡´åŒ–çš„åŒºåˆ†åŸºç¡€é•œåƒã€‚</p><p>æ¯”å¦‚åˆ¶ä½œä¸€ä¸ªcentos7çš„é•œåƒ</p><p>åŸºäºè¿™ä¸ªé•œåƒåˆ¶ä½œä¸€ä¸ªjdk1.7 å’Œä¸€ä¸ªjdk1.8 2ä¸ªä¸åŒçš„åŸºç¡€é•œåƒ</p><p>ç„¶åé¡¹ç›®åˆ†åˆ«è·‘ç€ä¸åŒçš„åŸºç¡€ç¯å¢ƒä¸­ã€‚</p><p>è€Œè™šæ‹Ÿæœºå¯ä»¥éšæ„åˆ‡æ¢ç¯å¢ƒï¼Œé‡æ–°å¯åŠ¨é¡¹ç›®å³å¯ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å®¹å™¨ï¼Œå…¶å®æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹è€Œå·²ã€‚</p><p>Namespace çš„ä½œç”¨æ˜¯â€œéš”ç¦»â€ï¼Œå®ƒè®©åº”ç”¨è¿›ç¨‹åªèƒ½çœ‹åˆ°è¯¥ Namespace å†…çš„â€œä¸–ç•Œâ€</p><p>è€Œ Cgroups çš„ä½œç”¨æ˜¯â€œé™åˆ¶â€ï¼Œå®ƒç»™è¿™ä¸ªâ€œä¸–ç•Œâ€å›´ä¸Šäº†ä¸€åœˆçœ‹ä¸è§çš„å¢™ã€‚è¿™ä¹ˆä¸€æŠ˜è…¾ï¼Œè¿›ç¨‹å°±çœŸçš„è¢«â€œè£…â€åœ¨äº†ä¸€ä¸ªä¸ä¸–éš”ç»çš„æˆ¿é—´é‡Œï¼Œè€Œè¿™äº›æˆ¿é—´å°±æ˜¯ PaaS é¡¹ç›®èµ–ä»¥ç”Ÿå­˜çš„åº”ç”¨â€œæ²™ç›’â€ã€‚</p><p>é€šè¿‡ç»“åˆä½¿ç”¨ Mount Namespace å’Œ rootfsï¼Œå®¹å™¨å°±èƒ½å¤Ÿä¸ºè¿›ç¨‹æ„å»ºå‡ºä¸€ä¸ªå®Œå–„çš„æ–‡ä»¶ç³»ç»Ÿéš”ç¦»ç¯å¢ƒã€‚</p><p>é€šè¿‡è¿™æ ·çš„å‰–æï¼Œå¯¹äºæ›¾ç»â€œç¥ç§˜è«æµ‹â€çš„å®¹å™¨æŠ€æœ¯ï¼Œä½ æ˜¯ä¸æ˜¯æ„Ÿè§‰æ¸…æ™°äº†å¾ˆå¤šå‘¢ï¼Ÿ</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://docs.docker.com/storage/storagedriver/overlayfs-driver/" target="_blank" rel="noopener">ä½¿ç”¨OverlayFSå­˜å‚¨é©±åŠ¨ç¨‹åº</a></p><p><a href="https://time.geekbang.org/column/intro/116" target="_blank" rel="noopener">æ·±å…¥å‰–æKubernetes</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
            <tag> å®¹å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kuberneteså…¥é—¨ç¯‡(ä¸‰)â€”â€”Kubernetesçš„å¯¹è±¡å’ŒAPI</title>
      <link href="/2020/07/18/kubernetes/Kubernetes-introduction-3/"/>
      <url>/2020/07/18/kubernetes/Kubernetes-introduction-3/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="Kubernetes-å¯¹è±¡"><a href="#Kubernetes-å¯¹è±¡" class="headerlink" title="Kubernetes å¯¹è±¡"></a>Kubernetes å¯¹è±¡</h1><p>åœ¨ Kubernetes ç³»ç»Ÿä¸­ï¼ŒKubernetes å¯¹è±¡ æ˜¯æŒä¹…åŒ–çš„å®ä½“ã€‚Kubernetes ä½¿ç”¨è¿™äº›å®ä½“å»è¡¨ç¤ºæ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ã€‚ç‰¹åˆ«åœ°ï¼Œå®ƒä»¬æè¿°äº†å¦‚ä¸‹ä¿¡æ¯ï¼š</p><p>å“ªäº›å®¹å™¨åŒ–åº”ç”¨åœ¨è¿è¡Œï¼ˆä»¥åŠåœ¨å“ªä¸ª Node ä¸Šï¼‰<br>å¯ä»¥è¢«åº”ç”¨ä½¿ç”¨çš„èµ„æº<br>å…³äºåº”ç”¨è¿è¡Œæ—¶è¡¨ç°çš„ç­–ç•¥ï¼Œæ¯”å¦‚é‡å¯ç­–ç•¥ã€å‡çº§ç­–ç•¥ï¼Œä»¥åŠå®¹é”™ç­–ç•¥<br>Kubernetes å¯¹è±¡æ˜¯ â€œç›®æ ‡æ€§è®°å½•â€ â€”â€” ä¸€æ—¦åˆ›å»ºå¯¹è±¡ï¼ŒKubernetes ç³»ç»Ÿå°†æŒç»­å·¥ä½œä»¥ç¡®ä¿å¯¹è±¡å­˜åœ¨ã€‚é€šè¿‡åˆ›å»ºå¯¹è±¡ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨å‘ŠçŸ¥ Kubernetes ç³»ç»Ÿï¼Œæ‰€éœ€è¦çš„é›†ç¾¤å·¥ä½œè´Ÿè½½çœ‹èµ·æ¥æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œè¿™å°±æ˜¯ Kubernetes é›†ç¾¤çš„ æœŸæœ›çŠ¶æ€ï¼ˆDesired Stateï¼‰ã€‚</p><p>æ“ä½œ Kubernetes å¯¹è±¡ â€”â€” æ— è®ºæ˜¯åˆ›å»ºã€ä¿®æ”¹ï¼Œæˆ–è€…åˆ é™¤ â€”â€” éœ€è¦ä½¿ç”¨ Kubernetes APIã€‚æ¯”å¦‚ï¼Œå½“ä½¿ç”¨ kubectl å‘½ä»¤è¡Œæ¥å£æ—¶ï¼ŒCLI ä¼šæ‰§è¡Œå¿…è¦çš„ Kubernetes API è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨ç¨‹åºä¸­ä½¿ç”¨å®¢æˆ·ç«¯åº“ç›´æ¥è°ƒç”¨ Kubernetes APIã€‚</p><h2 id="å¯¹è±¡è§„åˆ™çº¦å®šï¼ˆSpecï¼‰ä¸çŠ¶æ€ï¼ˆStatusï¼‰"><a href="#å¯¹è±¡è§„åˆ™çº¦å®šï¼ˆSpecï¼‰ä¸çŠ¶æ€ï¼ˆStatusï¼‰" class="headerlink" title="å¯¹è±¡è§„åˆ™çº¦å®šï¼ˆSpecï¼‰ä¸çŠ¶æ€ï¼ˆStatusï¼‰"></a>å¯¹è±¡è§„åˆ™çº¦å®šï¼ˆSpecï¼‰ä¸çŠ¶æ€ï¼ˆStatusï¼‰</h2><p>æ¯ä¸ª Kubernetes å¯¹è±¡åŒ…å«ä¸¤ä¸ªåµŒå¥—çš„å¯¹è±¡å­—æ®µï¼Œå®ƒä»¬è´Ÿè´£ç®¡ç†å¯¹è±¡çš„é…ç½®ï¼šå¯¹è±¡ spec å’Œ å¯¹è±¡ status ã€‚ spec æ˜¯å¿…éœ€çš„ï¼Œå®ƒæè¿°äº†å¯¹è±¡çš„æœŸæœ›çŠ¶æ€ï¼ˆDesired Stateï¼‰ â€”â€” å¸Œæœ›å¯¹è±¡æ‰€å…·æœ‰çš„ç‰¹å¾ã€‚ status æè¿°äº†å¯¹è±¡çš„ å®é™…çŠ¶æ€ï¼ˆActual Stateï¼‰ ï¼Œå®ƒæ˜¯ç”± Kubernetes ç³»ç»Ÿæä¾›å’Œæ›´æ–°çš„ã€‚åœ¨ä»»ä½•æ—¶åˆ»ï¼ŒKubernetes æ§åˆ¶é¢ä¸€ç›´åŠªåŠ›åœ°ç®¡ç†ç€å¯¹è±¡çš„å®é™…çŠ¶æ€ä»¥ä¸æœŸæœ›çŠ¶æ€ç›¸åŒ¹é…ã€‚</p><p>ä¾‹å¦‚ï¼ŒKubernetes Deployment å¯¹è±¡èƒ½å¤Ÿè¡¨ç¤ºè¿è¡Œåœ¨é›†ç¾¤ä¸­çš„åº”ç”¨ã€‚ å½“åˆ›å»º Deployment æ—¶ï¼Œå¯èƒ½éœ€è¦è®¾ç½® Deployment çš„è§„çº¦ï¼Œä»¥æŒ‡å®šè¯¥åº”ç”¨éœ€è¦æœ‰ 3 ä¸ªå‰¯æœ¬åœ¨è¿è¡Œã€‚ Kubernetes ç³»ç»Ÿè¯»å– Deployment è§„çº¦ï¼Œå¹¶å¯åŠ¨æˆ‘ä»¬æ‰€æœŸæœ›çš„è¯¥åº”ç”¨çš„ 3 ä¸ªå®ä¾‹ â€”â€” æ›´æ–°çŠ¶æ€ä»¥ä¸è§„çº¦ç›¸åŒ¹é…ã€‚ å¦‚æœé‚£äº›å®ä¾‹ä¸­æœ‰å¤±è´¥çš„ï¼ˆä¸€ç§çŠ¶æ€å˜æ›´ï¼‰ï¼ŒKubernetes ç³»ç»Ÿé€šè¿‡ä¿®æ­£æ¥å“åº”è§„çº¦å’ŒçŠ¶æ€ä¹‹é—´çš„ä¸ä¸€è‡´ â€”â€” è¿™ç§æƒ…å†µï¼Œä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„å®ä¾‹æ¥æ›¿æ¢ã€‚</p><h2 id="æè¿°-Kubernetes-å¯¹è±¡"><a href="#æè¿°-Kubernetes-å¯¹è±¡" class="headerlink" title="æè¿° Kubernetes å¯¹è±¡"></a>æè¿° Kubernetes å¯¹è±¡</h2><p>å½“åˆ›å»º Kubernetes å¯¹è±¡æ—¶ï¼Œå¿…é¡»æä¾›å¯¹è±¡çš„è§„çº¦ï¼Œç”¨æ¥æè¿°è¯¥å¯¹è±¡çš„æœŸæœ›çŠ¶æ€ï¼Œä»¥åŠå…³äºå¯¹è±¡çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼ˆä¾‹å¦‚åç§°ï¼‰ã€‚ å½“ä½¿ç”¨ Kubernetes API åˆ›å»ºå¯¹è±¡æ—¶ï¼ˆæˆ–è€…ç›´æ¥åˆ›å»ºï¼Œæˆ–è€…åŸºäºkubectlï¼‰ï¼ŒAPI è¯·æ±‚å¿…é¡»åœ¨è¯·æ±‚ä½“ä¸­åŒ…å« JSON æ ¼å¼çš„ä¿¡æ¯ã€‚ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéœ€è¦åœ¨ .yaml æ–‡ä»¶ä¸­ä¸º kubectl æä¾›è¿™äº›ä¿¡æ¯ã€‚ kubectl åœ¨å‘èµ· API è¯·æ±‚æ—¶ï¼Œå°†è¿™äº›ä¿¡æ¯è½¬æ¢æˆ JSON æ ¼å¼ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ª nginx.yaml ç¤ºä¾‹æ–‡ä»¶ï¼Œå±•ç¤ºäº† Kubernetes Deployment çš„å¿…éœ€å­—æ®µå’Œå¯¹è±¡è§„çº¦ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps&#x2F;v1 # for versions before 1.9.0 use apps&#x2F;v1beta2</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deployment</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  replicas: 2 # tells deployment to run 2 pods matching the template</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:1.14.2</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç±»ä¼¼äºä¸Šé¢çš„ .yaml æ–‡ä»¶æ¥åˆ›å»º Deploymentï¼Œä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ kubectl å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰ä¸­çš„ kubectl apply å‘½ä»¤ï¼Œ å°† .yaml æ–‡ä»¶ä½œä¸ºå‚æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f nginx.yaml --record</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">deployment.apps&#x2F;nginx-deployment created</span><br></pre></td></tr></table></figure><h2 id="å¿…éœ€å­—æ®µ"><a href="#å¿…éœ€å­—æ®µ" class="headerlink" title="å¿…éœ€å­—æ®µ"></a>å¿…éœ€å­—æ®µ</h2><p>åœ¨æƒ³è¦åˆ›å»ºçš„ Kubernetes å¯¹è±¡å¯¹åº”çš„ .yaml æ–‡ä»¶ä¸­ï¼Œéœ€è¦é…ç½®å¦‚ä¸‹çš„å­—æ®µï¼š</p><ul><li>apiVersion - åˆ›å»ºè¯¥å¯¹è±¡æ‰€ä½¿ç”¨çš„ Kubernetes API çš„ç‰ˆæœ¬</li><li>kind - æƒ³è¦åˆ›å»ºçš„å¯¹è±¡çš„ç±»å‹</li><li>metadata - å¸®åŠ©è¯†åˆ«å¯¹è±¡å”¯ä¸€æ€§çš„æ•°æ®ï¼ŒåŒ…æ‹¬ä¸€ä¸ª name å­—ç¬¦ä¸²ã€UID å’Œå¯é€‰çš„ namespace</li></ul><p>æ‚¨ä¹Ÿéœ€è¦æä¾›å¯¹è±¡çš„ spec å­—æ®µã€‚å¯¹è±¡ spec çš„ç²¾ç¡®æ ¼å¼å¯¹æ¯ä¸ª Kubernetes å¯¹è±¡æ¥è¯´æ˜¯ä¸åŒçš„ï¼ŒåŒ…å«äº†ç‰¹å®šäºè¯¥å¯¹è±¡çš„åµŒå¥—å­—æ®µã€‚<a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/" target="_blank" rel="noopener">Kubernetes API</a> å‚è€ƒèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°ä»»ä½•æˆ‘ä»¬æƒ³åˆ›å»ºçš„å¯¹è±¡çš„ spec æ ¼å¼ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥ä» è¿™é‡Œ æŸ¥çœ‹ Pod çš„ spec æ ¼å¼ï¼Œ å¹¶ä¸”å¯ä»¥ä» è¿™é‡Œ æŸ¥çœ‹ Deployment çš„ spec æ ¼å¼ã€‚</p><h1 id="Kubernetes-API"><a href="#Kubernetes-API" class="headerlink" title="Kubernetes API"></a>Kubernetes API</h1><p>REST APIæ˜¯Kubernetesçš„åŸºç¡€æ¶æ„ã€‚ç»„ä»¶ä¹‹é—´çš„æ‰€æœ‰æ“ä½œå’Œé€šä¿¡ï¼Œä»¥åŠå¤–éƒ¨ç”¨æˆ·å‘½ä»¤éƒ½æ˜¯API Serverå¤„ç†çš„REST APIè°ƒç”¨ã€‚å› æ­¤ï¼ŒKuberneteså¹³å°ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½è¢«è§†ä¸ºAPIå¯¹è±¡ï¼Œå¹¶ä¸”åœ¨APIä¸­å…·æœ‰ç›¸åº”çš„æ¡ç›® ã€‚</p><p>å¤§å¤šæ•°æ“ä½œå¯ä»¥é€šè¿‡ kubectlå‘½ä»¤è¡Œç•Œé¢æˆ–å…¶ä»–å‘½ä»¤è¡Œå·¥å…·ï¼ˆä¾‹å¦‚kubeadmï¼‰æ‰§è¡Œï¼Œè€Œåè€…åˆä½¿ç”¨APIâ€‹â€‹ã€‚ä½†æ˜¯ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨RESTè°ƒç”¨ç›´æ¥è®¿é—®APIã€‚</p><p>å¦‚æœè¦ä½¿ç”¨Kubernetes APIç¼–å†™åº”ç”¨ç¨‹åºï¼Œè¯·è€ƒè™‘ä½¿ç”¨ä¸€ç§å®¢æˆ·ç«¯åº“ã€‚</p><p>Kubernetes APIæ˜¯é€šè¿‡HTTPæä¾›çš„åŸºäºèµ„æºçš„ï¼ˆRESTfulï¼‰ç¼–ç¨‹æ¥å£ã€‚å®ƒæ”¯æŒé€šè¿‡æ ‡å‡†HTTPåŠ¨è¯ï¼ˆPOSTï¼ŒPUTï¼ŒPATCHï¼ŒDELETEï¼ŒGETï¼‰æ£€ç´¢ï¼Œåˆ›å»ºï¼Œæ›´æ–°å’Œåˆ é™¤ä¸»è¦èµ„æºï¼ŒåŒ…æ‹¬è®¸å¤šå¯¹è±¡çš„é™„åŠ å­èµ„æºï¼Œè¿™äº›å¯¹è±¡å…è®¸è¿›è¡Œç»†ç²’åº¦çš„æˆæƒï¼ˆä¾‹å¦‚å°†Podç»‘å®šåˆ°èŠ‚ç‚¹ï¼‰ ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿æˆ–æœ‰æ•ˆåœ°æ¥å—å¹¶ä»¥ä¸åŒçš„è¡¨ç¤ºå½¢å¼æä¾›è¿™äº›èµ„æºã€‚å®ƒè¿˜æ”¯æŒé€šè¿‡â€œç›‘è§†â€å’Œä¸€è‡´çš„åˆ—è¡¨å¯¹èµ„æºè¿›è¡Œæœ‰æ•ˆçš„æ›´æ”¹é€šçŸ¥ï¼Œä»¥å…è®¸å…¶ä»–ç»„ä»¶æœ‰æ•ˆåœ°ç¼“å­˜å’ŒåŒæ­¥èµ„æºçŠ¶æ€ã€‚</p><h1 id="æ ‡å‡†APIæœ¯è¯­"><a href="#æ ‡å‡†APIæœ¯è¯­" class="headerlink" title="æ ‡å‡†APIæœ¯è¯­"></a>æ ‡å‡†APIæœ¯è¯­</h1><p>å¤§å¤šæ•°Kubernetes APIèµ„æºç±»å‹éƒ½æ˜¯å¯¹è±¡ï¼šå®ƒä»¬ä»£è¡¨é›†ç¾¤ä¸ŠæŸä¸ªæ¦‚å¿µçš„å…·ä½“å®ä¾‹ï¼Œä¾‹å¦‚podæˆ–åç§°ç©ºé—´ã€‚APIèµ„æºç±»å‹çš„ä¸€ä¸ªè¾ƒå°æ•°ç›®æ˜¯â€œè™šæ‹Ÿâ€ -å®ƒä»¬é€šå¸¸ä»£è¡¨æ“ä½œï¼Œè€Œä¸æ˜¯ç‰©ä½“ï¼Œå¦‚æƒé™æ£€æŸ¥ï¼ˆä½¿ç”¨POSTç”¨çš„JSONç¼–ç ä½“SubjectAccessReviewåˆ°subjectaccessreviewsèµ„æºï¼‰ã€‚æ‰€æœ‰å¯¹è±¡éƒ½å°†å…·æœ‰å”¯ä¸€åç§°ï¼Œä»¥å…è®¸è¿›è¡Œå¹‚ç­‰çš„åˆ›å»ºå’Œæ£€ç´¢ï¼Œä½†æ˜¯å¦‚æœè™šæ‹Ÿèµ„æºç±»å‹ä¸å¯æ£€ç´¢æˆ–ä¸ä¾èµ–å¹‚ç­‰ï¼Œåˆ™å®ƒä»¬å¯èƒ½æ²¡æœ‰å”¯ä¸€çš„åç§°ã€‚</p><h2 id="èµ„æºç±»åˆ«"><a href="#èµ„æºç±»åˆ«" class="headerlink" title="èµ„æºç±»åˆ«"></a>èµ„æºç±»åˆ«</h2><p>è¿™æ˜¯Kubernetes APIæä¾›çš„åŸºæœ¬èµ„æºç±»å‹åŠå…¶ä¸»è¦åŠŸèƒ½çš„é«˜çº§æ¦‚è¿°ã€‚</p><ul><li><p>å·¥ä½œè´Ÿè½½æ˜¯ç”¨äºåœ¨é›†ç¾¤ä¸Šç®¡ç†å’Œè¿è¡Œå®¹å™¨çš„å¯¹è±¡ã€‚</p></li><li><p>å‘ç°å’ŒLBèµ„æºæ˜¯ç”¨äºå°†å·¥ä½œè´Ÿè½½â€œç¼åˆâ€åˆ°å¤–éƒ¨å¯è®¿é—®çš„è´Ÿè½½å¹³è¡¡æœåŠ¡ä¸­çš„å¯¹è±¡ã€‚</p></li><li><p>é…ç½®å’Œå­˜å‚¨èµ„æºæ˜¯ç”¨äºå°†åˆå§‹åŒ–æ•°æ®æ³¨å…¥åˆ°åº”ç”¨ç¨‹åºä¸­å¹¶æŒä¹…åŒ–å®¹å™¨å¤–éƒ¨æ•°æ®çš„å¯¹è±¡ã€‚</p></li><li><p>ç¾¤é›†èµ„æºå¯¹è±¡å®šä¹‰äº†ç¾¤é›†æœ¬èº«çš„é…ç½®æ–¹å¼ã€‚è¿™äº›é€šå¸¸ä»…ç”±é›†ç¾¤è¿è¥å•†ä½¿ç”¨ã€‚</p></li><li><p>å…ƒæ•°æ®èµ„æºæ˜¯ç”¨äºé…ç½®é›†ç¾¤ä¸­å…¶ä»–èµ„æºè¡Œä¸ºï¼ˆä¾‹å¦‚HorizontalPodAutoscaleræ‰©å±•å·¥ä½œè´Ÿè½½ï¼‰çš„å¯¹è±¡ã€‚</p></li></ul><h2 id="èµ„æºå¯¹è±¡"><a href="#èµ„æºå¯¹è±¡" class="headerlink" title="èµ„æºå¯¹è±¡"></a>èµ„æºå¯¹è±¡</h2><p>èµ„æºå¯¹è±¡é€šå¸¸å…·æœ‰3ä¸ªç»„æˆéƒ¨åˆ†ï¼š</p><ul><li>Resource ObjectMetaï¼šè¿™æ˜¯æœ‰å…³èµ„æºçš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚å…¶åç§°ï¼Œç±»å‹ï¼Œapiç‰ˆæœ¬ï¼Œæ³¨é‡Šå’Œæ ‡ç­¾ã€‚å®ƒåŒ…å«æœ€ç»ˆç”¨æˆ·å’Œç³»ç»Ÿéƒ½å¯èƒ½æ›´æ–°çš„å­—æ®µï¼ˆä¾‹å¦‚ï¼Œæ³¨é‡Šï¼‰ã€‚</li><li>ResourceSpecï¼šç”±ç”¨æˆ·å®šä¹‰ï¼Œå¹¶æè¿°æ‰€éœ€çš„ç³»ç»ŸçŠ¶æ€ã€‚åœ¨åˆ›å»ºæˆ–æ›´æ–°å¯¹è±¡æ—¶å¡«å†™ã€‚</li><li>ResourceStatusï¼šè¿™ç”±æœåŠ¡å™¨å¡«å……ï¼Œå¹¶æŠ¥å‘Šç³»ç»Ÿçš„å½“å‰çŠ¶æ€ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç”¨æˆ·æ— éœ€æ›´æ”¹æ­¤è®¾ç½®ã€‚</li></ul><h2 id="èµ„æºè¿ä½œ"><a href="#èµ„æºè¿ä½œ" class="headerlink" title="èµ„æºè¿ä½œ"></a>èµ„æºè¿ä½œ</h2><p>å¤§å¤šæ•°èµ„æºæä¾›ä»¥ä¸‹æ“ä½œï¼š</p><h3 id="Createï¼ˆåˆ›å»ºï¼‰"><a href="#Createï¼ˆåˆ›å»ºï¼‰" class="headerlink" title="Createï¼ˆåˆ›å»ºï¼‰"></a>Createï¼ˆåˆ›å»ºï¼‰</h3><p>åˆ›å»ºæ“ä½œå°†åœ¨å­˜å‚¨åç«¯ä¸­åˆ›å»ºèµ„æºã€‚åˆ›å»ºèµ„æºåï¼Œç³»ç»Ÿå°†åº”ç”¨æ‰€éœ€çš„çŠ¶æ€ã€‚</p><h3 id="Updateï¼ˆæ›´æ–°ï¼‰"><a href="#Updateï¼ˆæ›´æ–°ï¼‰" class="headerlink" title="Updateï¼ˆæ›´æ–°ï¼‰"></a>Updateï¼ˆæ›´æ–°ï¼‰</h3><p>æ›´æ–°æœ‰2ç§å½¢å¼ï¼šReplaceï¼ˆæ›¿æ¢ï¼‰å’Œè¡¥ä¸</p><ul><li>Replaceï¼ˆæ›¿æ¢ï¼‰ï¼šæ›¿æ¢èµ„æºå¯¹è±¡å°†é€šè¿‡ä½¿ç”¨æä¾›çš„è§„èŒƒæ›¿æ¢ç°æœ‰è§„èŒƒæ¥æ›´æ–°èµ„æºã€‚å¯¹äºå…ˆè¯»åå†™æ“ä½œï¼Œè¿™æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºå¦‚æœåœ¨è¯»å†™ä¹‹é—´ä¿®æ”¹äº†èµ„æºï¼Œåˆ™ä¼šå‘ç”Ÿä¹è§‚é”å®šå¤±è´¥ã€‚æ³¨æ„ï¼šResourceStatuså°†è¢«ç³»ç»Ÿå¿½ç•¥ï¼Œå¹¶ä¸”ä¸ä¼šæ›´æ–°ã€‚è¦æ›´æ–°çŠ¶æ€ï¼Œå¿…é¡»è°ƒç”¨ç‰¹å®šçš„çŠ¶æ€æ›´æ–°æ“ä½œã€‚</li></ul><p>æ³¨æ„ï¼šæ›¿æ¢èµ„æºå¯¹è±¡å¯èƒ½ä¸ä¼šç«‹å³å¯¼è‡´æ›´æ”¹ä¼ æ’­åˆ°ä¸‹æ¸¸å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œæ›¿æ¢a ConfigMapæˆ–Secretresourceä¸ä¼šå¯¼è‡´æ‰€æœ‰Podéƒ½çœ‹åˆ°æ›´æ”¹ï¼Œé™¤éPodé‡æ–°å¸¦å¤–é‡å¯ã€‚</p><ul><li>Patchï¼ˆè¡¥ä¸ï¼‰ï¼šè¡¥ä¸ä¼šå°†æ›´æ”¹åº”ç”¨äºç‰¹å®šå­—æ®µã€‚æ¯ä¸ªå­—æ®µå®šä¹‰äº†å¦‚ä½•åˆå¹¶æ›´æ”¹ã€‚åˆ—è¡¨å¯ä»¥è¢«æ›¿æ¢æˆ–åˆå¹¶ã€‚åˆå¹¶åˆ—è¡¨å°†ä¸ä¼šä¿ç•™é¡ºåºã€‚<br>ä¿®è¡¥ç¨‹åºæ°¸è¿œä¸ä¼šå¯¼è‡´ä¹è§‚çš„é”å®šå¤±è´¥ï¼Œå¹¶ä¸”æœ€åçš„å†™å…¥å°†è·èƒœã€‚ å¦‚æœåœ¨æ›´æ–°ä¹‹å‰æœªè¯»å–å®Œæ•´çŠ¶æ€ï¼Œæˆ–è€…ä¸å¸Œæœ›å‡ºç°ä¹è§‚é”å®šå¤±è´¥ï¼Œåˆ™å»ºè®®ä½¿ç”¨ä¿®è¡¥ç¨‹åºã€‚åœ¨ä¿®è¡¥å¤æ‚ç±»å‹ï¼Œæ•°ç»„å’Œæ˜ å°„æ—¶ï¼Œå°†æŒ‰å­—æ®µå®šä¹‰ä¿®è¡¥ç¨‹åºçš„åº”ç”¨æ–¹å¼ï¼Œå¹¶ä¸”å¯ä»¥æ›¿æ¢å­—æ®µçš„å½“å‰å€¼ï¼Œä¹Ÿå¯ä»¥å°†å†…å®¹åˆå¹¶ä¸ºå½“å‰å€¼ã€‚</li></ul><h3 id="Readï¼ˆè¯»ï¼‰"><a href="#Readï¼ˆè¯»ï¼‰" class="headerlink" title="Readï¼ˆè¯»ï¼‰"></a>Readï¼ˆè¯»ï¼‰</h3><p>è¯»åˆ†ä¸º3ç§å½¢å¼ï¼šGetã€ List ã€ Watch</p><ul><li>Getï¼šGetå°†æŒ‰åç§°æ£€ç´¢ç‰¹å®šçš„èµ„æºå¯¹è±¡ã€‚</li><li>Listï¼šListå°†æ£€ç´¢åç§°ç©ºé—´ä¸­ç‰¹å®šç±»å‹çš„æ‰€æœ‰èµ„æºå¯¹è±¡ï¼Œå¹¶ä¸”ç»“æœå¯ä»¥é™åˆ¶ä¸ºä¸é€‰æ‹©å™¨æŸ¥è¯¢åŒ¹é…çš„èµ„æºã€‚<br>åˆ—å‡ºæ‰€æœ‰å‘½åç©ºé—´ï¼šä¸åˆ—è¡¨ç±»ä¼¼ï¼Œä½†åœ¨æ‰€æœ‰å‘½åç©ºé—´ä¸­æ£€ç´¢èµ„æºã€‚</li><li>Watchï¼šWatchå°†åœ¨æ›´æ–°å¯¹è±¡æ—¶æµå¼ä¼ è¾“ç»“æœã€‚ç±»ä¼¼äºå›è°ƒï¼ŒWatchç”¨äºå“åº”èµ„æºæ›´æ”¹ã€‚</li></ul><h3 id="Deleteï¼ˆåˆ é™¤ï¼‰"><a href="#Deleteï¼ˆåˆ é™¤ï¼‰" class="headerlink" title="Deleteï¼ˆåˆ é™¤ï¼‰"></a>Deleteï¼ˆåˆ é™¤ï¼‰</h3><p>åˆ é™¤å°†åˆ é™¤èµ„æºã€‚æ ¹æ®ç‰¹å®šçš„èµ„æºï¼Œå­å¯¹è±¡å¯èƒ½ä¼šä¹Ÿå¯èƒ½ä¸ä¼šè¢«æœåŠ¡å™¨åƒåœ¾å›æ”¶ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§æœ‰å…³ç‰¹å®šèµ„æºå¯¹è±¡çš„æ³¨é‡Šã€‚</p><h3 id="Additional-Operationsï¼ˆé™„åŠ æ“ä½œï¼‰"><a href="#Additional-Operationsï¼ˆé™„åŠ æ“ä½œï¼‰" class="headerlink" title="Additional Operationsï¼ˆé™„åŠ æ“ä½œï¼‰"></a>Additional Operationsï¼ˆé™„åŠ æ“ä½œï¼‰</h3><p>èµ„æºå¯ä»¥å®šä¹‰ç‰¹å®šäºè¯¥èµ„æºç±»å‹çš„å…¶ä»–æ“ä½œã€‚</p><ul><li>Rollbackï¼ˆå›æ»šï¼‰ï¼šå°†PodTemplateå›æ»šåˆ°ä»¥å‰çš„ç‰ˆæœ¬ã€‚ä»…é€‚ç”¨äºæŸäº›èµ„æºç±»å‹ã€‚</li><li>Read / Write Scaleï¼ˆè¯»å–/å†™å…¥æ¯”ä¾‹ï¼‰ï¼šè¯»å–æˆ–æ›´æ–°ç»™å®šèµ„æºçš„å‰¯æœ¬æ•°ã€‚ä»…é€‚ç”¨äºæŸäº›èµ„æºç±»å‹ã€‚</li><li>Read / Write Statusï¼ˆè¯»å–/å†™å…¥çŠ¶æ€ï¼‰ï¼šè¯»å–æˆ–æ›´æ–°èµ„æºå¯¹è±¡çš„çŠ¶æ€ã€‚åªèƒ½é€šè¿‡è¿™äº›æ›´æ–°æ“ä½œæ¥æ›´æ”¹çŠ¶æ€ã€‚</li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>Kubernetes APIæ˜¯ç³»ç»Ÿæè¿°æ€§é…ç½®çš„åŸºç¡€ã€‚ Kubectl å‘½ä»¤è¡Œå·¥å…·è¢«ç”¨äºåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ã€è·å–APIå¯¹è±¡ã€‚</p><p>Kubernetes é€šè¿‡APIèµ„æºå­˜å‚¨è‡ªå·±åºåˆ—åŒ–çŠ¶æ€(ç°åœ¨å­˜å‚¨åœ¨etcd)ã€‚</p><p>Kubernetes è¢«åˆ†æˆå¤šä¸ªç»„ä»¶ï¼Œå„éƒ¨åˆ†é€šè¿‡APIç›¸äº’äº¤äº’ã€‚</p><p>Kubernetes å¯¹è±¡ä¸€èˆ¬ç”±3ä¸ªéƒ¨åˆ†ç»„æˆï¼ˆResource ObjectMetaã€ResourceSpecã€ResourceStatusï¼‰</p><p>è€Œæ“ä½œ Kubernetes å¯¹è±¡ â€”â€” æ— è®ºæ˜¯åˆ›å»ºã€ä¿®æ”¹ï¼Œæˆ–è€…åˆ é™¤éƒ½è¦ä½¿ç”¨ Kubernetes APIã€‚</p><p>ä»ä¸‹ç« å¼€å§‹ï¼Œæˆ‘å…·ä½“è®²è§£å„ä¸ª Kubernetes å¯¹è±¡çš„å®ä½“åŒ–ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p> <a href="https://kubernetes.io/docs/reference/" target="_blank" rel="noopener">APIå‚è€ƒ</a></p><p> <a href="https://kubernetes.io/docs/reference/using-api/api-concepts/" target="_blank" rel="noopener">Kubernetes APIæ¦‚å¿µ</a></p>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ansibleä¸€é”®éƒ¨ç½²é«˜å¯ç”¨Kubernetesé›†ç¾¤</title>
      <link href="/2020/07/18/kubernetes/Kubernetes-install/"/>
      <url>/2020/07/18/kubernetes/Kubernetes-install/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><h2 id="å‰ç½®è¦æ±‚ä¸çº¦å®š"><a href="#å‰ç½®è¦æ±‚ä¸çº¦å®š" class="headerlink" title="å‰ç½®è¦æ±‚ä¸çº¦å®š"></a>å‰ç½®è¦æ±‚ä¸çº¦å®š</h2><ul><li><p>é›†ç¾¤ä¼šä½¿ç”¨åˆ°çš„ç«¯å£å·ã€‚</p></li><li><p>å„æœåŠ¡å™¨æ—¶é—´ä¸æ—¶åŒºéœ€ä¸€è‡´ï¼Œé›†ç¾¤å†…æœåŠ¡å™¨é—´æ—¶é—´å·®å€¼ä¸èƒ½å¤§äº1ç§’ã€‚</p></li><li><p>æ–‡æ¡£ä»¥ 4 ä¸ª CentOS 7.4 ç³»ç»ŸæœåŠ¡å™¨å®‰è£…é«˜å¯ç”¨ Kubernetes é›†ç¾¤è¿›è¡Œè®²è§£ã€‚</p></li><li><p>æŒ‰ç…§æœ¬æ–‡æ¡£å®‰è£… Kubernetes é›†ç¾¤æ—¶ï¼ŒAnsible è„šæœ¬ä¼šå°†æœåŠ¡å™¨ä¸Šé˜²ç«å¢™å…³é—­ï¼Œè¯·ä½¿ç”¨å®‰å…¨ç»„è¿›è¡Œç½‘ç»œæƒé™æ§åˆ¶ã€‚</p></li><li><p>Master(s) æœåŠ¡å™¨ä¸º Kubernetes æ§åˆ¶æœåŠ¡å™¨ï¼›Worker(s) æœåŠ¡å™¨ä¸º Kubernetes è¿ç®—æœåŠ¡å™¨ï¼›Etcd æœåŠ¡å™¨ä¸ºç»„å»ºEtcd é›†ç¾¤çš„æœåŠ¡å™¨ï¼ŒEtcd å®˜æ–¹å»ºè®® Etcd é›†ç¾¤æœåŠ¡å™¨ä¸ªæ•°ä¸ºå¥‡æ•°ä¸ªï¼ˆæ¯”å¦‚1ã€3ã€5ï¼‰ä»¥é˜²æ­¢è„‘è£‚ã€‚</p></li><li><p>ä¸ºå®‰å…¨è€ƒè™‘æŒ‰æœ¬æ•™ç¨‹å®‰è£…çš„ Kubernetes é›†ç¾¤åªä¼šåœ¨ Master(s) æœåŠ¡å™¨ä¸Šé…ç½® kubectl å‘½ä»¤æ‰€éœ€ kubeconfigï¼Œæ•… Worker(s) æœåŠ¡å™¨é»˜è®¤æ˜¯æ— æ³•ä½¿ç”¨ kubectl å‘½ä»¤çš„ã€‚</p></li></ul><table><thead><tr><th>æˆæƒç­–ç•¥</th><th>åè®®ç±»å‹</th><th>ç«¯å£èŒƒå›´</th><th>æˆæƒç±»å‹</th><th>æˆæƒå¯¹è±¡</th><th>æè¿°</th></tr></thead><tbody><tr><td>å…è®¸</td><td>TCP    80â„80</td><td>åœ°å€æ®µè®¿é—®</td><td>0.0.0.0/0</td><td>http</td><td>åè®®è®¿é—®é›†ç¾¤</td></tr><tr><td>å…è®¸</td><td>TCP</td><td>443â„443</td><td>åœ°å€æ®µè®¿é—®</td><td>0.0.0.0/0</td><td>https</td></tr><tr><td>å…è®¸</td><td>TCP    30000â„32767</td><td>åœ°å€æ®µè®¿é—®</td><td>0.0.0.0/0</td><td>NodePort</td><td>è®¿é—®é›†ç¾¤</td></tr><tr><td>å…è®¸</td><td>å…¨éƒ¨</td><td>-1/-1</td><td>åœ°å€æ®µè®¿é—®</td><td>10.244.0.0/18</td><td>è·¨èŠ‚ç‚¹ Pod ä¹‹é—´äº’ç›¸è®¿é—®</td></tr></tbody></table><h2 id="å‡†å¤‡é…ç½®æ–‡ä»¶"><a href="#å‡†å¤‡é…ç½®æ–‡ä»¶" class="headerlink" title="å‡†å¤‡é…ç½®æ–‡ä»¶"></a>å‡†å¤‡é…ç½®æ–‡ä»¶</h2><p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1hofRCJMUyOUxwPKw7hTi8w" target="_blank" rel="noopener">https://pan.baidu.com/s/1hofRCJMUyOUxwPKw7hTi8w</a><br>æå–ç ï¼šmpdk<br>å¤åˆ¶è¿™æ®µå†…å®¹åæ‰“å¼€ç™¾åº¦ç½‘ç›˜æ‰‹æœºAppï¼Œæ“ä½œæ›´æ–¹ä¾¿å“¦</p><p>è§£å‹æ–‡ä»¶kubeadm-ha-master.tar.gzåæœ‰ä¸‹é¢çš„æ–‡ä»¶</p><p>æˆ‘å·²ç»æ‰“åŒ…å¥½äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-28-16 kubeadm-ha-master]# ll</span><br><span class="line">total 132</span><br><span class="line">-rw-r--r--  1 root root    89 Jun  4 17:00 00-kernel.yml</span><br><span class="line">-rw-r--r--  1 root root   103 Jun  4 17:00 01-base.yml</span><br><span class="line">-rw-r--r--  1 root root    73 Jun  4 17:00 02-docker.yml</span><br><span class="line">-rw-r--r--  1 root root    88 Jun  4 17:00 03-kubernetes-component.yml</span><br><span class="line">-rw-r--r--  1 root root   115 Jun  4 17:00 04-load-balancer.yml</span><br><span class="line">-rw-r--r--  1 root root   160 Jun  4 17:00 05-etcd.yml</span><br><span class="line">-rw-r--r--  1 root root   133 Jun  4 17:00 06-kubernetes-certificates.yml</span><br><span class="line">-rw-r--r--  1 root root    89 Jun  4 17:00 07-kubernetes-master.yml</span><br><span class="line">-rw-r--r--  1 root root    89 Jun  4 17:00 08-kubernetes-worker.yml</span><br><span class="line">-rw-r--r--  1 root root   113 Jun  4 17:00 09-post.yml</span><br><span class="line">-rw-r--r--  1 root root    86 Jun  4 17:00 21-network-plugin.yml</span><br><span class="line">-rw-r--r--  1 root root    89 Jun  4 17:00 22-ingress-controller.yml</span><br><span class="line">-rw-r--r--  1 root root    91 Jun  4 17:00 23-kubernetes-dashboard.yml</span><br><span class="line">-rw-r--r--  1 root root    85 Jun  4 17:00 24-metrics-server.yml</span><br><span class="line">-rw-r--r--  1 root root    83 Jun  4 17:00 25-cert-manager.yml</span><br><span class="line">-rw-r--r--  1 root root  1084 Jun  4 17:00 90-init-cluster.yml</span><br><span class="line">-rw-r--r--  1 root root   698 Jun  4 17:00 91-add-master.yml</span><br><span class="line">-rw-r--r--  1 root root   557 Jun  4 17:00 92-add-worker.yml</span><br><span class="line">-rw-r--r--  1 root root   523 Jun  4 17:00 93-add-etcd.yml</span><br><span class="line">-rw-r--r--  1 root root   995 Jun  4 17:00 94-upgrade-cluster.yml</span><br><span class="line">-rw-r--r--  1 root root   115 Jun  4 17:00 95-certificates-renew.yml</span><br><span class="line">-rw-r--r--  1 root root   394 Jun  4 17:00 96-backup-cluster.yml</span><br><span class="line">-rw-r--r--  1 root root   730 Jun  4 17:00 97-restore-cluster.yml</span><br><span class="line">-rw-r--r--  1 root root   374 Jun  4 17:00 99-reset-cluster.yml</span><br><span class="line">-rw-r--r--  1 root root 10506 Jun  4 17:00 ansible.cfg</span><br><span class="line">drwxr-xr-x  2 root root   240 Jun  4 17:00 docs</span><br><span class="line">drwxr-xr-x  2 root root   220 Jun  4 17:00 example</span><br><span class="line">-rwxr-xr-x  1 root root   319 Jun  4 17:00 install-ansible.sh</span><br><span class="line">-rw-r--r--  1 root root  3286 Jul 17 17:00 inventory.ini</span><br><span class="line">-rw-r--r--  1 root root  2585 Jun  4 17:00 LICENSE</span><br><span class="line">drwxr-xr-x  2 root root    95 Jun  4 17:00 offline</span><br><span class="line">-rw-r--r--  1 root root  5700 Jun  4 17:00 README.md</span><br><span class="line">drwxr-xr-x 14 root root   201 Jun  4 17:00 roles</span><br><span class="line">-rw-r--r--  1 root root  3299 Jun  4 17:00 Vagrantfile</span><br></pre></td></tr></table></figure><p>ä½ åªéœ€è¦å…³æ³¨ä¸€ä¸ªé…ç½®æ–‡ä»¶inventory.ini</p><h2 id="inventory-ini"><a href="#inventory-ini" class="headerlink" title="inventory.ini"></a>inventory.ini</h2><h3 id="IPåˆ†é…"><a href="#IPåˆ†é…" class="headerlink" title="IPåˆ†é…"></a>IPåˆ†é…</h3><table><thead><tr><th>èŠ‚ç‚¹</th><th>IP</th></tr></thead><tbody><tr><td>master-1</td><td>172.31.28.16</td></tr><tr><td>master-2</td><td>172.31.28.17</td></tr><tr><td>master-3</td><td>172.31.28.18</td></tr><tr><td>node-1</td><td>172.31.28.19</td></tr><tr><td>node-2</td><td>172.31.28.21</td></tr><tr><td>node-3</td><td>172.31.28.22</td></tr><tr><td>VIP</td><td>172.31.28.10</td></tr></tbody></table><h3 id="ç½‘æ®µåˆ’åˆ†"><a href="#ç½‘æ®µåˆ’åˆ†" class="headerlink" title="ç½‘æ®µåˆ’åˆ†"></a>ç½‘æ®µåˆ’åˆ†</h3><p>æ³¨æ„ï¼šä½ å¿…é¡»ä¿è¯ä½ åˆ’åˆ†çš„å­ç½‘çš„ç½‘æ®µä¸ªæ•°è¦è¶…è¿‡ä½ æ€»èŠ‚ç‚¹æ•°</p><p>æ¯”å¦‚ä½ ä¸€å…±è¦éƒ¨ç½²3master-3nodeç±»å‹ï¼Œä½ çš„å­ç½‘åˆ’åˆ†å°±ä¸èƒ½æ˜¯172.32.192.0/23 å› ä¸ºè¿™æ ·æœ€å¤šåªèƒ½åˆ’åˆ†172.32.192.0-255/24å’Œ172.32.193.0-255/24ç½‘æ®µï¼Œè€Œæ¯ä¸ªèŠ‚ç‚¹çš„é»˜è®¤è™šæ‹Ÿç½‘å…³éƒ½æ˜¯ç‹¬å ä¸€æ®µçš„</p><p>å¦‚æœä»172.32.192.0/24å¼€å§‹ç®—èµ· ä½ è‡³å°‘è¦ç»™ä»–åˆ’åˆ†åˆ°172.32.198.255ï¼Œé‡Œé¢åŒ…å«äº†ï¼ˆ172.32.192.0/24 172.32.193.0/24 172.32.194.0/24 172.32.195.0/24 172.32.196.0/24 172.32.197.0/24 172.32.198.0/24ï¼‰ä¸ºäº†æ–¹ä¾¿æ‰©å®¹ï¼Œæˆ‘ä»¬è®¾ä¸º172.32.192.0/20 å¯ä»¥åˆ’åˆ†16ä¸ªç½‘æ®µï¼Œä¹Ÿå°±æ˜¯æœ€å¤šå®¹çº³16ä¸ªèŠ‚ç‚¹ï¼ˆåŒ…æ‹¬masterå’Œnodeï¼‰</p><p>é›†ç¾¤pod ipæ®µ</p><p>kube_pod_subnet=â€172.32.192.0/20â€</p><p>é›†ç¾¤service ipæ®µ</p><p>kube_service_subnet=â€172.31.208.0/20â€</p><h3 id="é…ç½®å¡«å†™"><a href="#é…ç½®å¡«å†™" class="headerlink" title="é…ç½®å¡«å†™"></a>é…ç½®å¡«å†™</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">; å°†æ‰€æœ‰èŠ‚ç‚¹çš„ä¿¡æ¯åœ¨è¿™é‡Œå¡«å†™</span><br><span class="line">;    ç¬¬ä¸€ä¸ªå­—æ®µ                  ä¸ºèŠ‚ç‚¹å†…ç½‘IPï¼Œéƒ¨ç½²å®Œæˆåä¸º kubernetes èŠ‚ç‚¹ nodeName</span><br><span class="line">;    ç¬¬äºŒä¸ªå­—æ®µ ansible_user     ä¸ºèŠ‚ç‚¹è¿œç¨‹ç™»å½•ç”¨æˆ·å</span><br><span class="line">;    ç¬¬ä¸‰ä¸ªå­—æ®µ ansible_ssh_pass ä¸ºèŠ‚ç‚¹è¿œç¨‹ç™»å½•ç”¨æˆ·å¯†ç </span><br><span class="line">[all]</span><br><span class="line">172.31.28.16 ansible_user&#x3D;root ansible_ssh_pass&#x3D;123456</span><br><span class="line">172.31.28.17 ansible_user&#x3D;root ansible_ssh_pass&#x3D;123456</span><br><span class="line">172.31.28.18 ansible_user&#x3D;root ansible_ssh_pass&#x3D;123456</span><br><span class="line">172.31.28.19 ansible_user&#x3D;root ansible_ssh_pass&#x3D;123456</span><br><span class="line">172.31.28.21 ansible_user&#x3D;root ansible_ssh_pass&#x3D;123456</span><br><span class="line">172.31.28.22 ansible_user&#x3D;root ansible_ssh_pass&#x3D;123456</span><br><span class="line"></span><br><span class="line">; ç§æœ‰äº‘ï¼š</span><br><span class="line">;    VIP è´Ÿè½½æ¨¡å¼ï¼š</span><br><span class="line">;       ä¹Ÿå°±æ˜¯è´Ÿè½½å‡è¡¡å™¨ + keepalived æ¨¡å¼ï¼Œæ¯”å¦‚å¸¸ç”¨çš„ haproxy + keepalivedã€‚</span><br><span class="line">;       æœ¬è„šæœ¬ä¸­è´Ÿè½½å‡è¡¡å™¨æœ‰ nginxã€haproxyã€envoy å¯ä¾›é€‰æ‹©ï¼Œè®¾ç½® lb_mode å³å¯è¿›è¡Œä»»æ„åˆ‡æ¢ã€‚</span><br><span class="line">;       è®¾ç½® lb_kube_apiserver_ip å³è¡¨ç¤ºå¯ç”¨ keepalivedï¼Œè¯·å…ˆä¸æœåŠ¡å™¨æä¾›éƒ¨é—¨åå•†ä¿ç•™ä¸€ä¸ªIPä½œä¸º lb_kube_apiserver_ipï¼Œ</span><br><span class="line">;       ä¸€èˆ¬ lb èŠ‚ç‚¹ç»„ä¸­æœ‰ä¸¤ä¸ªèŠ‚ç‚¹å°±å¤Ÿäº†ï¼ŒlbèŠ‚ç‚¹ç»„ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸º keepalived çš„ master èŠ‚ç‚¹ï¼Œå‰©ä¸‹çš„éƒ½ä¸º backed èŠ‚ç‚¹ã€‚</span><br><span class="line">;</span><br><span class="line">;    èŠ‚ç‚¹æœ¬åœ°è´Ÿè½½æ¨¡å¼ï¼š</span><br><span class="line">;       åªå¯åŠ¨è´Ÿè½½å‡è¡¡å™¨ï¼Œä¸å¯ç”¨ keepalivedï¼ˆå³ä¸è®¾ç½® lb_kube_apiserver_ipï¼‰ï¼Œ</span><br><span class="line">;       æ­¤æ—¶ kubelet é“¾æ¥ apiserver åœ°å€ä¸º 127.0.0.1:lb_kube_apiserver_portã€‚</span><br><span class="line">;       ä½¿ç”¨æ­¤æ¨¡å¼æ—¶è¯·å°† lb èŠ‚ç‚¹ç»„ç½®ç©ºã€‚</span><br><span class="line">;</span><br><span class="line">; å…¬æœ‰äº‘ï¼š</span><br><span class="line">;    ä¸æ¨èä½¿ç”¨ slb æ¨¡å¼ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨èŠ‚ç‚¹æœ¬åœ°è´Ÿè½½æ¨¡å¼ã€‚</span><br><span class="line">;    è‹¥ä½¿ç”¨ slb æ¨¡å¼ï¼Œè¯·å…ˆä½¿ç”¨èŠ‚ç‚¹æœ¬åœ°è´Ÿè½½æ¨¡å¼è¿›è¡Œéƒ¨ç½²ï¼Œ</span><br><span class="line">;    éƒ¨ç½²æˆåŠŸåå†åˆ‡æ¢è‡³ slb æ¨¡å¼ï¼š</span><br><span class="line">;       å°† lb_mode ä¿®æ”¹ä¸º slbï¼Œå°† lb_kube_apiserver_ip è®¾ç½®ä¸ºè´­ä¹°åˆ°çš„ slb å†…ç½‘ipï¼Œ</span><br><span class="line">;       ä¿®æ”¹ lb_kube_apiserver_port ä¸º slb ç›‘å¬ç«¯å£ã€‚</span><br><span class="line">;    å†æ¬¡è¿è¡Œåˆå§‹åŒ–é›†ç¾¤è„šæœ¬å³å¯åˆ‡æ¢è‡³ slb æ¨¡å¼ã€‚</span><br><span class="line">[lb]</span><br><span class="line">172.31.28.16</span><br><span class="line">172.31.28.17</span><br><span class="line">172.31.28.18</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; æ³¨æ„etcdé›†ç¾¤å¿…é¡»æ˜¯1,3,5,7...å¥‡æ•°ä¸ªèŠ‚ç‚¹</span><br><span class="line">[etcd]</span><br><span class="line">172.31.28.16</span><br><span class="line">172.31.28.17</span><br><span class="line">172.31.28.18</span><br><span class="line"></span><br><span class="line">[kube-master]</span><br><span class="line">172.31.28.16</span><br><span class="line">172.31.28.17</span><br><span class="line">172.31.28.18</span><br><span class="line"></span><br><span class="line">[kube-worker]</span><br><span class="line">172.31.28.19</span><br><span class="line">172.31.28.21</span><br><span class="line">172.31.28.22</span><br><span class="line"></span><br><span class="line">; é¢„ç•™ç»„ï¼Œåç»­æ·»åŠ masterèŠ‚ç‚¹ä½¿ç”¨</span><br><span class="line">[new-master]</span><br><span class="line"></span><br><span class="line">; é¢„ç•™ç»„ï¼Œåç»­æ·»åŠ workerèŠ‚ç‚¹ä½¿ç”¨</span><br><span class="line">[new-worker]</span><br><span class="line"></span><br><span class="line">; é¢„ç•™ç»„ï¼Œåç»­æ·»åŠ etcdèŠ‚ç‚¹ä½¿ç”¨</span><br><span class="line">[new-etcd]</span><br><span class="line"></span><br><span class="line">;-------------------------------------- ä»¥ä¸‹ä¸ºåŸºç¡€ä¿¡æ¯é…ç½® ------------------------------------;</span><br><span class="line">[all:vars]</span><br><span class="line">; æ˜¯å¦è·³è¿‡èŠ‚ç‚¹ç‰©ç†èµ„æºæ ¡éªŒï¼ŒMasterèŠ‚ç‚¹è¦æ±‚2c2gä»¥ä¸Šï¼ŒWorkerèŠ‚ç‚¹è¦æ±‚2c4gä»¥ä¸Š</span><br><span class="line">skip_verify_node&#x3D;false</span><br><span class="line">; kubernetesç‰ˆæœ¬</span><br><span class="line">kube_version&#x3D;&quot;1.15.5&quot;</span><br><span class="line">; è´Ÿè½½å‡è¡¡å™¨</span><br><span class="line">;   æœ‰ nginxã€haproxyã€envoy å’Œ slb å››ä¸ªé€‰é¡¹ï¼Œé»˜è®¤ä½¿ç”¨ nginxï¼›</span><br><span class="line">lb_mode&#x3D;&quot;nginx&quot;</span><br><span class="line">; ä½¿ç”¨è´Ÿè½½å‡è¡¡åé›†ç¾¤ apiserver ipï¼Œè®¾ç½® lb_kube_apiserver_ip å˜é‡ï¼Œåˆ™å¯ç”¨è´Ÿè½½å‡è¡¡å™¨ + keepalived</span><br><span class="line">lb_kube_apiserver_ip&#x3D;&quot;172.31.28.10&quot;</span><br><span class="line">; ä½¿ç”¨è´Ÿè½½å‡è¡¡åé›†ç¾¤ apiserver port</span><br><span class="line">lb_kube_apiserver_port&#x3D;&quot;8443&quot;</span><br><span class="line">; é›†ç¾¤pod ipæ®µ</span><br><span class="line">kube_pod_subnet&#x3D;&quot;172.32.192.0&#x2F;20&quot;</span><br><span class="line">; é›†ç¾¤service ipæ®µ</span><br><span class="line">kube_service_subnet&#x3D;&quot;172.31.208.0&#x2F;20&quot;</span><br><span class="line">; é›†ç¾¤ç½‘ç»œæ’ä»¶ï¼Œç›®å‰æ”¯æŒflannel,calico,kube-ovn</span><br><span class="line">network_plugin&#x3D;&quot;flannel&quot;</span><br><span class="line">; Kubelet æ ¹ç›®å½•</span><br><span class="line">kubelet_root_dir&#x3D;&quot;&#x2F;var&#x2F;lib&#x2F;kubelet&quot;</span><br><span class="line">; dockerå®¹å™¨å­˜å‚¨ç›®å½•</span><br><span class="line">docker_storage_dir&#x3D;&quot;&#x2F;var&#x2F;lib&#x2F;docker&quot;</span><br></pre></td></tr></table></figure><h1 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># è¿›å…¥éƒ¨ç½²æ–‡ä»¶å¤¹ï¼Œéƒ¨ç½²ansibleç¯å¢ƒ</span><br><span class="line">[root@VM-28-16 kubeadm-ha-master]# .&#x2F;install-ansible.sh</span><br><span class="line"></span><br><span class="line"># å®‰è£…å®Œansibleåéƒ¨ç½²k8sé›†ç¾¤</span><br><span class="line">[root@VM-28-16 kubeadm-ha-master]# ansible-playbook -i inventory.ini 90-init-cluster.yml</span><br><span class="line"></span><br><span class="line"># å¦‚æœéƒ¨ç½²å¤±è´¥ï¼Œæƒ³è¦é‡ç½®é›†ç¾¤ï¼Œæ‰§è¡Œï¼š</span><br><span class="line">[root@VM-28-16 kubeadm-ha-master]# ansible-playbook -i inventory.ini 99-reset-cluster.yml</span><br><span class="line"></span><br><span class="line"># éƒ¨ç½²å®Œæˆåæµ‹è¯•ä¸€ä¸‹é›†ç¾¤</span><br><span class="line">[root@VM-28-16 ~]# kubectl get nodes</span><br><span class="line">NAME           STATUS   ROLES            AGE   VERSION</span><br><span class="line">172.31.28.16   Ready    etcd,lb,master   20h   v1.15.5</span><br><span class="line">172.31.28.17   Ready    etcd,lb,master   20h   v1.15.5</span><br><span class="line">172.31.28.18   Ready    etcd,lb,master   20h   v1.15.5</span><br><span class="line">172.31.28.19   Ready    worker           20h   v1.15.5</span><br><span class="line">172.31.28.21   Ready    worker           20h   v1.15.5</span><br><span class="line">172.31.28.22   Ready    worker           20h   v1.15.5</span><br><span class="line"></span><br><span class="line">å³è¯´æ˜éƒ¨ç½²å®Œæˆ</span><br></pre></td></tr></table></figure><h1 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h1><p>ä¸€èˆ¬æ¥è¯´éƒ¨ç½²å®Œé›†ç¾¤åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œåç»­ä½ éœ€è¦è¡¥é½ç›‘æ§ã€Helmã€æœåŠ¡ç½‘æ ¼ç­‰ç»„ä»¶ï¼Œåœ¨è¿™ç« ä¸ç»†è®²äº†ã€‚</p><p>éƒ¨ç½²helmè¯·å‚è€ƒ <a href="https://rugod.cn/2020/06/21/helm/helm-install/" target="_blank" rel="noopener">Helmç®€ä»‹åŠé˜¿é‡Œäº‘å®‰è£…éƒ¨ç½²</a></p><p>éƒ¨ç½²ç›‘æ§è¯·å‚è€ƒ  <a href="https://rugod.cn/2020/06/17/kubernetes/Kubernetes-dashboard/" target="_blank" rel="noopener">Kuberneteså¯è§†åŒ–ç•Œé¢åŠç›‘æ§å®‰è£…</a></p><p>éƒ¨ç½²æœåŠ¡ç½‘æ ¼æš‚æ—¶è¿˜æ²¡å†™<del>~</del></p><h1 id="æ‰©å®¹èŠ‚ç‚¹"><a href="#æ‰©å®¹èŠ‚ç‚¹" class="headerlink" title="æ‰©å®¹èŠ‚ç‚¹"></a>æ‰©å®¹èŠ‚ç‚¹</h1><p>è¿˜æ˜¯æ”¹inventory.iniæ–‡ä»¶ï¼Œæ‰§è¡Œansible-playbookçš„å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨allç»„é‡ŒåŠ å…¥æ–°èŠ‚ç‚¹ip </span><br><span class="line">[all]</span><br><span class="line">172.31.28.23 ansible_user&#x3D;root ansible_ssh_pass&#x3D;123456</span><br><span class="line"></span><br><span class="line"># åœ¨new-workerç»„é‡ŒåŠ å…¥æ–°èŠ‚ç‚¹</span><br><span class="line">[new-worker]</span><br><span class="line">172.31.28.23</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ”¹å¥½åä¿å­˜æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">[root@vm-26-11 ~]# ansible-playbook -i inventory.ini 92-add-worker.yml</span><br></pre></td></tr></table></figure><h1 id="é—®é¢˜è®°å½•"><a href="#é—®é¢˜è®°å½•" class="headerlink" title="é—®é¢˜è®°å½•"></a>é—®é¢˜è®°å½•</h1><h2 id="etcdæŠ¥é”™èµ·ä¸æ¥"><a href="#etcdæŠ¥é”™èµ·ä¸æ¥" class="headerlink" title="etcdæŠ¥é”™èµ·ä¸æ¥"></a>etcdæŠ¥é”™èµ·ä¸æ¥</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fatal: [172.31.28.17]: failed! &#x3D;&gt; &#123;&quot;attempts&quot;: 12, &quot;changed&quot;: true, &quot;cmd&quot;: &quot;docker run --net host -e etcdctl_api&#x3D;3 -v &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;etcd:&#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;etcd --rm registry.aliyuncs.com&#x2F;k8sxio&#x2F;etcd:3.4.3-0 etcdctl endpoint health --endpoints&#x3D;https:&#x2F;&#x2F;[127.0.0.1]:2379 --cacert&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;etcd&#x2F;ca.crt --key&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;etcd&#x2F;healthcheck-client.key --cert&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;etcd&#x2F;healthcheck-client.crt\n&quot;, &quot;delta&quot;: &quot;0:00:05.690875&quot;, &quot;end&quot;: &quot;2020-07-17 16:43:55.778524&quot;, &quot;msg&quot;: &quot;non-zero return code&quot;, &quot;rc&quot;: 1, &quot;start&quot;: &quot;2020-07-17 16:43:50.087649&quot;, &quot;stderr&quot;: &quot;&#123;\&quot;level\&quot;:\&quot;warn\&quot;,\&quot;ts\&quot;:\&quot;2020-07-17t08:43:55.557z\&quot;,\&quot;caller\&quot;:\&quot;clientv3&#x2F;retry_interceptor.go:61\&quot;,\&quot;msg\&quot;:\&quot;retrying of unary invoker failed\&quot;,\&quot;target\&quot;:\&quot;endpoint:&#x2F;&#x2F;client-2d241951-f3e1-4e5d-9cf3-47dbe4bf7797&#x2F;[127.0.0.1]:2379\&quot;,\&quot;attempt\&quot;:0,\&quot;error\&quot;:\&quot;rpc error: code &#x3D; deadlineexceeded desc &#x3D; context deadline exceeded\&quot;&#125;\nhttps:&#x2F;&#x2F;[127.0.0.1]:2379 is unhealthy: failed to commit proposal: context deadline exceeded\nerror: unhealthy cluster&quot;, &quot;stderr_lines&quot;: [&quot;&#123;\&quot;level\&quot;:\&quot;warn\&quot;,\&quot;ts\&quot;:\&quot;2020-07-17t08:43:55.557z\&quot;,\&quot;caller\&quot;:\&quot;clientv3&#x2F;retry_interceptor.go:61\&quot;,\&quot;msg\&quot;:\&quot;retrying of unary invoker failed\&quot;,\&quot;target\&quot;:\&quot;endpoint:&#x2F;&#x2F;client-2d241951-f3e1-4e5d-9cf3-47dbe4bf7797&#x2F;[127.0.0.1]:2379\&quot;,\&quot;attempt\&quot;:0,\&quot;error\&quot;:\&quot;rpc error: code &#x3D; deadlineexceeded desc &#x3D; context deadline exceeded\&quot;&#125;&quot;, &quot;https:&#x2F;&#x2F;[127.0.0.1]:2379 is unhealthy: failed to commit proposal: context deadline exceeded&quot;, &quot;error: unhealthy cluster&quot;], &quot;stdout&quot;: &quot;&quot;, &quot;stdout_lines&quot;: []&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ ¸å¿ƒå°±æ˜¯</span><br><span class="line">https:&#x2F;&#x2F;localhost:2379 is unhealthy: failed to commit proposal: context deadline exceeded #3546</span><br></pre></td></tr></table></figure><p>etcdåˆå§‹åŒ–å¤±è´¥</p><p>åˆ†æåŸå› ï¼ŒæœåŠ¡å™¨æ—¶é—´æœªåŒæ­¥ï¼ˆæ²¡ç»†æŸ¥ï¼‰ï¼Œä½†æ˜¯åŒæ­¥å„æœåŠ¡å™¨çš„æ—¶é—´ä¹‹åç¡®å®å¥½ã€‚</p><p>çŒœæƒ³ï¼šetcdå­˜å‚¨å„ä¸ªæœåŠ¡å™¨çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ—¶é—´ï¼Œè¿™ä¸ªä¸åŒæ­¥å¯èƒ½åæœŸä¼šå‡ºé—®é¢˜</p><h2 id="æ‰©å®¹èŠ‚ç‚¹æŠ¥é”™"><a href="#æ‰©å®¹èŠ‚ç‚¹æŠ¥é”™" class="headerlink" title="æ‰©å®¹èŠ‚ç‚¹æŠ¥é”™"></a>æ‰©å®¹èŠ‚ç‚¹æŠ¥é”™</h2><p>æ‰©å®¹èŠ‚ç‚¹çš„è„šæœ¬æ‰§è¡Œå®Œåå‘ç°æ–°èŠ‚ç‚¹å¹¶æ²¡æœ‰åŠ å…¥åˆ°é›†ç¾¤é‡Œ</p><p>ç„¶åè¿›å…¥æ–°èŠ‚ç‚¹æŸ¥çœ‹,æ²¡æœ‰è¿è¡Œçš„å®¹å™¨ä¹Ÿæ²¡æœ‰é•œåƒ,æŸ¥çœ‹è¿›ç¨‹å‘ç°kubeletèµ·æ¥äº†ï¼ŒæŸ¥çœ‹ç½‘å¡æ¥å£å‘ç°æ²¡æœ‰flannel.1çš„</p><p>åˆ¤æ–­è¿™äº›é•œåƒæ²¡æœ‰ï¼Œæ˜¯ä¸æ˜¯å› ä¸ºé•œåƒæ²¡æœ‰æ‹‰å–åˆ°çš„åŸå› ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@vm-26-23 ~]# docker images -a</span><br><span class="line">REPOSITORY                                TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">[root@vm-26-23 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                                  COMMAND                  CREATED             STATUS                  PORTS</span><br><span class="line">[root@vm-26-23 ~]# ps -aux|grep kube</span><br><span class="line">root      9612  2.9  0.2 1906264 91656 ?       Ssl  Aug04  26:06 &#x2F;usr&#x2F;bin&#x2F;kubelet --bootstrap-kubeconfig&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;bootstrap-kubelet.conf --kubeconfig&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;kubelet.conf --config&#x3D;&#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;config.yaml --cgroup-driver&#x3D;cgroupfs --hostname-override&#x3D;172.31.26.23 --network-plugin&#x3D;cni --pod-infra-container-image&#x3D;gcr.azk8s.cn&#x2F;google_containers&#x2F;pause:3.1 --root-dir&#x3D;&#x2F;var&#x2F;libkubelet</span><br><span class="line">root     20955  0.2  0.0 1321452 32100 ?       Ssl  Aug04   2:18 </span><br><span class="line">root     28066  0.0  0.0 112708   976 pts&#x2F;0    S+   10:58   0:00 grep --color&#x3D;auto kube</span><br><span class="line">[root@VM-26-23 ~]# ip add</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1&#x2F;128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link&#x2F;ether 00:50:56:99:fb:23 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.31.22.17&#x2F;24 brd 172.31.22.255 scope global noprefixroute ens192</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::f6b6:1049:1ed5:1321&#x2F;64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link&#x2F;ether 02:42:f3:fb:d1:c2 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1&#x2F;16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼Œå‘ç°æŠ¥é”™æœç„¶æ‹‰ä¸äº†è¿™äº›NodeèŠ‚ç‚¹çš„é•œåƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@vm-26-23 ~]# tail -f &#x2F;var&#x2F;log&#x2F;messages</span><br><span class="line">Aug  4 20:28:22 VM-26-23 dockerd: time&#x3D;&quot;2020-08-04T20:28:22.778469318+08:00&quot; level&#x3D;error msg&#x3D;&quot;Handler for POST &#x2F;images&#x2F;create returned error: error parsing HTTP 403 response body: invalid character &#39;&lt;&#39; looking for beginning of value: \&quot;&lt;html&gt;\\r\\n&lt;head&gt;&lt;title&gt;403 Forbidden&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;\\r\\n&lt;body bgcolor&#x3D;\\\&quot;white\\\&quot;&gt;\\r\\n&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;\\r\\n&lt;hr&gt;&lt;center&gt;nginx&#x2F;1.14.0 (Ubuntu)&lt;&#x2F;center&gt;\\r\\n&lt;&#x2F;body&gt;\\r\\n&lt;&#x2F;html&gt;\\r\\n\&quot;&quot;</span><br><span class="line">Aug  4 20:28:22 VM-26-23 kubelet: E0804 20:28:22.780471    9612 remote_runtime.go:105] RunPodSandbox from runtime service failed: rpc error: code &#x3D; Unknown desc &#x3D; failed pulling image &quot;gcr.azk8s.cn&#x2F;google_containers&#x2F;pause:3.1&quot;: Error response from daemon: error parsing HTTP 403 response body: invalid character &#39;&lt;&#39; looking for beginning of value: &quot;&lt;html&gt;\r\n&lt;head&gt;&lt;title&gt;403 Forbidden&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;\r\n&lt;body bgcolor&#x3D;\&quot;white\&quot;&gt;\r\n&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;\r\n&lt;hr&gt;&lt;center&gt;nginx&#x2F;1.14.0 (Ubuntu)&lt;&#x2F;center&gt;\r\n&lt;&#x2F;body&gt;\r\n&lt;&#x2F;html&gt;\r\n&quot;</span><br><span class="line">Aug  4 20:28:22 VM-26-23 kubelet: E0804 20:28:22.780581    9612 kuberuntime_sandbox.go:68] CreatePodSandbox for pod &quot;kube-proxy-75rvp_kube-system(646f319e-af39-4d97-a6ac-f5046dedda24)&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; failed pulling image &quot;gcr.azk8s.cn&#x2F;google_containers&#x2F;pause:3.1&quot;: Error response from daemon: error parsing HTTP 403 response body: invalid character &#39;&lt;&#39; looking for beginning of value: &quot;&lt;html&gt;\r\n&lt;head&gt;&lt;title&gt;403 Forbidden&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;\r\n&lt;body bgcolor&#x3D;\&quot;white\&quot;&gt;\r\n&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;\r\n&lt;hr&gt;&lt;center&gt;nginx&#x2F;1.14.0 (Ubuntu)&lt;&#x2F;center&gt;\r\n&lt;&#x2F;body&gt;\r\n&lt;&#x2F;html&gt;\r\n&quot;</span><br><span class="line">Aug  4 20:28:22 VM-26-23 kubelet: E0804 20:28:22.780654    9612 kuberuntime_manager.go:692] createPodSandbox for pod &quot;kube-proxy-75rvp_kube-system(646f319e-af39-4d97-a6ac-f5046dedda24)&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; failed pulling image &quot;gcr.azk8s.cn&#x2F;google_containers&#x2F;pause:3.1&quot;: Error response from daemon: error parsing HTTP 403 response body: invalid character &#39;&lt;&#39; looking for beginning of value: &quot;&lt;html&gt;\r\n&lt;head&gt;&lt;title&gt;403 Forbidden&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;\r\n&lt;body bgcolor&#x3D;\&quot;white\&quot;&gt;\r\n&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;\r\n&lt;hr&gt;&lt;center&gt;nginx&#x2F;1.14.0 (Ubuntu)&lt;&#x2F;center&gt;\r\n&lt;&#x2F;body&gt;\r\n&lt;&#x2F;html&gt;\r\n&quot;</span><br><span class="line">Aug  4 20:28:22 VM-26-23 kubelet: E0804 20:28:22.780777    9612 pod_workers.go:190] Error syncing pod 646f319e-af39-4d97-a6ac-f5046dedda24 (&quot;kube-proxy-75rvp_kube-system(646f319e-af39-4d97-a6ac-f5046dedda24)&quot;), skipping: failed to &quot;CreatePodSandbox&quot; for &quot;kube-proxy-75rvp_kube-system(646f319e-af39-4d97-a6ac-f5046dedda24)&quot; with CreatePodSandboxError: &quot;CreatePodSandbox for pod \&quot;kube-proxy-75rvp_kube-system(646f319e-af39-4d97-a6ac-f5046dedda24)\&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; failed pulling image \&quot;gcr.azk8s.cn&#x2F;google_containers&#x2F;pause:3.1\&quot;: Error response from daemon: error parsing HTTP 403 response body: invalid character &#39;&lt;&#39; looking for beginning of value: \&quot;&lt;html&gt;\\r\\n&lt;head&gt;&lt;title&gt;403 Forbidden&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;\\r\\n&lt;body bgcolor&#x3D;\\\&quot;white\\\&quot;&gt;\\r\\n&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;\\r\\n&lt;hr&gt;&lt;center&gt;nginx&#x2F;1.14.0 (Ubuntu)&lt;&#x2F;center&gt;\\r\\n&lt;&#x2F;body&gt;\\r\\n&lt;&#x2F;html&gt;\\r\\n\&quot;&quot;</span><br><span class="line">Aug  4 20:28:25 VM-26-23 kubelet: E0804 20:28:25.338166    9612 kubelet.go:2173] Container runtime network not ready: NetworkReady&#x3D;false reason:NetworkPluginNotReady message:docker: network plugin is not ready: cni config uninitialized</span><br><span class="line">Aug  4 20:28:25 VM-26-23 kubelet: W0804 20:28:25.931418    9612 cni.go:213] Unable to update cni config: No networks found in &#x2F;etc&#x2F;cni&#x2F;net.d</span><br><span class="line">Aug  4 20:28:30 VM-26-23 kubelet: E0804 20:28:30.364407    9612 kubelet.go:2173] Container runtime network not ready: NetworkReady&#x3D;false reason:NetworkPluginNotReady message:docker: network plugin is not ready: cni config uninitialized</span><br><span class="line">Aug  4 20:28:30 VM-26-23 kubelet: W0804 20:28:30.932040    9612 cni.go:213] Unable to update cni config: No networks found in &#x2F;etc&#x2F;cni&#x2F;net.d</span><br><span class="line">Aug  4 20:28:32 VM-26-23 kubelet: E0804 20:28:32.649344    9612 aws_credentials.go:77] while getting AWS credentials NoCredentialProviders: no valid providers in chain. Deprecated.</span><br><span class="line">Aug  4 20:28:32 VM-26-23 kubelet: For verbose messaging see aws.Config.CredentialsChainVerboseErrors</span><br><span class="line">Aug  4 20:28:32 VM-26-23 dockerd: time&#x3D;&quot;2020-08-04T20:28:32.827430989+08:00&quot; level&#x3D;info msg&#x3D;&quot;Attempting next endpoint for pull after error: error parsing HTTP 403 response body: invalid character &#39;&lt;&#39; looking for beginning of value: \&quot;&lt;html&gt;\\r\\n&lt;head&gt;&lt;title&gt;403 Forbidden&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;\\r\\n&lt;body bgcolor&#x3D;\\\&quot;white\\\&quot;&gt;\\r\\n&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;\\r\\n&lt;hr&gt;&lt;center&gt;nginx&#x2F;1.14.0 (Ubuntu)&lt;&#x2F;center&gt;\\r\\n&lt;&#x2F;body&gt;\\r\\n&lt;&#x2F;html&gt;\\r\\n\&quot;&quot;</span><br><span class="line">Aug  4 20:28:32 VM-26-23 kubelet: E0804 20:28:32.828824    9612 remote_runtime.go:105] RunPodSandbox from runtime service failed: rpc error: code &#x3D; Unknown desc &#x3D; failed pulling image &quot;gcr.azk8s.cn&#x2F;google_containers&#x2F;pause:3.1&quot;: Error response from daemon: error parsing HTTP 403 response body: invalid character &#39;&lt;&#39; looking for beginning of value: &quot;&lt;html&gt;\r\n&lt;head&gt;&lt;title&gt;403 Forbidden&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;\r\n&lt;body bgcolor&#x3D;\&quot;white\&quot;&gt;\r\n&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;\r\n&lt;hr&gt;&lt;center&gt;nginx&#x2F;1.14.0 (Ubuntu)&lt;&#x2F;center&gt;\r\n&lt;&#x2F;body&gt;\r\n&lt;&#x2F;html&gt;\r\n&quot;</span><br><span class="line">Aug  4 20:28:32 VM-26-23 dockerd: time&#x3D;&quot;2020-08-04T20:28:32.827650596+08:00&quot; level&#x3D;error msg&#x3D;&quot;Handler for POST &#x2F;images&#x2F;create returned error: error parsing HTTP 403 response body: invalid character &#39;&lt;&#39; looking for beginning of value: \&quot;&lt;html&gt;\\r\\n&lt;head&gt;&lt;title&gt;403 Forbidden&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;\\r\\n&lt;body bgcolor&#x3D;\\\&quot;white\\\&quot;&gt;\\r\\n&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;\\r\\n&lt;hr&gt;&lt;center&gt;nginx&#x2F;1.14.0 (Ubuntu)&lt;&#x2F;center&gt;\\r\\n&lt;&#x2F;body&gt;\\r\\n&lt;&#x2F;html&gt;\\r\\n\&quot;&quot;</span><br><span class="line">Aug  4 20:28:32 VM-26-23 kubelet: E0804 20:28:32.828990    9612 kuberuntime_sandbox.go:68] CreatePodSandbox for pod &quot;kube-flannel-ds-amd64-rtcnv_kube-system(e5ddc865-e0c2-4c9e-ad52-c854168ab26b)&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; failed pulling image &quot;gcr.azk8s.cn&#x2F;google_containers&#x2F;pause:3.1&quot;: Error response from daemon: error parsing HTTP 403 response body: invalid character &#39;&lt;&#39; looking for beginning of value: &quot;&lt;html&gt;\r\n&lt;head&gt;&lt;title&gt;403 Forbidden&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;\r\n&lt;body bgcolor&#x3D;\&quot;white\&quot;&gt;\r\n&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;\r\n&lt;hr&gt;&lt;center&gt;nginx&#x2F;1.14.0 (Ubuntu)&lt;&#x2F;center&gt;\r\n&lt;&#x2F;body&gt;\r\n&lt;&#x2F;html&gt;\r\n&quot;</span><br><span class="line">Aug  4 20:28:32 VM-26-23 kubelet: E0804 20:28:32.829060    9612 kuberuntime_manager.go:692] createPodSandbox for pod &quot;kube-flannel-ds-amd64-rtcnv_kube-system(e5ddc865-e0c2-4c9e-ad52-c854168ab26b)&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; failed pulling image &quot;gcr.azk8s.cn&#x2F;google_containers&#x2F;pause:3.1&quot;: Error response from daemon: error parsing HTTP 403 response body: invalid character &#39;&lt;&#39; looking for beginning of value: &quot;&lt;html&gt;\r\n&lt;head&gt;&lt;title&gt;403 Forbidden&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;\r\n&lt;body bgcolor&#x3D;\&quot;white\&quot;&gt;\r\n&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;\r\n&lt;hr&gt;&lt;center&gt;nginx&#x2F;1.14.0 (Ubuntu)&lt;&#x2F;center&gt;\r\n&lt;&#x2F;body&gt;\r\n&lt;&#x2F;html&gt;\r\n&quot;</span><br><span class="line">Aug  4 20:28:32 VM-26-23 kubelet: E0804 20:28:32.829218    9612 pod_workers.go:190] Error syncing pod e5ddc865-e0c2-4c9e-ad52-c854168ab26b (&quot;kube-flannel-ds-amd64-rtcnv_kube-system(e5ddc865-e0c2-4c9e-ad52-c854168ab26b)&quot;), skipping: failed to &quot;CreatePodSandbox&quot; for &quot;kube-flannel-ds-amd64-rtcnv_kube-system(e5ddc865-e0c2-4c9e-ad52-c854168ab26b)&quot; with CreatePodSandboxError: &quot;CreatePodSandbox for pod \&quot;kube-flannel-ds-amd64-rtcnv_kube-system(e5ddc865-e0c2-4c9e-ad52-c854168ab26b)\&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; failed pulling image \&quot;gcr.azk8s.cn&#x2F;google_containers&#x2F;pause:3.1\&quot;: Error response from daemon: error parsing HTTP 403 response body: invalid character &#39;&lt;&#39; looking for beginning of value: \&quot;&lt;html&gt;\\r\\n&lt;head&gt;&lt;title&gt;403 Forbidden&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;\\r\\n&lt;body bgcolor&#x3D;\\\&quot;white\\\&quot;&gt;\\r\\n&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;\\r\\n&lt;hr&gt;&lt;center&gt;nginx&#x2F;1.14.0 (Ubuntu)&lt;&#x2F;center&gt;\\r\\n&lt;&#x2F;body&gt;\\r\\n&lt;&#x2F;html&gt;\\r\\n\&quot;&quot;</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•</p><ul><li>ç›´æ¥ä»å…¶ä»–nodeèŠ‚ç‚¹å·²æœ‰çš„é•œåƒå¯¼å…¥åˆ°è¿™å°æ–°çš„nodeèŠ‚ç‚¹ä¸Š</li></ul><p>ä¸»è¦æ˜¯è¿™4ä¸ªé•œåƒï¼Œç‰ˆæœ¬å·æ ¹æ®å®é™…çš„æƒ…å†µè€Œå˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcr.azk8s.cn&#x2F;google_containers&#x2F;kube-proxy                              v1.15.5             cbd7f21fec99        9 months ago        82.4MB</span><br><span class="line">quay.azk8s.cn&#x2F;kubernetes-ingress-controller&#x2F;nginx-ingress-controller   0.26.1              29024c9c6e70        10 months ago       483MB</span><br><span class="line">quay.azk8s.cn&#x2F;coreos&#x2F;flannel                                           v0.11.0-amd64       ff281650a721        18 months ago       52.6MB</span><br><span class="line">gcr.azk8s.cn&#x2F;google_containers&#x2F;pause                                   3.1                 da86e6ba6ca1        2 years ago         742kB</span><br></pre></td></tr></table></figure><p>è¿›å…¥ä¸€å°nodeèŠ‚ç‚¹ï¼Œå¯¼å‡ºé•œåƒï¼Œå¹¶scpåˆ°å…¶ä»–æœºå™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@vm-26-19 ~]# docker save -o flannel.tar.gz quay.azk8s.cn&#x2F;coreos&#x2F;flannel:v0.11.0-amd64</span><br><span class="line">[root@vm-26-19 ~]# docker save -o  pause.tar.gz gcr.azk8s.cn&#x2F;google_containers&#x2F;pause:3.1</span><br><span class="line">[root@vm-26-19 ~]# docker save -o  kube-proxy.tar gcr.azk8s.cn&#x2F;google_containers&#x2F;kube-proxy:v1.15.5</span><br><span class="line">[root@vm-26-19 ~]# docker save -o  nginx-ingress-controller.tar  quay.azk8s.cn&#x2F;kubernetes-ingress-controller&#x2F;nginx-ingress-controller:0.26.1</span><br><span class="line">[root@VM-26-19 ~]# ll</span><br><span class="line">total 613372</span><br><span class="line">-rw-------. 1 root root      1549 Nov 25  2019 anaconda-ks.cfg</span><br><span class="line">-rw-------  1 root root  55390720 Aug  4 20:33 flannel.tar.gz</span><br><span class="line">-rw-------  1 root root  84286464 Aug  4 20:39 kube-proxy.tar</span><br><span class="line">-rw-------  1 root root 487647744 Aug  4 20:41 nginx-ingress-controller.tar</span><br><span class="line">-rw-------  1 root root    754176 Aug  4 20:37 pause.tar.gz</span><br><span class="line"></span><br><span class="line">[root@vm-26-19 ~]# scp * 172.31.26.23:&#x2F;root&#x2F;</span><br></pre></td></tr></table></figure><p>å†è¿›å…¥æ–°èŠ‚ç‚¹ï¼Œå¯¼å…¥é•œåƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@vm-26-23 ~]# docker load &lt;  flannel.tar.gz</span><br><span class="line">[root@vm-26-23 ~]# docker load &lt;  kube-proxy.tar</span><br><span class="line">[root@vm-26-23 ~]# docker load &lt;  nginx-ingress-controller.tar</span><br><span class="line">[root@vm-26-23 ~]# docker load &lt;  pause.tar.gz</span><br></pre></td></tr></table></figure><p>ç”±äºç³»ç»Ÿåœ¨ä¸æ–­å°è¯•å»æ‹‰å–é•œåƒï¼Œæ‰€ä»¥å¯¼å…¥æˆåŠŸåç³»ç»Ÿä¼šç›´æ¥runè¿™äº›é•œåƒï¼Œå³å¯å®Œæˆåç»­åŠ å…¥é›†ç¾¤çš„å‘½ä»¤ã€‚</p><ul><li>è‡ªå·±ä»ç½‘ä¸Šä¸‹è½½ï¼ˆç§‘å­¦ä¸Šç½‘ï¼‰æ‹‰é•œåƒï¼Œç„¶åä¸Šä¼ åˆ°è¿™å°æ–°çš„nodeèŠ‚ç‚¹ä¸Šï¼ˆè¿™é‡Œä¸ä½œè¯´æ˜ï¼‰</li></ul><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://choerodon.io/zh/docs/installation-configuration/steps/kubernetes/" target="_blank" rel="noopener">Kubernetesé›†ç¾¤éƒ¨ç½²</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ansible </tag>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ŠSREï¼šGoogleè¿ç»´è§£å¯†ã€‹è¯»ä¹¦å¿ƒå¾—(ä¸€)â€”â€”SREä»‹ç»åŠæ–¹æ³•è®º</title>
      <link href="/2020/07/12/sre/google-sre-1/"/>
      <url>/2020/07/12/sre/google-sre-1/</url>
      
        <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æœ€è¿‘æ”¶è·äº†ä¸€æœ¬è¿ç»´ç¥ä¹¦ã€ŠSREï¼šGoogleè¿ç»´è§£å¯†ã€‹ï¼Œç®€ç›´ç¥çš„ä¸èƒ½å†ç¥ï¼Œå¦‚æœå…³æ³¨å›½å¤–æŠ€æœ¯çš„åº”è¯¥èƒ½æ¥è§¦ç”šè‡³ä½“éªŒåˆ°è¿™ç§è¿™æœ¬ä¹¦çš„æ‰€è®²æ€æƒ³ã€‚</p><p>è¯ä¸å¤šè¯´ï¼Œä»æœ¬ç¯‡å¼€å§‹åšç¬”è®°ã€‚</p><h1 id="SREåºè¨€"><a href="#SREåºè¨€" class="headerlink" title="SREåºè¨€"></a>SREåºè¨€</h1><p>å¦‚æœè½¯ä»¶å·¥ç¨‹å¸ˆä¸»è¦ä¸“æ³¨äºè®¾è®¡å’Œæ„å»ºè½¯ä»¶ç³»ç»Ÿï¼Œé‚£ä¹ˆåº”è¯¥æœ‰å¦å¤–ä¸€ç§ç›´æ¥ä¸“æ³¨äºæ•´ä¸ªè½¯ä»¶ç³»ç»Ÿçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ä»å…¶è®¾è®¡ä¸€ç›´åˆ°éƒ¨ç½²ï¼Œå†ç»ä¸æ–­æ›´æ–°ï¼Œæœ€åé¡ºåˆ©é€€å½¹ã€‚</p><p>è¿™æ ·ä¸€ç§èŒä¸šå¿…é¡»å…·å¤‡éå¸¸å¹¿æ³›çš„æŠ€èƒ½ï¼Œä½†æ˜¯å’Œå…¶ä»–èŒä¸šçš„ä¸“æ³¨ç‚¹éƒ½ä¸åŒã€‚</p><p>Googleå°†è¿™ä¸ªèŒä½æˆä¸ºç«™ç‚¹å¯é æ€§å·¥ç¨‹å¸ˆ</p><p>SREï¼šSite Reliability Engineering </p><h1 id="SREä»‹ç»"><a href="#SREä»‹ç»" class="headerlink" title="SREä»‹ç»"></a>SREä»‹ç»</h1><p>ä¸èƒ½å°†ç¢°è¿æ°”å½“æˆæˆ˜ç•¥ æ˜¯SREçš„è‡³ç†åè¨€ã€‚</p><h2 id="ç³»ç»Ÿç®¡ç†å‘˜æ¨¡å¼"><a href="#ç³»ç»Ÿç®¡ç†å‘˜æ¨¡å¼" class="headerlink" title="ç³»ç»Ÿç®¡ç†å‘˜æ¨¡å¼"></a>ç³»ç»Ÿç®¡ç†å‘˜æ¨¡å¼</h2><p>ç³»ç»Ÿç®¡ç†å‘˜è¿ç»´å¤æ‚çš„è®¡ç®—æœºç³»ç»Ÿï¼Œä½†æ˜¯è°·æ­Œå¾ˆæ—©å°±çœ‹å‡ºäº†è¿™ç§è¿ç»´å·¥ç¨‹å¸ˆçš„ç¼ºé™·ã€‚</p><ul><li><p>ç›´æ¥æˆæœ¬ï¼šéšç€ç³»ç»Ÿå¤æ‚åº¦çš„å¢åŠ ï¼Œéƒ¨ç½²è§„æ¨¡çš„æ‰©å¤§ï¼Œå›¢é˜Ÿçš„å¤§å°åŸºæœ¬ä¸ç³»ç»Ÿè´Ÿè½½æˆçº¿æ€§ç›¸å…³ï¼Œå…±åŒå¢é•¿</p></li><li><p>é—´æ¥æˆæœ¬ï¼šç ”å‘å›¢é˜Ÿå’Œè¿ç»´å›¢é˜ŸèƒŒæ™¯å„å¼‚ï¼ŒæŠ€æœ¯èƒ½åŠ›ä¸å·¥å…·ä½¿ç”¨ä¹ æƒ¯å·®è·å·¨å¤§ï¼Œå·¥ä½œç›®æ ‡ä¹Ÿæˆªç„¶ä¸åŒï¼Œå¯¹äº§å“çš„å¯é ç¨‹åº¦è¦æ±‚ç†è§£ä¸åŒï¼Œå…·ä½“æ‰§è¡Œç§å¯¹æŸé¡¹æ“ä½œçš„å±é™©ç¨‹åº¦è¯„ä¼°ä¸å¯èƒ½æŠ€æœ¯é˜²èŒƒæªæ–½ä¹Ÿæœ‰æˆªç„¶ä¸åŒçš„ç†è§£ã€‚</p></li></ul><p>è¿™äº›ç»†èŠ‚åˆ†æ­§åŠå·¥ä½œé‡ç´¯è®¡èµ·æ¥ï¼Œæœ€åå¯èƒ½æ¼”å˜æˆç›®æ ‡ä¸æ–¹å‘ä¸Šçš„åˆ†æ­§åŠå½¢æˆå†…éƒ¨æ²Ÿé€šé—®é¢˜ï¼Œç”šè‡³æœ€åä¸Šå‡åˆ°éƒ¨é—¨ä¹‹é—´çš„ä¿¡ä»»ä¸å°Šé‡å±‚é¢ã€‚</p><h2 id="Googleçš„è§£å†³ä¹‹é“ï¼šSRE"><a href="#Googleçš„è§£å†³ä¹‹é“ï¼šSRE" class="headerlink" title="Googleçš„è§£å†³ä¹‹é“ï¼šSRE"></a>Googleçš„è§£å†³ä¹‹é“ï¼šSRE</h2><p>SREå›¢é˜Ÿçš„ç»„æˆï¼š</p><ul><li>ç¬¬ä¸€ç±»ï¼Œå›¢é˜Ÿä¸­50%-60%æ˜¯æ ‡å‡†çš„è½¯ä»¶å·¥ç¨‹å¸ˆ</li><li>ç¬¬äºŒç±»ï¼Œå›¢é˜Ÿä¸­40%-50%æ˜¯åŸºæœ¬æ»¡è¶³è½¯ä»¶å·¥ç¨‹å¸ˆçš„æ ‡å‡†(å…·å¤‡85%-99%æ‰€æœ‰è¦æ±‚çš„èƒ½åŠ›)ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€å®šç¨‹åº¦å…¶ä»–æŠ€æœ¯èƒ½åŠ›çš„å·¥ç¨‹å¸ˆã€‚ç›®å‰æ¥çœ‹Googleæœ€çœ‹é‡çš„å°±æ˜¯UNIXç³»ç»Ÿå†…éƒ¨ç»†èŠ‚å’Œ1-3å±‚ç½‘ç»œçŸ¥è¯†ã€‚</li></ul><p>SREå›¢é˜Ÿæˆå‘˜çš„ç‰¹ç‚¹ï¼š</p><ul><li>å¯¹é‡å¤æ€§ã€æ‰‹å·¥æ€§çš„æ“ä½œæœ‰å¤©ç„¶çš„æ’æ–¥æ„Ÿ</li><li>æœ‰è¶³å¤Ÿçš„æŠ€æœ¯èƒ½åŠ›å¿«é€Ÿå¼€å‘å‡ºè½¯ä»¶ç³»ç»Ÿä»¥æ›¿ä»£æ‰‹å·¥æ“ä½œ</li></ul><p>SREæ¨¡å‹çš„æˆåŠŸå…³é”®æ­£åœ¨ä¸å¯¹å·¥ç¨‹çš„å…³æ³¨ã€‚å¦‚æœæ²¡æœ‰æŒç»­çš„ã€å·¥ç¨‹åŒ–çš„è§£å†³æ–¹æ¡ˆï¼Œè¿ç»´å‹åŠ›å°±ä¼šä¸æ–­å¢åŠ ï¼Œå›¢é˜Ÿä¹Ÿå°±éœ€è¦æ›´å¤šäººæ¥æ‰‹å·¥å®Œæˆæ“ä½œã€‚</p><p>ä¸ºäº†é¿å…æ‰‹å·¥æ“ä½œï¼ŒSREå›¢é˜Ÿå¿…é¡»æœ‰è¶³å¤Ÿæ—¶é—´ç¼–ç¨‹ï¼Œå¦åˆ™ä»–ä»¬å°±ä¼šè¢«è¿ç»´å·¥ä½œæ‰€æ·¹æ²¡ã€‚</p><p>Googleçš„ç»éªŒæ³•åˆ™æ˜¯ï¼ŒSREå›¢é˜Ÿå¿…é¡»å°†50%çš„ç»å†èŠ±åœ¨çœŸå®çš„å¼€å‘å·¥ä½œä¸Šï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼ŒSREå›¢é˜Ÿåº”è¯¥å€¾å‘äºå°†åŸºæœ¬çš„è¿ç»´å·¥ä½œå…¨éƒ¨æ¶ˆé™¤æ‰ï¼Œæ¨åŠ¨æ•´ä¸ªç³»ç»Ÿè¶‹äºæ— äººåŒ–è¿è¡Œï¼Œè€Œä¸ä»…ä»…æ˜¯è‡ªåŠ¨åŒ–æŸäº›äººå·¥æµç¨‹ã€‚</p><h2 id="Devopsè¿˜æ˜¯SREï¼Ÿ"><a href="#Devopsè¿˜æ˜¯SREï¼Ÿ" class="headerlink" title="Devopsè¿˜æ˜¯SREï¼Ÿ"></a>Devopsè¿˜æ˜¯SREï¼Ÿ</h2><p>Devopsæ˜¯SREæ ¸å¿ƒç†å¿µçš„æ™®é€‚ç‰ˆï¼Œå¼€æºç”¨äºæ›´å¹¿èŒƒå›´å†…çš„ç»„ç»‡æ¶æ„ã€ç®¡ç†ç»“æ„å’Œäººå‘˜å®‰æ’ã€‚åŒæ—¶SREæ˜¯Devopsæ¨¡å‹åœ¨Googleçš„å…·ä½“å®è·µï¼Œå¸¦æœ‰ä¸€äº›ç‰¹åˆ«çš„æ‰©å±•ã€‚</p><h1 id="SREæ–¹æ³•è®º"><a href="#SREæ–¹æ³•è®º" class="headerlink" title="SREæ–¹æ³•è®º"></a>SREæ–¹æ³•è®º</h1><p>èŒè´£ï¼š</p><ul><li>å¯ç”¨æ€§æ”¹è¿›</li><li>å»¶è¿Ÿä¼˜åŒ–</li><li>æ€§èƒ½ä¼˜åŒ–</li><li>æ•ˆç‡ä¼˜åŒ–</li><li>å˜æ›´ç®¡ç†</li><li>ç›‘æ§</li><li>ç´§æ€¥äº‹åŠ¡å¤„ç†</li><li>å®¹é‡è§„åˆ’ä¸ç®¡ç†</li></ul><h2 id="ç¡®ä¿é•¿æœŸå…³æ³¨ç ”å‘å·¥ä½œ"><a href="#ç¡®ä¿é•¿æœŸå…³æ³¨ç ”å‘å·¥ä½œ" class="headerlink" title="ç¡®ä¿é•¿æœŸå…³æ³¨ç ”å‘å·¥ä½œ"></a>ç¡®ä¿é•¿æœŸå…³æ³¨ç ”å‘å·¥ä½œ</h2><p>50%æ—¥å¸¸è¿ç»´ 50%ç ”å‘é¡¹ç›®</p><p>æ¯8-12ä¸ªå€¼ç­æ—¶é—´æœ€å¤šå¤„ç†2ä¸ªç´§æ€¥é—®é¢˜ï¼Œè¿™ä¸ªå‡†æµ‹ä¿è¯äº†SREæœ‰è¶³å¤Ÿæ—¶é—´è·Ÿè¿›ç´§æ€¥äº‹ä»¶ï¼Œå¤„ç†æ•…éšœã€æ¢å¤æœåŠ¡ã€æ’°å†™äº‹æ•…æŠ¥å‘Šã€‚</p><p>å¦‚æœä¸€ä¸ªäº§å“äº‹æ•…æ²¡æœ‰è§¦å‘æŠ¥è­¦ï¼Œé‚£ä¹ˆäº‹åæ€»ç»“çš„æ„ä¹‰æ›´å¤§ï¼šå®ƒå°†æ­éœ²ç›‘æ§ç³»ç»Ÿçš„æ¼æ´ã€‚</p><p>äº‹åæ€»ç»“åŒ…æ‹¬ï¼šäº‹æ•…å‘ç”Ÿã€å‘ç°ã€è§£å†³çš„å…¨è¿‡ç¨‹</p><p>äº‹æ•…çš„æ ¹æœ¬åŸå› ï¼šé¢„é˜²æˆ–è€…ä¼˜åŒ–çš„è§£å†³æ–¹æ¡ˆ</p><h2 id="åœ¨ä¿éšœæœåŠ¡çš„å‰æä¸‹æœ€å¤§åŒ–è¿­ä»£é€Ÿåº¦"><a href="#åœ¨ä¿éšœæœåŠ¡çš„å‰æä¸‹æœ€å¤§åŒ–è¿­ä»£é€Ÿåº¦" class="headerlink" title="åœ¨ä¿éšœæœåŠ¡çš„å‰æä¸‹æœ€å¤§åŒ–è¿­ä»£é€Ÿåº¦"></a>åœ¨ä¿éšœæœåŠ¡çš„å‰æä¸‹æœ€å¤§åŒ–è¿­ä»£é€Ÿåº¦</h2><p>ä»»ä½•äº§å“éƒ½ä¸æ˜¯ï¼Œä¹Ÿä¸åº”è¯¥åšåˆ°100%å¯é ï¼Œå°±ç´ æŒ‰æˆ‘ä»¬èŠ±è´¹å·¨å¤§ç²¾åŠ›å°†ç³»ç»Ÿå˜æˆ100%å¯é ä¹Ÿä¸èƒ½ç»™ç”¨æˆ·å¸¦æ¥ä»»ä½•å®è´¨æ„ä¹‰çš„å¥½å¤„ã€‚</p><p>å¦‚æœ100%ä¸æ˜¯ä¸€ä¸ªæ­£ç¡®çš„å¯é æ€§ç›®æ ‡ï¼Œé‚£ä¹ˆå¤šå°‘æ‰æ˜¯å‘¢ï¼Ÿ</p><p>è¿™å…¶å®ä¸æ˜¯ä¸€ä¸ªæŠ€æœ¯é—®é¢˜ï¼Œè€Œæ˜¯ä¸€ä¸ªäº§å“é—®é¢˜ï¼š</p><ul><li>åŸºäºç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯ï¼ŒæœåŠ¡å¯é æ€§è¾¾åˆ°ä»€ä¹ˆç¨‹åº¦æ‰ä¼šæ»¡æ„ï¼Ÿ</li><li>å¦‚æœè¿™ä¸ªæœåŠ¡å¯é æ€§ä¸å¤Ÿï¼Œç”¨æˆ·æ˜¯å¦æœ‰å…¶ä»–çš„é€‰æ‹©ï¼Ÿ</li><li>æœåŠ¡çš„å¯é æ€§æ˜¯å¦ä¼šå½±å“ç”¨æˆ·å¯¹è¿™é¡¹æœåŠ¡çš„ä½¿ç”¨æ¨¡å¼ï¼Ÿ</li></ul><p>SREçš„ç›®æ ‡ä¸å†æ˜¯â€œé›¶äº‹æ•…è¿è¡Œâ€ï¼Œéœ€è¦å’Œäº§å“ç ”å‘å›¢é˜Ÿç›®æ ‡ä¸€è‡´ï¼Œéƒ½æ˜¯åœ¨ä¿éšœä¸šåŠ¡æœåŠ¡å¯é æ€§éœ€æ±‚çš„åŒæ—¶å°½å¯èƒ½åœ°åŠ å¿«åŠŸèƒ½çš„ä¸Šçº¿é€Ÿåº¦ï¼Œè¯´ç™½å°±æ˜¯æ»¡è¶³å³å¯åŸåˆ™ã€‚</p><h2 id="ç›‘æ§ç³»ç»Ÿ"><a href="#ç›‘æ§ç³»ç»Ÿ" class="headerlink" title="ç›‘æ§ç³»ç»Ÿ"></a>ç›‘æ§ç³»ç»Ÿ</h2><p>ç›‘æ§ç³»ç»Ÿä¸åº”è¯¥ä¾èµ–äººæ¥åˆ†ææŠ¥è­¦ä¿¡æ¯ï¼Œè€Œæ˜¯ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†æï¼Œä»…å½“éœ€è¦ç”¨æˆ·æ‰§è¡ŒæŸç§æ“ä½œæ—¶æ‰éœ€è¦é€šçŸ¥ç”¨æˆ·ã€‚</p><p>ä¸€ä¸ªç›‘æ§ç³»ç»Ÿçš„è¾“å‡ºåªåº”è¯¥æœ‰ä¸‰ç±»ï¼š</p><ul><li>ç´§æ€¥è­¦æŠ¥ï¼šå¿…é¡»äººå·¥ç«‹åˆ»æ‰§è¡Œï¼Œå¦åˆ™å°†ä¼šå‡ºäº‹æ•…</li><li>å·¥å•ï¼šç³»ç»Ÿä¸èƒ½è‡ªåŠ¨æ‰§è¡Œï¼Œåªè¦äººå·¥åœ¨å‡ å¤©å†…è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç³»ç»Ÿå°±ä¸ä¼šå—åˆ°ä»»ä½•å½±å“</li><li>æ—¥å¿—ï¼šè®°å½•è‡ªåŠ¨åŒ–æ‰§è¡Œçš„è®°å½•ï¼Œå¹¶æ”¹è¿›</li></ul><h2 id="åº”æ€¥äº‹ä»¶å¤„ç†"><a href="#åº”æ€¥äº‹ä»¶å¤„ç†" class="headerlink" title="åº”æ€¥äº‹ä»¶å¤„ç†"></a>åº”æ€¥äº‹ä»¶å¤„ç†</h2><p>å¯é æ€§æ˜¯MTTF(å¹³å‡å¤±è´¥æ—¶é—´)å’ŒMTTR(å¹³å‡æ¢å¤æ—¶é—´)çš„å‡½æ•°ã€‚è¯„ä»·ä¸€ä¸ªå›¢é˜Ÿå°†ç³»ç»Ÿæ¢å¤åˆ°æ­£å¸¸æƒ…å†µçš„æœ€æœ‰æ•ˆçš„æŒ‡æ ‡å°±æ˜¯MTTRã€‚</p><p>ä»»ä½•éœ€è¦äººå·¥æ“ä½œçš„äº‹æƒ…éƒ½åªä¼šå»¶é•¿æ¢å¤æ—¶é—´ã€‚</p><p>ä¸ºæ­¤ï¼Œä½ åªèƒ½å°†å®ƒè¶‹å‘è‡ªåŠ¨åŒ–å¤„ç†æ‰èƒ½æ›´å¿«å“åº”åº”æ€¥äº‹ä»¶ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æé«˜å“åº”çš„æ–¹æ³•ã€‚</p><ul><li>è®°å½•å¤„ç†è¿‡ç¨‹åŠè®°å½•åˆ°è¿ç»´æ‰‹å†Œä¸­ï¼Œæ–¹ä¾¿ä¸‹æ¬¡å‡ºç°é—®é¢˜æ—¶å¿«é€Ÿæ‰¾åˆ°è§£å†³é—®é¢˜çš„æ€è·¯</li><li>å°†è§£å†³é—®é¢˜çš„æ€è·¯è½¬å˜æˆè‡ªåŠ¨åŒ–å¤„ç†</li></ul><p>å½“ç„¶ç¬¬äºŒç§æ–¹æ³•æ›´éš¾ï¼Œåœ¨æ²¡æœ‰è¾¾åˆ°ç¬¬äºŒç§ç›®çš„çš„æƒ…å†µä¸‹ï¼Œè®°å½•åˆ°è¿ç»´æ‰‹å†Œæ˜¯ä½ å¿…é¡»ä¹Ÿæ˜¯æœ€å¿«æœ€ç®€å•åœ°æé«˜æ•ˆç‡çš„æ–¹æ³•ã€‚</p><h2 id="å˜æ›´ç®¡ç†"><a href="#å˜æ›´ç®¡ç†" class="headerlink" title="å˜æ›´ç®¡ç†"></a>å˜æ›´ç®¡ç†</h2><p>SREçš„ç»éªŒè¯´æ˜70%çš„ç”Ÿäº§äº‹æ•…ç”±æŸç§éƒ¨ç½²çš„å˜æ›´è€Œè§¦å‘ã€‚è€Œå¯¹å˜æ›´ç®¡ç†çš„æœ€ä½³å®è·µæ˜¯ä½¿ç”¨è‡ªåŠ¨åŒ–å®Œæˆä»¥ä¸‹å‡ ä¸ªç›®æ ‡ï¼š</p><ul><li>æ¸è¿›å¼å‘å¸ƒæœºåˆ¶(æ»šåŠ¨æ›´æ–°)</li><li>è¿…é€Ÿè€Œå‡†ç¡®åœ°æ£€æµ‹é—®é¢˜çš„å‘ç”Ÿ</li><li>å‡ºç°é—®é¢˜æ—¶ï¼Œèƒ½å®‰å…¨è¿…é€Ÿåœ°å›é€€</li></ul><p>è¿™ä¸‰ç‚¹å¯ä»¥æœ‰æ•ˆå¥–åŠ±å˜æ›´ç»™SREå’Œæœ€ç»ˆç”¨æˆ·å¸¦æ¥çš„å®è·µæˆæœ¬å’ŒæœåŠ¡è´¨é‡çš„ä¸‹é™ã€‚</p><h2 id="éœ€æ±‚é¢„æµ‹å’Œå®¹é‡è§„åˆ’"><a href="#éœ€æ±‚é¢„æµ‹å’Œå®¹é‡è§„åˆ’" class="headerlink" title="éœ€æ±‚é¢„æµ‹å’Œå®¹é‡è§„åˆ’"></a>éœ€æ±‚é¢„æµ‹å’Œå®¹é‡è§„åˆ’</h2><p>éœ€æ±‚é¢„æµ‹å’Œå®¹é‡è§„åˆ’å¿…é¡»è¦ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li>é¢„æµ‹æ¨¡å‹ï¼šå¿…é¡»æœ‰ä¸€ä¸ªå‡†ç¡®çš„è‡ªç„¶å¢é•¿éœ€æ±‚é¢„æµ‹æ¨¡å‹ï¼Œéœ€æ±‚é¢„æµ‹çš„å®è·µåº”è¯¥è¶…è¿‡èµ„æºè·å–çš„æ—¶é—´ã€‚</li><li>å®é™…æ•°æ®ï¼šè§„åˆ’ä¸­å¿…é¡»æœ‰å‡†ç¡®çš„éè‡ªç„¶å¢é•¿çš„éœ€æ±‚æ¥æºç»Ÿè®¡ã€‚</li><li>å‹åŠ›æµ‹è¯•ï¼šå¿…é¡»è¦æœ‰å‘¨æœŸæ€§çš„å‹åŠ›æµ‹è¯•ï¼Œä»¥ä¾¿å‡†ç¡®åœ°å°†ç³»ç»Ÿçš„åŸå§‹èµ„æºä¸ä¸šåŠ¡å®¹é‡å¯¹åº”èµ·æ¥ã€‚</li></ul><h2 id="æ•ˆç‡ä¸æ€§èƒ½"><a href="#æ•ˆç‡ä¸æ€§èƒ½" class="headerlink" title="æ•ˆç‡ä¸æ€§èƒ½"></a>æ•ˆç‡ä¸æ€§èƒ½</h2><p>å¦‚æœèƒ½å¯†åˆ‡åœ°å…³æ³¨ä¸€ä¸ªæœåŠ¡å™¨çš„å®¹é‡é…ç½®ç­–ç•¥ï¼Œè¿›è€Œæ”¹è¿›å…¶èµ„æºåˆ©ç”¨ç‡ï¼Œè¿™å¯ä»¥éå¸¸æœ‰æ•ˆåœ°é™ä½ç³»ç»Ÿçš„æ€»æˆæœ¬ã€‚</p><p>ä¸€ä¸ªä¸šåŠ¡çš„æ€»ä½“èµ„æºä½¿ç”¨æƒ…å†µå¯ä»¥ç”±ä»¥ä¸‹å‡ ä¸ªå› ç´ é©±åŠ¨ï¼š</p><ul><li>ç”¨æˆ·éœ€æ±‚(æµé‡)</li><li>å¯ç”¨å®¹é‡</li><li>èµ„æºä½¿ç”¨æ•ˆç‡</li></ul><p>SREé€šè¿‡æ¨¡å‹é¢„æµ‹ç”¨æˆ·éœ€æ±‚ï¼Œåˆç†éƒ¨ç½²å’Œé…ç½®å¯ç”¨å®¹é‡</p><p>SREå’Œäº§å“ç ”å‘å›¢é˜Ÿåº”è¯¥å…±åŒç›‘æ§å’Œä¼˜åŒ–æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ï¼Œè¿™å°±ç›¸å½“äºç»™æœåŠ¡å¢åŠ å®¹é‡å’Œæå‡æ•ˆç‡äº†</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å–è‡ªã€ŠSREï¼šGoogleè¿ç»´è§£å¯†ã€‹å‰10é¡µï¼Œæ€»ç»“å½’çº³çš„å¿ƒå¾—ã€‚</p><p>ä¸€æœ¬å¥½ä¹¦ï¼Œè®¤çœŸè¯»å®Œ10é¡µä½ å°±å·²ç»çŸ¥é“åœ¨å’Œè¯´æ˜æ ·çš„äººæ‰“äº¤é“äº†ã€‚</p><p>å¥½ä¹¦ä¸æ€•è¯»çš„æ™šï¼Œå°±æ€•æ˜çŸ¥é“è¯»çš„æ™šä»ç„¶è¿˜ä¸å»è¯»ã€‚</p><p>ç¥è¯»è€…èƒ½æ—©æ—¥æ‰¾åˆ°å¿ƒç›®ä¸­çš„å¥½ä¹¦ï¼</p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Sre </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Sre </tag>
            
            <tag> Google </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¡ºåºã€ç›‘æ§åœ°å‘å¸ƒé¡¹ç›®è„šæœ¬</title>
      <link href="/2020/07/12/script/k8s-upgrade/"/>
      <url>/2020/07/12/script/k8s-upgrade/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>æ­¤è„šæœ¬è§£å†³å¤šé¡¹ç›®é¡ºåºæ‰¹é‡å‘å¸ƒå¹¶è‡ªå¸¦ç›‘æ§ï¼Œé¡¹ç›®ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œå¦‚æœå­˜åœ¨é¡¹ç›®å‘å¸ƒå¤±è´¥åˆ™ç»ˆæ­¢æ•´ä¸ªå‘å¸ƒæµç¨‹ï¼Œåä¹‹åˆ™ä¸€æ¡å‘½ä»¤æå®šæ•´ä¸ªK8Så‘å¸ƒ</p><p>ç”±äºæœ¬äººpythonä¸æ˜¯ç‰¹åˆ«ç²¾é€š(è‡ªå­¦ä¸€æ®µæ—¶é—´å°±å¼€å§‹ç”¨äº†ï¼Œæ²¡æœ‰å•¥é«˜å¤§ä¸Šçš„ç®—æ³•é€»è¾‘ç­‰ç­‰ï¼Œå†™çš„ä¹Ÿä¸æ˜¯ç‰¹åˆ«è§„èŒƒï¼Œå¸Œæœ›çœ‹åˆ°çš„å¤šäº›æŒ‡ç‚¹ï¼Œå°‘äº›å˜²ç¬‘)</p><p><a href="https://github.com/chenyu1st/Automation-script/tree/master/K8S%E8%87%AA%E5%8A%A8%E5%8F%91%E5%B8%83" target="_blank" rel="noopener">æºç åœ°å€</a></p><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>ä½¿ç”¨python2.7 å³linuxè‡ªå¸¦pythonç‰ˆæœ¬</p><p>éœ€è¦æ›´æ”¹å¯¹åº”k8séƒ¨ç½²æ–‡ä»¶çš„yamlè·¯å¾„(å›ºå®šä¸‹æ¥ï¼Œä¸€åŠ³æ°¸é€¸)åŠæ–°ç‰ˆæœ¬é•œåƒå·(æ¯æ¬¡éƒ½éœ€è¦æ”¹)</p><h1 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h1><p>ä¾‹å¦‚ï¼š</p><p>python k8s-deploy.py   nginx  mysql </p><p>å°±ä¼šå…ˆæ›´æ–°nginxã€å†æ›´æ–°mysql</p><p>å¦‚æœngixnæ›´æ–°å¤±è´¥ï¼Œåˆ™ä¸æ›´æ–°mysql</p><h1 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h1>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">#coding:utf-8</span><br><span class="line"># @Author  : chenyu</span><br><span class="line"># @Time    : 2020&#x2F;5&#x2F;18 10:21</span><br><span class="line"># @Blog    : rugod.cn</span><br><span class="line">import  os</span><br><span class="line">import  sys</span><br><span class="line">from datetime import datetime</span><br><span class="line">import time</span><br><span class="line">from collections import Counter </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def pods_upgrade_success(project):</span><br><span class="line">     global kubectl_get_pods</span><br><span class="line">     kubectl_images&#x3D;[]</span><br><span class="line">     #æŸ¥çœ‹æ‰€æœ‰pods-id</span><br><span class="line">     kubectl_get_pods&#x3D;os.popen(&quot;kubectl get pods |grep %s|awk &#39;&#123;print $1&#125;&#39;&quot;%project).read().split()</span><br><span class="line">     for a in kubectl_get_pods:</span><br><span class="line">           #æŸ¥çœ‹æ¯ä¸ªå®¹å™¨çš„é•œåƒå·</span><br><span class="line">           kubectl_describe_cmd&#x3D;os.popen(&quot;kubectl describe pods %s |sed -n &#39;&#x2F;Image:&#x2F;p&#39; |awk &#39;&#123;print $2&#125;&#39;|cut -d &#39;:&#39; -f2&quot;%a).read().split()</span><br><span class="line">           if kubectl_describe_cmd:                  </span><br><span class="line">                    kubectl_images.append(kubectl_describe_cmd[0])</span><br><span class="line">     print Counter(kubectl_images)</span><br><span class="line">     time.sleep(10) </span><br><span class="line">     return len(set(kubectl_images))</span><br><span class="line">#æŸ¥çœ‹æ»šåŠ¨æ›´æ–°å®Œæˆæ—¶é—´å†…æ—¥å¿—</span><br><span class="line">def pods_health(time_process,id):</span><br><span class="line">     kubectl_log_cmd&#x3D;os.popen(&quot;kubectl logs --since&#x3D;%s   %s&quot;%(time_process,id)).read()</span><br><span class="line">     if &quot;JVM running&quot; in kubectl_log_cmd:</span><br><span class="line">         print(&quot;%s å®¹å™¨å¯åŠ¨æ­£å¸¸&quot;%(id))</span><br><span class="line">         return &quot;yes&quot;</span><br><span class="line">     else:</span><br><span class="line">         print(&quot;%s å®¹å™¨å¯åŠ¨å¼‚å¸¸&quot;%(id))</span><br><span class="line">         return &quot;no&quot;</span><br><span class="line"></span><br><span class="line">def deploy(project):</span><br><span class="line">    while True:</span><br><span class="line">       if pods_upgrade_success(project)&#x3D;&#x3D;1:</span><br><span class="line">         #æŸ¥çœ‹é¡¹ç›®æ»šåŠ¨æ›´æ–°æ˜¯å¦å®Œæˆ</span><br><span class="line">          kubectl_rollout_status&#x3D;os.popen(&quot;kubectl rollout status deployment %s --watch&#x3D;false | grep -ic waiting1&quot;%project).read()</span><br><span class="line">          if kubectl_rollout_status.strip()&#x3D;&#x3D;&quot;0&quot;:</span><br><span class="line">              time_end&#x3D;datetime.now()# è·å¾—å½“å‰æ—¶é—´æˆ³</span><br><span class="line">              time_process&#x3D;str((time_end-time_begin).seconds)+&quot;s&quot;   #å°†æ—¶é—´æˆ³è½¬æ¢æˆç§’</span><br><span class="line">              num_error&#x3D;0</span><br><span class="line">              print(&quot;å‘å¸ƒæ—¶é—´ä¸º%s,å¼€å§‹åˆ†ææ—¥å¿—&quot;%(time_process))</span><br><span class="line">              for i in kubectl_get_pods:</span><br><span class="line">                   if  pods_health(time_process, i)&#x3D;&#x3D;&quot;no&quot;:</span><br><span class="line">                       num_error&#x3D;num_error+1</span><br><span class="line">          if num_error&#x3D;&#x3D;0:</span><br><span class="line">                  print(&quot;%sæ›´æ–°æˆåŠŸ&quot;%(project))</span><br><span class="line">                  return 1</span><br><span class="line">          else:</span><br><span class="line">                  time_max_end&#x3D;datetime.now()</span><br><span class="line">                  time_max_begin_end&#x3D;(time_max_end-time_begin).seconds</span><br><span class="line">                  if time_max_begin_end&lt;&#x3D;600:</span><br><span class="line">                          print(&quot;%sæ›´æ–°å¼‚å¸¸,ä¸€å…±æœ‰%sä¸ªå®¹å™¨æ›´æ–°å¼‚å¸¸,å¼€å§‹é‡è¯•------&quot;%(project,num_error))</span><br><span class="line">                  else:</span><br><span class="line">                          print(&quot;éƒ½10åˆ†é’Ÿäº†ï¼Œè¿˜æ²¡å‘å®Œï¼Œå’‹å›äº‹å•Š&quot;)</span><br><span class="line">                          break</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def upgrade(project):</span><br><span class="line">     os.system(&#39;kubectl apply -f &#x2F;opt&#x2F;service&#x2F;%s&#x2F;prod-deploy.yaml&#39; %project)</span><br><span class="line">     print &quot;å¼€å§‹æ»šåŠ¨å‘å¸ƒ&quot;+project+&quot;é¡¹ç›®&quot;</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">     if len(sys.argv)&#x3D;&#x3D;1:</span><br><span class="line">         sys.exit(0)</span><br><span class="line">     print(&quot;ä¸»å‡½æ•°å¼€å§‹æ‰§è¡Œ&quot;)</span><br><span class="line">     print(&quot;å½“å‰æ—¶é—´ä¸º&quot;+time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;))</span><br><span class="line">     succ&#x3D;[]</span><br><span class="line">     for i in sys.argv:</span><br><span class="line">         if i !&#x3D;&#39;k8s-deploy.py&#39; :</span><br><span class="line">              time_begin &#x3D; datetime.now() #è·å¾—å½“å‰æ—¶é—´æˆ³</span><br><span class="line">              upgrade(i) </span><br><span class="line">              time.sleep(5)</span><br><span class="line">              if deploy(i)&#x3D;&#x3D;1:</span><br><span class="line">                    print &quot;ç¨ç­‰ç‰‡åˆ»ï¼Œä¼‘æ¯ä¸€ä¸‹&quot; </span><br><span class="line">                    time.sleep(5) </span><br><span class="line">                    succ.append(i)</span><br><span class="line">              else:</span><br><span class="line">                    print (&quot;%sé¡¹ç›®å‘å¸ƒå¤±è´¥ï¼Œç»ˆæ­¢æ•´ä¸ªå‘å¸ƒ&quot;%(i))</span><br><span class="line">                    break</span><br><span class="line">     if len(succ)+1&#x3D;&#x3D;len(sys.argv):</span><br><span class="line">            print &quot;å·²ç»å…¨éƒ¨å‘å¸ƒå®Œæˆ&quot;       </span><br><span class="line">     else:</span><br><span class="line">            print &quot;æœªå®Œå…¨å‘å¸ƒ,å·²ç»å‘å¸ƒæˆåŠŸçš„é¡¹ç›®ä¸º:&quot;</span><br><span class="line">            print succ</span><br></pre></td></tr></table></figure><h1 id="è‡ªåŠ¨å‘å¸ƒ"><a href="#è‡ªåŠ¨å‘å¸ƒ" class="headerlink" title="è‡ªåŠ¨å‘å¸ƒ"></a>è‡ªåŠ¨å‘å¸ƒ</h1><p>ä¸»è¦å°±æ˜¯4ä¸ªå‡½æ•°</p><ul><li>def pods_upgrade_success(project)<br>æŸ¥çœ‹å®¹å™¨æ˜¯å¦æ»šåŠ¨æ›´æ–°æˆåŠŸï¼Œå·²é•œåƒå·å”¯ä¸€æ¥åˆ¤æ–­</li></ul><p>æ¯”å¦‚å½“å‰é•œåƒç‰ˆæœ¬ä¸º1.0 æ»šåŠ¨æ›´æ–°çš„ç‰ˆæœ¬ä¸º1.1</p><p>é‚£ä¹ˆåœ¨k8sæ›´æ–°å®¹å™¨çš„æ—¶å€™å°±ä¼šå­˜åœ¨å¤šä¸ªé•œåƒå·ï¼Œå°†é•œåƒå·çš„å€¼æ·»åŠ åˆ°åˆ—è¡¨é‡Œï¼Œç„¶åset()å»é‡,å¦‚æœåªæœ‰ä¸€ä¸ªé•œåƒå·è¯´æ˜æ»šåŠ¨æ›´æ–°æˆåŠŸ</p><p>ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿå¼•ç”¨äº†Counter() ä¸€ä¸ªè®¡æ•°å™¨å·¥å…·æä¾›å¿«é€Ÿå’Œæ–¹ä¾¿çš„è®¡æ•°ï¼Œä½ å°±å¯ä»¥è½»æ¾çš„çœ‹åˆ°æ‰“å°å‡ºæ¥çš„é•œåƒå·çš„ä¸ªæ•°äº†</p><p>æ¯”å¦‚4ä¸ªå®¹å™¨éƒ½æ˜¯1.0 ä½ è¦æ›´æ–°åˆ°1.1</p><p>é‚£ä¹ˆæ‰“å°å‡ºæ¥çš„æ•ˆæœå°±æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;1.0&#39;:4,&#39;1.1&#39;:1&#125;</span><br><span class="line">&#123;&#39;1.0&#39;:3,&#39;1.1&#39;:2&#125;</span><br><span class="line">------é€æ¸åˆ°</span><br><span class="line">&#123;&#39;1.1&#39;:4,&#39;1.0&#39;:1&#125;</span><br><span class="line">&#123;&#39;1.1&#39;:4&#125;</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æ¥è¯´åªè¦é•œåƒå·èƒ½å¢é•¿ï¼Œé‚£å°±è¯´æ˜æ–°ä»£ç èƒ½è·‘èµ·æ¥äº†</p><p>å½“ç„¶ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥åæœŸç»§ç»­æ”¹è¿›ï¼Œæ¯”å¦‚ä¸€æ®µæ—¶é—´å¦‚æœæ–°é•œåƒå·çš„å®¹å™¨æ•°é‡ä¸ä¸Šå‡åˆ™ç›´æ¥æ‰“å°é¢„è­¦ä¿¡æ¯ç­‰ç­‰</p><ul><li>def pods_health(time_process,id) </li></ul><p>æŸ¥çœ‹æ»šåŠ¨æ›´æ–°å®Œæˆæ—¶é—´å†…æ—¥å¿—æ˜¯å¦å«æŠ¥é”™æˆ–å¯åŠ¨æˆåŠŸç­‰å…³é”®å­—ï¼Œ(å’Œå¼€å‘äººå‘˜æ²Ÿé€šçš„æ•ˆæœå°±æ˜¯åªè¦jvm runningäº†å°±è¡Œäº†ï¼Œå…¶ä»–çš„æŠ¥é”™å±äºä¸šåŠ¡ä¸Šé¢æŠ¥é”™ï¼Œä¸åœ¨å’Œè¿ç»´æœ‰å…³ï¼Œå˜»å˜»)</p><p>æ¯ä¸ªäººçš„æ ‡å‡†ä¸ä¸€æ ·ï¼Œå¯ä»¥é…Œæƒ…ä¿®æ”¹</p><p>æ£€æŸ¥æ­£å¸¸è¿”å›yes</p><ul><li>def deploy(project)</li></ul><p>è®¡ç®— å¼€å§‹è°ƒç”¨ä¸»å‡½æ•°åˆ°æ­¤å‡½æ•°çš„è§¦å‘ çš„ç´¯è®¡æ—¶é—´ï¼Œæ‹¿åˆ°ç°æœ‰çš„å®¹å™¨idï¼Œå¾ªç¯æ‰§è¡Œpods_health(time_process,id) </p><p>æŸ¥çœ‹æ¯ä¸ªå®¹å™¨æ˜¯å¦éƒ½å‡ºç°å…³é”®å­—(åˆ¤æ–­æˆåŠŸä¸å¦çš„æ ‡å‡†)ï¼Œé€šè¿‡pods_healthè¿”å›å€¼åšåˆ¤æ–­</p><p>æ—¥å¿—åˆ†ææ­£å¸¸è¿”å›1</p><ul><li>def upgrade(project)</li></ul><p>æ‰§è¡Œkubectl applyå‘½ä»¤  éœ€è¦æ›´æ”¹yamlæ–‡ä»¶åœ°å€</p><ul><li>if <strong>name</strong> == â€œ<strong>main</strong>â€œ<br>   å¾ªç¯è°ƒç”¨ä»¥ä¸‹å‡½æ•°å¹¶å°†æˆåŠŸçš„ä¸ªæ•°è®¡æ•°<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">upgrade(project)  </span><br><span class="line">if deploy(i)&#x3D;&#x3D;1:</span><br><span class="line">   print &quot;ç¨ç­‰ç‰‡åˆ»ï¼Œä¼‘æ¯ä¸€ä¸‹&quot; </span><br><span class="line">   time.sleep(5) </span><br><span class="line">   succ.append(i)</span><br><span class="line">else:</span><br><span class="line">   print (&quot;%sé¡¹ç›®å‘å¸ƒå¤±è´¥ï¼Œç»ˆæ­¢æ•´ä¸ªå‘å¸ƒ&quot;%(i))</span><br><span class="line">   break</span><br></pre></td></tr></table></figure>   åˆ¤æ–­æˆåŠŸçš„è®¡æ•°é‡æ˜¯å¦ç­‰äºè¾“å…¥æ—¶çš„é¡¹ç›®çš„ä¸ªæ•°ï¼Œç­‰äºåˆ™è¯´æ˜æ¯ä¸ªé¡¹ç›®éƒ½ä¾æ¬¡å‘å¸ƒå®Œæˆ</li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>é€»è¾‘è¿˜æ˜¯è¾ƒä¸ºç®€å•çš„</p><ul><li><p>æ‰§è¡Œæ›´æ–°å‘½ä»¤</p></li><li><p>æ£€æŸ¥æ˜¯å¦æ›´æ–°æˆåŠŸ(æ—¥å¿—å…³é”®å­—æ‘˜å–åˆ†æ)</p></li><li><p>è¿”å›ç»“æœé€šè¿‡åç»§ç»­æ›´æ–°</p></li><li><p>ç»Ÿè®¡æ•´ä¸ªå‘å¸ƒæ•°é‡</p></li></ul><h1 id="æ”¹è¿›"><a href="#æ”¹è¿›" class="headerlink" title="æ”¹è¿›"></a>æ”¹è¿›</h1><p>ç”±äºå¾®æœåŠ¡å…³ç³»æ¯”è¾ƒç´§å‡‘ï¼Œä¸€ä¸ªåº”ç”¨æœåŠ¡çš„æ›´æ–°å®¹æ˜“è¢«è°ƒç”¨æ–¹æ‰€ä¾èµ–ï¼Œåˆ™å¦‚æœæ­¤é¡¹ç›®å‘å¸ƒå¤±è´¥ä¸åœæ­¢ï¼Œå‘å¸ƒåé¢çš„é¡¹ç›®ä¼šå‡ºç°é“¾å¼é›ªå´©ååº”ã€‚</p><ul><li>å›é€€</li></ul><p>å½“ç„¶è¿™ä¸ªè„šæœ¬æ²¡æœ‰å†™å›é€€çš„åŠŸèƒ½æ˜¯å› ä¸ºç”Ÿäº§ç¯å¢ƒå‡ºé—®é¢˜ï¼Œä¸€èˆ¬å¾—å¼€å‘äººå‘˜å…ˆå®šä½æŠ¥é”™ï¼Œç„¶ååˆ†æï¼Œå†æŠ•äº§ã€‚ç›®å‰æ¯æ¬¡å‡ºé—®é¢˜éƒ½å¾—è®©å¼€å‘äººå‘˜è¿‡æ¥çœ‹æŠ¥é”™ã€‚</p><p>å®šä½æŠ¥é”™è¿™ç‚¹æˆ‘æƒ³äº†ä¸€ä¸‹æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥å°†æ›´æ–°æ—¶é—´å†…æ‰€æœ‰å®¹å™¨çš„æ—¥å¿—éƒ½æ‹‰å–å‡ºæ¥ç»™å¼€å‘äººå‘˜çœ‹ï¼Œç„¶åå…ˆè®©é¡¹ç›®å›é€€</p><ul><li>ä¿®æ”¹é•œåƒå·</li></ul><p>ç›®å‰æ›´æ”¹é•œåƒå·éœ€è¦äººå·¥å»é…ç½®æ–‡ä»¶æ›´æ”¹ï¼Œç”±äºç”Ÿäº§ç¯å¢ƒå’Œçº¿ä¸‹åˆ†ç¦»ï¼Œåªèƒ½é€šè¿‡çº¿ä¸‹å»ä¼ é€é•œåƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Œæ— æ³•åšåˆ°åœ¨æ¨é€é•œåƒçš„é‚£ä¸€æ­¥å°±åŠ å…¥è¿™ä¸ªè„šæœ¬ï¼Œä¸çŸ¥é“æœ‰å•¥åŠæ³•</p><ul><li>å‘Šè­¦</li></ul><p>åæœŸåšåˆ°æ›´è‡ªåŠ¨åŒ–åœ°ç¨‹åº¦ï¼Œå¦‚æœå‘å¸ƒå¤±è´¥å°±å‘é‚®ä»¶å‘Šè­¦ï¼Œä¸éœ€è¦äººå·¥å»çœ‹æ—¥å¿—æ˜¯å¦æ›´æ–°æˆåŠŸç­‰ç­‰</p><p>å¦‚æœæœ‰ä»€ä¹ˆå»ºè®®å¸Œæœ›å¯ä»¥ç•™è¨€<del>~</del></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Script </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªåŠ¨åŒ– </tag>
            
            <tag> Python </tag>
            
            <tag> Script </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kuberneteså…¥é—¨ç¯‡(äºŒ)â€”â€”Kubernetesç»„ä»¶ä»‹ç»</title>
      <link href="/2020/07/08/kubernetes/Kubernetes-introduction-2/"/>
      <url>/2020/07/08/kubernetes/Kubernetes-introduction-2/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="Kubernetes-ç»„ä»¶"><a href="#Kubernetes-ç»„ä»¶" class="headerlink" title="Kubernetes ç»„ä»¶"></a>Kubernetes ç»„ä»¶</h1><p>å½“ä½ éƒ¨ç½²å®Œ Kubernetes, å³æ‹¥æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„é›†ç¾¤ã€‚</p><p>ä¸€ä¸ª Kubernetes é›†ç¾¤åŒ…å« é›†ç¾¤ç”±ä¸€ç»„è¢«ç§°ä½œèŠ‚ç‚¹çš„æœºå™¨ç»„æˆã€‚è¿™äº›èŠ‚ç‚¹ä¸Šè¿è¡Œ Kubernetes æ‰€ç®¡ç†çš„å®¹å™¨åŒ–åº”ç”¨ã€‚é›†ç¾¤å…·æœ‰è‡³å°‘ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹å’Œè‡³å°‘ä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚</p><p>å·¥ä½œèŠ‚ç‚¹æ‰˜ç®¡ä½œä¸ºåº”ç”¨ç¨‹åºç»„ä»¶çš„ Pod ã€‚ä¸»èŠ‚ç‚¹ç®¡ç†é›†ç¾¤ä¸­çš„å·¥ä½œèŠ‚ç‚¹å’Œ Pod ã€‚å¤šä¸ªä¸»èŠ‚ç‚¹ç”¨äºä¸ºé›†ç¾¤æä¾›æ•…éšœè½¬ç§»å’Œé«˜å¯ç”¨æ€§ã€‚</p><p>æœ¬æ–‡æ¡£æ¦‚è¿°äº†äº¤ä»˜æ­£å¸¸è¿è¡Œçš„ Kubernetes é›†ç¾¤æ‰€éœ€çš„å„ç§ç»„ä»¶ã€‚</p><p>è¿™å¼ å›¾è¡¨å±•ç¤ºäº†åŒ…å«æ‰€æœ‰ç›¸äº’å…³è”ç»„ä»¶çš„ Kubernetes é›†ç¾¤ã€‚</p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Kubernetes/kubernetes-components.jpg"  alt="kubernetes-components.jpg"></p><h1 id="æ§åˆ¶å¹³é¢èŠ‚ç‚¹-åˆç§°MasterèŠ‚ç‚¹"><a href="#æ§åˆ¶å¹³é¢èŠ‚ç‚¹-åˆç§°MasterèŠ‚ç‚¹" class="headerlink" title="æ§åˆ¶å¹³é¢èŠ‚ç‚¹(åˆç§°MasterèŠ‚ç‚¹)"></a>æ§åˆ¶å¹³é¢èŠ‚ç‚¹(åˆç§°MasterèŠ‚ç‚¹)</h1><p>æ§åˆ¶å¹³é¢çš„ç»„ä»¶å¯¹é›†ç¾¤åšå‡ºå…¨å±€å†³ç­–(æ¯”å¦‚è°ƒåº¦)ï¼Œä»¥åŠæ£€æµ‹å’Œå“åº”é›†ç¾¤äº‹ä»¶ï¼ˆä¾‹å¦‚ï¼Œå½“ä¸æ»¡è¶³éƒ¨ç½²çš„ replicas å­—æ®µæ—¶ï¼Œå¯åŠ¨æ–°çš„ podï¼‰ã€‚</p><p>æ§åˆ¶å¹³é¢ç»„ä»¶å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„ä»»ä½•èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ç„¶è€Œï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œè®¾ç½®è„šæœ¬é€šå¸¸ä¼šåœ¨åŒä¸€ä¸ªè®¡ç®—æœºä¸Šå¯åŠ¨æ‰€æœ‰æ§åˆ¶å¹³é¢ç»„ä»¶ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨æ­¤è®¡ç®—æœºä¸Šè¿è¡Œç”¨æˆ·å®¹å™¨ã€‚</p><h2 id="kube-apiserver"><a href="#kube-apiserver" class="headerlink" title="kube-apiserver"></a>kube-apiserver</h2><p>ä¸»èŠ‚ç‚¹ä¸Šè´Ÿè´£æä¾› Kubernetes API æœåŠ¡çš„ç»„ä»¶ï¼›å®ƒæ˜¯ Kubernetes æ§åˆ¶é¢çš„æ¥å£ã€‚</p><p>kube-apiserver åœ¨è®¾è®¡ä¸Šè€ƒè™‘äº†æ°´å¹³æ‰©ç¼©çš„éœ€è¦ã€‚ æ¢è¨€ä¹‹ï¼Œé€šè¿‡éƒ¨ç½²å¤šä¸ªå®ä¾‹å¯ä»¥å®ç°æ‰©ç¼©ã€‚ </p><h2 id="etcd"><a href="#etcd" class="headerlink" title="etcd"></a>etcd</h2><p>etcd æ˜¯å…¼å…·ä¸€è‡´æ€§å’Œé«˜å¯ç”¨æ€§çš„é”®å€¼æ•°æ®åº“ï¼Œå¯ä»¥ä½œä¸ºä¿å­˜ Kubernetes æ‰€æœ‰é›†ç¾¤æ•°æ®çš„åå°æ•°æ®åº“ã€‚</p><p>æ‚¨çš„ Kubernetes é›†ç¾¤çš„ etcd æ•°æ®åº“é€šå¸¸éœ€è¦æœ‰ä¸ªå¤‡ä»½è®¡åˆ’ã€‚è¦äº†è§£ etcd æ›´æ·±å±‚æ¬¡çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ <a href="https://etcd.io/docs/" target="_blank" rel="noopener">etcd</a> æ–‡æ¡£ã€‚</p><h2 id="kube-scheduler"><a href="#kube-scheduler" class="headerlink" title="kube-scheduler"></a>kube-scheduler</h2><p>ä¸»èŠ‚ç‚¹ä¸Šçš„ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ç›‘è§†é‚£äº›æ–°åˆ›å»ºçš„æœªæŒ‡å®šè¿è¡ŒèŠ‚ç‚¹çš„ Podï¼Œå¹¶é€‰æ‹©èŠ‚ç‚¹è®© Pod åœ¨ä¸Šé¢è¿è¡Œã€‚</p><p>è°ƒåº¦å†³ç­–è€ƒè™‘çš„å› ç´ åŒ…æ‹¬å•ä¸ª Pod å’Œ Pod é›†åˆçš„èµ„æºéœ€æ±‚ã€ç¡¬ä»¶/è½¯ä»¶/ç­–ç•¥çº¦æŸã€äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„èŒƒã€æ•°æ®ä½ç½®ã€å·¥ä½œè´Ÿè½½é—´çš„å¹²æ‰°å’Œæœ€åæ—¶é™ã€‚</p><h2 id="kube-controller-manager"><a href="#kube-controller-manager" class="headerlink" title="kube-controller-manager"></a>kube-controller-manager</h2><p>åœ¨ä¸»èŠ‚ç‚¹ä¸Šè¿è¡Œæ§åˆ¶å™¨çš„ç»„ä»¶ã€‚</p><p>ä»é€»è¾‘ä¸Šè®²ï¼Œæ¯ä¸ªæ§åˆ¶å™¨éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ï¼Œä½†æ˜¯ä¸ºäº†é™ä½å¤æ‚æ€§ï¼Œå®ƒä»¬éƒ½è¢«ç¼–è¯‘åˆ°åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­è¿è¡Œã€‚</p><p>è¿™äº›æ§åˆ¶å™¨åŒ…æ‹¬:</p><ul><li>èŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆNode Controllerï¼‰: è´Ÿè´£åœ¨èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº”ã€‚</li><li>å‰¯æœ¬æ§åˆ¶å™¨ï¼ˆReplication Controllerï¼‰: è´Ÿè´£ä¸ºç³»ç»Ÿä¸­çš„æ¯ä¸ªå‰¯æœ¬æ§åˆ¶å™¨å¯¹è±¡ç»´æŠ¤æ­£ç¡®æ•°é‡çš„ Podã€‚</li><li>ç«¯ç‚¹æ§åˆ¶å™¨ï¼ˆEndpoints Controllerï¼‰: å¡«å……ç«¯ç‚¹(Endpoints)å¯¹è±¡(å³åŠ å…¥ Service ä¸ Pod)ã€‚</li><li>æœåŠ¡å¸æˆ·å’Œä»¤ç‰Œæ§åˆ¶å™¨ï¼ˆService Account &amp; Token Controllersï¼‰: ä¸ºæ–°çš„å‘½åç©ºé—´åˆ›å»ºé»˜è®¤å¸æˆ·å’Œ API è®¿é—®ä»¤ç‰Œ.</li></ul><h2 id="cloud-controller-manager"><a href="#cloud-controller-manager" class="headerlink" title="cloud-controller-manager"></a>cloud-controller-manager</h2><p>cloud-controller-manager è¿è¡Œä¸åŸºç¡€äº‘æä¾›å•†äº¤äº’çš„æ§åˆ¶å™¨ã€‚cloud-controller-manager äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯ Kubernetes 1.6 ç‰ˆæœ¬ä¸­å¼•å…¥çš„ alpha åŠŸèƒ½ã€‚</p><p>cloud-controller-manager ä»…è¿è¡Œäº‘æä¾›å•†ç‰¹å®šçš„æ§åˆ¶å™¨å¾ªç¯ã€‚æ‚¨å¿…é¡»åœ¨ kube-controller-manager ä¸­ç¦ç”¨è¿™äº›æ§åˆ¶å™¨å¾ªç¯ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨å¯åŠ¨ kube-controller-manager æ—¶å°† â€“cloud-provider å‚æ•°è®¾ç½®ä¸º external æ¥ç¦ç”¨æ§åˆ¶å™¨å¾ªç¯ã€‚</p><p>cloud-controller-manager å…è®¸äº‘ä¾›åº”å•†çš„ä»£ç å’Œ Kubernetes ä»£ç å½¼æ­¤ç‹¬ç«‹åœ°å‘å±•ã€‚åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæ ¸å¿ƒçš„ Kubernetes ä»£ç ä¾èµ–äºç‰¹å®šäº‘æä¾›å•†çš„ä»£ç æ¥å®ç°åŠŸèƒ½ã€‚åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­ï¼Œäº‘ä¾›åº”å•†ä¸“æœ‰çš„ä»£ç åº”ç”±äº‘ä¾›åº”å•†è‡ªå·±ç»´æŠ¤ï¼Œå¹¶ä¸è¿è¡Œ Kubernetes çš„äº‘æ§åˆ¶å™¨ç®¡ç†å™¨ç›¸å…³è”ã€‚</p><p>ä»¥ä¸‹æ§åˆ¶å™¨å…·æœ‰äº‘æä¾›å•†ä¾èµ–æ€§:</p><ul><li>èŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆNode Controllerï¼‰: ç”¨äºæ£€æŸ¥äº‘æä¾›å•†ä»¥ç¡®å®šèŠ‚ç‚¹æ˜¯å¦åœ¨äº‘ä¸­åœæ­¢å“åº”åè¢«åˆ é™¤</li><li>è·¯ç”±æ§åˆ¶å™¨ï¼ˆRoute Controllerï¼‰: ç”¨äºåœ¨åº•å±‚äº‘åŸºç¡€æ¶æ„ä¸­è®¾ç½®è·¯ç”±</li><li>æœåŠ¡æ§åˆ¶å™¨ï¼ˆService Controllerï¼‰: ç”¨äºåˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤äº‘æä¾›å•†è´Ÿè½½å‡è¡¡å™¨</li><li>æ•°æ®å·æ§åˆ¶å™¨ï¼ˆVolume Controllerï¼‰: ç”¨äºåˆ›å»ºã€é™„åŠ å’Œè£…è½½å·ã€å¹¶ä¸äº‘æä¾›å•†è¿›è¡Œäº¤äº’ä»¥ç¼–æ’å·</li></ul><h1 id="NodeèŠ‚ç‚¹"><a href="#NodeèŠ‚ç‚¹" class="headerlink" title="NodeèŠ‚ç‚¹"></a>NodeèŠ‚ç‚¹</h1><p>èŠ‚ç‚¹ç»„ä»¶åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œç»´æŠ¤è¿è¡Œçš„ Pod å¹¶æä¾› Kubernetes è¿è¡Œç¯å¢ƒã€‚</p><h2 id="kubelet"><a href="#kubelet" class="headerlink" title="kubelet"></a>kubelet</h2><p>ä¸€ä¸ªåœ¨é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ä»£ç†ã€‚å®ƒä¿è¯å®¹å™¨éƒ½è¿è¡Œåœ¨ Pod ä¸­ã€‚</p><p>kubelet æ¥æ”¶ä¸€ç»„é€šè¿‡å„ç±»æœºåˆ¶æä¾›ç»™å®ƒçš„ PodSpecsï¼Œç¡®ä¿è¿™äº› PodSpecs ä¸­æè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·ã€‚kubelet ä¸ä¼šç®¡ç†ä¸æ˜¯ç”± Kubernetes åˆ›å»ºçš„å®¹å™¨ã€‚</p><h2 id="kube-proxy"><a href="#kube-proxy" class="headerlink" title="kube-proxy"></a>kube-proxy</h2><p>kube-proxy æ˜¯é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ç½‘ç»œä»£ç†,å®ç° Kubernetes Service æ¦‚å¿µçš„ä¸€éƒ¨åˆ†ã€‚</p><p>kube-proxy ç»´æŠ¤èŠ‚ç‚¹ä¸Šçš„ç½‘ç»œè§„åˆ™ã€‚è¿™äº›ç½‘ç»œè§„åˆ™å…è®¸ä»é›†ç¾¤å†…éƒ¨æˆ–å¤–éƒ¨çš„ç½‘ç»œä¼šè¯ä¸ Pod è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚</p><p>å¦‚æœæ“ä½œç³»ç»Ÿæä¾›äº†æ•°æ®åŒ…è¿‡æ»¤å±‚å¹¶å¯ç”¨çš„è¯ï¼Œkube-proxyä¼šé€šè¿‡å®ƒæ¥å®ç°ç½‘ç»œè§„åˆ™ã€‚å¦åˆ™ï¼Œkube-proxy ä»…è½¬å‘æµé‡æœ¬èº«ã€‚</p><h2 id="å®¹å™¨è¿è¡Œç¯å¢ƒ-Container-Runtime"><a href="#å®¹å™¨è¿è¡Œç¯å¢ƒ-Container-Runtime" class="headerlink" title="å®¹å™¨è¿è¡Œç¯å¢ƒ(Container Runtime)"></a>å®¹å™¨è¿è¡Œç¯å¢ƒ(Container Runtime)</h2><p>å®¹å™¨è¿è¡Œç¯å¢ƒæ˜¯ Kubernetes v1.5 å¼•å…¥çš„å®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼Œå®ƒå°† Kubelet ä¸å®¹å™¨è¿è¡Œæ—¶è§£è€¦ï¼Œå°†åŸæ¥å®Œå…¨é¢å‘ Pod çº§åˆ«çš„å†…éƒ¨æ¥å£æ‹†åˆ†æˆé¢å‘ Sandbox å’Œ Container çš„ gRPC æ¥å£ï¼Œå¹¶å°†é•œåƒç®¡ç†å’Œå®¹å™¨ç®¡ç†åˆ†ç¦»åˆ°ä¸åŒçš„æœåŠ¡ã€‚</p><p>Kubernetes æ”¯æŒå¤šä¸ªå®¹å™¨è¿è¡Œç¯å¢ƒ: Dockerã€ containerdã€cri-oã€ rktlet ä»¥åŠä»»ä½•å®ç° Kubernetes CRI (å®¹å™¨è¿è¡Œç¯å¢ƒæ¥å£)ã€‚</p><h1 id="æ’ä»¶-Addons"><a href="#æ’ä»¶-Addons" class="headerlink" title="æ’ä»¶(Addons)"></a>æ’ä»¶(Addons)</h1><p>æ’ä»¶ä½¿ç”¨ Kubernetes èµ„æº (DaemonSet, Deploymentç­‰) å®ç°é›†ç¾¤åŠŸèƒ½ã€‚å› ä¸ºè¿™äº›æä¾›é›†ç¾¤çº§åˆ«çš„åŠŸèƒ½ï¼Œæ‰€ä»¥æ’ä»¶çš„å‘½åç©ºé—´èµ„æºå±äº kube-system å‘½åç©ºé—´ã€‚</p><p>æ‰€é€‰çš„æ’ä»¶å¦‚ä¸‹æ‰€è¿°ï¼šæœ‰å…³å¯ç”¨æ’ä»¶çš„æ‰©å±•åˆ—è¡¨ï¼Œè¯·å‚è§æ’ä»¶ (Addons)ã€‚</p><h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><p>å°½ç®¡å¹¶éä¸¥æ ¼è¦æ±‚å…¶ä»–é™„åŠ ç»„ä»¶ï¼Œä½†æ‰€æœ‰ç¤ºä¾‹éƒ½ä¾èµ–é›†ç¾¤ DNSï¼Œå› æ­¤æ‰€æœ‰ Kubernetes é›†ç¾¤éƒ½åº”å…·æœ‰ DNSã€‚</p><p>é™¤äº†æ‚¨ç¯å¢ƒä¸­çš„å…¶ä»– DNS æœåŠ¡å™¨ä¹‹å¤–ï¼Œé›†ç¾¤ DNS è¿˜æ˜¯ä¸€ä¸ª DNS æœåŠ¡å™¨ï¼Œå®ƒä¸º Kubernetes æœåŠ¡æä¾› DNS è®°å½•ã€‚</p><p>Cluster DNS æ˜¯ä¸€ä¸ª DNS æœåŠ¡å™¨ï¼Œå’Œæ‚¨éƒ¨ç½²ç¯å¢ƒä¸­çš„å…¶ä»– DNS æœåŠ¡å™¨ä¸€èµ·å·¥ä½œï¼Œä¸º Kubernetes æœåŠ¡æä¾›DNSè®°å½•ã€‚</p><p>Kubernetes å¯åŠ¨çš„å®¹å™¨è‡ªåŠ¨å°† DNS æœåŠ¡å™¨åŒ…å«åœ¨ DNS æœç´¢ä¸­ã€‚</p><h2 id="ç”¨æˆ·ç•Œé¢-Dashboard"><a href="#ç”¨æˆ·ç•Œé¢-Dashboard" class="headerlink" title="ç”¨æˆ·ç•Œé¢(Dashboard)"></a>ç”¨æˆ·ç•Œé¢(Dashboard)</h2><p>Dashboard æ˜¯ Kubernetes é›†ç¾¤çš„é€šç”¨åŸºäº Web çš„ UIã€‚å®ƒä½¿ç”¨æˆ·å¯ä»¥ç®¡ç†é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä»¥åŠé›†ç¾¤æœ¬èº«å¹¶è¿›è¡Œæ•…éšœæ’é™¤ã€‚</p><h2 id="å®¹å™¨èµ„æºç›‘æ§"><a href="#å®¹å™¨èµ„æºç›‘æ§" class="headerlink" title="å®¹å™¨èµ„æºç›‘æ§"></a>å®¹å™¨èµ„æºç›‘æ§</h2><p>å®¹å™¨èµ„æºç›‘æ§å°†å…³äºå®¹å™¨çš„ä¸€äº›å¸¸è§çš„æ—¶é—´åºåˆ—åº¦é‡å€¼ä¿å­˜åˆ°ä¸€ä¸ªé›†ä¸­çš„æ•°æ®åº“ä¸­ï¼Œå¹¶æä¾›ç”¨äºæµè§ˆè¿™äº›æ•°æ®çš„ç•Œé¢ã€‚</p><h2 id="é›†ç¾¤å±‚é¢æ—¥å¿—"><a href="#é›†ç¾¤å±‚é¢æ—¥å¿—" class="headerlink" title="é›†ç¾¤å±‚é¢æ—¥å¿—"></a>é›†ç¾¤å±‚é¢æ—¥å¿—</h2><p>é›†ç¾¤å±‚é¢æ—¥å¿— æœºåˆ¶è´Ÿè´£å°†å®¹å™¨çš„æ—¥å¿—æ•°æ®ä¿å­˜åˆ°ä¸€ä¸ªé›†ä¸­çš„æ—¥å¿—å­˜å‚¨ä¸­ï¼Œè¯¥å­˜å‚¨èƒ½å¤Ÿæä¾›æœç´¢å’Œæµè§ˆæ¥å£ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ€»ç»“ä¸€ä¸‹Kubernetesç»„ä»¶</p><p>MasterèŠ‚ç‚¹(è‡³å°‘ä¸€ä¸ª)æ‰€å«ç»„ä»¶</p><table><thead><tr><th>ç»„ä»¶</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>kube-apiserver</td><td>é›†ç¾¤æ¥å£</td></tr><tr><td>etcd</td><td>k-vå‹æ•°æ®åº“</td></tr><tr><td>kube-scheduler</td><td>æ•´ä¸ªé›†ç¾¤çš„èµ„æºè°ƒåº¦</td></tr><tr><td>kube-controller-manager</td><td>é›†ç¾¤å†…éƒ¨çš„ç®¡ç†æ§åˆ¶ä¸­å¿ƒ</td></tr><tr><td>cloud-controller-manager</td><td>äº‘ç®¡ç†æ§åˆ¶å™¨</td></tr></tbody></table><p>NodeèŠ‚ç‚¹(è‡³å°‘ä¸€ä¸ª)</p><table><thead><tr><th>ç»„ä»¶</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>kube-apiserver</td><td>é›†ç¾¤æ¥å£</td></tr><tr><td>etcd</td><td>k-vå‹æ•°æ®åº“</td></tr><tr><td>kube-scheduler</td><td>æ•´ä¸ªé›†ç¾¤çš„èµ„æºè°ƒåº¦</td></tr><tr><td>kube-controller-manager</td><td>é›†ç¾¤å†…éƒ¨çš„ç®¡ç†æ§åˆ¶ä¸­å¿ƒ</td></tr><tr><td>cloud-controller-manager</td><td>äº‘ç®¡ç†æ§åˆ¶å™¨</td></tr></tbody></table><p> API Serveræ˜¯etcdè®¿é—®çš„å”¯ä¸€å…¥å£ï¼Œåªæœ‰API Serveræ‰èƒ½è®¿é—®å’Œæ“ä½œetcdé›†ç¾¤ï¼›API Serverå¯¹å†…å’Œå¯¹å¤–éƒ½æä¾›äº†ç»Ÿä¸€çš„REST APIï¼Œå…¶ä»–ç»„ä»¶éƒ½æ˜¯é€šè¿‡API Serverè¿›è¡Œé€šä¿¡çš„</p><p>ç”¨æˆ·ä½¿ç”¨kubectlå‘½ä»¤æ¥è¯·æ±‚API Serveræ¥å£å®Œæˆç›¸åº”æ“ä½œ<br>Kuberneteså†…éƒ¨ç»„ä»¶éƒ½æ˜¯é€šè¿‡ä¸€ç§ç›‘å¬æœºåˆ¶å»ç›‘æ§API Serverä¸­çš„èµ„æºå˜åŒ–ï¼Œç„¶åå¯¹å…¶åšä¸€äº›ç›¸åº”çš„æ“ä½œã€‚</p><p>å®ç°å…·ä½“é€»è¾‘è¾ƒä¸ºå¤æ‚ï¼ŒåæœŸå†è¿›è¡Œæ·±å…¥è®²è§£ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://kubernetes.io/zh/docs/concepts/overview/components/" target="_blank" rel="noopener">Kubernetes ç»„ä»¶</a></p>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> å®¹å™¨ç¼–æ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kuberneteså…¥é—¨ç¯‡(ä¸€)â€”â€”Kubernetesæ˜¯ä»€ä¹ˆ</title>
      <link href="/2020/07/07/kubernetes/Kubernetes-introduction-1/"/>
      <url>/2020/07/07/kubernetes/Kubernetes-introduction-1/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="Kubernetesç®€ä»‹"><a href="#Kubernetesç®€ä»‹" class="headerlink" title="Kubernetesç®€ä»‹"></a>Kubernetesç®€ä»‹</h1><p>Kubernetes æ˜¯ä¸€ä¸ªå¯ç§»æ¤çš„ã€å¯æ‰©å±•çš„å¼€æºå¹³å°ï¼Œç”¨äºç®¡ç†å®¹å™¨åŒ–çš„å·¥ä½œè´Ÿè½½å’ŒæœåŠ¡ï¼Œå¯ä¿ƒè¿›å£°æ˜å¼é…ç½®å’Œè‡ªåŠ¨åŒ–ã€‚Kubernetes æ‹¥æœ‰ä¸€ä¸ªåºå¤§ä¸”å¿«é€Ÿå¢é•¿çš„ç”Ÿæ€ç³»ç»Ÿã€‚Kubernetes çš„æœåŠ¡ã€æ”¯æŒå’Œå·¥å…·å¹¿æ³›å¯ç”¨ã€‚</p><p>åç§° Kubernetes æºäºå¸Œè…Šè¯­ï¼Œæ„ä¸º â€œèˆµæ‰‹â€ æˆ– â€œé£è¡Œå‘˜â€ã€‚Google åœ¨ 2014 å¹´å¼€æºäº† Kubernetes é¡¹ç›®ã€‚Kubernetes å»ºç«‹åœ¨ Google åœ¨å¤§è§„æ¨¡è¿è¡Œç”Ÿäº§å·¥ä½œè´Ÿè½½æ–¹é¢æ‹¥æœ‰åå‡ å¹´çš„ç»éªŒçš„åŸºç¡€ä¸Šï¼Œç»“åˆäº†ç¤¾åŒºä¸­æœ€å¥½çš„æƒ³æ³•å’Œå®è·µã€‚</p><p>é€šä¿—ç‚¹è®²ï¼Œç®¡ç†Dockerçš„å„ä¸ªå¯¹è±¡å¾ˆéº»çƒ¦(å®¹å™¨ã€é•œåƒã€ç½‘ç»œã€å­˜å‚¨ç­‰ç­‰)ï¼Œè€ŒKubernetesè§£å†³çš„å¾ˆå¤šå®¹å™¨çš„ç¼–æ’é—®é¢˜ï¼Œå¹¶ä¸”ä¸é™äºå®¹å™¨ç¼–æ’ã€‚</p><h1 id="å¯¹æ¯”ä¼ ç»Ÿéƒ¨ç½²"><a href="#å¯¹æ¯”ä¼ ç»Ÿéƒ¨ç½²" class="headerlink" title="å¯¹æ¯”ä¼ ç»Ÿéƒ¨ç½²"></a>å¯¹æ¯”ä¼ ç»Ÿéƒ¨ç½²</h1><h2 id="ä¼ ç»Ÿéƒ¨ç½²æ—¶ä»£"><a href="#ä¼ ç»Ÿéƒ¨ç½²æ—¶ä»£" class="headerlink" title="ä¼ ç»Ÿéƒ¨ç½²æ—¶ä»£"></a>ä¼ ç»Ÿéƒ¨ç½²æ—¶ä»£</h2><p>æ—©æœŸï¼Œç»„ç»‡åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºã€‚æ— æ³•ä¸ºç‰©ç†æœåŠ¡å™¨ä¸­çš„åº”ç”¨ç¨‹åºå®šä¹‰èµ„æºè¾¹ç•Œï¼Œè¿™ä¼šå¯¼è‡´èµ„æºåˆ†é…é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªåº”ç”¨ç¨‹åºå ç”¨å¤§éƒ¨åˆ†èµ„æºçš„æƒ…å†µï¼Œç»“æœå¯èƒ½å¯¼è‡´å…¶ä»–åº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¸‹é™ã€‚ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯åœ¨ä¸åŒçš„ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œæ¯ä¸ªåº”ç”¨ç¨‹åºï¼Œä½†æ˜¯ç”±äºèµ„æºåˆ©ç”¨ä¸è¶³è€Œæ— æ³•æ‰©å±•ï¼Œå¹¶ä¸”ç»„ç»‡ç»´æŠ¤è®¸å¤šç‰©ç†æœåŠ¡å™¨çš„æˆæœ¬å¾ˆé«˜ã€‚</p><h2 id="è™šæ‹ŸåŒ–éƒ¨ç½²æ—¶ä»£ï¼š"><a href="#è™šæ‹ŸåŒ–éƒ¨ç½²æ—¶ä»£ï¼š" class="headerlink" title="è™šæ‹ŸåŒ–éƒ¨ç½²æ—¶ä»£ï¼š"></a>è™šæ‹ŸåŒ–éƒ¨ç½²æ—¶ä»£ï¼š</h2><p>ä½œä¸ºè§£å†³æ–¹æ¡ˆï¼Œå¼•å…¥äº†è™šæ‹ŸåŒ–åŠŸèƒ½ï¼Œå®ƒå…è®¸æ‚¨åœ¨å•ä¸ªç‰©ç†æœåŠ¡å™¨çš„ CPU ä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼ˆVMï¼‰ã€‚è™šæ‹ŸåŒ–åŠŸèƒ½å…è®¸åº”ç”¨ç¨‹åºåœ¨ VM ä¹‹é—´éš”ç¦»ï¼Œå¹¶æä¾›å®‰å…¨çº§åˆ«ï¼Œå› ä¸ºä¸€ä¸ªåº”ç”¨ç¨‹åºçš„ä¿¡æ¯ä¸èƒ½è¢«å¦ä¸€åº”ç”¨ç¨‹åºè‡ªç”±åœ°è®¿é—®ã€‚</p><p>å› ä¸ºè™šæ‹ŸåŒ–å¯ä»¥è½»æ¾åœ°æ·»åŠ æˆ–æ›´æ–°åº”ç”¨ç¨‹åºã€é™ä½ç¡¬ä»¶æˆæœ¬ç­‰ç­‰ï¼Œæ‰€ä»¥è™šæ‹ŸåŒ–å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ç‰©ç†æœåŠ¡å™¨ä¸­çš„èµ„æºï¼Œå¹¶å¯ä»¥å®ç°æ›´å¥½çš„å¯ä¼¸ç¼©æ€§ã€‚</p><p>æ¯ä¸ª VM æ˜¯ä¸€å°å®Œæ•´çš„è®¡ç®—æœºï¼Œåœ¨è™šæ‹ŸåŒ–ç¡¬ä»¶ä¹‹ä¸Šè¿è¡Œæ‰€æœ‰ç»„ä»¶ï¼ŒåŒ…æ‹¬å…¶è‡ªå·±çš„æ“ä½œç³»ç»Ÿã€‚</p><h2 id="å®¹å™¨éƒ¨ç½²æ—¶ä»£ï¼š-å®¹å™¨ç±»ä¼¼äº"><a href="#å®¹å™¨éƒ¨ç½²æ—¶ä»£ï¼š-å®¹å™¨ç±»ä¼¼äº" class="headerlink" title="å®¹å™¨éƒ¨ç½²æ—¶ä»£ï¼š å®¹å™¨ç±»ä¼¼äº"></a>å®¹å™¨éƒ¨ç½²æ—¶ä»£ï¼š å®¹å™¨ç±»ä¼¼äº</h2><p>VMï¼Œä½†æ˜¯å®ƒä»¬å…·æœ‰è½»é‡çº§çš„éš”ç¦»å±æ€§ï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰ã€‚å› æ­¤ï¼Œå®¹å™¨è¢«è®¤ä¸ºæ˜¯è½»é‡çº§çš„ã€‚å®¹å™¨ä¸ VM ç±»ä¼¼ï¼Œå…·æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€CPUã€å†…å­˜ã€è¿›ç¨‹ç©ºé—´ç­‰ã€‚ç”±äºå®ƒä»¬ä¸åŸºç¡€æ¶æ„åˆ†ç¦»ï¼Œå› æ­¤å¯ä»¥è·¨äº‘å’Œ OS åˆ†å‘è¿›è¡Œç§»æ¤ã€‚</p><p>å®¹å™¨å› å…·æœ‰è®¸å¤šä¼˜åŠ¿è€Œå˜å¾—æµè¡Œèµ·æ¥ã€‚ä¸‹é¢åˆ—å‡ºäº†å®¹å™¨çš„ä¸€äº›å¥½å¤„ï¼š</p><ul><li>æ•æ·åº”ç”¨ç¨‹åºçš„åˆ›å»ºå’Œéƒ¨ç½²ï¼šä¸ä½¿ç”¨ VM é•œåƒç›¸æ¯”ï¼Œæé«˜äº†å®¹å™¨é•œåƒåˆ›å»ºçš„ç®€ä¾¿æ€§å’Œæ•ˆç‡ã€‚</li><li>æŒç»­å¼€å‘ã€é›†æˆå’Œéƒ¨ç½²ï¼šé€šè¿‡å¿«é€Ÿç®€å•çš„å›æ»š(ç”±äºé•œåƒä¸å¯å˜æ€§)ï¼Œæä¾›å¯é ä¸”é¢‘ç¹çš„å®¹å™¨é•œåƒæ„å»ºå’Œéƒ¨ç½²ã€‚</li><li>å…³æ³¨å¼€å‘ä¸è¿ç»´çš„åˆ†ç¦»ï¼šåœ¨æ„å»º/å‘å¸ƒæ—¶è€Œä¸æ˜¯åœ¨éƒ¨ç½²æ—¶åˆ›å»ºåº”ç”¨ç¨‹åºå®¹å™¨é•œåƒï¼Œä»è€Œå°†åº”ç”¨ç¨‹åºä¸åŸºç¡€æ¶æ„åˆ†ç¦»ã€‚</li><li>å¯è§‚å¯Ÿæ€§ä¸ä»…å¯ä»¥æ˜¾ç¤ºæ“ä½œç³»ç»Ÿçº§åˆ«çš„ä¿¡æ¯å’ŒæŒ‡æ ‡ï¼Œè¿˜å¯ä»¥æ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶å†µå’Œå…¶ä»–æŒ‡æ ‡ä¿¡å·ã€‚</li><li>è·¨å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§çš„ç¯å¢ƒä¸€è‡´æ€§ï¼šåœ¨ä¾¿æºå¼è®¡ç®—æœºä¸Šä¸åœ¨äº‘ä¸­ç›¸åŒåœ°è¿è¡Œã€‚</li><li>äº‘å’Œæ“ä½œç³»ç»Ÿåˆ†å‘çš„å¯ç§»æ¤æ€§ï¼šå¯åœ¨ Ubuntuã€RHELã€CoreOSã€æœ¬åœ°ã€Google Kubernetes Engine å’Œå…¶ä»–ä»»ä½•åœ°æ–¹è¿è¡Œã€‚</li><li>ä»¥åº”ç”¨ç¨‹åºä¸ºä¸­å¿ƒçš„ç®¡ç†ï¼šæé«˜æŠ½è±¡çº§åˆ«ï¼Œä»åœ¨è™šæ‹Ÿç¡¬ä»¶ä¸Šè¿è¡Œ OS åˆ°ä½¿ç”¨é€»è¾‘èµ„æºåœ¨ OS ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºã€‚</li><li>æ¾æ•£è€¦åˆã€åˆ†å¸ƒå¼ã€å¼¹æ€§ã€è§£æ”¾çš„å¾®æœåŠ¡ï¼šåº”ç”¨ç¨‹åºè¢«åˆ†è§£æˆè¾ƒå°çš„ç‹¬ç«‹éƒ¨åˆ†ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€éƒ¨ç½²å’Œç®¡ç† - è€Œä¸æ˜¯åœ¨ä¸€å°å¤§å‹å•æœºä¸Šæ•´ä½“è¿è¡Œã€‚</li><li>èµ„æºéš”ç¦»ï¼šå¯é¢„æµ‹çš„åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚</li><li>èµ„æºåˆ©ç”¨ï¼šé«˜æ•ˆç‡å’Œé«˜å¯†åº¦ã€‚</li></ul><h2 id="ä¸ºä»€ä¹ˆéœ€è¦-Kubernetesï¼Œå®ƒèƒ½åšä»€ä¹ˆ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-Kubernetesï¼Œå®ƒèƒ½åšä»€ä¹ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ Kubernetesï¼Œå®ƒèƒ½åšä»€ä¹ˆ?"></a>ä¸ºä»€ä¹ˆéœ€è¦ Kubernetesï¼Œå®ƒèƒ½åšä»€ä¹ˆ?</h2><p>å®¹å™¨æ˜¯æ‰“åŒ…å’Œè¿è¡Œåº”ç”¨ç¨‹åºçš„å¥½æ–¹å¼ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ‚¨éœ€è¦ç®¡ç†è¿è¡Œåº”ç”¨ç¨‹åºçš„å®¹å™¨ï¼Œå¹¶ç¡®ä¿ä¸ä¼šåœæœºã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨å‘ç”Ÿæ•…éšœï¼Œåˆ™éœ€è¦å¯åŠ¨å¦ä¸€ä¸ªå®¹å™¨ã€‚å¦‚æœç³»ç»Ÿå¤„ç†æ­¤è¡Œä¸ºï¼Œä¼šä¸ä¼šæ›´å®¹æ˜“ï¼Ÿ</p><p>è¿™å°±æ˜¯ Kubernetes çš„æ•‘æ´æ–¹æ³•ï¼Kubernetes ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªå¯å¼¹æ€§è¿è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¡†æ¶ã€‚Kubernetes ä¼šæ»¡è¶³æ‚¨çš„æ‰©å±•è¦æ±‚ã€æ•…éšœè½¬ç§»ã€éƒ¨ç½²æ¨¡å¼ç­‰ã€‚ä¾‹å¦‚ï¼ŒKubernetes å¯ä»¥è½»æ¾ç®¡ç†ç³»ç»Ÿçš„éƒ¨ç½²ã€‚</p><p>Kubernetes ä¸ºæ‚¨æä¾›ï¼š</p><ul><li>æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</li></ul><p>Kubernetes å¯ä»¥ä½¿ç”¨ DNS åç§°æˆ–è‡ªå·±çš„ IP åœ°å€å…¬å¼€å®¹å™¨ï¼Œå¦‚æœåˆ°å®¹å™¨çš„æµé‡å¾ˆå¤§ï¼ŒKubernetes å¯ä»¥è´Ÿè½½å‡è¡¡å¹¶åˆ†é…ç½‘ç»œæµé‡ï¼Œä»è€Œä½¿éƒ¨ç½²ç¨³å®šã€‚</p><ul><li>å­˜å‚¨ç¼–æ’</li></ul><p>Kubernetes å…è®¸æ‚¨è‡ªåŠ¨æŒ‚è½½æ‚¨é€‰æ‹©çš„å­˜å‚¨ç³»ç»Ÿï¼Œä¾‹å¦‚æœ¬åœ°å­˜å‚¨ã€å…¬å…±äº‘æä¾›å•†ç­‰ã€‚</p><ul><li>è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š</li></ul><p>æ‚¨å¯ä»¥ä½¿ç”¨ Kubernetes æè¿°å·²éƒ¨ç½²å®¹å™¨çš„æ‰€éœ€çŠ¶æ€ï¼Œå®ƒå¯ä»¥ä»¥å—æ§çš„é€Ÿç‡å°†å®é™…çŠ¶æ€æ›´æ”¹ä¸ºæ‰€éœ€çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥è‡ªåŠ¨åŒ– Kubernetes æ¥ä¸ºæ‚¨çš„éƒ¨ç½²åˆ›å»ºæ–°å®¹å™¨ï¼Œåˆ é™¤ç°æœ‰å®¹å™¨å¹¶å°†å®ƒä»¬çš„æ‰€æœ‰èµ„æºç”¨äºæ–°å®¹å™¨ã€‚</p><ul><li>è‡ªåŠ¨äºŒè¿›åˆ¶æ‰“åŒ…</li></ul><p>Kubernetes å…è®¸æ‚¨æŒ‡å®šæ¯ä¸ªå®¹å™¨æ‰€éœ€ CPU å’Œå†…å­˜ï¼ˆRAMï¼‰ã€‚å½“å®¹å™¨æŒ‡å®šäº†èµ„æºè¯·æ±‚æ—¶ï¼ŒKubernetes å¯ä»¥åšå‡ºæ›´å¥½çš„å†³ç­–æ¥ç®¡ç†å®¹å™¨çš„èµ„æºã€‚</p><ul><li>è‡ªæˆ‘ä¿®å¤</li></ul><p>Kubernetes é‡æ–°å¯åŠ¨å¤±è´¥çš„å®¹å™¨ã€æ›¿æ¢å®¹å™¨ã€æ€æ­»ä¸å“åº”ç”¨æˆ·å®šä¹‰çš„è¿è¡ŒçŠ¶å†µæ£€æŸ¥çš„å®¹å™¨ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡å¥½æœåŠ¡ä¹‹å‰ä¸å°†å…¶é€šå‘Šç»™å®¢æˆ·ç«¯ã€‚</p><ul><li>å¯†é’¥ä¸é…ç½®ç®¡ç†</li></ul><p>Kubernetes å…è®¸æ‚¨å­˜å‚¨å’Œç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€OAuth ä»¤ç‰Œå’Œ ssh å¯†é’¥ã€‚æ‚¨å¯ä»¥åœ¨ä¸é‡å»ºå®¹å™¨é•œåƒçš„æƒ…å†µä¸‹éƒ¨ç½²å’Œæ›´æ–°å¯†é’¥å’Œåº”ç”¨ç¨‹åºé…ç½®ï¼Œä¹Ÿæ— éœ€åœ¨å †æ ˆé…ç½®ä¸­æš´éœ²å¯†é’¥ã€‚</p><h2 id="Kubernetes-ä¸æ˜¯ä»€ä¹ˆ"><a href="#Kubernetes-ä¸æ˜¯ä»€ä¹ˆ" class="headerlink" title="Kubernetes ä¸æ˜¯ä»€ä¹ˆ"></a>Kubernetes ä¸æ˜¯ä»€ä¹ˆ</h2><p>Kubernetes ä¸æ˜¯ä¼ ç»Ÿçš„ã€åŒ…ç½—ä¸‡è±¡çš„ PaaSï¼ˆå¹³å°å³æœåŠ¡ï¼‰ç³»ç»Ÿã€‚ç”±äº Kubernetes åœ¨å®¹å™¨çº§åˆ«è€Œä¸æ˜¯åœ¨ç¡¬ä»¶çº§åˆ«è¿è¡Œï¼Œå› æ­¤å®ƒæä¾›äº† PaaS äº§å“å…±æœ‰çš„ä¸€äº›æ™®éé€‚ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚éƒ¨ç½²ã€æ‰©å±•ã€è´Ÿè½½å‡è¡¡ã€æ—¥å¿—è®°å½•å’Œç›‘è§†ã€‚ä½†æ˜¯ï¼ŒKubernetes ä¸æ˜¯å•ä¸€çš„ï¼Œé»˜è®¤è§£å†³æ–¹æ¡ˆæ˜¯å¯é€‰å’Œå¯æ’æ‹”çš„ã€‚Kubernetes æä¾›äº†æ„å»ºå¼€å‘äººå‘˜å¹³å°çš„åŸºç¡€ï¼Œä½†æ˜¯åœ¨é‡è¦çš„åœ°æ–¹ä¿ç•™äº†ç”¨æˆ·çš„é€‰æ‹©å’Œçµæ´»æ€§ã€‚</p><ul><li>Kubernetes ä¸é™åˆ¶æ”¯æŒçš„åº”ç”¨ç¨‹åºç±»å‹(ä½ å¯ä»¥åœ¨kubernetesä¹‹ä¸Šè¿è¡Œcç¨‹åºã€javaç¨‹åºã€pythonç¨‹åºç­‰ç­‰)ã€‚Kubernetes æ—¨åœ¨æ”¯æŒæå…¶å¤šç§å¤šæ ·çš„å·¥ä½œè´Ÿè½½ï¼ŒåŒ…æ‹¬æ— çŠ¶æ€ã€æœ‰çŠ¶æ€å’Œæ•°æ®å¤„ç†å·¥ä½œè´Ÿè½½ã€‚å¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥åœ¨å®¹å™¨ä¸­è¿è¡Œï¼Œé‚£ä¹ˆå®ƒåº”è¯¥å¯ä»¥åœ¨ Kubernetes ä¸Šå¾ˆå¥½åœ°è¿è¡Œã€‚</li><li>Kubernetes ä¸éƒ¨ç½²æºä»£ç ï¼Œä¹Ÿä¸æ„å»ºæ‚¨çš„åº”ç”¨ç¨‹åºã€‚æŒç»­é›†æˆ(CI)ã€äº¤ä»˜å’Œéƒ¨ç½²ï¼ˆCI/CDï¼‰å·¥ä½œæµå–å†³äºç»„ç»‡çš„æ–‡åŒ–å’Œåå¥½ä»¥åŠæŠ€æœ¯è¦æ±‚ã€‚</li><li>Kubernetes ä¸æä¾›åº”ç”¨ç¨‹åºçº§åˆ«çš„æœåŠ¡ä½œä¸ºå†…ç½®æœåŠ¡ï¼Œä¾‹å¦‚ä¸­é—´ä»¶ï¼ˆä¾‹å¦‚ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶ï¼‰ã€æ•°æ®å¤„ç†æ¡†æ¶ï¼ˆä¾‹å¦‚ï¼ŒSparkï¼‰ã€æ•°æ®åº“ï¼ˆä¾‹å¦‚ï¼Œmysqlï¼‰ã€ç¼“å­˜ã€é›†ç¾¤å­˜å‚¨ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼ŒCephï¼‰ã€‚è¿™æ ·çš„ç»„ä»¶å¯ä»¥åœ¨ Kubernetes ä¸Šè¿è¡Œï¼Œå¹¶ä¸”/æˆ–è€…å¯ä»¥ç”±è¿è¡Œåœ¨ Kubernetes ä¸Šçš„åº”ç”¨ç¨‹åºé€šè¿‡å¯ç§»æ¤æœºåˆ¶ï¼ˆä¾‹å¦‚ï¼Œå¼€æ”¾æœåŠ¡ä»£ç†ï¼‰æ¥è®¿é—®ã€‚</li><li>Kubernetes ä¸æŒ‡å®šæ—¥å¿—è®°å½•ã€ç›‘è§†æˆ–è­¦æŠ¥è§£å†³æ–¹æ¡ˆã€‚å®ƒæä¾›äº†ä¸€äº›é›†æˆä½œä¸ºæ¦‚å¿µè¯æ˜ï¼Œå¹¶æä¾›äº†æ”¶é›†å’Œå¯¼å‡ºæŒ‡æ ‡çš„æœºåˆ¶ã€‚</li><li>Kubernetes ä¸æä¾›æˆ–ä¸è¦æ±‚é…ç½®è¯­è¨€/ç³»ç»Ÿï¼ˆä¾‹å¦‚ jsonnetï¼‰ï¼Œå®ƒæä¾›äº†å£°æ˜æ€§ APIï¼Œè¯¥å£°æ˜æ€§ API å¯ä»¥ç”±ä»»æ„å½¢å¼çš„å£°æ˜æ€§è§„èŒƒæ‰€æ„æˆã€‚</li><li>Kubernetes ä¸æä¾›ä¹Ÿä¸é‡‡ç”¨ä»»ä½•å…¨é¢çš„æœºå™¨é…ç½®ã€ç»´æŠ¤ã€ç®¡ç†æˆ–è‡ªæˆ‘ä¿®å¤ç³»ç»Ÿã€‚</li><li>æ­¤å¤–ï¼ŒKubernetes ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç¼–æ’ç³»ç»Ÿï¼Œå®é™…ä¸Šå®ƒæ¶ˆé™¤äº†ç¼–æ’çš„éœ€è¦ã€‚ç¼–æ’çš„æŠ€æœ¯å®šä¹‰æ˜¯æ‰§è¡Œå·²å®šä¹‰çš„å·¥ä½œæµç¨‹ï¼šé¦–å…ˆæ‰§è¡Œ Aï¼Œç„¶åæ‰§è¡Œ Bï¼Œå†æ‰§è¡Œ Cã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒKubernetes åŒ…å«ä¸€ç»„ç‹¬ç«‹çš„ã€å¯ç»„åˆçš„æ§åˆ¶è¿‡ç¨‹ï¼Œè¿™äº›è¿‡ç¨‹è¿ç»­åœ°å°†å½“å‰çŠ¶æ€é©±åŠ¨åˆ°æ‰€æä¾›çš„æ‰€éœ€çŠ¶æ€ã€‚ä» A åˆ° C çš„æ–¹å¼æ— å…³ç´§è¦ï¼Œä¹Ÿä¸éœ€è¦é›†ä¸­æ§åˆ¶ï¼Œè¿™ä½¿å¾—ç³»ç»Ÿæ›´æ˜“äºä½¿ç”¨ä¸”åŠŸèƒ½æ›´å¼ºå¤§ã€å¥å£®ã€å¼¹æ€§å’Œå¯æ‰©å±•æ€§ã€‚</li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä»¥ä¸Šæ¥è‡ªgoogleå®˜æ–¹æ–‡æ¡£çš„ç¿»è¯‘ï¼Œæˆ‘è§‰å¾—çœ‹ä¹¦ä»€ä¹ˆçš„éƒ½ä¸å¦‚å®˜æ–¹æ–‡æ¡£æ¥çš„ç®€å•ç›´æ¥ï¼Œæ¨èå¤§å®¶å­¦ä¹ æŠ€æœ¯çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œæé«˜è‡ªå·±çš„æ€æƒ³ç†è§£èƒ½åŠ›ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://kubernetes.io/zh/docs/concepts/overview/what-is-kubernetes/" target="_blank" rel="noopener">Kubernetesæ˜¯ä»€ä¹ˆ</a></p>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> å®¹å™¨ç¼–æ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥æµ…å‡ºDockeråŸç†åŠå®æˆ˜(äº”)â€”â€”Dockerç½‘ç»œä»‹ç»</title>
      <link href="/2020/07/06/docker/docker-idea-5/"/>
      <url>/2020/07/06/docker/docker-idea-5/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><p>æ·±å…¥æµ…å‡ºDockeråŸç†åŠå®æˆ˜ç³»åˆ—ç¬¬äº”ç¯‡ï¼Œæˆ‘ä¸»è¦åˆ†äº«Dockerçš„ç½‘ç»œæ¦‚å¿µåŠå¦‚ä½•åˆç†çš„ä½¿ç”¨Dockerç½‘ç»œã€‚</p><h1 id="Dockerç½‘ç»œä»‹ç»"><a href="#Dockerç½‘ç»œä»‹ç»" class="headerlink" title="Dockerç½‘ç»œä»‹ç»"></a>Dockerç½‘ç»œä»‹ç»</h1><p>Dockerå®¹å™¨å’ŒæœåŠ¡å¦‚æ­¤å¼ºå¤§çš„åŸå› ä¹‹ä¸€æ˜¯æ‚¨å¯ä»¥å°†å®ƒä»¬è¿æ¥åœ¨ä¸€èµ·ï¼Œæˆ–å°†å®ƒä»¬è¿æ¥åˆ°éDockerç¯å¢ƒä¸­ã€‚</p><p>Dockerå®¹å™¨å’ŒæœåŠ¡ç”šè‡³ä¸éœ€è¦çŸ¥é“å®ƒä»¬å·²éƒ¨ç½²åœ¨Dockerä¸Šï¼Œä¹Ÿä¸å¿…çŸ¥é“å®ƒä»¬çš„å¯¹ç­‰å¯¹è±¡æ˜¯å¦ä¹Ÿæ˜¯Dockerä¸­è¿è¡Œã€‚</p><p>æ— è®ºæ‚¨çš„Dockerä¸»æœºè¿è¡ŒLinuxï¼ŒWindowsè¿˜æ˜¯ä¸¤è€…ç»“åˆï¼Œæ‚¨éƒ½å¯ä»¥ä½¿ç”¨Dockerä»¥ä¸å¹³å°æ— å…³çš„æ–¹å¼ç®¡ç†å®ƒä»¬ã€‚</p><h1 id="ç½‘ç»œæ¨¡å¼ç®€ä»‹"><a href="#ç½‘ç»œæ¨¡å¼ç®€ä»‹" class="headerlink" title="ç½‘ç»œæ¨¡å¼ç®€ä»‹"></a>ç½‘ç»œæ¨¡å¼ç®€ä»‹</h1><p>Dockerçš„ç½‘ç»œå­ç³»ç»Ÿå¯ä½¿ç”¨é©±åŠ¨ç¨‹åºæ’å…¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå­˜åœ¨å‡ ä¸ªé©±åŠ¨ç¨‹åºï¼Œå®ƒä»¬æä¾›æ ¸å¿ƒè”ç½‘åŠŸèƒ½ï¼š</p><h2 id="bridge-ç½‘æ¡¥"><a href="#bridge-ç½‘æ¡¥" class="headerlink" title="bridge(ç½‘æ¡¥)"></a>bridge(ç½‘æ¡¥)</h2><p>é»˜è®¤çš„ç½‘ç»œé©±åŠ¨ç¨‹åºã€‚å¦‚æœæœªæŒ‡å®šé©±åŠ¨ç¨‹åºï¼Œåˆ™è¿™æ˜¯æ‚¨æ­£åœ¨åˆ›å»ºçš„ç½‘ç»œç±»å‹ã€‚å½“æ‚¨çš„åº”ç”¨ç¨‹åºåœ¨éœ€è¦é€šä¿¡çš„ç‹¬ç«‹å®¹å™¨ä¸­è¿è¡Œæ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨ç½‘æ¡¥ç½‘ç»œã€‚</p><h2 id="host-ä¸»æœºç½‘ç»œ"><a href="#host-ä¸»æœºç½‘ç»œ" class="headerlink" title="host(ä¸»æœºç½‘ç»œ)"></a>host(ä¸»æœºç½‘ç»œ)</h2><p>å¯¹äºç‹¬ç«‹å®¹å™¨ï¼Œè¯·åˆ é™¤å®¹å™¨ä¸Dockerä¸»æœºä¹‹é—´çš„ç½‘ç»œéš”ç¦»ï¼Œç„¶åç›´æ¥ä½¿ç”¨ä¸»æœºçš„ç½‘ç»œã€‚</p><h2 id="overlay-è¦†ç›–ç½‘ç»œ"><a href="#overlay-è¦†ç›–ç½‘ç»œ" class="headerlink" title="overlay(è¦†ç›–ç½‘ç»œ)"></a>overlay(è¦†ç›–ç½‘ç»œ)</h2><p>è¦†ç›–ç½‘ç»œå°†å¤šä¸ªDockerå®ˆæŠ¤ç¨‹åºè¿æ¥åœ¨ä¸€èµ·ï¼Œå¹¶ä½¿ç¾¤é›†æœåŠ¡èƒ½å¤Ÿç›¸äº’é€šä¿¡ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨è¦†ç›–ç½‘ç»œæ¥ä¿ƒè¿›ç¾¤é›†æœåŠ¡å’Œç‹¬ç«‹å®¹å™¨ä¹‹é—´æˆ–ä¸åŒDockerå®ˆæŠ¤ç¨‹åºä¸Šçš„ä¸¤ä¸ªç‹¬ç«‹å®¹å™¨ä¹‹é—´çš„é€šä¿¡ã€‚è¿™ç§ç­–ç•¥æ¶ˆé™¤äº†åœ¨è¿™äº›å®¹å™¨ä¹‹é—´è¿›è¡Œæ“ä½œç³»ç»Ÿçº§è·¯ç”±çš„éœ€è¦ã€‚</p><h2 id="macvlan-ç‰©ç†åœ°å€ç½‘ç»œ"><a href="#macvlan-ç‰©ç†åœ°å€ç½‘ç»œ" class="headerlink" title="macvlan(ç‰©ç†åœ°å€ç½‘ç»œ)"></a>macvlan(ç‰©ç†åœ°å€ç½‘ç»œ)</h2><p>Macvlanç½‘ç»œå…è®¸æ‚¨å°†MACåœ°å€åˆ†é…ç»™å®¹å™¨ï¼Œä½¿å…¶åœ¨ç½‘ç»œä¸Šæ˜¾ç¤ºä¸ºç‰©ç†è®¾å¤‡ã€‚Dockerå®ˆæŠ¤ç¨‹åºé€šè¿‡å…¶MACåœ°å€å°†æµé‡è·¯ç”±åˆ°å®¹å™¨ã€‚macvlan åœ¨å¤„ç†å¸Œæœ›ç›´æ¥è¿æ¥åˆ°ç‰©ç†ç½‘ç»œè€Œä¸æ˜¯é€šè¿‡Dockerä¸»æœºçš„ç½‘ç»œå †æ ˆè¿›è¡Œè·¯ç”±çš„æ—§åº”ç”¨ç¨‹åºæ—¶ï¼Œä½¿ç”¨é©±åŠ¨ç¨‹åºæœ‰æ—¶æ˜¯æœ€ä½³é€‰æ‹©ã€‚</p><h2 id="none-ç¦ç”¨ç½‘ç»œ"><a href="#none-ç¦ç”¨ç½‘ç»œ" class="headerlink" title="none(ç¦ç”¨ç½‘ç»œ)"></a>none(ç¦ç”¨ç½‘ç»œ)</h2><p>å¯¹äºæ­¤å®¹å™¨ï¼Œè¯·ç¦ç”¨æ‰€æœ‰è”ç½‘ã€‚é€šå¸¸ä¸è‡ªå®šä¹‰ç½‘ç»œé©±åŠ¨ç¨‹åºä¸€èµ·ä½¿ç”¨ã€‚noneä¸é€‚ç”¨äºç¾¤ä½“æœåŠ¡ã€‚</p><h2 id="å¦‚ä½•é€‰å‹ç½‘ç»œæ¨¡å¼"><a href="#å¦‚ä½•é€‰å‹ç½‘ç»œæ¨¡å¼" class="headerlink" title="å¦‚ä½•é€‰å‹ç½‘ç»œæ¨¡å¼"></a>å¦‚ä½•é€‰å‹ç½‘ç»œæ¨¡å¼</h2><ul><li>å½“æ‚¨éœ€è¦å¤šä¸ªå®¹å™¨åœ¨åŒä¸€Dockerä¸»æœºä¸Šè¿›è¡Œé€šä¿¡æ—¶ï¼Œæœ€å¥½ä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥ç½‘ç»œã€‚</li><li>å½“å®¹å™¨çš„åº”ç”¨ç¨‹åºä¸èƒ½ä¸Dockerä¸»æœºéš”ç¦»æ—¶ï¼Œä½†æ‚¨å¸Œæœ›å®¹å™¨çš„å…¶ä»–æ–¹é¢éš”ç¦»æ—¶ï¼Œä¸»æœºç½‘ç»œæ˜¯æœ€ä½³é€‰æ‹©ã€‚</li><li>å½“æ‚¨éœ€è¦ä¸åŒDockerä¸»æœºä¸Šè¿è¡Œçš„å®¹å™¨è¿›è¡Œé€šä¿¡æ—¶ï¼Œæˆ–è€…å½“å¤šä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨é›†ç¾¤æœåŠ¡ä¸€èµ·å·¥ä½œæ—¶ï¼Œè¦†ç›–ç½‘ç»œæ˜¯æœ€ä½³çš„é€‰æ‹©ã€‚</li><li>ä»VMè®¾ç½®è¿ç§»æˆ–éœ€è¦å®¹å™¨çœ‹èµ·æ¥åƒç½‘ç»œä¸Šçš„ç‰©ç†ä¸»æœºï¼ˆæ¯ä¸ªéƒ½æœ‰å”¯ä¸€çš„MACåœ°å€ï¼‰æ—¶ï¼ŒMacvlanç½‘ç»œæ˜¯æœ€å¥½çš„ã€‚</li></ul><h1 id="4ç§ç½‘ç»œæ¨¡å¼"><a href="#4ç§ç½‘ç»œæ¨¡å¼" class="headerlink" title="4ç§ç½‘ç»œæ¨¡å¼"></a>4ç§ç½‘ç»œæ¨¡å¼</h1><h2 id="bridge-networks"><a href="#bridge-networks" class="headerlink" title="bridge networks"></a>bridge networks</h2><p>åœ¨ç½‘ç»œæ–¹é¢ï¼Œç½‘æ¡¥æ˜¯åœ¨ç½‘æ®µä¹‹é—´è½¬å‘æµé‡çš„é“¾è·¯å±‚è®¾å¤‡ã€‚æ¡¥å¯ä»¥æ˜¯åœ¨ä¸»æœºå†…æ ¸ä¸­è¿è¡Œçš„ç¡¬ä»¶è®¾å¤‡æˆ–è½¯ä»¶è®¾å¤‡ã€‚</p><p>å°±Dockerè€Œè¨€ï¼Œç½‘æ¡¥ç½‘ç»œä½¿ç”¨è½¯ä»¶ç½‘æ¡¥ï¼Œè¯¥è½¯ä»¶ç½‘æ¡¥å…è®¸è¿æ¥åˆ°åŒä¸€ç½‘æ¡¥ç½‘ç»œçš„å®¹å™¨è¿›è¡Œé€šä¿¡ï¼ŒåŒæ—¶ä¸æœªè¿æ¥åˆ°è¯¥ç½‘æ¡¥ç½‘ç»œçš„å®¹å™¨éš”ç¦»ã€‚Dockerç½‘æ¡¥é©±åŠ¨ç¨‹åºä¼šè‡ªåŠ¨åœ¨ä¸»æœºä¸­å®‰è£…è§„åˆ™ï¼Œä»¥ä½¿ä¸åŒç½‘æ¡¥ç½‘ç»œä¸Šçš„å®¹å™¨æ— æ³•ç›´æ¥ç›¸äº’é€šä¿¡ã€‚</p><p>æ¡¥æ¥ç½‘ç»œé€‚ç”¨äºåœ¨åŒä¸€ Dockerå®ˆæŠ¤ç¨‹åºä¸»æœºä¸Šè¿è¡Œçš„å®¹å™¨ã€‚</p><p>å¯åŠ¨Dockeræ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„æ¡¥æ¥ç½‘ç»œï¼ˆä¹Ÿç§°ä¸ºbridgeï¼‰ï¼Œå¹¶ä¸”é™¤éå¦æœ‰è¯´æ˜ï¼Œå¦åˆ™æ–°å¯åŠ¨çš„å®¹å™¨å°†è¿æ¥åˆ°å®ƒã€‚æ‚¨è¿˜å¯ä»¥åˆ›å»ºç”¨æˆ·å®šä¹‰çš„è‡ªå®šä¹‰ç½‘æ¡¥ç½‘ç»œã€‚ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥ç½‘ç»œä¼˜äºé»˜è®¤bridge ç½‘ç»œã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªé»˜è®¤ç½‘æ¡¥çš„ä¾‹å­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ip add</span><br><span class="line"></span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link&#x2F;ether 02:42:ec:96:8d:3a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1&#x2F;16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:ecff:fe96:8d3a&#x2F;64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">[root@localhost ~]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">45c686d33317        bridge              bridge              local</span><br></pre></td></tr></table></figure><h3 id="ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥å’Œé»˜è®¤ç½‘æ¡¥ä¹‹é—´çš„åŒºåˆ«"><a href="#ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥å’Œé»˜è®¤ç½‘æ¡¥ä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥å’Œé»˜è®¤ç½‘æ¡¥ä¹‹é—´çš„åŒºåˆ«"></a>ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥å’Œé»˜è®¤ç½‘æ¡¥ä¹‹é—´çš„åŒºåˆ«</h3><h4 id="ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥å¯åœ¨å®¹å™¨ä¹‹é—´æä¾›è‡ªåŠ¨DNSè§£æ"><a href="#ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥å¯åœ¨å®¹å™¨ä¹‹é—´æä¾›è‡ªåŠ¨DNSè§£æ" class="headerlink" title="ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥å¯åœ¨å®¹å™¨ä¹‹é—´æä¾›è‡ªåŠ¨DNSè§£æ"></a>ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥å¯åœ¨å®¹å™¨ä¹‹é—´æä¾›è‡ªåŠ¨DNSè§£æ</h4><p>é»˜è®¤ç½‘æ¡¥ä¸Šçš„å®¹å™¨åªèƒ½é€šè¿‡IPåœ°å€ç›¸äº’è®¿é—®ï¼Œé™¤éæ‚¨ä½¿ç”¨â€“linké€‰é¡¹ã€‚åœ¨ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥ç½‘ç»œä¸Šï¼Œå®¹å™¨å¯ä»¥é€šè¿‡åç§°æˆ–åˆ«åç›¸äº’è§£æã€‚</p><p>å¦‚æœåœ¨é»˜è®¤ç½‘æ¡¥ä¸Šè¿è¡Œç›¸åŒçš„åº”ç”¨ç¨‹åºï¼Œåˆ™éœ€è¦åœ¨å®¹å™¨ä¹‹é—´æ‰‹åŠ¨åˆ›å»ºé“¾æ¥ï¼ˆä½¿ç”¨â€“linkï¼‰ã€‚è¿™äº›é“¾æ¥éœ€è¦åŒå‘åˆ›å»ºï¼Œå› æ­¤æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œè¦è¿›è¡Œé€šä¿¡çš„å®¹å™¨è¶…è¿‡ä¸¤ä¸ªï¼Œè¿™å°†å˜å¾—å¾ˆå¤æ‚ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä¿®æ”¹/etc/hostså®¹å™¨ä¸­çš„æ–‡ä»¶ï¼Œä½†è¿™ä¼šå¯¼è‡´éš¾ä»¥è°ƒè¯•çš„é—®é¢˜ã€‚</p><p>æƒ³è±¡ä¸€ä¸ªå…·æœ‰Webå‰ç«¯å’Œdbåç«¯çš„åº”ç”¨ç¨‹åºåŒæ—¶æ”¾åœ¨ä¸€ä¸ªç”¨æˆ·å®šä¹‰å¥½çš„ç½‘æ¡¥ä¸Šã€‚å¦‚æœå®¹å™¨webè°ƒç”¨dbï¼Œåˆ™dbæ— è®ºåº”ç”¨ç¨‹åºåœ¨å“ªä¸ªDockerä¸»æœºä¸Šè¿è¡Œï¼ŒWebå®¹å™¨éƒ½å¯ä»¥é€šè¿‡è¿æ¥åˆ°dbå®¹å™¨ã€‚</p><h4 id="ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥å¯æä¾›æ›´å¥½çš„éš”ç¦»"><a href="#ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥å¯æä¾›æ›´å¥½çš„éš”ç¦»" class="headerlink" title="ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥å¯æä¾›æ›´å¥½çš„éš”ç¦»"></a>ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥å¯æä¾›æ›´å¥½çš„éš”ç¦»</h4><p>æ‰€æœ‰æ²¡æœ‰é€šè¿‡â€“networkæŒ‡å®šçš„å®¹å™¨éƒ½å°†è¿æ¥åˆ°é»˜è®¤ç½‘æ¡¥ç½‘ç»œã€‚è¿™å¯èƒ½æ˜¯ä¸€ç§é£é™©ï¼Œå› ä¸ºä¸ç›¸å…³çš„åº”ç”¨/æœåŠ¡/å®¹å™¨éšåèƒ½å¤Ÿè¿›è¡Œé€šä¿¡ã€‚</p><p>è‡ªå®šä¹‰çš„ç½‘æ¡¥å¯æä¾›å±€åŸŸç½‘ï¼Œå…¶ä¸­åªæœ‰è¿æ¥åˆ°è¯¥ç½‘ç»œçš„å®¹å™¨æ‰èƒ½é€šä¿¡ã€‚</p><h4 id="å®¹å™¨å¯ä»¥éšæ—¶éšåœ°ä»ç”¨æˆ·å®šä¹‰çš„ç½‘ç»œè¿æ¥å’Œåˆ†ç¦»"><a href="#å®¹å™¨å¯ä»¥éšæ—¶éšåœ°ä»ç”¨æˆ·å®šä¹‰çš„ç½‘ç»œè¿æ¥å’Œåˆ†ç¦»" class="headerlink" title="å®¹å™¨å¯ä»¥éšæ—¶éšåœ°ä»ç”¨æˆ·å®šä¹‰çš„ç½‘ç»œè¿æ¥å’Œåˆ†ç¦»"></a>å®¹å™¨å¯ä»¥éšæ—¶éšåœ°ä»ç”¨æˆ·å®šä¹‰çš„ç½‘ç»œè¿æ¥å’Œåˆ†ç¦»</h4><p>åœ¨å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œæ‚¨å¯ä»¥å³æ—¶å°†å…¶ä¸è‡ªå®šä¹‰çš„ç½‘æ¡¥è¿æ¥æˆ–æ–­å¼€è¿æ¥ã€‚è¦ä»é»˜è®¤ç½‘æ¡¥ç½‘ç»œä¸­åˆ é™¤å®¹å™¨ï¼Œæ‚¨éœ€è¦åœæ­¢å®¹å™¨å¹¶ä½¿ç”¨å…¶ä»–ç½‘ç»œé€‰é¡¹é‡æ–°åˆ›å»ºå®ƒã€‚</p><h4 id="æ¯ä¸ªç”¨æˆ·å®šä¹‰çš„ç½‘ç»œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¯é…ç½®çš„ç½‘æ¡¥"><a href="#æ¯ä¸ªç”¨æˆ·å®šä¹‰çš„ç½‘ç»œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¯é…ç½®çš„ç½‘æ¡¥" class="headerlink" title="æ¯ä¸ªç”¨æˆ·å®šä¹‰çš„ç½‘ç»œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¯é…ç½®çš„ç½‘æ¡¥"></a>æ¯ä¸ªç”¨æˆ·å®šä¹‰çš„ç½‘ç»œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¯é…ç½®çš„ç½‘æ¡¥</h4><p>å¦‚æœæ‚¨çš„å®¹å™¨ä½¿ç”¨é»˜è®¤çš„ç½‘æ¡¥ï¼Œåˆ™å¯ä»¥å¯¹å…¶è¿›è¡Œé…ç½®ï¼Œä½†æ˜¯æ‰€æœ‰å®¹å™¨éƒ½ä½¿ç”¨ç›¸åŒçš„è®¾ç½®ï¼Œä¾‹å¦‚MTUå’Œiptablesè§„åˆ™ã€‚æ­¤å¤–ï¼Œé…ç½®é»˜è®¤æ¡¥æ¥ç½‘ç»œå‘ç”Ÿåœ¨Dockeræœ¬èº«ä¹‹å¤–ï¼Œå¹¶ä¸”éœ€è¦é‡æ–°å¯åŠ¨Dockerã€‚</p><p>è‡ªå®šä¹‰çš„ç½‘æ¡¥æ˜¯é€šè¿‡ docker network createåˆ›å»ºå’Œé…ç½®çš„ã€‚å¦‚æœä¸åŒçš„åº”ç”¨ç¨‹åºç»„å…·æœ‰ä¸åŒçš„ç½‘ç»œè¦æ±‚ï¼Œåˆ™å¯ä»¥åœ¨åˆ›å»ºæ—¶åˆ†åˆ«é…ç½®æ¯ä¸ªè‡ªå®šä¹‰çš„ç½‘æ¡¥ã€‚</p><h4 id="é»˜è®¤ç½‘æ¡¥ç½‘ç»œä¸Šçš„é“¾æ¥å®¹å™¨å…±äº«ç¯å¢ƒå˜é‡"><a href="#é»˜è®¤ç½‘æ¡¥ç½‘ç»œä¸Šçš„é“¾æ¥å®¹å™¨å…±äº«ç¯å¢ƒå˜é‡" class="headerlink" title="é»˜è®¤ç½‘æ¡¥ç½‘ç»œä¸Šçš„é“¾æ¥å®¹å™¨å…±äº«ç¯å¢ƒå˜é‡"></a>é»˜è®¤ç½‘æ¡¥ç½‘ç»œä¸Šçš„é“¾æ¥å®¹å™¨å…±äº«ç¯å¢ƒå˜é‡</h4><p>æœ€åˆï¼Œåœ¨ä¸¤ä¸ªå®¹å™¨ä¹‹é—´å…±äº«ç¯å¢ƒå˜é‡çš„å”¯ä¸€æ–¹æ³•æ˜¯ä½¿ç”¨â€“linké“¾æ¥å®ƒä»¬ã€‚è‡ªå®šä¹‰ç½‘ç»œæ— æ³•è¿›è¡Œè¿™ç§ç±»å‹çš„å˜é‡å…±äº«ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨å…±äº«ç¯å¢ƒå˜é‡çš„é«˜çº§æ–¹æ³•ã€‚</p><ul><li>å¤šä¸ªå®¹å™¨å¯ä»¥ä½¿ç”¨Dockerå·æŒ‚è½½åŒ…å«å…±äº«ä¿¡æ¯çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚</li><li>ä½¿ç”¨å¯ä»¥ä¸€èµ·å¯åŠ¨å¤šä¸ªå®¹å™¨docker-composeï¼Œå¹¶ä¸”composeæ–‡ä»¶å¯ä»¥å®šä¹‰å…±äº«å˜é‡(æ¨èé…ç½®)ã€‚</li><li>æ‚¨å¯ä»¥ä½¿ç”¨é›†ç¾¤æœåŠ¡æ¥ä»£æ›¿ç‹¬ç«‹å®¹å™¨ï¼Œå¹¶åˆ©ç”¨å…±äº«é…ç½®(åˆ†å¸ƒå¼å…±äº«)ã€‚</li></ul><p>è¿æ¥åˆ°åŒä¸€è‡ªå®šä¹‰ç½‘æ¡¥çš„å®¹å™¨å¯ä»¥æœ‰æ•ˆåœ°å°†æ‰€æœ‰ç«¯å£å½¼æ­¤å…¬å¼€ã€‚ä¸ºäº†ä½¿å®¹å™¨æˆ–ä¸åŒç½‘ç»œä¸Šçš„éDockerä¸»æœºå¯ä»¥è®¿é—®è¯¥ç«¯å£ï¼Œå¿…é¡»ä½¿ç”¨-pæˆ–â€“publishæ¥å‘å¸ƒè¯¥ç«¯å£ã€‚</p><h3 id="ä½¿ç”¨è‡ªå®šä¹‰ç½‘æ¡¥"><a href="#ä½¿ç”¨è‡ªå®šä¹‰ç½‘æ¡¥" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰ç½‘æ¡¥"></a>ä½¿ç”¨è‡ªå®šä¹‰ç½‘æ¡¥</h3><p>ä½¿ç”¨docker network createå‘½ä»¤åˆ›å»ºè‡ªå®šä¹‰ç½‘æ¡¥,åœ¨ä¸é€‰æ‹©ä»»ä½•é…ç½®çš„æƒ…å†µåˆ›å»ºçš„å°±æ˜¯ç½‘æ¡¥æ¨¡å¼ï¼Œæ‚¨è¿˜å¯ä»¥æŒ‡å®šå­ç½‘ï¼ŒIPåœ°å€èŒƒå›´ï¼Œç½‘å…³å’Œå…¶ä»–é€‰é¡¹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create my-net</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨docker network rmå‘½ä»¤åˆ é™¤ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥ç½‘ç»œã€‚å¦‚æœå®¹å™¨å½“å‰å·²è¿æ¥åˆ°ç½‘ç»œï¼Œè¯·å…ˆæ–­å¼€å®ƒä»¬çš„è¿æ¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network rm my-net</span><br></pre></td></tr></table></figure><h4 id="å°†å®¹å™¨è¿æ¥åˆ°ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥"><a href="#å°†å®¹å™¨è¿æ¥åˆ°ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥" class="headerlink" title="å°†å®¹å™¨è¿æ¥åˆ°ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥"></a>å°†å®¹å™¨è¿æ¥åˆ°ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥</h4><p>åˆ›å»ºæ–°å®¹å™¨æ—¶ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªâ€“networkå‚æ•°ã€‚æ­¤ç¤ºä¾‹å°†Nginxå®¹å™¨è¿æ¥åˆ°my-netç½‘ç»œã€‚å®ƒè¿˜å°†å®¹å™¨ä¸­çš„ç«¯å£80å‘å¸ƒåˆ°Dockerä¸»æœºä¸Šçš„ç«¯å£8080ï¼Œ</p><p>å› æ­¤å¤–éƒ¨å®¢æˆ·ç«¯å¯ä»¥è®¿é—®è¯¥ç«¯å£ã€‚è¿æ¥åˆ°my-netç½‘ç»œçš„ä»»ä½•å…¶ä»–å®¹å™¨éƒ½å¯ä»¥è®¿é—®my-nginxå®¹å™¨ä¸Šçš„æ‰€æœ‰ç«¯å£ï¼Œåä¹‹äº¦ç„¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker create --name my-nginx \</span><br><span class="line">  --network my-net \</span><br><span class="line">  --publish 8080:80 \</span><br><span class="line">  nginx:latest</span><br></pre></td></tr></table></figure><p>è¦å°†è¿è¡Œä¸­çš„å®¹å™¨è¿æ¥åˆ°ç°æœ‰çš„ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥ï¼Œè¯·ä½¿ç”¨docker network connectå‘½ä»¤ã€‚ä»¥ä¸‹å‘½ä»¤å°†ä¸€ä¸ªå·²ç»åœ¨è¿è¡Œçš„my-nginxå®¹å™¨è¿æ¥åˆ°ä¸€ä¸ªå·²ç»å­˜åœ¨çš„my-netç½‘ç»œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect my-net my-nginx</span><br></pre></td></tr></table></figure><h4 id="æ–­å¼€å®¹å™¨ä¸ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥çš„è¿æ¥"><a href="#æ–­å¼€å®¹å™¨ä¸ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥çš„è¿æ¥" class="headerlink" title="æ–­å¼€å®¹å™¨ä¸ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥çš„è¿æ¥"></a>æ–­å¼€å®¹å™¨ä¸ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥çš„è¿æ¥</h4><p>è¦å°†è¿è¡Œä¸­çš„å®¹å™¨ä¸ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥æ–­å¼€è¿æ¥ï¼Œè¯·ä½¿ç”¨docker networkæ–­å¼€å‘½ä»¤ã€‚ä»¥ä¸‹å‘½ä»¤å°†my-nginxå®¹å™¨ä¸my-netç½‘ç»œæ–­å¼€è¿æ¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network disconnect my-net my-nginx</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨é»˜è®¤ç½‘æ¡¥"><a href="#ä½¿ç”¨é»˜è®¤ç½‘æ¡¥" class="headerlink" title="ä½¿ç”¨é»˜è®¤ç½‘æ¡¥"></a>ä½¿ç”¨é»˜è®¤ç½‘æ¡¥</h3><p>é»˜è®¤ç½‘æ¡¥è¢«è®¤ä¸ºæ˜¯Dockerçš„é—ç•™ç»†èŠ‚ï¼Œä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚å¯¹å…¶è¿›è¡Œé…ç½®éœ€è¦æ‰‹åŠ¨æ“ä½œï¼Œå­˜åœ¨æŠ€æœ¯ç¼ºé™·ã€‚</p><h4 id="å°†å®¹å™¨è¿æ¥åˆ°é»˜è®¤ç½‘æ¡¥"><a href="#å°†å®¹å™¨è¿æ¥åˆ°é»˜è®¤ç½‘æ¡¥" class="headerlink" title="å°†å®¹å™¨è¿æ¥åˆ°é»˜è®¤ç½‘æ¡¥"></a>å°†å®¹å™¨è¿æ¥åˆ°é»˜è®¤ç½‘æ¡¥</h4><p>å¦‚æœæ‚¨æœªä½¿ç”¨â€“networkæ ‡å¿—æŒ‡å®šç½‘ç»œï¼Œè€Œæ˜¯æŒ‡å®šäº†ç½‘ç»œé©±åŠ¨ç¨‹åºï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨çš„å®¹å™¨å°†è¿æ¥åˆ°é»˜è®¤ç½‘æ¡¥ç½‘ç»œã€‚é™¤éä½¿ç”¨æ—§ç‰ˆâ€“linkæ ‡å¿—è¿›è¡Œé“¾æ¥ï¼Œå¦åˆ™è¿æ¥åˆ°é»˜è®¤ç½‘æ¡¥ç½‘ç»œçš„å®¹å™¨åªèƒ½é€šè¿‡IPåœ°å€è¿›è¡Œé€šä¿¡ã€‚</p><h4 id="é…ç½®é»˜è®¤ç½‘æ¡¥ç½‘ç»œ"><a href="#é…ç½®é»˜è®¤ç½‘æ¡¥ç½‘ç»œ" class="headerlink" title="é…ç½®é»˜è®¤ç½‘æ¡¥ç½‘ç»œ"></a>é…ç½®é»˜è®¤ç½‘æ¡¥ç½‘ç»œ</h4><p>è¦é…ç½®é»˜è®¤çš„æ¡¥æ¥ç½‘ç»œï¼Œè¯·åœ¨daemon.jsonä¸­æŒ‡å®šé€‰é¡¹ã€‚è¿™æ˜¯ä¸€ä¸ªdaemon.jsonç¤ºä¾‹ï¼Œå…¶ä¸­æŒ‡å®šäº†å¤šä¸ªé€‰é¡¹ã€‚ä»…æŒ‡å®šæ‚¨éœ€è¦è‡ªå®šä¹‰çš„è®¾ç½®ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;bip&quot;: &quot;192.168.1.5&#x2F;24&quot;,</span><br><span class="line">  &quot;fixed-cidr&quot;: &quot;192.168.1.5&#x2F;25&quot;,</span><br><span class="line">  &quot;fixed-cidr-v6&quot;: &quot;2001:db8::&#x2F;64&quot;,</span><br><span class="line">  &quot;mtu&quot;: 1500,</span><br><span class="line">  &quot;default-gateway&quot;: &quot;10.20.1.1&quot;,</span><br><span class="line">  &quot;default-gateway-v6&quot;: &quot;2001:db8:abcd::89&quot;,</span><br><span class="line">  &quot;dns&quot;: [&quot;10.20.1.2&quot;,&quot;10.20.1.3&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°å¯åŠ¨Dockerä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚</p><h3 id="ç½‘æ¡¥åº•å±‚åŸç†"><a href="#ç½‘æ¡¥åº•å±‚åŸç†" class="headerlink" title="ç½‘æ¡¥åº•å±‚åŸç†"></a>ç½‘æ¡¥åº•å±‚åŸç†</h3><p>åˆ›å»ºæˆ–åˆ é™¤ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥æˆ–å°†å®¹å™¨ä¸ç”¨æˆ·å®šä¹‰çš„ç½‘æ¡¥è¿æ¥æˆ–æ–­å¼€è¿æ¥æ—¶ï¼Œdockerä½¿ç”¨æŒ‡å®šæ“ä½œç³»ç»Ÿçš„å·¥å…·æ¥ç®¡ç†åŸºç¡€ç½‘ç»œåŸºç¡€ç»“æ„ï¼ˆä¾‹å¦‚ï¼Œåœ¨Linuxä¸Šæ·»åŠ æˆ–åˆ é™¤æ¡¥æ¥è®¾å¤‡æˆ–é…ç½®iptablesè§„åˆ™ï¼‰ã€‚è¿™äº›ç»†èŠ‚åº”è§†ä¸ºå®æ–½ç»†èŠ‚ã€‚è®©Dockerä¸ºæ‚¨ç®¡ç†ç”¨æˆ·å®šä¹‰çš„ç½‘ç»œã€‚</p><h3 id="å¼€å¯ä»Dockerå®¹å™¨åˆ°å¤–ç•Œçš„è½¬å‘è§„åˆ™"><a href="#å¼€å¯ä»Dockerå®¹å™¨åˆ°å¤–ç•Œçš„è½¬å‘è§„åˆ™" class="headerlink" title="å¼€å¯ä»Dockerå®¹å™¨åˆ°å¤–ç•Œçš„è½¬å‘è§„åˆ™"></a>å¼€å¯ä»Dockerå®¹å™¨åˆ°å¤–ç•Œçš„è½¬å‘è§„åˆ™</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¥è‡ªè¿æ¥åˆ°é»˜è®¤ç½‘æ¡¥ç½‘ç»œçš„å®¹å™¨çš„æµé‡ä¸ä¼šè½¬å‘åˆ°å¤–ç•Œã€‚è¦å¯ç”¨è½¬å‘ï¼Œæ‚¨éœ€è¦æ›´æ”¹ä¸¤ä¸ªè®¾ç½®ã€‚è¿™äº›ä¸æ˜¯Dockerå‘½ä»¤ï¼Œå®ƒä»¬ä¼šå½±å“Dockerä¸»æœºçš„å†…æ ¸ã€‚</p><ul><li>é…ç½®Linuxå†…æ ¸ä»¥å…è®¸IPè½¬å‘</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl net.ipv4.conf.all.forwarding&#x3D;1</span><br></pre></td></tr></table></figure><ul><li>å°†iptables FORWARDç­–ç•¥çš„ç­–ç•¥ä»DROPæ›´æ”¹ä¸ºACCEPT<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -P FORWARD ACCEPT</span><br></pre></td></tr></table></figure></li></ul><p>è¿™äº›è®¾ç½®ä¸ä¼šåœ¨é‡æ–°å¯åŠ¨åæŒç»­å­˜åœ¨ï¼Œå› æ­¤æ‚¨å¯èƒ½éœ€è¦å°†å®ƒä»¬æ·»åŠ åˆ°å¯åŠ¨è„šæœ¬ä¸­ã€‚</p><h2 id="overlay-networks"><a href="#overlay-networks" class="headerlink" title="overlay networks"></a>overlay networks</h2><p>è¦†ç›–ç½‘ç»œé©±åŠ¨ç¨‹åºä¼šåœ¨å¤šä¸ªDockerå®ˆæŠ¤ç¨‹åºä¸»æœºä¹‹é—´åˆ›å»ºä¸€ä¸ªåˆ†å¸ƒå¼ç½‘ç»œã€‚è¯¥ç½‘ç»œä½äºç‰¹å®šäºä¸»æœºçš„ç½‘ç»œä¹‹ä¸Šï¼ˆè¦†ç›–ä¸»æœºç½‘ç»œï¼‰ï¼Œå¯ç”¨åŠ å¯†åï¼Œå…è®¸ä¸å…¶è¿æ¥çš„å®¹å™¨ï¼ˆåŒ…æ‹¬ç¾¤é›†æœåŠ¡å®¹å™¨ï¼‰è¿›è¡Œå®‰å…¨é€šä¿¡ã€‚</p><p>Dockeré€æ˜åœ°å¤„ç†æ¯ä¸ªæ•°æ®åŒ…ä¸æ­£ç¡®çš„Dockerå®ˆæŠ¤ç¨‹åºä¸»æœºå’Œæ­£ç¡®çš„ç›®æ ‡å®¹å™¨ä¹‹é—´çš„è·¯ç”±ã€‚</p><p>åˆå§‹åŒ–ç¾¤é›†æˆ–å°†Dockerä¸»æœºåŠ å…¥ç°æœ‰ç¾¤é›†æ—¶ï¼Œå°†åœ¨è¯¥Dockerä¸»æœºä¸Šåˆ›å»ºä¸¤ä¸ªæ–°ç½‘ç»œï¼š</p><ul><li>ä¸€ä¸ªåä¸ºIngressçš„è¦†ç›–ç½‘ç»œï¼Œç”¨äºå¤„ç†ä¸é›†ç¾¤æœåŠ¡ç›¸å…³çš„æ§åˆ¶å’Œæ•°æ®æµé‡ã€‚åˆ›å»ºç¾¤é›†æœåŠ¡å¹¶ä¸”ä¸å°†å…¶è¿æ¥åˆ°ç”¨æˆ·å®šä¹‰çš„è¦†ç›–ç½‘ç»œæ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒå°†è¿æ¥åˆ°Ingressã€‚</li><li>ä¸€ä¸ªåä¸ºdocker_gwbridgeçš„ç½‘æ¡¥ç½‘ç»œï¼Œè¯¥ç½‘ç»œå°†å„ä¸ªæœåŠ¡å™¨Dockerå®ˆæŠ¤ç¨‹åºè¿æ¥åˆ°è¯¥é›†ç¾¤ä¸­çš„å…¶ä»–å®ˆæŠ¤ç¨‹åºã€‚</li></ul><h3 id="åˆ›å»ºè¦†ç›–ç½‘ç»œçš„å…ˆå†³æ¡ä»¶"><a href="#åˆ›å»ºè¦†ç›–ç½‘ç»œçš„å…ˆå†³æ¡ä»¶" class="headerlink" title="åˆ›å»ºè¦†ç›–ç½‘ç»œçš„å…ˆå†³æ¡ä»¶"></a>åˆ›å»ºè¦†ç›–ç½‘ç»œçš„å…ˆå†³æ¡ä»¶</h3><p>ä½¿ç”¨è¦†ç›–ç½‘ç»œçš„Dockerå®ˆæŠ¤ç¨‹åºçš„é˜²ç«å¢™è§„åˆ™<br>æ‚¨éœ€è¦æ‰“å¼€ä»¥ä¸‹ç«¯å£ï¼Œä»¥å¾€è¿”äºå‚ä¸è¦†ç›–ç½‘ç»œçš„æ¯ä¸ªDockerä¸»æœºçš„æµé‡ï¼š</p><ul><li>ç”¨äºç¾¤é›†ç®¡ç†é€šä¿¡çš„TCPç«¯å£2377</li><li>TCPå’ŒUDPç«¯å£7946ï¼Œç”¨äºèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡</li><li>UDPç«¯å£4789ï¼Œç”¨äºè¦†ç›–ç½‘ç»œæµé‡</li></ul><p>åœ¨åˆ›å»ºè¦†ç›–ç½‘ç»œä¹‹å‰ï¼Œæ‚¨éœ€è¦ä½¿ç”¨åˆå§‹åŒ–Dockerå®ˆæŠ¤ç¨‹åºä½œä¸ºswarmç®¡ç†å™¨ï¼Œdocker swarm initæˆ–è€…ä½¿ç”¨å°†è¯¥Dockerå®ˆæŠ¤ç¨‹åºåŠ å…¥ç°æœ‰çš„swarm docker swarm joinã€‚è¿™ä¸¤ä¸ªéƒ½å°†åˆ›å»ºé»˜è®¤çš„ingressè¦†ç›–ç½‘ç»œï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç¾¤é›†æœåŠ¡ä¼šä½¿ç”¨è¯¥ è¦†ç›–ç½‘ç»œã€‚å³ä½¿æ‚¨ä»æœªè®¡åˆ’ä½¿ç”¨ç¾¤ä½“æœåŠ¡ï¼Œä¹Ÿéœ€è¦è¿™æ ·åšã€‚ä¹‹åï¼Œæ‚¨å¯ä»¥åˆ›å»ºå…¶ä»–ç”¨æˆ·å®šä¹‰çš„è¦†ç›–ç½‘ç»œã€‚</p><h3 id="ä½¿ç”¨è¦†ç›–ç½‘ç»œ"><a href="#ä½¿ç”¨è¦†ç›–ç½‘ç»œ" class="headerlink" title="ä½¿ç”¨è¦†ç›–ç½‘ç»œ"></a>ä½¿ç”¨è¦†ç›–ç½‘ç»œ</h3><p>å®˜æ–¹æ–‡æ¡£è®²äº†ä¸€ä¸ªé€šä¿—æ˜“æ‡‚çš„ä¾‹å­ï¼š</p><p>éœ€è¦ä¸‰å°ç‰©ç†æˆ–è™šæ‹ŸDockerä¸»æœºï¼Œå®ƒä»¬å¯ä»¥ç›¸äº’é€šä¿¡ï¼Œå¹¶ä¸”éƒ½è¿è¡ŒDocker 17.03æˆ–æ›´é«˜ç‰ˆæœ¬çš„æ–°å®‰è£…ã€‚æœ¬æ•™ç¨‹å‡å®šè¿™ä¸‰å°ä¸»æœºåœ¨åŒä¸€ç½‘ç»œä¸Šè¿è¡Œï¼Œå¹¶ä¸”ä¸æ¶‰åŠé˜²ç«å¢™ã€‚</p><p>è¿™äº›ä¸»æœºå°†è¢«ç§°ä¸ºmanagerï¼Œworker-1å’Œworker-2ã€‚è¯¥ managerä¸»æœºå°†ä½œä¸ºæ—¢æ˜¯ç»ç†å’Œå·¥äººï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥è¿è¡ŒæœåŠ¡ä»»åŠ¡å’Œç®¡ç†ç¾¤ã€‚worker-1å¹¶ä¸”worker-2å°†ä½œä¸ºå”¯ä¸€çš„å·¥äºº</p><p>ç„¶åé€šè¿‡ä¸€ç³»åˆ—å‘½ä»¤ï¼Œåˆ›å»ºé›†ç¾¤ï¼ŒåŠ å…¥é›†ç¾¤ï¼Œåˆ›å»ºæœåŠ¡ï¼Œè¿æ¥æœåŠ¡å³å¯ã€‚</p><p>çœ‹åˆ°è¿™ï¼Œå¦‚æœä½ äº†è§£è¿‡kubernetesï¼Œæ˜¯ä¸æ˜¯ä¼šå‘ç°Dockerçš„è¦†ç›–ç½‘ç»œå’ŒKubernetesæœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œ(è™½ç„¶æˆ‘è¿˜æ²¡ä»”ç»†äº†è§£kubernetesçš„ç½‘ç»œï¼Œä½†æ˜¯æˆ‘å·²ç»æ˜æ˜¾æ„Ÿè§‰åˆ°kuberneteså°±æ˜¯åŠ å¼ºç‰ˆè¿™ç§è¦†ç›–ç½‘ç»œçš„ä½¿ç”¨ï¼ŒåæœŸç»§ç»­æ·±æŒ–ä¸»æœºä¹‹é—´çš„ç½‘ç»œé€šä¿¡åŸç†)</p><p>å…·ä½“å®ç°å¯ä»¥æŸ¥çœ‹<br><a href="https://docs.docker.com/network/network-tutorial-overlay/" target="_blank" rel="noopener">è¦†ç›–ç½‘ç»œå®˜æ–¹æ•™ç¨‹</a></p><h2 id="host-networks"><a href="#host-networks" class="headerlink" title="host networks"></a>host networks</h2><p>å¦‚æœæ‚¨å¯¹å®¹å™¨ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œåˆ™è¯¥å®¹å™¨çš„ç½‘ç»œå †æ ˆä¸ä¼šä¸Dockerä¸»æœºéš”ç¦»ï¼ˆè¯¥å®¹å™¨å…±äº«ä¸»æœºçš„ç½‘ç»œåç§°ç©ºé—´ï¼‰ï¼Œå¹¶ä¸”è¯¥å®¹å™¨ä¸ä¼šåˆ†é…è‡ªå·±çš„IPåœ°å€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è¿è¡Œä¸€ä¸ªç»‘å®šåˆ°ç«¯å£80 host çš„å®¹å™¨å¹¶ä½¿ç”¨ç½‘ç»œï¼Œåˆ™è¯¥å®¹å™¨çš„åº”ç”¨ç¨‹åºåœ¨ä¸»æœºIPåœ°å€ä¸Šçš„ç«¯å£80ä¸Šå¯ç”¨ã€‚</p><p>æ³¨æ„ï¼ï¼ï¼</p><p>ç”±äºä½¿ç”¨æ—¶å®¹å™¨ä¸æ‹¥æœ‰è‡ªå·±çš„IPåœ°å€ hostæ¨¡å¼çš„ç½‘ç»œï¼Œç«¯å£æ˜ å°„ä¸ç”Ÿæ•ˆï¼Œå¹¶ä¸”-pï¼Œâ€“publishï¼Œ-Pï¼Œå’Œâ€“publish-allé€‰é¡¹éƒ½å°†è¢«å¿½ç•¥ï¼Œå¹¶ä¸”äº§ç”Ÿä¸€ä¸ªè­¦å‘Šï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WARNING: Published ports are discarded when using host network mode</span><br></pre></td></tr></table></figure><p>ä¸»æœºæ¨¡å¼ç½‘ç»œå¯¹äºä¼˜åŒ–æ€§èƒ½ä»¥åŠåœ¨å®¹å™¨éœ€è¦å¤„ç†å¤§é‡ç«¯å£çš„æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒä¸éœ€è¦ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ï¼Œå¹¶ä¸”ä¸ä¼šä¸ºæ¯ä¸ªç«¯å£åˆ›å»ºâ€userland-proxyâ€ã€‚</p><p>é€šè¿‡å°†â€“network hostä¼ é€’ç»™docker service createå‘½ä»¤ï¼Œæ‚¨è¿˜å¯ä»¥å°†ä¸»æœºç½‘ç»œç”¨äºç¾¤é›†æœåŠ¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ§åˆ¶æµé‡ï¼ˆä¸ç®¡ç†ç¾¤é›†å’ŒæœåŠ¡æœ‰å…³çš„æµé‡ï¼‰ä»ä¼šé€šè¿‡è¦†ç›–ç½‘ç»œå‘é€ï¼Œä½†æ˜¯å•ä¸ªç¾¤é›†æœåŠ¡å®¹å™¨ä¼šä½¿ç”¨Dockerå®ˆæŠ¤ç¨‹åºçš„ä¸»æœºç½‘ç»œå’Œç«¯å£å‘é€æ•°æ®ã€‚è¿™å¸¦æ¥äº†ä¸€äº›é¢å¤–çš„é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœåŠ¡å®¹å™¨ç»‘å®šåˆ°ç«¯å£80ï¼Œåˆ™åœ¨ç»™å®šçš„ç¾¤é›†èŠ‚ç‚¹ä¸Šåªèƒ½è¿è¡Œä¸€ä¸ªæœåŠ¡å®¹å™¨ã€‚</p><p><a href="https://docs.docker.com/network/host/" target="_blank" rel="noopener">ä¸»æœºç½‘ç»œå®˜æ–¹æ•™ç¨‹</a></p><h2 id="macvlan-networks"><a href="#macvlan-networks" class="headerlink" title="macvlan networks"></a>macvlan networks</h2><p>æŸäº›åº”ç”¨ç¨‹åºï¼Œå°¤å…¶æ˜¯æ—§ç‰ˆåº”ç”¨ç¨‹åºæˆ–ç›‘è§†ç½‘ç»œæµé‡çš„åº”ç”¨ç¨‹åºï¼ŒæœŸæœ›ç›´æ¥è¿æ¥åˆ°ç‰©ç†ç½‘ç»œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨macvlanç½‘ç»œé©±åŠ¨ç¨‹åºä¸ºæ¯ä¸ªå®¹å™¨çš„è™šæ‹Ÿç½‘ç»œæ¥å£åˆ†é…MACåœ°å€ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒæ˜¯ç›´æ¥è¿æ¥åˆ°ç‰©ç†ç½‘ç»œçš„ç‰©ç†ç½‘ç»œæ¥å£ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦åœ¨Dockerä¸»æœºä¸ŠæŒ‡å®šç”¨äºmacvlançš„ç‰©ç†æ¥å£ï¼Œä»¥åŠçš„å­ç½‘å’Œç½‘å…³ã€‚</p><p>æ‚¨ç”šè‡³å¯ä»¥macvlanä½¿ç”¨ä¸åŒçš„ç‰©ç†ç½‘ç»œæ¥å£éš”ç¦»ç½‘ç»œã€‚è¯·è®°ä½ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li><p>ç”±äºIPåœ°å€è€—å°½æˆ–â€œ VLANæ‰©æ•£â€ï¼Œå¾ˆå®¹æ˜“æ— æ„é—´æŸåæ‚¨çš„ç½‘ç»œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨çš„ç½‘ç»œä¸­æœ‰å¤§é‡ä¸æ­£ç¡®çš„å”¯ä¸€MACåœ°å€ã€‚</p></li><li><p>æ‚¨çš„ç½‘ç»œè®¾å¤‡éœ€è¦èƒ½å¤Ÿå¤„ç†â€œæ··æ‚æ¨¡å¼â€ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œå¯ä»¥ä¸ºä¸€ä¸ªç‰©ç†æ¥å£åˆ†é…å¤šä¸ªMACåœ°å€ã€‚</p></li><li><p>å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ç½‘æ¡¥ï¼ˆåœ¨å•ä¸ªDockerä¸»æœºä¸Šï¼‰æˆ–è¦†ç›–ï¼ˆè·¨å¤šä¸ªDockerä¸»æœºè¿›è¡Œé€šä¿¡ï¼‰å·¥ä½œï¼Œé‚£ä¹ˆä»é•¿è¿œæ¥çœ‹ï¼Œè¿™äº›è§£å†³æ–¹æ¡ˆå¯èƒ½ä¼šæ›´å¥½ã€‚</p></li></ul><p>å…·ä½“å®ç°å¯ä»¥çœ‹<br><a href="https://docs.docker.com/network/macvlan/" target="_blank" rel="noopener">macvlanç½‘ç»œå®˜æ–¹æ•™ç¨‹</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¯¹äºDockeræ¥è¯´ï¼ŒæŒæ¡å¥½ç½‘æ¡¥æ¨¡å¼è¶³å¤Ÿï¼Œè¦†ç›–ç½‘ç»œä¼šæœ‰æ›´å¥½çš„æ›¿ä»£å®¹å™¨ç¼–æ’å·¥å…·(k8s),macç½‘ç»œå’Œä¸»æœºç½‘ç»œç”¨çš„ä¹Ÿè¾ƒå°‘ã€‚</p><h1 id="Docker-Network-CLI"><a href="#Docker-Network-CLI" class="headerlink" title="Docker Network CLI"></a>Docker Network CLI</h1><p>ç®¡ç†ç½‘ç»œã€‚æ‚¨å¯ä»¥ä½¿ç”¨å­å‘½ä»¤æ¥åˆ›å»ºï¼Œæ£€æŸ¥ï¼Œåˆ—å‡ºï¼Œåˆ é™¤ï¼Œä¿®å‰ªï¼Œè¿æ¥å’Œæ–­å¼€ç½‘ç»œè¿æ¥ã€‚</p><p>ç”¨æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network COMMAND</span><br></pre></td></tr></table></figure><p>COMMANDå­å‘½ä»¤</p><table><thead><tr><th>COMMAND</th><th>æè¿°</th></tr></thead><tbody><tr><td>docker network connect</td><td>å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œ</td></tr><tr><td>docker network create</td><td>å»ºç«‹ç½‘ç»œ</td></tr><tr><td>docker network disconnect</td><td>æ–­å¼€å®¹å™¨ä¸ç½‘ç»œçš„è¿æ¥</td></tr><tr><td>docker network inspect</td><td>æ˜¾ç¤ºç½‘ç»œçš„è¯¦ç»†ä¿¡æ¯</td></tr><tr><td>docker network ls</td><td>åˆ—å‡ºç½‘ç»œ</td></tr><tr><td>docker network rm</td><td>åˆ é™¤ç½‘ç»œ</td></tr></tbody></table><h2 id="docker-network-connect"><a href="#docker-network-connect" class="headerlink" title="docker network connect"></a>docker network connect</h2><p>å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect [OPTIONS] NETWORK CONTAINER</span><br></pre></td></tr></table></figure><table><thead><tr><th>OPTIONS</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“alias</td><td>ä¸ºå®¹å™¨æ·»åŠ ç½‘ç»œçš„åˆ«å</td></tr><tr><td>â€“driver-opt</td><td>ç½‘ç»œçš„é©±åŠ¨ç¨‹åºé€‰é¡¹</td></tr><tr><td>â€“ip</td><td>æŒ‡å®šè¦åˆ†é…ç»™å®¹å™¨æ¥å£çš„IPåœ°å€</td></tr><tr><td>â€“link</td><td>å°†é“¾æ¥æ·»åŠ åˆ°å¦ä¸€ä¸ªå®¹å™¨</td></tr></tbody></table><p>ä¾‹å­ï¼š</p><ul><li>å°†æ­£åœ¨è¿è¡Œçš„å®¹å™¨è¿æ¥åˆ°ç½‘ç»œ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect redis-network redis</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨å®¹å™¨æ—¶å°†å…¶è¿æ¥åˆ°ç½‘ç»œ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --network&#x3D;redis-network redis</span><br></pre></td></tr></table></figure><ul><li>æŒ‡å®šå®¹å™¨åœ¨ç»™å®šç½‘ç»œä¸Šå°†ä½¿ç”¨çš„IPåœ°å€</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect --ip 172.18.1.2 redis-network redis</span><br></pre></td></tr></table></figure><ul><li>ä¸ºå®¹å™¨åˆ›å»ºä¸€ä¸ªç½‘ç»œåˆ«å</li></ul><p>â€“alias é€‰é¡¹å¯ç”¨äºé€šè¿‡æ‰€è¿æ¥ç½‘ç»œä¸­çš„å¦ä¸€ä¸ªåç§°æ¥è§£æå®¹å™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect --alias redis6379 redis-network redis</span><br></pre></td></tr></table></figure><p>å¤„åœ¨redis-networkè¿™ä¸ªç½‘ç»œä¸­çš„å®¹å™¨å¯ä»¥é€šè¿‡redis6379å»è¿æ¥redis</p><ul><li>ä½¿ç”¨â€“linké€‰é¡¹</li></ul><p>æ‚¨å¯ä»¥ä½¿ç”¨â€“linké“¾æ¥å¦ä¸€ä¸ªå…·æœ‰é¦–é€‰åˆ«åçš„å®¹å™¨<br>docker network connect â€“link redis:redis6379 redis-network test</p><h2 id="docker-network-create"><a href="#docker-network-create" class="headerlink" title="docker network create"></a>docker network create</h2><p>åˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œã€‚åœ¨DRIVERé»˜è®¤çš„ç½‘ç»œé©±åŠ¨ç¨‹åºæ˜¯bridgeæˆ–è€…overlayã€‚å¦‚æœæ‚¨å®‰è£…äº†ç¬¬ä¸‰æ–¹æˆ–è‡ªå·±çš„è‡ªå®šä¹‰ç½‘ç»œé©±åŠ¨ç¨‹åºï¼Œåˆ™ä¹Ÿå¯ä»¥DRIVERåœ¨æ­¤å¤„æŒ‡å®šã€‚å¦‚æœæœªæŒ‡å®šè¯¥ â€“driveré€‰é¡¹ï¼Œè¯¥å‘½ä»¤å°†è‡ªåŠ¨ä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªç½‘æ¡¥ã€‚å½“æ‚¨å®‰è£…Docker Engineæ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªç½‘æ¡¥ã€‚è¯¥ç½‘ç»œå¯¹åº”äºDocker Engineä¼ ç»Ÿä¸Šä¾èµ–çš„ç½‘æ¡¥ã€‚å½“æ‚¨å¯åŠ¨ä¸€ä¸ªæ–°å®¹å™¨æ—¶ï¼Œ docker runå®ƒä¼šè‡ªåŠ¨è¿æ¥åˆ°è¯¥ç½‘æ¡¥ç½‘ç»œã€‚æ‚¨ä¸èƒ½åˆ é™¤æ­¤é»˜è®¤ç½‘æ¡¥ï¼Œä½†å¯ä»¥ä½¿ç”¨ä»¥ä¸‹network createå‘½ä»¤åˆ›å»ºæ–°çš„ç½‘æ¡¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create [OPTIONS] NETWORK</span><br></pre></td></tr></table></figure><table><thead><tr><th>OPTIONS</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“aux-address</td><td>ç½‘ç»œé©±åŠ¨ç¨‹åºä½¿ç”¨çš„è¾…åŠ©IPv4æˆ–IPv6åœ°å€</td></tr><tr><td>â€“driver , -d é»˜è®¤æ˜¯bridge</td><td>ç½‘ç»œçš„é©±åŠ¨ç¨‹åºé€‰é¡¹</td></tr><tr><td>â€“gateway</td><td>ä¸»å­ç½‘çš„IPv4æˆ–IPv6ç½‘å…³</td></tr><tr><td>â€“internal</td><td>é™åˆ¶å¤–éƒ¨è®¿é—®ç½‘ç»œ</td></tr><tr><td>â€“ip-range</td><td>ä»å­èŒƒå›´åˆ†é…å®¹å™¨ip</td></tr><tr><td>â€“subnet</td><td>ä»£è¡¨ç½‘æ®µçš„CIDRæ ¼å¼çš„å­ç½‘</td></tr></tbody></table><h3 id="é«˜çº§é€‰é¡¹"><a href="#é«˜çº§é€‰é¡¹" class="headerlink" title="é«˜çº§é€‰é¡¹"></a>é«˜çº§é€‰é¡¹</h3><p>ç½‘æ¡¥æ˜¯å•ä¸ªå¼•æ“å®‰è£…ä¸Šçš„éš”ç¦»ç½‘ç»œã€‚å¦‚æœè¦åˆ›å»ºä¸€ä¸ªè·¨è¶Šå¤šä¸ªè¿è¡Œä¸»æœºçš„Dockerä¸»æœºçš„overlayç½‘ç»œï¼Œåˆ™å¿…é¡»åˆ›å»ºä¸€ä¸ªç½‘ç»œã€‚ä¸ç½‘æ¡¥ä¸åŒï¼Œè¦†ç›–ç½‘ç»œéœ€è¦å…ˆå­˜åœ¨ä¸€äº›å…ˆå†³æ¡ä»¶æ‰èƒ½åˆ›å»ºä¸€ä¸ªã€‚è¿™äº›æ¡ä»¶å·²ç»åœ¨ä¸Šæ–‡è®²è¿‡ï¼Œä¸å†é‡å¤ï¼Œè¿™é‡Œä¸»è¦è®²åˆ›å»ºç½‘æ¡¥çš„å…·ä½“å†…å®¹ã€‚</p><p>åˆ›å»ºç½‘ç»œæ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¼•æ“ä¼šä¸ºè¯¥ç½‘ç»œåˆ›å»ºä¸€ä¸ªä¸é‡å çš„å­ç½‘ã€‚è¯¥å­ç½‘ä¸æ˜¯ç°æœ‰ç½‘ç»œçš„ç»†åˆ†ã€‚å®ƒä»…ç”¨äºipå¯»å€ç›®çš„ã€‚æ‚¨å¯ä»¥è¦†ç›–æ­¤é»˜è®¤å€¼ï¼Œå¹¶ä½¿ç”¨è¯¥â€“subneté€‰é¡¹ç›´æ¥æŒ‡å®šå­ç½‘å€¼ã€‚</p><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><ul><li>åœ¨ bridgeç½‘ç»œä¸Šï¼Œæ‚¨åªèƒ½åˆ›å»ºä¸€ä¸ªå­ç½‘ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create --driver&#x3D;bridge --subnet&#x3D;192.168.0.0&#x2F;16 redis-network</span><br></pre></td></tr></table></figure><ul><li>æ­¤å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®šâ€“gateway â€“ip-rangeå’Œâ€“aux-address é€‰é¡¹ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker network create \</span><br><span class="line">  --driver&#x3D;bridge \</span><br><span class="line">  --subnet&#x3D;172.28.0.0&#x2F;16 \</span><br><span class="line">  --ip-range&#x3D;172.28.5.0&#x2F;24 \</span><br><span class="line">  --gateway&#x3D;172.28.5.254 \</span><br><span class="line">  redis-network</span><br></pre></td></tr></table></figure><h2 id="docker-network-disconnect"><a href="#docker-network-disconnect" class="headerlink" title="docker network disconnect"></a>docker network disconnect</h2><p>æ–­å¼€å®¹å™¨ä¸ç½‘ç»œçš„è¿æ¥ï¼Œæ–­å¼€å®¹å™¨ä¸ç½‘ç»œçš„è¿æ¥ã€‚å®¹å™¨å¿…é¡»æ­£åœ¨è¿è¡Œæ‰èƒ½å°†å…¶ä¸ç½‘ç»œæ–­å¼€è¿æ¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker network disconnect [OPTIONS] NETWORK CONTAINER</span><br><span class="line"></span><br><span class="line">--force , -f å¼ºåˆ¶å®¹å™¨æ–­å¼€ç½‘ç»œè¿æ¥</span><br><span class="line"></span><br><span class="line">eg: docker network disconnect multi-host-network container1</span><br></pre></td></tr></table></figure><h2 id="docker-network-inspect"><a href="#docker-network-inspect" class="headerlink" title="docker network inspect"></a>docker network inspect</h2><p>æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªç½‘ç»œè¯¦ç»†ä¿¡æ¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤å‘½ä»¤å°†æ‰€æœ‰ç»“æœå‘ˆç°åœ¨JSONå¯¹è±¡ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect [OPTIONS] NETWORK [NETWORK...]</span><br><span class="line"></span><br><span class="line">--format , -f  ä½¿ç”¨ç»™å®šçš„Goæ¨¡æ¿æ ¼å¼åŒ–è¾“å‡º</span><br><span class="line">--verbose , -v è¯¦ç»†è¾“å‡ºä»¥è¿›è¡Œè¯Šæ–­</span><br></pre></td></tr></table></figure><h2 id="docker-network-ls"><a href="#docker-network-ls" class="headerlink" title="docker network ls"></a>docker network ls</h2><p>åˆ—å‡ºdaemonå¼•æ“çŸ¥é“çš„æ‰€æœ‰ç½‘ç»œã€‚è¿™åŒ…æ‹¬è·¨ç¾¤é›†ä¸­å¤šä¸ªä¸»æœºçš„ç½‘ç»œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network ls [OPTIONS]</span><br></pre></td></tr></table></figure><table><thead><tr><th>OPTIONS</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“filter , -f</td><td>æä¾›è¿‡æ»¤å™¨å€¼ï¼ˆä¾‹å¦‚â€œ driver = bridgeâ€ï¼‰</td></tr><tr><td>â€“format</td><td>ä½¿ç”¨Goæ¨¡æ¿çš„æ‰“å°ç½‘ç»œ</td></tr><tr><td>â€“no-trunc</td><td>ä¸è¦æˆªæ–­è¾“å‡º</td></tr><tr><td>â€“quiet , -q</td><td>ä»…æ˜¾ç¤ºç½‘ç»œID</td></tr></tbody></table><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">åˆ—å‡ºæ‰€æœ‰ç½‘ç»œï¼š</span><br><span class="line"></span><br><span class="line">docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER          SCOPE</span><br><span class="line">7fca4eb8c647        bridge              bridge          local</span><br><span class="line">9f904ee27bf5        none                null            local</span><br><span class="line">cf03ee007fb4        host                host            local</span><br><span class="line">78b03ee04fc4        multi-host          overlay         swarm</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨--no-truncé€‰é¡¹æ˜¾ç¤ºå®Œæ•´çš„ç½‘ç»œIDï¼š</span><br><span class="line"></span><br><span class="line">docker network ls --no-trunc</span><br><span class="line">NETWORK ID                                                         NAME                DRIVER           SCOPE</span><br><span class="line">18a2866682b85619a026c81b98a5e375bd33e1b0936a26cc497c283d27bae9b3   none                null             local</span><br><span class="line">c288470c46f6c8949c5f7e5099b5b7947b07eabe8d9a27d79a9cbf111adcbf47   host                host             local</span><br><span class="line">7b369448dccbf865d397c8d2be0cda7cf7edc6b0945f77d2529912ae917a0185   bridge              bridge           local</span><br><span class="line">95e74588f40db048e86320c6526440c504650a1ff3e9f7d60a497c4d2163e5bd   foo                 bridge           local</span><br><span class="line">63d1ff1f77b07ca51070a8c227e962238358bd310bde1529cf62e6c307ade161   dev                 bridge           local</span><br><span class="line"></span><br><span class="line">è¿‡æ»¤å™¨åŒ¹é…åŸºäºå…¶é©±åŠ¨ç¨‹åºçš„ç½‘ç»œã€‚</span><br><span class="line">docker network ls --filter driver&#x3D;bridge</span><br><span class="line">NETWORK ID          NAME                DRIVER            SCOPE</span><br><span class="line">db9db329f835        test1               bridge            local</span><br><span class="line">f6e212da9dfd        test2               bridge            local</span><br></pre></td></tr></table></figure><h2 id="docker-network-rm"><a href="#docker-network-rm" class="headerlink" title="docker network rm"></a>docker network rm</h2><p>æŒ‰åç§°æˆ–æ ‡è¯†ç¬¦åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªç½‘ç»œã€‚è¦åˆ é™¤ç½‘ç»œï¼Œå¿…é¡»é¦–å…ˆæ–­å¼€è¿æ¥åˆ°å®ƒçš„æ‰€æœ‰å®¹å™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network rm NETWORK [NETWORK...]</span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network rm my-network</span><br></pre></td></tr></table></figure><h1 id="Dockerå’ŒIptables-é‡ä¸­ä¹‹é‡"><a href="#Dockerå’ŒIptables-é‡ä¸­ä¹‹é‡" class="headerlink" title="Dockerå’ŒIptables(é‡ä¸­ä¹‹é‡)"></a>Dockerå’ŒIptables(é‡ä¸­ä¹‹é‡)</h1><p>åœ¨Linuxä¸Šï¼ŒDockeræ“çºµiptablesè§„åˆ™ä»¥æä¾›ç½‘ç»œéš”ç¦»ã€‚å°½ç®¡è¿™æ˜¯å®ç°çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶ä¸”æ‚¨ä¸åº”ä¿®æ”¹Dockeråœ¨iptablesç­–ç•¥ä¸­æ’å…¥çš„è§„åˆ™ï¼Œä½†æ˜¯å¦‚æœæ‚¨æƒ³è¦æ‹¥æœ‰è‡ªå·±çš„ç­–ç•¥ï¼ˆè€Œä¸æ˜¯ç”±Dockerç®¡ç†çš„ç­–ç•¥ï¼‰ï¼Œå®ƒç¡®å®ä¼šå¯¹æ‚¨éœ€è¦æ‰§è¡Œçš„æ“ä½œäº§ç”Ÿä¸€äº›å½±å“ã€‚</p><p>å¦‚æœæ‚¨åœ¨å·²æš´éœ²ç½‘ç»œçš„ä¸»æœºä¸Šè¿è¡ŒDockerï¼Œåˆ™å¯èƒ½éœ€è¦é‡‡ç”¨iptablesç­–ç•¥ï¼Œä»¥é˜²æ­¢æœªç»æˆæƒè®¿é—®æ‚¨ä¸»æœºä¸Šè¿è¡Œçš„å®¹å™¨æˆ–å…¶ä»–æœåŠ¡ã€‚ä¸‹é¢ä¸»è¦æè¿°å¦‚ä½•å®ç°æ­¤ç›®æ ‡ä»¥åŠéœ€è¦æ³¨æ„çš„æ³¨æ„äº‹é¡¹ã€‚</p><h2 id="å¯åŠ¨Dockerä¹‹å‰æ·»åŠ iptablesç­–ç•¥"><a href="#å¯åŠ¨Dockerä¹‹å‰æ·»åŠ iptablesç­–ç•¥" class="headerlink" title="å¯åŠ¨Dockerä¹‹å‰æ·»åŠ iptablesç­–ç•¥"></a>å¯åŠ¨Dockerä¹‹å‰æ·»åŠ iptablesç­–ç•¥</h2><p>Dockerå®‰è£…äº†ä¸¤ä¸ªiptablesé“¾ï¼Œåå«DOCKER-USER å’ŒDOCKERï¼Œå®ƒç¡®ä¿ä¼ å…¥çš„æ•°æ®åŒ…å§‹ç»ˆé¦–å…ˆç”±è¿™ä¸¤ä¸ªé“¾è¿›è¡Œæ£€æŸ¥ã€‚</p><p>æ‰‹åŠ¨æˆ–é€šè¿‡å…¶ä»–åŸºäºiptablesçš„é˜²ç«å¢™æ·»åŠ åˆ°FORWARDé“¾ä¸­çš„è§„åˆ™åœ¨è¿™äº›é“¾ä¹‹åè¿›è¡Œè¯„ä¼°ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæ‚¨é€šè¿‡Dockerå…¬å¼€ç«¯å£ï¼Œåˆ™æ— è®ºé˜²ç«å¢™é…ç½®äº†ä»€ä¹ˆè§„åˆ™ï¼Œè¯¥ç«¯å£éƒ½ä¼šå…¬å¼€ã€‚å¦‚æœæ‚¨å¸Œæœ›å³ä½¿åœ¨é€šè¿‡Dockerå…¬å¼€ç«¯å£æ—¶ä¹Ÿè¦åº”ç”¨è¿™äº›è§„åˆ™ï¼Œåˆ™å¿…é¡»å°†è¿™äº›è§„åˆ™æ·»åŠ åˆ°DOCKER-USERé“¾ä¸­ã€‚</p><h2 id="é™åˆ¶ä¸Dockerä¸»æœºçš„è¿æ¥"><a href="#é™åˆ¶ä¸Dockerä¸»æœºçš„è¿æ¥" class="headerlink" title="é™åˆ¶ä¸Dockerä¸»æœºçš„è¿æ¥"></a>é™åˆ¶ä¸Dockerä¸»æœºçš„è¿æ¥</h2><p>é»˜è®¤æƒ…å†µï¼Œå…è®¸æ‰€æœ‰å¤–éƒ¨IPè¿æ¥åˆ°Dockerä¸»æœºã€‚</p><p>è¦ä»…å…è®¸ç‰¹å®šçš„IPæˆ–ç½‘ç»œè®¿é—®å®¹å™¨ï¼Œè¯·åœ¨DOCKER-USERè¿‡æ»¤å™¨é“¾çš„é¡¶éƒ¨æ’å…¥ä¸€ä¸ªå¦å®šçš„è§„åˆ™ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢ä¸€ä¸ªè§„åˆ™é™åˆ¶äº†é™¤192.168.1.1ä¹‹å¤–çš„æ‰€æœ‰IPåœ°å€çš„å¤–éƒ¨è®¿é—®ï¼Œä¹Ÿå°±æ˜¯è¯´åªèƒ½æœ‰192.168.1.1æ‰èƒ½è®¿é—®è¿™ä¸ªå®¹å™¨å†…éƒ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -I DOCKER-USER -i ext_if ! -s 192.168.1.1 -j DROP</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œæ‚¨å°†éœ€è¦æ›´æ”¹ext_ifä»¥ä¸ä¸»æœºçš„å®é™…å¤–éƒ¨æ¥å£ç›¸å¯¹åº”ã€‚æ‚¨å¯ä»¥æ”¹ä¸ºå…è®¸æ¥æºå­ç½‘çš„è¿æ¥ã€‚ä»¥ä¸‹è§„åˆ™ä»…å…è®¸ä»å­ç½‘192.168.1.0/24è®¿é—®å®¹å™¨å†…éƒ¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -I DOCKER-USER -i ext_if ! -s 192.168.1.0&#x2F;24 -j DROP</span><br></pre></td></tr></table></figure><p>iptablesæ˜¯å¤æ‚çš„ï¼Œæ›´å¤æ‚çš„è§„åˆ™ä¸åœ¨æ­¤ä¸»é¢˜èŒƒå›´å†…ã€‚æœ‰å…³å®ƒçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://www.netfilter.org/documentation/HOWTO/NAT-HOWTO.html" target="_blank" rel="noopener">Netfilter.org HOWTO</a>ã€‚</p><p>è¿˜æœ‰å‡ ç§ç­–ç•¥å…·ä½“è¯·çœ‹ <a href="https://docs.docker.com/network/iptables/" target="_blank" rel="noopener">Dockerå’Œiptables</a></p><h2 id="é—®é¢˜å›é¡¾"><a href="#é—®é¢˜å›é¡¾" class="headerlink" title="é—®é¢˜å›é¡¾"></a>é—®é¢˜å›é¡¾</h2><p>æ­£å¥½å‰å‡ å¤©å‡ºç°äº†ä¸€ä¸ªDockerçš„ç½‘ç»œé—®é¢˜ï¼Œæ— æ³•å¯åŠ¨å®¹å™¨ï¼Œç°åœ¨æ¥å›é¡¾ä¸€ä¸‹</p><p>ä¸ºäº†è¯æ˜å¯åŠ¨Dockerä¹‹å‰æ·»åŠ iptablesç­–ç•¥è¿™ç‚¹éå¸¸é‡è¦ï¼Œæˆ‘åšäº†ä»¥ä¸‹å®éªŒã€‚</p><ul><li>è¿™å°ä¸»æœºåœ¨å¯åŠ¨dockerä¹‹å‰å·²ç»å…³é—­äº†é˜²ç«å¢™ï¼Œå¹¶ä¸”å·²è¿è¡Œäº†å‡ ä¸ªå®¹å™¨ï¼Œæ‰§è¡Œiptables å‘½ä»¤æŸ¥çœ‹é“¾è·¯ä¿¡æ¯ å‘ç°å­˜åœ¨å„ä¸ªå®¹å™¨æš´éœ²ç«¯å£çš„é“¾è·¯è§„åˆ™</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# iptables -L</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER-USER  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-1  all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain DOCKER (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     tcp  --  anywhere             172.17.0.2           tcp dpt:6379</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.2           tcp dpt:17010</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.2           tcp dpt:ups-onlinet</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.3           tcp dpt:17011</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.3           tcp dpt:talon-disc</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.4           tcp dpt:17012</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.4           tcp dpt:talon-engine</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.5           tcp dpt:17013</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.5           tcp dpt:microtalon-dis</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.6           tcp dpt:17014</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.6           tcp dpt:microtalon-com</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.7           tcp dpt:17015</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.7           tcp dpt:talon-webserver</span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-1 (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">RETURN     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-2 (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">RETURN     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain DOCKER-USER (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">RETURN     all  --  anywhere             anywhere</span><br></pre></td></tr></table></figure><ul><li>å¼€å¯é˜²ç«å¢™ï¼Œæ‰§è¡Œiptables å‘½ä»¤æŸ¥çœ‹é“¾è·¯ä¿¡æ¯ å‘ç°iptableså¥½åƒæ¢å¤å‡ºå‚é»˜è®¤äº†</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl start firewalld</span><br><span class="line">[root@localhost ~]# iptables -L</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">INPUT_direct  all  --  anywhere             anywhere            </span><br><span class="line">INPUT_ZONES_SOURCE  all  --  anywhere             anywhere            </span><br><span class="line">INPUT_ZONES  all  --  anywhere             anywhere            </span><br><span class="line">DROP       all  --  anywhere             anywhere             ctstate INVALID</span><br><span class="line">REJECT     all  --  anywhere             anywhere             reject-with icmp-host-prohibited</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">FORWARD_direct  all  --  anywhere             anywhere            </span><br><span class="line">FORWARD_IN_ZONES_SOURCE  all  --  anywhere             anywhere            </span><br><span class="line">FORWARD_IN_ZONES  all  --  anywhere             anywhere            </span><br><span class="line">FORWARD_OUT_ZONES_SOURCE  all  --  anywhere             anywhere            </span><br><span class="line">FORWARD_OUT_ZONES  all  --  anywhere             anywhere            </span><br><span class="line">DROP       all  --  anywhere             anywhere             ctstate INVALID</span><br><span class="line">REJECT     all  --  anywhere             anywhere             reject-with icmp-host-prohibited</span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">OUTPUT_direct  all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain FORWARD_IN_ZONES (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">FWDI_public  all  --  anywhere             anywhere            [goto] </span><br><span class="line">FWDI_public  all  --  anywhere             anywhere            [goto] </span><br><span class="line"></span><br><span class="line">Chain FORWARD_IN_ZONES_SOURCE (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FORWARD_OUT_ZONES (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">FWDO_public  all  --  anywhere             anywhere            [goto] </span><br><span class="line">FWDO_public  all  --  anywhere             anywhere            [goto] </span><br><span class="line"></span><br><span class="line">Chain FORWARD_OUT_ZONES_SOURCE (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FORWARD_direct (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FWDI_public (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">FWDI_public_log  all  --  anywhere             anywhere            </span><br><span class="line">FWDI_public_deny  all  --  anywhere             anywhere            </span><br><span class="line">FWDI_public_allow  all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     icmp --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain FWDI_public_allow (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FWDI_public_deny (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FWDI_public_log (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FWDO_public (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">FWDO_public_log  all  --  anywhere             anywhere            </span><br><span class="line">FWDO_public_deny  all  --  anywhere             anywhere            </span><br><span class="line">FWDO_public_allow  all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain FWDO_public_allow (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FWDO_public_deny (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FWDO_public_log (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain INPUT_ZONES (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">IN_public  all  --  anywhere             anywhere            [goto] </span><br><span class="line">IN_public  all  --  anywhere             anywhere            [goto] </span><br><span class="line"></span><br><span class="line">Chain INPUT_ZONES_SOURCE (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain INPUT_direct (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain IN_public (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">IN_public_log  all  --  anywhere             anywhere            </span><br><span class="line">IN_public_deny  all  --  anywhere             anywhere            </span><br><span class="line">IN_public_allow  all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     icmp --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain IN_public_allow (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ssh ctstate NEW</span><br><span class="line"></span><br><span class="line">Chain IN_public_deny (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain IN_public_log (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain OUTPUT_direct (1 references)</span><br><span class="line">target     prot opt source               destination</span><br></pre></td></tr></table></figure><ul><li>å…³é—­é˜²ç«å¢™ï¼Œæ‰§è¡Œiptables å‘½ä»¤æŸ¥çœ‹é“¾è·¯ä¿¡æ¯<br>å‘ç°iptablesé“¾è·¯ä¿¡æ¯å…¨éƒ¨è¢«æ¸…ç©º</li><li>å¯åŠ¨å®¹å™¨ æš´éœ²80ç«¯å£ï¼Œå‘ç°å¯åŠ¨å¤±è´¥</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl stop firewalld</span><br><span class="line">[root@localhost ~]# iptables -L</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker  run  -d -p 80:80 --volumes-from pmm-data --name pmm-server --restart always  percona&#x2F;pmm-server:latest</span><br><span class="line">f86d559846840468a45ec4b69b3cd4458854b2e9392e4e47b84430e420c59f7c</span><br><span class="line">docker: Error response from daemon: driver failed programming external connectivity on endpoint pmm-server (b5e49ead04279b9c1ab16609ed3fcb78d309fb2fcab001adda57a9bd45dc23d0):  (iptables failed: iptables --wait -t nat -A DOCKER -p tcp -d 0&#x2F;0 --dport 80 -j DNAT --to-destination 172.17.0.3:80 ! -i docker0: iptables: No chain&#x2F;target&#x2F;match by that name.</span><br><span class="line"> (exit status 1)).</span><br></pre></td></tr></table></figure><ul><li>é‡å¯dockeræœåŠ¡ç«¯ï¼Œæ‰§è¡Œiptables å‘½ä»¤æŸ¥çœ‹é“¾è·¯ä¿¡æ¯ï¼Œå‘ç°é‡æ–°å½•å…¥dockerç­–ç•¥</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl restart docker</span><br><span class="line">[root@localhost ~]# iptables -L</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER-USER  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-1  all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain DOCKER (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.2           tcp dpt:17014</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.2           tcp dpt:microtalon-com</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.3           tcp dpt:17015</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.4           tcp dpt:17010</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.5           tcp dpt:17012</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.3           tcp dpt:talon-webserver</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.4           tcp dpt:ups-onlinet</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.5           tcp dpt:talon-engine</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.6           tcp dpt:17013</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.7           tcp dpt:17011</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.6           tcp dpt:microtalon-dis</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.18.0.7           tcp dpt:talon-disc</span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-1 (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">RETURN     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-2 (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">RETURN     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain DOCKER-USER (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">RETURN     all  --  anywhere             anywhere</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä½ ä¸€å®šè¦åœ¨å¯åŠ¨Dockerä¹‹å‰å…³é—­é˜²ç«å¢™ï¼Œå¦åˆ™é‡æ–°å¯åŠ¨é˜²ç«å¢™å†å…³é—­ä¹Ÿä¸ä¼šè®©iptablesåŠ å…¥Dockeré“¾ï¼Œå”¯ä¸€çš„è§£å†³åŠæ³•å°±æ˜¯é‡å¯Dockerï¼Œè¿™å¯¹äºç”Ÿäº§ç¯å¢ƒæ¥è¯´æ˜¯æä¸ºå±é™©çš„(ä½ è¿™å°æœºå™¨ä¸Šçš„æ‰€æœ‰å®¹å™¨éƒ½å¾—é‡å¯)</p><h1 id="æ€»ç»“å½’çº³"><a href="#æ€»ç»“å½’çº³" class="headerlink" title="æ€»ç»“å½’çº³"></a>æ€»ç»“å½’çº³</h1><h2 id="å®¹å™¨ç½‘ç»œ"><a href="#å®¹å™¨ç½‘ç»œ" class="headerlink" title="å®¹å™¨ç½‘ç»œ"></a>å®¹å™¨ç½‘ç»œ</h2><p>å®¹å™¨ä½¿ç”¨çš„ç½‘ç»œç±»å‹ï¼Œæ— è®ºæ˜¯ç½‘æ¡¥ï¼Œä¸»æœºç½‘ç»œï¼Œ è¦†ç›–ç½‘ç»œï¼Œmacvlanç½‘ç»œè¿˜æ˜¯è‡ªå®šä¹‰ç½‘ç»œæ’ä»¶ï¼Œåœ¨å®¹å™¨å†…éƒ¨éƒ½æ˜¯é€æ˜çš„ã€‚ä»å®¹å™¨çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒå…·æœ‰ä¸€ä¸ªå¸¦æœ‰IPåœ°å€ï¼Œç½‘å…³ï¼Œè·¯ç”±è¡¨ï¼ŒDNSæœåŠ¡å’Œå…¶ä»–ç½‘ç»œè¯¦ç»†ä¿¡æ¯çš„ç½‘ç»œæ¥å£ï¼ˆå‡å®šå®¹å™¨æœªä½¿ç”¨noneç½‘ç»œé©±åŠ¨ç¨‹åºï¼‰ã€‚</p><h2 id="å‘å¸ƒç«¯å£"><a href="#å‘å¸ƒç«¯å£" class="headerlink" title="å‘å¸ƒç«¯å£"></a>å‘å¸ƒç«¯å£</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ›å»ºå®¹å™¨æ—¶ï¼Œå®ƒä¸ä¼šå°†å…¶ä»»ä½•ç«¯å£å‘å¸ƒåˆ°å¤–ç•Œã€‚è¦ä½¿ç«¯å£å¯ç”¨äºDockerå¤–éƒ¨çš„æœåŠ¡æˆ–æœªè¿æ¥åˆ°å®¹å™¨ç½‘ç»œçš„Dockerå®¹å™¨ï¼Œè¯·ä½¿ç”¨ â€“publishæˆ–-pæ ‡å¿—ã€‚è¿™å°†åˆ›å»ºä¸€ä¸ªé˜²ç«å¢™è§„åˆ™ï¼Œè¯¥è§„åˆ™å°†å®¹å™¨ç«¯å£æ˜ å°„åˆ°Dockerä¸»æœºä¸Šçš„ç«¯å£ã€‚è¿™é‡Œæœ‰äº›ä¾‹å­ã€‚</p><table><thead><tr><th>æ ‡å¿—å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>-p 8080:80</td><td>å°†å®¹å™¨ä¸­çš„TCPç«¯å£80æ˜ å°„åˆ°Dockerä¸»æœºä¸Šçš„ç«¯å£8080ã€‚</td></tr><tr><td>-p 192.168.1.100:8080:80</td><td>å°†å®¹å™¨ä¸­çš„TCPç«¯å£80æ˜ å°„åˆ°Dockerä¸»æœºä¸Šçš„ç«¯å£8080ï¼Œä»¥è¿æ¥åˆ°ä¸»æœºIP 192.168.1.100ã€‚</td></tr><tr><td>-p 8080:80/udp</td><td>å°†å®¹å™¨ä¸­çš„UDPç«¯å£80æ˜ å°„åˆ°Dockerä¸»æœºä¸Šçš„ç«¯å£8080ã€‚</td></tr><tr><td>-p 8080:80/tcp -p 8080:80/udp</td><td>å°†å®¹å™¨ä¸­çš„TCPç«¯å£80æ˜ å°„åˆ°Dockerä¸»æœºä¸Šçš„TCPç«¯å£8080ï¼Œå¹¶å°†å®¹å™¨ä¸­çš„UDPç«¯å£80æ˜ å°„åˆ°Dockerä¸»æœºä¸Šçš„UDPç«¯å£8080ã€‚</td></tr></tbody></table><h2 id="å®¹å™¨çš„IPåœ°å€å’Œä¸»æœºå"><a href="#å®¹å™¨çš„IPåœ°å€å’Œä¸»æœºå" class="headerlink" title="å®¹å™¨çš„IPåœ°å€å’Œä¸»æœºå"></a>å®¹å™¨çš„IPåœ°å€å’Œä¸»æœºå</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ºå®¹å™¨è¿æ¥åˆ°çš„æ¯ä¸ªDockerç½‘ç»œåˆ†é…ä¸€ä¸ªIPåœ°å€ã€‚IPåœ°å€æ˜¯åœ¨ç½‘ç»œæ± ä¸­åˆ†é…çš„ï¼Œå› æ­¤Dockerå®ˆæŠ¤ç¨‹åºå®é™…ä¸Šå……å½“äº†æ¯ä¸ªå®¹å™¨çš„DHCPæœåŠ¡å™¨ã€‚æ¯ä¸ªç½‘ç»œè¿˜å…·æœ‰é»˜è®¤çš„å­ç½‘æ©ç å’Œç½‘å…³ã€‚</p><p>å®¹å™¨å¯åŠ¨æ—¶ï¼Œåªèƒ½ä½¿ç”¨å°†è¯¥å®¹å™¨è¿æ¥åˆ°å•ä¸ªç½‘ç»œ â€“networkã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å°†è¿è¡Œä¸­çš„å®¹å™¨è¿æ¥åˆ°å¤šä¸ªç½‘ç»œdocker network connectã€‚ä½¿ç”¨â€“networkæ ‡å¿—å¯åŠ¨å®¹å™¨æ—¶ ï¼Œå¯ä»¥ä½¿ç”¨â€“ipæˆ–â€“ip6æ ‡å¿—æŒ‡å®šåˆ†é…ç»™è¯¥ç½‘ç»œä¸Šçš„å®¹å™¨çš„IPåœ°å€ã€‚</p><p>ä½¿ç”¨å°†ç°æœ‰å®¹å™¨è¿æ¥åˆ°å…¶ä»–ç½‘ç»œæ—¶ docker network connectï¼Œå¯ä»¥åœ¨è¯¥å‘½ä»¤ä¸Šä½¿ç”¨â€“ipæˆ–â€“ip6æ ‡å¿—æ¥æŒ‡å®šå…¶ä»–ç½‘ç»œä¸Šå®¹å™¨çš„IPåœ°å€ã€‚</p><p>åŒæ ·ï¼Œå®¹å™¨çš„ä¸»æœºåé»˜è®¤ä¸ºDockerä¸­å®¹å™¨çš„IDã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¦†ç›–ä¸»æœºåâ€“hostnameã€‚ä½¿ç”¨æ¥è¿æ¥åˆ°ç°æœ‰ç½‘ç»œæ—¶docker network connectï¼Œå¯ä»¥ä½¿ç”¨è¯¥â€“alias æ ‡å¿—ä¸ºè¯¥ç½‘ç»œä¸Šçš„å®¹å™¨æŒ‡å®šå…¶ä»–ç½‘ç»œåˆ«åã€‚</p><h2 id="DNSæœåŠ¡"><a href="#DNSæœåŠ¡" class="headerlink" title="DNSæœåŠ¡"></a>DNSæœåŠ¡</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨ä¼šç»§æ‰¿/etc/resolv.confé…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„ä¸»æœºçš„DNSè®¾ç½® ã€‚ä½¿ç”¨é»˜è®¤ç½‘æ¡¥çš„å®¹å™¨å°†è·å¾—æ­¤æ–‡ä»¶çš„å‰¯æœ¬ï¼Œè€Œä½¿ç”¨è‡ªå®šä¹‰ç½‘æ¡¥çš„å®¹å™¨å°†ä½¿ç”¨ Dockerçš„åµŒå…¥å¼DNSæœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ä¼šå°†å¤–éƒ¨DNSæŸ¥æ‰¾è½¬å‘åˆ°ä¸»æœºä¸Šé…ç½®çš„DNSæœåŠ¡å™¨ã€‚</p><p>è‡ªå®šä¹‰ä¸»æœºä¸­å®šä¹‰çš„/etc/hostsä¸ä¼šç»§æ‰¿ã€‚è¦å°†å…¶ä»–ä¸»æœºä¼ é€’åˆ°æ‚¨çš„å®¹å™¨ä¸­ï¼Œè¯·å‚è€ƒ<a href="https://docs.docker.com/engine/reference/commandline/run/#add-entries-to-container-hosts-file---add-host" target="_blank" rel="noopener">docker run</a> çš„å‚æ•°è®¾ç½®ã€‚</p><h2 id="Iptables"><a href="#Iptables" class="headerlink" title="Iptables"></a>Iptables</h2><p>é‡è¦çš„äº‹æƒ…è¯´ä¸‰æ¬¡ï¼Œä½ ä¸€å®šè¦åœ¨å¯åŠ¨Dockerä¹‹å‰å…³é—­é˜²ç«å¢™ï¼Œä½ ä¸€å®šè¦åœ¨å¯åŠ¨Dockerä¹‹å‰å…³é—­é˜²ç«å¢™ï¼Œä½ ä¸€å®šè¦åœ¨å¯åŠ¨Dockerä¹‹å‰å…³é—­é˜²ç«å¢™ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://docs.docker.com/engine/reference/commandline/network/" target="_blank" rel="noopener">Docker Network CLI</a></p><p><a href="https://docs.docker.com/network/" target="_blank" rel="noopener">Docker Networking overview</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
            <tag> å®¹å™¨ </tag>
            
            <tag> ç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ªäººæ€»ç»“(æ¯•ä¸šä¸€å¹´)</title>
      <link href="/2020/07/01/summary/summary-2019.7-2020.7/"/>
      <url>/2020/07/01/summary/summary-2019.7-2020.7/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æ˜¯2020å¹´7æœˆ1æ—¥ï¼Œè·ç¦»æˆ‘å¤§å­¦æ¯•ä¸šè¿‡å»äº†ä¸€å¹´ï¼Œæ˜¯æ—¶å€™å›é¡¾ä¸€ä¸‹æ¯ä¸ªæœˆçš„æˆé•¿ç»å†ã€æ€»ç»“åŠå±•æœ›ã€‚</p><h1 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h1><h2 id="2019-7"><a href="#2019-7" class="headerlink" title="2019.7"></a>2019.7</h2><p>ç»å†äº†å…¬å¸å²—å‰æ‹“å±•åŸ¹è®­åŠå‡ å¤©çš„ä¸šåŠ¡åŸ¹è®­åï¼Œæˆ‘å¼€å§‹ä¸Šå²—â€”â€”æ¡Œé¢è¿ç»´ã€‚ç†Ÿæ‚‰æ—¥å¸¸åŠå…¬è®¾æ–½åŠè®¤è¯†æ›´å¤šåœ°äºº(å’Œå…¬å¸æ‰€æœ‰äººéƒ½æ‰“äº¤é“äº†ä¸€é)</p><h2 id="2019-8"><a href="#2019-8" class="headerlink" title="2019.8"></a>2019.8</h2><p>æˆ‘å­¦å®Œç¬¬ä¸€æœ¬ä¹¦è¿ç»´å®æˆ˜å®å…¸ï¼Œå¼€å§‹ç³»ç»Ÿå­¦ä¹ Linuxâ€”â€”é¸Ÿå“¥ç§æˆ¿èœ</p><p>åŠ¨æ‰‹å®æ“å„ç§åº”ç”¨è¿ç»´çš„æŠ€æœ¯ï¼Œå°†å…¬å¸ä¸»æµæŠ€æœ¯éƒ½äº†è§£è¿‡ä¸€éå¹¶ä¸”å…¨éƒ¨éƒ¨ç½²å®Œæˆä¸€æ¬¡ã€‚</p><h2 id="2019-9"><a href="#2019-9" class="headerlink" title="2019.9"></a>2019.9</h2><p>å…¬å¸å¤§ç‰›å¸¦æˆ‘å¼€å§‹ä¸Šæ‰‹å…¬å¸è€é¡¹ç›®ç”Ÿäº§ç¯å¢ƒçš„æ›´æ–°ã€ç»´æŠ¤å·¥ä½œã€‚</p><p>ä¸»è¦æ–¹é¢åœ¨äºå®é™…çš„é¡¹ç›®åº”ç”¨ã€è°ƒä¼˜ã€é«˜å¯ç”¨ã€å®¹å™¨åŒ–çš„æ¶æ„ä¸Šï¼Œå¤šå‚ä¸è¿›å¼€å‘é¡¹ç›®é‡Œã€‚</p><h2 id="2019-10"><a href="#2019-10" class="headerlink" title="2019.10"></a>2019.10</h2><p>æ›´åŠ ç†Ÿæ‚‰å·²ç»äº¤ä»˜ç»™æˆ‘çš„4ä¸ªå¤§å‹é¡¹ç›®è¿ç»´å·¥ä½œæµç¨‹ï¼Œåœ¨ç‹¬ç«‹æ‰¿æ¥åŸæœ‰çš„é¡¹ç›®ä¸Šçº¿å·¥ä½œä¹‹å¤–è¿˜è¦èƒ½æ‰¿æ¥æ–°çš„é¡¹ç›®ä¸Šçº¿å·¥ä½œï¼Œå¹¶ä¸”å¯¹å…¬å¸æœªæ¥å¼€å‘ã€æµ‹è¯•çš„ç¯å¢ƒæ„å»ºå‚ä¸æ–¹æ¡ˆè®¾è®¡ã€‚</p><h2 id="2019-11"><a href="#2019-11" class="headerlink" title="2019.11"></a>2019.11</h2><p>å…¬å¸å¤§ç‰›å¸¦æˆ‘éƒ¨ç½²æ–°é¡¹ç›®çº¿ä¸‹ç¯å¢ƒéƒ¨ç½²åŠå‚ä¸è¿ç»´åˆ†ææ–¹æ¡ˆè§„åˆ’</p><p>é…ç½®å¤§æ•°æ®æœåŠ¡å™¨ã€éƒ¨ç½²åŠé…ç½®é¡¹ç›®ä¸­é—´ä»¶ã€ç¬¬ä¸€æ¬¡ç‹¬ç«‹è¿ç§»æ—§ä¸šåŠ¡æ•°æ®åˆ°æœåŠ¡å™¨é‡Œ(è¡€æ³ªå²)</p><p>å‚ä¸ç”Ÿäº§ç¯å¢ƒé˜¿é‡Œäº‘æœåŠ¡å™¨è§„åˆ’ï¼Œéƒ¨ç½²é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸­é—´ä»¶åŠK8Sï¼Œæµ‹è¯•ç¨³å®šæ€§ã€ç›‘æ§æŠ¥è­¦ã€å·¡æ£€ã€å¤‡ä»½</p><p>æ‰“é€šCI/CDéƒ¨ç½²ä¸Šçº¿æµæ°´çº¿</p><p>é€šå®µåŠ ç­3æ¬¡ï¼Œæ–°é¡¹ç›®ä»å¤´ä¸€å¤©ä¸‹åˆ4ç‚¹éƒ¨ç½²åˆ°ç¬¬äºŒå¤©æ—©ä¸Š9ç‚¹(èŠœæ¹–~)</p><h2 id="2019-12"><a href="#2019-12" class="headerlink" title="2019.12"></a>2019.12</h2><p>æ–°é¡¹ç›®ä¸Šçº¿ä¸æ˜¯å¾ˆé¡ºåˆ©ï¼Œé—®é¢˜è¾ƒå¤šï¼Œç»å¸¸åŠ ç­æ›´æ–°ï¼Œæ•´ä¸ªäººç–²å€¦äº†è®¸å¤šï¼Œå¼€å§‹æ··äº†</p><h2 id="2020-1"><a href="#2020-1" class="headerlink" title="2020.1"></a>2020.1</h2><p>æŠŠçº¿ä¸‹ç¯å¢ƒè§„èŒƒèµ·æ¥ï¼Œåšå¥½çº¿ä¸‹æ•°æ®å¤‡ä»½ã€æƒé™éš”ç¦»(å…¬å¸æœ‰ç‹ äººç›´æ¥è¿›æœåŠ¡å™¨rm -rf /* è¿™æ˜¯æˆ‘æ²¡æƒ³åˆ°çš„)</p><h2 id="2020-2-2020-4"><a href="#2020-2-2020-4" class="headerlink" title="2020.2-2020.4"></a>2020.2-2020.4</h2><p>è¿œç¨‹åŠå…¬ï¼Œæ•ˆç‡è¾ƒä½ï¼Œæ²¡å­¦åˆ°å¤ªå¤šçš„ä¸œè¥¿ï¼Œåœ¨å®¶ä¼‘æ¯äº†3ä¸ªæœˆã€‚</p><h2 id="2020-5"><a href="#2020-5" class="headerlink" title="2020.5"></a>2020.5</h2><p>5æœˆæ˜¯å¾ˆå…³é”®çš„ä¸€ä¸ªæœˆï¼Œè®¸å¤šå¤§ç‰›å¯¹æˆ‘çš„æŒ‡ç‚¹è®©æˆ‘å¯¹æœªæ¥å……æ»¡äº†æœŸå¾…ï¼Œä¸€ä¸ªæœˆè®©äººæ”¹å˜çš„ä¸œè¥¿å¤ªå¤šäº†ï¼ŒåŠªåŠ›ï¼Œæ²‰ç¨³ï¼Œæ€è€ƒï¼Œæ ¼å±€ï¼Œæœ€é‡è¦çš„æ˜¯çŸ¥é“è‡ªå·±ç©¶ç«Ÿæƒ³åšä»€ä¹ˆäº†ï¼Œå¹¶ä¸”æœ‰ä¸ºä¹‹å¥‹æ–—çš„ç†ç”±å’ŒåšæŒåˆ°åº•çš„å†³å¿ƒã€‚</p><h2 id="2020-6"><a href="#2020-6" class="headerlink" title="2020.6"></a>2020.6</h2><p>æŠ€æœ¯çš„æ²‰æ·€çš„ç¬¬ä¸€ä¸ªæœˆï¼Œä¸å¤§ç‰›ä¹‹é—´çš„äº¤è°ˆã€åˆ†äº«ï¼Œè®©æˆ‘æ”¶è·äº†ä¸å°‘çŸ¥è¯†ï¼Œç‹¬ç«‹æ‰¿æ‹…æ–°çš„é¡¹ç›®çš„ä»0-1çš„éƒ¨ç½²è¿‡ç¨‹ï¼Œåˆ¶ä½œä¸€ä¸ªè®©è‡ªå·±æ»¡æ„åº¦è¾ƒé«˜çš„æŠ•äº§+ç›‘æ§çš„è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œè®¾è®¡ä¸€æ¡CI/CDçš„æµæ°´çº¿ï¼Œè®©è‡ªå·±åœ¨ç‹¬å½“ä¸€é¢çš„ç»éªŒä¸Šå¼¥è¡¥ä¸è¶³ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="æŠ€æœ¯"><a href="#æŠ€æœ¯" class="headerlink" title="æŠ€æœ¯"></a>æŠ€æœ¯</h2><p>è¿ç»´æŠ€æœ¯å­¦äº†ä¸å°‘ï¼Œåœ¨æ­¤æ„Ÿè°¢å…¬å¸çš„å„ä¸ªå¤§ç‰›ï¼Œå¸¦æˆ‘æˆé•¿ï¼Œä¹Ÿæ„Ÿè°¢è¿™ä¸€å¹´çš„è‡ªå·±ï¼Œæ²¡æœ‰ç™½ç™½æµªè´¹æ—¶é—´ï¼ŒåŠªåŠ›å­¦ä¹ æ›´å¤šåœ°çŸ¥è¯†å¹¶èƒ½çµæ´»åº”ç”¨ã€‚</p><h2 id="æ€æƒ³"><a href="#æ€æƒ³" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h2><p>å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œæˆ‘çš„æ€æƒ³å’Œåˆšåˆšæ¯•ä¸šæ²¡å•¥åŒºåˆ«ï¼Œæ˜¯ä¸ªè«å¾—æ„Ÿæƒ…çš„å·¥å…·äººï¼Œè®©æˆ‘åšä»€ä¹ˆå°±åšä»€ä¹ˆã€‚</p><p>åˆæ˜¯ä¸€å¹´çš„54é’å¹´èŠ‚ï¼Œå‡ ä½å¤§ä½¬çš„æŒ‡ç‚¹å†åŠ ä¸ŠBç«™çš„ã€Šåæµªã€‹ï¼Œæ–°æ€æƒ³çš„ä¼ æ’­ä¸å‘å±•ï¼Œè®©æˆ‘å­¦ä¼šäº†æ€è€ƒï¼Œæ€è€ƒè‡ªå·±çš„å¤„å¢ƒï¼›å­¦ä¹ çš„æ–¹å‘ã€æ–¹æ³•ï¼›æœªæ¥çš„è§„åˆ’ä¸å‘å±•ï¼Œå½»å½»åº•åº•çš„æ€è€ƒäº†ä¸€é</p><p>æˆ‘æƒ³åšä»€ä¹ˆï¼Œæˆ‘è¿½æ±‚çš„ä»€ä¹ˆï¼Œåœ¨æˆ‘å¿ƒé‡Œå·²ç»æœ‰äº†ä¸€ä¸ªå¤§æ¦‚ï¼Œæˆ‘ä»æœªå¦‚æ­¤æ¸…æ™°åœ°èƒ½çœ‹åˆ°ä¸€ä¸ªäººçš„æœªæ¥ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Œä»¿ä½›èƒ½ç›´æŠµç»ˆç« ã€‚</p><h2 id="æ ¼å±€"><a href="#æ ¼å±€" class="headerlink" title="æ ¼å±€"></a>æ ¼å±€</h2><p>å³ä½¿åˆ°ç°åœ¨æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šäº’è”ç½‘çš„æ ¼å±€æ˜¯æ€æ ·çš„ï¼Œè‡ªå·±æ ¼å±€å¤ªå°ï¼Œè¿™ç§ä¸œè¥¿ä¸æ˜¯ä¸€æ—¶åŠä¼šå°±èƒ½é¢†æ‚Ÿåˆ°åœ°ï¼ŒæŒ‰ç…§å½¢åŠ¿ä¸æ–­åœ°è°ƒæ•´è‡ªå·±çš„ç†è§£æ‰æ˜¯ç‹é“ã€‚</p><h1 id="å±•æœ›"><a href="#å±•æœ›" class="headerlink" title="å±•æœ›"></a>å±•æœ›</h1><p>ä¸€ä¸ªäººçš„å±•æœ›è‡³å…³é‡è¦ï¼Œè¿˜å¥½æˆ‘é¢†å¯¼åŠæ—¶çŒè¾“äº†æˆ‘ä¸€äº›æ€æƒ³ï¼Œä¸è¦åªé¡¾åŠçœ¼ä¸‹ï¼Œæœªæ¥æ˜¯å±äºæˆ‘ä»¬è¿™ä»£äººçš„ï¼Œæ€ä¹ˆæ‰èƒ½æˆåŠŸæ‰›èµ·ä¸€ä¸ªå®¶åº­çš„é‡ä»»ï¼Œæ‰›èµ·ä¸€ä¸ªå›½å®¶çš„(åˆ«äº†ï¼Œæœ‰å¿ƒæ— åŠ›)</p><p>æˆ‘æ·±çŸ¥è¿™æ˜¯è¿Ÿæ—©é¢å¯¹çš„äº‹å®ï¼Œä¹°æˆ¿ç»“å©šï¼Œå¾ˆå¤šäººç°åœ¨éƒ½åœ¨é€ƒé¿è¿™ä¸ªç°å®ï¼Œä¸å…¶é€ƒé¿ï¼Œä¸å¦‚å‹‡æ•¢çš„æ¥ä¸‹ã€‚è¿™æ—¢æ˜¯ä¸å¯é€ƒé¿çš„äº‹å®ä¹Ÿäº‹ä¸€ç§è´£ä»»ï¼Œæ›¾ç»ä¸€æ®µæ—¶é—´æˆ‘è¢«è¿™ç§è´£ä»»å‹å¾—å–˜ä¸è¿‡å»äº†ï¼Œä¸ºäº†æ‰¿æ‹…è¿™ä¸ªè´£ä»»æˆ‘å®šäº†ä¸€ç³»åˆ—ç›®æ ‡ï¼Œæœ‰æ¡ä¸ç´Šçš„æœç€ç›®æ ‡åŠªåŠ›ï¼Œå°±åƒæ‰“æ€ªå‡çº§ä¸€æ ·ï¼Œè®©è‡ªå·±æ›´ä¼˜ç§€ã€‚</p><p>æˆ‘æ·±çŸ¥æˆ‘æ˜¯ä¸€ä¸ªä¸ç”˜å¹³å‡¡çš„äººï¼Œå¤šå°‘äººç”˜å¿ƒè‡ªå·±çš„ä»˜å‡ºä¸æ”¶è·ä¸æˆæ­£æ¯”ï¼Œå¤šå°‘äººç”˜å¿ƒè‡ªå·±çš„ä»·å€¼è¢«äººå—¤ä¹‹ä»¥é¼»ï¼Œå¤šå°‘äººç”˜å¿ƒè‡ªå·±å¹³æ·¡åœ°è¿‡å®Œä¸€è¾ˆå­ã€‚æˆ‘ä¸æƒ³æˆä¸ºè¿™æ ·çš„äººï¼Œèˆæˆ‘å…¶è°ï¼Œæˆä¸ºå›¢é˜Ÿçš„MVPæ˜¯æˆ‘ä¸€ç›´å¥‰è¡Œçš„æ ‡å‡†ã€‚</p><p>æˆ‘æ·±çŸ¥ç§ä¸€æ£µæ ‘æœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ï¼Œå…¶æ¬¡æ˜¯ç°åœ¨ã€‚é‚£äº›è¿‡å»çš„ï¼Œå°±è®©å®ƒä»¬è¿‡å»å§ï¼Œæ¯•ç«Ÿä½ å·²ç»æµªè´¹äº†å¥½å‡ å¹´çš„æ—¶é—´ç—›å¿«çš„ç•…ç©äº†ï¼Œç•…ç©ä¹‹åä½ å¾—ä»˜å‡ºä¸€äº›ä»£ä»·ï¼Œæˆ‘ä¸åæ‚”ï¼Œå› ä¸ºé‚£äº›æˆ‘æƒ³æ”¾çºµè‡ªå·±çš„æ—¶å…‰æˆ‘éƒ½ä½“éªŒè¿‡äº†ï¼Œæœªæ¥æˆ‘å¯èƒ½ä¸ä¼šåœ¨æµªè´¹æ—¶é—´åœ¨ç©ä¸Šäº†ï¼Œæ—¶åˆ»æé†’è‡ªå·±çš„é‡å¿ƒå’Œè´£ä»»ï¼Œæˆ‘æ²¡æœ‰ç†ç”±å†æµªè´¹ä¸€åˆ†ä¸€ç§’äº†ã€‚</p><p>å¦‚æœèƒ½ç»™å‘¨å›´äººå¸¦æ¥ä¸€ç‚¹ç‚¹å½±å“ï¼Œæˆ‘å¸Œæœ›æœ‰å¹¸çœ‹åˆ°æˆ‘è¿™ç¯‡æ–‡ç« çš„æœ‹å‹èƒ½å¤Ÿå¥½å¥½æ€è€ƒè‡ªå·±çš„ç›®æ ‡ï¼Œå®šä¸€äº›åˆ‡å®å¯è¡Œçš„è®¡åˆ’ï¼Œä¸å¤§ä½¬äº¤æµæ²Ÿé€š(å­¦ä¹ åˆ«äººçš„æˆåŠŸç»éªŒ)ï¼Œæ²‰æ·€è‡ªå·±çš„å†…å¿ƒï¼Œè‡³å°‘ç­‰åˆ°è‡ªå·±è€çš„é‚£å¤©ä¸ä¼šå› æ­¤è€Œåæ‚”ç™½è¿‡äº†ä¸€ç”Ÿï¼Œä½ ä¸ºæ­¤å¥‹æ–—è¿‡ï¼Œè¿½æ±‚è¿‡ï¼ŒæˆåŠŸè¿‡ï¼Œé‚£æ˜¯ä¸€ç§å¤šä¹ˆç¾å¥½çš„ä½“éªŒã€‚</p><p>å…±å‹‰</p>]]></content>
      
      
      <categories>
          
          <category> ä¸ªäººæ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¸ªäººæ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>See-SQLå®¡è®¡å¹³å°ä»‹ç»åŠéƒ¨ç½²</title>
      <link href="/2020/07/01/mysql/mysql-see/"/>
      <url>/2020/07/01/mysql/mysql-see/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>çº¿ä¸‹æ•°æ®åº“ï¼Œæˆå¤©æœ‰äººè¦æ±‚è¿ç»´æ‰§è¡Œè¿™sqlé‚£sqlçš„ï¼Œåˆè‹¦é€¼åˆå®¹æ˜“èƒŒé”…ï¼Œé—®äº†ä¸‹å…¬å¸çš„DBAå¤§ç¥ï¼Œæ¨èäº†seeå®¡è®¡å¹³å°ï¼Œæ‰§è¡Œsqlæœ‰å®¡è®¡è®°å½•ï¼Œç•™ç—•ç•™ç—•ç•™ç—•ï¼Œé‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼Œå³ä½¿æ˜¯çº¿ä¸‹ç¯å¢ƒï¼Œè°¨é˜²æœ‰äººåˆ åº“è·‘è·¯æ‰¾ä¸åˆ°äººï¼Œå¯ä»¥è§£å†³è¿ç»´ä¸€å¤§ç—›ç‚¹ã€‚</p><h1 id="å®¡è®¡å¹³å°ä»‹ç»"><a href="#å®¡è®¡å¹³å°ä»‹ç»" class="headerlink" title="å®¡è®¡å¹³å°ä»‹ç»"></a>å®¡è®¡å¹³å°ä»‹ç»</h1><p>æ•°æ®åº“å®¡è®¡å¹³å°ä½œç”¨</p><ul><li>ã€Šå¯¹äºå¼€å‘äººå‘˜ã€‹æäº¤ä»£ç é€šè¿‡Inceptionå®¡æ ¸ï¼Œä¸ç¬¦åˆè§„èŒƒä»£ç ä¼šæœ‰æç¤ºï¼Œé€šè¿‡<br>Inception å®¡æ ¸åï¼Œå¼€å‘äººå‘˜å¯è‡ªè¡Œå‘èµ·æ‰§è¡Œæˆ–å®šæ—¶æ‰§è¡Œï¼Œå›æ»šç­‰æ“ä½œ</li><li>ã€Šå¯¹äºæµ‹è¯•äººå‘˜ã€‹æäº¤ä»£ç éœ€èµ°å·¥å•æµï¼Œé€šè¿‡Inceptionå®¡æ ¸ï¼Œæµç¨‹è‡ªåŠ¨åˆ°è¾¾éƒ¨é—¨ç»ç†ï¼Œ<br>éƒ¨é—¨ç»ç†å®¡æ ¸ï¼Œæ‰€æœ‰æ‰§è¡Œã€å›æ»šç­‰æ“ä½œç”±ç®¡ç†å‘˜æ“ä½œ</li><li>æ”¯æŒDDLï¼ŒDMLè¯­å¥ä¸Šçº¿ï¼Œå›æ»šæ“ä½œï¼Œæ–¹ä¾¿ç»Ÿè®¡å·²ä¸Šçº¿SQLï¼Œä¾¿äºé—®é¢˜å›æº¯</li><li>SQLä¼˜åŒ–ï¼Œå¯æä¾›SQLä¼˜åŒ–å»ºè®®ï¼Œæ‰“åˆ†ã€SQLæ”¹å†™å»ºè®®ï¼Œå¢åŠ ç´¢å¼•å»ºè®®ç­‰</li></ul><h2 id="APIé›†æˆ"><a href="#APIé›†æˆ" class="headerlink" title="APIé›†æˆ"></a>APIé›†æˆ</h2><ul><li>Inception: å»å“ªå„¿ç½‘å¼€æºï¼Œæä¾›SQLè¯­å¥å®¡æ ¸ã€æ‰§è¡Œã€å›æ»šåŠŸèƒ½</li><li>SQLAdvisor: ç¾å›¢å¼€æºï¼Œæä¾›åˆ†æSQLä¸­çš„whereæ¡ä»¶ã€èšåˆæ¡ä»¶ã€å¤šè¡¨Joinå…³ç³»ï¼Œè¾“å‡ºç´¢å¼•ä¼˜åŒ–å»ºè®®</li><li>SOAR: å°ç±³å¼€æºï¼Œæä¾›SQLå¯å‘å¼ç®—æ³•çš„è¯­å¥ä¼˜åŒ–ã€å¤šåˆ—ç´¢å¼•ä¼˜åŒ–ç­‰åŠŸèƒ½</li></ul><h2 id="åŠŸèƒ½ç®€ä»‹"><a href="#åŠŸèƒ½ç®€ä»‹" class="headerlink" title="åŠŸèƒ½ç®€ä»‹"></a>åŠŸèƒ½ç®€ä»‹</h2><h3 id="ç›®æ ‡åº“ç®¡ç†"><a href="#ç›®æ ‡åº“ç®¡ç†" class="headerlink" title="ç›®æ ‡åº“ç®¡ç†"></a>ç›®æ ‡åº“ç®¡ç†</h3><ul><li>æ”¯æŒå¤šåœºåœ°/æ•°æ®ä¸­å¿ƒçš„æ•°æ®åº“ç®¡ç†ï¼Œé›†ç¾¤æ–¹å¼å½’çº³ç›®æ ‡æ•°æ®åº“</li><li>æ”¯æŒç›®æ ‡æ•°æ®åº“é…ç½®ï¼Œåº“/è¡¨ç»“æ„æŸ¥è¯¢</li></ul><h3 id="SQLæ“ä½œ"><a href="#SQLæ“ä½œ" class="headerlink" title="SQLæ“ä½œ"></a>SQLæ“ä½œ</h3><ul><li>åŸºäºInception</li><li>SQLè¯­æ³•æ£€æµ‹</li><li>SQLè¯­å¥æ‰§è¡Œ</li><li>SQLå›æ»š</li><li>å®šæ—¶å·¥å•</li><li>å†å²è®°å½•</li></ul><h3 id="SQLæŸ¥è¯¢"><a href="#SQLæŸ¥è¯¢" class="headerlink" title="SQLæŸ¥è¯¢"></a>SQLæŸ¥è¯¢</h3><ul><li>æŸ¥è¯¢ç›®æ ‡æ•°æ®åº“çš„è¯¦ç»†è¡¨ç»“æ„</li><li>æŸ¥è¯¢è¡¨æ•°æ®ï¼Œå¯¹ç»“æœå¯å¯¼å‡ºæ–‡ä»¶</li><li>SQLè¯­å¥ä¼˜åŒ–ï¼ˆåŸºäºç¾å›¢SQLAdvisorï¼‰</li><li>å¤šå±‚æ¬¡ä¼˜åŒ–å»ºè®®ï¼ˆåŸºäºå°ç±³SOARï¼‰</li></ul><h3 id="ç”¨æˆ·ç®¡ç†"><a href="#ç”¨æˆ·ç®¡ç†" class="headerlink" title="ç”¨æˆ·ç®¡ç†"></a>ç”¨æˆ·ç®¡ç†</h3><ul><li>å¯¹ç”¨æˆ·/ç»„çš„æ³¨å†Œ/æ³¨é”€/åŠ ç»„/æˆæƒç­‰ç®¡ç†</li></ul><h3 id="ä¸ªæ€§åŒ–è®¾ç½®"><a href="#ä¸ªæ€§åŒ–è®¾ç½®" class="headerlink" title="ä¸ªæ€§åŒ–è®¾ç½®"></a>ä¸ªæ€§åŒ–è®¾ç½®</h3><ul><li>ç®¡ç†å‘˜å¯ä»¥åšSQLå…³é”®å­—æ‹¦æˆªï¼Œå¹³å°çš„å®¡æ‰¹åŠŸèƒ½å¼€å…³ç­‰è®¾ç½®</li><li>ç”¨æˆ·å¯ä»¥è®¢é˜…å…¶å¸¸ç”¨çš„æ•°æ®åº“ï¼ŒæŒ‡å®šå®¡æ‰¹å·¥å•çš„ç»ç†ï¼Œä»¥ç®€åŒ–å®¡æ ¸æ—¶æ‰€éœ€çš„æ“ä½œ</li></ul><h3 id="inceptionè®¾ç½®"><a href="#inceptionè®¾ç½®" class="headerlink" title="inceptionè®¾ç½®"></a>inceptionè®¾ç½®</h3><ul><li>inceptionæœåŠ¡è¿æ¥ä¿¡æ¯</li><li>inceptionå¤‡ä»½åº“è¿æ¥ä¿¡æ¯</li><li>inceptionæ”¯æŒçš„å‚æ•°é‡Šä¹‰åŠå€¼</li></ul><h3 id="äººå·¥å®¡æ‰¹åŠŸèƒ½"><a href="#äººå·¥å®¡æ‰¹åŠŸèƒ½" class="headerlink" title="äººå·¥å®¡æ‰¹åŠŸèƒ½"></a>äººå·¥å®¡æ‰¹åŠŸèƒ½</h3><ul><li>æµç¨‹å¼€å…³</li><li>å¼€å¯æµç¨‹ï¼Œå·¥å•è‡³å°‘éœ€åŒäººç¡®è®¤ï¼ˆæµç¨‹ï¼šæäº¤äºº â€“ inceptionè‡ªåŠ¨å®¡æ ¸ â€“ ç»ç†å®¡æ‰¹ â€“ DBAä¸Šçº¿ï¼‰</li><li>å…³é—­æµç¨‹ï¼Œå·¥å•å¯ç”±ç»ç†ä¸Šçº¿ï¼ˆæµç¨‹ï¼šæäº¤äºº â€“ inceptionè‡ªåŠ¨å®¡æ ¸ â€“ ç»ç†ä¸Šçº¿ï¼‰</li></ul><h3 id="ç”¨æˆ·æƒé™"><a href="#ç”¨æˆ·æƒé™" class="headerlink" title="ç”¨æˆ·æƒé™"></a>ç”¨æˆ·æƒé™</h3><ul><li>åŸºäºRBACçš„è¡¨çº§ï¼Œå¯¹è±¡çº§æƒé™æ§åˆ¶ä½“ç³»</li><li>é€šè¿‡ç”¨æˆ·ç®¡ç†è®¾ç½®ç”¨æˆ·æƒé™</li><li>æ ¹æ®ç”¨æˆ·èº«ä»½ï¼ˆç»„å‘˜/ç»ç†/æ€»ç›‘ï¼‰é‰´æƒç”¨æˆ·å¯¹SQLçš„å®¡æ ¸/å–æ¶ˆ/æ‰§è¡Œ/å›æ»šç­‰æ“ä½œ</li></ul><h3 id="æ“ä½œæµç¨‹"><a href="#æ“ä½œæµç¨‹" class="headerlink" title="æ“ä½œæµç¨‹"></a>æ“ä½œæµç¨‹</h3><ul><li>ç”¨æˆ·éœ€è¦è¾“å…¥SQLï¼ŒæŒ‡å®šç¯å¢ƒï¼Œæ‰§è¡Œäººï¼Œæ•°æ®åº“</li><li>inceptionè‡ªåŠ¨å®¡æ ¸SQLè¯­æ³•</li><li>å®¡æ‰¹äººåšå®¡æ‰¹é€šè¿‡æˆ–é©³å›æ“ä½œ</li><li>æ‰§è¡Œäººåšæ‰§è¡Œ/æ’¤é”€/å›æ»šç­‰æ“ä½œ</li><li>SQLåˆ—è¡¨ç•Œé¢æä¾›SQLæŸ¥è¯¢ï¼Œæ“ä½œç­‰ç›¸å…³åŠŸèƒ½</li></ul><h3 id="APIæ–‡æ¡£"><a href="#APIæ–‡æ¡£" class="headerlink" title="APIæ–‡æ¡£"></a>APIæ–‡æ¡£</h3><ul><li>å„æ¥å£ç”Ÿæˆè‡ªåŠ¨åŒ–çš„APIæ–‡æ¡£ï¼Œå¯¹æ¥å¤–éƒ¨éœ€æ±‚</li></ul><h3 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h3><ul><li>æ”¯æŒseeç³»ç»Ÿç™»å½•</li><li>æ”¯æŒè‡ªå®šä¹‰å…¬å¸ç»Ÿä¸€è®¤è¯ä¸­å¿ƒ(sso)ç™»å½•</li></ul><h3 id="é€šçŸ¥"><a href="#é€šçŸ¥" class="headerlink" title="é€šçŸ¥"></a>é€šçŸ¥</h3><p>E-mailé‚®ä»¶æ¨é€</p><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>DashBoardæ•°æ®æŠ¥è¡¨å±•ç¤º</p><h1 id="æ ¸å¿ƒç»„ä»¶"><a href="#æ ¸å¿ƒç»„ä»¶" class="headerlink" title="æ ¸å¿ƒç»„ä»¶"></a>æ ¸å¿ƒç»„ä»¶</h1><h2 id="Inception"><a href="#Inception" class="headerlink" title="Inception"></a>Inception</h2><p>SQLæ“ä½œåŸºäºInception</p><ul><li>SQLè¯­æ³•æ£€æµ‹</li><li>SQLè¯­å¥æ‰§è¡Œ</li><li>SQLå›æ»š</li><li>å®šæ—¶å·¥å•</li><li>å†å²è®°å½•</li></ul><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Mysql/see/Inception.jpg"  alt="Inception"></p><p>Inceptionæä¾›çš„åŠŸèƒ½å¾ˆä¸°å¯Œï¼Œé¦–å…ˆï¼Œå®ƒå¯ä»¥å¯¹æäº¤çš„æ‰€æœ‰è¯­å¥çš„è¯­æ³•åˆ†æï¼Œå¦‚æœè¯­æ³•æœ‰é—®é¢˜ï¼Œéƒ½ä¼šå°†ç›¸åº”çš„é”™è¯¯ä¿¡æ¯è¿”å›ç»™å®¡æ ¸è€…ã€‚<br>è¿˜æä¾›è¯­ä¹‰åˆ†æï¼Œå½“ä¸€ä¸ªè¡¨ï¼Œåº“ï¼Œåˆ—ç­‰ä¿¡æ¯ä¸æ­£ç¡®æˆ–è€…ä¸ç¬¦åˆè§„èŒƒçš„æ—¶å€™æŠ¥é”™ï¼Œæˆ–è€…ä½¿ç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å¯¹è±¡æ—¶æŠ¥é”™ç­‰ç­‰ã€‚ è¿˜æä¾›<br>äº†å¾ˆå¤šé’ˆå¯¹SQLè§„èŒƒæ€§çº¦æŸçš„åŠŸèƒ½ï¼Œè¿™äº›DBAéƒ½æ˜¯å¯ä»¥é€šè¿‡ç³»ç»Ÿå‚æ•°æ¥é…ç½®çš„ã€‚ æ›´é«˜çº§çš„åŠŸèƒ½æ˜¯ï¼Œå¯ä»¥è¾…åŠ©DBAåˆ†æä¸€æ¡æŸ¥è¯¢è¯­å¥çš„<br>æ€§èƒ½ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨ç´¢å¼•æˆ–è€…æŸäº›åŸå› å¯¼è‡´æŸ¥è¯¢å¾ˆæ…¢ï¼Œéƒ½å¯ä»¥æ£€æŸ¥ã€‚<br>è¿˜æä¾›SQLè¯­å¥çš„æ‰§è¡ŒåŠŸèƒ½ï¼Œå¯æ‰§è¡Œçš„è¯­å¥ç±»å‹åŒ…æ‹¬å¸¸ç”¨çš„DMLåŠDDLè¯­å¥åŠtruncate tableç­‰æ“ä½œã€‚<br> Inception åœ¨æ‰§è¡Œ DML æ—¶è¿˜æä¾›ç”Ÿæˆå›æ»šè¯­å¥çš„åŠŸèƒ½ï¼Œå¯¹åº”çš„æ“ä½œè®°å½•åŠå›æ»šè¯­å¥ä¼šè¢«å­˜å‚¨åœ¨å¤‡ä»½æœºå™¨ä¸Šé¢ï¼Œå¤‡ä»½æœºå™¨é€šè¿‡é…ç½®Inceptionå‚æ•°æ¥æŒ‡å®šã€‚</p><h2 id="SOAR"><a href="#SOAR" class="headerlink" title="SOAR"></a>SOAR</h2><p>SOAR(SQL Optimizer And Rewriter)æ˜¯ä¸€ä¸ªå¯¹SQLè¿›è¡Œä¼˜åŒ–å’Œæ”¹å†™çš„è‡ªåŠ¨åŒ–å·¥å…·ã€‚ ç”±å°ç±³äººå·¥æ™ºèƒ½ä¸äº‘å¹³å°çš„æ•°æ®åº“å›¢é˜Ÿå¼€å‘ä¸ç»´æŠ¤ã€‚</p><p>åŠŸèƒ½ç‰¹ç‚¹</p><ul><li>è·¨å¹³å°æ”¯æŒï¼ˆæ”¯æŒLinux, Macç¯å¢ƒï¼ŒWindowsç¯å¢ƒç†è®ºä¸Šä¹Ÿæ”¯æŒï¼Œä¸è¿‡æœªå…¨é¢æµ‹è¯•ï¼‰</li><li>ç›®å‰åªæ”¯æŒ MySQL è¯­æ³•æ—åè®®çš„SQLä¼˜åŒ–</li><li>æ”¯æŒåŸºäºå¯å‘å¼ç®—æ³•çš„è¯­å¥ä¼˜åŒ–</li><li>æ”¯æŒå¤æ‚æŸ¥è¯¢çš„å¤šåˆ—ç´¢å¼•ä¼˜åŒ–ï¼ˆUPDATE, INSERT, DELETE, SELECTï¼‰</li><li>æ”¯æŒEXPLAINä¿¡æ¯ä¸°å¯Œè§£è¯»</li><li>æ”¯æŒSQLæŒ‡çº¹ã€å‹ç¼©å’Œç¾åŒ–</li><li>æ”¯æŒåŒä¸€å¼ è¡¨å¤šæ¡ALTERè¯·æ±‚åˆå¹¶</li><li>æ”¯æŒè‡ªå®šä¹‰è§„åˆ™çš„SQLæ”¹å†™</li></ul><h2 id="SQLAdvisor"><a href="#SQLAdvisor" class="headerlink" title="SQLAdvisor"></a>SQLAdvisor</h2><p>SQLAdvisoræ˜¯ç”±ç¾å›¢ç‚¹è¯„å…¬å¸æŠ€æœ¯å·¥ç¨‹éƒ¨DBAå›¢é˜Ÿï¼ˆåŒ—äº¬ï¼‰å¼€å‘ç»´æŠ¤çš„ä¸€ä¸ªåˆ†æSQLç»™å‡ºç´¢å¼•ä¼˜åŒ–å»ºè®®çš„å·¥å…·ã€‚å®ƒåŸºäºMySQLåŸç”Ÿæ€è¯æ³•è§£æï¼Œç»“åˆåˆ†æSQLä¸­çš„whereæ¡ä»¶ã€èšåˆæ¡ä»¶ã€å¤šè¡¨Joinå…³ç³» ç»™å‡ºç´¢å¼•ä¼˜åŒ–å»ºè®®ã€‚</p><p>ç›®å‰SQLAdvisoråœ¨ç¾å›¢ç‚¹è¯„å†…éƒ¨å¹¿æ³›åº”ç”¨ï¼Œå…¬å¸å†…éƒ¨å¯¹SQLAdvisorçš„å¼€å‘å…¨é¢è½¬åˆ°githubä¸Šï¼Œå¼€æºå’Œå†…éƒ¨ä½¿ç”¨ä¿æŒä¸€è‡´ã€‚</p><p>ä¸»è¦åŠŸèƒ½ï¼šè¾“å‡ºSQLç´¢å¼•ä¼˜åŒ–å»ºè®®</p><h1 id="ç¦»çº¿éƒ¨ç½²"><a href="#ç¦»çº¿éƒ¨ç½²" class="headerlink" title="ç¦»çº¿éƒ¨ç½²"></a>ç¦»çº¿éƒ¨ç½²</h1><p>éƒ¨ç½²è¿‡äºå¤æ‚ï¼Œè€Œä¸”éƒ¨åˆ†ç»„ä»¶ç½‘ä¸Šå¾ˆéš¾ä¸‹è½½(è¦ä¹ˆæ‰¾ä¸åˆ°å®˜æ–¹å®‰è£…åŒ…ï¼Œè¦ä¹ˆåœ¨å›½å¤–ä¸‹è½½ææ…¢)</p><p>æ‰€ä»¥æœ¬æ¬¡éƒ¨ç½²é‡‡ç”¨ç¦»çº¿æ–¹å¼ï¼Œé¦–å…ˆä¸‹è½½ç™¾åº¦äº‘ä¸Šæ‰€æœ‰å®‰è£…åŒ…</p><p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1pnSATgVoIv5Ydv_gTuModg" target="_blank" rel="noopener">https://pan.baidu.com/s/1pnSATgVoIv5Ydv_gTuModg</a> </p><p>æå–ç ï¼šs1zn </p><p>å¤åˆ¶è¿™æ®µå†…å®¹åæ‰“å¼€ç™¾åº¦ç½‘ç›˜æ‰‹æœºAppï¼Œæ“ä½œæ›´æ–¹ä¾¿å“¦</p><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><p>æ“ä½œç³»ç»Ÿæ”¯æŒ(æ²¡åˆ—ä¸¾å¹¶ä¸ä»£è¡¨ä¸èƒ½å®‰è£…,å¯ä»¥è‡ªè¡Œå°è¯•)</p><ul><li>CentOS 6+</li><li>CentOS 7+</li></ul><p>å®‰è£…åŒ…</p><ul><li>bison-2.5.1.tar.gz</li><li>inception-master.zip</li><li>percona-toolkit-3.1.0_i386.tar.gz</li><li>percona-release-0.1-3.noarch.rpm</li><li>Python-3.6.6.tgz</li><li>redis-4.0.6.tar.gz</li><li>see-master.zip</li><li>SQLAdvisor-master.zip</li><li>mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz</li></ul><p>å®‰è£…è·¯å¾„</p><ul><li>/opt/see/</li></ul><h2 id="å®‰è£…Mysql"><a href="#å®‰è£…Mysql" class="headerlink" title="å®‰è£…Mysql"></a>å®‰è£…Mysql</h2><p>å®‰è£…åŒ…ï¼š</p><p>mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz</p><p>å®‰è£…è¿‡ç¨‹å‚è€ƒ<br><a href="https://rugod.cn/2020/05/01/mysql/mysql-install/" target="_blank" rel="noopener">ç¦»çº¿å®‰è£…Mysql5.7.28åŠè°ƒä¼˜</a></p><p>Mysqlé…ç½®æ–‡ä»¶å†…å®¹éœ€åŒ…å«ä»¥ä¸‹é…ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">server-id &#x3D; 100  # ä¸é™åˆ¶å…·ä½“æ•°å€¼</span><br><span class="line">log_bin &#x3D; mysql-bin</span><br><span class="line">binlog_format &#x3D; row  # æˆ– MIXED</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…pt-online-schema-change"><a href="#å®‰è£…pt-online-schema-change" class="headerlink" title="å®‰è£…pt-online-schema-change"></a>å®‰è£…pt-online-schema-change</h2><p>å®‰è£…åŒ…ï¼š</p><p>percona-toolkit-3.1.0_i386.tar.gz</p><p>bison-2.5.1.tar.gz</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yum install -y perl-DBI perl-DBD-mysql perl-Time-HiRes perl-ExtUtils-MakeMaker</span><br><span class="line"></span><br><span class="line">cd &#x2F;opt&#x2F;see&#x2F;</span><br><span class="line">tar -zxvf percona-toolkit-3.1.0_i386.tar.gz</span><br><span class="line">cd percona-toolkit-3.0.13</span><br><span class="line">perl Makefile.PL</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;bin&#x2F;pt-online-schema-change &#x2F;usr&#x2F;bin&#x2F;</span><br></pre></td></tr></table></figure><h2 id="Inception-1"><a href="#Inception-1" class="headerlink" title="Inception"></a>Inception</h2><p>å®‰è£…åŒ…ï¼š</p><p>inception-master.zip </p><p>bison-2.5.1.tar.gz</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yum -y install cmake libncurses5-dev libssl-dev g++ bison gcc gcc-c++ openssl-devel ncurses-devel mysql MySQL-python</span><br><span class="line"></span><br><span class="line">cd &#x2F;opt&#x2F;see&#x2F;</span><br><span class="line">tar -zxvf bison-2.5.1.tar.gz</span><br><span class="line">cd bison-2.5.1</span><br><span class="line">.&#x2F;configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line">unzip inception-master.zip</span><br><span class="line">cd inception-master&#x2F;</span><br><span class="line">sh inception_build.sh builddir linux</span><br></pre></td></tr></table></figure><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>åˆ›å»ºæ–‡ä»¶ /etc/inc.cnf ,å†…å®¹å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[inception]</span><br><span class="line">general_log&#x3D;1</span><br><span class="line">general_log_file&#x3D;inc.log</span><br><span class="line">port&#x3D;6669</span><br><span class="line">socket&#x3D;&#x2F;tmp&#x2F;inc.socket </span><br><span class="line">character-set-client-handshake&#x3D;0 </span><br><span class="line">character-set-server&#x3D;utf8 </span><br><span class="line">inception_remote_system_password&#x3D;123456 </span><br><span class="line">inception_remote_system_user&#x3D;root </span><br><span class="line">inception_remote_backup_port&#x3D;3306 </span><br><span class="line">inception_remote_backup_host&#x3D;127.0.0.1 </span><br><span class="line">inception_support_charset&#x3D;utf8 </span><br><span class="line">inception_enable_nullable&#x3D;0 </span><br><span class="line">inception_check_primary_key&#x3D;1 </span><br><span class="line">inception_check_column_comment&#x3D;1 </span><br><span class="line">inception_check_table_comment&#x3D;1 </span><br><span class="line">inception_osc_min_table_size&#x3D;1 </span><br><span class="line">inception_osc_bin_dir&#x3D;&#x2F;usr&#x2F;bin </span><br><span class="line">inception_osc_chunk_time&#x3D;0.1 </span><br><span class="line">inception_ddl_support&#x3D;1</span><br><span class="line">inception_enable_blob_type&#x3D;1 </span><br><span class="line">inception_check_column_default_value&#x3D;1</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼å¦‚æœä½ éœ€è¦å¯¹å…¶ä»–æ•°æ®åº“åˆ›å»ºutf8mb4æˆ–å…¶ä»–å­—ç¬¦é›†çš„åº“æˆ–è¡¨ï¼Œéœ€è¦åœ¨inception_support_charset å¢åŠ å“åº”å­—ç¬¦é›†ï¼Œä»¥,éš”å¼€ï¼Œä¾‹å¦‚ï¼š</p><p>inception_support_charset=utf8,utf8mb4</p><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p>nohup /usr/local/inception-master/builddir/mysql/bin/Inception â€“defaults-file=/etc/inc.cnf &amp;</p><h2 id="Sqladvisor"><a href="#Sqladvisor" class="headerlink" title="Sqladvisor"></a>Sqladvisor</h2><p>å®‰è£…åŒ…</p><p>SQLAdvisor-master.zip </p><p>percona-release-0.1-3.noarch.rpm</p><h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;src&#x2F;</span><br><span class="line">unzip inception-master.zip</span><br><span class="line">yum install -y cmake libaio-devel libffi-devel glib2 glib2-devel bison</span><br><span class="line"># ç§»é™¤mysql-communityåº“(æ— ç”¨é€”ä¸”å’ŒPercona-Serveræœ‰å†²çª)</span><br><span class="line">yum remove -y mysql-community-client mysql-community-server mysql-community-common mysql-community-libs</span><br><span class="line">cd &#x2F;usr&#x2F;lib64&#x2F; </span><br><span class="line">ln -s libperconaserverclient_r.so.18 libperconaserverclient_r.so </span><br><span class="line">rpm -ivh &#x2F;opt&#x2F;see&#x2F;percona-release-0.1-3.noarch.rpm</span><br><span class="line">yum install -y Percona-Server-shared-56</span><br><span class="line">cd &#x2F;usr&#x2F;local&#x2F;src&#x2F;SQLAdvisor&#x2F;</span><br><span class="line">cmake -DBUILD_CONFIG&#x3D;mysql_release -DCMAKE_BUILD_TYPE&#x3D;debug -DCMAKE_INSTALL_PREFIX&#x3D;&#x2F;usr&#x2F;local&#x2F;sqlparser .&#x2F;</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="ç¼–è¯‘sqladvisor-æºç ç›®å½•"><a href="#ç¼–è¯‘sqladvisor-æºç ç›®å½•" class="headerlink" title="ç¼–è¯‘sqladvisor(æºç ç›®å½•)"></a>ç¼–è¯‘sqladvisor(æºç ç›®å½•)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd .&#x2F;sqladvisor&#x2F;</span><br><span class="line">cmake -DCMAKE_BUILD_TYPE&#x3D;debug .&#x2F;</span><br><span class="line">make</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp &#x2F;usr&#x2F;local&#x2F;src&#x2F;SQLAdvisor&#x2F;sqladvisor&#x2F;sqladvisor &#x2F;usr&#x2F;bin&#x2F;sqladvisor</span><br><span class="line">sqladvisor -h 127.0.0.1  -P 3306  -u root -p &#39;123456&#39; -d test -q &quot;sqlè¯­å¥&quot; -v 1</span><br></pre></td></tr></table></figure><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p>å®‰è£…åŒ… </p><p>redis-4.0.6.tar.gz</p><h3 id="å®‰è£…-2"><a href="#å®‰è£…-2" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc</span><br><span class="line">cd &#x2F;opt&#x2F;see&#x2F;</span><br><span class="line">tar -zxvf redis-4.0.6.tar.gz</span><br><span class="line">cd redis-4.0.6</span><br><span class="line">make MALLOC&#x3D;libcã€€ã€€</span><br><span class="line">cd src &amp;&amp; make install</span><br><span class="line">.&#x2F;redis-server &#x2F;opt&#x2F;see&#x2F;redis-4.0.6&#x2F;redis.conf</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-opt-see-redis-4-0-6-redis-conf"><a href="#é…ç½®-opt-see-redis-4-0-6-redis-conf" class="headerlink" title="é…ç½® /opt/see/redis-4.0.6/redis.conf"></a>é…ç½® /opt/see/redis-4.0.6/redis.conf</h3><p>daemonize yes<br>bind 0.0.0.0</p><h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p>yum install  -y  epel-release nginx</p><p>ä¿®æ”¹Nginxé…ç½®æ–‡ä»¶ nginx.conf, ä½¿serveréƒ¨åˆ†çš„å†…å®¹å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">  &#123;</span><br><span class="line">    listen 81;  # ç”¨æˆ·è®¿é—®ç«¯å£</span><br><span class="line">    access_log    &#x2F;var&#x2F;log&#x2F;access.log;</span><br><span class="line">    error_log    &#x2F;var&#x2F;log&#x2F;error.log;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123; </span><br><span class="line">        root &#x2F;usr&#x2F;local&#x2F;seevenv&#x2F;see-master&#x2F;frontend&#x2F;dist&#x2F;;  # å‰ç«¯é¡¹ç›®æ–‡ä»¶</span><br><span class="line">        try_files $uri $uri&#x2F; &#x2F;index.html &#x3D;404; </span><br><span class="line">        index  index.html; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    location &#x2F;static&#x2F;rest_framework_swagger &#123;  #  å‰ç«¯APIé™æ€æ–‡ä»¶</span><br><span class="line">        root &#x2F;usr&#x2F;local&#x2F;seevenv&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;rest_framework_swagger&#x2F;; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    location &#x2F;static&#x2F;rest_framework &#123;  #  å‰ç«¯rest_frameworké™æ€æ–‡ä»¶</span><br><span class="line">        root &#x2F;usr&#x2F;local&#x2F;seevenv&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;rest_framework&#x2F;;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    location &#x2F;api &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;127.0.0.1:8090;  # åç«¯ç«¯å£æ­¤å¤„ä¸€å®šå¾—æ˜¯127.0.0.1</span><br><span class="line">        add_header Access-Control-Allow-Origin *; </span><br><span class="line">        add_header Access-Control-Allow-Headers Content-Type;</span><br><span class="line">        add_header Access-Control-Allow-Headers &quot;Origin, X-Requested-With, Content-Type, Accept&quot;;</span><br><span class="line">        add_header Access-Control-Allow-Methods &quot;GET, POST, OPTIONS, PUT, DELETE, PATCH&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="See"><a href="#See" class="headerlink" title="See"></a>See</h2><p>ç»ˆäºåˆ°äº†seeå¹³å°æœ¬èº«äº†</p><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y readline readline-devel gcc gcc-c++ zlib zlib-devel openssl openssl-devel sqlite-devel python-devel openldap-clients openldap-devel openssl-devel</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…python3-6-6"><a href="#å®‰è£…python3-6-6" class="headerlink" title="å®‰è£…python3.6.6"></a>å®‰è£…python3.6.6</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;opt&#x2F;see&#x2F;</span><br><span class="line">tar -xzf Python-3.6.6.tgz </span><br><span class="line">cd Python-3.6.6</span><br><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;python3.6 --enable-shared</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;python3.6&#x2F;bin&#x2F;python3.6 &#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;python3.6&#x2F;bin&#x2F;pip3 &#x2F;usr&#x2F;bin&#x2F;pip3</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;python3.6&#x2F;bin&#x2F;pyvenv &#x2F;usr&#x2F;bin&#x2F;pyvenv</span><br><span class="line"></span><br><span class="line"># é“¾æ¥åº“æ–‡ä»¶</span><br><span class="line">cp &#x2F;usr&#x2F;local&#x2F;python3.6&#x2F;lib&#x2F;libpython3.6m.so.1.0 &#x2F;usr&#x2F;local&#x2F;lib</span><br><span class="line">cd &#x2F;usr&#x2F;local&#x2F;lib</span><br><span class="line">ln -s libpython3.6m.so.1.0 libpython3.6m.so</span><br><span class="line">echo &#39;&#x2F;usr&#x2F;local&#x2F;lib&#39; &gt;&gt; &#x2F;etc&#x2F;ld.so.conf</span><br><span class="line">&#x2F;sbin&#x2F;ldconfig</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…DjangoåŠSeeåç«¯"><a href="#å®‰è£…DjangoåŠSeeåç«¯" class="headerlink" title="å®‰è£…DjangoåŠSeeåç«¯"></a>å®‰è£…DjangoåŠSeeåç«¯</h3><p>å®‰è£…åŒ…</p><p>see-master.zip</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;python3.6&#x2F;bin&#x2F;pyvenv seevenv</span><br><span class="line">cd seevenv</span><br><span class="line">source bin&#x2F;activate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unzip master.zip</span><br><span class="line">cd see-master&#x2F;backend&#x2F;</span><br><span class="line">pip install -r requirements.txt --trusted-host mirrors.aliyun.com -i https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;pypi&#x2F;simple&#x2F;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ç¡®ä¿mysqlçš„rootå¯†ç ä¸º 123456</span><br><span class="line">mysql -uroot -p123456 -e &quot;create database sqlweb CHARACTER SET utf8;&quot;</span><br><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br><span class="line"># å†æ‰§è¡Œä¸€æ¬¡migrate</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·-å¯ç”¨äºé¡µé¢çš„ç”¨æˆ·ç™»å½•"><a href="#åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·-å¯ç”¨äºé¡µé¢çš„ç”¨æˆ·ç™»å½•" class="headerlink" title="åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ· (å¯ç”¨äºé¡µé¢çš„ç”¨æˆ·ç™»å½•)"></a>åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ· (å¯ç”¨äºé¡µé¢çš„ç”¨æˆ·ç™»å½•)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py createsuperuser --username admin --email admin@domain.com</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…SOAR"><a href="#å®‰è£…SOAR" class="headerlink" title="å®‰è£…SOAR"></a>å®‰è£…SOAR</h3><p>mkdir -p /usr/local/SOAR/bin/<br>cp /usr/local/seevenv/see-master/frontend/src/files/soar /usr/local/SOAR/bin<br>chmod +x /usr/local/SOAR/bin/soar</p><h2 id="è®¾ç½®ï¼ˆéå¿…éœ€æ“ä½œï¼‰"><a href="#è®¾ç½®ï¼ˆéå¿…éœ€æ“ä½œï¼‰" class="headerlink" title="è®¾ç½®ï¼ˆéå¿…éœ€æ“ä½œï¼‰"></a>è®¾ç½®ï¼ˆéå¿…éœ€æ“ä½œï¼‰</h2><p>æ‰“å¼€æ–‡ä»¶ /usr/local/seevenv/see-master/backend/sqlweb/settings.py,æ‰¾åˆ°ä»¥ä¸‹è®¾ç½®å¹¶ä¿®æ”¹</p><h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DATABASES &#x3D; &#123;</span><br><span class="line">&#39;default&#39;: &#123;</span><br><span class="line">        &#39;ENGINE&#39;: &#39;django.db.backends.mysql&#39;,</span><br><span class="line">        &#39;NAME&#39;: &#39;sqlweb&#39;,</span><br><span class="line">        &#39;USER&#39;: &#39;root&#39;,</span><br><span class="line">        &#39;PASSWORD&#39;: &#39;123456&#39;,</span><br><span class="line">        &#39;HOST&#39;:&#39;127.0.0.1&#39;,</span><br><span class="line">        &#39;PORT&#39;:&#39;3306&#39;,</span><br><span class="line">        &#39;OPTIONS&#39;: &#123;&#39;charset&#39;:&#39;utf8mb4&#39;&#125;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Redis-1"><a href="#Redis-1" class="headerlink" title="Redis"></a>Redis</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REDIS_HOST &#x3D; &#39;127.0.0.1&#39;  # redisåœ°å€</span><br><span class="line">REDIS_PORT &#x3D; 6379  # redisç«¯å£</span><br><span class="line">REDIS_PASSWORD &#x3D; &#39;&#39;  # rediså¯†ç </span><br></pre></td></tr></table></figure><h3 id="Inceptioné…ç½®æ–‡ä»¶"><a href="#Inceptioné…ç½®æ–‡ä»¶" class="headerlink" title="Inceptioné…ç½®æ–‡ä»¶"></a>Inceptioné…ç½®æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INCEPTION_SETTINGS &#x3D; &#123;</span><br><span class="line">    &#39;file_path&#39;: &#39;&#x2F;etc&#x2F;inc.cnf&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SQLAdvisorå’ŒSOARçš„è·¯å¾„"><a href="#SQLAdvisorå’ŒSOARçš„è·¯å¾„" class="headerlink" title="SQLAdvisorå’ŒSOARçš„è·¯å¾„"></a>SQLAdvisorå’ŒSOARçš„è·¯å¾„</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">OPTIMIZE_SETTINGS &#x3D; &#123;</span><br><span class="line">    &#39;sqladvisor_cli&#39;: &#39;&#x2F;usr&#x2F;bin&#x2F;sqladvisor&#39;,</span><br><span class="line">    &#39;soar_cli&#39;: &#39;&#x2F;usr&#x2F;local&#x2F;SOAR&#x2F;bin&#x2F;soar&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é‚®ä»¶"><a href="#é‚®ä»¶" class="headerlink" title="é‚®ä»¶"></a>é‚®ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MAIL &#x3D; &#123;</span><br><span class="line">    &#39;smtp_host&#39;: &#39;smtp.163.com&#39;,  # é‚®ä»¶æœåŠ¡å™¨</span><br><span class="line">    &#39;smtp_port&#39;: 25,  # SMTPåè®®é»˜è®¤ç«¯å£æ˜¯25</span><br><span class="line">    &#39;mail_user&#39;: &#39;sql_see@163.com&#39;,  # é‚®ä»¶ç”¨æˆ·å</span><br><span class="line">    &#39;mail_pass&#39;: &#39;see123&#39;,  # æˆæƒç </span><br><span class="line">    &#39;see_addr&#39;: &#39;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:81&#39;,  # seeé¡¹ç›®è®¿é—®åœ°å€</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨æ‰€æœ‰æœåŠ¡"><a href="#å¯åŠ¨æ‰€æœ‰æœåŠ¡" class="headerlink" title="å¯åŠ¨æ‰€æœ‰æœåŠ¡"></a>å¯åŠ¨æ‰€æœ‰æœåŠ¡</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># mysql  3306ç«¯å£</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;mysqld start</span><br><span class="line"></span><br><span class="line"># inception  6669ç«¯å£</span><br><span class="line">nohup &#x2F;usr&#x2F;local&#x2F;inception-master&#x2F;builddir&#x2F;mysql&#x2F;bin&#x2F;Inception --defaults-file&#x3D;&#x2F;etc&#x2F;inc.cnf &amp;</span><br><span class="line"></span><br><span class="line"># redis  6379ç«¯å£</span><br><span class="line">redis-server &#x2F;etc&#x2F;redis.conf</span><br><span class="line"></span><br><span class="line"># nginx  81ç«¯å£</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx</span><br><span class="line"></span><br><span class="line"># see  8090ç«¯å£</span><br><span class="line">source &#x2F;usr&#x2F;local&#x2F;seevenv&#x2F;bin&#x2F;activate</span><br><span class="line">cd &#x2F;usr&#x2F;local&#x2F;seevenv&#x2F;see-master&#x2F;backend</span><br><span class="line">nohup python manage.py celery worker -c 10 -B --loglevel&#x3D;info &amp;</span><br><span class="line">gunicorn -c sqlweb&#x2F;gunicorn_config.py sqlweb.wsgi</span><br></pre></td></tr></table></figure><p>å¯åŠ¨éƒ½OKï¼å¯ä»¥ä½¿ç”¨å•¦ï¼š</p><p><a href="http://xxx.xxx.xxx.xxx:81/" target="_blank" rel="noopener">http://xxx.xxx.xxx.xxx:81/</a> # see é¡¹ç›®</p><p><a href="http://xxx.xxx.xxx.xxx:81/api/docs/" target="_blank" rel="noopener">http://xxx.xxx.xxx.xxx:81/api/docs/</a> # see api æ–‡æ¡£</p><p>æ¨èç”¨Chromeæµè§ˆå™¨è®¿é—®</p><h2 id="é—®é¢˜è®°å½•"><a href="#é—®é¢˜è®°å½•" class="headerlink" title="é—®é¢˜è®°å½•"></a>é—®é¢˜è®°å½•</h2><h3 id="yum-install-y-Percona-Server-shared-56-å¤±è´¥"><a href="#yum-install-y-Percona-Server-shared-56-å¤±è´¥" class="headerlink" title="yum install -y Percona-Server-shared-56 å¤±è´¥"></a>yum install -y Percona-Server-shared-56 å¤±è´¥</h3><p>yum å®‰è£…Percona MySQLæ—¶ï¼Œæç¤ºé”™è¯¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">The GPG keys listed for the &quot;Percona-Release YUM repository - x86_64&quot; repository are already installed but they are not correct for this package.</span><br><span class="line">Check that the correct key URLs are configured for this repository.</span><br><span class="line"> Failing package is: Percona-Server-client-56-5.6.43-rel84.3.el7.x86_64</span><br><span class="line"> GPG Keys are configured as: file:&#x2F;&#x2F;&#x2F;etc&#x2F;pki&#x2F;rpm-gpg&#x2F;RPM-GPG-KEY-Percona</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•ï¼šyum update percona-release</p><h3 id="é‡å¯seeå¹³å°"><a href="#é‡å¯seeå¹³å°" class="headerlink" title="é‡å¯seeå¹³å°"></a>é‡å¯seeå¹³å°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps aux|grep python|grep -v grep|cut -c 9-15|xargs kill -15</span><br><span class="line">nohup python manage.py celery worker -c 10 -B --loglevel&#x3D;info &amp;</span><br><span class="line">gunicorn -c sqlweb&#x2F;gunicorn_config.py sqlweb.wsgi</span><br></pre></td></tr></table></figure><h3 id="è§£å†³python3ä¸‹pymysqlå¯¹inceptionæ”¯æŒçš„é—®é¢˜"><a href="#è§£å†³python3ä¸‹pymysqlå¯¹inceptionæ”¯æŒçš„é—®é¢˜" class="headerlink" title="è§£å†³python3ä¸‹pymysqlå¯¹inceptionæ”¯æŒçš„é—®é¢˜"></a>è§£å†³python3ä¸‹pymysqlå¯¹inceptionæ”¯æŒçš„é—®é¢˜</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ValueError: invalid literal for int() with base 10: &#39;Inception2&#39;</span><br><span class="line"># æŸ¥æ‰¾pymysqlæºç ä¿®æ”¹connections.pyæ–‡ä»¶ï¼Œ&#x2F;usr&#x2F;local&#x2F;seevenv&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;pymysql&#x2F;connections.py</span><br><span class="line"></span><br><span class="line">    # æ‰¾åˆ°æ­¤å¤„</span><br><span class="line">    def _request_authentication(self):</span><br><span class="line">        # https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;internals&#x2F;en&#x2F;connection-phase-packets.html#packet-Protocol::HandshakeResponse</span><br><span class="line">        if int(self.server_version.split(&#39;.&#39;, 1)[0]) &gt;&#x3D; 5:</span><br><span class="line">            self.client_flag |&#x3D; CLIENT.MULTI_RESULTS</span><br><span class="line"></span><br><span class="line">    # ä¿®æ”¹ä¸º</span><br><span class="line">    def _request_authentication(self):</span><br><span class="line">        # https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;internals&#x2F;en&#x2F;connection-phase-packets.html#packet-Protocol::HandshakeResponse</span><br><span class="line">        if self.server_version.split(&#39;.&#39;, 1)[0] &#x3D;&#x3D; &#39;Inception2&#39;:</span><br><span class="line">            self.client_flag |&#x3D; CLIENT.MULTI_RESULTS</span><br><span class="line">        elif int(self.server_version.split(&#39;.&#39;, 1)[0]) &gt;&#x3D; 5:</span><br><span class="line">            self.client_flag |&#x3D; CLIENT.MULTI_RESULTS</span><br></pre></td></tr></table></figure><h3 id="è§£å†³-Inception"><a href="#è§£å†³-Inception" class="headerlink" title="è§£å†³ Inception"></a>è§£å†³ Inception</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">å§‹ç»ˆåé¦ˆâ€Must start as begin statementâ€çš„è¯­æ³•é”™è¯¯</span><br><span class="line"># æŸ¥æ‰¾pymysqlæºç ä¿®æ”¹cursors.pyæ–‡ä»¶ï¼Œ&#x2F;usr&#x2F;local&#x2F;seevenv&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;pymysql&#x2F;cursors.py</span><br><span class="line"></span><br><span class="line">    # æ‰¾åˆ°æ­¤å¤„</span><br><span class="line">    if not self._defer_warnings:</span><br><span class="line">        self._show_warnings()    </span><br><span class="line"></span><br><span class="line">    # ä¿®æ”¹ä¸º</span><br><span class="line">    if not self._defer_warnings:</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å®‰è£…è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œå®‰è£…å®ŒæˆååŸºæœ¬ä¸Šå°±å¯ä»¥çœå¿ƒå¾ˆå¤šäº†ï¼Œå½“ç„¶ä½ è¿˜å¾—ç»™å¼€å‘æµ‹è¯•äººå‘˜å¼€é€šè´¦å·ï¼Œç„¶åæŠŠä¸€äº›å…¬å…±çš„è´¦å·å›æ”¶(è¿™å¹¶ä¸ç®€å•)ï¼Œä¸€åŠ³æ°¸é€¸çš„äº‹å“ªæœ‰é‚£ä¹ˆå¤šå‘¢ï¼Œä¸è¿‡è¶æœºå­¦ä¹ äº†ä¸€æ³¢è¿˜æ˜¯æŒºå€¼çš„ã€‚</p><p>seeå¹³å°ä¸ä»…æ˜¯æ‰˜ç®¡å®¡è®¡çš„åŠŸèƒ½ï¼Œsqlä¼˜åŒ–æ˜¯å®ƒçš„äº®ç‚¹ï¼Œä½ å¯ä»¥é€šè¿‡Sqladvisorå’ŒSOARæ¥ä¼˜åŒ–sqlï¼Œå‡è½»DBAå‹åŠ›(ä½†æ˜¯å¥½åƒä¹Ÿæ²¡äººä¼šè®°å¾—ç”¨è¿™ä¸ªï¼Œå°±è‡ªä¿¡å‘—ï¼Œå°±ç§€)ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://github.com/myide/see/blob/master/frontend/src/files/install.md" target="_blank" rel="noopener">Seeé¡¹ç›®æ­å»º</a></p><p><a href="https://github.com/XiaoMi/soar" target="_blank" rel="noopener">SOAR </a> </p><p><a href="https://github.com/Meituan-Dianping/SQLAdvisor" target="_blank" rel="noopener">SQLAdvisor</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
            <tag> å®¡è®¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è·Ÿæˆ‘å­¦Mysqlä¹‹ç´¢å¼•ç¯‡</title>
      <link href="/2020/06/30/mysql/mysql-index/"/>
      <url>/2020/06/30/mysql/mysql-index/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="ç´¢å¼•æ˜¯ä»€ä¹ˆ"><a href="#ç´¢å¼•æ˜¯ä»€ä¹ˆ" class="headerlink" title="ç´¢å¼•æ˜¯ä»€ä¹ˆ"></a>ç´¢å¼•æ˜¯ä»€ä¹ˆ</h1><p>ç´¢å¼•ç”¨äºå¿«é€ŸæŸ¥æ‰¾å…·æœ‰ç‰¹å®šåˆ—å€¼çš„è¡Œã€‚æ²¡æœ‰ç´¢å¼•ï¼ŒMySQLå¿…é¡»ä»ç¬¬ä¸€è¡Œå¼€å§‹ï¼Œç„¶åé€šè¯»æ•´ä¸ªè¡¨ä»¥æ‰¾åˆ°ç›¸å…³çš„è¡Œã€‚è¡¨è¶Šå¤§ï¼ŒèŠ±è´¹è¶Šå¤šã€‚å¦‚æœè¡¨ä¸­æœ‰ç›¸å…³åˆ—çš„ç´¢å¼•ï¼ŒMySQLå¯ä»¥å¿«é€Ÿç¡®å®šè¦åœ¨æ•°æ®æ–‡ä»¶ä¸­é—´æŸ¥æ‰¾çš„ä½ç½®ï¼Œè€Œä¸å¿…æŸ¥çœ‹æ‰€æœ‰æ•°æ®ã€‚è¿™æ¯”é¡ºåºè¯»å–æ¯ä¸€è¡Œè¦å¿«å¾—å¤šã€‚</p><p>å¦‚æœä¸Šé¢çš„æè¿°è¿˜ä¸è¶³å¤Ÿè®©ä½ ç†è§£ï¼Œæˆ‘å¯ä»¥å…ˆç»™å¤§å®¶è®²ä¸€ä¸ªä¾‹å­ï¼Œå‡å¦‚ä½ éœ€è¦åœ¨ä¸€æœ¬å­—å…¸é‡ŒæŸ¥æ‰¾ä¸€ä¸ªç”Ÿåƒ»å­—ï¼ˆé¦–å…ˆä½ ä¸çŸ¥é“å®ƒçš„å‘éŸ³ï¼Œä½ å°±ä¸ä¼šå»æ‰¾å­—æ¯ç›®å½•ï¼Œè€Œæ˜¯ä¼šå»æ‰¾åæ—ç›®å½•ï¼‰å¦‚æœä½ ä¸æ‰¾ç›®å½•ï¼Œä½ å°±å¿…é¡»è¦æŠŠå­—å…¸å…¨éƒ¨ç¿»ä¸€éä¸€ä¸ªä¸€ä¸ªå¯¹æ¯”è¿™ä¸ªå­—ï¼ˆæˆ‘çš„å¤©ï¼Œæœ‰è¿™ä¹ˆéº»çƒ¦å—ï¼‰å‰ææ˜¯ä½ ç¡®å®ä¸çŸ¥é“è¿™ä¸ªå­—çš„å‘éŸ³ï¼Œè€Œä¸”ä½ ä¹Ÿä¸æƒ³æ‰¾åæ—ç´¢å¼•ï¼Œé‚£ä½ åªèƒ½è¿™æ ·éº»çƒ¦åœ°åšäº†ï¼Œç„¶åä½ æ‰¾åˆ°åæ—æ‰€åœ¨çš„é¡µæ•°åï¼Œä½ å°±ä¼šå»é‚£ä¸€é¡µæ‰¾åˆ°ç›¸å…³çš„å­—ï¼Œæœ€ç»ˆæ‰¾åˆ°ä½ æƒ³æŸ¥æ‰¾çš„ç”Ÿåƒ»å­—çš„å…¨éƒ¨ä¿¡æ¯ã€‚</p><p>æ•°æ®åº“ç´¢å¼•ä¹Ÿæ˜¯å¦‚æ­¤ï¼ŒæŸ¥è¯¢ä¸€å¼ è¡¨çš„æŸä¸€è¡Œçš„ä¿¡æ¯ï¼ˆä¸æ˜¯æŸ¥å…¨è¡¨æ•°æ®ï¼‰ã€‚</p><p>select * from test where a=â€1â€</p><p>å¦‚æœä½ ä¸ç”¨ç´¢å¼•ï¼Œé‚£ä¹ˆæŸ¥è¯¢è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šå…ˆè·å–è¿™å¼ è¡¨çš„æ‰€æœ‰æ•°æ®ï¼Œç„¶åä¾æ¬¡éå†ï¼Œå°†a=1çš„è¡Œç­›é€‰å‡ºæ¥ï¼Œæœ€åè¿”å›</p><p>å¦‚æœä½ ä½¿ç”¨ç´¢å¼•ï¼Œé‚£ä¹ˆæŸ¥è¯¢è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šç›´æ¥å»ç´¢å¼•é‡Œæ‰¾åˆ°a=1çš„æ‰€æœ‰è¡Œï¼Œè¿”å›ã€‚</p><p>å½“ç„¶æˆ‘è¿™ä¹ˆè¯´ä¸å¤ªå‡†ç¡®ï¼Œåªæ˜¯ä¸ºäº†å¸®åŠ©å¤§å®¶æ›´å¥½çš„ç†è§£ç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•ä¹Ÿåˆ†å‡ ç§ï¼Œå…·ä½“å®ç°çš„åº•å±‚é€»è¾‘ä¹Ÿä¸å¤ªä¸€æ ·ï¼Œä¸‹é¢æˆ‘å°±è®²è®²ç´¢å¼•çš„åˆ†ç±»ã€‚</p><h1 id="ç´¢å¼•åˆ†ç±»"><a href="#ç´¢å¼•åˆ†ç±»" class="headerlink" title="ç´¢å¼•åˆ†ç±»"></a>ç´¢å¼•åˆ†ç±»</h1><p>ç”±äºåœ¨Mysql5.7ä¸­ï¼ŒInnoDBæ˜¯é»˜è®¤çš„MySQLå­˜å‚¨å¼•æ“ã€‚æ‰€ä»¥ä¸‹é¢æˆ‘è®²åˆ°çš„ç´¢å¼•éƒ½æ˜¯åŸºäºInnoDBä¸‹çš„ã€‚</p><h2 id="èšç°‡ç´¢å¼•"><a href="#èšç°‡ç´¢å¼•" class="headerlink" title="èšç°‡ç´¢å¼•"></a>èšç°‡ç´¢å¼•</h2><p>æ¯ä¸ªInnoDBè¡¨éƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç´¢å¼•ï¼Œç§°ä¸ºèšç°‡ç´¢å¼•ï¼ˆä¹Ÿå«ä¸»é”®ç´¢å¼•ã€ä¸€çº§ç´¢å¼•ï¼‰ ï¼Œç”¨äºå­˜å‚¨è¡Œæ•°æ®ã€‚é€šå¸¸ï¼Œèšç°‡ç´¢å¼•ä¸ä¸»é”®åŒä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸»é”®çš„å­—æ®µé»˜è®¤ç»™å®ƒä¸Šäº†èšç°‡ç´¢å¼• ã€‚ä½¿ç”¨InnoDBèšç°‡ç´¢å¼•ä¸ºæ¯ä¸ªè¡¨ä¼˜åŒ–æœ€å¸¸è§çš„æŸ¥æ‰¾å’ŒDMLæ“ä½œã€‚</p><p>å®˜æ–¹è§£é‡Šï¼š</p><ul><li>åœ¨PRIMARY KEYè¡¨ä¸Šå®šä¹‰a æ—¶ï¼ŒInnoDBå°†å…¶ç”¨ä½œèšç°‡ç´¢å¼•ã€‚ä¸ºåˆ›å»ºçš„æ¯ä¸ªè¡¨å®šä¹‰ä¸€ä¸ªä¸»é”®ã€‚å¦‚æœæ²¡æœ‰é€»è¾‘å”¯ä¸€ä¸”éç©ºçš„åˆ—æˆ–åˆ—é›†ï¼Œè¯·æ·»åŠ ä¸€ä¸ªæ–°çš„ è‡ªåŠ¨é€’å¢åˆ—ï¼Œå…¶å€¼å°†è‡ªåŠ¨å¡«å……ã€‚</li><li>å¦‚æœæ²¡æœ‰PRIMARY KEYä¸ºè¡¨å®šä¹‰ï¼ŒMySQLæ‰¾åˆ°æ‰€æœ‰åˆ—éƒ½ä¸ä¸ºç©ºä¸”å”¯ä¸€çš„ç¬¬ä¸€ä¸ªUNIQUEç´¢å¼•ï¼ŒInnoDBå°†å…¶ç”¨ä½œèšé›†ç´¢å¼•ã€‚</li><li>å¦‚æœè¡¨æ²¡æœ‰ç´¢å¼•PRIMARY KEYæˆ–æ²¡æœ‰åˆé€‚çš„ UNIQUEç´¢å¼•ï¼Œåˆ™åœ¨InnoDB å†…éƒ¨ç”Ÿæˆä¸€ä¸ªéšè—çš„èšé›†ç´¢å¼•GEN_CLUST_INDEXï¼Œè¯¥ç´¢å¼•åœ¨åŒ…å«è¡ŒIDå€¼çš„åˆæˆåˆ—ä¸Šå‘½å ã€‚è¿™äº›è¡Œç”±InnoDBåˆ†é…ç»™è¯¥è¡¨ä¸­å„è¡Œçš„IDæ’åº ã€‚è¡ŒIDæ˜¯ä¸€ä¸ª6å­—èŠ‚çš„å­—æ®µï¼Œéšç€æ’å…¥æ–°è¡Œè€Œå•è°ƒå¢åŠ ã€‚å› æ­¤ï¼ŒæŒ‰è¡ŒIDæ’åºçš„è¡Œå®é™…ä¸Šåœ¨æ’å…¥é¡ºåºä¸Šã€‚</li></ul><p>ä¸‹é¢æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p><ul><li>èšç°‡ç´¢å¼•å¿…é¡»æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯è¯¥å­—æ®µçš„å€¼å¿…é¡»å”¯ä¸€ä¸”éç©ºã€‚</li><li>å¦‚æœä¸€ä¸ªè¡¨æœ‰ä¸»é”®ï¼Œé‚£ä¹ˆè¯¥ä¸»é”®ä¹Ÿä½œèšç°‡ç´¢å¼•ã€‚</li><li>å¦‚æœä¸€ä¸ªè¡¨æ— ä¸»é”®ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šç´¢å¼•ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªéç©ºä¸”å”¯ä¸€çš„ç´¢å¼•ä¼šè¢«è½¬åŒ–æˆèšç°‡ç´¢å¼•ã€‚</li><li>å¦‚æœä¸€ä¸ªè¡¨æ— ä¸»é”®ï¼ˆå®æˆ˜åŸºæœ¬ä¸å¯èƒ½ï¼‰ï¼Œä¸”æ•´ä¸ªè¡¨çš„æ‰€æœ‰ç´¢å¼•éƒ½ä¸æ»¡è¶³ï¼ˆæ—¢ä¸ä¸ºç©ºï¼Œè€Œä¸”å”¯ä¸€ï¼‰ï¼Œåˆ™InnoDBä¸ºäº†ä¿è¯è¡¨çš„å®Œæ•´æ€§ï¼Œä¼šç»™éšè—å­—æ®µä¸­6å­—èŠ‚çš„DB_ROW_IDä¸Šä¸»é”®å’Œèšç°‡ç´¢å¼•ï¼Œåªä¸è¿‡ä¸èƒ½è¢«å¤–éƒ¨è°ƒç”¨ã€‚</li></ul><p>åœ¨å®æˆ˜ä¸­ï¼Œä¸€èˆ¬æ¥è¯´ä¸»é”®æœ€å¥½è®¾ä¸ºè‡ªå¢idï¼Œè€Œä¸”å°½é‡é¿å…ç”¨ä¸šåŠ¡idä½œä¸ºä¸»é”®ï¼Œè¿™æ ·ä¼šå‡å°‘ç´¢å¼•çš„å­˜å‚¨ç©ºé—´ä»¥åŠæé«˜æœç´¢æ•ˆç‡ï¼Œå…·ä½“åŸå› æˆ‘ä¼šæˆ‘åé¢è¿›è¡Œè®²è§£ã€‚</p><h2 id="äºŒçº§ç´¢å¼•"><a href="#äºŒçº§ç´¢å¼•" class="headerlink" title="äºŒçº§ç´¢å¼•"></a>äºŒçº§ç´¢å¼•</h2><p>é™¤èšç°‡ç´¢å¼•ä¹‹å¤–çš„æ‰€æœ‰ç´¢å¼•éƒ½ç§°ä¸ºäºŒçº§ç´¢å¼•ï¼ˆä¹Ÿå«è¾…åŠ©ç´¢å¼•ã€éèšç°‡ç´¢å¼•ï¼‰ã€‚åœ¨ä¸­InnoDBï¼ŒäºŒçº§ç´¢å¼•ä¸­çš„æ¯ä¸ªè®°å½•éƒ½åŒ…å«è¯¥è¡Œçš„ä¸»é”®åˆ—ä»¥åŠä¸ºè¾…åŠ©ç´¢å¼•æŒ‡å®šçš„åˆ—ã€‚InnoDBä½¿ç”¨æ­¤ä¸»é”®å€¼åœ¨èšç°‡ç´¢å¼•ä¸­æœç´¢è¡Œã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ éœ€è¦é€šè¿‡ä¸€ä¸ªäºŒçº§ç´¢å¼•å»æŸ¥æ‰¾ä¸€è¡Œçš„å€¼ï¼Œé‚£ä¹ˆä½ å¾—å…ˆé€šè¿‡äºŒçº§ç´¢å¼•å»æ‰¾åˆ°äºŒçº§ç´¢å¼•æ‰€å­˜å‚¨çš„èšç°‡ç´¢å¼•çš„å€¼ï¼Œç„¶åå†é€šè¿‡èšç°‡ç´¢å¼•å»æ‰¾åˆ°è¯¥è¡Œçš„å€¼ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšå›è¡¨ã€‚</p><p>å¦‚æœä¸»é”®è¾ƒé•¿ï¼Œåˆ™è¾…åŠ©ç´¢å¼•å°†ä½¿ç”¨æ›´å¤šç©ºé—´ï¼Œå› æ­¤å…·æœ‰çŸ­çš„ä¸»é”®æ˜¯æœ‰åˆ©çš„ã€‚è¿™ä¹Ÿæ˜¯ä¸Šæ–‡è¯´çš„ä¸»é”®æœ€å¥½è®¾ä¸ºè‡ªå¢idï¼Œä¸”ä¸ä¸šåŠ¡æ— å…³ã€‚</p><h2 id="è”åˆç´¢å¼•"><a href="#è”åˆç´¢å¼•" class="headerlink" title="è”åˆç´¢å¼•"></a>è”åˆç´¢å¼•</h2><p>ç”±äºäºŒçº§ç´¢å¼•çš„å›è¡¨æ“ä½œä¼šå†æ¬¡æŸ¥è¯¢èšç°‡ç´¢å¼•çš„å€¼ï¼Œè¿™æ˜¯ä¸€ä»¶æ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼Œå¦‚æœä½ éœ€è¦é«˜é¢‘ç‡åœ°æŸ¥æ‰¾æŸäº›å­—æ®µï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç”¨è”åˆç´¢å¼•ï¼ˆè¦†ç›–ç´¢å¼•ï¼‰ï¼Œå°†ä½ åŸºäºæŸ¥è¯¢çš„å­—æ®µå’Œæœ€ç»ˆæƒ³æŸ¥è¯¢åˆ°çš„å­—æ®µç»„åˆä¸€èµ·ã€‚ä¸€ä¸ªè”åˆç´¢å¼•æœ€å¤šå¯ä»¥åŒ…å«16åˆ—ï¼Œå¯ä»¥è¢«è®¤ä¸ºæ˜¯æ’åºæ•°ç»„ï¼Œå…¶è¡ŒåŒ…å«é€šè¿‡ä¸²è”ç´¢å¼•åˆ—çš„å€¼è€Œåˆ›å»ºçš„å€¼ã€‚</p><p>æ¯”å¦‚ä¸€å¼ ç”¨æˆ·ä¿¡æ¯è¡¨çš„ç»“æ„å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;user&#96; (</span><br><span class="line">  &#96;id&#96; int(11) NOT NULL,</span><br><span class="line">  &#96;id_card&#96; varchar(32) DEFAULT NULL,</span><br><span class="line">  &#96;name&#96; varchar(32) DEFAULT NULL,</span><br><span class="line">  &#96;age&#96; int(11) DEFAULT NULL,</span><br><span class="line">  &#96;ismale&#96; tinyint(1) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">  KEY &#96;id_card&#96; (&#96;id_card&#96;),</span><br><span class="line">  KEY &#96;name_age&#96; (&#96;name&#96;,&#96;age&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB</span><br></pre></td></tr></table></figure><p>idæ˜¯ä¸»é”®ï¼Œidcardæ˜¯å”¯ä¸€ä¿¡æ¯ï¼Œä½†æ˜¯é•¿åº¦æ˜¯varcharç±»å‹ä¸”é•¿åº¦å¾ˆå¤§ä¸é€‚åˆåšèšç°‡ç´¢å¼•ï¼Œæ‰€ä»¥è®¾ä¸ºäºŒçº§ç´¢å¼•ï¼Œè¿™ä¸ªæ—¶å€™ä½ å¯ä»¥é€šè¿‡idcardå»æŸ¥è¯¢æ¯ä¸ªç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><p>æ­¤æ—¶ä½ æœ‰éœ€è¦é€šè¿‡åå­—å»æŸ¥å¹´é¾„çš„éœ€æ±‚ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥æŠŠåå­—å’Œå¹´é¾„ä¸Šä¸€ä¸ªè”åˆç´¢å¼•ï¼Œåå­—åœ¨å‰ï¼Œå¹´é¾„åœ¨åï¼ˆé¡ºåºå¾ˆé‡è¦ï¼Œåé¢åœ¨è®²ç´¢å¼•çš„ç»“æ„ä¼šè®²åˆ°ä¸ºä»€ä¹ˆè¦è¿™æ ·æ’åºï¼‰ã€‚ä½ æ¯æ¬¡é€šè¿‡å¹´é¾„ç´¢å¼•æŸ¥è¯¢çš„å€¼ä¸ºä¸»é”®idå’Œageï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ç›´æ¥å–åˆ°ageçš„å€¼ï¼Œè¿™æ ·å°±ä¸ç”¨é‡æ–°é€šè¿‡ä¸»é”®idå†å»æŸ¥è¯¢ageä¸€æ¬¡äº†ï¼ˆå›è¡¨æ“ä½œï¼‰ã€‚</p><p>ä½†æ˜¯è”åˆç´¢å¼•æ˜¯æ¯”è¾ƒå èµ„æºï¼Œå¦‚æœä½ ä¸éœ€è¦é«˜é¢‘è¯·æ±‚ï¼Œå»ºè®®ä¸è¦éšä¾¿ä½¿ç”¨è”åˆç´¢å¼•ï¼Œç´¢å¼•çš„ç»´æŠ¤æ€»æ˜¯æœ‰ä»£ä»·çš„ã€‚</p><h2 id="ç´¢å¼•å‰ç¼€"><a href="#ç´¢å¼•å‰ç¼€" class="headerlink" title="ç´¢å¼•å‰ç¼€"></a>ç´¢å¼•å‰ç¼€</h2><p>ä½¿ç”¨å­—ç¬¦ä¸²åˆ—çš„ç´¢å¼•è§„èŒƒä¸­çš„è¯­æ³•ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä»…ä½¿ç”¨åˆ—é¦–å­—ç¬¦çš„ç´¢å¼• ã€‚ä»¥è¿™ç§æ–¹å¼ä»…ç´¢å¼•åˆ—å€¼çš„å‰ç¼€å¯ä»¥ä½¿ç´¢å¼•æ–‡ä»¶å°å¾—å¤šã€‚</p><p>ä¾‹å¦‚ç»™ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­—æ®µä¸Šç´¢å¼•ï¼Œä¸€èˆ¬å®šä¹‰è¿™ä¸ªå­—æ®µçš„å‰Nä½å­—ç¬¦ä¸²æ¥å»ºç«‹ç´¢å¼•ã€‚<br>CREATE TABLE test (blob_col BLOB, INDEX(blob_col(10)));</p><p>å‰ç¼€æœ€é•¿å¯ä»¥ä¸º1000ä¸ªå­—èŠ‚ï¼ˆInnoDBè¡¨ä¸­ä¸º767ä¸ªå­—èŠ‚ ï¼Œé™¤éå·² innodb_large_prefixè®¾ç½®ï¼‰ã€‚</p><p>å¦‚æœæœç´¢è¯è¶…è¿‡ç´¢å¼•å‰ç¼€é•¿åº¦ï¼Œåˆ™ä½¿ç”¨ç´¢å¼•æ’é™¤ä¸åŒ¹é…çš„è¡Œï¼Œç„¶åæ£€æŸ¥å…¶ä½™è¡Œæ˜¯å¦å¯èƒ½åŒ¹é…ã€‚</p><p>ä¾‹å¦‚åœ¨åˆšåˆšçš„é‚£å¼ è¡¨ï¼Œæ‰§è¡Œ<br>select * from test where blob_col=â€™abcdefghijklmnâ€™</p><p>ç´¢å¼•ä¼šå»åŒ¹é…å­—æ®µå‰10ä½ä¸ºâ€™abcdefghijâ€™çš„æ‰€æœ‰è¡Œï¼Œç„¶åä¾æ¬¡æ¯”è¾ƒå‰©ä¸‹çš„åŒ¹é…â€™klmnâ€™çš„å€¼ï¼Œè¿”å›ã€‚</p><h1 id="ç´¢å¼•çš„æ•°æ®ç»“æ„"><a href="#ç´¢å¼•çš„æ•°æ®ç»“æ„" class="headerlink" title="ç´¢å¼•çš„æ•°æ®ç»“æ„"></a>ç´¢å¼•çš„æ•°æ®ç»“æ„</h1><p>ç´¢å¼•çš„æ•°æ®ç»“æ„æ˜¯æ€ä¹ˆéƒ½é€ƒä¸èµ°çš„ä¸€å—ï¼Œæˆ‘æ¯”è¾ƒéš¾ç†è§£ï¼Œæ‰€ä»¥ä¹Ÿä¸åœ¨è®²ç´¢å¼•åˆ†ç±»çš„æ—¶å€™è®²äº†ã€‚</p><h2 id="å¸¸è§çš„å‡ ç§ç´¢å¼•æ•°æ®ç»“æ„"><a href="#å¸¸è§çš„å‡ ç§ç´¢å¼•æ•°æ®ç»“æ„" class="headerlink" title="å¸¸è§çš„å‡ ç§ç´¢å¼•æ•°æ®ç»“æ„"></a>å¸¸è§çš„å‡ ç§ç´¢å¼•æ•°æ®ç»“æ„</h2><p>æˆ‘å…ˆä»‹ç»å¸¸è§çš„å‡ ç§ç´¢å¼•çš„æ•°æ®ç»“æ„</p><ul><li>key-valueï¼šè¿™ç§æ•°æ®ç»“æ„åº”è¯¥æ¯”è¾ƒå¸¸è§ï¼Œé”®å€¼å¯¹ä¹Ÿå«å“ˆå¸Œè¡¨ï¼Œå®ç°ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç”¨ä¸€ä¸ªå“ˆå¸Œå‡½æ•°æŠŠkeyæ¢ç®—æˆä¸€ä¸ªç¡®å®šçš„valueï¼Œç„¶åæŠŠvalueæ”¾åœ¨æ•°ç»„è¿™ä¸ªä½ç½®ï¼Œå¯¹äºå¯èƒ½å‡ºç°ä¸åŒçš„keyæ¢ç®—æˆäº†ä¸€ä¸ªç›¸åŒçš„valueè¿™ç§æƒ…å†µï¼Œå¯ä»¥åœ¨valueå¤„åŠ ä¸Šä¸€ä¸ªé“¾è¡¨ï¼Œä¿å­˜ç›¸åŒvalueå€¼çš„keyä¿¡æ¯ã€‚å¦‚æœæ²¡æœ‰å‡ºç°è¿™ç§æƒ…å†µï¼ˆä¸åŒçš„keyæ¢ç®—æˆäº†ç›¸åŒçš„valueï¼‰ï¼ŒæŸ¥è¯¢ã€æ’å…¥é€Ÿåº¦æ˜¯å¾ˆå¿«çš„ã€‚ä½†æ˜¯ä¸€æ—¦å‡ºç°ä¸Šè¿°æƒ…å†µï¼Œå“ˆå¸Œç´¢å¼•åœ¨åšé“¾è¡¨åŒºé—´æŸ¥è¯¢æ˜¯å¾ˆæ…¢çš„ï¼Œå› ä¸ºä½ é€šè¿‡é”®å€¼å¯¹æŸ¥è¯¢åéœ€è¦éå†åé¢é“¾è¡¨çš„æ‰€æœ‰ç”¨æˆ·ã€‚</li></ul><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Mysql/index/hash.png"  alt="hash.png"></p><ul><li>æœ‰åºæ•°ç»„ï¼š å‡è®¾ç´¢å¼•æ²¡æœ‰é‡å¤ï¼Œé‚£ä¹ˆæ•°ç»„ä¼šæŒ‰ç€è¿™ä¸ªç´¢å¼•å­—æ®µçš„å€¼é€’å¢é¡ºåºä¿å­˜ã€‚å¦‚æœä½ éœ€è¦æŸ¥è¯¢æŸä¸ªå­—æ®µçš„å€¼ï¼Œé€šè¿‡äºŒåˆ†æ³•å¯ä»¥å¿«é€Ÿæ‰¾åˆ°ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(log(N)ã€‚<br>åªçœ‹æŸ¥è¯¢é€Ÿåº¦ï¼Œæœ‰åºæ•°ç»„æ˜¯æ¥è¿‘å®Œç¾çš„ï¼Œä½†æ˜¯æ›´æ–°æ•°æ®çš„æ—¶å€™æ¯”è¾ƒéº»çƒ¦ï¼Œå¦‚æœä½ åœ¨ä¸­é—´æ’å…¥ä¸€æ¡æ•°æ®éœ€è¦å°†åé¢æ‰€æœ‰æ•°æ®çš„ä¸‹æ ‡å¾€åæŒªä¸€ä½ï¼Œè¿™ä¸ªæˆæœ¬æ˜¯å¾ˆé«˜çš„ã€‚</li></ul><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Mysql/index/list.png"  alt="list.png"></p><ul><li>äºŒå‰æ ‘ï¼šäºŒå‰æ ‘çš„è§„åˆ™æ˜¯ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å·¦å„¿å­å°äºçˆ¶èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹åˆå°äºå³å„¿å­ï¼Œè¿™ç§æ•°æ®ç»“æ„çš„æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦æ˜¯O(log(N))ï¼Œå¹¶ä¸”ä¸ºäº†ç»´æŒO(log(N))çš„æŸ¥è¯¢é€Ÿåº¦ï¼Œä½ è¿˜å¾—ä¿æŒè¿™æ£µæ ‘æ˜¯å¹³è¡¡äºŒå‰æ ‘ã€‚ä¸ºäº†åšè¿™ä¸ªä¿è¯ï¼Œæ›´æ–°çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯O(log(N))ã€‚å•çœ‹æŸ¥è¯¢å’Œæ’å…¥äºŒå‰æ ‘æ¥è¿‘å®Œç¾äº†ï¼Œä½†æ˜¯äºŒå‰æ ‘æœ‰ä¸€ä¸ªåå¤„ï¼Œå°±æ˜¯å ç©ºé—´ï¼Œå› ä¸ºç´¢å¼•ä¸åªæ˜¯å­˜åœ¨å†…å­˜ï¼Œè¿˜è¦å†™åˆ°ç£ç›˜ä¸Šã€‚å‡å¦‚ä½ å­˜å‚¨100wæ¡æ•°æ®ï¼Œé‚£ä¹ˆç”¨å¹³è¡¡äºŒå‰æ ‘çš„è¯ï¼Œæ ‘é«˜å°±æ˜¯20ã€‚ä¸€æ¬¡æŸ¥è¯¢ä½ æœ€å¤šéœ€è¦è®¿é—®20ä¸ªæ•°æ®å—ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šè¯»20æ¬¡ç£ç›˜ï¼Œä¸ºäº†è®©ä¸€ä¸ªæŸ¥è¯¢æœ€å°‘åœ°è¯»ç£ç›˜ï¼Œæˆ‘ä»¬å°±åº”è¯¥ä½¿ç”¨Nå‰æ ‘ï¼Œè¿™é‡Œçš„Nå–å†³äºæ•°æ®å—çš„å¤§å°ã€‚è¿™ä¹Ÿæ˜¯å¤§å¤šæ•°æ•°æ®åº“çš„å­˜å‚¨é€‰æ‹©çš„åŸºç¡€æ•°æ®ç»“æ„Nå‰æ ‘ï¼Œå¹¶åœ¨åŸºç¡€ä¸Šè¿›è¡Œæ”¹é€ ã€‚</li></ul><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Mysql/index/tree.png"  alt="tree.png"></p><p>æ€»ç»“ï¼š</p><p>å“ˆå¸Œè¡¨ç»“æ„é€‚åˆç­‰å€¼æŸ¥è¯¢çš„åœºæ™¯ï¼Œæ¯”å¦‚éå…³ç³»å‹æ•°æ®åº“</p><p>æœ‰åºæ•°ç»„é€‚åˆé™æ€å­˜å‚¨çš„åœºæ™¯ï¼Œæ¯”å¦‚ä½ ä¿å­˜æŸå¹´æŸä¸ªåŸå¸‚æ‰€æœ‰äººå£ä¿¡æ¯ï¼Œå¹¶ä¸”ä¸ä¼šä¿®æ”¹æ•°æ®äº†ã€‚</p><p>Nå‰æ ‘é€‚åˆå¤§éƒ¨åˆ†æ•°æ®åº“å¼•æ“ï¼Œæœ‰ç€è‰¯å¥½çš„è¯»å†™æ€§èƒ½ä¼˜ç‚¹ä»¥åŠé€‚é…ç£ç›˜çš„è®¿é—®æ¨¡å¼ã€‚</p><h2 id="InnoDBçš„ç´¢å¼•æ¨¡å‹"><a href="#InnoDBçš„ç´¢å¼•æ¨¡å‹" class="headerlink" title="InnoDBçš„ç´¢å¼•æ¨¡å‹"></a>InnoDBçš„ç´¢å¼•æ¨¡å‹</h2><p>åœ¨InnoDBä¸­ï¼Œè¡¨éƒ½æ˜¯æ ¹æ®ä¸»é”®é¡ºåºä»¥ç´¢å¼•çš„å½¢å¼å­˜æ”¾çš„ï¼ŒInnoDBä½¿ç”¨äº†B+æ ‘ç´¢å¼•æ¨¡å‹ï¼Œæ‰€ä»¥æ•°æ®éƒ½æ˜¯å­˜åœ¨B+æ ‘çš„ã€‚</p><p>æ¯ä¸€ä¸ªç´¢å¼•éƒ½å¯¹åº”ä¸€é¢—B+æ ‘,å¯¹äºB+æ ‘è¿™ç§æ•°æ®ç»“æ„,æˆ‘ç®€å•çš„ä»‹ç»ä¸€ä¸‹å®ƒçš„ç‰¹å¾å’Œä¼˜åŠ¿ã€‚å‚è€ƒèµ„æ–™é‡Œæœ‰è¯¦ç»†ä»‹ç»B+æ ‘çš„é“¾æ¥ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å­¦ä¸‹å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Mysql/index/B+tree.png"  alt="B+tree.png"></p><p>B+æ ‘çš„ç‰¹å¾ï¼š</p><p>1.æœ‰kä¸ªå­æ ‘çš„ä¸­é—´èŠ‚ç‚¹åŒ…å«æœ‰kä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ ä¸ä¿å­˜æ•°æ®ï¼Œåªç”¨æ¥ç´¢å¼•ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å¶å­èŠ‚ç‚¹ã€‚</p><p>2.æ‰€æœ‰çš„å¶å­ç»“ç‚¹ä¸­åŒ…å«äº†å…¨éƒ¨å…ƒç´ çš„ä¿¡æ¯ï¼ŒåŠæŒ‡å‘å«è¿™äº›å…ƒç´ è®°å½•çš„æŒ‡é’ˆï¼Œä¸”å¶å­ç»“ç‚¹æœ¬èº«ä¾å…³é”®å­—çš„å¤§å°è‡ªå°è€Œå¤§é¡ºåºé“¾æ¥ã€‚</p><p>3.æ‰€æœ‰çš„ä¸­é—´èŠ‚ç‚¹å…ƒç´ éƒ½åŒæ—¶å­˜åœ¨äºå­èŠ‚ç‚¹ï¼Œåœ¨å­èŠ‚ç‚¹å…ƒç´ ä¸­æ˜¯æœ€å¤§ï¼ˆæˆ–æœ€å°ï¼‰å…ƒç´ ã€‚</p><p>B+æ ‘çš„ä¼˜åŠ¿ï¼š</p><p>1.å•ä¸€èŠ‚ç‚¹å­˜å‚¨æ›´å¤šçš„å…ƒç´ ï¼Œä½¿å¾—æŸ¥è¯¢çš„IOæ¬¡æ•°æ›´å°‘ã€‚</p><p>2.æ‰€æœ‰æŸ¥è¯¢éƒ½è¦æŸ¥æ‰¾åˆ°å¶å­èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢æ€§èƒ½ç¨³å®šã€‚</p><p>3.æ‰€æœ‰å¶å­èŠ‚ç‚¹å½¢æˆæœ‰åºé“¾è¡¨ï¼Œä¾¿äºèŒƒå›´æŸ¥è¯¢ã€‚</p><p>æ€»ç»“ï¼šInnoDBçš„ç´¢å¼•ç»“æ„å§‹ç»ˆä¿æŒæ’åºï¼Œä»è€Œå¯ä»¥å¿«é€ŸæŸ¥æ‰¾ç²¾ç¡®åŒ¹é…ï¼ˆç­‰äºè¿ç®—ç¬¦ï¼‰å’ŒèŒƒå›´ï¼ˆä¾‹å¦‚ï¼Œå¤§äºï¼Œå°äºå’ŒBETWEEN è¿ç®—ç¬¦ï¼‰</p><h3 id="å¤šä¸ªç´¢å¼•æ¨¡å‹"><a href="#å¤šä¸ªç´¢å¼•æ¨¡å‹" class="headerlink" title="å¤šä¸ªç´¢å¼•æ¨¡å‹"></a>å¤šä¸ªç´¢å¼•æ¨¡å‹</h3><p>å‰é¢æˆ‘è®²è¿‡ç´¢å¼•çš„åˆ†ç±»ï¼Œä¸€èˆ¬å®æˆ˜ä¸­æœ€å¸¸è§çš„ä¸€å¼ è¡¨ç»“æ„éƒ½å«æœ‰èšç°‡ç´¢å¼•ï¼ˆä¸»é”®ï¼‰é…åˆä¸€ä¸ªäºŒçº§ç´¢å¼•ç»„æˆçš„ï¼Œé‚£ä¹ˆé€šè¿‡äº†è§£InnoDBçš„ç´¢å¼•æ¨¡å‹ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¾ˆæ¸…æ™°çš„çœ‹åˆ°äºŒçº§ç´¢å¼•çš„å®ç°è¿‡ç¨‹äº†ã€‚</p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Mysql/index/two_index.jpg"  alt="two_index.jpg"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ªè¡¨ï¼ŒIDæ˜¯èšç°‡ç´¢å¼•ï¼ˆä¸»é”®ï¼‰ï¼ŒKæ˜¯äºŒçº§ç´¢å¼•ï¼ˆå”¯ä¸€ï¼‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select * from table where ID&#x3D;100</span><br><span class="line">mysqlä¼šç”¨èšç°‡ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾ï¼Œé€šè¿‡B+æ ‘è¿…é€ŸæŸ¥è¯¢åˆ°ID&#x3D;100çš„å¶å­èŠ‚ç‚¹ï¼Œæ‹¿åˆ°è¿™ä¸€è¡Œçš„å…¨éƒ¨æ•°æ®ï¼Œè¿”å›ã€‚</span><br><span class="line"></span><br><span class="line">select * from table where k&#x3D;1</span><br><span class="line">mysqlä¼šç”¨äºŒçº§ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾ï¼Œé€šè¿‡B+æ ‘è¿…é€ŸæŸ¥è¯¢åˆ°k&#x3D;1çš„å¶å­èŠ‚ç‚¹ï¼Œæ‹¿åˆ°å½“k&#x3D;1æ—¶ï¼Œä¸»é”®çš„IDçš„å€¼&#x3D;100ï¼Œç„¶åé€šè¿‡ID&#x3D;100å†å»å¦å¤–ä¸€é¢—B+æ ‘å»æŸ¥è¯¢åˆ°ID&#x3D;100çš„å¶å­èŠ‚ç‚¹ï¼Œæ‹¿åˆ°è¿™ä¸€è¡Œçš„å…¨éƒ¨æ•°æ®ï¼Œè¿”å›ã€‚</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥åŸºäºèšç°‡ç´¢å¼•æŸ¥è¯¢åªéœ€è¦æœç´¢ä¸€æ£µæ ‘ï¼Œè€ŒåŸºäºäºŒçº§ç´¢å¼•éœ€è¦å¤šæ‰«æä¸€æ£µæ ‘ã€‚å› æ­¤æˆ‘ä»¬åº”è¯¥åœ¨åº”ç”¨ä¸­å°½é‡ä½¿ç”¨ä¸»é”®æŸ¥è¯¢ã€‚ä¸è¿‡é—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆä¸Šæ–‡æˆ‘è¯´ä¸»é”®æœ€å¥½ä½¿ç”¨ä¸ä¸šåŠ¡æ— å…³çš„è‡ªå¢idï¼Œå¦‚æœæ— å…³çš„è¯ï¼Œä½ æ€ä¹ˆçŸ¥é“ä½ æƒ³æŸ¥è¯¢æ•°æ®çš„ä¸»é”®IDæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘åˆ°ç»´æŠ¤ç´¢å¼•çš„ä»£ä»·ã€‚</p><h3 id="ç´¢å¼•ç»´æŠ¤"><a href="#ç´¢å¼•ç»´æŠ¤" class="headerlink" title="ç´¢å¼•ç»´æŠ¤"></a>ç´¢å¼•ç»´æŠ¤</h3><p>B+æ ‘ä¸ºäº†ç»´æŠ¤ç´¢å¼•çš„æœ‰åºæ€§ï¼Œåœ¨æ’å…¥æ•°æ®çš„æ—¶å€™ä¼šåšå¿…è¦çš„ç»´æŠ¤ã€‚æ¯”å¦‚ä¸Šå›¾ï¼Œä½ è¦æ’å…¥ä¸»é”®IDä¸º700çš„è¡Œæ•°æ®ï¼Œä½ åªéœ€è¦åœ¨600åé¢æ’å…¥ä¸€ä¸ªæ–°æ•°æ®å³å¯ã€‚ä½†æ˜¯ä½ è¦æ˜¯æ’å…¥çš„ä¸»é”®IDä¸º400ï¼Œé‚£ä¹ˆå°±éœ€è¦é€»è¾‘ä¸Šç§»åŠ¨åé¢çš„æ•°æ®ï¼ŒæŠŠè¿™ä¸ªæ•°æ®ç©ºå‡ºæ¥è®©ID=400çš„æ•°æ®æ’å…¥ã€‚</p><p>æ›´éº»çƒ¦çš„æ˜¯å¦‚æœ600æ˜¯æ•°æ®é¡µæœ€åä¸€ä¸ªæ•°æ®ï¼Œå³è¯¥æ•°æ®é¡µæ»¡äº†ï¼Œä¸ºäº†æ’å…¥ID=400 ï¼Œä½ å¿…é¡»é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°æ•°æ®é¡µï¼Œå°†ID=600çš„æ•°æ®æ”¾è¿‡å»ï¼Œç„¶åæ‰èƒ½å°†ID=400çš„æ•°æ®æ’å…¥åˆ°åŸæ•°æ®é¡µã€‚è¿™ä¸ªè¿‡ç¨‹å«åšé¡µåˆ†è£‚ï¼Œåœ¨è¿™ç§æƒ…å†µï¼ŒæŸ¥è¯¢å°±ä¼šå¤šæ‰«ä¸€å¼ æ•°æ®é¡µï¼Œè€Œä¸”ç©ºé—´åˆ©ç”¨ç‡ä¼šé™ä½ç™¾åˆ†ä¹‹50ï¼Œå› ä¸ºæœ¬æ¥åªç”¨å­˜æ”¾åœ¨ä¸€é¡µçš„æ•°æ®ï¼Œç°åœ¨åˆ†åˆ°2é¡µäº†ã€‚</p><p>ä¸è¿‡æœ‰åˆ†è£‚é¡µæœ‰åˆå¹¶ï¼Œç›¸é‚»çš„ä¸¤é¡µç”±äºåˆ é™¤äº†æ•°æ®ï¼Œåˆ©ç”¨ç‡å˜ä½åï¼Œä¼šå°†æ•°æ®é¡µåšåˆå¹¶ã€‚</p><p>æ‰€ä»¥å›åˆ°ä¸Šä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆè™½ç„¶é€šè¿‡èšç°‡ç´¢å¼•æŸ¥è¯¢å¾ˆå¿«ï¼Œä½†æˆ‘ä»¬ä»ç„¶ä½¿ç”¨äºŒçº§ç´¢å¼•æŸ¥è¯¢ï¼Œå› ä¸ºä¸»é”®ç´¢å¼•å¦‚æœä¸æ˜¯è‡ªå¢çš„è¯ï¼Œå¾ˆéš¾ä¿è¯ä½ çš„æ’å…¥æ˜¯æœ‰åºçš„ï¼Œå¦‚æœä½ æ’å…¥ä¸æ˜¯æœ‰åºï¼Œé‚£ä¹ˆå°±å¯èƒ½è§¦å‘é¡µåˆ†è£‚ï¼Œå½±å“æ€§èƒ½å’Œå­˜å‚¨ç©ºé—´ã€‚æ‰€ä»¥å¾—ä½¿ç”¨è‡ªå¢ä¸»é”®ï¼Œè¿™æ ·çš„è¯ä¸»é”®ä¹Ÿå°±æ˜¯æ— ä¸šåŠ¡æ„ä¹‰çš„ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½é€šè¿‡ä¸€ä¸ªæ— æ„ä¹‰çš„å­—æ®µå»åšæŸ¥è¯¢å§ã€‚</p><h3 id="æœ€å·¦å‰ç¼€åŸåˆ™"><a href="#æœ€å·¦å‰ç¼€åŸåˆ™" class="headerlink" title="æœ€å·¦å‰ç¼€åŸåˆ™"></a>æœ€å·¦å‰ç¼€åŸåˆ™</h3><p>ä¸Šæ–‡æˆ‘è®²è¿‡å¯¹äºè”åˆç´¢å¼•çš„åˆ›å»ºï¼Œé¡ºåºå¾ˆé‡è¦ï¼Œå› ä¸ºè”åˆç´¢å¼•éœ€è¦éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™ï¼Œå…·ä½“çœ‹ä¸‹é¢ä¾‹å­ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test (</span><br><span class="line">    id         INT NOT NULL,</span><br><span class="line">    last_name  CHAR(30) NOT NULL,</span><br><span class="line">    first_name CHAR(30) NOT NULL,</span><br><span class="line">    PRIMARY KEY (id),</span><br><span class="line">    INDEX name (last_name,first_name)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¡¨ï¼Œnameä¸ºè”åˆç´¢å¼•ï¼Œå®ƒå¯ç”¨äºæŸ¥è¯¢æŒ‡å®šåœ¨å·²çŸ¥èŒƒå›´å†…çš„last_nameå’Œfirst_name å€¼ç»„åˆçš„å€¼ã€‚å®ƒä¹Ÿå¯ä»¥ç”¨äºä»…æŒ‡å®šlast_nameå€¼çš„æŸ¥è¯¢ï¼Œ å› ä¸ºè¯¥åˆ—æ˜¯ç´¢å¼•çš„æœ€å·¦å‰ç¼€ã€‚</p><p>ä¸‹é¢çš„sqlæ˜¯å¯ä»¥é€šè¿‡nameç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM test WHERE last_name&#x3D;&#39;Jones&#39;;</span><br><span class="line"></span><br><span class="line">SELECT * FROM test</span><br><span class="line">  WHERE last_name&#x3D;&#39;Jones&#39; AND first_name&#x3D;&#39;John&#39;;</span><br><span class="line"></span><br><span class="line">SELECT * FROM test</span><br><span class="line">  WHERE last_name&#x3D;&#39;Jones&#39;</span><br><span class="line">  AND (first_name&#x3D;&#39;John&#39; OR first_name&#x3D;&#39;Jon&#39;);</span><br><span class="line"></span><br><span class="line">SELECT * FROM test</span><br><span class="line">  WHERE last_name&#x3D;&#39;Jones&#39;</span><br><span class="line">  AND first_name &gt;&#x3D;&#39;M&#39; AND first_name &lt; &#39;N&#39;;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œåœ¨ä»¥ä¸‹æŸ¥è¯¢ä¸­ä¸èƒ½ç”¨nameç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM test WHERE first_name&#x3D;&#39;John&#39;;</span><br><span class="line"></span><br><span class="line">SELECT * FROM test</span><br><span class="line">  WHERE last_name&#x3D;&#39;Jones&#39; OR first_name&#x3D;&#39;John&#39;;</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆå¿…é¡»é€šè¿‡è”åˆç´¢å¼•çš„æœ€å·¦å­—æ®µæŸ¥è¯¢å‘¢ï¼Ÿå› ä¸ºç´¢å¼•çš„å®è´¨æ˜¯B+æ ‘ï¼Œå¯¹äºéèšç°‡ç´¢å¼•ï¼ˆè”åˆç´¢å¼•å±äºéèšç°‡ç´¢å¼•ï¼‰å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®çš„å€¼(å¦‚æœæ˜¯è”åˆç´¢å¼•ï¼Œè¿˜ä¼šå­˜è”åˆç´¢å¼•çš„éæœ€å·¦å­—æ®µ)</p><p>ç»“è®ºï¼šå¦‚æœè¡¨å…·æœ‰è”åˆç´¢å¼•ï¼Œåˆ™ä¼˜åŒ–å™¨å¯ä»¥ä½¿ç”¨ç´¢å¼•çš„ä»»ä½•æœ€å·¦å‰ç¼€æ¥æŸ¥æ‰¾è¡Œã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªä¸‰åˆ—çš„ç´¢å¼•(col1, col2, col3)ï¼Œä½ æœ‰ç´¢å¼•çš„æœç´¢åŠŸèƒ½ (col1)ï¼Œ(col1, col2)ä»¥åŠ (col1, col2, col3)ã€‚</p><h2 id="æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¢«ä½¿ç”¨"><a href="#æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¢«ä½¿ç”¨" class="headerlink" title="æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¢«ä½¿ç”¨"></a>æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¢«ä½¿ç”¨</h2><p>å§‹ç»ˆæ£€æŸ¥æ‰€æœ‰æŸ¥è¯¢æ˜¯å¦çœŸçš„ä½¿ç”¨æ‚¨åœ¨è¡¨ä¸­åˆ›å»ºçš„ç´¢å¼•ã€‚å¯ä»¥ä½¿ç”¨ EXPLAINè¯­å¥</p><p>EXPLAINå¯ä»¥ä¸º SELECTï¼Œ DELETEï¼Œ INSERTï¼Œ REPLACEï¼Œå’Œ UPDATEè¯­å¥å·¥ä½œã€‚</p><p>å½“EXPLAINä¸å¯è§£é‡Šçš„è¯­å¥ä¸€èµ·ä½¿ç”¨æ—¶ï¼ŒMySQLå°†æ˜¾ç¤ºæ¥è‡ªä¼˜åŒ–å™¨çš„æœ‰å…³è¯­å¥æ‰§è¡Œè®¡åˆ’çš„ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒMySQLè§£é‡Šäº†å®ƒå°†å¦‚ä½•å¤„ç†è¯¥è¯­å¥ï¼ŒåŒ…æ‹¬æœ‰å…³å¦‚ä½•è¿æ¥è¡¨ä»¥åŠä»¥ä½•ç§é¡ºåºè¿æ¥è¡¨çš„ä¿¡æ¯ã€‚</p><p>åœ¨EXPLAINçš„å¸®åŠ©ä¸‹ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°åº”è¯¥åœ¨è¡¨ä¸­æ·»åŠ ç´¢å¼•çš„ä½ç½®ï¼Œä»¥ä¾¿é€šè¿‡ä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾è¡Œæ¥ä½¿è¯­å¥æ›´å¿«åœ°æ‰§è¡Œã€‚</p><p>å…·ä½“ç”±EXPLAINè¾“å‡ºå­—æ®µçš„è¯¦ç»†æ„ä¹‰è¯·æŸ¥çœ‹  <a href="https://dev.mysql.com/doc/refman/5.7/en/explain-output.html" target="_blank" rel="noopener">EXPLAIN Output Columns</a></p><h1 id="æµ…è°ˆç´¢å¼•çš„æ„å»ºè¿‡ç¨‹"><a href="#æµ…è°ˆç´¢å¼•çš„æ„å»ºè¿‡ç¨‹" class="headerlink" title="æµ…è°ˆç´¢å¼•çš„æ„å»ºè¿‡ç¨‹"></a>æµ…è°ˆç´¢å¼•çš„æ„å»ºè¿‡ç¨‹</h1><h2 id="æ’åºç´¢å¼•æ„å»º"><a href="#æ’åºç´¢å¼•æ„å»º" class="headerlink" title="æ’åºç´¢å¼•æ„å»º"></a>æ’åºç´¢å¼•æ„å»º</h2><p>åœ¨åˆ›å»ºæˆ–é‡å»ºç´¢å¼•æ—¶ï¼ŒInnoDBæ‰§è¡Œæ‰¹é‡åŠ è½½ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ’å…¥ä¸€ä¸ªç´¢å¼•è®°å½•ã€‚è¿™ç§ç´¢å¼•åˆ›å»ºæ–¹æ³•ä¹Ÿç§°ä¸ºæ’åºç´¢å¼•æ„å»ºã€‚æ’åºç´¢å¼•æ„å»ºä¸æ”¯æŒç©ºé—´ç´¢å¼•(Spatial Indexes)ã€‚</p><p>ç´¢å¼•æ„å»ºåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ</p><ul><li>æ‰«æèšç°‡ç´¢å¼•ï¼Œå¹¶ç”Ÿæˆç´¢å¼•æ¡ç›®å¹¶å°†å…¶æ·»åŠ åˆ°æ’åºç¼“å†²åŒºï¼Œå½“æ’åºç¼“å†²åŒºå·²æ»¡æ—¶ï¼Œå°†å¯¹æ¡ç›®è¿›è¡Œæ’åºå¹¶å°†å…¶å†™åˆ°ä¸´æ—¶ä¸­é—´æ–‡ä»¶ä¸­ã€‚æ­¤è¿‡ç¨‹ä¹Ÿç§°ä¸ºâ€RUNâ€</li><li>å°†ä¸€ä¸ªæˆ–å¤šä¸ªâ€RUNâ€å†™å…¥ä¸´æ—¶ä¸­é—´æ–‡ä»¶åï¼Œå°†å¯¹æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ¡ç›®æ‰§è¡Œåˆå¹¶æ’åºã€‚</li><li>æ’åºåçš„æ¡ç›®å°†æ’å…¥åˆ°B+æ ‘ä¸­ã€‚</li></ul><h2 id="ä¿®æ”¹æ•°æ®"><a href="#ä¿®æ”¹æ•°æ®" class="headerlink" title="ä¿®æ”¹æ•°æ®"></a>ä¿®æ”¹æ•°æ®</h2><p>ç”±äºInnoDBå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰çš„å­˜åœ¨ï¼Œå¢åˆ æ”¹çš„æ“ä½œå¯¹äºŒçº§ç´¢å¼•çš„å¤„ç†æ–¹å¼ä¸åŒäºå¯¹èšç°‡ç´¢å¼•çš„å¤„ç†æ–¹å¼ã€‚å¦‚æœå¿˜äº†MVCCè¯·å¤ä¹ ä¸€ä¸‹ <a href="https://rugod.cn/2020/06/08/mysql/mysql-trx/" target="_blank" rel="noopener">è·Ÿæˆ‘å­¦Mysqlä¹‹äº‹åŠ¡ç¯‡</a></p><ul><li>èšç°‡ç´¢å¼•</li></ul><p>èšç°‡ç´¢å¼•ä¸­çš„è®°å½•å°†å°±åœ°æ›´æ–°ï¼Œå…¶éšè—çš„ç³»ç»Ÿåˆ—æŒ‡å‘æ’¤æ¶ˆæ—¥å¿—æ¡ç›®ï¼Œå¯ä»¥ä»ä¸­é‡å»ºè®°å½•çš„æ—©æœŸç‰ˆæœ¬ã€‚</p><p>åœ¨èšç°‡ç´¢å¼•ä¸­ï¼ŒDB_TRX_IDæ£€æŸ¥è®°å½•çš„è®°å½•ï¼Œå¦‚æœåœ¨å¯åŠ¨è¯»å–äº‹åŠ¡åä¿®æ”¹äº†è®°å½•ï¼Œåˆ™ä»æ’¤æ¶ˆæ—¥å¿—ä¸­æ£€ç´¢è®°å½•çš„æ­£ç¡®ç‰ˆæœ¬ã€‚</p><ul><li>äºŒçº§ç´¢å¼•</li></ul><p>äºŒçº§ç´¢å¼•è®°å½•ä¸åŒ…å«éšè—çš„ç³»ç»Ÿåˆ—ï¼Œä¹Ÿä¸ä¼šå°±åœ°æ›´æ–°ã€‚</p><p>æ›´æ–°äºŒçº§ç´¢å¼•åˆ—æ—¶ï¼Œå°†å¯¹æ—§çš„äºŒçº§ç´¢å¼•è®°å½•è¿›è¡Œåˆ é™¤æ ‡è®°ï¼Œå°†æ–°è®°å½•æ’å…¥ï¼Œå¹¶æœ€ç»ˆæ¸…é™¤å¸¦æœ‰åˆ é™¤æ ‡è®°çš„è®°å½•ã€‚å½“äºŒçº§ç´¢å¼•è®°å½•è¢«åˆ é™¤æ ‡è®°æˆ–äºŒçº§ç´¢å¼•é¡µè¢«è¾ƒæ–°çš„äº‹åŠ¡æ›´æ–°æ—¶ï¼ŒInnoDBåœ¨èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾æ•°æ®åº“è®°å½•ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬ç¯‡è®²è§£äº†ç´¢å¼•çš„åŸºæœ¬æ•°æ®ç»“æ„ä¸åˆ†ç±»ï¼Œå’ŒINNODBæ¨¡å‹å’Œåº•å±‚å®ç°åŸºæœ¬åŸç†ï¼ŒåæœŸä¼šæ›´åŠ è¯¦ç»†çš„ä»‹ç»INNODBç´¢å¼•çš„å…·ä½“å®ç°è¿‡ç¨‹ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://blog.csdn.net/qq_26222859/article/details/80631121" target="_blank" rel="noopener">B+æ ‘å›¾æ–‡è¯¦è§£</a></p><p><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-index-types.html" target="_blank" rel="noopener">INNODBç´¢å¼•-å®˜æ–¹æ–‡æ¡£</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
            <tag> ç´¢å¼• </tag>
            
            <tag> INNODB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥æµ…å‡ºDockeråŸç†åŠå®æˆ˜(å››)â€”â€”æ„å»ºé•œåƒ</title>
      <link href="/2020/06/29/docker/docker-idea-4/"/>
      <url>/2020/06/29/docker/docker-idea-4/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><p>æ·±å…¥æµ…å‡ºDockeråŸç†åŠå®æˆ˜ç³»åˆ—ç¬¬å››ç¯‡ï¼Œæˆ‘ä¸»è¦åˆ†äº«åˆ¶ä½œé•œåƒçš„ä¸¤ç§æ–¹æ³•ä»¥åŠå¦‚ä½•é«˜æ•ˆæ„å»ºé•œåƒçš„æ³¨æ„ç‚¹ï¼Œæœ€åå±•ç¤ºä¸€ä¸ªæ„å»ºé¡¹ç›®çº§é•œåƒçš„å®è·µè¿‡ç¨‹</p><h1 id="åˆ›å»ºé•œåƒçš„æ–¹å¼"><a href="#åˆ›å»ºé•œåƒçš„æ–¹å¼" class="headerlink" title="åˆ›å»ºé•œåƒçš„æ–¹å¼"></a>åˆ›å»ºé•œåƒçš„æ–¹å¼</h1><p>åˆ›å»ºä¸€ä¸ªæŒ‡å®šçš„é•œåƒæœ‰ä¸¤ç§æ–¹å¼</p><ul><li>åŸºäºä¸€ä¸ªç°æœ‰çš„é•œåƒæ¥ä¿®æ”¹  docker commit </li><li>åŸºäºDockerfileæ¥åˆ›å»º      docker build </li></ul><h1 id="åŸºäºä¸€ä¸ªç°æœ‰çš„é•œåƒæ¥ä¿®æ”¹"><a href="#åŸºäºä¸€ä¸ªç°æœ‰çš„é•œåƒæ¥ä¿®æ”¹" class="headerlink" title="åŸºäºä¸€ä¸ªç°æœ‰çš„é•œåƒæ¥ä¿®æ”¹"></a>åŸºäºä¸€ä¸ªç°æœ‰çš„é•œåƒæ¥ä¿®æ”¹</h1><p>å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</span><br><span class="line"></span><br><span class="line">--author , -aä½œè€…ï¼ˆä¾‹å¦‚â€œ rugod.cn â€ï¼‰</span><br><span class="line">--change , -cå°†Dockerfileåˆ›å»ºçš„é•œåƒè¿›è¡Œæ›´æ–°</span><br><span class="line">--message , -mæäº¤è®¯æ¯</span><br><span class="line">--pause , -ptrueæäº¤æœŸé—´æš‚åœå®¹å™¨</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥ç†è§£æˆå¿«ç…§ï¼Œä¸è¿‡ä¸æ˜¯ä½ åœ¨å®¹å™¨é‡Œæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šå¿«ç…§ä¸Šï¼Œæ”¯æŒæ›´æ”¹å‘½ä»¤æœ‰ CMD| ENTRYPOINT| ENV| EXPOSE| LABEL| ONBUILD| USER| VOLUME|WORKDIR</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line"></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS              NAMES</span><br><span class="line">c3f279d17e0a        ubuntu:12.04        &#x2F;bin&#x2F;bash           7 days ago          Up 25 hours                            desperate_dubinsky</span><br><span class="line">197387f1b436        ubuntu:12.04        &#x2F;bin&#x2F;bash           7 days ago          Up 25 hours                            focused_hamilton</span><br><span class="line"></span><br><span class="line">$ docker commit --change&#x3D;&#39;CMD [&quot;apachectl&quot;, &quot;-DFOREGROUND&quot;]&#39; -c &quot;EXPOSE 80&quot; c3f279d17e0a  svendowideit&#x2F;testimage:version4</span><br><span class="line"></span><br><span class="line">f5283438590d</span><br><span class="line"></span><br><span class="line">$ docker run -d svendowideit&#x2F;testimage:version4</span><br><span class="line"></span><br><span class="line">89373736e2e7f00bc149bd783073ac43d0507da250e999f3f1036e0db60817c0</span><br><span class="line"></span><br><span class="line">$ docker ps</span><br><span class="line"></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                 CREATED             STATUS              PORTS              NAMES</span><br><span class="line">89373736e2e7        testimage:version4  &quot;apachectl -DFOREGROU&quot;  3 seconds ago       Up 2 seconds        80&#x2F;tcp             distracted_fermat</span><br><span class="line">c3f279d17e0a        ubuntu:12.04        &#x2F;bin&#x2F;bash               7 days ago          Up 25 hours                            desperate_dubinsky</span><br><span class="line">197387f1b436        ubuntu:12.04        &#x2F;bin&#x2F;bash               7 days ago          Up 25 hours</span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼šä¸€èˆ¬æ¥è¯´è¿™ç§ä¿®æ”¹çš„æ–¹å¼é•œåƒéƒ½æ˜¯ç”¨äºæµ‹è¯•æ„å»ºï¼Œä¸é€‚åˆç”Ÿäº§ç¯å¢ƒçš„æ„å»ºã€‚</p><p>æ³¨æ„ï¼ï¼ï¼æäº¤æ“ä½œå°†ä¸åŒ…å«å®¹å™¨å†…æŒ‚è½½å·ä¸­çš„ä»»ä½•æ•°æ®ã€‚</p><h1 id="åŸºäºDockerfileæ¥åˆ›å»º"><a href="#åŸºäºDockerfileæ¥åˆ›å»º" class="headerlink" title="åŸºäºDockerfileæ¥åˆ›å»º"></a>åŸºäºDockerfileæ¥åˆ›å»º</h1><p>å¸¸è§„æ¥è®²ï¼Œé•œåƒéƒ½æ˜¯éœ€è¦æœ‰ä¸€ä¸ªdockerfileæ¥æ„å»ºçš„ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨åˆ¶ä½œå‰éœ€è¦ç†è§£ä¸€ä¸‹åº•å±‚çš„æ„å»ºåŸç†ï¼Œè¿™å¾ˆé‡è¦</p><h2 id="åº•å±‚æ„å»ºåŸç†"><a href="#åº•å±‚æ„å»ºåŸç†" class="headerlink" title="åº•å±‚æ„å»ºåŸç†"></a>åº•å±‚æ„å»ºåŸç†</h2><p>å…ˆå›é¡¾ä¸€ä¸‹Dockerçš„æ¶æ„=Dockerå®¢æˆ·ç«¯(CLI)+DockeræœåŠ¡ç«¯(dockerçš„å®ˆæŠ¤è¿›ç¨‹)ã€‚</p><p>Docker å®¢æˆ·ç«¯é€šè¿‡ REST API å’ŒæœåŠ¡ç«¯è¿›è¡Œäº¤äº’ï¼Œdocker å®¢æˆ·ç«¯æ¯å‘é€ä¸€æ¡æŒ‡ä»¤ï¼Œåº•å±‚éƒ½ä¼šè½¬åŒ–æˆ REST API è°ƒç”¨çš„å½¢å¼å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å¤„ç†å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚å¹¶ç»™å‡ºå“åº”ã€‚</p><p>Docker é•œåƒçš„æ„å»ºã€å®¹å™¨åˆ›å»ºã€å®¹å™¨è¿è¡Œç­‰å·¥ä½œéƒ½æ˜¯ Docker æœåŠ¡ç«¯æ¥å®Œæˆçš„ï¼ŒDocker å®¢æˆ·ç«¯åªæ˜¯æ‰¿æ‹…å‘é€æŒ‡ä»¤çš„è§’è‰²ã€‚</p><p>æ‰€ä»¥æ„å»ºä¸€ä¸ªé•œåƒæ˜¯ç”±Dockerå®ˆæŠ¤ç¨‹åº(Dockerçš„æœåŠ¡ç«¯)è€Œä¸æ˜¯CLIè¿è¡Œçš„ã€‚æ„å»ºè¿‡ç¨‹è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å°†æ•´ä¸ªä¸Šä¸‹æ–‡ï¼ˆé€’å½’ï¼‰å‘é€åˆ°å®ˆæŠ¤ç¨‹åºã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæœ€å¥½ä»¥ç©ºç›®å½•ä½œä¸ºä¸Šä¸‹æ–‡ï¼Œå¹¶å°†Dockerfileä¿ç•™åœ¨è¯¥ç›®å½•ä¸­ã€‚ä»…æ·»åŠ æ„å»ºDockerfileæ‰€éœ€çš„æ–‡ä»¶ã€‚</p><p>æ— è®ºDockerfileå®é™…ä½äºä½•å¤„ï¼Œå½“å‰ç›®å½•ä¸­æ–‡ä»¶å’Œç›®å½•çš„æ‰€æœ‰é€’å½’å†…å®¹éƒ½å°†ä½œä¸ºæ„å»ºä¸Šä¸‹æ–‡å‘é€åˆ°Dockerå®ˆæŠ¤ç¨‹åºã€‚</p><p>docker build æ„å»ºé•œåƒçš„æµç¨‹å¤§æ¦‚å¦‚ä¸‹ï¼š</p><ul><li>æ‰§è¡Œ docker build -t <a href="imageName:imageTag">imageName:imageTag</a> . ;</li><li>Docker å®¢æˆ·ç«¯ä¼šå°†æ„å»ºå‘½ä»¤åé¢æŒ‡å®šçš„è·¯å¾„(.)ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ª tar åŒ…ï¼Œå‘é€ç»™ Docker æœåŠ¡ç«¯;</li><li>Docker æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„ tar åŒ…ï¼Œç„¶åè§£å‹ï¼Œæ ¹æ® Dockerfile é‡Œé¢çš„æŒ‡ä»¤è¿›è¡Œé•œåƒçš„åˆ†å±‚æ„å»ºï¼›</li></ul><h2 id="ä¸Šä¸‹æ–‡"><a href="#ä¸Šä¸‹æ–‡" class="headerlink" title="ä¸Šä¸‹æ–‡"></a>ä¸Šä¸‹æ–‡</h2><p>è¿™é‡Œå¥½å¥½ç†è§£ä¸€ä¸‹ä¸Šä¸‹æ–‡çš„æ„æ€ï¼Œå®˜æ–¹ç»™å‡ºä¸Šä¸‹æ–‡çš„è§£é‡Šï¼šä½äºæŒ‡å®šä½ç½®PATHæˆ–URLçš„æ–‡ä»¶é›†ã€‚</p><p>contextç¿»è¯‘ä¸ºè¯­å¢ƒï¼Œå‰åå…³ç³»</p><p>ä»€ä¹ˆæ„æ€å‘¢ï¼ŒDocker æ„å»ºä¸Šä¸‹æ–‡å°±æ˜¯ Docker å®¢æˆ·ç«¯ä¸Šä¼ ç»™æœåŠ¡ç«¯çš„ tar æ–‡ä»¶è§£å‹åçš„å†…å®¹ï¼Œä¹Ÿå³ docker build å‘½ä»¤è¡Œåé¢æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ã€‚</p><p>Docker é•œåƒçš„æ„å»ºæ˜¯åœ¨è¿œç¨‹æœåŠ¡ç«¯è¿›è¡Œçš„ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯éœ€è¦æŠŠæ„å»ºæ‰€éœ€è¦çš„æ–‡ä»¶ä¼ è¾“ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯ä»¥å®¢æˆ·ç«¯å‘é€çš„æ–‡ä»¶ä¸ºä¸Šä¸‹æ–‡ï¼Œä¹Ÿå°±æ˜¯è¯´ Dockerfile ä¸­æŒ‡ä»¤çš„å·¥ä½œç›®å½•å°±æ˜¯æœåŠ¡ç«¯è§£å‹å®¢æˆ·ç«¯ä¼ è¾“çš„ tar åŒ…çš„è·¯å¾„ã€‚</p><p>ä¸Šä¸‹æ–‡ç‰¹åˆ«å…³é”®ï¼Œå› ä¸ºåœ¨æ„å»ºçš„æ—¶å€™æ„å»ºæ–‡ä»¶ä¸­ä¹Ÿæ˜¯åº”ç”¨çš„æ˜¯ä¸Šä¸‹æ–‡çš„ç›¸å¯¹è·¯å¾„ï¼Œç®€å•æ¥è¯´<br>COPY å’Œ ADD å‘½ä»¤ä¸èƒ½æ‹·è´ä¸Šä¸‹æ–‡ä¹‹å¤–çš„æœ¬åœ°æ–‡ä»¶</p><p>æ¯”å¦‚ä½ çš„ç›®å½•ç»“æ„æ˜¯è¿™æ ·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ test</span><br><span class="line">â”‚Â Â  â””â”€â”€ Dockerfile</span><br><span class="line">â””â”€â”€ test.conf</span><br><span class="line"></span><br><span class="line">ä½ å¦‚æœåœ¨æ„å»ºçš„æ—¶å€™åœ¨~&#x2F;test&#x2F;ç›®å½•ä¸‹æ‰§è¡Œçš„docker build . åˆ™Dockerfileé‡Œä¸èƒ½copyæˆ–add ä¸Šä¸€çº§ç›®å½•çš„test.conf</span><br><span class="line"></span><br><span class="line">å³ä½¿ä½ å¯ä»¥åœ¨~&#x2F;ç›®å½•ä¸‹æ‰§è¡Œdocker build -f test&#x2F;Dockerfile .</span><br><span class="line">ä½†ä¹Ÿä¸è¦è¿™ä¹ˆåšï¼Œä¿æŒæ‰€æœ‰æ–‡ä»¶åœ¨å½“å‰docker build çš„æ‰§è¡Œç›®å½•ä¸‹æ˜¯ä¸€ä»¶è‰¯å¥½ä¹Ÿæœ‰å¾ˆå¿…è¦çš„ä¹ æƒ¯ã€‚</span><br></pre></td></tr></table></figure><hr><p>æ³¨æ„ï¼ï¼ï¼<br>è¯·å‹¿å°†rootç›®å½•æˆ–/ç›®å½•ç”¨ä½œPATHï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´æ„å»ºå°†ç¡¬ç›˜é©±åŠ¨å™¨çš„å…¨éƒ¨å†…å®¹ä¼ è¾“åˆ°Dockerå®ˆæŠ¤ç¨‹åºã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build [OPTIONS] PATH | URL | -</span><br></pre></td></tr></table></figure><p>docker buildå‘½ä»¤ä»Dockerfileå’Œä¸Šä¸‹æ–‡æ„å»ºé•œåƒã€‚ PATHæ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ç›®å½•ã€‚è¯¥URLæ˜¯ä¸€ä¸ªGitå­˜å‚¨åº“ä½ç½®ã€‚ä¸Šä¸‹æ–‡æ˜¯é€’å½’å¤„ç†çš„ï¼Œå› æ­¤ï¼ŒPATHåŒ…æ‹¬ä»»ä½•å­ç›®å½•ï¼Œè€ŒURLåŒ…æ‹¬å­˜å‚¨åº“åŠå…¶å­æ¨¡å—ã€‚</p><h2 id="æœ¬åœ°ç›®å½•"><a href="#æœ¬åœ°ç›®å½•" class="headerlink" title="æœ¬åœ°ç›®å½•"></a>æœ¬åœ°ç›®å½•</h2><p>æœ€ç®€å•çš„ä¸€ä¸ªä½¿ç”¨å½“å‰ç›®å½•ä½œä¸ºä¸Šä¸‹æ–‡çš„æ„å»ºå‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build .</span><br><span class="line"></span><br><span class="line">Sending build context to Docker daemon  6.51 MB</span><br></pre></td></tr></table></figure><h2 id="gitä»“åº“"><a href="#gitä»“åº“" class="headerlink" title="gitä»“åº“"></a>gitä»“åº“</h2><p>å½“URLå‚æ•°æŒ‡å‘Gitå­˜å‚¨åº“çš„ä½ç½®æ—¶ï¼Œè¯¥å­˜å‚¨åº“å°†ä½œä¸ºæ„å»ºä¸Šä¸‹æ–‡ã€‚ç³»ç»Ÿä»¥é€’å½’æ–¹å¼è·å–å­˜å‚¨åº“åŠå…¶å­æ¨¡å—ã€‚æäº¤å†å²è®°å½•æœªä¿ç•™ã€‚é¦–å…ˆå°†å­˜å‚¨åº“æ‹‰åˆ°æœ¬åœ°ä¸»æœºä¸Šçš„ä¸´æ—¶ç›®å½•ä¸­ã€‚æˆåŠŸä¹‹åï¼Œè¯¥ç›®å½•å°†ä½œä¸ºä¸Šä¸‹æ–‡å‘é€åˆ°Dockerå®ˆæŠ¤ç¨‹åºã€‚æœ¬åœ°å‰¯æœ¬ä½¿æ‚¨èƒ½å¤Ÿä½¿ç”¨æœ¬åœ°ç”¨æˆ·å‡­æ®ï¼ŒVPNç­‰è®¿é—®ç§æœ‰å­˜å‚¨åº“ã€‚</p><p>Git URLåœ¨å…¶ç‰‡æ®µéƒ¨åˆ†æ¥å—ä¸Šä¸‹æ–‡é…ç½®ï¼Œå¹¶ç”¨å†’å·ï¼ˆ:ï¼‰åˆ†éš”ã€‚ç¬¬ä¸€éƒ¨åˆ†ä»£è¡¨Gitå°†æ£€å‡ºçš„å¼•ç”¨ï¼Œå¯ä»¥æ˜¯åˆ†æ”¯ï¼Œæ ‡ç­¾æˆ–è¿œç¨‹å¼•ç”¨ã€‚ç¬¬äºŒéƒ¨åˆ†è¡¨ç¤ºå­˜å‚¨åº“ä¸­çš„å­ç›®å½•ï¼Œè¯¥å­ç›®å½•å°†ç”¨ä½œæ„å»ºä¸Šä¸‹æ–‡ã€‚</p><p>ä¾‹å¦‚ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥ä½¿ç”¨dockeråˆ†æ”¯ä¸­ ç§°ä¸ºçš„ç›®å½•containerï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build https:&#x2F;&#x2F;github.com&#x2F;docker&#x2F;rootfs.git#container:docker</span><br></pre></td></tr></table></figure><h2 id="taråŒ…"><a href="#taråŒ…" class="headerlink" title="taråŒ…"></a>taråŒ…</h2><p>å¦‚æœå°†URLä¼ é€’åˆ°è¿œç¨‹taråŒ…ï¼Œåˆ™URLæœ¬èº«å°†å‘é€åˆ°å®ˆæŠ¤ç¨‹åºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build http:&#x2F;&#x2F;server&#x2F;context.tar.gz</span><br></pre></td></tr></table></figure><p>ä¸‹è½½æ“ä½œå°†åœ¨è¿è¡ŒDockerå®ˆæŠ¤ç¨‹åºçš„ä¸»æœºä¸Šæ‰§è¡Œï¼Œè¯¥ä¸»æœºä¸ä¸€å®šä¸å‘å‡ºbuildå‘½ä»¤çš„ä¸»æœºç›¸åŒã€‚Dockerå®ˆæŠ¤ç¨‹åºå°†è·å–context.tar.gzå¹¶å°†å…¶ç”¨ä½œæ„å»ºä¸Šä¸‹æ–‡ã€‚TaråŒ…ä¸Šä¸‹æ–‡å¿…é¡»æ˜¯ç¬¦åˆæ ‡å‡†tar UNIXæ ¼å¼çš„tarå­˜æ¡£ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨â€œxzâ€ï¼Œâ€œbzip2â€ï¼Œâ€œgzipâ€æˆ–â€œidentityâ€ï¼ˆæ— å‹ç¼©ï¼‰æ ¼å¼ä¸­çš„ä»»ä½•ä¸€ç§è¿›è¡Œå‹ç¼©ã€‚</p><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p>æœ€å¸¸ç”¨çš„2ä¸ªå‚æ•°</p><p>-t æ‰“tag å°†åšå¥½çš„é•œåƒæ ‡è®°å­˜å‚¨åº“åç§°åŠç‰ˆæœ¬å·</p><p>-f æŒ‡å®šdockerfileçš„è·¯å¾„</p><p>â€“no-cache  æ„å»ºæ˜ åƒæ—¶ä¸è¦ä½¿ç”¨ç¼“å­˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -f ctx&#x2F;Dockerfile http:&#x2F;&#x2F;server&#x2F;ctx.tar.gz</span><br><span class="line"></span><br><span class="line">Downloading context: http:&#x2F;&#x2F;server&#x2F;ctx.tar.gz [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;]    240 B&#x2F;240 B</span><br><span class="line">Step 1&#x2F;3 : FROM busybox</span><br><span class="line"> ---&gt; 8c2e06607696</span><br><span class="line">Step 2&#x2F;3 : ADD ctx&#x2F;container.cfg &#x2F;</span><br><span class="line"> ---&gt; e7829950cee3</span><br><span class="line">Removing intermediate container b35224abf821</span><br><span class="line">Step 3&#x2F;3 : CMD &#x2F;bin&#x2F;ls</span><br><span class="line"> ---&gt; Running in fbc63d321d73</span><br><span class="line"> ---&gt; 3286931702ad</span><br><span class="line">Removing intermediate container fbc63d321d73</span><br><span class="line">Successfully built 377c409b35e4</span><br></pre></td></tr></table></figure><p>è¿™ä¼šå°†URLå‘é€<a href="http://server/ctx.tar.gzåˆ°Dockerå®ˆæŠ¤ç¨‹åºï¼Œè¯¥å®ˆæŠ¤ç¨‹åºä¸‹è½½å¹¶æå–å¼•ç”¨çš„taråŒ…ã€‚" target="_blank" rel="noopener">http://server/ctx.tar.gzåˆ°Dockerå®ˆæŠ¤ç¨‹åºï¼Œè¯¥å®ˆæŠ¤ç¨‹åºä¸‹è½½å¹¶æå–å¼•ç”¨çš„taråŒ…ã€‚</a></p><p>-f ctx/Dockerfile å‚æ•°æŒ‡å®šå†…éƒ¨çš„è·¯å¾„ctx.tar.gzçš„Dockerfileï¼Œç”¨äºæ„å»ºå›¾åƒã€‚å…¶ä¸­çš„ä»»ä½•å¼•ç”¨æœ¬åœ°è·¯å¾„çš„ADDå‘½ä»¤éƒ½Dockerfileå¿…é¡»ç›¸å¯¹äºå…¶ä¸­å†…å®¹çš„æ ¹ctx.tar.gzã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå‹ç¼©åŒ…åŒ…å«ä¸€ä¸ªç›®å½•ctx/ï¼Œå› æ­¤è¯¥ADD ctx/container.cfg /æ“ä½œå¯ä»¥æŒ‰é¢„æœŸè¿›è¡Œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t vieux&#x2F;apache:2.0 .</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å½“å‰ç›®å½•Dockerfileä½œä¸ºä¸Šä¸‹æ–‡çš„æ„å»ºï¼Œå¹¶å°†æ„å»ºæˆåŠŸçš„é•œåƒæ‰“tagä¸ºvieux/apache:2.0</p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>åœ¨Dockerå®ˆæŠ¤ç¨‹åºè¿è¡ŒDockerfileä¸­çš„æŒ‡ä»¤ä¹‹å‰ï¼Œå®ƒä¼šå¯¹è¿›è¡Œåˆæ­¥éªŒè¯ï¼ŒDockerfileå¦‚æœè¯­æ³•ä¸æ­£ç¡®ï¼Œåˆ™è¿”å›é”™è¯¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t test&#x2F;myapp .</span><br><span class="line"></span><br><span class="line">Sending build context to Docker daemon 2.048 kB</span><br><span class="line">Error response from daemon: Unknown instruction: RUNCMD</span><br></pre></td></tr></table></figure><p>Dockerå®ˆæŠ¤ç¨‹åºä»¥Dockerfileä¸€å¯¹ä¸€çš„æ–¹å¼è¿è¡ŒæŒ‡ä»¤ï¼Œå¦‚æœ‰å¿…è¦ï¼Œå°†æ¯ä¸ªæŒ‡ä»¤çš„ç»“æœæäº¤åˆ°æ–°æ˜ åƒï¼Œç„¶åæœ€ç»ˆè¾“å‡ºæ–°æ˜ åƒçš„IDã€‚Dockerå®ˆæŠ¤ç¨‹åºå°†è‡ªåŠ¨æ¸…ç†æ‚¨å‘é€çš„ä¸Šä¸‹æ–‡ã€‚</p><p>è¯·æ³¨æ„ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œå¹¶ä¼šå¯¼è‡´åˆ›å»ºæ–°æ˜ åƒ-å› æ­¤RUN cd /tmpå¯¹ä¸‹ä¸€æ¡æŒ‡ä»¤ä¸ä¼šæœ‰ä»»ä½•å½±å“ã€‚</p><h1 id="å¦‚ä½•é«˜æ•ˆåœ°æ„å»ºä¸€ä¸ªé•œåƒ"><a href="#å¦‚ä½•é«˜æ•ˆåœ°æ„å»ºä¸€ä¸ªé•œåƒ" class="headerlink" title="å¦‚ä½•é«˜æ•ˆåœ°æ„å»ºä¸€ä¸ªé•œåƒ"></a>å¦‚ä½•é«˜æ•ˆåœ°æ„å»ºä¸€ä¸ªé•œåƒ</h1><h2 id="ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºæ–¹æ³•"><a href="#ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºæ–¹æ³•" class="headerlink" title="ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºæ–¹æ³•"></a>ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºæ–¹æ³•</h2><p>å¤šé˜¶æ®µæ„å»ºæœ‰ç‚¹åƒè™šæ‹Ÿæœºæ¨¡æ¿å†…å‘³ï¼Œå°±æ˜¯éœ€è¦å‡ ä¸ªåŸºç¡€é•œåƒï¼Œæ¯•ç«Ÿè½¯ä»¶åº•å±‚éƒ½æ˜¯ç”±ä¸€ä¸ªä¸€ä¸ªçš„åŸºç¡€ç»„æˆçš„ï¼Œå°±åƒæˆ‘ä»¬çš„windowã€centosã€ubantuç­‰ç­‰ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåŸºç¡€Docker imageï¼ŒåŒ…å«ä¸€ç±»å·¥ç¨‹çš„åŸºç¡€è¿è¡Œç¯å¢ƒï¼ˆjavaç±»é•œåƒä½ éœ€è¦è£…jdkï¼‰ï¼Œè£…å®Œç³»ç»Ÿåçš„åŠ å·¥åˆ™äº¤ç»™æˆ‘ä»¬çš„ä¸Šä¸€å±‚Dockerfileæ¥å®Œæˆã€‚</p><p>ä¸ºä»€ä¹ˆè¿™æ ·å…¶å®ç”¨ä¸­å›½ä¸€å¥è€è¯æ¥è¯´é€šä¿—æ˜“æ‡‚ï¼Œé¿å…ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚å‡å¦‚ä½ çš„Aé¡¹ç›®éœ€è¦ä¸€ä¸ªjdk1.7çš„ç¯å¢ƒ ä½ çš„Bé¡¹ç›®éœ€è¦ä¸€ä¸ªjdk1.8çš„ç¯å¢ƒï¼Œä½ åªéœ€è¦åšä¸€ä¸ªcentos/ubantuçš„é•œåƒå¹¶ä¸”èƒ½ä¿è¯ç¨³å®šï¼Œåœ¨æ­¤åŸºç¡€ä¸Šbuild 2ä¸ªä¸åŒçš„ç‰ˆæœ¬java:1.7 java:1.8å³å¯è®©ä¸é€šçš„é¡¹ç›®è¿è¡Œåœ¨ä¸é€šçš„é•œåƒä¸Šï¼Œè€Œä½ åˆ™åªç”¨ä¸“æ³¨java:1.7å’Œjava:1.8çš„Dockerfileå³å¯ã€‚</p><p>å¯¹äºDockerfileæ¥è¯´ï¼Œæœ€å¥½å°†å‘½ä»¤ä»æ›´æ”¹é¢‘ç‡è¾ƒä½ï¼ˆä»¥ç¡®ä¿æ„å»ºç¼“å­˜å¯é‡ç”¨ï¼‰åˆ°æ›´æ”¹é¢‘ç‡è¾ƒé«˜çš„é¡ºåºæ¥å¸ƒå±€æ•´ä¸ªé•œåƒå±‚çº§ï¼š</p><ul><li>åº•å±‚  å®‰è£…æ„å»ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„å·¥å…·   </li><li>ä¸­å±‚  å®‰è£…æˆ–æ›´æ–°åº“ä¾èµ–å…³ç³»</li><li>é¡¶å±‚  å®‰è£…åº”ç”¨ç¨‹åº</li></ul><p>Goåº”ç”¨ç¨‹åºçš„Dockerfileå¯èƒ½ç±»ä¼¼äºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">FROM golang:1.11-alpine AS build</span><br><span class="line"></span><br><span class="line"># Install tools required for project</span><br><span class="line"># Run &#96;docker build --no-cache .&#96; to update dependencies</span><br><span class="line">RUN apk add --no-cache git</span><br><span class="line">RUN go get github.com&#x2F;golang&#x2F;dep&#x2F;cmd&#x2F;dep</span><br><span class="line"></span><br><span class="line"># List project dependencies with Gopkg.toml and Gopkg.lock</span><br><span class="line"># These layers are only re-built when Gopkg files are updated</span><br><span class="line">COPY Gopkg.lock Gopkg.toml &#x2F;go&#x2F;src&#x2F;project&#x2F;</span><br><span class="line">WORKDIR &#x2F;go&#x2F;src&#x2F;project&#x2F;</span><br><span class="line"># Install library dependencies</span><br><span class="line">RUN dep ensure -vendor-only</span><br><span class="line"></span><br><span class="line"># Copy the entire project and build it</span><br><span class="line"># This layer is rebuilt when a file changes in the project directory</span><br><span class="line">COPY . &#x2F;go&#x2F;src&#x2F;project&#x2F;</span><br><span class="line">RUN go build -o &#x2F;bin&#x2F;project</span><br><span class="line"></span><br><span class="line"># This results in a single layer image</span><br><span class="line">FROM scratch</span><br><span class="line">COPY --from&#x3D;build &#x2F;bin&#x2F;project &#x2F;bin&#x2F;project</span><br><span class="line">ENTRYPOINT [&quot;&#x2F;bin&#x2F;project&quot;]</span><br><span class="line">CMD [&quot;--help&quot;]</span><br></pre></td></tr></table></figure><h2 id="ä¸è¦å®‰è£…ä¸å¿…è¦çš„è½¯ä»¶åŒ…"><a href="#ä¸è¦å®‰è£…ä¸å¿…è¦çš„è½¯ä»¶åŒ…" class="headerlink" title="ä¸è¦å®‰è£…ä¸å¿…è¦çš„è½¯ä»¶åŒ…"></a>ä¸è¦å®‰è£…ä¸å¿…è¦çš„è½¯ä»¶åŒ…</h2><p>ä¸ºäº†é™ä½å¤æ‚æ€§ï¼Œä¾èµ–æ€§ï¼Œæ–‡ä»¶å¤§å°å’Œæ„å»ºæ—¶é—´ï¼Œè¯·é¿å…å³ä¾¿å®ƒä»¬â€œå¾ˆå®¹æ˜“å®‰è£…â€è€Œå®‰è£…å¤šä½™æˆ–ä¸å¿…è¦çš„è½¯ä»¶åŒ…ã€‚</p><p>æ¯”å¦‚ä¸éœ€è¦åœ¨æ•°æ®åº“é•œåƒä¸­å®‰è£…æ–‡æœ¬ç¼–è¾‘å™¨(vim)ã€‚</p><h2 id="è§£è€¦åº”ç”¨"><a href="#è§£è€¦åº”ç”¨" class="headerlink" title="è§£è€¦åº”ç”¨"></a>è§£è€¦åº”ç”¨</h2><p>å³æ¯ä¸ªå®¹å™¨åº”è¯¥åšå¥½è‡ªå·±çš„ï¼Œå°†åº”ç”¨ç¨‹åºè§£è€¦åˆ°å¤šä¸ªå®¹å™¨ä¸­ï¼Œå¯ä»¥æ›´è½»æ¾åœ°æ°´å¹³ç¼©æ”¾å’Œé‡å¤ä½¿ç”¨å®¹å™¨ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªWebåº”ç”¨ç¨‹åºå¯èƒ½ç”±ä¸‰ä¸ªå•ç‹¬çš„å®¹å™¨ç»„æˆï¼Œæ¯ä¸ªå®¹å™¨éƒ½æœ‰è‡ªå·±çš„å”¯ä¸€é•œåƒï¼Œä»¥åˆ†ç¦»çš„æ–¹å¼ç®¡ç†Webåº”ç”¨ç¨‹åºï¼Œæ•°æ®åº“å’Œå†…å­˜ä¸­çš„ç¼“å­˜ã€‚</p><p>å°½é‡ä¸è¦å°†æ‰€æœ‰é¡¹ç›®çš„è¿è¡Œç¯å¢ƒèåˆåœ¨ä¸€ä¸ªé•œåƒé‡Œã€‚æ ¹æ®æ‚¨çš„æœ€ä½³åˆ¤æ–­ï¼Œä½¿å®¹å™¨ä¿æŒæ¸…æ´å’Œæ¨¡å—åŒ–ã€‚å¦‚æœå®¹å™¨ç›¸äº’ä¾èµ–ï¼Œåˆ™å¯ä»¥ä½¿ç”¨Dockerå®¹å™¨ç½‘ç»œæ¥ç¡®ä¿è¿™äº›å®¹å™¨å¯ä»¥é€šä¿¡ã€‚</p><h2 id="æœ€å°åŒ–å±‚æ•°"><a href="#æœ€å°åŒ–å±‚æ•°" class="headerlink" title="æœ€å°åŒ–å±‚æ•°"></a>æœ€å°åŒ–å±‚æ•°</h2><p>åªæœ‰æŒ‡ä»¤RUNï¼ŒCOPYï¼ŒADDä¼šåˆ›å»ºå±‚ã€‚å…¶ä»–æŒ‡ä»¤åªä¼šåˆ›å»ºä¸´æ—¶çš„ä¸­é—´é•œåƒï¼Œå¹¶ä¸”ä¸ä¼šå¢åŠ æ„å»ºçš„å¤§å°ã€‚</p><p>å°½å¯èƒ½ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºï¼Œå¹¶ä¸”ä»…å°†æ‰€éœ€çš„å·¥ä»¶å¤åˆ¶åˆ°æœ€ç»ˆæ˜ åƒä¸­ã€‚è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥åœ¨ä¸­é—´æ„å»ºé˜¶æ®µä¸­åŒ…å«å·¥å…·å’Œè°ƒè¯•ä¿¡æ¯ï¼Œè€Œæ— éœ€å¢åŠ æœ€ç»ˆæ˜ åƒçš„å¤§å°ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªjavaåº”ç”¨æœ€é¡¶å±‚çš„é•œåƒåº”è¯¥åªå­˜åœ¨jaråŒ…ï¼Œè€Œä¸ç”¨å…³æ³¨ä»»ä½•å¯åŠ¨çš„ç¯å¢ƒå‡†å¤‡ç­‰ã€‚</p><h2 id="åˆ©ç”¨ç¼“å­˜æ„å»ºé•œåƒ-é‡ä¸­ä¹‹é‡"><a href="#åˆ©ç”¨ç¼“å­˜æ„å»ºé•œåƒ-é‡ä¸­ä¹‹é‡" class="headerlink" title="åˆ©ç”¨ç¼“å­˜æ„å»ºé•œåƒ(é‡ä¸­ä¹‹é‡)"></a>åˆ©ç”¨ç¼“å­˜æ„å»ºé•œåƒ(é‡ä¸­ä¹‹é‡)</h2><p>æ„å»ºé•œåƒæ—¶ï¼ŒDockerä¼šé€æ­¥æ‰§è¡ŒDockerfileä¸­çš„æŒ‡ä»¤ã€‚åœ¨æ£€æŸ¥æ¯æ¡æŒ‡ä»¤æ—¶ï¼ŒDockerä¼šåœ¨å…¶ç¼“å­˜ä¸­æŸ¥æ‰¾å¯é‡ç”¨çš„ç°æœ‰é•œåƒï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°çš„ï¼ˆé‡å¤çš„ï¼‰é•œåƒã€‚</p><p>åˆ©ç”¨æ„å»ºç¼“å­˜ä¹Ÿæ˜¯ä¸Šé¢æåˆ°4ç§é«˜æ•ˆæ„å»ºçš„æ ¸å¿ƒåŸå› ï¼šä½¿ç”¨å¤šé˜¶æ®µæ„å»ºæ–¹æ³•ã€ä¸è¦å®‰è£…ä¸å¿…è¦çš„è½¯ä»¶åŒ…ã€è§£è€¦åº”ç”¨ã€æœ€å°åŒ–å±‚æ•°ã€‚æ­£æ˜¯ç”±äºè¿™äº›é«˜æ•ˆæ„å»ºçš„æ–¹æ³•ï¼Œæ‰ä½¿å¾—åˆ©ç”¨æ„å»ºç¼“å­˜éæŸ¥æœ‰å¿…è¦ã€‚</p><p>åˆ©ç”¨ç¼“å­˜æ„å»ºçš„å¥½å¤„åŒ…æ‹¬ï¼š</p><ul><li>ç¼©çŸ­æ„å»ºã€æ‹‰å–ã€æ¨é€é•œåƒçš„æ—¶é—´</li><li>åŸºäºä¸€ä¸ªåŸºç¡€é•œåƒè¿›è¡Œåˆ†ç±»æ‰©å±•</li><li>èŠ‚çœç£ç›˜èµ„æºåŠå®¹å™¨è¿è¡Œæ—¶çš„å¤§å°ã€‚</li></ul><p>Dockeréµå¾ªçš„åŸºæœ¬è§„åˆ™æ¦‚è¿°å¦‚ä¸‹ï¼š</p><ul><li>ä»å·²åœ¨ç¼“å­˜ä¸­çš„åŸºç¡€é•œåƒå¼€å§‹ï¼Œå°†ä¸‹ä¸€æ¡æŒ‡ä»¤ä¸ä»è¯¥åŸºæœ¬é•œåƒæ´¾ç”Ÿçš„æ‰€æœ‰å­é•œåƒè¿›è¡Œæ¯”è¾ƒï¼Œä»¥æŸ¥çœ‹æ˜¯å¦å…¶ä¸­ä¸€ä¸ªæ˜¯ä½¿ç”¨å®Œå…¨ç›¸åŒçš„æŒ‡ä»¤æ„å»ºçš„ã€‚å¦‚æœä¸æ˜¯ï¼Œæ— æ³•ä½¿ç”¨ç¼“å­˜ã€‚</li><li>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåªéœ€å°†ä¸­çš„æŒ‡ä»¤Dockerfileä¸åŸºç¡€é•œåƒä¹‹ä¸€è¿›è¡Œæ¯”è¾ƒå°±è¶³å¤Ÿäº†ã€‚ä½†æ˜¯ï¼ŒæŸäº›è¯´æ˜éœ€è¦æ›´å¤šçš„æ£€æŸ¥å’Œè§£é‡Šã€‚</li><li>å¯¹äºADDå’ŒCOPYæŒ‡ä»¤ï¼Œå°†æ£€æŸ¥é•œåƒä¸­æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶ä¸ºæ¯ä¸ªæ–‡ä»¶è®¡ç®—ä¸€ä¸ªæ ¡éªŒå’Œã€‚è¿™äº›æ ¡éªŒå’Œä¸­ä¸è€ƒè™‘æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´å’Œæœ€åè®¿é—®æ—¶é—´ã€‚åœ¨é«˜é€Ÿç¼“å­˜æŸ¥æ‰¾æœŸé—´ï¼Œå°†æ ¡éªŒå’Œä¸ç°æœ‰é•œåƒä¸­çš„æ ¡éªŒå’Œè¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ–‡ä»¶ä¸­çš„ä»»ä½•å†…å®¹ï¼ˆä¾‹å¦‚å†…å®¹å’Œå…ƒæ•°æ®ï¼‰å‘ç”Ÿäº†æ›´æ”¹ï¼Œåˆ™æ— æ³•ä½¿ç”¨ç¼“å­˜</li><li>é™¤äº†ADDå’ŒCOPYå‘½ä»¤ä¹‹å¤–ï¼Œç¼“å­˜æ£€æŸ¥ä¸ä¼šæŸ¥çœ‹å®¹å™¨ä¸­çš„æ–‡ä»¶æ¥ç¡®å®šç¼“å­˜æ˜¯å¦åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤„ç†RUN apt-get -y updateå‘½ä»¤æ—¶ï¼Œä¸æ£€æŸ¥å®¹å™¨ä¸­æ›´æ–°çš„æ–‡ä»¶ä»¥ç¡®å®šæ˜¯å¦å­˜åœ¨ç¼“å­˜å‘½ä¸­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»…ä½¿ç”¨å‘½ä»¤å­—ç¬¦ä¸²æœ¬èº«æ¥æŸ¥æ‰¾åŒ¹é…é¡¹ã€‚</li></ul><p>å¦‚æœå‘ç°ç¼“å­˜æ— æ•ˆçš„æƒ…å†µï¼Œåˆ™æ‰€æœ‰åç»­Dockerfileå‘½ä»¤éƒ½ä¼šç”Ÿæˆæ–°é•œåƒï¼Œå¹¶ä¸”ä¸ä½¿ç”¨ç¼“å­˜ã€‚</p><h1 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h1><p>å…¶å®å…³äºæ„å»ºé•œåƒï¼Œæœ€å…·æŒ‘æˆ˜æ€§çš„äº‹æƒ…ä¹‹ä¸€æ˜¯ä¿æŒå›¾åƒå°ºå¯¸å˜å°ã€‚Dockerfileä¸­çš„æ¯æ¡æŒ‡ä»¤éƒ½åœ¨æ˜ åƒä¸Šæ·»åŠ äº†ä¸€å±‚ï¼Œæ‚¨éœ€è¦è®°ä½åœ¨ç§»è‡³ä¸‹ä¸€å±‚ä¹‹å‰æ¸…é™¤ä¸éœ€è¦çš„ä»»ä½•ç»„ä»¶ã€‚è¦ç¼–å†™ä¸€ä¸ªçœŸæ­£æœ‰æ•ˆçš„Dockerfileï¼Œä¼ ç»Ÿä¸Šï¼Œæ‚¨éœ€è¦ä½¿ç”¨ShellæŠ€å·§å’Œå…¶ä»–é€»è¾‘æ¥ä½¿å„å±‚å°½å¯èƒ½å°ï¼Œå¹¶ç¡®ä¿æ¯ä¸€å±‚éƒ½å…·æœ‰ä¸Šä¸€å±‚æ‰€éœ€çš„å·¥ä»¶ï¼Œè€Œæ²¡æœ‰å…¶ä»–ä»»ä½•ä¸œè¥¿ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨æ‰§è¡ŒRUNå®‰è£…åŸºç¡€ç»„ä»¶çš„æ—¶å€™å°½é‡å¸¦ä¸Š &amp;&amp;è¿ç®—ç¬¦å°†å¤šä¸ªå‘½ä»¤å‹ç¼©åœ¨ä¸€èµ·ï¼Œä»¥é¿å…åœ¨é•œåƒä¸­åˆ›å»ºé¢å¤–å±‚ã€‚</p><h2 id="åŸºç¡€é•œåƒ"><a href="#åŸºç¡€é•œåƒ" class="headerlink" title="åŸºç¡€é•œåƒ"></a>åŸºç¡€é•œåƒ</h2><p>å¯ä»¥è¿›å…¥dockerhubä¸Šçœ‹åˆ°ä¸€ä¸ªjdk8ç¯å¢ƒçš„Dockerfile</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:xenial</span><br><span class="line">MAINTAINER ASCDC &lt;asdc.sinica@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">RUN mkdir &#x2F;script</span><br><span class="line">ADD run.sh &#x2F;script&#x2F;run.sh</span><br><span class="line"></span><br><span class="line">RUN DEBIAN_FRONTEND&#x3D;noninteractive &amp;&amp; \</span><br><span class="line">chmod +x &#x2F;script&#x2F;*.sh &amp;&amp; \</span><br><span class="line">apt-get -qq update &amp;&amp; \</span><br><span class="line">apt-get -y -qq dist-upgrade &amp;&amp; \</span><br><span class="line">apt-get -qq install -y locales &amp;&amp; \</span><br><span class="line">locale-gen en_US.UTF-8 &amp;&amp; \</span><br><span class="line">export LANG&#x3D;en_US.UTF-8</span><br><span class="line">RUN DEBIAN_FRONTEND&#x3D;noninteractive &amp;&amp; apt-get -qq install -y vim screen wget git curl openjdk-8-jdk</span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME &#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-8-openjdk-amd64</span><br><span class="line"></span><br><span class="line">WORKDIR &#x2F;script</span><br><span class="line">ENTRYPOINT [&quot;&#x2F;script&#x2F;run.sh&quot;]</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œè¿™åªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„é¡¹ç›®éœ€æ±‚è°ƒæ•´Dockerfileçš„å†…å®¹ï¼Œæ¯”å¦‚æ—¶åŒº TZ=Asia/Shanghai  å¦‚æœä½ ä¸éœ€è¦wget ã€git ã€curlç­‰ï¼Œä¹Ÿå¯ä»¥ä¸å®‰è£…ã€‚</p><h2 id="é¡¹ç›®é•œåƒ"><a href="#é¡¹ç›®é•œåƒ" class="headerlink" title="é¡¹ç›®é•œåƒ"></a>é¡¹ç›®é•œåƒ</h2><p>å°†è¿™ä¸ªé•œåƒä¸‹è½½åˆ°æœ¬åœ°ä¿®æ”¹æˆ–è€…ç›´æ¥é‡å†™jdk8çš„Dockerfileéƒ½æ˜¯ä¸é”™é€‰æ‹©ï¼ŒåŸºç¡€é•œåƒåˆ¶ä½œå®Œæˆåï¼Œå°±éœ€è¦åˆ¶ä½œé¡¹ç›®é•œåƒäº†ã€‚</p><p>é¡¹ç›®çš„é•œåƒä¸€èˆ¬æ¥è¯´æ˜¯ä¸€ä¸ªç»å¸¸å˜åŠ¨çš„(jaråŒ…åœ¨ä¸æ–­æ›´æ–°è¿­ä»£)ï¼Œåœ¨åŸºäºåŸºç¡€é•œåƒçš„ä¹‹ä¸Šè¿™æ ·å†åˆ¶ä½œä¸€ä¸ªé¡¹ç›®çš„Dockerfileå°±å®¹æ˜“å¾ˆå¤šäº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">æœ¬åœ°ç›®å½•</span><br><span class="line">[root@localhost ~]# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ xxx.jar</span><br><span class="line">â”œâ”€â”€ Dockerfile</span><br><span class="line">â””â”€â”€ run.sh</span><br><span class="line"></span><br><span class="line">Dockerfileå†…å®¹å¦‚ä¸‹ï¼Œå°†jaråŒ…å’Œå¯åŠ¨è„šæœ¬æ”¾åˆ°é•œåƒé‡Œ</span><br><span class="line"></span><br><span class="line">FROM jdk:1.8</span><br><span class="line">ADD xxx.jar &#x2F;</span><br><span class="line">COPY .&#x2F;run.sh &#x2F;run.sh</span><br><span class="line">RUN chmod u+x &#x2F;run.sh</span><br><span class="line">CMD [ &quot;&#x2F;run.sh&quot; ]</span><br><span class="line"></span><br><span class="line">run.shå†…å®¹å¦‚ä¸‹ å¯åŠ¨å‘½ä»¤åŠè°ƒä¼˜å‚æ•°</span><br><span class="line"></span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">java -server -Xmx4000m -Xms4000m -Xmn2000m -Xss512k -XX:+DisableExplicitGC \</span><br><span class="line">     -XX:+UseConcMarkSweepGC -XX:+CMSParallelRemarkEnabled \</span><br><span class="line">     -XX:LargePageSizeInBytes&#x3D;128m -XX:+UseFastAccessorMethods \</span><br><span class="line">     -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction&#x3D;70 \</span><br><span class="line">     -jar &#x2F;xxx.jar</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">åˆ¶ä½œé•œåƒå‘½ä»¤ï¼Œåœ¨~ç›®å½•æ‰§è¡Œ</span><br><span class="line">docker build -t rugod.cn:1.0 .</span><br></pre></td></tr></table></figure><p>2ä¸ªåˆ¶ä½œé•œåƒè¿‡ç¨‹ç§ç»å¸¸ç”¨åˆ°çš„å‘½ä»¤</p><p>docker history images:tag æŸ¥çœ‹æŸä¸ªæŒ‡å®šç‰ˆæœ¬é•œåƒçš„æ„å»ºè¯­å¥</p><p>docker search images:tag åœ¨Docker Hubä¸­æœç´¢å›¾åƒ</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å¦‚ä½•é«˜æ•ˆåˆ¶ä½œé•œåƒçš„è¿‡ç¨‹å°±åŸºæœ¬ä¸Šè®²å®Œäº†ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ï¼Œè°¢è°¢ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://qhh.me/2019/02/17/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-Docker-%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87/" target="_blank" rel="noopener">æ·±å…¥ç†è§£-Docker-æ„å»ºä¸Šä¸‹æ–‡</a></p><p><a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/" target="_blank" rel="noopener">ç¼–å†™Dockerfileçš„æœ€ä½³å®è·µ</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dockerfile </tag>
            
            <tag> Linux </tag>
            
            <tag> Devops </tag>
            
            <tag> Docker </tag>
            
            <tag> å®¹å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webhooksè‡ªåŠ¨éƒ¨ç½²åšå®¢</title>
      <link href="/2020/06/28/devops/devops-webhooks/"/>
      <url>/2020/06/28/devops/devops-webhooks/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>618æ´»åŠ¨ç™½å«–é˜¿é‡Œäº‘æœåŠ¡å™¨1c2g 40gç£ç›˜ 1Må¸¦å®½ï¼Œæäº†ä¸ªåŸŸåå¤‡æ¡ˆåå‡†å¤‡åœ¨æœåŠ¡å™¨ä¸Šæ­å»ºåšå®¢ï¼Œå…³äºè‡ªåŠ¨éƒ¨ç½²è¿™æ–¹é¢çœ‹äº†ç½‘ä¸Šçš„å‡ ä¸ªå¸–å­ï¼Œå‡†å¤‡ç”¨webhooksè¿™ç§æ–¹å¼å®ç°è‡ªåŠ¨éƒ¨ç½²</p><h1 id="Webhook"><a href="#Webhook" class="headerlink" title="Webhook"></a>Webhook</h1><p>ä½ å¯ä»¥é€šè¿‡å®šåˆ¶ Webhook æ¥ç›‘æµ‹ä½ åœ¨ Github.com ä¸Šçš„å„ç§äº‹ä»¶ï¼Œæœ€å¸¸è§çš„è«è¿‡äº push äº‹ä»¶ã€‚å¦‚æœä½ è®¾ç½®äº†ä¸€ä¸ªç›‘æµ‹ push äº‹ä»¶çš„ Webhookï¼Œé‚£ä¹ˆæ¯å½“ä½ çš„è¿™ä¸ªé¡¹ç›®æœ‰äº†ä»»ä½•æäº¤ï¼Œè¿™ä¸ª Webhook éƒ½ä¼šè¢«è§¦å‘ï¼Œè¿™æ—¶ Github å°±ä¼šå‘é€ä¸€ä¸ª HTTP POST è¯·æ±‚åˆ°ä½ é…ç½®å¥½çš„åœ°å€ã€‚</p><h1 id="éƒ¨ç½²webhooks"><a href="#éƒ¨ç½²webhooks" class="headerlink" title="éƒ¨ç½²webhooks"></a>éƒ¨ç½²webhooks</h1><h2 id="åœ¨æœåŠ¡å™¨ä¸Šä¸‹è½½webhooks"><a href="#åœ¨æœåŠ¡å™¨ä¸Šä¸‹è½½webhooks" class="headerlink" title="åœ¨æœåŠ¡å™¨ä¸Šä¸‹è½½webhooks"></a>åœ¨æœåŠ¡å™¨ä¸Šä¸‹è½½webhooks</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;opt&#x2F;</span><br><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;adnanh&#x2F;webhook&#x2F;releases&#x2F;download&#x2F;2.6.11&#x2F;webhook-linux-amd64.tar.gz</span><br><span class="line">tar -zvxf webhook-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºwebhookså·¥ä½œç›®å½•-åˆ†é¡¹ç›®"><a href="#åˆ›å»ºwebhookså·¥ä½œç›®å½•-åˆ†é¡¹ç›®" class="headerlink" title="åˆ›å»ºwebhookså·¥ä½œç›®å½•(åˆ†é¡¹ç›®)"></a>åˆ›å»ºwebhookså·¥ä½œç›®å½•(åˆ†é¡¹ç›®)</h2><p>ä»¥æˆ‘çš„é¡¹ç›®ä¸ºä¾‹å­ï¼Œåˆ›å»ºä¸€ä¸ªå·¥ä½œç›®å½•åï¼Œéœ€è¦å†™ä¸€ä¸ªè„šæœ¬å’Œä¸€ä¸ªjsonæ–‡ä»¶</p><p>deploy.sh ç›®çš„æ˜¯ æ¥æ”¶äº†webhooksæ¶ˆæ¯æ‰§è¡Œçš„å‘½ä»¤<br>hooks.json ç›®çš„æ˜¯ç¡®è®¤id(åæ–‡æœ‰ç”¨)ã€æ‰§è¡Œçš„è„šæœ¬ã€æ‰§è¡Œè„šæœ¬çš„å·¥ä½œç›®å½•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#x2F;opt&#x2F;rugod.cn</span><br><span class="line"></span><br><span class="line">vim deploy.sh</span><br><span class="line"></span><br><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line">git fetch --all &amp;&amp; git pull   https:&#x2F;&#x2F;github.com&#x2F;chenyu1st&#x2F;chenyu1st.github.io.git </span><br><span class="line"></span><br><span class="line">vim hooks.json</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;id&quot;: &quot;rugod.cn-blog&quot;,</span><br><span class="line">    &quot;execute-command&quot;: &quot;&#x2F;opt&#x2F;rugod.cn&#x2F;deploy.sh&quot;,</span><br><span class="line">    &quot;command-working-directory&quot;: &quot;&#x2F;chenyu&#x2F;chenyu1st.github.io.git&quot;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨webhook"><a href="#å¯åŠ¨webhook" class="headerlink" title="å¯åŠ¨webhook"></a>å¯åŠ¨webhook</h2><p>åœ¨webhookså·¥ä½œç›®å½•æµ‹è¯•webhook</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">webhook -hooks hooks.json -verbose</span><br><span class="line">[webhook] 2020&#x2F;06&#x2F;28 00:21:59 version 2.6.11 starting</span><br><span class="line">[webhook] 2020&#x2F;06&#x2F;28 00:21:59 setting up os signal watcher</span><br><span class="line">[webhook] 2020&#x2F;06&#x2F;28 00:21:59 attempting to load hooks from hooks.json</span><br><span class="line">[webhook] 2020&#x2F;06&#x2F;28 00:21:59 found 1 hook(s) in file</span><br><span class="line">[webhook] 2020&#x2F;06&#x2F;28 00:21:59 loaded: rugod.cn-blog</span><br><span class="line">[webhook] 2020&#x2F;06&#x2F;28 00:21:59 serving hooks on http:&#x2F;&#x2F;0.0.0.0:9000&#x2F;hooks&#x2F;&#123;id&#125;</span><br></pre></td></tr></table></figure><p>å¸¦ç€å®é™…çš„<a href="http://0.0.0.0:9000/hooks/{id}" target="_blank" rel="noopener">http://0.0.0.0:9000/hooks/{id}</a> å¡«åˆ°GitHub ç½‘ç«™å¯¹åº”é¡¹ç›®é¡µé¢ Settings â†’ Webhooks ä¸­å³å¯</p><p>ç‚¹å‡» Redeliver å¯ä»¥é‡æ–°æµ‹è¯•</p><p>åå°æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup webhook -hooks hooks.json -verbose &amp;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™åšå®¢æœ‰æ›´æ–°å³å‘é€httpè¯·æ±‚åˆ°æœåŠ¡å™¨çš„ç›‘å¬ä½ç½®ï¼Œè§¦å‘pullä»£ç çš„æ“ä½œ</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://developer.github.com/webhooks/" target="_blank" rel="noopener">webhooks</a></p><p><a href="https://blog.cugxuan.cn/2019/03/23/Git/Use-Webhook-To-Update-Blog/" target="_blank" rel="noopener">ä½¿ç”¨ webhook è‡ªåŠ¨æ›´æ–°åšå®¢</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è·Ÿæˆ‘å­¦Devops </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Devops </tag>
            
            <tag> è‡ªåŠ¨åŒ– </tag>
            
            <tag> CI/CD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥æµ…å‡ºDockeråŸç†åŠå®æˆ˜(ä¸‰)â€”â€”åˆ¶ä½œDockerfile</title>
      <link href="/2020/06/27/docker/docker-idea-3/"/>
      <url>/2020/06/27/docker/docker-idea-3/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><p>æ·±å…¥æµ…å‡ºDockeråŸç†åŠå®æˆ˜ç³»åˆ—ç¬¬ä¸‰ç¯‡ï¼Œæˆ‘ä¸»è¦åˆ†äº«å¦‚ä½•åˆ¶ä½œä¸€ä¸ªDockerfileï¼Œä»¥åŠåŸºæœ¬å‘½ä»¤æ ¼å¼ã€‚</p><h1 id="Dockerfileç®€ä»‹"><a href="#Dockerfileç®€ä»‹" class="headerlink" title="Dockerfileç®€ä»‹"></a>Dockerfileç®€ä»‹</h1><p>Dockerå¯ä»¥é€šè¿‡é˜…è¯»Dockerfileçš„æŒ‡ä»¤æ¥è‡ªåŠ¨æ„å»ºé•œåƒã€‚ Dockerfileæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šè°ƒç”¨ç»„è£…é•œåƒçš„æ‰€æœ‰å‘½ä»¤ã€‚ä½¿ç”¨docker buildå‘½ä»¤å¯ä»¥åˆ›å»ºè‡ªåŠ¨æ„å»ºæµç¨‹ï¼Œè¯¥æ„å»ºè¿ç»­æ‰§è¡Œå¤šä¸ªå‘½ä»¤è¡ŒæŒ‡ä»¤ã€‚</p><h1 id="åˆ¶ä½œDockfile"><a href="#åˆ¶ä½œDockfile" class="headerlink" title="åˆ¶ä½œDockfile"></a>åˆ¶ä½œDockfile</h1><p>Dockeré•œåƒç”±åªè¯»å±‚ç»„æˆï¼Œæ¯ä¸ªåªè¯»å±‚ä»£è¡¨ä¸€æ¡DockerfileæŒ‡ä»¤ã€‚è¿™äº›å±‚æ˜¯å †å çš„ï¼Œæ¯ä¸ªå±‚éƒ½æ˜¯ä¸Šä¸€å±‚çš„å˜åŒ–çš„å¢é‡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªDockerfileçš„å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:18.04</span><br><span class="line">COPY . &#x2F;app</span><br><span class="line">RUN make &#x2F;app</span><br><span class="line">CMD python &#x2F;app&#x2F;app.py</span><br></pre></td></tr></table></figure><p>æ¯æ¡æŒ‡ä»¤åˆ›å»ºä¸€å±‚ï¼š</p><ul><li>FROMï¼šåŸºäºubuntu:18.04çš„é•œåƒåˆ›å»ºä¸€ä¸ªåªè¯»å±‚ã€‚</li><li>COPYï¼šä»Dockerå®¢æˆ·ç«¯çš„å½“å‰ç›®å½•æ·»åŠ æ–‡ä»¶ã€‚</li><li>RUNï¼š ä½¿ç”¨makeæ„å»ºåº”ç”¨ç¨‹åº</li><li>CMDï¼š æŒ‡å®šåœ¨å®¹å™¨ä¸­è¿è¡Œä»€ä¹ˆå‘½ä»¤ã€‚</li></ul><p>è¿è¡Œé•œåƒå¹¶ç”Ÿæˆå®¹å™¨æ—¶ï¼Œå¯ä»¥åœ¨åŸºç¡€å±‚ä¹‹ä¸Šæ·»åŠ ä¸€ä¸ªæ–°çš„å¯å†™å±‚ï¼ˆâ€œå®¹å™¨å±‚â€ï¼‰ã€‚å¯¹è¿è¡Œä¸­çš„å®¹å™¨æ‰€åšçš„æ‰€æœ‰æ›´æ”¹ï¼ˆä¾‹å¦‚å†™å…¥æ–°æ–‡ä»¶ï¼Œä¿®æ”¹ç°æœ‰æ–‡ä»¶å’Œåˆ é™¤æ–‡ä»¶ï¼‰éƒ½å°†å†™å…¥å¯å†™å®¹å™¨å±‚ã€‚</p><h2 id="BuildKit"><a href="#BuildKit" class="headerlink" title="BuildKit"></a>BuildKit</h2><p>ä»ç‰ˆæœ¬18.09å¼€å§‹ï¼ŒDockeræ”¯æŒç”±moby / buildkit é¡¹ç›®æä¾›çš„ç”¨äºæ‰§è¡Œæ„å»ºçš„æ–°åç«¯ã€‚ä¸æ—§çš„å®ç°ç›¸æ¯”ï¼ŒBuildKitåç«¯æä¾›äº†è®¸å¤šå¥½å¤„ã€‚ä¾‹å¦‚ï¼ŒBuildKitå¯ä»¥ï¼š</p><ul><li>æ£€æµ‹å¹¶è·³è¿‡æ‰§è¡Œæœªä½¿ç”¨çš„æ„å»ºé˜¶æ®µ</li><li>å¹¶è¡Œæ„å»ºç‹¬ç«‹æ„å»ºé˜¶æ®µ</li><li>ä¸¤æ¬¡æ„å»ºä¹‹é—´ä»…å¢é‡ä¼ è¾“æ„å»ºä¸Šä¸‹æ–‡ä¸­çš„å·²æ›´æ”¹æ–‡ä»¶</li><li>åœ¨æ„å»ºä¸Šä¸‹æ–‡ä¸­æ£€æµ‹å¹¶è·³è¿‡æœªä½¿ç”¨çš„æ–‡ä»¶çš„ä¼ è¾“</li><li>ä½¿ç”¨å…·æœ‰è®¸å¤šæ–°åŠŸèƒ½çš„å¤–éƒ¨Dockerfileå®ç°</li><li>é¿å…ä¸å…¶ä»–APIäº§ç”Ÿå‰¯ä½œç”¨ï¼ˆä¸­é—´å›¾åƒå’Œå®¹å™¨ï¼‰</li><li>ä¼˜å…ˆè€ƒè™‘æ„å»ºç¼“å­˜ä»¥è¿›è¡Œè‡ªåŠ¨ä¿®å‰ª</li><li>è¦ä½¿ç”¨BuildKitåç«¯ï¼Œæ‚¨éœ€è¦DOCKER_BUILDKIT=1åœ¨CLIä¸Šè®¾ç½®ç¯å¢ƒå˜é‡ ï¼Œç„¶åå†è°ƒç”¨docker buildã€‚</li></ul><p>è¦äº†è§£åŸºäºBuildKitçš„æ„å»ºå¯ç”¨çš„å®éªŒæ€§Dockerfileè¯­æ³•ï¼Œ<a href="https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/experimental.md" target="_blank" rel="noopener">è¯·å‚é˜…BuildKitå­˜å‚¨åº“ä¸­çš„æ–‡æ¡£</a>ã€‚</p><p>æ³¨æ„ï¼ç›®å‰æˆ‘è¿˜æ²¡æœ‰å¤ªäº†è§£è¿™ä¸ªåŠŸèƒ½ï¼Œè€Œä¸”é¡¹ç›®ä¸­dockerfileéƒ½æ²¡æœ‰å¼•å…¥ï¼Œæ‰€ä»¥å¯¹äºè¯¥åŠŸèƒ½ä¸åšæ·±å…¥äº†è§£ã€‚</p><h2 id="Dockfileæ ¼å¼"><a href="#Dockfileæ ¼å¼" class="headerlink" title="Dockfileæ ¼å¼"></a>Dockfileæ ¼å¼</h2><p>æ–‡ä»¶çš„æŒ‡ä»¤ä¸åŒºåˆ†å¤§å°å†™ã€‚ä½†æ˜¯ï¼Œçº¦å®šæ˜¯å¤§å†™ï¼Œä»¥ä¾¿æ›´è½»æ¾åœ°å°†å®ƒä»¬ä¸å‚æ•°åŒºåˆ†å¼€ã€‚</p><p>DockeræŒ‰é¡ºåºåœ¨Dockerfileä¸­è¿è¡ŒæŒ‡ä»¤ï¼ŒDockerfileå¿…é¡»ä»¥â€œFROMâ€æŒ‡ä»¤å¼€å¤´ã€‚è¿™å¯èƒ½åœ¨è§£æå™¨æŒ‡ä»¤ï¼Œæ³¨é‡Šå’Œå…¨å±€èŒƒå›´çš„ARGä¹‹åã€‚</p><p>FROMæŒ‡ä»¤æŒ‡å®šè¦ä»ä¸Šä¸€å±‚é•œåƒä¸­æ„å»ºã€‚</p><p>FROMåªèƒ½å‰é¢æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªARGæŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤å£°æ˜Dockerfileä¸­FROMè¡Œä¸­ä½¿ç”¨çš„å‚æ•°</p><p>Dockerä¼šå°†ä»¥ï¼ƒå¼€å¤´çš„è¡Œè§†ä¸ºæ³¨é‡Šï¼Œé™¤éè¯¥è¡Œæ˜¯æœ‰æ•ˆçš„è§£æå™¨æŒ‡ä»¤ã€‚</p><p>æ³¨é‡Šä¸­ä¸æ”¯æŒæ¢è¡Œç¬¦ã€‚</p><h2 id="DockerfileæŒ‡ä»¤"><a href="#DockerfileæŒ‡ä»¤" class="headerlink" title="DockerfileæŒ‡ä»¤"></a>DockerfileæŒ‡ä»¤</h2><p>åœ¨Dockerfileä¸­ï¼Œæ¯ä¸€æ¡è¯­å¥éƒ½æ˜¯ä¸€ä¸ªæŒ‡ä»¤ã€‚</p><p>Dockerfileæœ‰ä»¥ä¸‹æŒ‡ä»¤åˆ—è¡¨ï¼š</p><table><thead><tr><th>éƒ¨åˆ†</th><th>æŒ‡ä»¤</th></tr></thead><tbody><tr><td>åŸºç¡€é•œåƒä¿¡æ¯</td><td>FROM</td></tr><tr><td>é•œåƒæ“ä½œæŒ‡ä»¤</td><td>RUNã€COPYã€ADDã€EXPOSEã€WORKDIRã€VOLUMEç­‰</td></tr><tr><td>å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤</td><td>CMDã€ENTRYPOINT</td></tr></tbody></table><h3 id="è§£æå™¨æŒ‡ä»¤"><a href="#è§£æå™¨æŒ‡ä»¤" class="headerlink" title="è§£æå™¨æŒ‡ä»¤"></a>è§£æå™¨æŒ‡ä»¤</h3><p>è§£æå™¨æŒ‡ä»¤æ˜¯å¯é€‰çš„ï¼Œå¹¶ä¸”ä¼šå½±å“Dockerfileå¤„ç†åç»­è¡Œçš„æ–¹å¼ã€‚è§£æå™¨æŒ‡ä»¤ä¸ä¼šåœ¨æ„å»ºä¸­æ·»åŠ å›¾å±‚ï¼Œä¹Ÿä¸ä¼šæ˜¾ç¤ºä¸ºæ„å»ºæ­¥éª¤ã€‚è§£æå™¨æŒ‡ä»¤ä»¥å½¢å¼å†™ä¸ºç‰¹æ®Šç±»å‹çš„æ³¨é‡Š# directive=valueã€‚å•ä¸ªæŒ‡ä»¤åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚</p><p>æ”¯æŒä»¥ä¸‹è§£æå™¨æŒ‡ä»¤ï¼š</p><ul><li>syntax</li><li>escape</li></ul><p>syntaxä»…å½“ä½¿ç”¨BuildKitåç«¯æ—¶æ‰å¯ç”¨æ­¤åŠŸèƒ½ï¼Œæˆ‘è¿˜æ²¡æœ‰ç”¨BuildKitï¼Œæ‰€ä»¥åˆ°åœ¨æ­¤ä¸è®²ã€‚</p><p>escapeå†™æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># escape&#x3D;\</span><br></pre></td></tr></table></figure><p>è¯¥escapeæŒ‡ä»¤è®¾ç½®ç”¨æ¥é€ƒé¿çš„å­—ç¬¦çš„å­—ç¬¦ Dockerfileã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™é»˜è®¤è½¬ä¹‰å­—ç¬¦ä¸º\ã€‚</p><p>è½¬ä¹‰å­—ç¬¦ç”¨äºè½¬ä¹‰ä¸€è¡Œä¸­çš„å­—ç¬¦å’Œè½¬ä¹‰æ¢è¡Œç¬¦ã€‚è¿™å…è®¸ä¸€æ¡DockerfileæŒ‡ä»¤è·¨è¶Šå¤šè¡Œã€‚è¯·æ³¨æ„ï¼Œæ— è®ºescapeæ˜¯å¦åŒ…å«åœ¨Dockerfileï¼Œéƒ½ä¸ä¼šåœ¨RUNå‘½ä»¤ä¸­æ‰§è¡Œè½¬ä¹‰ï¼Œé™¤éåœ¨è¡Œæœ«ã€‚</p><p>å°†è½¬ä¹‰ç¬¦è®¾ç½®ä¸º`å¯¹Windowsä¸‹å°¤å…¶æœ‰ç”¨ ï¼Œå…¶ä¸­ç›®å½•è·¯å¾„åˆ†éš”ç¬¦ä¸º\ã€‚</p><p>ä¸€ä¸ªç®€å•çš„æ¼”ç¤º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœä¸åŠ escapeæŒ‡ä»¤</span><br><span class="line"></span><br><span class="line">FROM microsoft&#x2F;nanoserver</span><br><span class="line">COPY testfile.txt c:\\</span><br><span class="line">RUN dir c:\</span><br><span class="line"></span><br><span class="line">PS C:\John&gt; docker build -t cmd .</span><br><span class="line">Sending build context to Docker daemon 3.072 kB</span><br><span class="line">Step 1&#x2F;2 : FROM microsoft&#x2F;nanoserver</span><br><span class="line"> ---&gt; 22738ff49c6d</span><br><span class="line">Step 2&#x2F;2 : COPY testfile.txt c:\RUN dir c:</span><br><span class="line">GetFileAttributesEx c:RUN: The system cannot find the file specified.</span><br><span class="line">PS C:\John&gt;</span><br><span class="line"></span><br><span class="line">--------------------------------------------</span><br><span class="line">åŠ äº†escapeæŒ‡ä»¤å</span><br><span class="line"></span><br><span class="line"># escape&#x3D;&#96;</span><br><span class="line"></span><br><span class="line">FROM microsoft&#x2F;nanoserver</span><br><span class="line">COPY testfile.txt c:\</span><br><span class="line">RUN dir c:\</span><br><span class="line"></span><br><span class="line">PS C:\John&gt; docker build -t succeeds --no-cache&#x3D;true .</span><br><span class="line">Sending build context to Docker daemon 3.072 kB</span><br><span class="line">Step 1&#x2F;3 : FROM microsoft&#x2F;nanoserver</span><br><span class="line"> ---&gt; 22738ff49c6d</span><br><span class="line">Step 2&#x2F;3 : COPY testfile.txt c:\</span><br><span class="line"> ---&gt; 96655de338de</span><br><span class="line">Removing intermediate container 4db9acbb1682</span><br><span class="line">Step 3&#x2F;3 : RUN dir c:\</span><br><span class="line"> ---&gt; Running in a2c157f842f5</span><br><span class="line"> Volume in drive C has no label.</span><br><span class="line"> Volume Serial Number is 7E6D-E0F7</span><br><span class="line"></span><br><span class="line"> Directory of c:\</span><br><span class="line"></span><br><span class="line">10&#x2F;05&#x2F;2016  05:04 PM             1,894 License.txt</span><br><span class="line">10&#x2F;05&#x2F;2016  02:22 PM    &lt;DIR&gt;          Program Files</span><br><span class="line">10&#x2F;05&#x2F;2016  02:14 PM    &lt;DIR&gt;          Program Files (x86)</span><br><span class="line">10&#x2F;28&#x2F;2016  11:18 AM                62 testfile.txt</span><br><span class="line">10&#x2F;28&#x2F;2016  11:20 AM    &lt;DIR&gt;          Users</span><br><span class="line">10&#x2F;28&#x2F;2016  11:20 AM    &lt;DIR&gt;          Windows</span><br><span class="line">           2 File(s)          1,956 bytes</span><br><span class="line">           4 Dir(s)  21,259,096,064 bytes free</span><br><span class="line"> ---&gt; 01c7f3bef04f</span><br><span class="line">Removing intermediate container a2c157f842f5</span><br><span class="line">Successfully built 01c7f3bef04f</span><br><span class="line">PS C:\John&gt;</span><br></pre></td></tr></table></figure><h3 id="Environment-replacement"><a href="#Environment-replacement" class="headerlink" title="Environment replacement"></a>Environment replacement</h3><p>ç¯å¢ƒå˜é‡ï¼ˆä¸ENVçš„å£°æ˜ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨ç‰¹å®šæŒ‡ä»¤ä½œä¸ºå˜é‡ç”¨æ¥è¢«è§£é‡Š Dockerfileã€‚è½¬ä¹‰ä¹Ÿå¯ä»¥é€šè¿‡å°†ç±»å˜é‡çš„è¯­æ³•åŒ…æ‹¬åœ¨è¯­å¥ä¸­è€Œå¾—åˆ°å¤„ç†ã€‚</p><p>Dockerfileç”¨ $variable_nameæˆ–${variable_name}è¡¨ç¤ºç¯å¢ƒå˜é‡ã€‚å®ƒä»¬è¢«ç­‰æ•ˆåœ°å¯¹å¾…ï¼Œå¹¶ä¸”å¤§æ‹¬å·è¯­æ³•é€šå¸¸ç”¨äºè§£å†³å˜é‡åæ²¡æœ‰ç©ºæ ¼çš„é—®é¢˜ï¼Œä¾‹å¦‚${foo}_bar</p><p>è¯¥${variable_name}è¯­æ³•è¿˜æ”¯æŒä¸€äº›æ ‡å‡†bash ä¿®é¥°ç¬¦ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>${variable:-word}è¡¨ç¤ºå¦‚æœvariableè®¾ç½®ï¼Œåˆ™ç»“æœå°†æ˜¯è¯¥å€¼ã€‚å¦‚æœvariableæœªè®¾ç½®ï¼Œåˆ™ä¸ºwordç»“æœã€‚</li><li>${variable:+word}æŒ‡ç¤ºå¦‚æœvariableè®¾ç½®äº†ifï¼Œåˆ™å°†ä¸ºwordç»“æœï¼Œå¦åˆ™ç»“æœä¸ºç©ºå­—ç¬¦ä¸²ã€‚</li></ul><p>åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œwordéƒ½å¯ä»¥æ˜¯ä»»ä½•å­—ç¬¦ä¸²ï¼ŒåŒ…æ‹¬å…¶ä»–ç¯å¢ƒå˜é‡ã€‚</p><p>å¯é€šè¿‡åœ¨å˜é‡å‰æ·»åŠ \æ¥è¿›è¡Œè½¬ä¹‰ï¼šä¾‹å¦‚ï¼Œ$fooæˆ–${foo}å°†åˆ†åˆ«è½¬æ¢ä¸º$fooå’Œ${foo}æ–‡å­—ã€‚</p><p>ç¤ºä¾‹ï¼ˆè§£æçš„è¡¨ç¤ºå½¢å¼æ˜¾ç¤ºåœ¨ä¹‹å#ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM busybox</span><br><span class="line">ENV foo &#x2F;bar</span><br><span class="line">WORKDIR $&#123;foo&#125;   # WORKDIR &#x2F;bar</span><br><span class="line">ADD . $foo       # ADD . &#x2F;bar</span><br><span class="line">COPY \$foo &#x2F;quux # COPY $foo &#x2F;quux</span><br></pre></td></tr></table></figure><p>åœ¨ä¸€æ¡æŒ‡ä»¤ä¸­ï¼Œç¯å¢ƒå˜é‡æ›¿æ¢å°†å¯¹æ¯ä¸ªå˜é‡ä½¿ç”¨ç›¸åŒçš„å€¼ã€‚</p><p>ä¾‹å¦‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ENV abc&#x3D;hello</span><br><span class="line">ENV abc&#x3D;bye def&#x3D;$abc hjk&#x3D;$abc  #def&#x3D;hello  hjk&#x3D;hello</span><br><span class="line">ENV ghi&#x3D;$abc                   #ghi&#x3D;bye</span><br></pre></td></tr></table></figure><p>ä¾‹å­ä¸­defå€¼ä¸ºhelloï¼Œè€Œä¸æ˜¯byeã€‚ä½†æ˜¯ï¼Œ ghi=bye,å› ä¸ºå®ƒä¸æ˜¯è®¾ç½®abc=byeè¿™ä¸€æŒ‡ä»¤çš„ä¸€éƒ¨åˆ†ã€‚</p><h3 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h3><p>æ ¼å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM [--platform&#x3D;&lt;platform&gt;] &lt;image&gt; [AS &lt;name&gt;]</span><br><span class="line">FROM [--platform&#x3D;&lt;platform&gt;] &lt;image&gt;[:&lt;tag&gt;] [AS &lt;name&gt;]</span><br><span class="line">FROM [--platform&#x3D;&lt;platform&gt;] &lt;image&gt;[@&lt;digest&gt;] [AS &lt;name&gt;]</span><br></pre></td></tr></table></figure><p>FROMæŒ‡ä»¤åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„æ„å»ºé˜¶æ®µï¼Œå¹¶ä¸ºåç»­æŒ‡ä»¤è®¾ç½®åŸºæœ¬é•œåƒã€‚<br>å› æ­¤ï¼Œæœ‰æ•ˆçš„Dockerfileå¿…é¡»ä»¥FROMæŒ‡ä»¤å¼€å¤´ã€‚FROMçš„é•œåƒå¯ä»¥æ˜¯ä»»ä½•æœ¬åœ°å¯ä»¥è®¿é—®åˆ°ä»“åº“é‡Œçš„é•œåƒ-ä»å…¬å…±å­˜å‚¨åº“ï¼ˆdocker hubï¼‰ä¸­æ‹‰å‡ºé•œåƒç‰¹åˆ«å®¹æ˜“å¯åŠ¨ã€‚</p><p>å…¶ä¸­æ³¨æ„ä»¥ä¸‹5ç‚¹ï¼š</p><ul><li>ARGæ˜¯å…ˆäºFROMä¹‹å‰ã€‚</li><li>ä¸€ä¸ªDockerfileå¯ä»¥å‡ºç°å¤šæ¬¡FROMä»¥åˆ›å»ºå¤šä¸ªé•œåƒï¼Œä¹Ÿå¯ä»¥å°†ä¸€ä¸ªæ„å»ºé˜¶æ®µä½œä¸ºå¯¹å¦ä¸€ä¸ªæ„å»ºé˜¶æ®µçš„ä¾èµ–ã€‚åªéœ€åœ¨æ¯ä¸ªæ–°FROMæŒ‡ä»¤ä¹‹å‰è®°å½•ä¸€æ¬¡æäº¤è¾“å‡ºçš„æœ€åä¸€ä¸ªé•œåƒIDã€‚æ¯ä¸ªFROMæŒ‡ä»¤æ¸…é™¤ç”±å…ˆå‰æŒ‡ä»¤åˆ›å»ºçš„ä»»ä½•çŠ¶æ€ã€‚</li><li>é€šè¿‡å°†AS <name> æ·»åŠ åˆ°FROMæŒ‡ä»¤ä¸­ï¼Œå¯ä»¥é€‰æ‹©ä¸ºæ–°çš„æ„å»ºé˜¶æ®µæŒ‡å®šåç§°ã€‚è¯¥åç§°å¯ä»¥åœ¨åç»­ç‰ˆæœ¬FROMå’Œ COPY â€“from=&lt;name|index&gt;è¯´æ˜ä¸­ä½¿ç”¨ï¼Œä»¥å¼•ç”¨æ­¤é˜¶æ®µä¸­æ„å»ºçš„é•œåƒã€‚</li><li>è¯¥tagæˆ–digestå€¼æ˜¯å¯é€‰çš„ã€‚å¦‚æœä¸¤ä¸ªéƒ½ä¸é€‰æ‹©ï¼Œé‚£ä¹ˆç¼ºçœæƒ…å†µä¸‹æ„å»ºå™¨å°†é‡‡ç”¨latestæ ‡ç­¾ã€‚å¦‚æœæ„å»ºå™¨æ‰¾ä¸åˆ°è¯¥tagå€¼ï¼Œåˆ™è¿”å›é”™è¯¯ã€‚</li><li>â€“platformåœ¨FROMå¼•ç”¨å¤šå¹³å°é•œåƒçš„æƒ…å†µä¸‹ï¼Œå¯é€‰æ ‡å¿—å¯ç”¨äºæŒ‡å®šé•œåƒçš„å¹³å°ã€‚ä¾‹å¦‚ï¼Œlinux/amd64ï¼Œ linux/arm64ï¼Œæˆ–windows/amd64ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ„å»ºè¯·æ±‚çš„ç›®æ ‡å¹³å°ï¼ˆå³æœ¬æœºï¼‰ã€‚</li></ul><p>äº†è§£ARGå’ŒFROMä¹‹é—´çš„äº¤äº’æ–¹å¼</p><p>FROMæ”¯æŒç”±å‡ºç°åœ¨ç¬¬ä¸€ä¸ªFROMä¹‹å‰çš„ä»»ä½•ARGæŒ‡ä»¤å£°æ˜çš„å˜é‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ARG  CODE_VERSION&#x3D;latest</span><br><span class="line">FROM base:$&#123;CODE_VERSION&#125;   #base:latest</span><br><span class="line">CMD  &#x2F;code&#x2F;run-app</span><br><span class="line"></span><br><span class="line">FROM extras:$&#123;CODE_VERSION&#125; #base:latest</span><br><span class="line">CMD  &#x2F;code&#x2F;run-extras</span><br></pre></td></tr></table></figure><p>åœ¨FROMä¹‹å‰å£°æ˜çš„ARGåœ¨æ„å»ºé˜¶æ®µä¹‹å¤–ï¼Œå› æ­¤ä¸èƒ½åœ¨FROMä¹‹åçš„ä»»ä½•æŒ‡ä»¤ä¸­ä½¿ç”¨ARGçš„å˜é‡ï¼Œå¦‚æœè¦ä½¿ç”¨åœ¨ç¬¬ä¸€ä¸ªFROMä¹‹å‰å£°æ˜çš„ARGçš„å€¼ï¼Œè¯·ä½¿ç”¨ARGæŒ‡ä»¤å†æ¬¡å£°æ˜å˜é‡å³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ARG VERSION&#x3D;latest</span><br><span class="line">FROM busybox:$VERSION</span><br><span class="line">ARG VERSION</span><br><span class="line">RUN echo $VERSION &gt; image_version</span><br></pre></td></tr></table></figure><h3 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h3><p>RUNæœ‰2ç§å½¢å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RUN &lt;command&gt; (shellå½¢å¼,å‘½ä»¤åœ¨shellä¸­è¿è¡Œ,é»˜è®¤æƒ…å†µä¸‹åœ¨Linuxæ˜¯&#x2F;bin&#x2F;sh -c)</span><br><span class="line">RUN [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;] (æ‰§è¡Œåˆ—è¡¨)</span><br></pre></td></tr></table></figure><p>è¯¥RUNæŒ‡ä»¤å°†åœ¨å½“å‰é•œåƒä¸Šæ–¹çš„æ–°å±‚ä¸­æ‰§è¡Œä»»ä½•å‘½ä»¤ï¼Œå¹¶æäº¤ç»“æœã€‚ç”Ÿæˆçš„æäº¤é•œåƒå°†ç”¨äºä¸‹ä¸€æ­¥çš„Dockerfileã€‚</p><p>åˆ†å±‚RUNæŒ‡ä»¤å’Œç”Ÿæˆæäº¤ç¬¦åˆDockerçš„æ ¸å¿ƒæ¦‚å¿µï¼Œåœ¨è¿™äº›æ¦‚å¿µä¸Šï¼Œæäº¤å¾ˆæ–¹ä¾¿ï¼Œå¹¶ä¸”å¯ä»¥ä»æ˜ åƒå†å²è®°å½•çš„ä»»ä½•ä½ç½®åˆ›å»ºå®¹å™¨ï¼Œå°±åƒæºä»£ç æ§åˆ¶ä¸€æ ·ã€‚</p><p>execå½¢å¼å¯ä»¥é¿å…ç ´åshellå­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ä¸åŒ…å«æŒ‡å®šshellå¯æ‰§è¡Œæ–‡ä»¶çš„åŸºæœ¬æ˜ åƒè¿è¡ŒRUNå‘½ä»¤(ä¾‹å¦‚bash)ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">åœ¨shellå½¢å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨\å°†ä¸€æ¡RUNæŒ‡ä»¤ç»§ç»­åˆ°ä¸‹ä¸€è¡Œã€‚</span><br><span class="line">RUN &#x2F;bin&#x2F;bash -c &#39;source $HOME&#x2F;.bashrc; \</span><br><span class="line">echo $HOME&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å®ƒä»¬åˆåœ¨ä¸€èµ·ç›¸å½“äºä»¥ä¸‹ä¸€è¡Œï¼š</span><br><span class="line">RUN &#x2F;bin&#x2F;bash -c &#39;source $HOME&#x2F;.bashrc; echo $HOME&#39;</span><br><span class="line"></span><br><span class="line">è¦ä½¿ç”¨&#39;&#x2F; bin &#x2F; sh&#39;ä»¥å¤–çš„å…¶ä»–shellï¼Œè¯·ä½¿ç”¨execå½¢å¼ä¼ å…¥æ‰€éœ€çš„shellã€‚ä¾‹å¦‚ï¼š</span><br><span class="line"></span><br><span class="line">RUN [&quot;&#x2F;bin&#x2F;bash&quot;, &quot;-c&quot;, &quot;echo hello&quot;]</span><br></pre></td></tr></table></figure><hr><p>æ³¨æ„</p><p>execè¡¨å•è¢«è§£æä¸ºJSONæ•°ç»„ï¼Œè¿™æ„å‘³ç€å¿…é¡»åœ¨å•è¯å‘¨å›´ä½¿ç”¨åŒå¼•å·ï¼ˆâ€ï¼‰è€Œéå•å¼•å·ï¼ˆâ€™ï¼‰</p><p>RUNåœ¨ä¸€æ¬¡æ„å»ºæœŸé—´ï¼ŒæŒ‡ä»¤ç¼“å­˜ä¸ä¼šè‡ªåŠ¨å¤±æ•ˆã€‚æ¯”å¦‚ RUN yum install -y vim å°†åœ¨ä¸‹ä¸€ä¸ªæ„å»ºä¸­é‡ç”¨ã€‚RUNæŒ‡ä»¤çš„ç¼“å­˜å¯ä»¥é€šè¿‡ä½¿ç”¨â€“no-cache æ ‡å¿—æ¥ä½¿æ— æ•ˆ,ä¾‹å¦‚docker build â€“no-cacheã€‚è¿˜å¯ä»¥ç”±ADDå’ŒCOPYæŒ‡ä»¤æ¥ä½¿æ— æ•ˆã€‚</p><h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h3><p>CMDæœ‰ä¸‰ç§å½¢å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]ï¼ˆexecå½¢å¼ï¼Œè¿™æ˜¯é¦–é€‰å½¢å¼ï¼‰</span><br><span class="line">CMD [&quot;param1&quot;,&quot;param2&quot;]ï¼ˆä½œä¸ºENTRYPOINTçš„é»˜è®¤å‚æ•°ï¼‰</span><br><span class="line">CMD command ï¼ˆshellå½¢å¼ï¼‰</span><br></pre></td></tr></table></figure><p>CMDä¸»è¦ç›®çš„æ˜¯ä¸ºæ‰§è¡Œä¸­çš„å®¹å™¨æä¾›é»˜è®¤å€¼ã€‚è¿™äº›é»˜è®¤å€¼å¯ä»¥åŒ…å«ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å¿½ç•¥è¯¥å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨è¿˜å¿…é¡»æŒ‡å®šä¸€æ¡ENTRYPOINT æŒ‡ä»¤ã€‚</p><p>æ³¨æ„ï¼ï¼ï¼ä¸€ä¸ªDockerfileåªèƒ½ä¸€ä¸ªCMDæŒ‡ä»¤ã€‚å¦‚æœå‡ºç°å¤šä¸ªCMD åˆ™åªæœ‰æœ€åä¸€ä¸ªCMDæ‰ä¼šç”Ÿæ•ˆã€‚</p><p>ä¸shellå½¢å¼ä¸åŒï¼Œexecå½¢å¼ä¸ä¼šè°ƒç”¨å‘½ä»¤shellã€‚è¿™æ„å‘³ç€ä¸ä¼šè¿›è¡Œå¸¸è§„çš„shellå¤„ç†ã€‚ä¾‹å¦‚ï¼Œ CMD [ â€œechoâ€, â€œ$HOMEâ€ ]å°†ä¸ä¼šå¯¹è¿›è¡Œå˜é‡æ›¿æ¢$HOMEã€‚å¦‚æœè¦è¿›è¡Œshellå¤„ç†ï¼Œåˆ™å¯ä»¥ä½¿ç”¨shellå½¢å¼æˆ–ç›´æ¥æ‰§è¡Œshellï¼Œä¾‹å¦‚ï¼šCMD [ â€œshâ€, â€œ-câ€, â€œecho $HOMEâ€ ]</p><p>å¦‚æœCMDä½¿ç”¨çš„shellå½¢å¼ï¼Œåˆ™å°†åœ¨ä¸­<command>æ‰§è¡Œ /bin/sh -c</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu</span><br><span class="line">CMD echo &quot;This is a test.&quot; | wc -</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦åœ¨æ²¡æœ‰shellçš„æƒ…å†µä¸‹è¿è¡Œ <command> ï¼Œåˆ™å¿…é¡»å°†å‘½ä»¤è¡¨ç¤ºä¸ºJSONæ•°ç»„ï¼Œå¹¶æä¾›å¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚ æ­¤æ•°ç»„å½¢å¼æ˜¯çš„é¦–é€‰æ ¼å¼CMDã€‚ä»»ä½•å…¶ä»–å‚æ•°å¿…é¡»åœ¨æ•°ç»„ä¸­åˆ†åˆ«è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu</span><br><span class="line">CMD [&quot;&#x2F;usr&#x2F;bin&#x2F;wc&quot;,&quot;--help&quot;]</span><br></pre></td></tr></table></figure><p>å¦‚æœå¸Œæœ›å®¹å™¨æ¯æ¬¡éƒ½è¿è¡Œç›¸åŒçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåˆ™åº”è€ƒè™‘ENTRYPOINTä¸CMDç»“åˆä½¿ç”¨</p><p>å¦‚æœdocker runæŒ‡å®šäº†å‚æ•°ï¼Œåˆ™å®ƒä»¬å°†è¦†ç›–ä¸­æŒ‡å®šçš„CMDé»˜è®¤å‚æ•°ã€‚</p><p>æœ€åé‡ç”³ä¸€ç‚¹CMDå’ŒRUNçš„åŒºåˆ«ï¼šRUNå®é™…ä¸Šè¿è¡Œå‘½ä»¤å¹¶æäº¤ç»“æœï¼›CMDåœ¨æ„å»ºæ—¶ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œè€Œæ˜¯åœ¨é•œåƒå¯åŠ¨åæ‰§è¡Œå‘½ä»¤ã€‚</p><h3 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h3><p>æ ¼å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LABEL &lt;key&gt;&#x3D;&lt;value&gt; &lt;key&gt;&#x3D;&lt;value&gt; &lt;key&gt;&#x3D;&lt;value&gt; ...</span><br></pre></td></tr></table></figure><p>è¯¥LABELæŒ‡ä»¤å°†å…ƒæ•°æ®æ·»åŠ åˆ°é•œåƒã€‚ä¸€ä¸ªLABELæ˜¯é”®å€¼å¯¹ã€‚å¦‚æœè¦åœ¨LABELå€¼ä¸­åŒ…å«ç©ºæ ¼ï¼Œè¯·åƒåœ¨å‘½ä»¤è¡Œåˆ†æä¸­ä¸€æ ·ä½¿ç”¨å¼•å·å’Œåæ–œæ ã€‚</p><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LABEL &quot;com.example.vendor&quot;&#x3D;&quot;ACME Incorporated&quot;</span><br><span class="line">LABEL com.example.label-with-value&#x3D;&quot;foo&quot;</span><br><span class="line">LABEL version&#x3D;&quot;1.0&quot;</span><br><span class="line">LABEL description&#x3D;&quot;This text illustrates \</span><br><span class="line">that label-values can span multiple lines.&quot;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªé•œåƒå¯ä»¥æœ‰å¤šä¸ªæ ‡ç­¾ã€‚æ‚¨å¯ä»¥åœ¨ä¸€è¡Œä¸ŠæŒ‡å®šå¤šä¸ªæ ‡ç­¾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LABEL multi.label1&#x3D;&quot;value1&quot; multi.label2&#x3D;&quot;value2&quot; other&#x3D;&quot;value3&quot;</span><br><span class="line">LABEL multi.label1&#x3D;&quot;value1&quot; \</span><br><span class="line">      multi.label2&#x3D;&quot;value2&quot; \</span><br><span class="line">      other&#x3D;&quot;value3&quot;</span><br></pre></td></tr></table></figure><p>åŸºç¡€é•œåƒï¼ˆFROMä¸­çš„é•œåƒï¼‰ä¸­åŒ…å«çš„æ ‡ç­¾ä¼šè¢«åé¢çš„é•œåƒç»§æ‰¿ã€‚å¦‚æœæ ‡ç­¾å·²ç»å­˜åœ¨ä½†å…·æœ‰ä¸åŒçš„å€¼ï¼Œåˆ™æœ€è¿‘åº”ç”¨çš„å€¼å°†è¦†ç›–ä»»ä½•å…ˆå‰è®¾ç½®çš„å€¼ã€‚</p><p>è¦æŸ¥çœ‹é•œåƒçš„æ ‡ç­¾ï¼Œè¯·ä½¿ç”¨docker image inspectå‘½ä»¤ã€‚å¯ä»¥ä½¿ç”¨è¯¥â€“formaté€‰é¡¹ä»…æ˜¾ç¤ºæ ‡ç­¾ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker image inspect --format&#x3D;&#39;&#39; myimage</span><br><span class="line">&#123;</span><br><span class="line">  &quot;com.example.vendor&quot;: &quot;ACME Incorporated&quot;,</span><br><span class="line">  &quot;com.example.label-with-value&quot;: &quot;foo&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;This text illustrates that label-values can span multiple lines.&quot;,</span><br><span class="line">  &quot;multi.label1&quot;: &quot;value1&quot;,</span><br><span class="line">  &quot;multi.label2&quot;: &quot;value2&quot;,</span><br><span class="line">  &quot;other&quot;: &quot;value3&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h3><p>æ ¼å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPOSE &lt;port&gt; [&lt;port&gt;&#x2F;&lt;protocol&gt;...]</span><br></pre></td></tr></table></figure><p>EXPOSEæŒ‡ä»¤é€šçŸ¥Dockerå®¹å™¨åœ¨è¿è¡Œæ—¶ç›‘å¬æŒ‡å®šçš„ç½‘ç»œç«¯å£ã€‚æ‚¨å¯ä»¥æŒ‡å®šç«¯å£æ˜¯ä¾¦å¬TCPè¿˜æ˜¯UDPï¼Œå¦‚æœæœªæŒ‡å®šåè®®ï¼Œåˆ™é»˜è®¤å€¼ä¸ºTCPã€‚</p><p>EXPOSEæŒ‡ä»¤å®é™…ä¸Šå¹¶æœªå‘å¸ƒç«¯å£ã€‚å®ƒå……å½“æ„å»ºæ˜ åƒçš„äººå‘˜å’Œè¿è¡Œå®¹å™¨çš„äººå‘˜ä¹‹é—´çš„ä¸€ç§æ–‡æ¡£ç±»å‹ï¼Œæœ‰å…³æ‰“ç®—å‘å¸ƒå“ªäº›ç«¯å£çš„ä¿¡æ¯ã€‚è¦åœ¨è¿è¡Œå®¹å™¨æ—¶å®é™…å‘å¸ƒç«¯å£ï¼Œè¯·ä½¿ç”¨-pæ ‡è®°åœ¨docker run å‘å¸ƒå’Œæ˜ å°„ä¸€ä¸ªæˆ–å¤šä¸ªç«¯å£ï¼Œæˆ–è€…ä½¿ç”¨-Pæ ‡è®°å‘å¸ƒæ‰€æœ‰å…¬å¼€çš„ç«¯å£å¹¶å°†å®ƒä»¬æ˜ å°„åˆ°é«˜é˜¶ç«¯å£ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">é»˜è®¤æƒ…å†µä¸‹ï¼ŒEXPOSEæŒ‡å®šçš„æ˜¯TCP</span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">æŒ‡å®šUDP</span><br><span class="line">EXPOSE 80&#x2F;udp</span><br><span class="line"></span><br><span class="line">åŒæ—¶åœ¨TCPå’ŒUDPä¸Šå…¬å¼€</span><br><span class="line">EXPOSE 80&#x2F;tcp</span><br><span class="line">EXPOSE 80&#x2F;udp</span><br><span class="line"></span><br><span class="line">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œdocker run -pï¼Œåˆ™è¯¥ç«¯å£ä»…å¯¹TCPå…¬å¼€ä¸€æ¬¡ï¼Œå¯¹äºUDPå…¬å¼€ä¸€æ¬¡ã€‚</span><br><span class="line">-pçš„ç«¯å£åœ¨ä¸»æœºä¸Šä½¿ç”¨ä¸´æ—¶çš„é«˜é˜¶ä¸»æœºç«¯å£ï¼Œå› æ­¤è¯¥ç«¯å£å¯¹äºTCPå’ŒUDPå°†æ˜¯ä¸åŒçš„ã€‚</span><br><span class="line"></span><br><span class="line">æ— è®ºEXPOSEè®¾ç½®å¦‚ä½•ï¼Œéƒ½å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨è¯¥-pæ ‡å¿—è¦†ç›–å®ƒä»¬ã€‚ä¾‹å¦‚</span><br><span class="line">docker run -p 80:80&#x2F;tcp -p 80:80&#x2F;udp</span><br></pre></td></tr></table></figure><h3 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h3><p>æ ¼å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ENV &lt;key&gt; &lt;value&gt;</span><br><span class="line">ENV &lt;key&gt;&#x3D;&lt;value&gt;</span><br></pre></td></tr></table></figure><p>ENVæŒ‡ä»¤å°†ç¯å¢ƒå˜é‡<key>è®¾ç½®ä¸º<value>ã€‚æ­¤å€¼å°†åœ¨æ„å»ºé˜¶æ®µä¸­æ‰€æœ‰åç»­æŒ‡ä»¤çš„ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”æ”¯æŒEnvironment replacement</p><p>ENVæŒ‡ä»¤æœ‰ä¸¤ç§å½¢å¼ã€‚</p><p>ç¬¬ä¸€ç§å½¢å¼ENV <key> <value>ä¼šå°†ä¸€ä¸ªå˜é‡è®¾ç½®ä¸ºä¸€ä¸ªå€¼ã€‚ç¬¬ä¸€ä¸ªç©ºæ ¼ä¹‹åçš„æ•´ä¸ªå­—ç¬¦ä¸²å°†è¢«è§†ä¸º<value>-åŒ…æ‹¬ç©ºæ ¼å­—ç¬¦ã€‚è¯¥å€¼å°†ä¸ºå…¶ä»–ç¯å¢ƒå˜é‡è§£é‡Šï¼Œå› æ­¤å¦‚æœä¸å¯¹å¼•å·å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œåˆ™å°†å…¶åˆ é™¤ã€‚</p><p>ç¬¬äºŒç§å½¢å¼ENV <key>=<value> å…è®¸ä¸€æ¬¡è®¾ç½®å¤šä¸ªå˜é‡ã€‚è¯·æ³¨æ„ï¼Œç¬¬äºŒç§å½¢å¼åœ¨è¯­æ³•ä¸­ä½¿ç”¨ç­‰å·ï¼ˆ=ï¼‰ï¼Œè€Œç¬¬ä¸€ç§å½¢å¼åˆ™ä¸ä½¿ç”¨ç­‰å·ï¼ˆ=ï¼‰ã€‚åƒå‘½ä»¤è¡Œè§£æä¸€æ ·ï¼Œå¼•å·å’Œåæ–œæ å¯ç”¨äºåœ¨å€¼ä¸­åŒ…å«ç©ºæ ¼ã€‚</p><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ENV myName&#x3D;&quot;John Doe&quot; myDog&#x3D;Rex\ The\ Dog \</span><br><span class="line">    myCat&#x3D;fluffy</span><br><span class="line">å’Œ</span><br><span class="line">ENV myName John Doe</span><br><span class="line">ENV myDog Rex The Dog</span><br><span class="line">ENV myCat fluffy</span><br><span class="line"></span><br><span class="line">å°†åœ¨æœ€ç»ˆé•œåƒä¸­äº§ç”Ÿç›¸åŒçš„æ•ˆæœ</span><br></pre></td></tr></table></figure><p>åœ¨è¿è¡Œå®¹å™¨æ—¶ï¼Œä½¿ç”¨è®¾ç½®çš„ç¯å¢ƒå˜é‡å°†ä¿ç•™ã€‚å¯ä»¥ä½¿ç”¨docker inspectæŸ¥çœ‹ENVçš„å€¼ï¼Œå¹¶ä½¿ç”¨æ›´æ”¹å®ƒä»¬docker run â€“env <key>=<value></p><p>æ³¨æ„ï¼ï¼ï¼ç¯å¢ƒå˜é‡çš„æŒä¹…æ€§å¯èƒ½å¯¼è‡´æ„å¤–çš„å‰¯ä½œç”¨ï¼Œå¦‚æœè¦ä¸ºå•ä¸ªå‘½ä»¤è®¾ç½®å€¼ï¼Œåªéœ€è¦RUN <key>=<value> <command> å³å¯è®©commandé‡Œä½¿ç”¨key</p><h3 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h3><p>æ ¼å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ADD [--chown&#x3D;&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;</span><br><span class="line">ADD [--chown&#x3D;&lt;user&gt;:&lt;group&gt;] [&quot;&lt;src&gt;&quot;,... &quot;&lt;dest&gt;&quot;]</span><br></pre></td></tr></table></figure><p>ADDä»ç›®å½•æˆ–è¿œç¨‹æ–‡ä»¶URL <src>ä¸­å¤åˆ¶æ–°æ–‡ä»¶ï¼Œ ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°é•œåƒæ–‡ä»¶ç³»ç»Ÿä¸­çš„è·¯å¾„<dest>ã€‚</p><p>å¯ä»¥æŒ‡å®šå¤šä¸ª<src>èµ„æºï¼Œä½†æ˜¯å¦‚æœå®ƒä»¬æ˜¯æ–‡ä»¶æˆ–ç›®å½•ï¼Œåˆ™å°†å…¶è·¯å¾„è§£é‡Šä¸ºç›¸å¯¹äºæ„å»ºä¸Šä¸‹æ–‡æºçš„è·¯å¾„ã€‚æ¯ä¸ªéƒ½<src>å¯èƒ½åŒ…å«é€šé…ç¬¦ï¼Œå¹¶ä¸”åŒ¹é…å°†ä½¿ç”¨Goçš„ <a href="https://golang.org/pkg/path/filepath/#Match" target="_blank" rel="noopener">filepath.Match</a>è§„åˆ™å®Œæˆ</p><p>é™¤éé€‰æ‹©â€“chownæ ‡å¿—æŒ‡å®šç»™å®šçš„ç”¨æˆ·åï¼Œç»„åæˆ–UID / GIDç»„åˆä»¥è¯·æ±‚å¯¹æ‰€æ·»åŠ å†…å®¹çš„ç‰¹å®šæ‰€æœ‰æƒï¼Œå¦åˆ™æ‰€æœ‰æ–°æ–‡ä»¶å’Œç›®å½•çš„UIDå’ŒGIDå‡ä¸º0ã€‚â€“chownæ ‡å¿—çš„æ ¼å¼å…è®¸ç”¨æˆ·åå’Œç»„åå­—ç¬¦ä¸²æˆ–ç›´æ¥æ•´æ•°UIDå’ŒGIDä»»æ„ç»„åˆã€‚æä¾›ä¸å¸¦ç»„åçš„ç”¨æˆ·åæˆ–ä¸å¸¦GIDçš„UIDå°†ä½¿ç”¨ä¸GIDç›¸åŒçš„æ•°å­—UIDã€‚å¦‚æœæä¾›äº†ç”¨æˆ·åæˆ–ç»„åï¼Œåˆ™å°†ä½¿ç”¨å®¹å™¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ /etc/passwdå’Œ/etc/groupæ–‡ä»¶å°†åç§°åˆ†åˆ«è½¬æ¢ä¸ºæ•´æ•°UIDæˆ–GIDã€‚</p><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># è¦æ·»åŠ æ‰€æœ‰ä»¥â€œhomâ€å¼€å¤´çš„æ–‡ä»¶ï¼š</span><br><span class="line">ADD hom?.txt &#x2F;mydir&#x2F;</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œå¹¶å°†â€œtest.txtâ€æ·»åŠ åˆ°&lt;WORKDIR&gt;&#x2F;relativeDir&#x2F;</span><br><span class="line">ADD test.txt relativeDir&#x2F;</span><br><span class="line"></span><br><span class="line">ADD --chown&#x3D;55:mygroup files* &#x2F;somedir&#x2F;</span><br><span class="line"></span><br><span class="line">ADD --chown&#x3D;bin files* &#x2F;somedir&#x2F;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼ï¼ï¼å¦‚æœ<src>çš„å†…å®¹å·²æ›´æ”¹ï¼Œåˆ™é‡åˆ°çš„ç¬¬ä¸€ä¸ªADDæŒ‡ä»¤å°†ä½¿Dockerfileä¸­æ‰€æœ‰åç»­æŒ‡ä»¤çš„ç¼“å­˜æ— æ•ˆã€‚è¿™åŒ…æ‹¬ä½¿é«˜é€Ÿç¼“å­˜ä¸­çš„RUNæŒ‡ä»¤æ— æ•ˆã€‚</p><h3 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h3><p>æ ¼å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">COPY [--chown&#x3D;&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;</span><br><span class="line">COPY [--chown&#x3D;&lt;user&gt;:&lt;group&gt;] [&quot;&lt;src&gt;&quot;,... &quot;&lt;dest&gt;&quot;]</span><br></pre></td></tr></table></figure><p>COPYä»<src>å¤åˆ¶æ–°æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè·¯å¾„ä¸º<dest>ã€‚</p><p>å¯ä»¥æŒ‡å®šå¤šä¸ª<src>èµ„æºï¼Œä½†æ˜¯æ–‡ä»¶å’Œç›®å½•çš„è·¯å¾„å°†è¢«è§£é‡Šä¸ºç›¸å¯¹äºæ„å»ºä¸Šä¸‹æ–‡çš„æ¥æºã€‚</p><h3 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h3><p>æ ¼å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#EXECçš„å½¢å¼ï¼Œè¿™æ˜¯ä¼˜é€‰çš„å½¢å¼ï¼š</span><br><span class="line">ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]</span><br><span class="line">#Shellçš„å½¢å¼</span><br><span class="line">ENTRYPOINT command param1 param2</span><br></pre></td></tr></table></figure><p>ENTRYPOINTå¯ä»¥ä½œä¸ºå¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œçš„å®¹å™¨çš„é…ç½®ï¼Œä¸€èˆ¬é…åˆCMDä½¿ç”¨ã€‚ </p><p>æŒ‡å®š ENTRYPOINT ä¸º exec å½¢å¼æ—¶ï¼Œå‘½ä»¤è¡Œä¸ŠæŒ‡å®šçš„å‚æ•°ä¼šä½œä¸ºå‚æ•°æ·»åŠ åˆ° ENTRYPOINT çš„å‚æ•°åˆ—è¡¨ä¸­ã€‚</p><p>å¯ä»¥ä½¿ç”¨execå½¢å¼çš„ENTRYPOINTæ¥è®¾ç½®ç›¸å½“ç¨³å®šçš„é»˜è®¤å‘½ä»¤å’Œå‚æ•°ï¼Œç„¶åä½¿ç”¨ä¸¤ç§å½¢å¼çš„CMDæ¥è®¾ç½®æ›´å¯èƒ½è¢«æ›´æ”¹çš„å…¶ä»–é»˜è®¤å€¼ã€‚</p><p>ä¾‹å¦‚ï¼š</p><ul><li><p>EXECå½¢å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu</span><br><span class="line">ENTRYPOINT [&quot;top&quot;, &quot;-b&quot;]</span><br><span class="line">CMD [&quot;-c&quot;]</span><br><span class="line"></span><br><span class="line">docker build -t test:1.0 .</span><br><span class="line"></span><br><span class="line">docker run -it --rm --name test test:1.0 </span><br><span class="line"></span><br><span class="line">Mem: 1704520K used, 352148K free, 0K shrd, 0K buff, 140368121167873K cached</span><br><span class="line">CPU:   5% usr   0% sys   0% nic  94% idle   0% io   0% irq   0% sirq</span><br><span class="line">Load average: 0.08 0.03 0.05 2&#x2F;98 6</span><br><span class="line">  PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND</span><br><span class="line">    1     0 root     R     3164   0%   0% top -b -c </span><br><span class="line">    </span><br><span class="line">ç»“æœæ‰§è¡Œçš„æ˜¯top -b </span><br><span class="line"></span><br><span class="line">docker run -it --rm --name test  test:1.0  -H</span><br><span class="line"></span><br><span class="line">top - 08:25:00 up  7:27,  0 users,  load average: 0.00, 0.01, 0.05</span><br><span class="line">Threads:   1 total,   1 running,   0 sleeping,   0 stopped,   0 zombie</span><br><span class="line">%Cpu(s):  0.1 us,  0.1 sy,  0.0 ni, 99.7 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem:   2056668 total,  1616832 used,   439836 free,    99352 buffers</span><br><span class="line">KiB Swap:  1441840 total,        0 used,  1441840 free.  1324440 cached Mem</span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND</span><br><span class="line">    1 root      20   0   19744   2336   2080 R  0.0  0.1   0:00.04 top -b -H</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç»“æœæ˜¯æ‰§è¡Œtop -b -H</span><br></pre></td></tr></table></figure></li><li><p>Shellå½¢å¼</p></li></ul><p>shellå½¢å¼å¯ä»¥ä¸ºENTRYPOINTæŒ‡å®šä¸€ä¸ªçº¯å­—ç¬¦ä¸²ï¼Œå®ƒå°†åœ¨ä¸­æ‰§è¡Œ/bin/sh -cã€‚è¿™ç§å½¢å¼å°†ä½¿ç”¨shellå¤„ç†æ¥æ›¿ä»£shellç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”å°†å¿½ç•¥ä»»ä½•CMDæˆ–docker runå‘½ä»¤è¡Œå‚æ•°ã€‚ä¸ºäº†ç¡®ä¿èƒ½å¤Ÿæ­£ç¡®docker stopå‘å‡ºä»»ä½•é•¿æœŸè¿è¡Œçš„ENTRYPOINTå¯æ‰§è¡Œæ–‡ä»¶ä¿¡å·ï¼Œéœ€è¦ä»¥ä¸‹execå¯åŠ¨å®ƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu</span><br><span class="line">ENTRYPOINT exec top -b</span><br><span class="line"></span><br><span class="line">docker build -t test:1.0 .</span><br><span class="line"></span><br><span class="line">docker run -it --rm --name test test:1.0</span><br><span class="line"></span><br><span class="line">Mem: 1704520K used, 352148K free, 0K shrd, 0K buff, 140368121167873K cached</span><br><span class="line">CPU:   5% usr   0% sys   0% nic  94% idle   0% io   0% irq   0% sirq</span><br><span class="line">Load average: 0.08 0.03 0.05 2&#x2F;98 6</span><br><span class="line">  PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND</span><br><span class="line">    1     0 root     R     3164   0%   0% top -b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¦‚æœå¿˜è®°æ·»åŠ execåˆ°å¼€å¤´çš„ENTRYPOINTä¸­</span><br><span class="line"></span><br><span class="line">FROM ubuntu</span><br><span class="line">ENTRYPOINT top -b</span><br><span class="line">CMD -H</span><br><span class="line"></span><br><span class="line">docker build -t test:1.0 .</span><br><span class="line"></span><br><span class="line">docker run -it --name test test:1.0 -c </span><br><span class="line"></span><br><span class="line">Mem: 1704184K used, 352484K free, 0K shrd, 0K buff, 140621524238337K cached</span><br><span class="line">CPU:   9% usr   2% sys   0% nic  88% idle   0% io   0% irq   0% sirq</span><br><span class="line">Load average: 0.01 0.02 0.05 2&#x2F;101 7</span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root          1  0.4  0.0   2612   604 pts&#x2F;0    Ss+  09:16   0:00 &#x2F;bin&#x2F;sh -c top</span><br><span class="line">root          6  0.0  0.0   5956  3324 pts&#x2F;0    S+   09:16   0:00 top -b</span><br><span class="line">    </span><br><span class="line">ä»è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°topï¼ŒæŒ‡å®šENTRYPOINTçš„ä¸æ˜¯PID 1,è€Œä¸”CMDä¸­çš„å‚æ•°-Hæ— æ•ˆ,docker runå¸¦çš„-cå‚æ•°ä¹Ÿæ— æ•ˆ</span><br></pre></td></tr></table></figure><h3 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h3><p>æ ¼å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VOLUME [&quot;&#x2F;data&quot;]</span><br></pre></td></tr></table></figure><p>VOLUMEæŒ‡ä»¤åˆ›å»ºå…·æœ‰æŒ‡å®šåç§°çš„æŒ‚è½½ç‚¹ï¼Œå¹¶å°†å…¶æ ‡è®°ä¸ºä¿å­˜æœ¬æœºæˆ–å…¶ä»–å®¹å™¨çš„å¤–éƒ¨å®‰è£…çš„å­˜å‚¨å·ã€‚</p><p>ä¾‹å­ï¼š</p><p>docker runå‘½ä»¤ä½¿ç”¨åŸºç¡€é•œåƒå†…æŒ‡å®šä½ç½®ä¸Šå­˜åœ¨çš„ä»»ä½•æ•°æ®åˆå§‹åŒ–æ–°åˆ›å»ºçš„å·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu</span><br><span class="line">RUN mkdir &#x2F;myvol</span><br><span class="line">RUN echo &quot;hello world&quot; &gt; &#x2F;myvol&#x2F;greeting</span><br><span class="line">VOLUME &#x2F;myvol</span><br></pre></td></tr></table></figure><p>Dockerfileç”Ÿæˆä¸€ä¸ªé•œåƒï¼Œdocker runä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æŒ‚è½½ç‚¹/myvolå¹¶å°†è¯¥greetingæ–‡ä»¶å¤åˆ¶ åˆ°æ–°åˆ›å»ºçš„å·ä¸­ã€‚</p><p>å¦‚æœåˆ é™¤å®¹å™¨é‡Œçš„greetingï¼Œç„¶åé‡å¯å®¹å™¨ï¼Œè¯¥æ–‡ä»¶ä»ç„¶è¢«åˆ é™¤</p><p>ä½†æ˜¯å¦‚æœåˆ é™¤å®¹å™¨é‡Œçš„greetingå¹¶ä¸”å†åˆ é™¤å®¹å™¨ï¼Œå†åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œè¯¥æ–‡ä»¶åˆ™å­˜åœ¨ï¼Œå› ä¸ºå®é™…ä¸Šåˆæ‰§è¡Œäº†dockerfileé‡Œçš„RUN echo â€œhello worldâ€ &gt; /myvol/greeting å‘½ä»¤</p><p>æ³¨æ„ç‚¹</p><ul><li>ä¸»æœºç›®å½•æ˜¯åœ¨å®¹å™¨è¿è¡Œæ—¶å£°æ˜çš„ï¼šä¸»æœºç›®å½•ï¼ˆæŒ‚è½½ç‚¹ï¼‰æœ¬è´¨ä¸Šæ˜¯ä¾èµ–äºä¸»æœºçš„ã€‚è¿™æ˜¯ä¸ºäº†ä¿ç•™é•œåƒçš„å¯ç§»æ¤æ€§ï¼Œå› ä¸ºä¸èƒ½ä¿è¯ç»™å®šçš„ä¸»æœºç›®å½•åœ¨æ‰€æœ‰ä¸»æœºä¸Šéƒ½å¯ç”¨ã€‚å› æ­¤æ— æ³•ä»Dockerfileå†…æŒ‚è½½ä¸»æœºç›®å½•ã€‚</li><li>ä»Dockerfileä¸­æ›´æ”¹å·ï¼šå¦‚æœåœ¨å£°æ˜äº†å·ä¹‹åæœ‰ä»»ä½•æ„å»ºæ­¥éª¤æ›´æ”¹äº†å·ä¸­çš„æ•°æ®ï¼Œåˆ™è¿™äº›æ›´æ”¹çš„æŒ‡ä»¤å°†æ— æ•ˆã€‚</li></ul><h3 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h3><p>æ ¼å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR &#x2F;path&#x2F;to&#x2F;workdir</span><br></pre></td></tr></table></figure><p>WORKDIRä¼šè®¾ç½®å·¥ä½œç›®å½•å¹¶æˆä¸ºåç»­Dockerfileé‡Œçš„RUN, CMD, ENTRYPOINT, COPY å’Œ ADD çš„å½“å‰è·¯å¾„ï¼Œå¦‚æœWORKDIRä¸å­˜åœ¨ï¼Œå³ä½¿ä»¥åçš„DockerfileæŒ‡ä»¤ä¸­æœªä½¿ç”¨å®ƒä¹Ÿå°†è¢«åˆ›å»ºã€‚</p><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR &#x2F;a</span><br><span class="line">WORKDIR b</span><br><span class="line">WORKDIR c</span><br><span class="line">RUN pwd</span><br></pre></td></tr></table></figure><p>æœ€åpwdçš„è·¯å¾„ä¸º /a/b/c</p><p>WORKDIRèƒ½è§£æåœ¨æ­¤ä¹‹å‰ENVè®¾ç½®çš„ç¯å¢ƒå˜é‡ï¼Œè€Œä¸”åªèƒ½ä½¿ç”¨Dockerfileä¸­æ˜¾ç¤ºçš„ç¯å¢ƒå˜é‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ENV DIRPATH &#x2F;path</span><br><span class="line">WORKDIR $DIRPATH&#x2F;$DIRNAME</span><br><span class="line">RUN pwd</span><br></pre></td></tr></table></figure><p>æœ€åpwdçš„è·¯å¾„ä¸º /path/$DIRNAME</p><h3 id="ARG"><a href="#ARG" class="headerlink" title="ARG"></a>ARG</h3><p>æ ¼å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARG &lt;name&gt;[&#x3D;&lt;default value&gt;]</span><br></pre></td></tr></table></figure><p>è¯¥ARGæŒ‡ä»¤å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œç”¨æˆ·å¯ä»¥åœ¨æ„å»ºæ—¶docker buildä½¿ç”¨å¸¦æœ‰â€“build-arg <varname>=<value> æ ‡å¿—çš„å‘½ä»¤å°†å…¶ä¼ é€’ç»™æ„å»ºå™¨ã€‚å¦‚æœç”¨æˆ·æŒ‡å®šäº†æœªåœ¨Dockerfileä¸­å®šä¹‰çš„æ„å»ºå‚æ•°ï¼Œåˆ™æ„å»ºä¼šè¾“å‡ºè­¦å‘Šã€‚</p><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM busybox</span><br><span class="line">ARG user1&#x3D;someuser</span><br><span class="line">ARG buildno&#x3D;1</span><br></pre></td></tr></table></figure><p>å¦‚æœARGå…·æœ‰é»˜è®¤å€¼ï¼Œå¹¶ä¸”åœ¨æ„å»ºæ—¶æœªä¼ é€’ä»»ä½•å€¼ï¼Œé‚£ä¹ˆæ„å»ºå™¨å°†ä½¿ç”¨é»˜è®¤å€¼ã€‚å³user1=someuserã€buildno=1</p><p>ä¸€ä¸ªARGå˜é‡å®šä¹‰åªèƒ½åœ¨Dockerfileæ„å»ºçš„ä¸€ä¸ªé˜¶æ®µå†…çš„é‚£ä¸€è¡Œåˆ°ç»“æŸèŒƒå›´å†…ç”Ÿæ•ˆï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯ARGå£°æ˜çš„é‚£ä¸€åˆ»åˆ°ä¸‹ä¸€ä¸ªFROMä¸­é—´æœ‰æ•ˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">FROM busybox</span><br><span class="line">RUN echo SETTINGS</span><br><span class="line">ARG SETTINGS</span><br><span class="line">RUN .&#x2F;run&#x2F;setup $SETTINGS</span><br><span class="line"></span><br><span class="line">FROM busybox</span><br><span class="line">RUN echo SETTINGS</span><br><span class="line">ARG SETTINGS</span><br><span class="line">RUN .&#x2F;run&#x2F;other $SETTINGS</span><br><span class="line"></span><br><span class="line">docker build --build-arg SETTINGS&#x3D;hello .</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œç»“æœä¸ºï¼š</span><br><span class="line">ç¬¬ä¸€é˜¶æ®µçš„FROMè¿‡ç¨‹</span><br><span class="line">RUN echo SETTINGS</span><br><span class="line">ARG hello</span><br><span class="line">RUN .&#x2F;run&#x2F;setup hello</span><br><span class="line"></span><br><span class="line">ç¬¬äºŒé˜¶æ®µçš„FROMè¿‡ç¨‹</span><br><span class="line">RUN echo SETTINGS</span><br><span class="line">ARG hello</span><br><span class="line">RUN .&#x2F;run&#x2F;other hello</span><br></pre></td></tr></table></figure><p>ARGåœ¨å®ƒè¢«å®šä¹‰çš„æ„å»ºé˜¶æ®µèŒƒå›´è¿›è¡Œã€‚è¦åœ¨å¤šä¸ªé˜¶æ®µä½¿ç”¨ARGï¼Œæ¯ä¸ªé˜¶æ®µéƒ½å¿…é¡»åŒ…å«ARGæŒ‡ä»¤ã€‚</p><p>ARGæˆ–ENVä¼šæŒ‡å®šRUNæŒ‡ä»¤å¯ç”¨çš„å˜é‡ã€‚ä½¿ç”¨ENVæŒ‡ä»¤å®šä¹‰çš„ç¯å¢ƒå˜é‡ å§‹ç»ˆä¼šè¦†ç›–ARGåŒåæŒ‡ä»¤ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu</span><br><span class="line">ARG CONT_IMG_VER</span><br><span class="line">ENV CONT_IMG_VER v1.0.0</span><br><span class="line">RUN echo $CONT_IMG_VER</span><br><span class="line"></span><br><span class="line">docker build --build-arg CONT_IMG_VER&#x3D;v2.0.1 .</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥RUNæŒ‡ä»¤å°†ä½¿ç”¨v1.0.0è€Œä¸æ˜¯ç”¨æˆ·ä¼ é€’çš„ARGï¼šv2.0.1ã€‚æ­¤è¡Œä¸ºç±»ä¼¼äºShellè„šæœ¬ï¼Œå…¶ä¸­å±€éƒ¨ä½œç”¨åŸŸçš„å˜é‡ä»å…¶å®šä¹‰çš„è§’åº¦è¦†ç›–ä½œä¸ºå‚æ•°ä¼ é€’æˆ–ä»ç¯å¢ƒç»§æ‰¿çš„å˜é‡ã€‚</p><p>ä½¿ç”¨ä¸Šé¢çš„ç¤ºä¾‹ï¼Œä½†ä½¿ç”¨ä¸åŒçš„ENVè§„èŒƒï¼Œå¯ä»¥åœ¨ARGå’ŒENVæŒ‡ä»¤ä¹‹é—´åˆ›å»ºæ›´æœ‰ç”¨çš„äº¤äº’ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu</span><br><span class="line">ARG CONT_IMG_VER</span><br><span class="line">ENV CONT_IMG_VER $&#123;CONT_IMG_VER:-v1.0.0&#125;</span><br><span class="line">RUN echo $CONT_IMG_VER  &gt; &#x2F;haha</span><br><span class="line"></span><br><span class="line">docker build --build-arg CONT_IMG_VER&#x3D;v2.0.1 -t test:1.5 .</span><br><span class="line">docker run --name test --rm -itd test:1.5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker exec -it test cat &#x2F;haha</span><br><span class="line">v2.0.1</span><br></pre></td></tr></table></figure><p>ä¸ARGæŒ‡ä»¤ä¸åŒï¼ŒENVå€¼å§‹ç»ˆä¿ç•™åœ¨ç”Ÿæˆçš„é•œåƒä¸­ã€‚ä½¿ç”¨æ­¤Dockerfileç¤ºä¾‹ï¼ŒCONT_IMG_VERå®ƒä»ç„¶ä¿ç•™åœ¨æ˜ åƒä¸­ï¼Œä½†å…¶å€¼å°†æ˜¯æŒ‡ä»¤ç¬¬3è¡Œä¸­çš„é»˜è®¤è®¾ç½®ENV,è€ŒENVæ˜¯ARGåœ¨docker bulidæ„å»ºæ—¶ä¼ çš„å‚æ•°v2.0.1 ã€‚</p><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå˜é‡æ‰©å±•æŠ€æœ¯å¯ä»¥ä»å‘½ä»¤è¡Œä¼ é€’å‚æ•°ï¼Œå¹¶åˆ©ç”¨ENVæŒ‡ä»¤å°†å…¶ä¿ç•™åœ¨æœ€ç»ˆæ˜ åƒä¸­ ã€‚</p><h2 id="ç›¸ä¼¼æŒ‡ä»¤å¯¹æ¯”"><a href="#ç›¸ä¼¼æŒ‡ä»¤å¯¹æ¯”" class="headerlink" title="ç›¸ä¼¼æŒ‡ä»¤å¯¹æ¯”"></a>ç›¸ä¼¼æŒ‡ä»¤å¯¹æ¯”</h2><h3 id="RUN-and-CMD"><a href="#RUN-and-CMD" class="headerlink" title="RUN and CMD"></a>RUN and CMD</h3><p>RUNæ˜¯é’ˆå¯¹é•œåƒï¼Œåœ¨é•œåƒæ„å»ºçš„æ—¶å€™è¿è¡Œå‘½ä»¤å¹¶æäº¤ç»“æœï¼Œä¸€ä¸ªDockerfileå¯ä»¥æœ‰å¾ˆå¤šä¸ªRUNå‘½ä»¤</p><p>CMDæ˜¯é’ˆå¯¹å®¹å™¨ï¼Œåœ¨é•œåƒæ„å»ºçš„æ—¶å€™ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œè€Œæ˜¯åœ¨é•œåƒå¯åŠ¨åæ‰§è¡Œå‘½ä»¤ï¼Œä¸€ä¸ªDockerfileå³ä½¿æœ‰å¾ˆå¤šä¸ªCMDå‘½ä»¤ï¼Œä¹Ÿåªç”Ÿæ•ˆæœ€åä¸€ä¸ª(åŸå› åœ¨ä¸‹é¢è§£é‡Š)</p><h3 id="COPY-and-ADD"><a href="#COPY-and-ADD" class="headerlink" title="COPY and ADD"></a>COPY and ADD</h3><p>COPYèƒ½å¤Ÿå°†æ„å»ºå‘½ä»¤æ‰€åœ¨çš„ä¸»æœºæœ¬åœ°çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¤åˆ¶åˆ°é•œåƒæ–‡ä»¶ç³»ç»Ÿã€‚</p><p>ADDæŒ‡ä»¤ä¸ä»…èƒ½å¤Ÿå°†æ„å»ºå‘½ä»¤æ‰€åœ¨çš„ä¸»æœºæœ¬åœ°çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œè€Œä¸”èƒ½å¤Ÿå°†è¿œç¨‹URLæ‰€å¯¹åº”çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œä½œä¸ºèµ„æºå¤åˆ¶åˆ°é•œåƒæ–‡ä»¶ç³»ç»Ÿã€‚</p><p>æ»¡è¶³åŒç­‰åŠŸèƒ½çš„æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨COPYæŒ‡ä»¤ã€‚ADDæŒ‡ä»¤æ›´æ“…é•¿è¯»å–æœ¬åœ°taræ–‡ä»¶å¹¶è§£å‹ç¼©ã€‚è€Œä¸”ç”±äºå› ä¸ºè·¯å¾„ã€èµ„æºæ›´æ”¹è€Œå¯¼è‡´ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µå‡ºç°ï¼Œæˆ‘ä»¬æ›´åº”è¯¥å°½é‡å°‘ç”¨ADDï¼Œè€Œæ”¹ç”¨ä½¿ç”¨RUN wgetæˆ–RUN curlæ›¿ä»£ï¼Œå¹¶ä¸”æŠŠè¿™ä¸€æ­¥éª¤å°½å¯èƒ½åœ°æ”¾åœ¨Dockerfileçš„åé¢ä½ç½®ã€‚</p><h3 id="ENTRYPOINT-and-CMDç»„åˆæ‰§è¡Œçš„å‘½ä»¤"><a href="#ENTRYPOINT-and-CMDç»„åˆæ‰§è¡Œçš„å‘½ä»¤" class="headerlink" title="ENTRYPOINT and CMDç»„åˆæ‰§è¡Œçš„å‘½ä»¤"></a>ENTRYPOINT and CMDç»„åˆæ‰§è¡Œçš„å‘½ä»¤</h3><ul><li>Dockerfileåº”è‡³å°‘æŒ‡å®šCMDæˆ–ENTRYPOINTå‘½ä»¤ä¹‹ä¸€ã€‚</li><li>ä½¿ç”¨å®¹å™¨ä½œä¸ºå¯æ‰§è¡Œæ–‡ä»¶æ—¶åº”å®šä¹‰ENTRYPOINT </li><li>CMDåº”è¯¥ç”¨ä½œENTRYPOINTåœ¨å®¹å™¨ä¸­å®šä¹‰å‘½ä»¤æˆ–æ‰§è¡Œä¸´æ—¶å‘½ä»¤çš„é»˜è®¤å‚æ•°çš„æ–¹å¼ã€‚</li><li>å½“ä½¿ç”¨å…¶ä»–å‚æ•°è¿è¡Œå®¹å™¨æ—¶ï¼ŒCMD å°†è¢«è¦†ç›–ã€‚</li></ul><p>ENTRYPOINTåº”è¯¥è¢«å½“åšdockerçš„å¯æ‰§è¡Œç¨‹åºï¼ŒCMDåº”è¯¥è¢«å½“åšENTRYPOINTçš„é»˜è®¤å‚æ•°ã€‚</p><p>ç»„åˆåˆ—è¡¨ï¼šä»¥dfå‘½ä»¤ä¸ºä¾‹</p><table><thead><tr><th>CMD/ENTRYPOINT</th><th>No ENTRYPOINT</th><th>ENTRYPOINT du -H</th><th>ENTRYPOINT [â€œduâ€, â€œ-Hâ€]</th></tr></thead><tbody><tr><td>No CMD</td><td>ä¸å…è®¸</td><td>/bin/sh -c du -H</td><td>du -H</td></tr><tr><td>CMD [â€œdfâ€, â€œ-hâ€]</td><td>df -h</td><td>/bin/sh -c du -H</td><td>du -H df -h</td></tr><tr><td>CMD [â€œ-hâ€, â€œ-Tâ€]</td><td>-h -T</td><td>/bin/sh -c du -H</td><td>du -H -h -T</td></tr><tr><td>CMD df -h</td><td>/bin/sh -c df -h</td><td>/bin/sh -c du -H</td><td>du -H /bin/sh -c df -h</td></tr></tbody></table><ul><li>å¦‚æœ ENTRYPOINT ä½¿ç”¨äº† shell æ¨¡å¼ï¼ŒCMD æŒ‡ä»¤ä¼šè¢«å¿½ç•¥ã€‚</li><li>å¦‚æœ ENTRYPOINT ä½¿ç”¨äº† exec æ¨¡å¼ï¼ŒCMD æŒ‡å®šçš„å†…å®¹è¢«è¿½åŠ ä¸º ENTRYPOINT æŒ‡å®šå‘½ä»¤çš„å‚æ•°ã€‚</li></ul><p>ç»“è®ºï¼šä¸€èµ·ä½¿ç”¨ENTRYPOINTå’ŒCMDæ—¶ï¼ŒåŠ¡å¿…åŒæ—¶ä½¿ç”¨ä¸¤ä¸ªæŒ‡ä»¤çš„execå½¢å¼ï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚å°è¯•ä½¿ç”¨shellå½¢å¼ï¼Œæˆ–è€…æ··åˆåŒ¹é…shellå’Œexecå½¢å¼å‡ ä¹ä¸ä¼šç»™æ‚¨æƒ³è¦çš„ç»“æœã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>DockerfileåŸºæœ¬å‘½ä»¤å’Œå†™æ³•æ ¼å¼éƒ½è®²å®Œäº†ï¼Œä¸‹æœŸä¸»è¦è®²Dockerfileçš„æ„å»ºåº•å±‚å®ç°åŸç†ã€‚</p><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><p><a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">Dockerfileå®˜æ–¹æ–‡æ¡£å‚è€ƒ</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dockerfile </tag>
            
            <tag> Linux </tag>
            
            <tag> Devops </tag>
            
            <tag> Docker </tag>
            
            <tag> å®¹å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Helmç®€ä»‹åŠé˜¿é‡Œäº‘å®‰è£…éƒ¨ç½²</title>
      <link href="/2020/06/21/helm/helm-install/"/>
      <url>/2020/06/21/helm/helm-install/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æœ€è¿‘æ–°é¡¹ç›®è¦é€šè¿‡Helméƒ¨ç½²ï¼Œç„¶åæˆ‘å‘ç°ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘æ‰˜ç®¡å‹kubernetes(å…¨éƒ¨éƒ½æ˜¯nodeèŠ‚ç‚¹ï¼Œæ— Mater)æ²¡æœ‰å®‰è£…Helmï¼Œè²Œä¼¼è¿˜è¦ç”¨é˜¿é‡Œäº‘ä¼ä¸šé•œåƒæœåŠ¡ï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰åº”è¯¥æ²¡æœ‰è¿™ä¹ˆå‘ï¼Œå› ä¸ºçº¿ä¸‹ç”¨çš„æ˜¯è‡ªå·±æ­å»ºçš„é›†ç¾¤ï¼Œç›´æ¥å®‰è£…Helmæ­å»ºç§äººä»“åº“å³å¯ç”¨ã€‚</p><p>å‘¨æœ«åŠ ä¸ªç­å­¦ä¹ ä¸‹Helmåˆ°åº•æ˜¯å’‹å›äº‹ï¼Œè™½ç„¶ä¸€ç›´åœ¨ä½¿ç”¨å‘½ä»¤éƒ¨ç½²ï¼Œä¸è¿‡è¿˜æ²¡æ·±å…¥ç ”ç©¶ä¸‹ã€‚</p><h1 id="Helmç®€ä»‹"><a href="#Helmç®€ä»‹" class="headerlink" title="Helmç®€ä»‹"></a>Helmç®€ä»‹</h1><p>Helmå®˜ç½‘è§£é‡Š</p><ul><li>Helmæ˜¯æŸ¥æ‰¾ï¼Œå…±äº«å’Œä½¿ç”¨ä¸º Kubernetesè€Œæ„å»ºçš„è½¯ä»¶çš„æœ€ä½³æ–¹æ³•ã€‚</li><li>Helmå¸®åŠ©æ‚¨ç®¡ç†Kubernetesåº”ç”¨ç¨‹åº-Helm Chartså¸®åŠ©æ‚¨å®šä¹‰ï¼Œå®‰è£…å’Œå‡çº§æœ€å¤æ‚çš„Kubernetesåº”ç”¨ç¨‹åºã€‚</li><li>Helmæ˜¯CNCFçš„ä¸€ä¸ªæ¯•ä¸šé¡¹ç›®ï¼Œç”±Helmç¤¾åŒºç»´æŠ¤ã€‚</li></ul><p>ç¿»è¯‘è¿˜æŒºæœ‰æ„æ€çš„</p><ul><li>Helmâ†’å¤´ç›”/èˆµ</li><li>Chartâ†’å›¾è¡¨</li><li>Releaseâ†’ç‰ˆæœ¬</li></ul><p>çœ‹äº†å®˜æ–¹å®šä¹‰åï¼Œæˆ‘å¤§æ¦‚äº†è§£äº†ä¸‹å‡ ä¸ªé‡è¦å®šä¹‰(æœ‰ä¸å¯¹çš„åœ°æ–¹è¯·æŒ‡æ•™)</p><h2 id="Helmæ˜¯ç”¨äºç®¡ç†Chartçš„å·¥å…·"><a href="#Helmæ˜¯ç”¨äºç®¡ç†Chartçš„å·¥å…·" class="headerlink" title="Helmæ˜¯ç”¨äºç®¡ç†Chartçš„å·¥å…·"></a>Helmæ˜¯ç”¨äºç®¡ç†Chartçš„å·¥å…·</h2><p>Helmæ˜¯å¯ç®€åŒ–Kubernetesåº”ç”¨ç¨‹åºå®‰è£…å’Œç®¡ç†çš„å·¥å…·ã€‚å¯ä»¥å°†å…¶è§†ä¸ºKubernetesçš„apt / yum / homebrewã€‚</p><p>åŠŸèƒ½æœ‰å¦‚ä¸‹å‡ ç‚¹ï¼š</p><ul><li>æŸ¥æ‰¾å¹¶ä½¿ç”¨æ‰“åŒ…ä¸ºHelm Chartsçš„æµè¡Œè½¯ä»¶åœ¨Kubernetesä¸­è¿è¡Œ</li><li>å°†æ‚¨è‡ªå·±çš„åº”ç”¨ç¨‹åºå…±äº«ä¸ºHelm Charts</li><li>åˆ›å»ºKubernetesåº”ç”¨ç¨‹åºçš„å¯å¤åˆ¶æ„å»º</li><li>æ™ºèƒ½ç®¡ç†æ‚¨çš„Kubernetesæ¸…å•æ–‡ä»¶</li><li>ç®¡ç†Helmè½¯ä»¶åŒ…çš„å‘å¸ƒ</li></ul><p>å…¶ä¸­æœ€ä¸ºé‡è¦çš„ä¸€ç‚¹ï¼šæŸ¥æ‰¾å¹¶ä½¿ç”¨æ‰“åŒ…ä¸ºHelm Chartsçš„æµè¡Œè½¯ä»¶åœ¨Kubernetesä¸­è¿è¡Œ</p><p>å®é™…è¿ä½œå°±æ˜¯Helmæ¸²æŸ“ChartåŒ…å¹¶ä¸Kubernetes APIé€šä¿¡ï¼Œä¹Ÿå¯ä»¥å˜ç›¸ç†è§£ä¸ºä»£æ›¿äº†kubectlçš„åŠŸèƒ½å»ä¸Kubernetes APIé€šä¿¡(å¯¹äºè¿ç»´æ¥è¯´)</p><h2 id="Chartæ˜¯é¢„å…ˆé…ç½®çš„Kubernetesèµ„æºåŒ…ã€‚"><a href="#Chartæ˜¯é¢„å…ˆé…ç½®çš„Kubernetesèµ„æºåŒ…ã€‚" class="headerlink" title="Chartæ˜¯é¢„å…ˆé…ç½®çš„Kubernetesèµ„æºåŒ…ã€‚"></a>Chartæ˜¯é¢„å…ˆé…ç½®çš„Kubernetesèµ„æºåŒ…ã€‚</h2><p>Chartæ˜¯åŒ…å«è‡³å°‘ä¸¤é¡¹å†…å®¹çš„Helmè½¯ä»¶åŒ…ï¼š</p><ul><li>è½¯ä»¶åŒ…è¯´æ˜ï¼ˆChart.yamlï¼‰</li><li>ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡æ¿ï¼Œå…¶ä¸­åŒ…å«Kubernetesæ¸…å•æ–‡ä»¶</li></ul><p>ChartåŒ…å¯ä»¥å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œä¹Ÿå¯ä»¥ä»è¿œç¨‹Chartä»“åº“ä¸­è·å–ï¼ˆä¾‹å¦‚Debianæˆ–RedHatè½¯ä»¶åŒ…ï¼‰</p><p>å…¶ä¸­çš„é‡ç‚¹å°±æ˜¯Chartçš„æ¨¡æ¿æ–‡ä»¶çš„ç¼–å†™ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š</p><ul><li>æ¨¡æ¿ç”Ÿæˆæ¸…å•æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶æ˜¯Kuberneteså¯ä»¥ç†è§£çš„YAMLæ ¼å¼çš„èµ„æºæè¿°</li><li>Helmæ¨¡æ¿è¯­è¨€</li><li>ä½¿ç”¨å€¼</li><li>ä½¿ç”¨æ¨¡æ¿çš„æŠ€å·§</li></ul><h2 id="Release-æ˜¯ä¸€ä¸ªçš„è¿è¡Œå®ä¾‹çš„-chartï¼Œå…·æœ‰ç‰¹å®šçš„ç»„åˆé…ç½®ã€‚"><a href="#Release-æ˜¯ä¸€ä¸ªçš„è¿è¡Œå®ä¾‹çš„-chartï¼Œå…·æœ‰ç‰¹å®šçš„ç»„åˆé…ç½®ã€‚" class="headerlink" title="Release æ˜¯ä¸€ä¸ªçš„è¿è¡Œå®ä¾‹çš„ chartï¼Œå…·æœ‰ç‰¹å®šçš„ç»„åˆé…ç½®ã€‚"></a>Release æ˜¯ä¸€ä¸ªçš„è¿è¡Œå®ä¾‹çš„ chartï¼Œå…·æœ‰ç‰¹å®šçš„ç»„åˆé…ç½®ã€‚</h2><p>å®‰è£…Chartåï¼ŒHelmåº“å°†åˆ›å»ºä¸€ä¸ªå‘è¡Œç‰ˆæ¥è·Ÿè¸ªè¯¥å®‰è£…ã€‚</p><p>å•ä¸ªChartå¯ä»¥å¤šæ¬¡å®‰è£…åˆ°åŒä¸€ç¾¤é›†ä¸­ï¼Œå¹¶åˆ›å»ºè®¸å¤šä¸åŒçš„å‘è¡Œç‰ˆã€‚ä¾‹å¦‚ï¼Œé€šè¿‡helm installä½¿ç”¨ä¸åŒçš„å‘è¡Œç‰ˆåç§°è¿è¡Œ3æ¬¡ï¼Œå¯ä»¥å®‰è£…ä¸‰ä¸ªPostgreSQLæ•°æ®åº“ã€‚</p><h2 id="Release-Number-Release-Version"><a href="#Release-Number-Release-Version" class="headerlink" title="Release Number (Release Version)"></a>Release Number (Release Version)</h2><p>å•ä¸ªç‰ˆæœ¬å¯ä»¥å¤šæ¬¡æ›´æ–°ã€‚é¡ºåºè®¡æ•°å™¨ç”¨äºè·Ÿè¸ªå‘å¸ƒçš„å˜åŒ–ã€‚åœ¨ç¬¬helm installä¸€ä¸ªå‘è¡Œç‰ˆä¹‹åï¼Œå‘è¡Œç‰ˆå°†å…·æœ‰ å‘è¡Œç‰ˆå· 1ã€‚æ¯æ¬¡å‡çº§æˆ–å›æ»šå‘è¡Œç‰ˆæ—¶ï¼Œå‘è¡Œç‰ˆå·éƒ½ä¼šé€’å¢ã€‚</p><h1 id="Helmæ¶æ„"><a href="#Helmæ¶æ„" class="headerlink" title="Helmæ¶æ„"></a>Helmæ¶æ„</h1><p>äº†è§£äº†ä¸Šé¢çš„å®šä¹‰ï¼Œæˆ‘ç»§ç»­å­¦ä¹ äº†Helmçš„æ¶æ„ï¼ŒHelmä¹Ÿæ˜¯ç»å…¸çš„C/Sæ¶æ„(æˆ‘æ€ä¹ˆå‘ç°å’ŒDockeræ¶æ„ä¼¼æ›¾ç›¸è¯†)</p><h2 id="Helm-Client-æ˜¯ç”¨æˆ·çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯-ä¿—ç§°ç»ˆç«¯-ã€‚å®¢æˆ·ç«¯è´Ÿè´£ä»¥ä¸‹éƒ¨åˆ†ï¼š"><a href="#Helm-Client-æ˜¯ç”¨æˆ·çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯-ä¿—ç§°ç»ˆç«¯-ã€‚å®¢æˆ·ç«¯è´Ÿè´£ä»¥ä¸‹éƒ¨åˆ†ï¼š" class="headerlink" title="Helm Client æ˜¯ç”¨æˆ·çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯(ä¿—ç§°ç»ˆç«¯)ã€‚å®¢æˆ·ç«¯è´Ÿè´£ä»¥ä¸‹éƒ¨åˆ†ï¼š"></a>Helm Client æ˜¯ç”¨æˆ·çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯(ä¿—ç§°ç»ˆç«¯)ã€‚å®¢æˆ·ç«¯è´Ÿè´£ä»¥ä¸‹éƒ¨åˆ†ï¼š</h2><ul><li>æœ¬åœ° chart å¼€å‘</li><li>ç®¡ç†å­˜å‚¨åº“</li><li>ä¸ Tiller æœåŠ¡äº¤äº’</li><li>å‘é€è¦å®‰è£…çš„ chart</li><li>æŸ¥è¯¢æœ‰å…³å‘å¸ƒçš„ä¿¡æ¯</li><li>è¯·æ±‚å‡çº§æˆ–å¸è½½ç°æœ‰ release</li></ul><h2 id="Tiller-Server-æ˜¯ä¸€ä¸ªé›†ç¾¤å†…æœåŠ¡ï¼Œä¸-Helm-å®¢æˆ·ç«¯è¿›è¡Œäº¤äº’ï¼Œå¹¶ä¸-Kubernetes-API-æœåŠ¡è¿›è¡Œäº¤äº’ã€‚æœåŠ¡è´Ÿè´£ä»¥ä¸‹å†…å®¹ï¼š"><a href="#Tiller-Server-æ˜¯ä¸€ä¸ªé›†ç¾¤å†…æœåŠ¡ï¼Œä¸-Helm-å®¢æˆ·ç«¯è¿›è¡Œäº¤äº’ï¼Œå¹¶ä¸-Kubernetes-API-æœåŠ¡è¿›è¡Œäº¤äº’ã€‚æœåŠ¡è´Ÿè´£ä»¥ä¸‹å†…å®¹ï¼š" class="headerlink" title="Tiller Server æ˜¯ä¸€ä¸ªé›†ç¾¤å†…æœåŠ¡ï¼Œä¸ Helm å®¢æˆ·ç«¯è¿›è¡Œäº¤äº’ï¼Œå¹¶ä¸ Kubernetes API æœåŠ¡è¿›è¡Œäº¤äº’ã€‚æœåŠ¡è´Ÿè´£ä»¥ä¸‹å†…å®¹ï¼š"></a>Tiller Server æ˜¯ä¸€ä¸ªé›†ç¾¤å†…æœåŠ¡ï¼Œä¸ Helm å®¢æˆ·ç«¯è¿›è¡Œäº¤äº’ï¼Œå¹¶ä¸ Kubernetes API æœåŠ¡è¿›è¡Œäº¤äº’ã€‚æœåŠ¡è´Ÿè´£ä»¥ä¸‹å†…å®¹ï¼š</h2><ul><li>ç›‘å¬æ¥è‡ª Helm å®¢æˆ·ç«¯çš„ä¼ å…¥è¯·æ±‚</li><li>ç»“åˆ chart å’Œé…ç½®æ¥æ„å»ºå‘å¸ƒ</li><li>å°† chart å®‰è£…åˆ° Kubernetes ä¸­ï¼Œç„¶åè·Ÿè¸ªåç»­ release</li><li>é€šè¿‡ä¸ Kubernetes äº¤äº’æ¥å‡çº§å’Œå¸è½½ chart</li></ul><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p>Helm å®¢æˆ·ç«¯ä½¿ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå¹¶ä½¿ç”¨ gRPC åè®®å¥—ä»¶ä¸ Tiller æœåŠ¡è¿›è¡Œäº¤äº’ã€‚</p><p>Tiller æœåŠ¡ç«¯ä¹Ÿç”¨ Go ç¼–å†™ã€‚å®ƒæä¾›äº†ä¸€ä¸ªä¸å®¢æˆ·ç«¯è¿æ¥çš„ gRPC æœåŠ¡ï¼Œå®ƒä½¿ç”¨ Kubernetes å®¢æˆ·ç«¯åº“ä¸ Kubernetes è¿›è¡Œé€šä¿¡ã€‚ç›®å‰ï¼Œè¯¥åº“ä½¿ç”¨ REST + JSONã€‚</p><p>Tiller æœåŠ¡å°†ä¿¡æ¯å­˜å‚¨åœ¨ä½äº Kubernetes å†…çš„ ConfigMaps ä¸­ã€‚å®ƒä¸éœ€è¦è‡ªå·±çš„æ•°æ®åº“ã€‚</p><p>å¦‚æœ‰å¯èƒ½ï¼Œé…ç½®æ–‡ä»¶ç”¨YAMLç¼–å†™ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åŸºæœ¬äº†è§£äº†Helmä¹‹åæˆ‘ç»ˆäºæ˜ç™½äº†ï¼Œåªéœ€è¦åœ¨k8sé›†ç¾¤å†…è£…ä¸€ä¸ªHelmæœåŠ¡ç«¯(tiller)ï¼Œç„¶ååœ¨é›†ç¾¤å†…ä»»ä½•ä¸€å°æœºå™¨ä¸Šå®‰è£…Helmå®¢æˆ·ç«¯ï¼Œå³å¯é€šè¿‡Helmæ§åˆ¶æ•´ä¸ªé›†ç¾¤ã€‚</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>ç”±äºçº¿ä¸‹Helmç‰ˆæœ¬ä¸º2.16.3ï¼Œæˆ‘å°±åœ¨é›†ç¾¤å†…å®‰è£…ç›¸åŒçš„ç‰ˆæœ¬ä¿æŒåŒæ­¥(åœ¨ä¸äº†è§£æ–°ç‰ˆçš„ç‰¹æ€§æƒ…å†µä¸‹ä¸æ•¢è·¨ç‰ˆæœ¬å®‰è£…ï¼Œæ€•äº†æ€•äº†)</p><ul><li>æ ¹æ®ç³»ç»Ÿä¸‹è½½æ‰€éœ€ç‰ˆæœ¬<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L -o helm-v2.16.3-linux-amd64.tar.gz https:&#x2F;&#x2F;file.choerodon.com.cn&#x2F;kubernetes-helm&#x2F;v2.16.3&#x2F;helm-v2.16.3-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure></li><li>è§£å‹å‹ç¼©åŒ…ï¼ˆä»¥linux-amd64ä¸ºä¾‹ï¼‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf helm-v2.16.3-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure><ul><li>å°†æ–‡ä»¶ç§»åŠ¨åˆ°PATHç›®å½•ä¸­ï¼ˆä»¥linux-amd64ä¸ºä¾‹ï¼‰<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv linux-amd64&#x2F;helm &#x2F;usr&#x2F;bin&#x2F;helm</span><br></pre></td></tr></table></figure></li><li>å®‰è£…æœåŠ¡ç«¯tiller</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">helm init --tiller-image registry.cn-hangzhou.aliyuncs.com&#x2F;acs&#x2F;tiller:v2.16.3</span><br><span class="line"></span><br><span class="line"># åˆå§‹åŒ–å‚æ•°é€‰æ‹©</span><br><span class="line"># 1. å¦‚æœä½ å½“å‰åœ¨å®¹å™¨æœåŠ¡é›†ç¾¤èŠ‚ç‚¹ä¸Šï¼Œé»˜è®¤å·²ç»æœ‰åˆå§‹åŒ–å®Œæˆçš„ tiller ï¼Œåªéœ€è¦åˆå§‹åŒ– clientã€‚å¯ä»¥ä½¿ç”¨ skip-refresh å‘½ä»¤é¿å…è®¿é—® google Chart æºï¼š</span><br><span class="line">helm init --client-only --skip-refresh</span><br><span class="line"># 2. å¦‚æœä½ å½“å‰åœ¨è‡ªå»ºçš„ Kubernetes é›†ç¾¤èŠ‚ç‚¹ä¸Šï¼Œå¹¶ä¸”å¸Œæœ›é¿å…è®¿é—® google Chart æºï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</span><br><span class="line">helm init --skip-refresh</span><br></pre></td></tr></table></figure><p>éƒ¨ç½²å®Œæˆåhelm versionæŸ¥çœ‹ä¸‹ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">helm version</span><br><span class="line">Client: &amp;version.Version&#123;SemVer:&quot;v2.16.3&quot;, GitCommit:&quot;1ee0254c86d4ed6887327dabed7aa7da29d7eb0d&quot;, GitTreeState:&quot;clean&quot;&#125;</span><br><span class="line">Server: &amp;version.Version&#123;SemVer:&quot;v2.16.3&quot;, GitCommit:&quot;1ee0254c86d4ed6887327dabed7aa7da29d7eb0d&quot;, GitTreeState:&quot;clean&quot;&#125;</span><br></pre></td></tr></table></figure><h1 id="éƒ¨ç½²ç¬¬ä¸€ä¸ªé¡¹ç›®"><a href="#éƒ¨ç½²ç¬¬ä¸€ä¸ªé¡¹ç›®" class="headerlink" title="éƒ¨ç½²ç¬¬ä¸€ä¸ªé¡¹ç›®"></a>éƒ¨ç½²ç¬¬ä¸€ä¸ªé¡¹ç›®</h1><p>å‡†å¤‡æ–‡ä»¶ç›®å½•ï¼Œæ ¼å¼å†…å®¹å¦‚ä¸‹</p><ul><li>ä¸€ä¸ªChart.yamlæ–‡ä»¶ </li><li>ä¸€ä¸ªTemplatesæ–‡ä»¶ç›®å½•(å­˜æ”¾å„ä¸ªk8s objectä¿¡æ¯çš„yamlæ–‡ä»¶) </li><li>ä¸€ä¸ªvalues.yaml </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s ~]# tree</span><br><span class="line">.</span><br><span class="line">â””â”€â”€ demo</span><br><span class="line">    â”œâ”€â”€ Chart.yaml</span><br><span class="line">    â”œâ”€â”€ templates</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ deployment.yaml</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ _helpers.tpl</span><br><span class="line">    â”‚Â Â  â””â”€â”€ service.yaml</span><br><span class="line">    â””â”€â”€ values.yaml</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">éƒ¨ç½²</span><br><span class="line"></span><br><span class="line">helm install -n å®¹å™¨å æ–‡ä»¶ç›®å½•è·¯å¾„  --values valuesæ–‡ä»¶è·¯å¾„ --namespace å‘½åç©ºé—´</span><br><span class="line"></span><br><span class="line">[root@k8s ~]# helm install -n demo .&#x2F;demo&#x2F; --values .&#x2F;demo&#x2F;values.yaml --namespace default</span><br><span class="line"></span><br><span class="line">æ»šåŠ¨æ›´æ–°</span><br><span class="line"></span><br><span class="line">[root@k8s ~]# helm upgrade  demo .&#x2F;demo&#x2F; --values .&#x2F;demo&#x2F;values.yaml --namespace default</span><br><span class="line"></span><br><span class="line">åˆ é™¤å®ä¾‹</span><br><span class="line"></span><br><span class="line">[root@k8s ~]# helm delete demo --purge</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹å®ä¾‹å†å²è®°å½•</span><br><span class="line">[root@k8s ~# helm history demo</span><br><span class="line">REVISIONUPDATED                 STATUS    CHART           APP VERSIONDESCRIPTION     </span><br><span class="line">1       Sun Jun 21 14:46:34 2020SUPERSEDEDdemo-0.1.01.0        Install complete</span><br><span class="line">2       Sun Jun 21 15:20:46 2020DEPLOYED  demo-0.1.01.0        Upgrade complete</span><br></pre></td></tr></table></figure><h1 id="é—®é¢˜è®°å½•"><a href="#é—®é¢˜è®°å½•" class="headerlink" title="é—®é¢˜è®°å½•"></a>é—®é¢˜è®°å½•</h1><h2 id="serverå’Œclientç‰ˆæœ¬ä¸åŒ"><a href="#serverå’Œclientç‰ˆæœ¬ä¸åŒ" class="headerlink" title="serverå’Œclientç‰ˆæœ¬ä¸åŒ"></a>serverå’Œclientç‰ˆæœ¬ä¸åŒ</h2><p>æˆ‘åœ¨ç”Ÿäº§ç¯å¢ƒå®‰è£…æ—¶å‡ºç°äº†serverå’Œclientç‰ˆæœ¬ä¸åŒçš„æƒ…å†µã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@k8snode ~]# helm init --tiller-image registry.cn-hangzhou.aliyuncs.com&#x2F;acs&#x2F;tiller:v2.16.3</span><br><span class="line">Creating &#x2F;root&#x2F;.helm </span><br><span class="line">Creating &#x2F;root&#x2F;.helm&#x2F;repository </span><br><span class="line">Creating &#x2F;root&#x2F;.helm&#x2F;repository&#x2F;cache </span><br><span class="line">Creating &#x2F;root&#x2F;.helm&#x2F;repository&#x2F;local </span><br><span class="line">Creating &#x2F;root&#x2F;.helm&#x2F;plugins </span><br><span class="line">Creating &#x2F;root&#x2F;.helm&#x2F;starters </span><br><span class="line">Creating &#x2F;root&#x2F;.helm&#x2F;cache&#x2F;archive </span><br><span class="line">Creating &#x2F;root&#x2F;.helm&#x2F;repository&#x2F;repositories.yaml </span><br><span class="line">Adding stable repo with URL: https:&#x2F;&#x2F;kubernetes-charts.storage.googleapis.com </span><br><span class="line">Adding local repo with URL: http:&#x2F;&#x2F;127.0.0.1:8879&#x2F;charts </span><br><span class="line">$HELM_HOME has been configured at &#x2F;root&#x2F;.helm.</span><br><span class="line">Warning: Tiller is already installed in the cluster.</span><br><span class="line"></span><br><span class="line">[root@k8snode ~]# helm version</span><br><span class="line">Client: &amp;version.Version&#123;SemVer:&quot;v2.16.3&quot;, GitCommit:&quot;1ee0254c86d4ed6887327dabed7aa7da29d7eb0d&quot;, GitTreeState:&quot;clean&quot;&#125;</span><br><span class="line">Server: &amp;version.Version&#123;SemVer:&quot;v2.14.1&quot;, GitCommit:&quot;5270352a09c7e8b6e8c9593002a73535276507c0&quot;, GitTreeState:&quot;clean&quot;</span><br></pre></td></tr></table></figure><p>æˆ‘è¿˜å¾ˆçº³é—·ä¸ºä»€ä¹ˆæç¤ºTiller is already installed in the cluster.åŸæ¥é˜¿é‡Œäº‘æ‰˜ç®¡å‹K8Så·²ç»è£…äº†tillerï¼Œç„¶åæˆ‘å‚ç…§é˜¿é‡Œäº‘å®˜ç½‘æ–‡æ¡£å‡çº§äº†tillerå³å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@k8snode ~]# helm init --tiller-image registry.cn-hangzhou.aliyuncs.com&#x2F;acs&#x2F;tiller:v2.16.3 --upgrade</span><br><span class="line">$HELM_HOME has been configured at &#x2F;root&#x2F;.helm.</span><br><span class="line"></span><br><span class="line">Tiller (the Helm server-side component) has been updated to registry.cn-hangzhou.aliyuncs.com&#x2F;acs&#x2F;tiller:v2.16.3 .</span><br><span class="line"></span><br><span class="line">[root@k8snode ~]# helm version</span><br><span class="line">Client: &amp;version.Version&#123;SemVer:&quot;v2.16.3&quot;, GitCommit:&quot;1ee0254c86d4ed6887327dabed7aa7da29d7eb0d&quot;, GitTreeState:&quot;clean&quot;&#125;</span><br><span class="line">Server: &amp;version.Version&#123;SemVer:&quot;v2.16.3&quot;, GitCommit:&quot;1ee0254c86d4ed6887327dabed7aa7da29d7eb0d&quot;, GitTreeState:&quot;clean&quot;&#125;</span><br></pre></td></tr></table></figure><h2 id="Helmæ‹‰ä¸åˆ°é˜¿é‡Œäº‘å†…éƒ¨çš„é•œåƒ"><a href="#Helmæ‹‰ä¸åˆ°é˜¿é‡Œäº‘å†…éƒ¨çš„é•œåƒ" class="headerlink" title="Helmæ‹‰ä¸åˆ°é˜¿é‡Œäº‘å†…éƒ¨çš„é•œåƒ"></a>Helmæ‹‰ä¸åˆ°é˜¿é‡Œäº‘å†…éƒ¨çš„é•œåƒ</h2><p>ç¬¬ä¸€ä¸ªé¡¹ç›®å¯åŠ¨å°±æŠ¥é”™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Failed to apply default image tag &quot;registry.cn-beijing.aliyuncs.com&#x2F;xxx&quot;: couldn&#39;t parse image reference &quot;registry.cn-beijing.aliyuncs.com&#x2F;xxx&quot;: invalid reference format</span><br></pre></td></tr></table></figure><p>helmæ‹‰å–é•œåƒçš„æ ¼å¼è¦æ±‚ä¸å¯¹ </p><p>é•œåƒå·åç§°åº”ä¸º testv1è¿™ç§ç±»å‹ ä¸å»ºè®®å¸¦æœ‰ {. / - =} è¿™ç±»å­—ç¬¦</p><h2 id="é˜¿é‡Œäº‘å…å¯†æ’ä»¶"><a href="#é˜¿é‡Œäº‘å…å¯†æ’ä»¶" class="headerlink" title="é˜¿é‡Œäº‘å…å¯†æ’ä»¶"></a>é˜¿é‡Œäº‘å…å¯†æ’ä»¶</h2><p>ç»§ç»­å¯åŠ¨ï¼Œè¿˜æ˜¯æŠ¥é”™ï¼Œæˆ‘æœäº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Back-off pulling image &quot;registry.cn-beijing.aliyuncs.com&#x2F;gyjx&#x2F;blank-demo:2020.6.19-160604-master-2d82100f&quot;</span><br></pre></td></tr></table></figure><p>what the fuck?æˆ‘ç”¨docker pull éƒ½å¯ä»¥ ä¸ºä»€ä¹ˆhelmä¸è¡Œï¼Œåæ¥é—®äº†ä¸‹é˜¿é‡Œäº‘å®¢æœæ‰å‘ç°helmæ˜¯é›†ç¾¤å±‚é¢éœ€è¦é…ç½®è®¤è¯ä¿¡æ¯ï¼Œåªåœ¨èŠ‚ç‚¹ä¸Šloginæ˜¯ä¸è¡Œçš„ï¼Œè€Œä¸”é»˜è®¤çš„æ‹‰å–é•œåƒçš„å‘½åç©ºé—´ä¸ºdefaultï¼Œå¦‚æœéœ€è¦æ‰€æœ‰å‘½åç©ºé—´éƒ½æ‹‰é•œåƒéœ€è¦æ·»åŠ ä¸€ä¸ªé…ç½®é¡¹ã€‚</p><p>é˜¿é‡Œäº‘æœ‰ä¸ªé…ç½®é¡¹å«acr-configuration  ä½äºnamespace=kube-system çš„ConfigMapä¸‹ã€‚</p><p>é…ç½®æ–‡ä»¶æ ¼å¼å¦‚ä¸‹</p><table><thead><tr><th>é…ç½®é¡¹</th><th>é…ç½®é¡¹è¯´æ˜</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>service-account</td><td>ä½¿å…å¯†æ’ä»¶ä½œç”¨äºæŒ‡å®šçš„æœåŠ¡è´¦å·</td><td>default è‹¥è¦é…ç½®å¤šä¸ªè¯·ä»¥é€—å·åˆ†éš”ï¼Œ è‹¥ä¸ºâ€œ*â€ï¼Œ è¡¨ç¤ºæ”¯æŒNamespaceä¸‹çš„æ‰€æœ‰ServiceAccount</td></tr><tr><td>acr-registry-info</td><td>å®¹å™¨é•œåƒçš„å®ä¾‹ä¿¡æ¯æ•°ç»„ï¼Œyamlå¤šè¡Œå­—ç¬¦ä¸²æ ¼å¼ï¼Œæ¯ä¸ªå®ä¾‹ä»¥ä¸‰å…ƒç»„æ–¹å¼é…ç½®ã€‚</td><td>ç©ºï¼Œè¡¨ç¤ºå…å¯†æ‹‰å–æœ¬åœ°Regionçš„é»˜è®¤å®¹å™¨é•œåƒå®ä¾‹ä»“åº“ã€‚</td></tr><tr><td>watch-namespace</td><td>æœŸæœ›èƒ½å…å¯†æ‹‰å–é•œåƒçš„Namespaceã€‚</td><td>default è¯´æ˜ å½“å–å€¼ä¸ºallæ—¶ï¼Œè¡¨ç¤ºæœŸæœ›æ‰€æœ‰Namespaceéƒ½èƒ½å…å¯†æ‹‰å–ã€‚å¦‚æœéœ€è¦é…ç½®å¤šä¸ªNamespaceæ—¶ï¼Œä»¥é€—å·åˆ†éš”ã€‚</td></tr><tr><td>expiring-threshold</td><td>æœ¬åœ°Cache Tokenè¿‡æœŸé˜ˆå€¼ã€‚</td><td>15mï¼ˆå»ºè®®ä½¿ç”¨15mï¼‰ã€‚</td></tr></tbody></table><h2 id="æˆ‘ä¸€å…±æ·»åŠ äº†4å¯¹key-valueåˆ°acr-configuration"><a href="#æˆ‘ä¸€å…±æ·»åŠ äº†4å¯¹key-valueåˆ°acr-configuration" class="headerlink" title="æˆ‘ä¸€å…±æ·»åŠ äº†4å¯¹key-valueåˆ°acr-configuration"></a>æˆ‘ä¸€å…±æ·»åŠ äº†4å¯¹key-valueåˆ°acr-configuration</h2><table><thead><tr><th>key</th><th>value</th></tr></thead><tbody><tr><td>watch-namespace</td><td>all</td></tr><tr><td>expiring-threshold</td><td>15m</td></tr><tr><td>acr-registry-info</td><td>- instanceId: â€œâ€</td></tr><tr><td>service-account</td><td>default</td></tr></tbody></table><p>æ³¨æ„ï¼ï¼ï¼é…ç½®å®Œæˆå</p><p>éœ€è¦å‡çº§ä¸€ä¸ªç»„ä»¶aliyun-acr-credential-helperåˆ°v20.03.16.0-36d5d7e-aliyun</p><p>å¦åˆ™å…å¯†æ’ä»¶çš„é…ç½®ä¸ç”Ÿæ•ˆ</p><h1 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å‘¨æœ«åŠ ç­è¿˜æ˜¯æ¯”è¾ƒæœ‰æ”¶è·çš„ï¼Œæ—¢å­¦ä¹ äº†æ–°çš„çŸ¥è¯†ï¼Œåˆå®Œæˆäº†éƒ¨åˆ†ä¸‹å‘¨ä¸Šçº¿å‰çš„éƒ¨ç½²å‡†å¤‡å·¥ä½œï¼Œå…³äºHelmçš„æ›´å¤šç”¨æ³•å’ŒTemplateçš„æ¨¡æ¿æ„å»ºæˆ‘ä¼šåœ¨åæœŸè¡¥ä¸Šã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://helm.sh/docs/" target="_blank" rel="noopener">Helmå®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://github.com/helm/helm" target="_blank" rel="noopener">Helmé¡¹ç›®è¯´æ˜</a></p><p><a href="https://help.aliyun.com/document_detail/159750.html?spm=a2c4g.11186623.6.578.6cf01f77cZYYiC" target="_blank" rel="noopener">é˜¿é‡Œäº‘ä½¿ç”¨å…å¯†æ’ä»¶æ‹‰å–å®¹å™¨é•œåƒ</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Helm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Helm </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> é˜¿é‡Œäº‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²é«˜å¯ç”¨RocketMQ</title>
      <link href="/2020/06/18/rocketmq/rocketmq-install/"/>
      <url>/2020/06/18/rocketmq/rocketmq-install/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>é˜¿é‡Œäº‘ä¼ä¸šçº§RocketMQè´¹ç”¨è¾ƒé«˜ï¼Œä¸å¦‚è‡ªå»ºMQï¼Œè¿™ä¸ªä»»åŠ¡åˆäº¤ç»™æˆ‘äº†ï¼Œç”±äºæˆ‘æ­£å¥½è®¤è¯†ä¸€ä¸ªRocketMQç¤¾åŒºçš„å¤§ä½¬ï¼Œå‚ä¸MQçš„æ”¹è‰¯ï¼Œæ‰¾å¤§ä½¬å–äº†ä¸‹ç»ã€‚</p><h1 id="RocketMQä»‹ç»"><a href="#RocketMQä»‹ç»" class="headerlink" title="RocketMQä»‹ç»"></a>RocketMQä»‹ç»</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>RocketMQ æ˜¯ä¸€æ¬¾åˆ†å¸ƒå¼ã€é˜Ÿåˆ—æ¨¡å‹çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š </p><p>èƒ½å¤Ÿä¿è¯ä¸¥æ ¼çš„æ¶ˆæ¯é¡ºåº æä¾›ä¸°å¯Œçš„æ¶ˆæ¯æ‹‰å–æ¨¡å¼ é«˜æ•ˆçš„è®¢é˜…è€…æ°´å¹³æ‰©å±•èƒ½åŠ› å®æ—¶çš„æ¶ˆæ¯è®¢é˜…æœºåˆ¶ äº¿çº§æ¶ˆæ¯å †ç§¯èƒ½åŠ› </p><p>é€‰ç”¨ç†ç”±ï¼š </p><ul><li>å¼ºè°ƒé›†ç¾¤æ— å•ç‚¹ï¼Œå¯æ‰©å±•ï¼Œä»»æ„ä¸€ç‚¹é«˜å¯ç”¨ï¼Œæ°´å¹³å¯æ‰©å±•ã€‚ </li><li>æµ·é‡æ¶ˆæ¯å †ç§¯èƒ½åŠ›ï¼Œæ¶ˆæ¯å †ç§¯åï¼Œå†™å…¥ä½å»¶è¿Ÿã€‚ </li><li>æ”¯æŒä¸Šä¸‡ä¸ªé˜Ÿåˆ— </li><li>æ¶ˆæ¯å¤±è´¥é‡è¯•æœºåˆ¶ </li><li>æ¶ˆæ¯å¯æŸ¥è¯¢ </li><li>å¼€æºç¤¾åŒºæ´»è·ƒ </li><li>æˆç†Ÿåº¦ï¼ˆç»è¿‡åŒåä¸€è€ƒéªŒï¼‰ </li></ul><h2 id="å…³é”®æ¦‚å¿µ"><a href="#å…³é”®æ¦‚å¿µ" class="headerlink" title="å…³é”®æ¦‚å¿µ"></a>å…³é”®æ¦‚å¿µ</h2><h3 id="ä¸»é¢˜ä¸æ ‡ç­¾"><a href="#ä¸»é¢˜ä¸æ ‡ç­¾" class="headerlink" title="ä¸»é¢˜ä¸æ ‡ç­¾"></a>ä¸»é¢˜ä¸æ ‡ç­¾</h3><p>ä¸»é¢˜ Tpoicï¼šç¬¬ä¸€çº§æ¶ˆæ¯ç±»å‹ï¼Œä¹¦çš„æ ‡é¢˜ </p><p>æ ‡ç­¾ Tagsï¼šç¬¬äºŒçº§æ¶ˆæ¯ç±»å‹ï¼Œä¹¦çš„ç›®å½•ï¼Œå¯ä»¥åŸºäº Tag åšæ¶ˆæ¯è¿‡æ»¤ </p><p>ä¾‹å¦‚ï¼š </p><ul><li>ä¸»é¢˜ï¼š è®¢å•äº¤æ˜“ </li><li>æ ‡ç­¾ï¼š<br>è®¢å•äº¤æ˜“-åˆ›å»º<br>è®¢å•äº¤æ˜“-ä»˜æ¬¾<br>è®¢å•äº¤æ˜“-å®Œæˆ </li></ul><h3 id="å‘é€ä¸è®¢é˜…ç¾¤ç»„"><a href="#å‘é€ä¸è®¢é˜…ç¾¤ç»„" class="headerlink" title="å‘é€ä¸è®¢é˜…ç¾¤ç»„"></a>å‘é€ä¸è®¢é˜…ç¾¤ç»„</h3><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/RocketMQ/rocketmq.jpg"  alt="rocketmq.jpg"></p><p>ç”Ÿäº§ç»„ï¼šç”¨äºæ¶ˆæ¯çš„å‘é€ã€‚ </p><p>æ¶ˆè´¹ç»„ï¼šç”¨äºæ¶ˆæ¯çš„è®¢é˜…å¤„ç†ã€‚ </p><p>ç”Ÿäº§ç»„å’Œæ¶ˆè´¹ç»„ï¼Œæ–¹ä¾¿æ‰©ç¼©æœºå™¨ï¼Œå¢å‡å¤„ç†èƒ½åŠ›ï¼Œé›†ç¾¤ç»„çš„åå­—ï¼Œç”¨äºæ ‡è®°ç”¨é€”ä¸­çš„ä¸€ å‘˜ã€‚æ¯æ¬¡åªä¼šéšæœºçš„å‘ç»™æ¯ä¸ªé›†ç¾¤ä¸­çš„ä¸€å‘˜ã€‚ </p><h1 id="RocketMQ-é›†ç¾¤æ–¹å¼"><a href="#RocketMQ-é›†ç¾¤æ–¹å¼" class="headerlink" title="RocketMQ é›†ç¾¤æ–¹å¼"></a>RocketMQ é›†ç¾¤æ–¹å¼</h1><p>æ¨èçš„å‡ ç§ Broker é›†ç¾¤éƒ¨ç½²æ–¹å¼ï¼Œè¿™é‡Œçš„ Slave ä¸å¯å†™ï¼Œä½†å¯è¯»ï¼Œç±»ä¼¼äº Mysql ä¸»å¤‡æ–¹å¼ã€‚ </p><h2 id="å•ä¸ª-Master"><a href="#å•ä¸ª-Master" class="headerlink" title="å•ä¸ª Master"></a>å•ä¸ª Master</h2><p>è¿™ç§æ–¹å¼é£é™©è¾ƒå¤§ï¼Œä¸€æ—¦Brokeré‡å¯æˆ–è€…å®•æœºæ—¶ï¼Œä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡ä¸å¯ç”¨ï¼Œä¸å»ºè®®çº¿ä¸Šç¯å¢ƒä½¿ç”¨ã€‚ </p><h2 id="å¤š-Master-æ¨¡å¼"><a href="#å¤š-Master-æ¨¡å¼" class="headerlink" title="å¤š Master æ¨¡å¼"></a>å¤š Master æ¨¡å¼</h2><p>ä¸€ä¸ªé›†ç¾¤æ—  Slaveï¼Œå…¨æ˜¯ Masterï¼Œä¾‹å¦‚ 2 ä¸ª Master æˆ–è€… 3 ä¸ª Master    </p><ul><li>ä¼˜ç‚¹ï¼šé…ç½®ç®€å•ï¼Œå•ä¸ª Master å®•æœºæˆ–é‡å¯ç»´æŠ¤å¯¹åº”ç”¨æ— å½±å“ï¼Œåœ¨ç£ç›˜é…ç½®ä¸º RAID10 æ—¶ï¼Œå³ä½¿æœºå™¨å®•æœºä¸å¯æ¢å¤æƒ…å†µä¸‹ï¼Œç”±ä¸ RAID10 ç£ç›˜éå¸¸å¯é ï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢ï¼ˆå¼‚æ­¥åˆ·ç›˜ä¸¢å¤±å°‘é‡æ¶ˆæ¯ï¼ŒåŒæ­¥åˆ·ç›˜ä¸€æ¡ä¸ä¸¢ï¼‰ã€‚æ€§èƒ½æœ€é«˜ã€‚     </li><li>ç¼ºç‚¹ï¼šå•å°æœºå™¨å®•æœºæœŸé—´ï¼Œè¿™å°æœºå™¨ä¸Šæœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯åœ¨æœºå™¨æ¢å¤ä¹‹å‰ä¸å¯è®¢é˜…ï¼Œæ¶ˆæ¯ å®æ—¶æ€§ä¼šå—åˆ°å—åˆ°å½±å“ã€‚   </li></ul><p>å¯åŠ¨æ–¹å¼ï¼š</p><ul><li>å…ˆå¯åŠ¨ NameServer    </li><li>åœ¨æœºå™¨ Aï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ª Master    </li><li>åœ¨æœºå™¨ Bï¼Œå¯åŠ¨ç¬¬äºŒä¸ª Master </li></ul><h2 id="å¤š-Master-å¤š-Slave-æ¨¡å¼ï¼Œå¼‚æ­¥å¤åˆ¶"><a href="#å¤š-Master-å¤š-Slave-æ¨¡å¼ï¼Œå¼‚æ­¥å¤åˆ¶" class="headerlink" title="å¤š Master å¤š Slave æ¨¡å¼ï¼Œå¼‚æ­¥å¤åˆ¶"></a>å¤š Master å¤š Slave æ¨¡å¼ï¼Œå¼‚æ­¥å¤åˆ¶</h2><p>   æ¯ä¸ª Master é…ç½®ä¸€ä¸ª Slaveï¼Œæœ‰å¤šå¯¹ Master-Slaveï¼ŒHA é‡‡ç”¨å¼‚æ­¥å¤åˆ¶æ–¹å¼ï¼Œä¸»å¤‡æœ‰çŸ­ æš‚æ¶ˆæ¯å»¶è¿Ÿï¼Œæ¯«ç§’çº§ã€‚</p><ul><li>ä¼˜ç‚¹ï¼šå³ä½¿ç£ç›˜æŸåï¼Œæ¶ˆæ¯ä¸¢å¤±çš„éå¸¸å°‘ï¼Œä¸”æ¶ˆæ¯å®æ—¶æ€§ä¸ä¼šå—å½±å“ï¼Œå› ä¸º Master å®• æœºåï¼Œæ¶ˆè´¹è€…ä»ç„¶å¯ä»¥ä» Slave æ¶ˆè´¹ï¼Œæ­¤è¿‡ç¨‹å¯¹åº”ç”¨é€æ˜ã€‚ä¸éœ€è¦äººå·¥å¹²é¢„ã€‚æ€§èƒ½åŒå¤š Master æ¨¡å¼å‡ ä¹ä¸€æ ·ã€‚    </li><li>ç¼ºç‚¹ï¼šMaster å®•æœºï¼Œç£ç›˜æŸåæƒ…å†µï¼Œä¼šä¸¢å¤±å°‘é‡æ¶ˆæ¯ã€‚  </li></ul><p>å¯åŠ¨æ–¹å¼ï¼š</p><ul><li>å…ˆå¯åŠ¨ NameServer    </li><li>åœ¨æœºå™¨ Aï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ª Master   </li><li>åœ¨æœºå™¨ Bï¼Œå¯åŠ¨ç¬¬äºŒä¸ª Master    </li><li>åœ¨æœºå™¨ Cï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ª Slave    </li><li>åœ¨æœºå™¨ Dï¼Œå¯åŠ¨ç¬¬äºŒä¸ª Slave </li></ul><h2 id="å¤š-Master-å¤š-Slave-æ¨¡å¼ï¼ŒåŒæ­¥åŒå†™"><a href="#å¤š-Master-å¤š-Slave-æ¨¡å¼ï¼ŒåŒæ­¥åŒå†™" class="headerlink" title="å¤š Master å¤š Slave æ¨¡å¼ï¼ŒåŒæ­¥åŒå†™"></a>å¤š Master å¤š Slave æ¨¡å¼ï¼ŒåŒæ­¥åŒå†™</h2><p>   æ¯ä¸ª Master é…ç½®ä¸€ä¸ª Slaveï¼Œæœ‰å¤šå¯¹ Master-Slaveï¼ŒHA é‡‡ç”¨åŒæ­¥åŒå†™æ–¹å¼ï¼Œä¸»å¤‡éƒ½å†™ æˆåŠŸï¼Œå‘åº”ç”¨è¿”å›æˆåŠŸã€‚   </p><ul><li>ä¼˜ç‚¹ï¼šæ•°æ®ä¸æœåŠ¡éƒ½æ— å•ç‚¹ï¼ŒMaster å®•æœºæƒ…å†µä¸‹ï¼Œæ¶ˆæ¯æ— å»¶è¿Ÿï¼ŒæœåŠ¡å¯ç”¨æ€§ä¸æ•°æ®å¯ ç”¨æ€§éƒ½éå¸¸é«˜    </li><li>ç¼ºç‚¹ï¼šæ€§èƒ½æ¯”å¼‚æ­¥å¤åˆ¶æ¨¡å¼ç•¥ä½ï¼Œå¤§çº¦ä½ 10%å·¦å³ï¼Œå‘é€å•ä¸ªæ¶ˆæ¯çš„ RT ä¼šç•¥é«˜ã€‚ç›® å‰ä¸»å®•æœºåï¼Œå¤‡æœºä¸èƒ½è‡ªåŠ¨åˆ‡æ¢ä¸ºä¸»æœºï¼Œåç»­ä¼šæ”¯æŒè‡ªåŠ¨åˆ‡æ¢åŠŸèƒ½ã€‚ </li></ul><p>å¯åŠ¨æ–¹å¼ï¼š  </p><ul><li>å…ˆå¯åŠ¨ NameServer    </li><li>åœ¨æœºå™¨ Aï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ª Master    </li><li>åœ¨æœºå™¨ Bï¼Œå¯åŠ¨ç¬¬äºŒä¸ª Master    </li><li>åœ¨æœºå™¨ Cï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ª Slave    </li><li>åœ¨æœºå™¨ Dï¼Œå¯åŠ¨ç¬¬äºŒä¸ª Slave    </li></ul><p>ä»¥ä¸Š Broker ä¸ Slave é…å¯¹æ˜¯é€šè¿‡æŒ‡å®šç›¸åŒçš„ brokerName å‚æ•°æ¥é…å¯¹ï¼ŒMaster çš„ BrokerId å¿…é¡»æ˜¯ 0ï¼ŒSlave çš„ BrokerId å¿…é¡»æ˜¯å¤§ä¸ 0 çš„æ•°ã€‚å¦å¤–ä¸€ä¸ª Master ä¸‹é¢å¯ä»¥æŒ‚ è½½å¤šä¸ª Slaveï¼ŒåŒä¸€ Master ä¸‹çš„å¤šä¸ª Slave é€šè¿‡æŒ‡å®šä¸åŒçš„ BrokerId æ¥åŒºåˆ†ã€‚ </p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>MQæ¯ç§éƒ¨ç½²æ–¹å¼éƒ½æœ‰ä¼˜ç¼ºç‚¹ï¼Œä¸è¿‡æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒçš„ä¸šåŠ¡æ˜¯éœ€è¦å…¨ç¨‹æ— äººå¹²é¢„ï¼Œä¸è€ƒè™‘æ€§èƒ½æƒ…å†µï¼Œå¸Œæœ›MQé«˜å¯ç”¨ï¼Œåšå¥½ç›‘æ§æŠ¥è­¦è§„åˆ™å³å¯ã€‚</p><p>ç»¼ä¸Šæˆ‘é€‰æ‹© å¤š Master å¤š Slave æ¨¡å¼ï¼Œå¼‚æ­¥å¤åˆ¶æ¨¡å¼</p><h1 id="RocketMQéƒ¨ç½²å¼‚æ­¥å¤åˆ¶æ¨¡å¼"><a href="#RocketMQéƒ¨ç½²å¼‚æ­¥å¤åˆ¶æ¨¡å¼" class="headerlink" title="RocketMQéƒ¨ç½²å¼‚æ­¥å¤åˆ¶æ¨¡å¼"></a>RocketMQéƒ¨ç½²å¼‚æ­¥å¤åˆ¶æ¨¡å¼</h1><p>éƒ¨ç½²ç¯å¢ƒåŒä¸»åŒä»å¼‚æ­¥å¤åˆ¶ï¼Œç”±äºç”Ÿäº§ç¯å¢ƒæœºå™¨åªé…å¤‡äº†2å°é«˜æ€§èƒ½ä¸»æœºï¼Œ16c 32gï¼Œæˆ‘å‡†å¤‡åšä¸€ä¸ªä¼ªé›†ç¾¤ã€‚</p><h2 id="æœåŠ¡å™¨ç¯å¢ƒ"><a href="#æœåŠ¡å™¨ç¯å¢ƒ" class="headerlink" title="æœåŠ¡å™¨ç¯å¢ƒ"></a>æœåŠ¡å™¨ç¯å¢ƒ</h2><table><thead><tr><th>IP</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>172.31.26.22</td><td>nameServer1,broker-a,broker-b-slave</td></tr><tr><td>172.31.26.23</td><td>nameServer2,broker-b,broker-a-slave</td></tr></tbody></table><h2 id="å®‰è£…ç¯å¢ƒ"><a href="#å®‰è£…ç¯å¢ƒ" class="headerlink" title="å®‰è£…ç¯å¢ƒ"></a>å®‰è£…ç¯å¢ƒ</h2><table><thead><tr><th>éœ€æ±‚</th><th>ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>æ“ä½œç³»ç»Ÿ</td><td>centos7.6</td></tr><tr><td>JDK</td><td>1.8</td></tr><tr><td>RocketMQç‰ˆæœ¬</td><td>rocketmq-all-4.3.2-bin-release.zip</td></tr><tr><td>RocketMQæ§åˆ¶å°</td><td>rocketmq-console-ng-1.0.0.jar</td></tr><tr><td>RocketMQç›®å½•</td><td>/opt</td></tr><tr><td>RocketMQæ—¥å¿—</td><td>/opt/rocketmq-all-4.3.2-bin-release/logs/</td></tr><tr><td>æ—¶é—´åŒæ­¥</td><td>ntpdate ntp1.aliyun.com</td></tr></tbody></table><p>MQå®‰è£…åŒ…åŠæ§åˆ¶å°é“¾æ¥å¦‚ä¸‹ï¼š</p><p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1QOv2deLsczD4QYXxQc1Juw" target="_blank" rel="noopener">https://pan.baidu.com/s/1QOv2deLsczD4QYXxQc1Juw</a><br>æå–ç ï¼šjui6</p><h2 id="éƒ¨ç½²è¿‡ç¨‹"><a href="#éƒ¨ç½²è¿‡ç¨‹" class="headerlink" title="éƒ¨ç½²è¿‡ç¨‹"></a>éƒ¨ç½²è¿‡ç¨‹</h2><p>å°†rocketmq-all-4.3.2-bin-release.zipã€rocketmq-console-ng-1.0.0.jaræ”¾åˆ°ä»»æ„ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œé…ç½®å®Œæˆç„¶ååˆ†å‘åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šå³å¯ã€‚</p><h3 id="è§£å‹"><a href="#è§£å‹" class="headerlink" title="è§£å‹"></a>è§£å‹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-26-22 ~]# cd &#x2F;opt&#x2F;</span><br><span class="line">[root@VM-26-22 ~]# unzip rocketmq-all-4.3.2-bin-release.zip</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹jvmå¯åŠ¨å‚æ•°"><a href="#ä¿®æ”¹jvmå¯åŠ¨å‚æ•°" class="headerlink" title="ä¿®æ”¹jvmå¯åŠ¨å‚æ•°"></a>ä¿®æ”¹jvmå¯åŠ¨å‚æ•°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-26-22 ~]# cd &#x2F;opt&#x2F;rocketmq-all-4.3.2-bin-release&#x2F;bin</span><br><span class="line">[root@VM-26-22 bin]# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ cachedog.sh</span><br><span class="line">â”œâ”€â”€ cleancache.sh</span><br><span class="line">â”œâ”€â”€ cleancache.v1.sh</span><br><span class="line">â”œâ”€â”€ mqadmin</span><br><span class="line">â”œâ”€â”€ mqadmin.cmd</span><br><span class="line">â”œâ”€â”€ mqadmin.xml</span><br><span class="line">â”œâ”€â”€ mqbroker</span><br><span class="line">â”œâ”€â”€ mqbroker.cmd</span><br><span class="line">â”œâ”€â”€ mqbroker.numanode0</span><br><span class="line">â”œâ”€â”€ mqbroker.numanode1</span><br><span class="line">â”œâ”€â”€ mqbroker.numanode2</span><br><span class="line">â”œâ”€â”€ mqbroker.numanode3</span><br><span class="line">â”œâ”€â”€ mqbroker.xml</span><br><span class="line">â”œâ”€â”€ mqnamesrv</span><br><span class="line">â”œâ”€â”€ mqnamesrv.cmd</span><br><span class="line">â”œâ”€â”€ mqnamesrv.xml</span><br><span class="line">â”œâ”€â”€ mqshutdown</span><br><span class="line">â”œâ”€â”€ mqshutdown.cmd</span><br><span class="line">â”œâ”€â”€ os.sh</span><br><span class="line">â”œâ”€â”€ play.cmd</span><br><span class="line">â”œâ”€â”€ play.sh</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ runbroker.cmd</span><br><span class="line">â”œâ”€â”€ runbroker.sh</span><br><span class="line">â”œâ”€â”€ runserver.cmd</span><br><span class="line">â”œâ”€â”€ runserver.sh</span><br><span class="line">â”œâ”€â”€ setcache.sh</span><br><span class="line">â”œâ”€â”€ startfsrv.sh</span><br><span class="line">â”œâ”€â”€ tools.cmd</span><br><span class="line">â””â”€â”€ tools.sh</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ° runserver.sh å’Œbroker.sh<br>æŸ¥çœ‹ç³»ç»Ÿå‚æ•°</p><p>ç”±äºæˆ‘ä¸å¤ªæ‡‚jvmè°ƒä¼˜ï¼Œä½†æ˜¯å¤§ä½¬è¯´32gçš„æœºå™¨è¿è¡Œ1ä¸ªnamesrvå’Œ2ä¸ªborkerå°±å¯ä»¥ç”¨å®˜æ–¹è‡ªå¸¦çš„é…ç½®ï¼Œä¸è¿‡ä»¥åæˆ‘å¯¹è¿™ä¸ªå‚æ•°è°ƒä¼˜ä¼šç ”ç©¶ä¸€ä¸‹ï¼Œå…ˆè¿™ä¹ˆè£…å§ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim runserver.sh</span><br><span class="line">-server -Xms4g -Xmx4g -Xmn2g</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim runbroker.sh</span><br><span class="line">-server -Xms8g -Xmx8g -Xmn4g</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹broker-conf"><a href="#ä¿®æ”¹broker-conf" class="headerlink" title="ä¿®æ”¹broker.conf"></a>ä¿®æ”¹broker.conf</h3><p>ä¸€å…±æœ‰4ä¸ªé…ç½®æ–‡ä»¶ï¼Œç°åœ¨æˆ‘ä»¬ä¸€æ¬¡æ€§é…ç½®å¥½,ç”±äºæœ‰ä¸€äº›é»˜è®¤é…ç½®ï¼Œä¸éœ€è¦ä¿®æ”¹çš„æˆ‘å°±æ²¡æœ‰åˆ—ä¸Šï¼Œå¦‚æœå¯¹æ¶ˆæ¯é˜Ÿåˆ—è‡ªåŠ¨å¼€å¯topicåŠè°ƒæ•´æ¶ˆæ¯å¤§å°ç­‰æœ‰è¦æ±‚å¯ä»¥è‡ªè¡Œç™¾åº¦æ·»åŠ è¿™äº›å‚æ•°ã€‚</p><p>ä¸‹é¢çš„é…ç½®çš„IPæ ¹æ®å®é™…IPæ›¿æ¢å³å¯</p><p>æ³¨æ„ï¼šæœ¬é…ç½®é»˜è®¤ä¸è‡ªåŠ¨åˆ›å»ºtopicï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-26-22 ~]# cd &#x2F;opt&#x2F;rocketmq-all-4.3.2-bin-release&#x2F;conf&#x2F;2m-2s-async</span><br><span class="line">[root@VM-26-22 2m-2s-async]# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ broker-a.properties</span><br><span class="line">â”œâ”€â”€ broker-a-s.properties</span><br><span class="line">â”œâ”€â”€ broker-b.properties</span><br><span class="line">â””â”€â”€ broker-b-s.properties</span><br></pre></td></tr></table></figure><hr><p>ä¸»èŠ‚ç‚¹brokeré…ç½®</p><p>vim broker-a.properties</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">brokerClusterName&#x3D;DefaultCluster</span><br><span class="line">#brokeråå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ ·</span><br><span class="line">brokerName&#x3D;broker-a</span><br><span class="line">brokerIP1&#x3D;172.31.26.22</span><br><span class="line">#nameServer åœ°å€ï¼Œåˆ†å·åˆ†å‰² </span><br><span class="line">namesrvAddr&#x3D;172.31.26.22:9876;172.31.26.23:9876 </span><br><span class="line">#0 è¡¨ç¤º Masterï¼Œ&gt;0 è¡¨ç¤º Slave </span><br><span class="line">brokerId&#x3D;0 </span><br><span class="line">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£</span><br><span class="line">listenPort&#x3D;10911 </span><br><span class="line">#åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4 ç‚¹ </span><br><span class="line">deleteWhen&#x3D;04 </span><br><span class="line">#æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶ </span><br><span class="line">fileReservedTime&#x3D;24</span><br><span class="line">#å­˜å‚¨è·¯å¾„ </span><br><span class="line">storePathRootDir&#x3D;&#x2F;opt&#x2F;rocketmq-all-4.3.2-bin-release&#x2F;store-a </span><br><span class="line">#Brokerçš„è§’è‰²</span><br><span class="line">brokerRole&#x3D;Master </span><br><span class="line">#åˆ·ç›˜æ–¹å¼  ASYNC_FLUSH  å¼‚æ­¥åˆ·ç›˜  SYNC_FLUSH  åŒæ­¥åˆ·ç›˜ </span><br><span class="line">flushDiskType&#x3D;ASYNC_FLUSH</span><br></pre></td></tr></table></figure><p>vim broker-b.properties</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">brokerClusterName&#x3D;DefaultCluster</span><br><span class="line">brokerName&#x3D;broker-b</span><br><span class="line">brokerIP1&#x3D;172.31.26.23</span><br><span class="line">namesrvAddr&#x3D;172.31.26.22:9876;172.31.26.23:9876 </span><br><span class="line">brokerId&#x3D;0</span><br><span class="line">deleteWhen&#x3D;04</span><br><span class="line">fileReservedTime&#x3D;24</span><br><span class="line">brokerRole&#x3D;Master</span><br><span class="line">flushDiskType&#x3D;ASYNC_FLUSH</span><br><span class="line">listenPort&#x3D;10911</span><br><span class="line">storePathRootDir&#x3D;&#x2F;opt&#x2F;rocketmq-all-4.3.2-bin-release&#x2F;store-b</span><br></pre></td></tr></table></figure><hr><p>ä»èŠ‚ç‚¹brokeré…ç½®</p><p>vim broker-a-s.properties</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">brokerClusterName&#x3D;DefaultCluster</span><br><span class="line">brokerIP1&#x3D;172.31.26.23</span><br><span class="line">namesrvAddr&#x3D;172.31.26.22:9876;172.31.26.23:9876 </span><br><span class="line">brokerName&#x3D;broker-a</span><br><span class="line">brokerId&#x3D;1</span><br><span class="line">deleteWhen&#x3D;04</span><br><span class="line">fileReservedTime&#x3D;24</span><br><span class="line">brokerRole &#x3D; SLAVE</span><br><span class="line">flushDiskType&#x3D;ASYNC_FLUSH</span><br><span class="line">listenPort&#x3D;10921</span><br><span class="line">storePathRootDir&#x3D;&#x2F;opt&#x2F;rocketmq-all-4.3.2-bin-release&#x2F;store-a</span><br></pre></td></tr></table></figure><p>vim broker-b-s.properties</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">brokerClusterName&#x3D;DefaultCluster</span><br><span class="line">brokerIP1&#x3D;172.31.26.22</span><br><span class="line">namesrvAddr&#x3D;172.31.26.22:9876;172.31.26.23:9876 </span><br><span class="line">brokerName&#x3D;broker-b</span><br><span class="line">brokerId&#x3D;1</span><br><span class="line">deleteWhen&#x3D;04</span><br><span class="line">fileReservedTime&#x3D;24</span><br><span class="line">brokerRole &#x3D; SLAVE</span><br><span class="line">flushDiskType&#x3D;ASYNC_FLUSH</span><br><span class="line">listenPort&#x3D;10921</span><br><span class="line">storePathRootDir&#x3D;&#x2F;opt&#x2F;rocketmq-all-4.3.2-bin-release&#x2F;store-b</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºæ—¥å¿—ç›®å½•å¹¶åˆ†å‘"><a href="#åˆ›å»ºæ—¥å¿—ç›®å½•å¹¶åˆ†å‘" class="headerlink" title="åˆ›å»ºæ—¥å¿—ç›®å½•å¹¶åˆ†å‘"></a>åˆ›å»ºæ—¥å¿—ç›®å½•å¹¶åˆ†å‘</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-26-22 ~]#cd &#x2F;opt&#x2F;rocketmq-all-4.3.2-bin-release&#x2F;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œæˆåå°†mqæ‰€æœ‰æ–‡ä»¶å¤¹æ‹·åˆ°æ¯ä¸€å°æœåŠ¡å™¨ä¸Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-26-22 ~]#scp -r &#x2F;opt&#x2F;rocketmq-all-4.3.2-bin-release  root@172.31.26.23:&#x2F;opt&#x2F;</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p>å¯åŠ¨æ–¹å¼å‚è€ƒä¸Šé¢æ‰€è¯´çš„,ç”±äºéƒ¨ç½²æ–¹å¼æ˜¯ä¼ªé›†ç¾¤ï¼Œæ‰€ä»¥å°†æœºå™¨Cã€Dçš„ä»èŠ‚ç‚¹æ”¾åˆ°Bã€Aæœºå™¨ä¸Šè¿è¡Œã€‚</p><ul><li>å…ˆå¯åŠ¨ 172.31.26.22ã€172.31.26.23çš„NameServer    </li><li>åœ¨æœºå™¨ 172.31.26.22ï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ª broker-a   </li><li>åœ¨æœºå™¨ 172.31.26.23ï¼Œå¯åŠ¨ç¬¬äºŒä¸ª broker-b    </li><li>åœ¨æœºå™¨ 172.31.26.23ï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ª broker-a-s    </li><li>åœ¨æœºå™¨ 172.31.26.22ï¼Œå¯åŠ¨ç¬¬äºŒä¸ª broker-b-s </li><li>åœ¨æœºå™¨ 172.31.26.22ï¼Œå¯åŠ¨rocketmq-console-ng-1.0.0.jar</li></ul><p>å…ˆè¿›å…¥2å°æœåŠ¡å™¨åˆ†åˆ«å¯åŠ¨NameServer </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;opt&#x2F;rocketmq-all-4.3.2-bin-release&#x2F;bin</span><br><span class="line">nohup sh mqnamesrv &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><p>åœ¨æœºå™¨172.31.26.22 æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;opt&#x2F;rocketmq-all-4.3.2-bin-release&#x2F;bin</span><br><span class="line">nohup sh mqbroker -c ..&#x2F;conf&#x2F;2m-2s-async&#x2F;broker-a.properties -n&quot;172.31.26.22:9876;172.31.26.23:9876&quot; &gt; ..&#x2F;logs&#x2F;broker-a.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><p>åœ¨æœºå™¨172.31.26.23 æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;opt&#x2F;rocketmq-all-4.3.2-bin-release&#x2F;bin</span><br><span class="line">nohup sh mqbroker -c ..&#x2F;conf&#x2F;2m-2s-async&#x2F;broker-b.properties -n&quot;172.31.26.22:9876;172.31.26.23:9876&quot; &gt; ..&#x2F;logs&#x2F;broker-b.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><p>åœ¨æœºå™¨172.31.26.23 æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;opt&#x2F;rocketmq-all-4.3.2-bin-release&#x2F;bin</span><br><span class="line">nohup sh mqbroker -c ..&#x2F;conf&#x2F;2m-2s-async&#x2F;broker-a-s.properties -n&quot;172.31.26.22:9876;172.31.26.23:9876&quot; &gt; ..&#x2F;logs&#x2F;broker-a.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><p>åœ¨æœºå™¨172.31.26.22 æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;opt&#x2F;rocketmq-all-4.3.2-bin-release&#x2F;bin</span><br><span class="line">nohup sh mqbroker -c ..&#x2F;conf&#x2F;2m-2s-async&#x2F;broker-b-s.properties -n&quot;172.31.26.22:9876;172.31.26.23:9876&quot; &gt; ..&#x2F;logs&#x2F;broker-b.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><p>åœ¨æœºå™¨172.31.26.22 æ‰¾åˆ°rocketmq-console-ng-1.0.0.jarçš„ç›®å½• æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup java -jar rocketmq-console-ng-1.0.0.jar --server.port&#x3D;8080 --rocketmq.config.namesrvAddr&#x3D;&#39;172.31.26.22:9876;172.31.26.23:9876&#39; &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆæ‰“å¼€ <a href="http://172.31.26.22:8080" target="_blank" rel="noopener">http://172.31.26.22:8080</a> å³å¯çœ‹åˆ°MQæ§åˆ¶å°<br><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/RocketMQ/rocketmq-console.jpg"  alt="rocketmq-console.jpg"></p><h1 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è‡³æ­¤ç”Ÿäº§ç¯å¢ƒMQæ­å»ºå®Œæˆï¼Œæœ¬ç¯‡è¿˜æœ‰å‚æ•°è°ƒä¼˜çš„æ–¹é¢æ²¡æœ‰ä»‹ç»ï¼Œè€Œä¸”éƒ¨ç½²æ–¹å¼ä¹Ÿæ˜¯ä¼ªé›†ç¾¤ï¼Œä¸æ˜¯çœŸæ­£çš„é«˜å¯ç”¨ï¼Œå¦‚æœæœ‰èµ„æºçš„è¯æœ€å¥½æ¯å°æœºå™¨éƒ½éƒ¨ç½²ä¸€ä¸ªbrokerï¼Œæœ€åé™„ä¸Šå¤§ä½¬åšå®¢ï¼Œåœ¨æ­¤æ„Ÿè°¢ã€‚</p><p><a href="http://wuwenliang.net/" target="_blank" rel="noopener">http://wuwenliang.net/</a></p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="http://wuwenliang.net/2019/01/09/%E8%B7%9F%E6%88%91%E5%AD%A6RocketMQ-1-1-%E4%B9%8B%E5%AE%89%E8%A3%85RocketMQ/" target="_blank" rel="noopener">è·Ÿæˆ‘å­¦RocketMQ</a></p><p><a href="https://rocketmq.apache.org/docs/quick-start/" target="_blank" rel="noopener">Apache-RocketMQ</a></p><p><a href="https://github.com/apache/rocketmq/tree/master/docs/cn" target="_blank" rel="noopener">Github-RocketMQ</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> RocketMQ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RocketMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éƒ¨ç½²Mysqlç›‘æ§å·¥å…·pmm</title>
      <link href="/2020/06/18/mysql/mysql-pmm/"/>
      <url>/2020/06/18/mysql/mysql-pmm/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æµ‹è¯•äººå‘˜éœ€è¦å¯¹é¡¹ç›®è¿›è¡Œå‹æµ‹ï¼Œæœ‰éœ€æ±‚æŸ¥çœ‹mysqlåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹å„ä¸ªæŒ‡æ ‡æ•°æ®ï¼Œæˆ‘é—®äº†ä¸‹å…¬å¸çš„dbaï¼Œæ¨èpmmè¿™ä¸ªå·¥å…·</p><h1 id="è¦æ±‚"><a href="#è¦æ±‚" class="headerlink" title="è¦æ±‚"></a>è¦æ±‚</h1><ul><li>mysqlæœåŠ¡ç«¯éœ€è¦ä»¥ä¸‹è¦æ±‚ï¼š</li></ul><p>centosï¼š7.6</p><p>mysql:5.7.28</p><p>å‡è®¾ipæ˜¯172.31.26.11</p><ul><li>grafanaæœåŠ¡å™¨éœ€è¦ä»¥ä¸‹è¦æ±‚</li></ul><p>centosï¼š7.6</p><p>dockerï¼š19.03</p><p>å‡è®¾ipæ˜¯172.31.26.12</p><p>å»ºè®®grafanaå’ŒmysqlæœåŠ¡ç«¯æ”¾åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œå› ä¸ºä¸€ä¸ªgrafanaå¯ä»¥ç›‘æ§å¥½å‡ ä¸ªmysqlæœåŠ¡ç«¯æŒ‡æ ‡</p><h1 id="å®‰è£…grafanaæœåŠ¡å™¨"><a href="#å®‰è£…grafanaæœåŠ¡å™¨" class="headerlink" title="å®‰è£…grafanaæœåŠ¡å™¨"></a>å®‰è£…grafanaæœåŠ¡å™¨</h1><p>ä¸€å…±å°±3æ­¥</p><p>æ‹‰é•œåƒ</p><p>åˆ›å»ºæŒä¹…åŒ–å­˜å‚¨å·</p><p>åˆ›å»ºå®¹å™¨çš„è¿è¡Œå®ä¾‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker  pull  percona&#x2F;pmm-server:latest</span><br><span class="line">docker  create -v &#x2F;opt&#x2F;prometheus&#x2F;data -v &#x2F;opt&#x2F;consul-data -v &#x2F;var&#x2F;lib&#x2F;mysql  -v &#x2F;var&#x2F;lib&#x2F;grafana --name  pmm-data   percona&#x2F;pmm-server:latest  &#x2F;bin&#x2F;true</span><br><span class="line">docker  run  -d -p 80:80 --volumes-from pmm-data --name pmm-server --restart always  percona&#x2F;pmm-server:latest</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ›å»ºå®¹å™¨çš„æ—¶å€™è¦è€ƒè™‘åˆ°80ç«¯å£æ˜¯å¦è¢«å ç”¨</p><h1 id="å®‰è£…perconaåˆ°mysqlæœåŠ¡ç«¯"><a href="#å®‰è£…perconaåˆ°mysqlæœåŠ¡ç«¯" class="headerlink" title="å®‰è£…perconaåˆ°mysqlæœåŠ¡ç«¯"></a>å®‰è£…perconaåˆ°mysqlæœåŠ¡ç«¯</h1><p>ä¸‹è½½perconaåˆ°mysqlæœåŠ¡ç«¯ï¼Œå¦‚æœæœ‰å¤šä¸ªmysqlæœåŠ¡ç«¯ï¼Œéœ€è¦æ¯ä¸ªéƒ½å®‰è£…percona</p><p>pmm-admin config  â€“server æŒ‡å‘grafanaæœåŠ¡å™¨çš„ip</p><p>â€“client-name æ·»åŠ ä½ çš„ä¸»æœºåï¼Œå¦‚æœä¸å®šä¹‰å°±æ˜¯æœ¬æœºçš„hostname</p><p>pmm-admin  add æŒ‡å‘æœ¬æœºï¼ˆmysqlæœåŠ¡ç«¯ï¼‰ip</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;www.percona.com&#x2F;downloads&#x2F;pmm-client&#x2F;pmm-client-1.1.1&#x2F;binary&#x2F;tarball&#x2F;pmm-client-1.1.1.tar.gz</span><br><span class="line">tar -zxvf pmm-client-1.1.1.tar.gz</span><br><span class="line">cd pmm-client-1.1.1</span><br><span class="line">.&#x2F;install</span><br><span class="line">pmm-admin config  --server 172.31.26.12 --client-name dev-mysql </span><br><span class="line">pmm-admin  add  mysql  --user  root  --password  &#39;123456&#39;    --host  172.31.26.11 --port  3306</span><br></pre></td></tr></table></figure><p>æ·»åŠ å®Œæˆåæ‰“å¼€<a href="http://172.31.26.12:80" target="_blank" rel="noopener">http://172.31.26.12:80</a></p><p>é€‰æ‹©Mysql Overviewçœ‹Mysqlç›‘æ§å¤§ç›˜å³å¯</p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Mysql/pmm/pmm.jpg"  alt="pmm.jpg"></p><h1 id="æŠ¥é”™"><a href="#æŠ¥é”™" class="headerlink" title="æŠ¥é”™"></a>æŠ¥é”™</h1><p>åœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™æŠ¥é”™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker  run  -d -p 80:80 --volumes-from pmm-data --name pmm-server --restart always  percona&#x2F;pmm-server:latest  </span><br><span class="line">e6b329a2617e13ab96d7a3a99716e1c61a2680b26682a71d1631bc17828ec739</span><br><span class="line">docker: Error response from daemon: driver failed programming external connectivity on endpoint pmm-server (7cd37db8f2b05e9232058ded5237c7e5tables --wait -t nat -A DOCKER -p tcp -d 0&#x2F;0 --dport 80 -j DNAT --to-destination 172.17.0.4:80 ! -i docker0: iptables: No chain&#x2F;target&#x2F;match</span><br><span class="line"> (exit status 1)).</span><br></pre></td></tr></table></figure><p>ç™¾åº¦äº†ä¸€ä¸‹ï¼Œå¤§æ¦‚åŸå› å°±æ˜¯ä½¿ç”¨çš„centos7æœåŠ¡å™¨ï¼Œåœ¨éƒ¨ç½²dockerçš„è¿‡ç¨‹ä¸­ï¼Œå› ç«¯å£é—®é¢˜æœ‰å¯åœfirewalldæœåŠ¡ï¼Œåœ¨centos7é‡Œä½¿ç”¨firewalldä»£æ›¿äº†iptablesã€‚åœ¨å¯åŠ¨firewalldä¹‹åï¼Œiptablesè¿˜ä¼šè¢«ä½¿ç”¨ï¼Œå±äºå¼•ç”¨çš„å…³ç³»ã€‚æ‰€ä»¥åœ¨docker runçš„æ—¶å€™ï¼Œiptables listé‡Œæ²¡æœ‰docker chainï¼Œé‡å¯docker engineæœåŠ¡åä¼šè¢«åŠ å…¥åˆ°iptables listé‡Œé¢ã€‚ï¼ˆæœ‰å¿…è¦æ·±å…¥ç ”ç©¶ä¸€ä¸‹docker networkï¼‰</p><hr><p>è§£å†³æ–¹æ³•</p><p>å¤§éƒ¨åˆ†è¯´éƒ½æ˜¯é‡å¯dockerï¼Œæˆ‘æ„Ÿè§‰å¾ˆä¸é è°±ï¼Œå¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œè°æ•¢é‡å¯dockerå•Šï¼Œç„¶åå†æ‰¾äº†ä¸€ä¸‹dockerå®˜ç½‘çš„æ’é”™æŒ‡å—ï¼Œå‘ç°äº†è¿™ä¸ªé—®é¢˜ã€‚</p><p>ç­”æ¡ˆç‰¹åˆ«ç®€å•,å¾ˆæœ‰å¯èƒ½ä½ æ„è§å…³é—­äº†é˜²ç«å¢™ï¼Œé‚£ä¹ˆæ‰“å¼€åå†æ‰§è¡Œåˆ›å»ºå®¹å™¨çš„å‘½ä»¤,åˆ›å»ºæˆåŠŸå†å…³é—­é˜²ç«å¢™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl start firewalld</span><br><span class="line">[root@localhost ~]# docker  run  -d -p 80:80 --volumes-from pmm-data --name pmm-server --restart always  percona&#x2F;pmm-server:latest  </span><br><span class="line">e6b329a2617e13ab96d7a3a99716e1c61a2680b26682a71d1631bc17828ec739</span><br><span class="line">[root@localhost ~]# systemctl stop firewalld</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p> <a href="https://success.docker.com/article/iptables-error-when-starting-container-with-docker-run" target="_blank" rel="noopener">iptables error when starting container with docker</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
            <tag> Pmm </tag>
            
            <tag> Grafana </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kuberneteså¯è§†åŒ–ç•Œé¢åŠç›‘æ§å®‰è£…</title>
      <link href="/2020/06/17/kubernetes/Kubernetes-dashboard/"/>
      <url>/2020/06/17/kubernetes/Kubernetes-dashboard/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åˆšåˆšéƒ¨ç½²å®Œå‹æµ‹ç¯å¢ƒkubernertes(ä»¥ä¸‹ç®€ç§°k8s),æµ‹è¯•äººå‘˜éœ€è¦å¯¹é¡¹ç›®è¿›è¡Œå‹æµ‹ï¼Œæˆ‘éœ€è¦ç»„è£…ä¸€ä¸ªç›‘æ§ç³»ç»Ÿå¸®åŠ©æµ‹è¯•äººå‘˜æ›´å¥½åœ°æµ‹è¯•ä¸ªé¡¹ç›®æ€§èƒ½ï¼Œç™¾åº¦äº†å¾ˆå¤šæ–¹æ¡ˆï¼Œç›®å‰é€‰æ‹©äº†Kubernetes-dashboard+heapster+influxdb+grafanaè¿™ç§æ–¹æ¡ˆã€‚</p><h1 id="è¦æ±‚è¯´æ˜"><a href="#è¦æ±‚è¯´æ˜" class="headerlink" title="è¦æ±‚è¯´æ˜"></a>è¦æ±‚è¯´æ˜</h1><table><thead><tr><th>é¡¹ç›®</th><th>ç‰ˆæœ¬å·</th><th>targetPort</th><th>nodePort</th></tr></thead><tbody><tr><td>kubernetes</td><td>1.15</td><td></td><td></td></tr><tr><td>kubernetes-dashboard</td><td>v1.10.1</td><td>9090</td><td>32666</td></tr><tr><td>heapster-amd64</td><td>v1.5.4</td><td>8082</td><td></td></tr><tr><td>heapster-grafana-amd64</td><td>v5.0.4</td><td>3000</td><td>31234</td></tr><tr><td>heapster-influxdb-amd64</td><td>v1.5.2</td><td>8086</td><td>30444</td></tr></tbody></table><p>ç¡®ä¿nodeportåœ¨æ•´ä¸ªk8sé›†ç¾¤å†…å”¯ä¸€ï¼Œç‰ˆæœ¬å·k8så’Œkubernetes-dashboard æœ‰ä¸€äº›å¯¹åº”å…³ç³»</p><p>kubernetes-dashboardçš„è¿™ä¸ªç‰ˆæœ¬æˆ‘æ²¡æœ‰åšæƒé™æ§åˆ¶ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œå¦‚æœéœ€è¦</p><p>heapster-grafana-amd64 æ˜¯ä¸ºäº†è¿›ä¸€æ­¥ç›‘æ§æ¯ä¸ªå®¹å™¨çš„cpuã€å†…å­˜ç­‰æ›´ä¸ºå…·ä½“çš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœä½ åªéœ€è¦kubernetes-dashboardçš„åŸºç¡€ç›‘æ§ï¼ˆé¡µé¢ä¸Šç›´è§‚çœ‹åˆ°ï¼‰é‚£ä¹ˆåªç”¨è£…heapster-influxdb-amd64å’Œheapster-amd64</p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><h2 id="Kubernetes-dashboard"><a href="#Kubernetes-dashboard" class="headerlink" title="Kubernetes-dashboard"></a>Kubernetes-dashboard</h2><p>Kubernetes Dashboard æ˜¯ Kubernetes é›†ç¾¤çš„åŸºäº Web çš„é€šç”¨ UIã€‚å®ƒå…è®¸ç”¨æˆ·ç®¡ç†åœ¨ç¾¤é›†ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºå¹¶å¯¹å…¶è¿›è¡Œæ•…éšœæ’é™¤ï¼Œä»¥åŠç®¡ç†ç¾¤é›†æœ¬èº«ã€‚</p><p>ç”±äºKubernetes APIç‰ˆæœ¬ä¹‹é—´çš„é‡å¤§æ›´æ”¹ï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½æ— æ³•åœ¨ä»ªè¡¨æ¿ä¸­æ­£å¸¸è¿è¡Œï¼Œè¿™ä¹Ÿå¯¼è‡´äº†kubernetes-dashboardçš„å…¼å®¹æ€§é—®é¢˜æ¯”è¾ƒä¸¥é‡ï¼Œæœ€å¥½ä¸€ä¸ªç‰ˆæœ¬ä½¿ç”¨ä¸€ä¸ªç‰ˆæœ¬æœ€ç¨³å®šçš„dashboardã€‚</p><p>æ¯”å¦‚kubernetes-dashboard æ–°ç‰ˆæœ¬ï¼šv2.0.0 å…¼å®¹ Kubernetes ç‰ˆæœ¬ï¼š1.18ä»¥ä¸Šï¼Œå¯¹ä»¥ä¸‹çš„ç‰ˆæœ¬ä¸å…¼å®¹ã€‚</p><p>å¦‚æœæƒ³å®‰è£…é«˜ç‰ˆæœ¬å¯ä»¥çœ‹ <a href="https://blog.csdn.net/baidu_38432732/article/details/105741967?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase" target="_blank" rel="noopener">Kubernetes éƒ¨ç½² Kubernetes-Dashboard v2.0.0</a></p><p>è€Œæœ¬æ–‡kubernetes-dashboardï¼šv1.10.1 å…¼å®¹ kubernetesï¼š1.15ç‰ˆæœ¬</p><h2 id="Heapster"><a href="#Heapster" class="headerlink" title="Heapster"></a>Heapster</h2><p>Heapsteræ˜¯å®¹å™¨é›†ç¾¤ç›‘æ§å’Œæ€§èƒ½åˆ†æå·¥å…·ï¼Œå¤©ç„¶çš„æ”¯æŒKuberneteså’ŒCoreOSã€‚</p><p>Kubernetesæœ‰ä¸ªå‡ºåçš„ç›‘æ§agentâ€”cAdvisorã€‚åœ¨æ¯ä¸ªkubernetes Nodeä¸Šéƒ½ä¼šè¿è¡ŒcAdvisorï¼Œå®ƒä¼šæ”¶é›†æœ¬æœºä»¥åŠå®¹å™¨çš„ç›‘æ§æ•°æ®(cpu,memory,filesystem,network,uptime)ã€‚åœ¨è¾ƒæ–°çš„ç‰ˆæœ¬ä¸­ï¼ŒK8Så·²ç»å°†cAdvisoråŠŸèƒ½é›†æˆåˆ°kubeletç»„ä»¶ä¸­ã€‚æ¯ä¸ªNodeèŠ‚ç‚¹å¯ä»¥ç›´æ¥è¿›è¡Œwebè®¿é—®ã€‚</p><p>Heapsteræ˜¯ä¸€ä¸ªæ”¶é›†è€…ï¼ŒHeapsterå¯ä»¥æ”¶é›†NodeèŠ‚ç‚¹ä¸Šçš„cAdvisoræ•°æ®ï¼Œå°†æ¯ä¸ªNodeä¸Šçš„cAdvisorçš„æ•°æ®è¿›è¡Œæ±‡æ€»ï¼Œè¿˜å¯ä»¥æŒ‰ç…§kubernetesçš„èµ„æºç±»å‹æ¥é›†åˆèµ„æºï¼Œæ¯”å¦‚Podã€Namespaceï¼Œå¯ä»¥åˆ†åˆ«è·å–å®ƒä»¬çš„CPUã€å†…å­˜ã€ç½‘ç»œå’Œç£ç›˜çš„metricã€‚é»˜è®¤çš„metricæ•°æ®èšåˆæ—¶é—´é—´éš”æ˜¯1åˆ†é’Ÿã€‚è¿˜å¯ä»¥æŠŠæ•°æ®å¯¼å…¥åˆ°ç¬¬ä¸‰æ–¹å·¥å…·(å¦‚InfluxDB)ã€‚</p><p>KubernetesåŸç”Ÿdashboardçš„ç›‘æ§å›¾è¡¨ä¿¡æ¯æ¥è‡ªheapsterã€‚åœ¨Horizontal Pod Autoscalingä¸­ä¹Ÿç”¨åˆ°äº†Heapsterï¼ŒHPAå°†Heapsterä½œä¸ºResource Metrics APIï¼Œå‘å…¶è·å–metricã€‚</p><h2 id="InfluxDB"><a href="#InfluxDB" class="headerlink" title="InfluxDB"></a>InfluxDB</h2><p>InfluxDBæ˜¯ä¸€ä¸ªå¼€æºçš„æ—¶åºæ•°æ®åº“ï¼Œä½¿ç”¨GOè¯­è¨€å¼€å‘ï¼Œç‰¹åˆ«é€‚åˆç”¨äºå¤„ç†å’Œåˆ†æèµ„æºç›‘æ§æ•°æ®è¿™ç§æ—¶åºç›¸å…³æ•°æ®ã€‚è€ŒInfluxDBè‡ªå¸¦çš„å„ç§ç‰¹æ®Šå‡½æ•°å¦‚æ±‚æ ‡å‡†å·®ï¼Œéšæœºå–æ ·æ•°æ®ï¼Œç»Ÿè®¡æ•°æ®å˜åŒ–æ¯”ç­‰ï¼Œä½¿æ•°æ®ç»Ÿè®¡å’Œå®æ—¶åˆ†æå˜å¾—ååˆ†æ–¹ä¾¿ã€‚</p><p>æ—¶åºæ•°æ®åº“äº§å“çš„å‘æ˜éƒ½æ˜¯ä¸ºäº†è§£å†³ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“åœ¨æ—¶åºæ•°æ®å­˜å‚¨å’Œåˆ†æä¸Šçš„ä¸è¶³å’Œç¼ºé™·ï¼Œè¿™ç±»äº§å“è¢«ç»Ÿä¸€å½’ç±»ä¸ºæ—¶åºæ•°æ®åº“ã€‚é’ˆå¯¹æ—¶åºæ•°æ®çš„ç‰¹ç‚¹å¯¹å†™å…¥ã€å­˜å‚¨ã€æŸ¥è¯¢ç­‰æµç¨‹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œè¿™äº›ä¼˜åŒ–ä¸æ—¶åºæ•°æ®çš„ç‰¹ç‚¹æ¯æ¯ç›¸å…³ï¼š</p><ul><li><p>å­˜å‚¨æˆæœ¬ï¼š<br>åˆ©ç”¨æ—¶é—´é€’å¢ã€ç»´åº¦é‡å¤ã€æŒ‡æ ‡å¹³æ»‘å˜åŒ–çš„ç‰¹æ€§ï¼Œåˆç†é€‰æ‹©ç¼–ç å‹ç¼©ç®—æ³•ï¼Œæé«˜æ•°æ®å‹ç¼©æ¯”ï¼›<br>é€šè¿‡é¢„é™ç²¾åº¦ï¼Œå¯¹å†å²æ•°æ®åšèšåˆï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</p></li><li><p>é«˜å¹¶å‘å†™å…¥ï¼š<br>æ‰¹é‡å†™å…¥æ•°æ®ï¼Œé™ä½ç½‘ç»œå¼€é”€ï¼›<br>æ•°æ®å…ˆå†™å…¥å†…å­˜ï¼Œå†å‘¨æœŸæ€§çš„dumpä¸ºä¸å¯å˜çš„æ–‡ä»¶å­˜å‚¨ã€‚</p></li><li><p>ä½æŸ¥è¯¢å»¶æ—¶ï¼Œé«˜æŸ¥è¯¢å¹¶å‘ï¼š<br>ä¼˜åŒ–å¸¸è§çš„æŸ¥è¯¢æ¨¡å¼ï¼Œé€šè¿‡ç´¢å¼•ç­‰æŠ€æœ¯é™ä½æŸ¥è¯¢å»¶æ—¶ï¼›<br>é€šè¿‡ç¼“å­˜ã€routingç­‰æŠ€æœ¯æé«˜æŸ¥è¯¢å¹¶å‘ã€‚</p></li></ul><h2 id="Grafana"><a href="#Grafana" class="headerlink" title="Grafana"></a>Grafana</h2><p>Grafanaæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å¼€æºçš„åº¦é‡åˆ†æå’Œå¯è§†åŒ–å·¥å…·ï¼Œå¯ä»¥é€šè¿‡å°†é‡‡é›†çš„æ•°æ®æŸ¥è¯¢ç„¶åå¯è§†åŒ–çš„å±•ç¤ºï¼Œå¹¶åŠæ—¶é€šçŸ¥ã€‚å®ƒä¸»è¦æœ‰ä»¥ä¸‹å…­å¤§ç‰¹ç‚¹ï¼š</p><ul><li><p>å±•ç¤ºæ–¹å¼ï¼šå¿«é€Ÿçµæ´»çš„å®¢æˆ·ç«¯å›¾è¡¨ï¼Œé¢æ¿æ’ä»¶æœ‰è®¸å¤šä¸åŒæ–¹å¼çš„å¯è§†åŒ–æŒ‡æ ‡å’Œæ—¥å¿—ï¼Œå®˜æ–¹åº“ä¸­å…·æœ‰ä¸°å¯Œçš„ä»ªè¡¨ç›˜æ’ä»¶ï¼Œæ¯”å¦‚çƒ­å›¾ã€æŠ˜çº¿å›¾ã€å›¾è¡¨ç­‰å¤šç§å±•ç¤ºæ–¹å¼ï¼›</p></li><li><p>æ•°æ®æºï¼šGraphiteï¼ŒInfluxDBï¼ŒOpenTSDBï¼ŒPrometheusï¼ŒElasticsearchï¼ŒCloudWatchå’ŒKairosDBç­‰ï¼›</p></li><li><p>é€šçŸ¥æé†’ï¼šä»¥å¯è§†æ–¹å¼å®šä¹‰æœ€é‡è¦æŒ‡æ ‡çš„è­¦æŠ¥è§„åˆ™ï¼ŒGrafanaå°†ä¸æ–­è®¡ç®—å¹¶å‘é€é€šçŸ¥ï¼Œåœ¨æ•°æ®è¾¾åˆ°é˜ˆå€¼æ—¶é€šè¿‡Slackã€PagerDutyç­‰è·å¾—é€šçŸ¥ï¼›</p></li><li><p>æ··åˆå±•ç¤ºï¼šåœ¨åŒä¸€å›¾è¡¨ä¸­æ··åˆä½¿ç”¨ä¸åŒçš„æ•°æ®æºï¼Œå¯ä»¥åŸºäºæ¯ä¸ªæŸ¥è¯¢æŒ‡å®šæ•°æ®æºï¼Œç”šè‡³è‡ªå®šä¹‰æ•°æ®æºï¼›</p></li><li><p>æ³¨é‡Šï¼šä½¿ç”¨æ¥è‡ªä¸åŒæ•°æ®æºçš„ä¸°å¯Œäº‹ä»¶æ³¨é‡Šå›¾è¡¨ï¼Œå°†é¼ æ ‡æ‚¬åœåœ¨äº‹ä»¶ä¸Šä¼šæ˜¾ç¤ºå®Œæ•´çš„äº‹ä»¶å…ƒæ•°æ®å’Œæ ‡è®°ï¼›</p></li><li><p>è¿‡æ»¤å™¨ï¼šAd-hocè¿‡æ»¤å™¨å…è®¸åŠ¨æ€åˆ›å»ºæ–°çš„é”®/å€¼è¿‡æ»¤å™¨ï¼Œè¿™äº›è¿‡æ»¤å™¨ä¼šè‡ªåŠ¨åº”ç”¨äºä½¿ç”¨è¯¥æ•°æ®æºçš„æ‰€æœ‰æŸ¥è¯¢ã€‚</p></li></ul><h1 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h1><h2 id="ä¸‹è½½å®‰è£…"><a href="#ä¸‹è½½å®‰è£…" class="headerlink" title="ä¸‹è½½å®‰è£…"></a>ä¸‹è½½å®‰è£…</h2><p><a href="https://github.com/chenyu1st/kubernetes-dashboard" target="_blank" rel="noopener">é¡¹ç›®æ–‡ä»¶ä¿¡æ¯é“¾æ¥</a></p><p>ä¸€å…±æœ‰5ä¸ªyamlæ–‡ä»¶åŠ2ä¸ªjsonæ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@vm-26-11 ~]# tree</span><br><span class="line">â”œâ”€â”€ kubernetes-dashboard</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ grafana.yaml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ heapster-rbac.yaml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ heapster.yaml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ kubernetes-dashboard.yaml</span><br><span class="line">â”‚Â Â  â””â”€â”€ influxdb.yaml</span><br><span class="line"></span><br><span class="line">ç¡®è®¤kubernetes-dashboardç›®å½•çš„yamlæ–‡ä»¶æ­£ç¡®ï¼ˆjsonå…ˆä¸ç”¨ç®¡ï¼‰</span><br><span class="line"></span><br><span class="line">[root@vm-26-11 ~]# kubectl create -f kubernetes-dashboard</span><br></pre></td></tr></table></figure><p>kubernetes-dashboardè®¿é—®åœ°å€ï¼š</p><p><a href="http://nodeip:32666/" target="_blank" rel="noopener">http://nodeip:32666/</a></p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Kubernetes/kubernetes-dashboard.jpg"  alt="kubernetes-dashboard.jpg"></p><h2 id="é…ç½®grafana"><a href="#é…ç½®grafana" class="headerlink" title="é…ç½®grafana"></a>é…ç½®grafana</h2><p>grafanaè®¿é—®åœ°å€ï¼š<a href="http://nodeip:31234/" target="_blank" rel="noopener">http://nodeip:31234/</a></p><p>é€‰æ‹©æ·»åŠ  Dashboardæ¨¡æ¿ï¼ˆä¸Šé¢ä¸‹è½½çš„jsonæ–‡ä»¶ï¼‰</p><p>kubernetes-node-statistics_rev1.json</p><p>kubernetes-pod-statistics_rev1.json</p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Kubernetes/grafana-import.jpg"  alt="grafana-import.jpg"></p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Kubernetes/grafana-node.jpg"  alt="grafana-node.jpg"></p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Kubernetes/grafana-pod.jpg"  alt="grafana-pod.jpg"></p><h1 id="é—®é¢˜æ’æŸ¥"><a href="#é—®é¢˜æ’æŸ¥" class="headerlink" title="é—®é¢˜æ’æŸ¥"></a>é—®é¢˜æ’æŸ¥</h1><p>ä¸‹é¢æœ‰å‡ ä¸ªé—®é¢˜ï¼Œæˆ‘è®°å½•ä¸‹å½“æ—¶çš„æ’å‘æ“ä½œ</p><h2 id="kubernetes-dashboard"><a href="#kubernetes-dashboard" class="headerlink" title="kubernetes-dashboard"></a>kubernetes-dashboard</h2><p>å¤§è§†æŠ¥æ²¡æœ‰å¼€æƒé™æ§åˆ¶ï¼Œæ‰€ä»¥åªç”¨ä¿è¯é•œåƒå·åœ¨å›½å†…å¯ä»¥æ‰¾åˆ°å°±è¡Œï¼Œè¿™é‡Œæˆ‘ç”¨çš„äº‹é˜¿é‡Œäº‘çš„é•œåƒå·<br>registry.cn-hangzhou.aliyuncs.com/google_containers/kubernetes-dashboard-amd64:v1.10.1</p><h2 id="heapster"><a href="#heapster" class="headerlink" title="heapster"></a>heapster</h2><ul><li>æƒé™æ§åˆ¶</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">E0409 06:05:27.448890 1 reflector.go:190] k8s.io&#x2F;heapster&#x2F;metrics&#x2F;util&#x2F;util.go:30: Failed to list *v1.Node: nodes is forbidden: User &quot;system:serviceaccount:kube-system:heapster&quot; cannot list nodes at the cluster scope</span><br><span class="line"></span><br><span class="line">æŠ¥é”™åŸå› æ˜¯æ— æƒè®¿é—®ï¼Œè¿™ä¸ªéœ€è¦åˆ›å»ºheapster-rbac.yamlå°±è¡Œ</span><br></pre></td></tr></table></figure><ul><li>ç«¯å£ä¸é€š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">E0302 06:11:05.004391       1 manager.go:101] Error in scraping containers from kubelet:172.16.8.12:10255: failed to get all container stats from Kubelet URL </span><br><span class="line"></span><br><span class="line">&quot;http:&#x2F;&#x2F;172.16.8.12:10255&#x2F;stats&#x2F;container&#x2F;&quot;: Post http:&#x2F;&#x2F;172.16.8.12:10255&#x2F;stats&#x2F;container&#x2F;: dial tcp 172.16.8.12:10255: getsockopt: connection refused</span><br><span class="line"></span><br><span class="line">æŠ¥é”™åŸå› æ˜¯10255ç«¯å£ä¸é€šï¼ˆk8sé»˜è®¤ä½¿ç”¨10250ä½œä¸ºkubeletç«¯å£ï¼‰</span><br><span class="line">éœ€è¦å°†heapsterçš„</span><br><span class="line">- --source&#x3D;kubernetes:https:&#x2F;&#x2F;kubernetes.default</span><br><span class="line">æ”¹ä¸º</span><br><span class="line">- --source&#x3D;kubernetes:kubernetes:https:&#x2F;&#x2F;kubernetes.default?useServiceAccount&#x3D;true&amp;kubeletHttps&#x3D;true&amp;kubeletPort&#x3D;10250&amp;insecure&#x3D;true</span><br></pre></td></tr></table></figure><h2 id="grafana"><a href="#grafana" class="headerlink" title="grafana"></a>grafana</h2><p>å¯¼å…¥2ä¸ªjsonæ–‡ä»¶åå¯ä»¥çœ‹åˆ°nodeã€namespaceçš„æ•´ä½“èµ„æºï¼Œä½†æ˜¯çœ‹ä¸äº†podçš„èµ„æºï¼Œå¤§è§†æŠ¥æ˜¾ç¤ºçš„namespaceçš„podèµ„æºéƒ½æ˜¯noneã€‚</p><p>æˆ‘è§‰å¾—å¾ˆå¥‡æ€ªï¼Œä½†æ˜¯åˆä¸å¤ªæ‡‚è¿™ä¸ªç›‘æ§ç»„ä»¶ã€‚<br>æ‰¾äº†å¾ˆä¹…ï¼Œåœ¨kubernetes-pod-statistics_rev1.jsoné‡Œæ‰¾åˆ°äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;query&quot;: &quot;SHOW TAG VALUES FROM \&quot;uptime\&quot; WITH KEY&#x3D;pod_name WHERE \&quot;namespace_name\&quot;&#x3D;&#39;$ns&#39;&quot;,</span><br><span class="line">&quot;refresh&quot;: 1,</span><br><span class="line">&quot;regex&quot;: &quot;&#x2F;^(.*)-\\d&#123;9,&#125;-\\w&#123;5,&#125;$&#x2F;&quot;,</span><br></pre></td></tr></table></figure><p>è™½ç„¶æˆ‘ä¸çŸ¥é“ä½œè€…ä¸ºä»€ä¹ˆæŠŠpodçš„æŸ¥æ‰¾ç»“æœè¿˜ç»™è¿‡æ»¤ä¸€é“ï¼ˆçœŸå¿ƒä¸æ‡‚ï¼‰<br>ä½†æ˜¯æŠŠâ€regexâ€: â€œ/^(.*)-\d{9,}-\w{5,}$/â€œæ”¹æˆ        â€œregexâ€: â€œâ€ ä¿å­˜ï¼Œå°±å¯ä»¥çœ‹åˆ°podçš„èµ„æºç›‘æ§æƒ…å†µäº†ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æˆ‘èŠ±äº†æ¥è¿‘ä¸€å¤©çš„æ—¶é—´æ‰æ…¢æ…¢æŠŠå‘æ’å®Œï¼Œçœ‹å›½å†…æ–‡ç« å¤§éƒ¨åˆ†éƒ½æ˜¯è½¬è½½ï¼Œçº¯æ°´æ–‡ï¼Œå…³é”®æ—¶å€™è¿˜æ˜¯çœ‹å„ç§å®˜æ–¹æ–‡æ¡£æ‰èƒ½æ‰¾å‡ºé—®é¢˜ã€‚ä¸è¿‡æœ€åè¿˜æ˜¯æŒ‰æ—¶å®Œæˆä»»åŠ¡ï¼Œå®Œç¾ï¼</p><h1 id="é™„ä»¶"><a href="#é™„ä»¶" class="headerlink" title="é™„ä»¶"></a>é™„ä»¶</h1><p>å¦‚æœä¸‹è½½å¾ˆæ…¢ï¼Œå¯ä»¥ç›´æ¥ç²˜è´´ä¸‹é¢çš„yamlæ–‡ä»¶ã€‚</p><h2 id="kubernetes-dashboard-yaml"><a href="#kubernetes-dashboard-yaml" class="headerlink" title="kubernetes-dashboard.yaml"></a>kubernetes-dashboard.yaml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"># Copyright 2017 The Kubernetes Authors.</span><br><span class="line">#</span><br><span class="line"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="line"># you may not use this file except in compliance with the License.</span><br><span class="line"># You may obtain a copy of the License at</span><br><span class="line">#</span><br><span class="line">#     http:&#x2F;&#x2F;www.apache.org&#x2F;licenses&#x2F;LICENSE-2.0</span><br><span class="line">#</span><br><span class="line"># Unless required by applicable law or agreed to in writing, software</span><br><span class="line"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="line"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line"># See the License for the specific language governing permissions and</span><br><span class="line"># limitations under the License.</span><br><span class="line"></span><br><span class="line"># Configuration to deploy release version of the Dashboard UI compatible with</span><br><span class="line"># Kubernetes 1.8.</span><br><span class="line">#</span><br><span class="line"># Example usage: kubectl create -f &lt;this_file&gt;</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">    # Allows editing resource and makes sure it is created first.</span><br><span class="line">    addonmanager.kubernetes.io&#x2F;mode: EnsureExists</span><br><span class="line">  name: kubernetes-dashboard-certs</span><br><span class="line">  namespace: kube-system</span><br><span class="line">type: Opaque</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">    # Allows editing resource and makes sure it is created first.</span><br><span class="line">    addonmanager.kubernetes.io&#x2F;mode: EnsureExists</span><br><span class="line">  name: kubernetes-dashboard-key-holder</span><br><span class="line">  namespace: kube-system</span><br><span class="line">type: Opaque</span><br><span class="line">---</span><br><span class="line"># ------------------- Dashboard Service Account ------------------- #</span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">  name: kubernetes-dashboard-admin</span><br><span class="line">  namespace: kube-system</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"># ------------------- Dashboard Role &amp; Role Binding ------------------- #</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: kubernetes-dashboard-admin</span><br><span class="line">  namespace: kube-system</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: cluster-admin</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: kubernetes-dashboard-admin</span><br><span class="line">  namespace: kube-system</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">    name: cluster-watcher</span><br><span class="line">rules:</span><br><span class="line">- apiGroups:</span><br><span class="line">  - &#39;*&#39;</span><br><span class="line">  resources:</span><br><span class="line">  - &#39;*&#39;</span><br><span class="line">  verbs:</span><br><span class="line">  - &#39;get&#39;</span><br><span class="line">  - &#39;list&#39;</span><br><span class="line">- nonResourceURLs:</span><br><span class="line">  - &#39;*&#39;</span><br><span class="line">  verbs:</span><br><span class="line">  - &#39;get&#39;</span><br><span class="line">  - &#39;list&#39;</span><br><span class="line">- apiGroups: [&quot;&quot;]</span><br><span class="line">  resources: [&quot;secrets&quot;]</span><br><span class="line">  resourceNames: [&quot;kubernetes-dashboard-key-holder&quot;, &quot;kubernetes-dashboard-certs&quot;]</span><br><span class="line">  verbs: [&quot;get&quot;, &quot;update&quot;, &quot;delete&quot;]</span><br><span class="line">  # Allow Dashboard to get and update &#39;kubernetes-dashboard-settings&#39; config map.</span><br><span class="line">- apiGroups: [&quot;&quot;]</span><br><span class="line">  resources: [&quot;configmaps&quot;]</span><br><span class="line">  resourceNames: [&quot;kubernetes-dashboard-settings&quot;]</span><br><span class="line">  verbs: [&quot;get&quot;, &quot;update&quot;]</span><br><span class="line">  # Allow Dashboard to get metrics from heapster.</span><br><span class="line">- apiGroups: [&quot;&quot;]</span><br><span class="line">  resources: [&quot;services&quot;]</span><br><span class="line">  resourceNames: [&quot;heapster&quot;]</span><br><span class="line">  verbs: [&quot;proxy&quot;]</span><br><span class="line">---</span><br><span class="line"># ------------------- Dashboard Deployment ------------------- #</span><br><span class="line">apiVersion: apps&#x2F;v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: kubernetes-dashboard</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">    kubernetes.io&#x2F;cluster-service: &quot;true&quot;</span><br><span class="line">    addonmanager.kubernetes.io&#x2F;mode: Reconcile</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      k8s-app: kubernetes-dashboard</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        k8s-app: kubernetes-dashboard</span><br><span class="line">      annotations:</span><br><span class="line">        scheduler.alpha.kubernetes.io&#x2F;critical-pod: &#39;&#39;</span><br><span class="line">        seccomp.security.alpha.kubernetes.io&#x2F;pod: &#39;docker&#x2F;default&#39;</span><br><span class="line">    spec:</span><br><span class="line">      priorityClassName: system-cluster-critical</span><br><span class="line">      containers:</span><br><span class="line">      - name: kubernetes-dashboard</span><br><span class="line">       # image: registry.cn-beijing.aliyuncs.com&#x2F;kubernetes-cn&#x2F;kubernetes-dashboard-amd64:v1.10.1</span><br><span class="line">        image: registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;kubernetes-dashboard-amd64:v1.10.1</span><br><span class="line">        resources:</span><br><span class="line">          #limits:</span><br><span class="line">          #  cpu: 100m</span><br><span class="line">          #  memory: 300Mi</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 50m</span><br><span class="line">            memory: 200Mi</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 9090</span><br><span class="line">          protocol: TCP</span><br><span class="line">        args:</span><br><span class="line">          #- --auto-generate-certificates</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: kubernetes-dashboard-certs</span><br><span class="line">          mountPath: &#x2F;certs</span><br><span class="line">        - name: tmp-volume</span><br><span class="line">          mountPath: &#x2F;tmp</span><br><span class="line">        livenessProbe:</span><br><span class="line">          httpGet:</span><br><span class="line">            scheme: HTTP</span><br><span class="line">            path: &#x2F;</span><br><span class="line">            port: 9090</span><br><span class="line">          initialDelaySeconds: 30</span><br><span class="line">          timeoutSeconds: 30</span><br><span class="line">      volumes:</span><br><span class="line">      - name: kubernetes-dashboard-certs</span><br><span class="line">        secret:</span><br><span class="line">          secretName: kubernetes-dashboard-certs</span><br><span class="line">      - name: tmp-volume</span><br><span class="line">        emptyDir: &#123;&#125;</span><br><span class="line">      serviceAccountName: kubernetes-dashboard-admin</span><br><span class="line">      tolerations:</span><br><span class="line">      - key: node-role.kubernetes.io&#x2F;master</span><br><span class="line">        effect: NoSchedule</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"># ------------------- Dashboard Service ------------------- #</span><br><span class="line"></span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">  name: kubernetes-dashboard</span><br><span class="line">  namespace: kube-system</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">    - port: 443</span><br><span class="line">      targetPort: 9090</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">  name: kubernetes-dashboard-external</span><br><span class="line">  namespace: kube-system</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">    - port: 9090</span><br><span class="line">      targetPort: 9090</span><br><span class="line">      nodePort: 32666</span><br><span class="line">  type: NodePort</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br></pre></td></tr></table></figure><h2 id="influxdb-yaml"><a href="#influxdb-yaml" class="headerlink" title="influxdb.yaml"></a>influxdb.yaml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: extensions&#x2F;v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: monitoring-influxdb</span><br><span class="line">  namespace: kube-system</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        task: monitoring</span><br><span class="line">        k8s-app: influxdb</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: influxdb</span><br><span class="line">        image: registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;heapster-influxdb-amd64:v1.5.2 </span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: &#x2F;data</span><br><span class="line">          name: influxdb-storage</span><br><span class="line">      volumes:</span><br><span class="line">      - name: influxdb-storage</span><br><span class="line">        emptyDir: &#123;&#125;</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    task: monitoring</span><br><span class="line">    kubernetes.io&#x2F;cluster-service: &#39;true&#39;</span><br><span class="line">    kubernetes.io&#x2F;name: monitoring-influxdb</span><br><span class="line">  name: monitoring-influxdb</span><br><span class="line">  namespace: kube-system</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  ports:</span><br><span class="line">  - port: 8086</span><br><span class="line">    targetPort: 8086</span><br><span class="line">    nodePort: 30444</span><br><span class="line">    name: http</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: influxdb</span><br></pre></td></tr></table></figure><h2 id="heapster-yaml"><a href="#heapster-yaml" class="headerlink" title="heapster.yaml"></a>heapster.yaml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: extensions&#x2F;v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: heapster</span><br><span class="line">  namespace: kube-system</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        task: monitoring</span><br><span class="line">        k8s-app: heapster</span><br><span class="line">    spec:</span><br><span class="line">      serviceAccountName: heapster</span><br><span class="line">      containers:</span><br><span class="line">      - name: heapster</span><br><span class="line">        image: registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;heapster-amd64:v1.5.4</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        command:</span><br><span class="line">        - &#x2F;heapster</span><br><span class="line">        - --source&#x3D;kubernetes:https:&#x2F;&#x2F;kubernetes.default?useServiceAccount&#x3D;true&amp;kubeletHttps&#x3D;true&amp;kubeletPort&#x3D;10250&amp;insecure&#x3D;true</span><br><span class="line">        - --sink&#x3D;influxdb:http:&#x2F;&#x2F;monitoring-influxdb:8086</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    task: monitoring</span><br><span class="line">    # For use as a Cluster add-on (https:&#x2F;&#x2F;github.com&#x2F;kubernetes&#x2F;kubernetes&#x2F;tree&#x2F;master&#x2F;cluster&#x2F;addons)</span><br><span class="line">    # If you are NOT using this as an addon, you should comment out this line.</span><br><span class="line">    kubernetes.io&#x2F;cluster-service: &#39;true&#39;</span><br><span class="line">    kubernetes.io&#x2F;name: Heapster</span><br><span class="line">  name: heapster</span><br><span class="line">  namespace: kube-system</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    targetPort: 8082</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: heapster</span><br></pre></td></tr></table></figure><h2 id="heapster-rbac-yaml"><a href="#heapster-rbac-yaml" class="headerlink" title="heapster-rbac.yaml"></a>heapster-rbac.yaml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: heapster</span><br><span class="line">  namespace: kube-system</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1beta1</span><br><span class="line">metadata:</span><br><span class="line">  name: heapster</span><br><span class="line">subjects:</span><br><span class="line">  - kind: ServiceAccount</span><br><span class="line">    name: heapster</span><br><span class="line">    namespace: kube-system</span><br><span class="line">roleRef:</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: cluster-admin</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br></pre></td></tr></table></figure><h2 id="grafana-yaml"><a href="#grafana-yaml" class="headerlink" title="grafana.yaml"></a>grafana.yaml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: extensions&#x2F;v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: monitoring-grafana</span><br><span class="line">  namespace: kube-system</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        task: monitoring</span><br><span class="line">        k8s-app: grafana</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: grafana</span><br><span class="line">        image: registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;heapster-grafana-amd64:v5.0.4</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 3000</span><br><span class="line">          protocol: TCP</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: &#x2F;etc&#x2F;ssl&#x2F;certs</span><br><span class="line">          name: ca-certificates</span><br><span class="line">          readOnly: true</span><br><span class="line">        - mountPath: &#x2F;var</span><br><span class="line">          name: grafana-storage</span><br><span class="line">        env:</span><br><span class="line">        - name: INFLUXDB_HOST</span><br><span class="line">          value: monitoring-influxdb</span><br><span class="line">        - name: GF_SERVER_HTTP_PORT</span><br><span class="line">          value: &quot;3000&quot;</span><br><span class="line">          # The following env variables are required to make Grafana accessible via</span><br><span class="line">          # the kubernetes api-server proxy. On production clusters, we recommend</span><br><span class="line">          # removing these env variables, setup auth for grafana, and expose the grafana</span><br><span class="line">          # service using a LoadBalancer or a public IP.</span><br><span class="line">        - name: GF_AUTH_BASIC_ENABLED</span><br><span class="line">          value: &quot;false&quot;</span><br><span class="line">        - name: GF_AUTH_ANONYMOUS_ENABLED</span><br><span class="line">          value: &quot;true&quot;</span><br><span class="line">        - name: GF_AUTH_ANONYMOUS_ORG_ROLE</span><br><span class="line">          value: Admin</span><br><span class="line">        - name: GF_SERVER_ROOT_URL</span><br><span class="line">          # If you&#39;re only using the API Server proxy, set this value instead:</span><br><span class="line">          # value: &#x2F;api&#x2F;v1&#x2F;namespaces&#x2F;kube-system&#x2F;services&#x2F;monitoring-grafana&#x2F;proxy</span><br><span class="line">          value: &#x2F;</span><br><span class="line">      volumes:</span><br><span class="line">      - name: ca-certificates</span><br><span class="line">        hostPath:</span><br><span class="line">          path: &#x2F;etc&#x2F;ssl&#x2F;certs</span><br><span class="line">      - name: grafana-storage</span><br><span class="line">        emptyDir: &#123;&#125;</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    # For use as a Cluster add-on (https:&#x2F;&#x2F;github.com&#x2F;kubernetes&#x2F;kubernetes&#x2F;tree&#x2F;master&#x2F;cluster&#x2F;addons)</span><br><span class="line">    # If you are NOT using this as an addon, you should comment out this line.</span><br><span class="line">    kubernetes.io&#x2F;cluster-service: &#39;true&#39;</span><br><span class="line">    kubernetes.io&#x2F;name: monitoring-grafana</span><br><span class="line">  name: monitoring-grafana</span><br><span class="line">  namespace: kube-system</span><br><span class="line">spec:</span><br><span class="line">  # In a production setup, we recommend accessing Grafana through an external Loadbalancer</span><br><span class="line">  # or through a public IP.</span><br><span class="line">  # type: LoadBalancer</span><br><span class="line">  # You could also use NodePort to expose the service at a randomly-generated port</span><br><span class="line">  type: NodePort</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    targetPort: 3000</span><br><span class="line">    nodePort: 31234</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: grafana</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://github.com/kubernetes-retired/heapster" target="_blank" rel="noopener">Heapster-Github</a></p><p><a href="https://github.com/kubernetes-retired/heapster/blob/master/docs/influxdb.md" target="_blank" rel="noopener">åœ¨å…·æœ‰InfluxDBåç«¯å’ŒGrafana UIçš„Kubernetesé›†ç¾¤ä¸­è¿è¡ŒHeapster</a></p><p><a href="https://grafana.com/grafana/dashboards?orderBy=name&direction=asc" target="_blank" rel="noopener">Grafanaçš„Dashboardsæ¨¡æ¿</a></p><p><a href="https://blog.csdn.net/liukuan73/article/details/78704395" target="_blank" rel="noopener">kubernetesç›‘æ§æ–¹æ¡ˆä¹‹ï¼šheapster+influxdb+grafanaè¯¦è§£</a></p><p><a href="https://blog.csdn.net/liukuan73/article/details/79950329" target="_blank" rel="noopener">æ—¶åºæ•°æ®åº“ä»‹ç»å’Œä½¿ç”¨</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> kubernetes-dashboard </tag>
            
            <tag> heapster </tag>
            
            <tag> grafana </tag>
            
            <tag> influxdb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥æµ…å‡ºDockeråŸç†åŠå®æˆ˜(äºŒ)â€”â€”Dockerçš„å®‰è£…åŠå¸¸ç”¨å‘½ä»¤</title>
      <link href="/2020/06/09/docker/docker-idea-2/"/>
      <url>/2020/06/09/docker/docker-idea-2/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><p>æ·±å…¥æµ…å‡ºDockeråŸç†åŠå®æˆ˜ç³»åˆ—ç¬¬äºŒç¯‡ï¼Œéµå¾ªå…ˆè¿ç”¨åç†è§£çš„æ€æƒ³ï¼Œæˆ‘ä¸»è¦è®²è§£dockerçš„å®‰è£…è¿‡ç¨‹åŠå¸¸ç”¨å‘½ä»¤ï¼Œå¯ä»¥å¸®åŠ©å¤§å®¶å¿«é€Ÿä¸Šæ‰‹docker(ä½ å…ˆç”¨èµ·æ¥ï¼Œå†å»ç†è§£åŸç†)ã€‚</p><h1 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h1><h2 id="æ“ä½œç³»ç»Ÿè¦æ±‚"><a href="#æ“ä½œç³»ç»Ÿè¦æ±‚" class="headerlink" title="æ“ä½œç³»ç»Ÿè¦æ±‚"></a>æ“ä½œç³»ç»Ÿè¦æ±‚</h2><p>è¦å®‰è£…Docker Engineï¼Œéœ€è¦CentOS 7çš„ç¨³å®šç‰ˆæœ¬ã€‚</p><p>å½“å‰ç¨³å®šç‰ˆæœ¬ï¼šCentOS Linux release 7.6.1810 (Core)</p><p>å»ºè®®ä½¿ç”¨overlay2å­˜å‚¨é©±åŠ¨ç¨‹åºã€‚</p><h2 id="å¸è½½æ—§ç‰ˆæœ¬"><a href="#å¸è½½æ—§ç‰ˆæœ¬" class="headerlink" title="å¸è½½æ—§ç‰ˆæœ¬"></a>å¸è½½æ—§ç‰ˆæœ¬</h2><p>è¾ƒæ—§çš„Dockerç‰ˆæœ¬ç§°ä¸ºdockeræˆ–docker-engineã€‚å¦‚æœå·²å®‰è£…è¿™äº›ç¨‹åºï¼Œè¯·å¸è½½å®ƒä»¬ä»¥åŠç›¸å…³çš„ä¾èµ–é¡¹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@dev-master-01 ~]#yum remove docker \</span><br><span class="line">                        docker-client \</span><br><span class="line">                        docker-client-latest \</span><br><span class="line">                        docker-common \</span><br><span class="line">                        docker-latest \</span><br><span class="line">                        docker-latest-logrotate \</span><br><span class="line">                        docker-logrotate \</span><br><span class="line">                        docker-engine</span><br></pre></td></tr></table></figure><p>å¦‚æœyumæŠ¥å‘Šæ²¡æœ‰å®‰è£…è¿™äº›è½¯ä»¶åŒ…ï¼Œé‚£å°±å¯ä»¥äº†ã€‚</p><p>/var/lib/docker/çš„å†…å®¹ï¼ˆåŒ…æ‹¬é•œåƒï¼Œå®¹å™¨ï¼Œå·å’Œç½‘ç»œï¼‰è¢«ä¿ç•™ã€‚ Docker Engineè½¯ä»¶åŒ…ç°åœ¨ç§°ä¸ºdocker-ceã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>æ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä»¥ä¸åŒçš„æ–¹å¼å®‰è£…Docker Engineï¼š</p><ul><li>å¤§å¤šæ•°ç”¨æˆ·ä¼šè®¾ç½®Dockerçš„å­˜å‚¨åº“å¹¶ä»ä¸­è¿›è¡Œå®‰è£…ï¼Œä»¥ç®€åŒ–å®‰è£…å’Œå‡çº§ä»»åŠ¡ã€‚è¿™æ˜¯æ¨èçš„æ–¹æ³•ã€‚</li><li>ä¸€äº›ç”¨æˆ·ä¸‹è½½å¹¶æ‰‹åŠ¨å®‰è£…RPMè½¯ä»¶åŒ…ï¼Œå¹¶å®Œå…¨æ‰‹åŠ¨ç®¡ç†å‡çº§ã€‚è¿™åœ¨è¯¸å¦‚åœ¨æ— æ³•è®¿é—®äº’è”ç½‘çš„ç©ºç™½ç³»ç»Ÿä¸Šå®‰è£…Dockerçš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ã€‚</li></ul><h3 id="yumå®‰è£…"><a href="#yumå®‰è£…" class="headerlink" title="yumå®‰è£…"></a>yumå®‰è£…</h3><h4 id="è®¾ç½®yumæº"><a href="#è®¾ç½®yumæº" class="headerlink" title="è®¾ç½®yumæº"></a>è®¾ç½®yumæº</h4><p>å®‰è£…yum-utilsè½¯ä»¶åŒ…ï¼ˆæä¾›yum-config-managerå®ç”¨ç¨‹åºï¼‰å¹¶è®¾ç½®ç¨³å®šçš„å­˜å‚¨åº“ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y yum-utils</span><br><span class="line"></span><br><span class="line">$ yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…DOCKERå¼•æ“"><a href="#å®‰è£…DOCKERå¼•æ“" class="headerlink" title="å®‰è£…DOCKERå¼•æ“"></a>å®‰è£…DOCKERå¼•æ“</h4><p>å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Docker Engineå’Œå®¹å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure><p>è¦å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„Docker Engineï¼Œè¯·åœ¨å­˜å‚¨åº“ä¸­åˆ—å‡ºå¯ç”¨ç‰ˆæœ¬ï¼Œç„¶åé€‰æ‹©å¹¶å®‰è£…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ yum list docker-ce --showduplicates | sort -r</span><br><span class="line"></span><br><span class="line">docker-ce.x86_64  3:18.09.1-3.el7                     docker-ce-stable</span><br><span class="line">docker-ce.x86_64  3:18.09.0-3.el7                     docker-ce-stable</span><br><span class="line">docker-ce.x86_64  18.06.1.ce-3.el7                    docker-ce-stable</span><br><span class="line">docker-ce.x86_64  18.06.0.ce-3.el7                    docker-ce-stable</span><br></pre></td></tr></table></figure><p>é€šè¿‡å®Œå…¨é™å®šçš„è½¯ä»¶åŒ…åç§°å®‰è£…ç‰¹å®šç‰ˆæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io    </span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼šdocker-ce-18.09.1</span><br></pre></td></tr></table></figure><h4 id="é…ç½®dockeræº"><a href="#é…ç½®dockeræº" class="headerlink" title="é…ç½®dockeræº"></a>é…ç½®dockeræº</h4><p>ä¸€èˆ¬æ‹‰å–é•œåƒéƒ½æ˜¯ä»docker hubæ‹‰å–ï¼Œé€Ÿåº¦è¾ƒæ…¢ï¼Œåˆ‡æ¢æˆé˜¿é‡Œæºé•œåƒä¼šå¿«å¾ˆå¤š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim   &#x2F;etc&#x2F;docker&#x2F;daemon.json</span><br><span class="line">æ·»åŠ </span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;wghlmi3i.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h4><p>systemctl start docker</p><p>éªŒè¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@dev-master-01 datarouter]# docker version</span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           19.03.4</span><br><span class="line"> API version:       1.40</span><br><span class="line"> Go version:        go1.12.10</span><br><span class="line"> Git commit:        9013bf583a</span><br><span class="line"> Built:             Fri Oct 18 15:52:22 2019</span><br><span class="line"> OS&#x2F;Arch:           linux&#x2F;amd64</span><br><span class="line"> Experimental:      false</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          19.03.4</span><br><span class="line">  API version:      1.40 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.12.10</span><br><span class="line">  Git commit:       9013bf583a</span><br><span class="line">  Built:            Fri Oct 18 15:50:54 2019</span><br><span class="line">  OS&#x2F;Arch:          linux&#x2F;amd64</span><br><span class="line">  Experimental:     false</span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.2.10</span><br><span class="line">  GitCommit:        b34a5c8af56e510852c35414db4c1f4fa6172339</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc8+dev</span><br><span class="line">  GitCommit:        3e425f80a8c931f88e6d94a8c831b9d5aa481657</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.18.0</span><br><span class="line">  GitCommit:        fec3683</span><br></pre></td></tr></table></figure><h3 id="rpmå®‰è£…"><a href="#rpmå®‰è£…" class="headerlink" title="rpmå®‰è£…"></a>rpmå®‰è£…</h3><p>å¦‚æœæ— æ³•ä½¿ç”¨Dockerçš„å­˜å‚¨åº“å®‰è£…Dockerï¼Œåˆ™å¯ä»¥ä¸‹è½½è¯¥.rpmå‘è¡Œç‰ˆçš„ æ–‡ä»¶å¹¶æ‰‹åŠ¨å®‰è£…ã€‚æ¯æ¬¡è¦å‡çº§Docker Engineæ—¶ï¼Œéƒ½éœ€è¦ä¸‹è½½ä¸€ä¸ªæ–°æ–‡ä»¶ã€‚</p><ul><li>è½¬åˆ°<a href="https://download.docker.com/linux/centos/" target="_blank" rel="noopener">https://download.docker.com/linux/centos/</a> å¹¶é€‰æ‹©æ‚¨çš„CentOSç‰ˆæœ¬ã€‚ç„¶åæµè§ˆx86_64/stable/Packages/ å¹¶ä¸‹è½½.rpmæ‚¨è¦å®‰è£…çš„Dockerç‰ˆæœ¬çš„æ–‡ä»¶ã€‚</li><li>å®‰è£…Docker Engineï¼Œå°†ä¸‹é¢çš„è·¯å¾„æ›´æ”¹ä¸ºæ‚¨ä¸‹è½½Dockerè½¯ä»¶åŒ…çš„è·¯å¾„ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install &#x2F;path&#x2F;to&#x2F;package.rpm</span><br></pre></td></tr></table></figure></li><li>å¯åŠ¨Docker<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure></li></ul><h1 id="dockerå¸¸ç”¨å‘½ä»¤-CLI"><a href="#dockerå¸¸ç”¨å‘½ä»¤-CLI" class="headerlink" title="dockerå¸¸ç”¨å‘½ä»¤(CLI)"></a>dockerå¸¸ç”¨å‘½ä»¤(CLI)</h1><p>ä¸‹é¢ä»ä»“åº“ã€é•œåƒã€å®¹å™¨ã€å…¶ä»–æ–¹é¢æ¥è®²è¿°dockerçš„å¸¸ç”¨å‘½ä»¤ã€‚</p><h2 id="Registry"><a href="#Registry" class="headerlink" title="Registry"></a>Registry</h2><p>å…³äºä»“åº“æœ€ä¸»è¦çš„å‡ ä¸ªå‘½ä»¤æœ‰login logout</p><h3 id="login"><a href="#login" class="headerlink" title="login"></a>login</h3><ul><li>ä½œç”¨ï¼šç™»å½•Dockerä»“åº“</li><li>ç”¨æ³•ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login [OPTIONS] [SERVER]</span><br></pre></td></tr></table></figure></li></ul><table><thead><tr><th>OPTIONS</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“password , -p</td><td>å¯†ç </td></tr><tr><td>â€“username , -u</td><td>ç”¨æˆ·å</td></tr></tbody></table><ul><li>eg: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login -u admin -p Harbor12345  development.docker.cn:5000</span><br></pre></td></tr></table></figure></li></ul><h3 id="logout"><a href="#logout" class="headerlink" title="logout"></a>logout</h3><ul><li><p>ä½œç”¨ï¼šä»Dockerä»“åº“æ³¨é”€</p></li><li><p>ç”¨æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logout [SERVER]</span><br></pre></td></tr></table></figure></li><li><p>eg: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logout  development.docker.cn:5000</span><br></pre></td></tr></table></figure></li></ul><h2 id="Images"><a href="#Images" class="headerlink" title="Images"></a>Images</h2><p>å…³äºé•œåƒæœ€ä¸»è¦çš„å‡ ä¸ªå‘½ä»¤æœ‰pullã€pushã€tagã€rmi</p><h3 id="pull"><a href="#pull" class="headerlink" title="pull"></a>pull</h3><ul><li>ä½œç”¨ï¼šä»é•œåƒä»“åº“ä¸­æ‹‰å–é•œåƒ</li><li>ç”¨æ³•ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull [OPTIONS] NAME[:TAG]</span><br></pre></td></tr></table></figure></li></ul><table><thead><tr><th>OPTIONS</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“all-tags , -a</td><td>ä¸‹è½½å­˜å‚¨åº“ä¸­æ‰€æœ‰æ ‡è®°çš„é•œåƒ</td></tr><tr><td>â€“quiet , -q</td><td>ç¦æ­¢è¯¦ç»†è¾“å‡º</td></tr></tbody></table><ul><li>egï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull ubuntu:14.04</span><br></pre></td></tr></table></figure></li></ul><p>å¤§å¤šæ•°é•œåƒéƒ½å°†åœ¨Docker Hubçš„åŸºç¡€é•œåƒä¹‹ä¸Šåˆ›å»ºã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šè¦ä»ä¸­æå–é•œåƒä»“åº“çš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå·²ç»è®¾ç½®äº†æœ¬åœ°ä»“åº“ï¼Œåˆ™å¯ä»¥æŒ‡å®šä»ä¸­æå–çš„è·¯å¾„ã€‚</p><ul><li>egï¼šæœ¬åœ°çš„harborä»“åº“urlä¸ºdevelopment.docker.cn:5000ï¼Œè¦ä»harborä»“åº“é‡Œæ‹‰å–é•œåƒå‰å¿…é¡»å…ˆç™»é™†</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker login -u admin -p Harbor12345  development.docker.cn:5000</span><br><span class="line">docker pull development.docker.cn:5000&#x2F;test&#x2F;nginx:0.0.1</span><br></pre></td></tr></table></figure><h3 id="tag"><a href="#tag" class="headerlink" title="tag"></a>tag</h3><ul><li><p>ä½œç”¨ï¼šåˆ›å»ºä¸€ä¸ªå¼•ç”¨äº†SOURCE_IMAGEçš„æ ‡ç­¾TARGET_IMAGE</p></li><li><p>ç”¨æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</span><br></pre></td></tr></table></figure></li><li><p>æ‰©å±•è¯´æ˜:é•œåƒåç§°ç”±æ–œæ åˆ†éš”çš„åç§°ç»„æˆï¼Œå¯ä»¥é€‰æ‹©ä»¥é•œåƒä»“åº“çš„ä¸»æœºåä½œä¸ºå‰ç¼€ã€‚ä¸»æœºåå¿…é¡»ç¬¦åˆæ ‡å‡†DNSè§„åˆ™ï¼Œä½†ä¸å¾—åŒ…å«ä¸‹åˆ’çº¿ã€‚æ ‡ç­¾åç§°å¿…é¡»æ˜¯æœ‰æ•ˆçš„ASCIIï¼Œå¹¶ä¸”å¯ä»¥åŒ…å«å°å†™å’Œå¤§å†™å­—æ¯ï¼Œæ•°å­—ï¼Œä¸‹åˆ’çº¿ï¼Œå¥ç‚¹å’Œç ´æŠ˜å·ã€‚æ ‡ç­¾åç§°ä¸èƒ½ä»¥å¥ç‚¹æˆ–ç ´æŠ˜å·å¼€å¤´ï¼Œå¹¶ä¸”æœ€å¤šå¯ä»¥åŒ…å«128ä¸ªå­—ç¬¦ã€‚</p></li><li><p>egï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker tag development.docker.cn:5000&#x2F;test&#x2F;nginx:0.0.1  test.docker.cn:5000&#x2F;test&#x2F;nginx:0.0.1</span><br><span class="line">[root@localhost ~]# docker images -a</span><br><span class="line">REPOSITORY                                                          TAG                        IMAGE ID            CREATED             SIZE</span><br><span class="line">development.docker.cn:5000&#x2F;test&#x2F;nginx                               0.0.1                    730908c6f40c        6 days ago          1.38GB</span><br><span class="line">test.docker.cn:5000&#x2F;test&#x2F;nginx                                      0.0.1                    730908c6f40c        6 days ago          1.38GB</span><br></pre></td></tr></table></figure></li></ul><h3 id="push"><a href="#push" class="headerlink" title="push"></a>push</h3><ul><li><p>ä½œç”¨ï¼šå°†é•œåƒæ¨é€åˆ°é•œåƒä»“åº“</p></li><li><p>ç”¨æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push  NAME[:TAG]</span><br></pre></td></tr></table></figure></li><li><p>egï¼š  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push test.docker.cn:5000&#x2F;test&#x2F;nginx:0.0.1</span><br></pre></td></tr></table></figure></li></ul><h3 id="rmi"><a href="#rmi" class="headerlink" title="rmi"></a>rmi</h3><ul><li>ä½œç”¨ï¼šåˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ</li><li>ç”¨æ³•ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi [OPTIONS] IMAGE [IMAGE...]</span><br></pre></td></tr></table></figure><table><thead><tr><th>OPTIONS</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“force , -f</td><td>å¼ºåˆ¶åˆ é™¤</td></tr><tr><td>â€“no-prune</td><td>ä¸è¦åˆ é™¤æœªåŠ æ ‡ç­¾çš„é•œåƒ</td></tr></tbody></table><ul><li>egï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi development.docker.cn:5000&#x2F;test&#x2F;nginx:0.0.1</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨-fæ ‡å¿—å¹¶æŒ‡å®šå›¾åƒçš„çŸ­IDæˆ–é•¿IDï¼Œåˆ™æ­¤å‘½ä»¤å°†å–æ¶ˆæ ‡è®°å¹¶åˆ é™¤æ‰€æœ‰ä¸æŒ‡å®šIDåŒ¹é…çš„å›¾åƒã€‚</p><ul><li>egï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ docker images -a</span><br><span class="line"></span><br><span class="line">REPOSITORY                TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">test1                     latest              fd484f19954f        23 seconds ago      7 B (virtual 4.964 MB)</span><br><span class="line">test                      latest              fd484f19954f        23 seconds ago      7 B (virtual 4.964 MB)</span><br><span class="line">test2                     latest              fd484f19954f        23 seconds ago      7 B (virtual 4.964 MB)</span><br><span class="line"></span><br><span class="line">$ docker rmi -f fd484f19954f</span><br><span class="line"></span><br><span class="line">Untagged: test1:latest</span><br><span class="line">Untagged: test:latest</span><br><span class="line">Untagged: test2:latest</span><br><span class="line">Deleted: fd484f19954f4920da7ff372b5067f5b7ddb2fd3830cecd17b96ea9e286ba5b8</span><br></pre></td></tr></table></figure><h2 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h2><p>å…³äºå®¹å™¨æœ€ä¸»è¦çš„å‡ ä¸ªå‘½ä»¤æœ‰runã€cpã€execã€logã€rmã€diffã€start/stop</p><h3 id="run"><a href="#run" class="headerlink" title="run"></a>run</h3><ul><li>ä½œç”¨ï¼šä¸€æ˜¯åˆ›å»ºå’Œå¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨ï¼ŒäºŒæ˜¯å¯åŠ¨æ—¶é€šè¿‡åŠ é€‰é¡¹å’Œå‚æ•°åœ¨å®¹å™¨è¿è¡Œå‘½ä»¤ï¼›</li><li>ç”¨æ³•ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br></pre></td></tr></table></figure></li></ul><table><thead><tr><th>OPTIONS</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“attach , -a</td><td>é™„åŠ åˆ°STDINï¼ŒSTDOUTæˆ–STDERR</td></tr><tr><td>â€“detach , -d</td><td>åœ¨åå°è¿è¡Œå®¹å™¨å¹¶æ‰“å°å®¹å™¨ID</td></tr><tr><td>â€“env , -e</td><td>è®¾ç½®ç¯å¢ƒå˜é‡</td></tr><tr><td>â€“hostname , -h</td><td>å®¹å™¨ä¸»æœºå</td></tr><tr><td>â€“name</td><td>ç»™ä½ å®¹å™¨èµ·ä¸ªåå­—ï¼Œä»¥åå¯ä»¥ä½¿ç”¨è¿™ä¸ªåå­—å¯åŠ¨æˆ–è€…åœæ­¢å®¹å™¨</td></tr><tr><td>â€“interactive , -i</td><td>å³ä½¿æœªè¿æ¥STDINä¹Ÿä¿æŒæ‰“å¼€çŠ¶æ€</td></tr><tr><td>â€“tty , -t</td><td>åˆ†é…ä¼ªTTY</td></tr><tr><td>â€“volume , -v</td><td>ç»‘å®šæŒ‚è½½å·</td></tr><tr><td>â€“publish , -p</td><td>å°†å®¹å™¨çš„ç«¯å£æ˜ å°„åˆ°ä¸»æœº</td></tr><tr><td>â€“privileged</td><td>èµ‹äºˆæ­¤å®¹å™¨æ‰©å±•çš„ç‰¹æƒ</td></tr><tr><td>â€“rm</td><td>é€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤å®¹å™¨</td></tr><tr><td>â€“user , -u</td><td>ç”¨æˆ·åæˆ–UID</td></tr></tbody></table><p>æ‰©å±•è¯´æ˜:<br>runæ˜¯åˆ›å»ºå’Œå¯åŠ¨å®¹å™¨çš„æ ¸å¿ƒå‘½ä»¤ï¼Œå‚æ•°è¾ƒå¤šï¼Œæˆ‘åœ¨æ­¤åªåˆ—ä¸¾äº†å¸¸ç”¨çš„å‚æ•°ã€‚</p><p>docker runå‘½ä»¤é¦–å…ˆcreatesæ˜¯åœ¨æŒ‡å®šé•œåƒä¸Šçš„å¯å†™å®¹å™¨å±‚ï¼Œç„¶åstartsä½¿ç”¨æŒ‡å®šå‘½ä»¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ docker runç›¸å½“äºAPI /containers/createï¼Œç„¶å /containers/(id)/startã€‚</p><p>å¦‚æœè¦é‡æ–°å¯åŠ¨å·²åœæ­¢çš„å®¹å™¨ï¼Œä½¿å…¶ä¹‹å‰çš„æ‰€æœ‰æ›´æ”¹ä¿æŒä¸å˜åº”è¯¥ç”¨docker start è€Œä¸æ˜¯ç”¨runã€‚</p><p>ä¸¾å‡ ä¸ªä¾‹å­ï¼š</p><ul><li>åç§°å¹¶åˆ†é…ä¼ªTTY(-t)</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --name test -it debian</span><br><span class="line"></span><br><span class="line">root@d6c0fe130dba:&#x2F;# exit 13</span><br><span class="line">$ echo $?</span><br><span class="line">13</span><br><span class="line">$ docker ps -a | grep test</span><br><span class="line">d6c0fe130dba        debian:7            &quot;&#x2F;bin&#x2F;bash&quot;         26 seconds ago      Exited (13) 17 seconds ago                         test</span><br></pre></td></tr></table></figure><p>æœ¬ç¤ºä¾‹è¿è¡Œä¸€ä¸ªtestä½¿ç”¨debian:latest é•œåƒå‘½åçš„å®¹å™¨ã€‚-itæŒ‡ç¤ºdockeråˆ†é…ä¸€ä¸ªä¼ªTTYè¿æ¥åˆ°æ‰€è¿°å®¹å™¨çš„stdin; bashåœ¨å®¹å™¨ä¸­åˆ›å»ºä¸€ä¸ªäº¤äº’å¼å¤–å£³ã€‚åœ¨è¯¥ç¤ºä¾‹ä¸­ï¼Œbashé€šè¿‡è¾“å…¥é€€å‡ºå¤–å£³ç¨‹åº exit 13ã€‚æ­¤é€€å‡ºä»£ç å°†ä¼ é€’ç»™çš„è°ƒç”¨è€… docker runï¼Œå¹¶è®°å½•åœ¨testå®¹å™¨çš„å…ƒæ•°æ®ä¸­ã€‚</p><ul><li>å®Œæ•´çš„å®¹å™¨åŠŸèƒ½ï¼ˆç‰¹æƒï¼‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -t -i --rm ubuntu bash</span><br><span class="line">root@bc338942ef20:&#x2F;# mount -t tmpfs none &#x2F;mnt</span><br><span class="line">mount: permission denied</span><br></pre></td></tr></table></figure><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ€æœ‰æ½œåœ¨å±é™©çš„å†…æ ¸èƒ½åŠ›ä¸‹é™;åŒ…æ‹¬cap_sys_adminï¼ˆæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæ‰€éœ€ï¼‰ã€‚ä½†æ˜¯ï¼Œè¯¥â€“privilegedæ ‡å¿—å°†å…è®¸å®ƒè¿è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -t -i --privileged ubuntu bash</span><br><span class="line">root@50e3f57e16e6:&#x2F;# mount -t tmpfs none &#x2F;mnt</span><br><span class="line">root@50e3f57e16e6:&#x2F;# df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">none            1.9G     0  1.9G   0% &#x2F;mnt</span><br></pre></td></tr></table></figure><p>è¯¥â€“privilegedæ ‡å¿—ä¸ºå®¹å™¨æä¾›äº†æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶ä¸”è¿˜deviceè§£é™¤äº†cgroupæ§åˆ¶å™¨å¼ºåˆ¶æ‰§è¡Œçš„æ‰€æœ‰é™åˆ¶ã€‚æ¢å¥è¯è¯´ï¼Œå®¹å™¨å¯ä»¥å®Œæˆä¸»æœºå¯ä»¥åšçš„å‡ ä¹æ‰€æœ‰äº‹æƒ…ã€‚å­˜åœ¨æ­¤æ ‡å¿—æ˜¯ä¸ºäº†å…è®¸ç‰¹æ®Šç”¨ä¾‹ï¼Œä¾‹å¦‚åœ¨Dockerä¸­è¿è¡ŒDockerã€‚</p><ul><li>æ˜ å°„æˆ–æš´éœ²ç«¯å£ï¼ˆ-pï¼Œ-exposeï¼‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --name nginx -p 8888:80&#x2F;tcp -it -d nginx</span><br></pre></td></tr></table></figure><p>è¿™ä¼šå°†nignxå®¹å™¨çš„80ç«¯å£ç»‘å®šåˆ°ä¸»æœº8888ä¸Š0.0.0.0çš„TCPç«¯å£ã€‚æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šudpå’Œsctpç«¯å£ã€‚<a href="https://docs.docker.com/network/links/" target="_blank" rel="noopener">ã€ŠDockerç”¨æˆ·æŒ‡å—ã€‹</a> è¯¦ç»†è§£é‡Šäº†å¦‚ä½•åœ¨Dockerä¸­æ“ä½œç«¯å£ã€‚</p><ul><li>è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆ-eï¼Œ-envï¼Œ-envæ–‡ä»¶ï¼‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -e MYVAR1 --env MYVAR2&#x3D;foo --env-file .&#x2F;env.list ubuntu bash</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨-eï¼Œâ€“envå’Œâ€“env-fileç”¨åœ¨è¿è¡Œçš„å®¹å™¨ä¸­è®¾ç½®ç®€å•ï¼ˆéæ•°ç»„ï¼‰ç¯å¢ƒå˜é‡ï¼Œæˆ–è¦†ç›–æ­£åœ¨è¿è¡Œçš„æ˜ åƒçš„Dockerfileä¸­å®šä¹‰çš„å˜é‡ã€‚</p><p>å¯ä»¥ä½¿ç”¨å¯¼å‡ºåˆ°æœ¬åœ°ç¯å¢ƒçš„å˜é‡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export VAR1&#x3D;value1</span><br><span class="line">export VAR2&#x3D;value2</span><br><span class="line"></span><br><span class="line">$ docker run --env VAR1 --env VAR2 ubuntu env | grep VAR</span><br><span class="line">VAR1&#x3D;value1</span><br><span class="line">VAR2&#x3D;value2</span><br></pre></td></tr></table></figure><ul><li>ç»™å®¹å™¨æŒ‚è½½å­˜å‚¨å·ï¼ˆ-v path:path),å°†æœ¬åœ°çš„ç›®å½•æŒ‚è½½åˆ°å®¹å™¨é‡Œï¼Œå½“ç»‘å®šå®‰è£…çš„å·çš„ä¸»æœºç›®å½•ä¸å­˜åœ¨æ—¶ï¼ŒDockerå°†ä¸ºè‡ªåŠ¨åœ¨ä¸»æœºä¸Šåˆ›å»ºæ­¤ç›®å½•ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -u root -d --name jenkins -p 8080:8080 -v &#x2F;data&#x2F;jenkins:&#x2F;data&#x2F;jenkins -v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock    jenkinsci&#x2F;jenkins:lts ;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ç»‘å®šå®‰è£…docker unixå¥—æ¥å­—å’Œé™æ€é“¾æ¥çš„dockeräºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥ä¸ºå®¹å™¨æä¾›åˆ›å»ºå’Œæ“ä½œä¸»æœºçš„Dockerå®ˆæŠ¤ç¨‹åºçš„å®Œå…¨è®¿é—®æƒé™ã€‚</p><h3 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h3><ul><li>ä½œç”¨ï¼šåœ¨å®¹å™¨å’Œæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¹‹é—´å¤åˆ¶æ–‡ä»¶/æ–‡ä»¶å¤¹</li><li>ç”¨æ³•ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-</span><br><span class="line">docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH</span><br></pre></td></tr></table></figure></li></ul><table><thead><tr><th>OPTIONS</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“archive , -a</td><td>å°†æ‰€æœ‰æƒè®¾ç½®ä¸ºæ–‡ä»¶æºçš„ç”¨æˆ·å’Œä¸»è¦ç»„</td></tr><tr><td>â€“follow-link , -L</td><td>å§‹ç»ˆéµå¾ªSRC_PATHä¸­çš„ç¬¦å·é“¾æ¥</td></tr><tr><td>- æ‰©å±•è¯´æ˜</td><td></td></tr></tbody></table><p>cpå‘½ä»¤çš„è¡Œä¸ºç±»ä¼¼äºUnix cp -aå‘½ä»¤ï¼Œå› ä¸ºå¦‚æœå¯èƒ½ï¼Œå°†ä»¥é€’å½’æ–¹å¼å¤åˆ¶ç›®å½•å¹¶ä¿ç•™æƒé™ã€‚æ‰€æœ‰æƒè®¾ç½®ä¸ºç›®çš„åœ°çš„ç”¨æˆ·å’Œä¸»è¦ç»„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">å‡è®¾ä½¿ç”¨è·¯å¾„åˆ†éš”ç¬¦&#x2F;çš„ç¬¬ä¸€ä¸ªå‚æ•°SRC_PATHå’Œçš„ç¬¬äºŒä¸ªå‚æ•°DEST_PATHï¼Œå…¶è¡Œä¸ºå¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">SRC_PATH æŒ‡å®šä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">        DEST_PATH ä¸å­˜åœ¨</span><br><span class="line">            è¯¥æ–‡ä»¶å°†ä¿å­˜åˆ°åœ¨ä»¥ä¸‹ä½ç½®åˆ›å»ºçš„æ–‡ä»¶ä¸­ DEST_PATH</span><br><span class="line">        DEST_PATH ä¸å­˜åœ¨å¹¶ä»¥ &#x2F;</span><br><span class="line">            é”™è¯¯æ¡ä»¶ï¼šç›®æ ‡ç›®å½•å¿…é¡»å­˜åœ¨ã€‚</span><br><span class="line">        DEST_PATH å­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">            ç›®æ ‡è¢«æºæ–‡ä»¶çš„å†…å®¹è¦†ç›–</span><br><span class="line">        DEST_PATH å­˜åœ¨å¹¶ä¸”æ˜¯ç›®å½•</span><br><span class="line">            ä½¿ç”¨ä»¥ä¸‹æ–‡ä»¶ä¸­çš„åŸºæœ¬åç§°å°†æ–‡ä»¶å¤åˆ¶åˆ°æ­¤ç›®å½•ä¸­ï¼š SRC_PATH</span><br><span class="line">SRC_PATH æŒ‡å®šç›®å½•</span><br><span class="line">        DEST_PATH ä¸å­˜åœ¨</span><br><span class="line">            DEST_PATHè¢«åˆ›å»ºä¸ºç›®å½•ï¼Œå¹¶å°†æºç›®å½•çš„å†…å®¹å¤åˆ¶åˆ°è¯¥ç›®å½•ä¸­</span><br><span class="line">        DEST_PATH å­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">            é”™è¯¯æ¡ä»¶ï¼šæ— æ³•å°†ç›®å½•å¤åˆ¶åˆ°æ–‡ä»¶</span><br><span class="line">        DEST_PATH å­˜åœ¨å¹¶ä¸”æ˜¯ç›®å½•</span><br><span class="line">            SRC_PATHä¸ä»¥&#x2F;. ç»“å°¾</span><br><span class="line">                æºç›®å½•å¤åˆ¶åˆ°è¯¥ç›®å½•</span><br><span class="line">            SRC_PATHä»¥&#x2F;.  ç»“å°¾</span><br><span class="line">                æºç›®å½•çš„å†…å®¹è¢«å¤åˆ¶åˆ°è¯¥ç›®å½•ä¸­</span><br></pre></td></tr></table></figure><p>æ ¹æ®ä¸Šè¿°è§„åˆ™ï¼Œè¯¥å‘½ä»¤è¦æ±‚SRC_PATHå’ŒDEST_PATHå­˜åœ¨ã€‚å¦‚æœSRC_PATHæ˜¯æœ¬åœ°çš„å¹¶ä¸”æ˜¯ç¬¦å·é“¾æ¥ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹å°†å¤åˆ¶ç¬¦å·é“¾æ¥è€Œä¸æ˜¯ç›®æ ‡é“¾æ¥ã€‚è¦å¤åˆ¶é“¾æ¥ç›®æ ‡è€Œä¸æ˜¯é“¾æ¥ï¼Œè¯·æŒ‡å®š-Lé€‰é¡¹ã€‚</p><ul><li>egï¼š  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä»å®¹å™¨é‡Œé¢æ‹·æ–‡ä»¶åˆ°å®¿ä¸»æœº</span><br><span class="line">docker cp -a project:&#x2F;opt&#x2F;abc.txt &#x2F;home&#x2F;</span><br><span class="line">ä»å®¿ä¸»æœºæ‹·æ–‡ä»¶åˆ°å®¹å™¨é‡Œé¢</span><br><span class="line">docker cp &#x2F;home&#x2F;abc.txt project:&#x2F;opt&#x2F;</span><br></pre></td></tr></table></figure></li></ul><h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><ul><li><p>ä½œç”¨ï¼šåœ¨æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸­è¿è¡Œå‘½ä»¤</p></li><li><p>ç”¨æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec [OPTIONS] CONTAINER COMMAND [ARG...]</span><br></pre></td></tr></table></figure><p>execå‘½ä»¤çš„å‚æ•°å’Œrunå‘½ä»¤çš„å‚æ•°å¾ˆå¤šç±»ä¼¼<br>OPTIONS | æè¿°</p></li><li><p>â€“|â€”</p></li><li><p>-detach , -d         |  åˆ†ç¦»æ¨¡å¼ï¼šåœ¨åå°è¿è¡Œå‘½ä»¤</p></li><li><p>-env , -e |è®¾ç½®ç¯å¢ƒå˜é‡</p></li><li><p>-interactive , -i|å³ä½¿æœªè¿æ¥STDINä¹Ÿä¿æŒæ‰“å¼€çŠ¶æ€</p></li><li><p>-privileged|èµ‹äºˆå‘½ä»¤æ‰©å±•æƒé™</p></li><li><p>-tty , -t|    åˆ†é…ä¼ªTTY</p></li><li><p>-user , -u|ç”¨æˆ·åæˆ–UID</p></li><li><p>-workdir , -w|å®¹å™¨å†…çš„å·¥ä½œç›®å½•</p></li><li><p>æ‰©å±•è¯´æ˜</p></li></ul><p>ä½¿ç”¨docker execå®¹å™¨å¯åŠ¨çš„å‘½ä»¤ä»…åœ¨å®¹å™¨çš„ä¸»è¿›ç¨‹ï¼ˆPID 1ï¼‰æ­£åœ¨è¿è¡Œæ—¶è¿è¡Œï¼Œå¦‚æœé‡æ–°å¯åŠ¨å®¹å™¨ï¼Œåˆ™è¯¥å‘½ä»¤ä¸ä¼šé‡æ–°å¯åŠ¨ã€‚</p><p>COMMANDå°†åœ¨å®¹å™¨çš„é»˜è®¤ç›®å½•ä¸­è¿è¡Œã€‚å¦‚æœåŸºç¡€æ˜ åƒåœ¨å…¶Dockerfileä¸­å…·æœ‰ä½¿ç”¨WORKDIRæŒ‡ä»¤æŒ‡å®šçš„è‡ªå®šä¹‰ç›®å½•ï¼Œåˆ™å°†ä½¿ç”¨è¯¥ç›®å½•ã€‚</p><p>ä¸¾å‡ ä¸ªä¾‹å­ï¼š</p><ul><li><p>bashåœ¨å®¹å™¨ä¸Šæ‰§è¡Œä¸€ä¸ªäº¤äº’å¼shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it nginx  bash</span><br></pre></td></tr></table></figure></li><li><p>åœ¨å½“å‰bashä¼šè¯ä¸­è®¾ç½®ç¯å¢ƒå˜é‡</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it -e VAR&#x3D;1 nginx bash</span><br></pre></td></tr></table></figure><p>è¿™å°†åœ¨nginxå®¹å™¨ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„Bashä¼šè¯ï¼Œä¸”å®ƒçš„ç¯å¢ƒå˜é‡$VARè®¾ç½®ä¸ºâ€œ1â€ã€‚è¯·æ³¨æ„ï¼Œæ­¤ç¯å¢ƒå˜é‡ä»…åœ¨å½“å‰Bashä¼šè¯ä¸Šæœ‰æ•ˆã€‚</p><ul><li>å‘½ä»¤åœ¨åˆ›å»ºå®¹å™¨æ—¶åœ¨ç›¸åŒçš„å·¥ä½œç›®å½•ä¸­è¿è¡Œã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker exec -it ubuntu_bash pwd</span><br><span class="line">&#x2F;</span><br><span class="line">$ docker exec -it -w &#x2F;root ubuntu_bash pwd</span><br><span class="line">&#x2F;root</span><br></pre></td></tr></table></figure><h3 id="log"><a href="#log" class="headerlink" title="log"></a>log</h3><ul><li><p>ä½œç”¨ï¼šæå–å®¹å™¨çš„æ—¥å¿—</p></li><li><p>ç”¨æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs [OPTIONS] CONTAINER</span><br></pre></td></tr></table></figure><p>OPTIONS | æè¿°</p></li><li><p>â€“|â€”</p></li><li><p>-details         |  æ˜¾ç¤ºæä¾›ç»™æ—¥å¿—çš„å…¶ä»–è¯¦ç»†ä¿¡æ¯</p></li><li><p>-follow , -f |è·Ÿè¸ªæ—¥å¿—è¾“å‡º</p></li><li><p>-since|æ˜¾ç¤ºè‡ªæ—¶é—´æˆ³è®°ä»¥æ¥çš„æ—¥å¿—æˆ–ç›¸å¯¹æ—¶é—´</p></li><li><p>-tail    |èµ‹äºˆå‘½ä»¤æ‰©å±•æƒé™</p></li><li><p>-timestamps , -t|    æ˜¾ç¤ºæ—¶é—´æˆ³</p></li><li><p>-until|åœ¨æ—¶é—´æˆ³æˆ–ç›¸å¯¹æ—¶é—´ä¹‹å‰æ˜¾ç¤ºæ—¥å¿—</p></li><li><p>egï¼š</p></li></ul><p>ä¸ºäº†åœ¨ç‰¹å®šæ—¶é—´ç‚¹ä¹‹å‰æ£€ç´¢æ—¥å¿—ï¼Œè¯·è¿è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --name test -d busybox sh -c &quot;while true; do $(echo date); sleep 1; done&quot;</span><br><span class="line">$ date</span><br><span class="line">Tue 14 Nov 2017 16:40:00 CET</span><br><span class="line">$ docker logs -f --until&#x3D;2s</span><br><span class="line">Tue 14 Nov 2017 16:40:00 CET</span><br><span class="line">Tue 14 Nov 2017 16:40:01 CET</span><br><span class="line">Tue 14 Nov 2017 16:40:02 CET</span><br></pre></td></tr></table></figure><h3 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h3><ul><li>ä½œç”¨ï¼šåˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨</li><li>ç”¨æ³•ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm [OPTIONS] CONTAINER [CONTAINER...]</span><br></pre></td></tr></table></figure>OPTIONS | æè¿°</li><li>â€“|â€”</li><li>-force , -f |      å¼ºåˆ¶åˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨</li><li>-link , -l |åˆ é™¤æŒ‡å®šçš„é“¾æ¥</li><li>-volumes , -v|    åˆ é™¤ä¸å®¹å™¨å…³è”çš„åŒ¿åå·</li></ul><p>ä¸¾å‡ ä¸ªä¾‹å­ï¼š</p><ul><li>å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm --force redis</span><br><span class="line">redis</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm $(docker ps -a -q)</span><br></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤åˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨ã€‚docker ps -a -qä¸Šé¢çš„å‘½ä»¤ è¿”å›æ‰€æœ‰ç°æœ‰çš„å®¹å™¨IDï¼Œå¹¶å°†å…¶ä¼ é€’ç»™rmåˆ é™¤å®ƒä»¬çš„å‘½ä»¤ã€‚æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸ä¼šè¢«åˆ é™¤ã€‚</p><ul><li>åˆ é™¤å®¹å™¨åŠåŒ¿åå·</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm -v redis</span><br><span class="line">redis</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤å°†åˆ é™¤å®¹å™¨åŠå…¶å…³è”çš„ä»»ä½•å·ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨åç§°æŒ‡å®šäº†å·ï¼Œåˆ™ä¸ä¼šå°†å…¶åˆ é™¤ã€‚</p><ul><li>åˆ é™¤å®¹å™¨ï¼Œå¹¶ä¸”é€‰æ‹©æ€§åœ°å»é™¤å·<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker create -v awesome:&#x2F;foo -v &#x2F;bar --name hello redis</span><br><span class="line">hello</span><br><span class="line">$ docker rm -v hello</span><br></pre></td></tr></table></figure>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå­˜å‚¨å·/fooä¿æŒä¸å˜ï¼Œä½†æ˜¯çš„åŒ¿åå·/barè¢«ç§»é™¤ã€‚</li></ul><h3 id="diff"><a href="#diff" class="headerlink" title="diff"></a>diff</h3><ul><li><p>ä½œç”¨ï¼šæ£€æŸ¥å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸Šæ–‡ä»¶æˆ–ç›®å½•çš„æ›´æ”¹</p></li><li><p>ç”¨æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker diff CONTAINER</span><br></pre></td></tr></table></figure></li><li><p>eg:</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker diff nginx</span><br><span class="line">C &#x2F;root</span><br><span class="line">A &#x2F;root&#x2F;.bash_history</span><br><span class="line">C &#x2F;run</span><br><span class="line">A &#x2F;run&#x2F;nginx.pid</span><br><span class="line">C &#x2F;var</span><br><span class="line">C &#x2F;var&#x2F;cache</span><br><span class="line">C &#x2F;var&#x2F;cache&#x2F;nginx</span><br><span class="line">A &#x2F;var&#x2F;cache&#x2F;nginx&#x2F;proxy_temp</span><br><span class="line">A &#x2F;var&#x2F;cache&#x2F;nginx&#x2F;scgi_temp</span><br><span class="line">A &#x2F;var&#x2F;cache&#x2F;nginx&#x2F;uwsgi_temp</span><br><span class="line">A &#x2F;var&#x2F;cache&#x2F;nginx&#x2F;client_temp</span><br><span class="line">A &#x2F;var&#x2F;cache&#x2F;nginx&#x2F;fastcgi_temp</span><br></pre></td></tr></table></figure><table><thead><tr><th>ç¬¦å·</th><th>æè¿°</th></tr></thead><tbody><tr><td>A</td><td>æ·»åŠ äº†æ–‡ä»¶æˆ–ç›®å½•</td></tr><tr><td>D</td><td>æ–‡ä»¶æˆ–ç›®å½•å·²åˆ é™¤</td></tr><tr><td>C</td><td>æ–‡ä»¶æˆ–ç›®å½•å·²æ›´æ”¹</td></tr></tbody></table><h3 id="stop"><a href="#stop" class="headerlink" title="stop"></a>stop</h3><ul><li>ä½œç”¨ï¼šåœæ­¢ä¸€ä¸ªæˆ–å¤šä¸ªè¿è¡Œä¸­çš„å®¹å™¨</li><li>ç”¨æ³•ï¼šdocker stop [OPTIONS] CONTAINER [CONTAINERâ€¦]</li></ul><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“time , -t</td><td>ç­‰å¾…æ€æ­»çš„ç§’æ•°ï¼Œç„¶åå°†å…¶æ€æ­»</td></tr><tr><td>- egï¼š</td><td></td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop  nginx</span><br></pre></td></tr></table></figure><h3 id="start"><a href="#start" class="headerlink" title="start"></a>start</h3><ul><li>ä½œç”¨ï¼šå¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå·²åœæ­¢çš„å®¹å™¨</li><li>ç”¨æ³•ï¼šdocker start  CONTAINER [CONTAINERâ€¦]</li><li>egï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker start  nginx</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="volume"><a href="#volume" class="headerlink" title="volume"></a>volume</h3><ul><li>ä½œç”¨ï¼šå­˜å‚¨å·ç®¡ç†</li></ul><p>ä¸¾å‡ ä¸ªå¸¸ç”¨çš„ä¾‹å­ï¼š</p><ul><li>æ–°å»ºå­˜å‚¨å·</li></ul><p>docker volume create  [OPTIONS] [VOLUME]</p><table><thead><tr><th>OPTIONS</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“driver , -d é»˜è®¤    local</td><td>æŒ‡å®šå·é©±åŠ¨ç¨‹åºåç§°</td></tr><tr><td>â€“label</td><td>è®¾ç½®å·çš„å…ƒæ•°æ®</td></tr><tr><td>â€“name</td><td>æŒ‡å®šå·å</td></tr><tr><td>â€“opt , -o</td><td>è®¾ç½®é©±åŠ¨ç¨‹åºç‰¹å®šé€‰é¡¹</td></tr><tr><td><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºä¸€ä¸ªå·,å¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨å¼•ç”¨è¯¥å­˜å‚¨å·</span><br><span class="line">$ docker volume create hello</span><br><span class="line">hello</span><br><span class="line">docker run -itd  --name mysql -p 3306:3306  --privileged&#x3D;true  -v hello:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;123456  mysql</span><br><span class="line"></span><br><span class="line">åˆ›å»ºä¸€ä¸ªtmpfsåä¸ºfoo å¤§å°ä¸º100MBå’Œuid1000çš„å·ã€‚</span><br><span class="line">$ docker volume create --driver local \</span><br><span class="line">    --opt type&#x3D;tmpfs \</span><br><span class="line">    --opt device&#x3D;tmpfs \</span><br><span class="line">    --opt o&#x3D;size&#x3D;100m,uid&#x3D;1000 \</span><br><span class="line">    foo</span><br><span class="line"></span><br><span class="line">ä»nfsä¸­æŒ‚è½½&#x2F;path&#x2F;to&#x2F;dirin rwæ¨¡å¼ 192.168.1.1ï¼š</span><br><span class="line">$ docker volume create --driver local \</span><br><span class="line">    --opt type&#x3D;nfs \</span><br><span class="line">    --opt o&#x3D;addr&#x3D;192.168.1.1,rw \</span><br><span class="line">    --opt device&#x3D;:&#x2F;path&#x2F;to&#x2F;dir \</span><br><span class="line">    foo</span><br></pre></td></tr></table></figure></td><td></td></tr></tbody></table><ul><li>åˆ—å‡ºå·æ¸…å•</li></ul><p>docker volume ls [OPTIONS]<br>OPTIONS | æè¿°<br>â€”|â€”<br>â€“filter , -f|      æä¾›è¿‡æ»¤å™¨å€¼ï¼ˆä¾‹å¦‚â€™dangling = trueâ€™ï¼‰<br>â€“format |    ä½¿ç”¨Goæ¨¡æ¿æ‰“å°æ¼‚äº®çš„å·<br>â€“quiet , -q|    ä»…æ˜¾ç¤ºå·å</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume ls</span><br><span class="line"></span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               rosemary</span><br><span class="line">local               tyler</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„æœ¬åœ°å·</li></ul><p>docker volume prune [OPTIONS]<br>OPTIONS | æè¿°<br>â€”|â€”<br>â€“filter |      æä¾›è¿‡æ»¤å™¨å€¼ï¼ˆä¾‹å¦‚â€™label =â€™ï¼‰<br>â€“force , -f |        ä¸æç¤ºç¡®è®¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume prune</span><br><span class="line"></span><br><span class="line">WARNING! This will remove all local volumes not used by at least one container.</span><br><span class="line">Are you sure you want to continue? [y&#x2F;N] y</span><br><span class="line">Deleted Volumes:</span><br><span class="line">07c7bdf3e34ab76d921894c2b834f073721fccfbbcba792aa7648e3a7a664c2e</span><br><span class="line">my-named-vol</span><br><span class="line"></span><br><span class="line">Total reclaimed space: 36 B</span><br></pre></td></tr></table></figure><h3 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h3><ul><li>ä½œç”¨ï¼šåˆ—å‡ºå®¹å™¨</li><li>ç”¨æ³•ï¼šdocker ps [OPTIONS]</li></ul><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“all , -a</td><td>æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨ï¼ˆé»˜è®¤æ˜¾ç¤ºä¸ºæ­£åœ¨è¿è¡Œï¼‰</td></tr><tr><td>â€“filter , -f</td><td>æ ¹æ®æä¾›çš„æ¡ä»¶è¿‡æ»¤è¾“å‡º</td></tr><tr><td>â€“format</td><td>ä½¿ç”¨Goæ¨¡æ¿æ‰“å°æ¼‚äº®çš„å®¹å™¨</td></tr><tr><td>â€“last , -n</td><td>æ˜¾ç¤ºnä¸ªæœ€ååˆ›å»ºçš„å®¹å™¨ï¼ˆåŒ…æ‹¬æ‰€æœ‰çŠ¶æ€ï¼‰</td></tr><tr><td>â€“latest , -l</td><td>æ˜¾ç¤ºæœ€æ–°åˆ›å»ºçš„å®¹å™¨ï¼ˆåŒ…æ‹¬æ‰€æœ‰çŠ¶æ€ï¼‰</td></tr><tr><td>â€“quiet , -q</td><td>ä»…æ˜¾ç¤ºæ•°å­—ID</td></tr><tr><td>â€“size , -s</td><td>æ˜¾ç¤ºæ–‡ä»¶æ€»å¤§å°</td></tr></tbody></table><ul><li>egï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS              PORTS                               NAMES</span><br><span class="line">55a00a8af099        nginx                 &quot;nginx -g &#39;daemon ofâ€¦&quot;   4 hours ago         Up 8 minutes        80&#x2F;tcp                              nginx</span><br><span class="line">1c12274de353        jenkinsci&#x2F;blueocean   &quot;&#x2F;sbin&#x2F;tini -- &#x2F;usr&#x2F;â€¦&quot;   6 days ago          Up 6 days           0.0.0.0:8080-&gt;8080&#x2F;tcp, 50000&#x2F;tcp   jenkins</span><br></pre></td></tr></table></figure><h3 id="images"><a href="#images" class="headerlink" title="images"></a>images</h3><ul><li>ä½œç”¨ï¼šåˆ—å‡ºé•œåƒ</li><li>ç”¨æ³•ï¼šdocker images [OPTIONS] [REPOSITORY[:TAG]]</li></ul><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“all , -a</td><td>æ˜¾ç¤ºæ‰€æœ‰é•œåƒï¼ˆé»˜è®¤éšè—ä¸­é—´é•œåƒï¼‰</td></tr><tr><td>â€“filter , -f</td><td>æ ¹æ®æä¾›çš„æ¡ä»¶è¿‡æ»¤è¾“å‡º</td></tr><tr><td>â€“format</td><td>ä½¿ç”¨Goæ¨¡æ¿æ‰“å°æ¼‚äº®çš„å®¹å™¨</td></tr><tr><td>â€“digests</td><td>æ˜¾ç¤ºæ‘˜è¦</td></tr><tr><td>â€“quiet , -q</td><td>ä»…æ˜¾ç¤ºæ•°å­—ID</td></tr></tbody></table><ul><li>egï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker images java</span><br><span class="line"></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">java                8                   308e519aac60        6 days ago          824.5 MB</span><br><span class="line">java                7                   493d82594c15        3 months ago        656.3 MB</span><br><span class="line">java                latest              2711b1d6f3aa        5 months ago        603.9 MB</span><br></pre></td></tr></table></figure><h3 id="system"><a href="#system" class="headerlink" title="system"></a>system</h3><ul><li>ä½œç”¨ï¼šç®¡ç†Docker</li><li>ç”¨æ³•ï¼šdocker system COMMAND</li></ul><p>ä¸¾å‡ ä¸ªå¸¸ç”¨çš„ä¾‹å­ï¼š</p><ul><li>æ˜¾ç¤ºDockerç£ç›˜ä½¿ç”¨æƒ…å†µ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker system df -v</span><br><span class="line">Images space usage:</span><br><span class="line"></span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE                SHARED SIZE         UNIQUE SIZE         CONTAINERS</span><br><span class="line">jenkinsci&#x2F;blueocean   latest              b13e019d0f69        7 days ago          567.7MB             0B                  567.7MB             1</span><br><span class="line">nginx                 latest              9beeba249f3e        9 days ago          126.8MB             0B                  126.8MB             1</span><br><span class="line"></span><br><span class="line">Containers space usage:</span><br><span class="line"></span><br><span class="line">CONTAINER ID        IMAGE                 COMMAND                  LOCAL VOLUMES       SIZE                CREATED             STATUS              NAMES</span><br><span class="line">55a00a8af099        nginx                 &quot;nginx -g &#39;daemon ofâ€¦&quot;   0                   47B                 4 hours ago         Up 12 minutes       nginx</span><br><span class="line">1c12274de353        jenkinsci&#x2F;blueocean   &quot;&#x2F;sbin&#x2F;tini -- &#x2F;usr&#x2F;â€¦&quot;   2                   14.3MB              6 days ago          Up 6 days           jenkins</span><br><span class="line"></span><br><span class="line">Local Volumes space usage:</span><br><span class="line"></span><br><span class="line">VOLUME NAME                                                        LINKS               SIZE</span><br><span class="line">jenkins-data                                                       1                   0B</span><br><span class="line">3159d2edffe4e610a309e94edda2932296de1e2c73f0c48b9d6327c39f73580b   1                   340.1MB</span><br><span class="line"></span><br><span class="line">Build cache usage: 0B</span><br><span class="line"></span><br><span class="line">CACHE ID            CACHE TYPE          SIZE                CREATED             LAST USED           USAGE               SHARED</span><br><span class="line"></span><br><span class="line">#SHARED SIZE æ˜¯å›¾åƒä¸å¦ä¸€å›¾åƒå…±äº«çš„ç©ºé—´é‡ï¼ˆå³å®ƒä»¬çš„å…¬å…±æ•°æ®ï¼‰</span><br><span class="line">#UNIQUE SIZE æ˜¯ä»…ç»™å®šå›¾åƒä½¿ç”¨çš„ç©ºé—´é‡</span><br><span class="line">#SIZEæ˜¯å›¾åƒçš„è™šæ‹Ÿå¤§å°ï¼Œå®ƒæ˜¯çš„æ€»å’ŒSHARED SIZEä¸UNIQUE SIZE</span><br><span class="line">#æœªæ˜¾ç¤ºç½‘ç»œä¿¡æ¯ï¼Œå› ä¸ºå®ƒä¸å ç”¨ç£ç›˜ç©ºé—´ã€‚</span><br></pre></td></tr></table></figure><ul><li>æ˜¾ç¤ºç³»ç»ŸèŒƒå›´çš„ä¿¡æ¯<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker system info</span><br><span class="line">Client:</span><br><span class="line"> Debug Mode: false</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Containers: 2</span><br><span class="line">  Running: 2</span><br><span class="line">  Paused: 0</span><br><span class="line">  Stopped: 0</span><br><span class="line"> Images: 2</span><br><span class="line"> Server Version: 19.03.4</span><br><span class="line"> Storage Driver: overlay2</span><br><span class="line">  Backing Filesystem: xfs</span><br><span class="line">  Supports d_type: true</span><br><span class="line">  Native Overlay Diff: true</span><br><span class="line"> Logging Driver: json-file</span><br><span class="line"> Cgroup Driver: cgroupfs</span><br><span class="line"> Plugins:</span><br><span class="line">  Volume: local</span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br><span class="line">  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog</span><br><span class="line"> Swarm: inactive</span><br><span class="line"> Runtimes: runc</span><br><span class="line"> Default Runtime: runc</span><br><span class="line"> Init Binary: docker-init</span><br><span class="line"> containerd version: b34a5c8af56e510852c35414db4c1f4fa6172339</span><br><span class="line"> runc version: 3e425f80a8c931f88e6d94a8c831b9d5aa481657</span><br><span class="line"> init version: fec3683</span><br><span class="line"> Security Options:</span><br><span class="line">  seccomp</span><br><span class="line">   Profile: default</span><br><span class="line"> Kernel Version: 5.3.11-1.el7.elrepo.x86_64</span><br><span class="line"> Operating System: CentOS Linux 7 (Core)</span><br><span class="line"> OSType: linux</span><br><span class="line"> Architecture: x86_64</span><br><span class="line"> CPUs: 8</span><br><span class="line"> Total Memory: 15.61GiB</span><br><span class="line"> Name: localhost.localdomain</span><br><span class="line"> ID: 6GIS:LCQT:PWIR:OT3H:P7FV:FJWL:KQIT:6DR3:ENQC:HIRQ:4NV2:D7OL</span><br><span class="line"> Docker Root Dir: &#x2F;var&#x2F;lib&#x2F;docker</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Registry: https:&#x2F;&#x2F;index.docker.io&#x2F;v1&#x2F;</span><br><span class="line"> Labels:</span><br><span class="line"> Experimental: false</span><br><span class="line"> Insecure Registries:</span><br><span class="line">  127.0.0.0&#x2F;8</span><br><span class="line"> Registry Mirrors:</span><br><span class="line">  https:&#x2F;&#x2F;1nj0zren.mirror.aliyuncs.com&#x2F;</span><br><span class="line">  https:&#x2F;&#x2F;docker.mirrors.ustc.edu.cn&#x2F;</span><br><span class="line">  http:&#x2F;&#x2F;f1361db2.m.daocloud.io&#x2F;</span><br><span class="line">  https:&#x2F;&#x2F;registry.docker-cn.com&#x2F;</span><br><span class="line"> Live Restore Enabled: false</span><br><span class="line"></span><br><span class="line">WARNING: bridge-nf-call-iptables is disabled</span><br><span class="line">WARNING: bridge-nf-call-ip6tables is disabled</span><br></pre></td></tr></table></figure></li><li>åˆ é™¤æœªä½¿ç”¨çš„æ•°æ®ï¼ˆä¸€èˆ¬ç£ç›˜ç©ºé—´ä¸å¤Ÿéœ€è¦æ‰§è¡Œè¿™ä¸ªå‘½ä»¤æ¥æ¸…ç†ï¼‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker system prune [OPTIONS]</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“all , -a</td><td>åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒï¼Œè€Œä¸ä»…ä»…æ˜¯æ‚¬ç©ºçš„é•œåƒ</td></tr><tr><td>â€“force , -f</td><td>ä¸æç¤ºç¡®è®¤</td></tr><tr><td>â€“volumes</td><td>åˆ é™¤å·</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ docker system prune -a</span><br><span class="line"></span><br><span class="line">WARNING! This will remove:</span><br><span class="line">        - all stopped containers</span><br><span class="line">        - all networks not used by at least one container</span><br><span class="line">        - all dangling images</span><br><span class="line">        - all build cache</span><br><span class="line">Are you sure you want to continue? [y&#x2F;N] y</span><br><span class="line"></span><br><span class="line">Deleted Containers:</span><br><span class="line">f44f9b81948b3919590d5f79a680d8378f1139b41952e219830a33027c80c867</span><br><span class="line">792776e68ac9d75bce4092bc1b5cc17b779bc926ab04f4185aec9bf1c0d4641f</span><br><span class="line"></span><br><span class="line">Deleted Networks:</span><br><span class="line">network1</span><br><span class="line">network2</span><br><span class="line"></span><br><span class="line">Deleted Images:</span><br><span class="line">untagged: hello-world@sha256:f3b3b28a45160805bb16542c9531888519430e9e6d6ffc09d72261b0d26ff74f</span><br><span class="line">deleted: sha256:1815c82652c03bfd8644afda26fb184f2ed891d921b20a0703b46768f9755c57</span><br><span class="line">deleted: sha256:45761469c965421a92a69cc50e92c01e0cfa94fe026cdd1233445ea00e96289a</span><br><span class="line"></span><br><span class="line">Total reclaimed space: 1.84kB</span><br></pre></td></tr></table></figure><h3 id="inspect"><a href="#inspect" class="headerlink" title="inspect"></a>inspect</h3><ul><li>ä½œç”¨ï¼šè¿”å›æœ‰å…³Dockerå¯¹è±¡çš„ä¿¡æ¯</li><li>ç”¨æ³•ï¼šdocker inspect [OPTIONS] NAME|ID [NAME|IDâ€¦]</li></ul><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€“format, -f</td><td>ä½¿ç”¨Goæ¨¡æ¿æ‰“å°æ¼‚äº®çš„å®¹å™¨</td></tr><tr><td>â€“size , -s</td><td>å¦‚æœç±»å‹ä¸ºå®¹å™¨ï¼Œåˆ™æ˜¾ç¤ºæ–‡ä»¶æ€»å¤§å°</td></tr><tr><td>â€“type</td><td>è¿”å›æŒ‡å®šç±»å‹çš„JSON</td></tr></tbody></table><ul><li>egï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">è·å¾—å®¹å™¨çš„åŸºæœ¬ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">docker inspect nginx</span><br><span class="line"></span><br><span class="line">è·å–å®ä¾‹çš„IPåœ°å€</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker inspect --format&#x3D;&#39;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#39; nginx</span><br><span class="line">172.17.0.3</span><br><span class="line"></span><br><span class="line">è·å–å®ä¾‹çš„MACåœ°å€</span><br><span class="line"></span><br><span class="line">[root@localhost ~]#  docker inspect --format&#x3D;&#39;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.MacAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#39; nginx</span><br><span class="line">02:42:ac:11:00:03</span><br><span class="line"></span><br><span class="line">è·å–å®ä¾‹çš„æ—¥å¿—è·¯å¾„</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker inspect --format&#x3D;&#39;&#123;&#123;.LogPath&#125;&#125;&#39; nginx</span><br><span class="line">&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;55a00a8af09993ab9c69ee570d7cdf0fb90ac9d76579d9640137311962d9eaab&#x2F;55a00a8af09993ab9c69ee570d7cdf0fb90ac9d76579d9640137311962d9eaab-json.log</span><br><span class="line"></span><br><span class="line">è·å–å®ä¾‹çš„é•œåƒåç§°</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker inspect --format&#x3D;&#39;&#123;&#123;.Config.Image&#125;&#125;&#39; nginx</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line">åˆ—å‡ºæ‰€æœ‰ç«¯å£ç»‘å®š,å¯ä»¥éå†æ•°ç»„å’Œç»“æœä¸­çš„æ˜ å°„ä»¥äº§ç”Ÿç®€å•çš„æ–‡æœ¬è¾“å‡ºï¼š</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker inspect --format&#x3D;&#39;&#123;&#123;range $p, $conf :&#x3D; .NetworkSettings.Ports&#125;&#125; &#123;&#123;$p&#125;&#125; -&gt; &#123;&#123;(index $conf 0).HostPort&#125;&#125; &#123;&#123;end&#125;&#125;&#39; &#96;docker ps -a -q&#96;</span><br><span class="line"></span><br><span class="line">è·å–JSONæ ¼å¼çš„è¿”å›ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker inspect --format&#x3D;&#39;&#123;&#123;json .Config&#125;&#125;&#39; nginx</span><br><span class="line">&#123;&quot;Hostname&quot;:&quot;55a00a8af099&quot;,&quot;Domainname&quot;:&quot;&quot;,&quot;User&quot;:&quot;&quot;,&quot;AttachStdin&quot;:false,&quot;AttachStdout&quot;:false,&quot;AttachStderr&quot;:false,&quot;ExposedPorts&quot;:&#123;&quot;80&#x2F;tcp&quot;:&#123;&#125;&#125;,&quot;Tty&quot;:true,&quot;OpenStdin&quot;:true,&quot;StdinOnce&quot;:false,&quot;Env&quot;:[&quot;PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin&quot;,&quot;NGINX_VERSION&#x3D;1.17.10&quot;,&quot;NJS_VERSION&#x3D;0.3.9&quot;,&quot;PKG_RELEASE&#x3D;1~buster&quot;],&quot;Cmd&quot;:[&quot;nginx&quot;,&quot;-g&quot;,&quot;daemon off;&quot;],&quot;Image&quot;:&quot;nginx&quot;,&quot;Volumes&quot;:null,&quot;WorkingDir&quot;:&quot;&quot;,&quot;Entrypoint&quot;:null,&quot;OnBuild&quot;:null,&quot;Labels&quot;:&#123;&quot;maintainer&quot;:&quot;NGINX Docker Maintainers &lt;docker-maint@nginx.com&gt;&quot;&#125;,&quot;StopSignal&quot;:&quot;SIGTERM&quot;&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åŸºæœ¬ä¸Šå¸¸ç”¨çš„dockerå‘½ä»¤æˆ‘éƒ½æ€»ç»“åˆ°è¿™ç¯‡æ–‡ç« äº†ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ï¼Œè°¢è°¢ã€‚</p><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><p><a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener">dockerå®‰è£…å®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://docs.docker.com/reference/" target="_blank" rel="noopener">dockercliå®˜æ–¹æ–‡æ¡£</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Devops </tag>
            
            <tag> Docker </tag>
            
            <tag> å®¹å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è·Ÿæˆ‘å­¦Mysqlä¹‹äº‹åŠ¡ç¯‡</title>
      <link href="/2020/06/08/mysql/mysql-trx/"/>
      <url>/2020/06/08/mysql/mysql-trx/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h1><p>æ•°æ®åº“äº‹åŠ¡ï¼ˆç®€ç§°:äº‹åŠ¡ï¼‰æ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªé€»è¾‘å•ä½ï¼Œç”±ä¸€ä¸ªæœ‰é™çš„æ•°æ®åº“æ“ä½œåºåˆ—æ„æˆã€‚äº‹åŠ¡çš„ä½¿ç”¨æ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»ŸåŒºåˆ«æ–‡ä»¶ç³»ç»Ÿçš„é‡è¦ç‰¹å¾ä¹‹ä¸€ã€‚</p><p>äº‹åŠ¡æ‹¥æœ‰å››ä¸ªé‡è¦çš„ç‰¹æ€§ï¼šåŸå­æ€§ï¼ˆAtomicityï¼‰ã€ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€éš”ç¦»æ€§ï¼ˆIsolationï¼‰ã€æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼Œäººä»¬ä¹ æƒ¯ç§°ä¹‹ä¸º ACID ç‰¹æ€§ã€‚ä¸‹é¢æˆ‘é€ä¸€å¯¹å…¶è¿›è¡Œè§£é‡Šã€‚</p><ul><li><p>åŸå­æ€§ï¼ˆAtomicityï¼‰<br>äº‹åŠ¡å¼€å§‹åæ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨åšå®Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸åšï¼Œä¸å¯èƒ½åœæ»åœ¨ä¸­é—´ç¯èŠ‚ã€‚äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºé”™ï¼Œä¼šå›æ»šåˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œæ‰€æœ‰çš„æ“ä½œå°±åƒæ²¡æœ‰å‘ç”Ÿä¸€æ ·ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡éœ€è¦æ–°å¢ 100 æ¡è®°å½•ï¼Œä½†æ˜¯åœ¨æ–°å¢äº† 10 æ¡è®°å½•ä¹‹åå°±å¤±è´¥äº†ï¼Œé‚£ä¹ˆæ•°æ®åº“å°†å›æ»šå¯¹è¿™ 10 æ¡æ–°å¢çš„è®°å½•ã€‚ä¹Ÿå°±æ˜¯è¯´äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“ï¼Œå°±åƒåŒ–å­¦ä¸­å­¦è¿‡çš„åŸå­ï¼Œæ˜¯ç‰©è´¨æ„æˆçš„åŸºæœ¬å•ä½ã€‚</p></li><li><p>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰<br>æŒ‡äº‹åŠ¡å°†æ•°æ®åº“ä»ä¸€ç§çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ç§ä¸€è‡´çš„çš„çŠ¶æ€ã€‚äº‹åŠ¡å¼€å§‹å‰å’Œç»“æŸåï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´åã€‚ä¾‹å¦‚å·¥å·å¸¦æœ‰å”¯ä¸€å±æ€§ï¼Œå¦‚æœç»è¿‡ä¸€ä¸ªä¿®æ”¹å·¥å·çš„äº‹åŠ¡åï¼Œå·¥å·å˜çš„éå”¯ä¸€äº†ï¼Œåˆ™è¡¨æ˜ä¸€è‡´æ€§é­åˆ°äº†ç ´åã€‚</p></li><li><p>éš”ç¦»æ€§ï¼ˆIsolationï¼‰<br>è¦æ±‚æ¯ä¸ªè¯»å†™äº‹åŠ¡çš„å¯¹è±¡å¯¹å…¶ä»–äº‹åŠ¡çš„æ“ä½œå¯¹è±¡èƒ½äº’ç›¸åˆ†ç¦»ï¼Œå³è¯¥äº‹åŠ¡æäº¤å‰å¯¹å…¶ä»–äº‹åŠ¡ä¸å¯è§ã€‚ ä¹Ÿå¯ä»¥ç†è§£ä¸ºå¤šä¸ªäº‹åŠ¡å¹¶å‘è®¿é—®æ—¶ï¼Œäº‹åŠ¡ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸åº”è¯¥å½±å“å…¶å®ƒäº‹åŠ¡è¿è¡Œæ•ˆæœã€‚è¿™æŒ‡çš„æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œå½“ä¸åŒçš„äº‹åŠ¡åŒæ—¶æ“çºµç›¸åŒçš„æ•°æ®æ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å„è‡ªçš„å®Œæ•´æ•°æ®ç©ºé—´ã€‚ç”±å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹å¿…é¡»ä¸ä»»ä½•å…¶ä»–å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹éš”ç¦»ã€‚ä¾‹å¦‚ä¸€ä¸ªç”¨æˆ·åœ¨æ›´æ–°è‡ªå·±çš„ä¸ªäººä¿¡æ¯çš„åŒæ—¶ï¼Œæ˜¯ä¸èƒ½çœ‹åˆ°ç³»ç»Ÿç®¡ç†å‘˜ä¹Ÿåœ¨æ›´æ–°è¯¥ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼ˆæ­¤æ—¶æ›´æ–°äº‹åŠ¡è¿˜æœªæäº¤ï¼‰ã€‚</p></li></ul><p>æ³¨ï¼šMysql é€šè¿‡é”æœºåˆ¶æ¥ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§ã€‚</p><ul><li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰<br>äº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œåˆ™å…¶ç»“æœå°±æ˜¯æ°¸ä¹…æ€§çš„ã€‚å³ä½¿å‘ç”Ÿå®•æœºçš„æ•…éšœï¼Œæ•°æ®åº“ä¹Ÿèƒ½å°†æ•°æ®æ¢å¤ï¼Œä¹Ÿå°±æ˜¯è¯´äº‹åŠ¡å®Œæˆåï¼Œäº‹åŠ¡å¯¹æ•°æ®åº“çš„æ‰€æœ‰æ›´æ–°å°†è¢«ä¿å­˜åˆ°æ•°æ®åº“ï¼Œä¸èƒ½å›æ»šã€‚è¿™åªæ˜¯ä»äº‹åŠ¡æœ¬èº«çš„è§’åº¦æ¥ä¿è¯ï¼Œæ’é™¤ RDBMSï¼ˆå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œä¾‹å¦‚ Oracleã€Mysql ç­‰ï¼‰æœ¬èº«å‘ç”Ÿçš„æ•…éšœã€‚</li></ul><p>æ³¨ï¼šMysql ä½¿ç”¨ redo log æ¥ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ã€‚</p><h1 id="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼ˆTransaction-Isolation-Levelsï¼‰"><a href="#äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼ˆTransaction-Isolation-Levelsï¼‰" class="headerlink" title="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼ˆTransaction Isolation Levelsï¼‰"></a>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼ˆTransaction Isolation Levelsï¼‰</h1><p>äº‹åŠ¡éš”ç¦»æ˜¯æ•°æ®åº“å¤„ç†çš„åŸºç¡€ä¹‹ä¸€ã€‚éš”ç¦»æ˜¯ACIDä¸­çš„I ï¼›éš”ç¦»çº§åˆ«æ˜¯ä¸€ç§è®¾ç½®ï¼Œç”¨äºåœ¨å¤šä¸ªäº‹åŠ¡åŒæ—¶è¿›è¡Œæ›´æ”¹å’Œæ‰§è¡ŒæŸ¥è¯¢æ—¶å¾®è°ƒæ€§èƒ½ä¸ç»“æœçš„å¯é æ€§ï¼Œä¸€è‡´æ€§å’Œå¯é‡å¤æ€§ä¹‹é—´çš„å¹³è¡¡ã€‚</p><p>Mysql/InnoDB æä¾›SQLæ ‡å‡†æ‰€æè¿°çš„æ‰€æœ‰å››ä¸ªäº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚</p><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>è„è¯»</th><th>ä¸èƒ½é‡å¤è¯»</th><th>å¹»è¯»</th></tr></thead><tbody><tr><td>æœªæäº¤è¯»(Read uncommitted)</td><td>èƒ½</td><td>èƒ½</td><td>èƒ½</td></tr><tr><td>å·²æäº¤è¯»(Read committed)</td><td>ä¸èƒ½</td><td>èƒ½</td><td>èƒ½</td></tr><tr><td>å¯é‡å¤è¯»(Repeatable read)</td><td>ä¸èƒ½</td><td>ä¸èƒ½</td><td>ä¸èƒ½</td></tr><tr><td>å¯ä¸²è¡ŒåŒ–ï¼ˆSerializable ï¼‰</td><td>ä¸èƒ½</td><td>ä¸èƒ½</td><td>ä¸èƒ½</td></tr></tbody></table><h2 id="å››ä¸ªçº§åˆ«é€æ¸å¢å¼ºï¼Œæ¯ä¸ªçº§åˆ«è§£å†³ä¸€ä¸ªé—®é¢˜ã€‚äº‹åŠ¡çº§åˆ«è¶Šé«˜-æ€§èƒ½è¶Šå·®-å¤§å¤šæ•°æƒ…å†µéƒ½ç”¨rcéš”ç¦»çº§åˆ«ã€‚"><a href="#å››ä¸ªçº§åˆ«é€æ¸å¢å¼ºï¼Œæ¯ä¸ªçº§åˆ«è§£å†³ä¸€ä¸ªé—®é¢˜ã€‚äº‹åŠ¡çº§åˆ«è¶Šé«˜-æ€§èƒ½è¶Šå·®-å¤§å¤šæ•°æƒ…å†µéƒ½ç”¨rcéš”ç¦»çº§åˆ«ã€‚" class="headerlink" title="å››ä¸ªçº§åˆ«é€æ¸å¢å¼ºï¼Œæ¯ä¸ªçº§åˆ«è§£å†³ä¸€ä¸ªé—®é¢˜ã€‚äº‹åŠ¡çº§åˆ«è¶Šé«˜,æ€§èƒ½è¶Šå·®,å¤§å¤šæ•°æƒ…å†µéƒ½ç”¨rcéš”ç¦»çº§åˆ«ã€‚"></a>å››ä¸ªçº§åˆ«é€æ¸å¢å¼ºï¼Œæ¯ä¸ªçº§åˆ«è§£å†³ä¸€ä¸ªé—®é¢˜ã€‚äº‹åŠ¡çº§åˆ«è¶Šé«˜,æ€§èƒ½è¶Šå·®,å¤§å¤šæ•°æƒ…å†µéƒ½ç”¨rcéš”ç¦»çº§åˆ«ã€‚</h2><ul><li>æœªæäº¤è¯»(Read Uncommitted)ï¼šä¸€ä¸ªäº‹åŠ¡è¿˜æœªæäº¤ï¼Œå®ƒæ‰€åšçš„å˜æ›´å°±å¯ä»¥è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°</li><li>æäº¤è¯»(Read Committed)ï¼šä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒæ‰€åšçš„å˜æ›´æ‰å¯ä»¥è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°</li><li>å¯é‡å¤è¯»(Repeated Read)ï¼šåŒä¸€äº‹åŠ¡ä¸­çš„ä¸€è‡´è¯»å–å°†è¯»å–ç¬¬ä¸€æ¬¡è¯»å–æ—¶å€™å»ºç«‹çš„ å¿«ç…§ï¼ŒInnoDBé»˜è®¤çº§åˆ«ã€‚æ¶ˆé™¤äº†è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ï¼Œä¿è¯äº‹åŠ¡ä¸€è‡´æ€§</li><li>å¯ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ï¼šéš”ç¦»çº§åˆ«æœ€é«˜<br>ä¸²è¡ŒåŒ–è¯»ï¼Œæ¯æ¬¡è¯»éƒ½éœ€è¦è·å¾—è¡¨çº§å…±äº«é”ï¼Œè¯»å†™é—´ç›¸äº’éƒ½ä¼šé˜»å¡</li></ul><hr><ul><li>è„è¯»: è„è¯»å°±æ˜¯æŒ‡å½“ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨è®¿é—®æ•°æ®ï¼Œå¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè€Œè¿™ç§ä¿®æ”¹è¿˜æ²¡æœ‰æäº¤åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¿™ä¸ªæ•°æ®ï¼Œç„¶åä½¿ç”¨äº†è¿™ä¸ªæ•°æ®ã€‚</li><li>ä¸èƒ½é‡å¤è¯»ï¼šæ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚åœ¨è¿™ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰ç»“æŸæ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¯¥åŒä¸€æ•°æ®ã€‚é‚£ä¹ˆï¼Œåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸¤æ¬¡è¯»æ•°æ®ä¹‹é—´ï¼Œç”±äºç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿®æ”¹ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»åˆ°çš„çš„æ•°æ®å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚è¿™æ ·å°±å‘ç”Ÿäº†åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„ï¼Œå› æ­¤ç§°ä¸ºæ˜¯ä¸å¯é‡å¤è¯»ã€‚</li><li>å¹»è¯»ï¼šå½“åŒä¸€æŸ¥è¯¢åœ¨ä¸åŒæ—¶é—´ç”Ÿæˆä¸åŒçš„è¡Œé›†æ—¶ï¼Œåœ¨äº‹åŠ¡å†…å°±ä¼šå‘ç”Ÿ æ‰€è°“çš„å¹»åƒé—®é¢˜ã€‚å¦‚æœaäº‹åŠ¡ SELECTæ‰§è¡Œä¸¤æ¬¡ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡è¿”å›çš„è¡Œå´ä¸æ˜¯ç¬¬ä¸€æ¬¡è¿”å›ï¼Œåˆ™è¯¥è¡Œæ˜¯â€œ phantomâ€è¡Œã€‚</li></ul><h1 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h1><p>InnoDBæ˜¯ä¸€ä¸ªå¤šç‰ˆæœ¬çš„å­˜å‚¨å¼•æ“MVCCï¼ˆ multi-versioned storage engineï¼‰å®ƒä¿ç•™æœ‰å…³å·²æ›´æ”¹è¡Œçš„æ—§ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œä»¥æ”¯æŒè¯¸å¦‚å¹¶å‘å’Œå›æ»šä¹‹ç±»çš„äº‹åŠ¡åŠŸèƒ½ã€‚æ­¤ä¿¡æ¯å­˜å‚¨åœ¨è¡¨ç©ºé—´ä¸­çš„æ•°æ®ç»“æ„ä¸­ï¼Œè¯¥æ•°æ®ç»“æ„ç§°ä¸º å›æ»šæ®µInnoDB ä½¿ç”¨å›æ»šæ®µä¸­çš„ä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡å›æ»šä¸­æ‰€éœ€çš„æ’¤æ¶ˆæ“ä½œã€‚å®ƒè¿˜ä½¿ç”¨è¯¥ä¿¡æ¯æ¥æ„å»ºè¡Œçš„æ—©æœŸç‰ˆæœ¬ï¼Œä»¥å®ç°ä¸€è‡´çš„è¯»å–ã€‚</p><p>é¦–å…ˆç†è§£ï¼ŒMVCCæ˜¯InnoDBå­˜å‚¨å¼•æ“çš„ç‰¹æ€§ï¼Œå¥½å¤„åœ¨äºå¯ä»¥å¹¶å‘å¤„ç†äº‹åŠ¡åŠå›æ»šäº‹åŠ¡ã€‚</p><p>ä¸‹é¢ä¸¾ä¸ªç»å…¸çš„ä¾‹å­</p><table><thead><tr><th>session 1</th><th>session 2</th></tr></thead><tbody><tr><td>start transaction;</td><td></td></tr><tr><td>select a from test; return a = 10</td><td></td></tr><tr><td>update test set a = 20;</td><td></td></tr><tr><td>-</td><td>start transaction;</td></tr><tr><td>-</td><td>select a from test; return ?</td></tr><tr><td>commit;</td><td></td></tr><tr><td>-</td><td>select a from test; return ?</td></tr></tbody></table><p>æˆ‘ä»¬çœ‹ä¸‹ä¸Šé¢è¿™ä¸ªæ•°æ®åº“æ—¥å¸¸æ“ä½œçš„ä¾‹å­ã€‚</p><p>session 1ä¿®æ”¹äº†ä¸€æ¡è®°å½•ï¼Œæ²¡æœ‰æäº¤ï¼›ä¸æ­¤åŒæ—¶ï¼Œsession 2 æ¥æŸ¥è¯¢è¿™æ¡è®°å½•ï¼Œè¿™æ—¶å€™è¿”å›è®°å½•åº”è¯¥æ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><p>session 1 æäº¤ä¹‹å session 2 æŸ¥è¯¢å‡ºæ¥çš„åˆåº”è¯¥æ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><p>ç”±äºMysqlæ”¯æŒå¤šç§éš”ç¦»çº§åˆ«ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯éœ€è¦çœ‹session2çš„äº‹åŠ¡éš”ç¦»çº§åˆ«çš„ï¼Œæƒ…å†µå¦‚ä¸‹:</p><ul><li><p>éš”ç¦»çº§åˆ«ä¸º READ-UNCOMMITTED æƒ…å†µä¸‹:<br>æ— è®ºsession 1 æ˜¯å¦commitï¼Œsession 2 å»æŸ¥çœ‹éƒ½ä¼šçœ‹åˆ°çš„æ˜¯ä¿®æ”¹åçš„ç»“æœï¼Œå³ a = 20</p></li><li><p>éš”ç¦»çº§åˆ«ä¸º READ-COMMITTED æƒ…å†µä¸‹:<br>session 1 åœ¨ commit å‰ï¼Œsession 2æŸ¥çœ‹åˆ°çš„è¿˜æ˜¯ a =10 , commitä¹‹åçœ‹åˆ°çš„åˆ™æ˜¯ a = 20</p></li><li><p>éš”ç¦»çº§åˆ«ä¸º REPEATABLE-READ åŠ SERIALIZABLE æƒ…å†µä¸‹:<br>æ— è®º session 1 æ˜¯å¦commitï¼Œsession 2 å»æŸ¥çœ‹éƒ½ä¼šçœ‹åˆ°çš„æ˜¯ä¿®æ”¹å‰çš„ç»“æœï¼Œå³ a = 10</p></li></ul><p>å…¶å®ä¸ç®¡éš”ç¦»çº§åˆ«ï¼Œæˆ‘ä»¬ä¹ŸæŠ›å¼€æ•°æ®åº“ä¸­çš„ACIDï¼Œæˆ‘ä»¬æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šä¼—æ‰€å‘¨çŸ¥ï¼ŒInnoDBçš„æ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨B+treeé‡Œé¢çš„ï¼Œä¿®æ”¹åçš„æ•°æ®åˆ°åº•è¦ä¸è¦å­˜å‚¨åœ¨å®é™…çš„B+treeå¶å­èŠ‚ç‚¹ï¼Œsession2æ˜¯æ€ä¹ˆåšåˆ°æŸ¥è¯¢å‡ºæ¥çš„ç»“æœè¿˜æ˜¯10ï¼Œè€Œä¸æ˜¯20å‘¢ï¼Ÿ</p><p>åœ¨è§£é‡Šä¸Šè¿°é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç»§ç»­äº†è§£4ä¸ªåŸºæœ¬æ¦‚å¿µ</p><h2 id="undo-logï¼ˆå›æ»šæ—¥å¿—ï¼‰"><a href="#undo-logï¼ˆå›æ»šæ—¥å¿—ï¼‰" class="headerlink" title="undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰"></a>undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰</h2><p>Undo logæ˜¯InnoDB MVCCäº‹åŠ¡ç‰¹æ€§çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚å½“æˆ‘ä»¬å¯¹è®°å½•åšäº†å˜æ›´æ“ä½œæ—¶å°±ä¼šäº§ç”Ÿundoè®°å½•ï¼ŒUndoè®°å½•é»˜è®¤è¢«è®°å½•åˆ°ç³»ç»Ÿè¡¨ç©ºé—´(ibdata)ä¸­ã€‚</p><p>å›æ»šæ—¥å¿—åˆ†ä¸ºæ’å…¥å’Œæ›´æ–°æ’¤æ¶ˆæ—¥å¿—ã€‚æ’å…¥æ’¤æ¶ˆæ—¥å¿—ä»…åœ¨äº‹åŠ¡å›æ»šæ—¶æ‰éœ€è¦ï¼Œå¹¶ä¸”åœ¨äº‹åŠ¡æäº¤åå¯ä»¥ç«‹å³å°†å…¶ä¸¢å¼ƒã€‚æ›´æ–°æ’¤æ¶ˆæ—¥å¿—ä¹Ÿç”¨äºä¸€è‡´çš„è¯»å–ä¸­ï¼Œä½†æ˜¯åªæœ‰åœ¨ä¸å­˜åœ¨ä¸ºå…¶InnoDBåˆ†é…äº†å¿«ç…§çš„äº‹åŠ¡åï¼Œæ‰å¯ä»¥å°†å…¶åˆ é™¤è¡Œã€‚</p><h2 id="éšè—å­—æ®µ"><a href="#éšè—å­—æ®µ" class="headerlink" title="éšè—å­—æ®µ"></a>éšè—å­—æ®µ</h2><p>åœ¨å†…éƒ¨ï¼ŒInnoDBå‘æ•°æ®åº“ä¸­å­˜å‚¨çš„æ¯ä¸€è¡Œæ·»åŠ ä¸‰ä¸ªå­—æ®µã€‚</p><ul><li>6ä¸ªå­—èŠ‚çš„DB_TRX_IDå­—æ®µè¡¨ç¤ºæ’å…¥æˆ–æ›´æ–°è¯¥è¡Œçš„æœ€åä¸€ä¸ªäº‹åŠ¡çš„äº‹åŠ¡æ ‡è¯†ç¬¦</li><li>7ä¸ªå­—èŠ‚çš„DB_ROLL_PTRå­—æ®µåˆ™è¡¨ç¤ºæŒ‡å‘è¯¥è¡Œå›æ»šæ®µçš„æŒ‡é’ˆï¼Œå›æ»šæŒ‡é’ˆæŒ‡å‘å†™å…¥å›æ»šæ®µçš„æ’¤æ¶ˆæ—¥å¿—è®°å½•ã€‚å¦‚æœè¡Œå·²æ›´æ–°ï¼Œåˆ™æ’¤æ¶ˆæ—¥å¿—è®°å½•å°†åŒ…å«åœ¨æ›´æ–°è¡Œä¹‹å‰é‡å»ºè¡Œå†…å®¹æ‰€å¿…éœ€çš„ä¿¡æ¯ã€‚</li><li>6å­—èŠ‚çš„DB_ROW_IDå­—æ®µåŒ…å«ä¸€ä¸ªè¡ŒIDï¼Œè¯¥è¡ŒIDéšç€æ’å…¥æ–°è¡Œè€Œå•è°ƒå¢åŠ ã€‚å¦‚æœè¡¨é‡Œæ²¡æœ‰ä¸»é”®åˆ™ç³»ç»Ÿé»˜è®¤ç»™è¿™ä¸ªå­—æ®µä¸Šä¸»é”®å’Œèšç°‡ç´¢å¼•ï¼Œåªä¸è¿‡ä¸èƒ½è¢«å¤–éƒ¨è°ƒç”¨ã€‚</li></ul><p>ä¸ºä»€ä¹ˆä¸€ä¸ªæ•°æ®åªæœ‰ä¸€ä¸ªDB_TRX_IDï¼Œä½†æ˜¯å´å¯ä»¥å›æ»šåˆ°ä»¥å‰çš„è®°å½•å‘¢ï¼Œå…¶å®å°±æ˜¯å› ä¸ºDB_ROLL_PTRå’Œundo logçš„å­˜åœ¨ã€‚</p><p>å¦‚æœä½ éœ€è¦å°†æŸä¸€è¡Œå›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬åˆ™æ ¹æ®å½“å‰ç‰ˆæœ¬å’Œ undo log è®¡ç®—å‡ºæ¥çš„ã€‚</p><p>å‡è®¾ä¸Šè¿°ä¾‹å­ï¼š</p><p>select a from test; return a = 10     DB_TRX_ID=1 DB_ROLL_PTR=Null</p><p>update test set a = 20;    DB_TRX_ID=2 DB_ROLL_PTR=[2]â†’[1]</p><p>ä½ éœ€è¦å›æ»šåˆ°DB_TRX_ID=1æ—¶açš„å€¼ï¼Œæ“ä½œä¸ºï¼šé€šè¿‡DB_TRX_ID=2,a=20 ä»¥åŠDB_ROLL_PTR=[2]â†’[1]å’Œundo log[2â†’1]ä½ é€šè¿‡ä¸€äº›ç®—æ³•è®¡ç®—å‡ºäº†    DB_TRX_ID=1æ—¶açš„å€¼=10 å†å°†ç»“æœæ›´æ–°ã€‚</p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Mysql/trx/colums.jpg"  alt="colums.jpg"></p><h2 id="trx-sysï¼ˆäº‹åŠ¡é“¾è¡¨ï¼‰"><a href="#trx-sysï¼ˆäº‹åŠ¡é“¾è¡¨ï¼‰" class="headerlink" title="trx_sysï¼ˆäº‹åŠ¡é“¾è¡¨ï¼‰"></a>trx_sysï¼ˆäº‹åŠ¡é“¾è¡¨ï¼‰</h2><p>Mysqlä¸­çš„äº‹åŠ¡åœ¨å¼€å§‹åˆ°æäº¤è¿™æ®µè¿‡ç¨‹ä¸­ï¼Œéƒ½ä¼šè¢«ä¿å­˜åˆ°ä¸€ä¸ªå«trx_sysçš„äº‹åŠ¡é“¾è¡¨ä¸­ï¼Œäº‹åŠ¡é“¾è¡¨ä¸­ä¿å­˜çš„éƒ½æ˜¯è¿˜æœªæäº¤çš„äº‹åŠ¡ï¼Œäº‹åŠ¡ä¸€æ—¦è¢«æäº¤ï¼Œåˆ™ä¼šè¢«ä»äº‹åŠ¡é“¾è¡¨ä¸­æ‘˜é™¤ã€‚</p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Mysql/trx/trx_sys.jpg"  alt="trx_sys.jpg"></p><h2 id="ReadViewï¼ˆä¸€è‡´æ€§è§†å›¾ï¼‰"><a href="#ReadViewï¼ˆä¸€è‡´æ€§è§†å›¾ï¼‰" class="headerlink" title="ReadViewï¼ˆä¸€è‡´æ€§è§†å›¾ï¼‰"></a>ReadViewï¼ˆä¸€è‡´æ€§è§†å›¾ï¼‰</h2><p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘æŠŠReadViewçœ‹åšä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œåœ¨SQLå¼€å§‹çš„æ—¶å€™è¢«åˆ›å»ºã€‚è¿™ä¸ªæ•°æ®ç»“æ„ä¸­åŒ…å«äº†3ä¸ªä¸»è¦çš„æˆå‘˜ï¼šReadView[é«˜æ°´ä½, ä½æ°´ä½, trx_ids{}]</p><ul><li>é«˜æ°´ä½ï¼ˆlow_limit_idï¼‰ ï¼šäº‹åŠ¡é“¾è¡¨ï¼ˆtrx_sysï¼‰IDæœ€å¤§å€¼+1</li><li>ä½æ°´ä½ï¼ˆup_limit_idï¼‰ ï¼šäº‹åŠ¡é“¾è¡¨ï¼ˆtrx_sysï¼‰IDæœ€å°å€¼</li><li>trx_idsï¼šäº‹åŠ¡é“¾è¡¨ï¼ˆtrx_sysï¼‰ä¸­äº‹åŠ¡çš„idé›†åˆ</li></ul><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Mysql/trx/readview.jpg"  alt="readview.jpg"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">readviewè§„åˆ™ï¼š</span><br><span class="line"></span><br><span class="line">1.DB_TRX_ID &lt;low_limit_id åˆ™è¯¥è¡Œå¯¹äºå½“å‰Read Viewæ˜¯å¯è§çš„</span><br><span class="line"></span><br><span class="line">2.DB_TRX_ID &gt;&#x3D;up_limit_id  åˆ™è¯¥è¡Œå¯¹äºå½“å‰Read Viewæ˜¯ä¸å¯è§çš„</span><br><span class="line"></span><br><span class="line">åˆ¤æ–­æŸè¡Œå¯ä¸å¯è§éœ€è¦æ»¡è¶³ç¬¬ä¸€æ¡è§„åˆ™ï¼Œä¸”ä¸æ»¡è¶³ç¬¬äºŒæ¡è§„åˆ™ï¼Œå¦åˆ™ä¸å¯è§</span><br></pre></td></tr></table></figure><p>ä¸æ»¡è¶³read viewæ¡ä»¶æ—¶å€™ï¼Œä»undo logé‡Œé¢è·å–æ•°æ®DB_TRX_IDå†è¿›è¡Œå¯¹æ¯”ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå‡æ»¡è¶³è¿™2ä¸ªæ¡ä»¶çš„å³å¯</p><p>æ³¨æ„ï¼ŒReadViewæ˜¯ä¸SQLç»‘å®šçš„ï¼Œè€Œå¹¶ä¸æ˜¯äº‹åŠ¡ï¼Œæ‰€ä»¥å³ä½¿åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæ¯æ¬¡SQLå¯åŠ¨æ—¶æ„é€ çš„ReadViewçš„up_trx_idå’Œlow_trx_idä¹Ÿéƒ½æ˜¯ä¸ä¸€æ ·çš„</p><h1 id="æ€»ç»“MVCC"><a href="#æ€»ç»“MVCC" class="headerlink" title="æ€»ç»“MVCC"></a>æ€»ç»“MVCC</h1><p>MVCCå¯åŠ¨æ­¥éª¤ï¼š</p><ul><li>1.äº‹åŠ¡å¯åŠ¨æ—¶, åˆ›å»ºå¿«ç…§; åŸºäºæ•´ä¸ªåº“</li><li>2.æ—§æ•°æ®å­˜å‚¨åœ¨UNDOä¸­ï¼Œå†é€šè¿‡DB_ROLL_PTR å›æº¯æŸ¥æ‰¾å†å²ç‰ˆæœ¬<br>å¦‚æœå½“æ’å…¥çš„æ˜¯ä¸€æ¡æ–°æ•°æ®æ—¶ï¼Œè®°å½•ä¸Šå¯¹åº”çš„å›æ»šæ®µæŒ‡é’ˆä¸ºNULL<br>å¦‚æœæ›´æ–°è®°å½•æ—¶ï¼ŒåŸè®°å½•å°†è¢«æ”¾å…¥åˆ°undoè¡¨ç©ºé—´ä¸­ï¼Œå¹¶é€šè¿‡DB_ROLL_PTRæŒ‡å‘è¯¥è®°å½•ã€‚</li><li>3.é€šè¿‡read viewåˆ¤æ–­è¡Œè®°å½•æ˜¯å¦å¯è§</li></ul><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Mysql/trx/mvcc.png"  alt="mvcc.png"></p><p>MVCCä½¿å¾—æ•°æ®åº“è¯»ä¸ä¼šå¯¹æ•°æ®åŠ é”ï¼Œæ™®é€šçš„SELECTè¯·æ±‚ä¸ä¼šåŠ é”ï¼Œæé«˜äº†æ•°æ®åº“çš„å¹¶å‘å¤„ç†èƒ½åŠ›ï¼›</p><p>å€ŸåŠ©MVCCï¼Œæ•°æ®åº“å¯ä»¥å®ç°RCï¼ŒRRç­‰éš”ç¦»çº§åˆ«ï¼Œç”¨æˆ·å¯ä»¥æŸ¥çœ‹å½“å‰æ•°æ®çš„å‰ä¸€ä¸ªæˆ–è€…å‰å‡ ä¸ªå†å²ç‰ˆæœ¬ã€‚ä¿è¯äº†ACIDä¸­çš„Iç‰¹æ€§ï¼ˆéš”ç¦»æ€§ï¼‰ã€‚</p><h1 id="æ·±å…¥ç†è§£äº‹åŠ¡éš”ç¦»çº§åˆ«RRå’ŒRCçš„åŒºåˆ«"><a href="#æ·±å…¥ç†è§£äº‹åŠ¡éš”ç¦»çº§åˆ«RRå’ŒRCçš„åŒºåˆ«" class="headerlink" title="æ·±å…¥ç†è§£äº‹åŠ¡éš”ç¦»çº§åˆ«RRå’ŒRCçš„åŒºåˆ«"></a>æ·±å…¥ç†è§£äº‹åŠ¡éš”ç¦»çº§åˆ«RRå’ŒRCçš„åŒºåˆ«</h1><p>ç”±äºRRéš”ç¦»çº§åˆ«ä¸‹ï¼Œåœ¨æ¯ä¸ªäº‹åŠ¡å¼€å§‹çš„æ—¶å€™ï¼Œä¼šå°†å½“å‰ç³»ç»Ÿä¸­çš„æ‰€æœ‰çš„æ´»è·ƒäº‹åŠ¡æ‹·è´åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­(read view)ã€‚</p><p>RCéš”ç¦»çº§åˆ«ä¸‹ï¼Œåœ¨äº‹åŠ¡ä¸­çš„æ¯ä¸ªè¯­å¥å¼€å§‹æ—¶ï¼Œä¼šå°†å½“å‰ç³»ç»Ÿä¸­çš„æ‰€æœ‰çš„æ´»è·ƒäº‹åŠ¡æ‹·è´åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­(read view) ã€‚</p><p>å†ä¸¾ä¸ªä¾‹å­ï¼Œä»MVCCå¯åŠ¨æ­¥éª¤æ¥åˆ†æã€‚</p><table><thead><tr><th>session 1</th><th>session 2</th><th>æ—¶åˆ»</th></tr></thead><tbody><tr><td>insert test(a) values (10)</td><td></td><td>1</td></tr><tr><td>start transaction;</td><td></td><td>2</td></tr><tr><td>select a from test; return a = 10ï¼›</td><td></td><td>3</td></tr><tr><td>update test set a = 20;</td><td></td><td>4</td></tr><tr><td>-</td><td>start transaction;</td><td>5</td></tr><tr><td>-</td><td>select a from test; return ?</td><td>6</td></tr><tr><td>commit;</td><td></td><td>7</td></tr><tr><td>-</td><td>select a from test; return ?</td><td>8</td></tr></tbody></table><ul><li>æ—¶åˆ»1 å¢åŠ ä¸€è¡Œæ•°æ®å¹¶è‡ªåŠ¨æäº¤ï¼Œåˆ†æè¿™è¡Œæ•°æ®ã€trx_sysã€readview</li></ul><table><thead><tr><th>DB_TRX_ID</th><th>DB_ROLL_PTR</th><th>DB_ROW_ID</th><th>colum a</th></tr></thead><tbody><tr><td>1</td><td>NULL</td><td>1</td><td>10</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trx_sys&#x3D;[]</span><br></pre></td></tr></table></figure><ul><li>æ—¶åˆ»2 session 1å¼€å¯äº‹åŠ¡</li><li>æ—¶åˆ»3 select a from test; return a = 10;åˆ†æè¿™è¡Œæ•°æ®ã€trx_sysã€readview</li></ul><table><thead><tr><th>DB_TRX_ID</th><th>DB_ROLL_PTR</th><th>DB_ROW_ID</th><th>colum a</th></tr></thead><tbody><tr><td>1</td><td>NULL</td><td>1</td><td>10</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">trx_sys&#x3D;[2] </span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šæŸ¥è¯¢ä¸ä¼šæ”¹å˜çš„æ•°æ®è¡Œçš„DB_TRX_IDï¼Œä½†æ˜¯è¿™æ¡è¯­å¥æœ¬èº«çš„DB_TRX_IDä¼šé€’å¢ï¼Œå³ä¸º2ï¼Œé«˜ä½æ°´ä½æ˜¯ä»¥å½“å‰sqlçš„DB_TRX_IDè¿›è¡Œè®¡ç®—</span><br><span class="line"></span><br><span class="line">readview&#x3D;[low_limit_id(3),up_limit_id(2),trx_sys&#123;2&#125;]</span><br></pre></td></tr></table></figure><hr><p>æ ¹æ®readviewè§„åˆ™ï¼š</p><p>DB_TRX_ID &lt;low_limit_idåˆ™è¯¥è¡Œå¯¹äºå½“å‰Read Viewæ˜¯å¯è§çš„ </p><p>DB_TRX_ID &gt;= up_limit_id åˆ™è¯¥è¡Œå¯¹äºå½“å‰Read Viewæ˜¯å¯è§çš„</p><p>å¦‚æœDB_TRX_ID(1) &lt;low_limit_id(3) åˆ™è¯¥è¡Œå¯¹äºå½“å‰Read Viewæ˜¯å¯è§çš„   </p><p>æ»¡è¶³è§„åˆ™ï¼Œåˆ™å¯è§</p><p>å¦‚æœDB_TRX_ID(1) &gt;= up_limit_id(2) åˆ™è¯¥è¡Œå¯¹äºå½“å‰Read Viewæ˜¯ä¸å¯è§çš„</p><p>ä¸æ»¡è¶³è§„åˆ™ï¼Œåˆ™å¯è§</p><p>ç”±äºè§„åˆ™éƒ½å¯è§ï¼Œæ‰€ä»¥æŸ¥è¯¢ç»“æœä¸ºDB_TRX_ID=1æ—¶çš„colum a=10</p><hr><ul><li>æ—¶åˆ»4 update test set a = 20;åˆ†æè¿™è¡Œæ•°æ®ã€trx_sysã€readviewã€undo log</li></ul><table><thead><tr><th>DB_TRX_ID</th><th>DB_ROLL_PTR</th><th>DB_ROW_ID</th><th>colum a</th></tr></thead><tbody><tr><td>2</td><td>DB_TRX_ID[1]</td><td>1</td><td>20</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">trx_sys&#x3D;[3]â†’[2]</span><br><span class="line"></span><br><span class="line">readview&#x3D;[low_limit_id(4),up_limit_id(2)ï¼Œtrx_sys&#123;3ï¼Œ2&#125;]</span><br></pre></td></tr></table></figure><ul><li>æ—¶åˆ»5 session 2å¼€å¯äº‹åŠ¡</li><li>æ—¶åˆ»6 select a from test;ï¼ˆè·å–å¿«ç…§ï¼‰</li><li>åˆ†æè¿™è¡Œçš„éšè—åˆ—ã€trx_sysã€readview</li></ul><table><thead><tr><th>DB_TRX_ID</th><th>DB_ROLL_PTR</th><th>DB_ROW_ID</th><th>colum a</th></tr></thead><tbody><tr><td>2</td><td>DB_TRX_ID[1]</td><td>1</td><td>20</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">trx_sys&#x3D;[4]â†’[3]â†’[2]</span><br><span class="line"></span><br><span class="line">readview&#x3D;[low_limit_id(5),up_limit_id(2)ï¼Œtrx_sys&#123;4,3,2&#125;]</span><br></pre></td></tr></table></figure><hr><p>æ ¹æ®readviewè§„åˆ™ï¼š</p><p>DB_TRX_ID &lt;low_limit_idåˆ™è¯¥è¡Œå¯¹äºå½“å‰Read Viewæ˜¯å¯è§çš„ </p><p>DB_TRX_ID &gt;= up_limit_id åˆ™è¯¥è¡Œå¯¹äºå½“Read Viewæ˜¯ä¸å¯è§çš„</p><p>å¦‚æœDB_TRX_ID(2) &lt;low_limit_id(5) åˆ™è¯¥è¡Œå¯¹äºå½“å‰Read Viewæ˜¯å¯è§çš„ </p><p>æ»¡è¶³æ¡ä»¶ï¼Œåˆ™å¯è§</p><p>å¦‚æœDB_TRX_ID(2) &gt;= up_limit_id(2) åˆ™è¯¥è¡Œå¯¹äºå½“å‰Read Viewæ˜¯ä¸å¯è§çš„  </p><p>æ»¡è¶³æ¡ä»¶ï¼Œåˆ™ä¸å¯è§</p><p>ç»“è®ºï¼šç”±äºè§„åˆ™2æ»¡è¶³ï¼Œåˆ™è¯¥è¡Œå¯¹äºå½“å‰Read Viewæ˜¯ä¸å¯è§,åˆ™é€šè¿‡å›æ»šæŒ‡é’ˆDB_ROLL_PTR=[2]â†’[1]å’Œundo log[2]â†’[1]è®¡ç®—å‡ºDB_TRX_ID=1æ—¶çš„è¡Œæ•°æ®ï¼Œåˆ™ç»§ç»­åˆ†æ</p><p>å¦‚æœDB_TRX_ID(1) &lt;low_limit_id(5) åˆ™è¯¥è¡Œå¯¹äºå½“å‰Read Viewæ˜¯ä¸€å®šå¯è§çš„   </p><p>æ»¡è¶³æ¡ä»¶ï¼Œåˆ™å¯è§</p><p>å¦‚æœDB_TRX_ID(1) &gt;= up_limit_id(2) åˆ™è¯¥è¡Œå¯¹äºå½“å‰Read Viewæ˜¯ä¸€å®šä¸å¯è§çš„ </p><p>ä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™å¯è§</p><p>ç»“è®ºï¼šåˆ™DB_TRX_ID[1]è¿™è¡Œå¯¹å½“å‰read viewå¯è§</p><p>åˆ™æŸ¥è¯¢ç»“æœä¸ºcolum a=10</p><hr><ul><li>æ—¶åˆ»7 session 1 æäº¤äº‹åŠ¡</li></ul><table><thead><tr><th>DB_TRX_ID</th><th>DB_ROLL_PTR</th><th>DB_ROW_ID</th><th>colum</th></tr></thead><tbody><tr><td>2</td><td>DB_TRX_ID[1]</td><td>1</td><td>20</td></tr></tbody></table><p>æäº¤äº‹åŠ¡åä¼šæŠŠäº‹åŠ¡é“¾è¡¨å·²æäº¤çš„äº‹åŠ¡idå»æ‰ï¼Œåˆ™å½“å‰trx_sysä¸º[4]</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trx_sys&#x3D;[4]</span><br></pre></td></tr></table></figure><ul><li>æ—¶åˆ»8 select a from test</li></ul><p>æ³¨æ„ï¼Œåœ¨æ­¤ä¹‹å‰éƒ½æ‰€æœ‰ç»“è®ºéƒ½è¯•ç”¨äºrrå’Œrcï¼Œè€Œè¿™é‡Œä¸åŒ</p><h2 id="åœ¨rcçš„éš”ç¦»çº§åˆ«ä¸‹"><a href="#åœ¨rcçš„éš”ç¦»çº§åˆ«ä¸‹" class="headerlink" title="åœ¨rcçš„éš”ç¦»çº§åˆ«ä¸‹"></a>åœ¨rcçš„éš”ç¦»çº§åˆ«ä¸‹</h2><p>ç”±äºæ¯æ¬¡æŸ¥è¯¢éƒ½æ˜¯è¯»å–åˆ°æœ€æ–°çš„readviewï¼Œæ‰€ä»¥æœ¬æ¬¡æŸ¥è¯¢çš„è¡Œæ•°æ®å¦‚ä¸‹</p><table><thead><tr><th>DB_TRX_ID</th><th>DB_ROLL_PTR</th><th>DB_ROW_ID</th><th>colum a</th></tr></thead><tbody><tr><td>2</td><td>DB_TRX_ID[1]</td><td>1</td><td>20</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">trx_sys&#x3D;[5]â†’[4]</span><br><span class="line"></span><br><span class="line">readview&#x3D;[low_limit_id(6),up_limit_id(4)ï¼Œtrx_sys&#123;5,4&#125;]</span><br></pre></td></tr></table></figure><hr><p>æ ¹æ®readviewè§„åˆ™ï¼š</p><p>DB_TRX_ID &lt;low_limit_idåˆ™è¯¥è¡Œå¯¹äºå½“å‰Read Viewæ˜¯å¯è§çš„ </p><p>DB_TRX_ID &gt;= up_limit_id åˆ™è¯¥è¡Œå¯¹äºå½“Read Viewæ˜¯ä¸å¯è§çš„</p><p>å¦‚æœDB_TRX_ID(2) &lt;low_limit_id(6) åˆ™è¯¥è¡Œå¯¹äºå½“å‰Read Viewæ˜¯å¯è§çš„ </p><p>æ»¡è¶³æ¡ä»¶ï¼Œåˆ™å¯è§</p><p>å¦‚æœDB_TRX_ID(2) &gt;= up_limit_id(4) åˆ™è¯¥è¡Œå¯¹äºå½“å‰Read Viewæ˜¯ä¸å¯è§çš„  </p><p>ä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™å¯è§</p><p>ç»“è®ºï¼šåˆ™DB_TRX_ID[2]è¿™è¡Œå¯¹å½“å‰read viewå¯è§</p><p>åˆ™æŸ¥è¯¢ç»“æœä¸ºcolum a=20  </p><hr><h2 id="åœ¨rrçš„éš”ç¦»çº§åˆ«ä¸‹"><a href="#åœ¨rrçš„éš”ç¦»çº§åˆ«ä¸‹" class="headerlink" title="åœ¨rrçš„éš”ç¦»çº§åˆ«ä¸‹"></a>åœ¨rrçš„éš”ç¦»çº§åˆ«ä¸‹</h2><p>ç”±äºæ¯æ¬¡æŸ¥è¯¢éƒ½æ˜¯è¯»å–åˆ°ç¬¬ä¸€æ¬¡æŸ¥è¯¢åˆ›å»ºçš„readviewï¼Œæ‰€ä»¥æœ¬æ¬¡æŸ¥è¯¢ç›´æ¥è¯»å–çš„æ˜¯æ—¶åˆ»6è·å–åˆ°çš„readviewï¼Œå³</p><p>readview=[low_limit_id(5),up_limit_id(2)ï¼Œtrx_sys{4,3,2}] </p><p>è€Œé€šè¿‡è¿™ä¸ªreadviewè®¡ç®—å‡ºæ¥çš„è¡Œæ•°æ®ä¸ºcolum a=10</p><p>åˆ™æŸ¥è¯¢ç»“æœä¸ºcolum a=10</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å¯èƒ½çœ‹åˆ°æ­¤æ—¶ï¼Œä½ ä¼šè§‰å¾—æœ‰ç‚¹ç»•ï¼Œä¸ºä»€ä¹ˆrcçš„éš”ç¦»çº§åˆ«å’Œrrçš„éš”ç¦»çº§åˆ«åœ¨å¦å¤–ä¸€ä¸ªäº‹åŠ¡æäº¤å®Œäº†ä¹‹åè¯»å–çš„æ•°å€¼æ˜¯ä¸ä¸€æ ·çš„å‘¢ï¼Ÿ</p><p>å…¶å®çœ‹çœ‹æœ€ä¸Šé¢çš„æˆ‘å¯¹äº‹åŠ¡éš”ç¦»çº§åˆ«çš„å®šä¹‰å°±èƒ½æ˜ç™½</p><p>åœ¨rcçš„éš”ç¦»çº§åˆ«ä¸­ï¼Œå¼€å¯ä¸€ä¸ªäº‹åŠ¡selectéƒ½ä¼šæ˜¯æœ€æ–°çš„readview</p><p>åœ¨rrçš„éš”ç¦»çº§åˆ«ä¸­ï¼Œå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œæ¯ä¸ªselectéƒ½ä¼šè¯»å–ç¬¬ä¸€æ¬¡æŸ¥è¯¢å¾—åˆ°çš„readview</p><p>ç„¶åå¦‚æœå¯¹readviewçš„è§„åˆ™è¿˜ä¸å¤ªç†è§£ï¼Œæˆ‘å†è¯´ä¸€å¥ï¼š</p><p>ä¸€ä¸ªæ•°æ®ç‰ˆæœ¬ï¼Œå¯¹äºä¸€ä¸ªäº‹åŠ¡è§†å›¾æ¥è¯´ï¼Œé™¤äº†è‡ªå·±çš„æ›´æ–°æ€»æ˜¯å¯è§ä»¥å¤–ï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼šç‰ˆæœ¬æœªæäº¤ï¼Œä¸å¯è§ï¼›ç‰ˆæœ¬å·²æäº¤ï¼Œä½†æ˜¯æ˜¯åœ¨è§†å›¾åˆ›å»ºåæäº¤çš„ï¼Œä¸å¯è§ï¼›ç‰ˆæœ¬å·²æäº¤ï¼Œè€Œä¸”æ˜¯åœ¨è§†å›¾åˆ›å»ºå‰æäº¤çš„ï¼Œå¯è§ã€‚</p><p>æˆ‘è§‰å¾—è¿™æ ·è®²èƒ½æ›´æ·±åœ°ç†è§£éš”ç¦»çº§åˆ«çš„åŒºåˆ«ï¼Œè‡³äºéš”ç¦»çº§åˆ«çš„ä¸åŒæ˜¯å› ä¸ºä»–ä»¬çš„åº•å±‚åŸç†ä¸åŒï¼šè¿™é‡Œç®€å•è®²ä¸‹ï¼Œrrçš„éš”ç¦»çº§åˆ«æ¯”rcå¤šäº†ä¸€ç§é”â€”â€”â€”â€”é—´éš™é”ï¼ˆGap Locksï¼‰ã€‚</p><p>é—´éš™é”è·ŸMVCCä¸€èµ·å·¥ä½œã€‚å®ç°äº‹åŠ¡å¤„ç†ï¼š</p><p>åœ¨rréš”ç¦»çº§åˆ«ï¼šé‡‡ç”¨Gap Locks(é—´éš™é”) æ¥è§£å†³å¹»è¯»é—®é¢˜</p><p>åœ¨rcéš”ç¦»çº§åˆ«ï¼šé‡‡ç”¨Recordé”,ä¸ä¼šå‡ºç°è„è¯»ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿâ€å¹»è¯»â€é—®é¢˜. ä¹Ÿä¼šå‡ºç°å¯é‡å¤è¯»</p><p>å…³äºMysqlé”çš„æ¦‚å¿µæˆ‘ä¼šåœ¨åé¢ç»§ç»­æ·±å…¥è®²è§£ï¼Œåœ¨æ­¤å¤„å°±ä¸åšè¿‡å¤šçš„æ·±ç©¶äº†ã€‚</p><p>æœ€åè¯´ä¸€å¥ï¼Œæ•°æ®å¤šç‰ˆæœ¬(MVCC)æ˜¯Mysqlå®ç°é«˜æ€§èƒ½çš„ä¸€ä¸ªä¸»è¦çš„ä¸€ä¸ªä¸»è¦æ–¹å¼ï¼Œé€šè¿‡å¯¹æ™®é€šçš„SELECTä¸åŠ é”ï¼Œç›´æ¥åˆ©ç”¨MVCCè¯»å–æŒ‡ç‰ˆæœ¬çš„å€¼ã€‚ä¸åŒçš„äº‹åŠ¡è®¿é—®ä¸åŒç‰ˆæœ¬çš„æ•°æ®å¿«ç…§ï¼Œä»è€Œå®ç°ä¸åŒçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚è™½ç„¶å­—é¢ä¸Šæ˜¯è¯´å…·æœ‰å¤šä¸ªç‰ˆæœ¬çš„æ•°æ®å¿«ç…§ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æ•°æ®åº“å¿…é¡»æ‹·è´æ•°æ®ï¼Œä¿å­˜å¤šä»½æ•°æ®æ–‡ä»¶ï¼Œè¿™æ ·ä¼šæµªè´¹å¤§é‡çš„å­˜å‚¨ç©ºé—´ã€‚InnoDBé€šè¿‡äº‹åŠ¡çš„undologå·§å¦™åœ°å®ç°äº†å¤šç‰ˆæœ¬çš„æ•°æ®å¿«ç…§ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://mp.weixin.qq.com/s/tNA_-_MoYt1fJT0icyKbMg" target="_blank" rel="noopener">MVCCåŸç†æ¢ç©¶åŠMysqlæºç å®ç°åˆ†æ</a></p><p><a href="http://www.sysdb.cn/index.php/2017/07/04/Mysql-mvcc/#more-33" target="_blank" rel="noopener">Mysql MVCCå®ç°</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
            <tag> MVCC </tag>
            
            <tag> äº‹åŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ªäººæ€»ç»“(2020.5)</title>
      <link href="/2020/06/07/summary/summary-2020-5/"/>
      <url>/2020/06/07/summary/summary-2020-5/</url>
      
        <content type="html"><![CDATA[<h1 id="æ„Ÿæ…¨"><a href="#æ„Ÿæ…¨" class="headerlink" title="æ„Ÿæ…¨"></a>æ„Ÿæ…¨</h1><p>å…¬å¸çš„æœˆæ€»ç»“å¥½ä¹…æ²¡å†™äº†ï¼Œé¢†å¯¼ç°åœ¨ä¹Ÿæ²¡æœ‰å¼ºåˆ¶è¦æ±‚ï¼Œå…¶å®æƒ³äº†ä¸€ä¸‹ï¼Œå¯¹äºä¸ªäººå‘å±•æ¥è¯´ï¼Œæœˆæ€»ç»“è¿˜æ˜¯æœ‰å¿…è¦çš„ï¼Œå¯ä»¥ä¸æ–­ç£ä¿ƒè‡ªå·±å¯¹å­¦ä¹ ã€ç”Ÿæ´»çš„è¿½æ±‚å¹¶æ ¹æ®å®é™…æƒ…å†µæ”¹è¿›ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="æŠ€æœ¯"><a href="#æŠ€æœ¯" class="headerlink" title="æŠ€æœ¯"></a>æŠ€æœ¯</h2><h3 id="æ–‡ç« "><a href="#æ–‡ç« " class="headerlink" title="æ–‡ç« "></a>æ–‡ç« </h3><p>5æœˆæˆ‘ä¸€å…±å‘å¸ƒäº†12ç¯‡æ–‡ç« ï¼Œä»æ€æƒ³å’ŒæŠ€æœ¯éƒ½å†™äº†ä¸€äº›æ€»ç»“ã€‚</p><p>ä¸»è¦å…³äºdevopsã€è´Ÿè½½å‡è¡¡ã€è‡ªåŠ¨åŒ–ã€é«˜å¯ç”¨ã€å®¹å™¨åŒ–çš„æ–‡ç« ã€‚</p><h3 id="å­¦ä¹ ï¼š"><a href="#å­¦ä¹ ï¼š" class="headerlink" title="å­¦ä¹ ï¼š"></a>å­¦ä¹ ï¼š</h3><p>æˆ‘å­¦äº†å¤§æ¦‚2ä¸ªæ˜ŸæœŸçš„mysqlï¼Œä¸»è¦æ˜¯å¯¹mysqlçš„äº‹åŠ¡çš„ç†è§£ã€ç´¢å¼•çš„åŸç†ã€InnoDBå¼•æ“çš„åŸç†ä»¥åŠå¯¹åŠ é”çš„åˆ†æè¿™4ä¸ªæ–¹å‘ï¼Œç›®çš„æƒ³åœ¨å®æˆ˜ä¸­æœ‰èƒ½åŠ›åˆ¤æ–­ä¸€ä¸ªsqlè¯­å¥çš„åˆç†æ€§ï¼Œæ¯•ç«Ÿä½œä¸ºä¸€ä¸ªè¿ç»´ï¼Œåœ¨ä¸Šçº¿å‰æˆ‘éœ€è¦æ‰§è¡Œè®¸å¤šsqlï¼Œå¦‚æœä¸ä»”ç»†äº†è§£ä¸‹mysqlï¼Œå…¨é å¼€å‘å†™çš„sqlï¼ˆä¸æ˜¯ä¸ç›¸ä¿¡å¼€å‘ï¼‰è€Œä¸æ‡‚ä»–ä»¬å†™sqlè¯­å¥çš„ä¼˜åŠ£ï¼Œæˆ‘å°±åªæ˜¯ä¸€ä¸ªè«å¾—æ„Ÿæƒ…çš„æ‰§è¡Œè€…ï¼ˆè™½ç„¶è¿˜æœ‰DBAå’ŒSEEå¹³å°å¸®åŠ©ï¼‰ã€‚ä½†æ˜¯äººæ€»è¦æˆé•¿çš„ï¼Œæˆ‘å¾—æœ‰è‡ªå·±å¯¹mysqlçš„ç†è§£ï¼Œèƒ½åˆ¤æ–­ä»€ä¹ˆæƒ…å†µæ‰§è¡Œä»€ä¹ˆsqlï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆé£é™©ï¼Œæœ‰æ²¡æœ‰å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼Œè¿™æ ·å¯¹è‡ªå·±çš„æé«˜çš„æ˜¯å¾ˆå¤§çš„ã€‚å› ä¸ºæˆ‘å·²ç»æœ‰äº†è¿™ä¹ˆå¤šæœºä¼šï¼ˆæ‰§è¡Œçš„æœºä¼šï¼‰ï¼Œè€Œä»æ¥ä¸æ‡‚å¾—åˆ†æï¼Œæˆ‘æ— å½¢ä¸­å·²ç»å¤±å»äº†å¾ˆå¤šé”»ç‚¼è‡ªå·±ç†è§£çš„æœºä¼šã€‚</p><p>å­¦äº†å¤§æ¦‚1ä¸ªæ˜ŸæœŸçš„dockeråº•å±‚åŸç†åŠå¸¸ç”¨å‘½ä»¤ï¼Œè™½ç„¶dockerç”¨çš„å¾ˆæ—©ï¼Œä¸è¿‡è¿˜çœŸæ²¡äº†è§£ä¸‹dockerçš„åº•å±‚åŸç†ï¼Œäº†è§£åæ‰å‘ç°åŸæ¥ä¸€ä¸ª100è¡Œçš„shellè„šæœ¬å°±å¯ä»¥å®ç°dockerçš„åŸºæœ¬åŠŸèƒ½ï¼Œæ€»çš„æ¥è¯´ç°åœ¨å¯¹å®¹å™¨åŒ–åº•å±‚åŸç†æœ‰äº†ä¸€ä¸ªåŸºæœ¬çš„è®¤çŸ¥ï¼Œä¸è¿‡è¿˜ä¸å¤Ÿæ·±å…¥ï¼Œæ‰€ä»¥æ–‡ç« æš‚æ—¶ä¹Ÿä¸å‘äº†ï¼Œå¤šæ·±å…¥äº†è§£åå†å†™å‡ºè‡ªå·±çš„é¡¶çº§ç†è§£çš„å¥½æ–‡ç« ã€‚</p><p>æ€»ç»“çš„ä¸œè¥¿æœ‰ç‚¹å¤šè¿˜æ²¡å‘å‡ºæ¥ï¼Œ6æœˆåº”è¯¥èƒ½å‘å®ŒMysqlå’Œdockerçš„æ–‡ç« å§ã€‚</p><h2 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h2><h3 id="ä½œæ¯æ—¶é—´"><a href="#ä½œæ¯æ—¶é—´" class="headerlink" title="ä½œæ¯æ—¶é—´"></a>ä½œæ¯æ—¶é—´</h3><p>5æœˆæˆ‘çš„ç”Ÿæ´»æ˜¯å¾ˆå……å®çš„ï¼ŒèŠ±äº†å¤§æ—¶é—´åœ¨å­¦ä¹ ï¼Œæ€»æ„Ÿè§‰æ—¶é—´è¿‡çš„å¾ˆå¿«ï¼Œæˆ‘æ¯å¤©çš„ä½œæ¯ä¸æ˜¯ç‰¹åˆ«è§„å¾‹ï¼Œç»å¸¸ç†¬å¤œï¼Œè¿™ä¸ªæœˆè¶…è¿‡12ç‚¹ç¡è§‰ä¸€å…±æœ‰17å¤©ï¼Œå¹³å‡ç¡è§‰æ—¶é•¿ä¸º6å°æ—¶51åˆ†é’Ÿã€‚æˆ‘å†³å®šåœ¨6æœˆè°ƒæ•´è¿‡æ¥ï¼Œæ¯å¤©å°½é‡ä¸ç†¬å¤œï¼Œå­¦ä¹ çŸ¥è¯†éšæ—¶è®°å½•è¿™æ ·ä¸ä¼šæµªè´¹æ›´å¤šæ—¶é—´åœ¨å›æƒ³å½“åˆå·¥ä½œçš„è¿‡ç¨‹ä¸Šã€‚</p><h3 id="åšé¥­"><a href="#åšé¥­" class="headerlink" title="åšé¥­"></a>åšé¥­</h3><p>è¿™ä¸ªæœˆåšäº†å‡ æ¬¡é¥­ï¼š2æ¬¡å¯ä¹é¸¡ç¿…ï¼Œ1æ¬¡çƒ§é¸¡è…¿ï¼Œ2æ¬¡ç‰›æ’ï¼Œ2æ¬¡ç•ªèŒ„é¸¡è›‹ï¼Œåšäº†ä¸€ä¸ªæ˜ŸæœŸçš„æ—©é¤ï¼ˆç…®é¢ï¼‰ã€‚</p><p>æ€»ä½“æ¥è¯´æ¯æ¬¡åšçš„é¥­éƒ½èƒ½åƒï¼Œè€Œä¸”ä¸€æ¬¡åšé¥­æ¯”ä¸€æ¬¡ç†Ÿç»ƒï¼Œè¿™æ ·å¯ä»¥å‡å°‘åƒå¤–å–çš„æ¬¡æ•°ï¼Œæœ‰æ—¶é—´èƒ½å¤šåšä¸‹é¥­å¥–åŠ±è‡ªå·±å“ˆå“ˆï¼Œæ¯•ç«Ÿæƒ³è®©å‘½æŒæ¡åœ¨è‡ªå·±çš„æ‰‹é‡Œã€‚</p><h3 id="é”»ç‚¼"><a href="#é”»ç‚¼" class="headerlink" title="é”»ç‚¼"></a>é”»ç‚¼</h3><p>è¿™ä¸ªæœˆé”»ç‚¼äº†7å¤©ï¼Œæœ¬æ¥æƒ³ç€æ˜¯æ¯å¤©éƒ½é”»ç‚¼ï¼Œç„¶åå®šå®Œè®¡åˆ’åå‘ç°ä¸å¤ªç°å®ï¼Œæ¯å¤©å­¦ä¹ çš„æ—¶é—´å¤ªå°‘äº†ï¼Œè€Œä¸”é”»ç‚¼å®Œå›å®¶æ´—æ¾¡å°±æƒ³æ”¾æ¾ï¼ˆå •è½ï¼‰ï¼Œå°±å¾ˆçƒ¦ï¼Œæ²¡æœ‰ä¸€æ¬¡é”»ç‚¼å®Œå›æ¥èƒ½å®‰å¿ƒå­¦ä¹ çš„ã€‚ä¸è¿‡å¬ä¸€ä½é“æ•™å­¦è€…å‘Šè¯«æˆ‘çš„ï¼Œé”»ç‚¼å¯ä»¥æ—©ä¸Šèµ°èµ°ï¼Œä¸ä¸€å®šç­‰æ™šä¸Šï¼Œè¦å­¦ä¼šæ”¾æ¾ï¼Œèµ°è·¯çš„æ—¶å€™ï¼Œæ³¨æ„ï¼Œè™šçµé¡¶åŠ²ã€æ¾è…°å‚è‡€ã€æ²‰è‚©å è‚˜äº‘äº‘ï¼Œè™½ç„¶æˆ‘ä¹Ÿä¸æ‡‚ï¼Œä¸è¿‡6æœˆå¯ä»¥è¯•è¯•ï¼Œç­‰ä¸æƒ³å­¦ä¹ çš„æ—¶å€™å°±å»èµ°èµ°ã€‚</p><h1 id="å¯¹è‡ªå·±è¯´"><a href="#å¯¹è‡ªå·±è¯´" class="headerlink" title="å¯¹è‡ªå·±è¯´"></a>å¯¹è‡ªå·±è¯´</h1><p>5æœˆå¯ä»¥è¯´æ˜¯æˆ‘æ€æƒ³çš„å‡åæœŸï¼Œè®¸å¤šå¤§ç‰›å¯¹æˆ‘çš„æŒ‡ç‚¹è®©æˆ‘å¯¹äº’è”ç½‘æ•´ä¸ªè¡Œä¸šçš„æ ¼å±€æœ‰äº†ä¸€å®šçš„è®¤çŸ¥ï¼Œå¯¹æœªæ¥å……æ»¡äº†æ–°çš„å¸Œæœ›ï¼Œæƒ³èµ¶å¿«æˆé•¿ï¼Œæˆä¸ºäº’è”ç½‘çš„å¼„æ½®å„¿ã€‚</p><p>æœ‰æƒ³æ³•å°±æœ‰è¡ŒåŠ¨ï¼šç›´æ¥ç°è±¡å°±æ˜¯æˆ‘åœ¨ä¸åœçš„å­¦ä¹ ï¼Œæ²¡æœ‰ä»»ä½•äººä»»ä½•äº‹èƒ½é˜»æ­¢æˆ‘å­¦ä¹ ï¼Œå¸¦æ¥çš„å°±æ˜¯å„ç§ä»ç”Ÿæ´»ä¸ŠæŒ¤æ—¶é—´ã€‚ç„¶åå°±å‡ºç°äº†ä¸€ä¸ªæ¯”è¾ƒæ®‹é…·çš„ç°å®ï¼Œåœ¨å­¦ä¹ Mysqlçš„æ—¶å€™æˆ‘æ›¾ç»ä¸€åº¦èµ°ç«å…¥é­”ï¼ŒæŠŠè‡ªå·±é€¼å¾—å¾ˆç´§ï¼Œæƒ³å¿«é€Ÿäº†è§£ï¼Œä½†æ˜¯åˆå¾ˆéš¾åƒé€ï¼Œäºæ˜¯å½¢æˆäº†æ¶æ€§å¾ªç¯ã€‚</p><p>è¿™æ®µæœŸé—´ï¼šæˆ‘å­¦ä¹ åˆ°éš¾ç‚¹çš„æ—¶å€™å°±ä¼šå¾ˆçƒ¦ï¼Œä¸æƒ³å­¦ï¼Œä½†æ˜¯ä¸€åœä¸‹æ¥ï¼ˆä¸ç®¡æ˜¯èººç€ä¼‘æ¯è¿˜æ˜¯ç©æ¸¸æˆï¼‰æˆ‘å¿ƒé‡Œéƒ½ä¼šåå¤å‚é—®æˆ‘ï¼Œä¸èƒ½è‡ªç”˜å •è½ï¼Œä½†æ˜¯å­¦åˆå­¦ä¸è¿›å»ã€‚æ‰“ä¸€æŠŠlolå¿ƒæ€ä¸€å´©å°±ç›´æ¥alt+f4ï¼Œæƒ³ç¡è§‰å¿ƒé‡Œå´ä¸€ç›´åœ¨æƒ³è¿™ä¸ªæ²¡è¿‡å»çš„åã€‚æ•´ä¸ªäººç²¾ç¥æ¥è¿‘å´©æºƒçš„è¾¹ç¼˜ã€‚</p><p>è¿˜å¥½å‘¨å›´æœ‰ä¸€äº›äººåŠæ—¶ç–å¯¼æˆ‘(å¹´è½»äººä¸è¦ç»™è‡ªå·±å¤ªå¤§å‹åŠ›)ï¼Œæ…¢æ…¢æ¶ˆåŒ–æœ€ç»ˆæŠŠè¿™æ®µæ—¶å…‰åº¦è¿‡ã€‚åœ¨æ­¤æ„Ÿè°¢æˆ‘çš„å®¤å‹ã€åŒå­¦ã€æœ‹å‹ã€é¢†å¯¼è¿™æ®µæ—¶é—´å¯¹æˆ‘ä¸åŒå…¶çƒ¦è¿›è¡Œç–å¯¼ã€‚</p><h1 id="å‘å‰çœ‹"><a href="#å‘å‰çœ‹" class="headerlink" title="å‘å‰çœ‹"></a>å‘å‰çœ‹</h1><p>6æœˆæˆ‘ä¼šåœ¨æŠ€æœ¯ä¸Šå¯¹mysqlã€dockerã€k8sè¿›è¡Œæ›´æ·±çš„å­¦ä¹ ï¼Œå¯¹ç”Ÿæ´»è¿›è¡Œæ›´åˆç†çš„å®‰æ’ï¼Œä¿è¯ç¡çœ ã€é”»ç‚¼ã€å·¥ä½œã€å­¦ä¹ äº’ç›¸ä¸è€½è¯¯ã€‚</p><h1 id="åè¨€å…±å‹‰"><a href="#åè¨€å…±å‹‰" class="headerlink" title="åè¨€å…±å‹‰"></a>åè¨€å…±å‹‰</h1><p>ç§ä¸€æ£µæ ‘æœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ï¼Œå…¶æ¬¡æ˜¯ç°åœ¨ã€‚</p><p>ä½ æ¯å¤©å¿˜è®°çš„äº‹æœ‰ä¸Šåƒä»¶ï¼Œä½•ä¸ä¹Ÿå¿˜äº†è¿™ä»¶äº‹ã€‚</p><p>æ•…å¸¸æ— æ¬²ï¼Œä»¥è§‚å…¶å¦™ï¼›å¸¸æœ‰æ¬²ï¼Œä»¥è§‚å…¶å¾¼ã€‚</p><p>å¼±å°çš„äººæ‰ä¹ æƒ¯å˜²è®½å’Œå¦å®šï¼Œè€Œå†…å¿ƒå¼ºå¤§çš„äººä»ä¸åå•¬èµç¾å’Œé¼“åŠ±ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ä¸ªäººæ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¸ªäººæ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå®‰è£…ä¸€å¥—ä¸­é—´ä»¶</title>
      <link href="/2020/06/07/docker/docker-install-middleware/"/>
      <url>/2020/06/07/docker/docker-install-middleware/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>é¢†å¯¼è¦æˆ‘éƒ¨ç½²å‹æµ‹ç¯å¢ƒä¸­é—´ä»¶ï¼Œä¸€å¥—ä¸­é—´ä»¶ä»¥å¾€éƒ½æ˜¯å»º3å°è™šæ‹Ÿæœºï¼Œä½†æ˜¯æˆ‘è¿™æ¬¡æƒ³ç”¨dockeréƒ¨ç½²ï¼Œåˆç†åˆ©ç”¨dockeræé«˜èµ„æºåˆ©ç”¨ç‡ä»¥åŠç»´æŠ¤æ–¹ä¾¿ã€‚</p><h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><h2 id="ç¡¬ä»¶é…ç½®"><a href="#ç¡¬ä»¶é…ç½®" class="headerlink" title="ç¡¬ä»¶é…ç½®"></a>ç¡¬ä»¶é…ç½®</h2><ul><li>cpu:8c </li><li>å†…å­˜:32g </li><li>ç¡¬ç›˜:100g</li></ul><h2 id="è½¯ä»¶é…ç½®"><a href="#è½¯ä»¶é…ç½®" class="headerlink" title="è½¯ä»¶é…ç½®"></a>è½¯ä»¶é…ç½®</h2><ul><li>centos:7.6 </li><li>docker:19.03 </li><li>nacos:1.1.3  åªåšé…ç½®ä¸­å¿ƒ  å•æœº</li><li>zk:3.4 åªåšæ³¨å†Œä¸­å¿ƒ   é›†ç¾¤ </li><li>rocketmq:4.3.2 åªåšæ¶ˆæ¯é˜Ÿåˆ— é›†ç¾¤</li><li>redis 5.0 ç¼“å­˜  é›†ç¾¤</li></ul><h2 id="æœ¬åœ°ç«¯å£è§„åˆ’"><a href="#æœ¬åœ°ç«¯å£è§„åˆ’" class="headerlink" title="æœ¬åœ°ç«¯å£è§„åˆ’"></a>æœ¬åœ°ç«¯å£è§„åˆ’</h2><ul><li>nacosï¼š8848</li><li>zkï¼š<br>zoo1:2181<br>zoo2:2182<br>zoo3:2183</li><li>dubbo-admin:8080</li><li>rocketmqï¼š<br>rmqnamesrv-a:9876<br>rmqnamesrv-b:9877<br>rmqbroker-a:10911<br>rmqbroker-b:10909<br>rmqconsole:9001</li><li>redis:{7010,7011,7012,7013,7014,7015}</li></ul><p>éƒ¨ç½²ä¹‹å‰å…ˆç¡®ä¿ä»¥ä¸Šç«¯å£æ²¡æœ‰è¢«å ç”¨</p><h2 id="æ–‡ä»¶å¤¹ç›®å½•"><a href="#æ–‡ä»¶å¤¹ç›®å½•" class="headerlink" title="æ–‡ä»¶å¤¹ç›®å½•"></a>æ–‡ä»¶å¤¹ç›®å½•</h2><p>å­˜æ”¾é…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@vm-26-21 ~]# mkdir -vp &#x2F;opt&#x2F;&#123;rocketmq4.3.2&#123;&#x2F;broker-a,&#x2F;broker-b&#125;,zookeeper&#125;</span><br><span class="line">[root@vm-26-21 ~]# cd &#x2F;opt</span><br><span class="line">[root@vm-26-21 opt]# tree</span><br><span class="line">â”œâ”€â”€ rocketmq4.3.2</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ broker-a</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ broker-a.conf</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ broker-b</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ broker-b.conf</span><br><span class="line">â”‚Â Â  â””â”€â”€ mq.yml</span><br><span class="line">â””â”€â”€ zookeeper</span><br><span class="line">    â””â”€â”€ zk.yml</span><br></pre></td></tr></table></figure><hr><p>æ—¥å¿—æŒ‚è½½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@vm-26-21 ~]# mkdir -vp &#x2F;data&#x2F;&#123;rocketmq4.3.2,zookeeper&#125;</span><br><span class="line">[root@vm-26-21 ~]# cd &#x2F;opt</span><br><span class="line">[root@vm-26-21 data]# tree</span><br><span class="line">â”œâ”€â”€ rocketmq4.3.2</span><br><span class="line">â””â”€â”€ zookeeper</span><br></pre></td></tr></table></figure><h1 id="nacos"><a href="#nacos" class="headerlink" title="nacos"></a>nacos</h1><p>æˆ‘çš„éƒ¨ç½²æ–¹å¼æ˜¯å•æœºï¼Œå› ä¸ºåªæ˜¯å½“ä½œé…ç½®ä¸­å¿ƒè€Œå·²ï¼Œä¹Ÿæ˜¯çº¿ä¸‹é…ç½®ï¼Œä¸åšæŒä¹…åŒ–ï¼Œåªè¦æœºå™¨è¶³å¤Ÿç¨³å®šï¼ˆä¸å…³æœº/ä¸åˆ é™¤ï¼‰æˆ‘nacoséƒ½å¯åŠ¨äº†1å¹´ï¼Œå•¥äº‹æ²¡æœ‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker pull nacos&#x2F;nacos-server:1.1.3</span><br><span class="line">docker run --env MODE&#x3D;standalone --name nacos --restart always -d -p 8848:8848 nacos&#x2F;nacos-server:1.1.3</span><br><span class="line">å¯åŠ¨æˆåŠŸåè®¿é—®http:&#x2F;&#x2F;ip:8848&#x2F;nacos  </span><br><span class="line">è´¦å·å¯†ç ä¸ºnacos&#x2F;nacos</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ çš„ç›®çš„æ˜¯åšæ³¨å†Œä¸­å¿ƒä»¥åŠåœ¨ç”Ÿäº§ç¯å¢ƒç­‰é‡è¦çš„ç¯å¢ƒéƒ¨ç½²ï¼Œåˆ™éœ€è¦ç”¨æŒä¹…åŒ–éƒ¨ç½²ï¼Œæ— è®ºæ˜¯dockeræˆ–è€…ç‰©ç†éƒ¨ç½²ï¼Œéƒ½éœ€è¦ä¸€ä¸ªæ•°æ®åº“ï¼Œå…·ä½“éƒ¨ç½²è¿‡ç¨‹æˆ‘å°±ä¸è¯¦ç»†å†™äº†ï¼Œç›´æ¥çœ‹å®˜ç½‘ï¼Œè¶³å¤Ÿè¯¦ç»†ã€‚</p><p><a href="https://rugod.cn/2020/05/14/slb/slb-nacos/" target="_blank" rel="noopener">å®ç°è´Ÿè½½å‡è¡¡å™¨æ­é…Nacosé›†ç¾¤çš„é«˜å¯ç”¨æ¡†æ¶</a></p><p><a href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html" target="_blank" rel="noopener">nacoså®˜ç½‘</a></p><h1 id="zk"><a href="#zk" class="headerlink" title="zk"></a>zk</h1><h2 id="åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºé…ç½®æ–‡ä»¶"></a>åˆ›å»ºé…ç½®æ–‡ä»¶</h2><p>vim /opt/zookeeper/zk.yml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;3.1&#39;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  zoo1:</span><br><span class="line">    image: zookeeper</span><br><span class="line">    restart: always</span><br><span class="line">    hostname: zoo1</span><br><span class="line">    ports:</span><br><span class="line">      - 2181:2181</span><br><span class="line">    environment:</span><br><span class="line">      ZOO_MY_ID: 1</span><br><span class="line">      ZOO_SERVERS: server.1&#x3D;0.0.0.0:2888:3888;2181 server.2&#x3D;zoo2:2888:3888;2181 server.3&#x3D;zoo3:2888:3888;2181</span><br><span class="line">    volumes:</span><br><span class="line">    - &#x2F;data&#x2F;zookeeper&#x2F;1&#x2F;:&#x2F;data    </span><br><span class="line">  zoo2:</span><br><span class="line">    image: zookeeper</span><br><span class="line">    restart: always</span><br><span class="line">    hostname: zoo2</span><br><span class="line">    ports:</span><br><span class="line">      - 2182:2181</span><br><span class="line">    environment:</span><br><span class="line">      ZOO_MY_ID: 2</span><br><span class="line">      ZOO_SERVERS: server.1&#x3D;zoo1:2888:3888;2181 server.2&#x3D;0.0.0.0:2888:3888;2181 server.3&#x3D;zoo3:2888:3888;2181</span><br><span class="line">    volumes:</span><br><span class="line">    - &#x2F;data&#x2F;zookeeper&#x2F;2&#x2F;:&#x2F;data   </span><br><span class="line">    </span><br><span class="line">  zoo3:</span><br><span class="line">    image: zookeeper</span><br><span class="line">    restart: always</span><br><span class="line">    hostname: zoo3</span><br><span class="line">    ports:</span><br><span class="line">      - 2183:2181</span><br><span class="line">    environment:</span><br><span class="line">      ZOO_MY_ID: 3</span><br><span class="line">      ZOO_SERVERS: server.1&#x3D;zoo1:2888:3888;2181 server.2&#x3D;zoo2:2888:3888;2181 server.3&#x3D;0.0.0.0:2888:3888;2181</span><br><span class="line">    volumes:</span><br><span class="line">    - &#x2F;data&#x2F;zookeeper&#x2F;3&#x2F;:&#x2F;data   </span><br><span class="line">  admin:</span><br><span class="line">    image: chenchuxin&#x2F;dubbo-admin</span><br><span class="line">    container_name: dubbo-admin</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - 8080:8080</span><br><span class="line">    environment:</span><br><span class="line">      - dubbo.registry.address&#x3D;zookeeper:&#x2F;&#x2F;$&#123;ip&#125;:2181</span><br><span class="line">      - dubbo.admin.root.password&#x3D;root</span><br><span class="line">      - dubbo.admin.guest.password&#x3D;guest</span><br><span class="line"></span><br><span class="line">æ³¨æ„ç‚¹ï¼š</span><br><span class="line">1.è¦æŠŠdubbo.registry.address&#x3D;zookeeper:&#x2F;&#x2F;$&#123;ip&#125;:2181ä¸­çš„ipå¡«ä¸ºæœ¬æœºipï¼ˆä¸æ˜¯å®¹å™¨ipï¼‰</span><br><span class="line">2.zkæŒ‚è½½çš„ç›®å½•æ˜¯&#x2F;data&#x2F;zookeeper&#x2F;&#123;1,2,3&#125;&#x2F;ä¸‹ å¯ä»¥æ ¹æ®éœ€æ±‚æƒ…å†µè¿›è¡Œè°ƒæ•´</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f zk.yml up -d</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹dockerè¿›ç¨‹ï¼Œå¹¶ä¸”æ‰“å¼€dubbo-adminåœ°å€ï¼š</p><p>http://${ip}:8080<br>è´¦å·å¯†ç root/root</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br><span class="line">ecd8e83e8386        chenchuxin&#x2F;dubbo-admin     &quot;catalina.sh run&quot;        38 seconds ago      Up 37 seconds       0.0.0.0:8080-&gt;8080&#x2F;tcp                                 dubbo-admin</span><br><span class="line">a3265cddc63a        zookeeper                  &quot;&#x2F;docker-entrypoint.â€¦&quot;   2 minutes ago       Up 37 seconds       2888&#x2F;tcp, 3888&#x2F;tcp, 8080&#x2F;tcp, 0.0.0.0:2182-&gt;2181&#x2F;tcp   zoo2</span><br><span class="line">1bcea74a1647        zookeeper                  &quot;&#x2F;docker-entrypoint.â€¦&quot;   2 minutes ago       Up 37 seconds       2888&#x2F;tcp, 3888&#x2F;tcp, 8080&#x2F;tcp, 0.0.0.0:2183-&gt;2181&#x2F;tcp   zoo3</span><br><span class="line">ab4f3f15ce5e        zookeeper                  &quot;&#x2F;docker-entrypoint.â€¦&quot;   2 minutes ago       Up 37 seconds       2888&#x2F;tcp, 3888&#x2F;tcp, 0.0.0.0:2181-&gt;2181&#x2F;tcp, 8080&#x2F;tcp   zoo1</span><br></pre></td></tr></table></figure><h1 id="rocketmq"><a href="#rocketmq" class="headerlink" title="rocketmq"></a>rocketmq</h1><h2 id="é›†ç¾¤æ–¹å¼å¯¹æ¯”"><a href="#é›†ç¾¤æ–¹å¼å¯¹æ¯”" class="headerlink" title="é›†ç¾¤æ–¹å¼å¯¹æ¯”"></a>é›†ç¾¤æ–¹å¼å¯¹æ¯”</h2><ul><li>å¤š master æ¨¡å¼<br>å¤šä¸ª master èŠ‚ç‚¹ç»„æˆé›†ç¾¤ï¼Œå•ä¸ª master èŠ‚ç‚¹å®•æœºæˆ–è€…é‡å¯å¯¹åº”ç”¨æ²¡æœ‰å½±å“ã€‚</li></ul><p>ä¼˜ç‚¹ï¼šæ€§èƒ½æœ€é«˜<br>ç¼ºç‚¹ï¼šå•ä¸ª masterèŠ‚ç‚¹å®•æœºæœŸé—´ï¼Œæœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯åœ¨èŠ‚ç‚¹æ¢å¤ä¹‹å‰ä¸å¯ç”¨ï¼Œæ¶ˆæ¯çš„å®æ—¶æ€§å°±å—åˆ°å½±å“ã€‚<br>æ³¨æ„ï¼šä½¿ç”¨åŒæ­¥åˆ·ç›˜å¯ä»¥ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼ŒåŒæ—¶ Topic ç›¸å¯¹åº”çš„ queue åº”è¯¥åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯åªåœ¨æŸå„èŠ‚ç‚¹ä¸Šï¼Œå¦åˆ™ï¼Œè¯¥èŠ‚ç‚¹å®•æœºä¼šå¯¹è®¢é˜…è¯¥ topic çš„åº”ç”¨é€ æˆå½±å“ã€‚</p><ul><li>å¤š master å¤š slave å¼‚æ­¥å¤åˆ¶æ¨¡å¼<br>åœ¨å¤š master æ¨¡å¼çš„åŸºç¡€ä¸Šï¼Œæ¯ä¸ª master èŠ‚ç‚¹éƒ½æœ‰è‡³å°‘ä¸€ä¸ªå¯¹åº”çš„ slaveï¼Œmaster<br>èŠ‚ç‚¹å¯è¯»å¯å†™ï¼Œä½†æ˜¯ slave åªèƒ½è¯»ä¸èƒ½å†™ï¼Œç±»ä¼¼äº mysql çš„ä¸»å¤‡æ¨¡å¼ã€‚</li></ul><p>ä¼˜ç‚¹ï¼š åœ¨ master å®•æœºæ—¶ï¼Œæ¶ˆè´¹è€…å¯ä»¥ä» slave è¯»å–æ¶ˆæ¯ï¼Œæ¶ˆæ¯çš„å®æ—¶æ€§ä¸ä¼šå—å½±å“ï¼Œæ€§èƒ½å‡ ä¹å’Œå¤š master ä¸€æ ·ã€‚<br>ç¼ºç‚¹ï¼šä½¿ç”¨å¼‚æ­¥å¤åˆ¶çš„åŒæ­¥æ–¹å¼æœ‰å¯èƒ½ä¼šæœ‰æ¶ˆæ¯ä¸¢å¤±çš„é—®é¢˜ã€‚</p><ul><li>å¤š master å¤š slave åŒæ­¥åŒå†™æ¨¡å¼<br>åŒå¤š master å¤š slave å¼‚æ­¥å¤åˆ¶æ¨¡å¼ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äº master å’Œ slave ä¹‹é—´çš„æ•°æ®åŒæ­¥æ–¹å¼ã€‚</li></ul><p>ä¼˜ç‚¹ï¼šåŒæ­¥åŒå†™çš„åŒæ­¥æ¨¡å¼èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ã€‚<br>ç¼ºç‚¹ï¼šå‘é€å•ä¸ªæ¶ˆæ¯ RT ä¼šç•¥é•¿ï¼Œæ€§èƒ½ç›¸æ¯”å¼‚æ­¥å¤åˆ¶ä½10%å·¦å³ã€‚</p><p>å‹æµ‹ç¯å¢ƒï¼Œæˆ‘å¸Œæœ›æœ€å¤§çš„åˆ©ç”¨ä¸­é—´ä»¶çš„æ€§èƒ½ï¼Œè§‚å¯Ÿé¡¹ç›®åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç“¶é¢ˆï¼ˆå…¶å®ä¸ç”¨è§‚å¯Ÿï¼Œå¤§éƒ¨åˆ†å‡ºåœ¨é¡¹ç›®å†…éƒ¨ï¼Œéƒ½ä¸ä¼šæŠŠä¸­é—´ä»¶å‹å®ï¼Œæ‡‚çš„éƒ½æ‡‚ï¼‰ã€‚ç”Ÿäº§ç¯å¢ƒå»ºè®®è¿˜æ˜¯ å¤šä¸»å¤šä»å¼‚æ­¥å¤åˆ¶æ¨¡å¼ã€‚</p><h2 id="åˆ›å»ºé…ç½®æ–‡ä»¶-1"><a href="#åˆ›å»ºé…ç½®æ–‡ä»¶-1" class="headerlink" title="åˆ›å»ºé…ç½®æ–‡ä»¶"></a>åˆ›å»ºé…ç½®æ–‡ä»¶</h2><p>æ·»åŠ broker-açš„é…ç½®ä¿¡æ¯</p><p>vim /opt/rocketmq4.3.2/broker-a/broker-a.conf</p><p>${ip}ä¸ºä½ æœ¬æœºip,æ³¨æ„æ›´æ¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">brokerClusterName &#x3D; rocketmq-cluster</span><br><span class="line">brokerName &#x3D; broker-a</span><br><span class="line">brokerId &#x3D; 0</span><br><span class="line">brokerIP1 &#x3D; $&#123;ip&#125;</span><br><span class="line">deleteWhen &#x3D; 04</span><br><span class="line">fileReservedTime &#x3D; 48</span><br><span class="line">namesrvAddr&#x3D; $&#123;ip&#125;:9876; $&#123;ip&#125;:9877</span><br><span class="line">autoCreateTopicEnable&#x3D;true</span><br><span class="line">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£,</span><br><span class="line">listenPort &#x3D; 10911</span><br><span class="line">#Brokerè§’è‰²</span><br><span class="line">#- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master</span><br><span class="line">#- SYNC_MASTER åŒæ­¥åŒå†™Master</span><br><span class="line">#- SLAVE</span><br><span class="line">brokerRole&#x3D;ASYNC_MASTER</span><br><span class="line">#åˆ·ç›˜æ–¹å¼</span><br><span class="line">#- ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜</span><br><span class="line">#- SYNC_FLUSH åŒæ­¥åˆ·ç›˜</span><br><span class="line">flushDiskType&#x3D;ASYNC_FLUSH</span><br></pre></td></tr></table></figure><p>æ·»åŠ broker-bçš„é…ç½®ä¿¡æ¯</p><p>vim /opt/rocketmq4.3.2/broker-b/broker-b.conf</p><p>${ip}ä¸ºä½ æœ¬æœºip,æ³¨æ„æ›´æ¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">brokerClusterName &#x3D; rocketmq-cluster</span><br><span class="line">brokerName &#x3D; broker-b</span><br><span class="line">brokerId &#x3D; 0</span><br><span class="line">brokerIP1 &#x3D; $&#123;ip&#125;</span><br><span class="line">deleteWhen &#x3D; 04</span><br><span class="line">fileReservedTime &#x3D; 48</span><br><span class="line">namesrvAddr&#x3D;$&#123;ip&#125;:9876;$&#123;ip&#125;:9877</span><br><span class="line">autoCreateTopicEnable&#x3D;true</span><br><span class="line">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£,</span><br><span class="line">listenPort &#x3D; 10909</span><br><span class="line">#Brokerè§’è‰²</span><br><span class="line">#- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master</span><br><span class="line">#- SYNC_MASTER åŒæ­¥åŒå†™Master</span><br><span class="line">#- SLAVE</span><br><span class="line">brokerRole&#x3D;ASYNC_MASTER</span><br><span class="line">#åˆ·ç›˜æ–¹å¼</span><br><span class="line">#- ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜</span><br><span class="line">#- SYNC_FLUSH åŒæ­¥åˆ·ç›˜</span><br><span class="line">flushDiskType&#x3D;ASYNC_FLUSH</span><br></pre></td></tr></table></figure><p>æ·»åŠ mqé›†ç¾¤ä¿¡æ¯<br>vim /opt/rocketmq4.3.2/mq.yml </p><p>è¿™ä¸€æ­¥å¾ˆå…³é”®</p><ul><li>é¦–å…ˆç¡®ä¿ä½ æœ¬åœ°å·²ç»åˆ›å»º/data/rocketmq4.3.2ç›®å½•ï¼Œå¹¶ä¸”ä½ çš„é…ç½®æ–‡ä»¶ä¿¡æ¯ä¸º/opt/rocketmq4.3.2/broker-a/broker-a.confå’Œ/opt/rocketmq4.3.2/broker-b/broker-b.conf</li><li>ç„¶åä½ é€‰æ‹©imageçš„ç‰ˆæœ¬å‡ä¸ºrocketmq:4.3.2ï¼Œå¦‚æœæƒ³é€‰æ‹©å…¶ä»–ç‰ˆæœ¬è¯·å°†ä¸‹é¢æ‰€æœ‰4.3.2æ¢ä¸ºä½ æ›´æ”¹çš„</li><li>ç«¯å£å·ç¡®è®¤ä¸å’Œå…¶ä»–å†²çªï¼Œå°¤å…¶æ˜¯rmqconsoleçš„ç«¯å£ï¼Œæˆ‘æœ¬åœ°ç«¯å£è®¾ä¸ºäº†9001</li><li>jvmè°ƒä¼˜ï¼Œæ ¹æ®ä½ æœºå™¨æ€§èƒ½çš„æƒ…å†µè°ƒæ•´ JAVA_OPT_EXT: â€œ-server -Xms4g -Xmx4g -Xmn2gâ€ å‚æ•°ï¼Œå¦‚æœä½ æŠ€èƒ½å†…å­˜å¾ˆå°ï¼Œè¿™ä¸ªå‚æ•°ä¹Ÿéœ€è¦å¯¹åº”è°ƒå°ï¼Œå¦åˆ™å¯åŠ¨ä¸äº†ã€‚</li></ul><p>å¦‚æœéƒ½æ²¡é—®é¢˜ï¼Œå…¨éƒ¨å¤åˆ¶ä¸‹é¢é…ç½®ä¿¡æ¯å³å¯ï¼Œä¸éœ€è¦æ›´ä»»ä½•ä¸œè¥¿</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;3.5&#39;</span><br><span class="line">services:</span><br><span class="line">  rmqnamesrv-a:</span><br><span class="line">    image: rocketmqinc&#x2F;rocketmq:4.3.2</span><br><span class="line">    container_name: rmqnamesrv-a</span><br><span class="line">    ports:</span><br><span class="line">      - 9876:9876</span><br><span class="line">    volumes:</span><br><span class="line">      - &#x2F;data&#x2F;rocketmq4.3.2&#x2F;logs&#x2F;nameserver-a:&#x2F;opt&#x2F;logs</span><br><span class="line">      - &#x2F;data&#x2F;rocketmq4.3.2&#x2F;store&#x2F;nameserver-a:&#x2F;opt&#x2F;store</span><br><span class="line">    environment: </span><br><span class="line">      JAVA_OPT_EXT: &quot;-server -Xms4g -Xmx4g -Xmn2g&quot;</span><br><span class="line">    command: sh mqnamesrv</span><br><span class="line">    networks:</span><br><span class="line">        rmq:</span><br><span class="line">          aliases:</span><br><span class="line">            - rmqnamesrv-a</span><br><span class="line"></span><br><span class="line">  rmqnamesrv-b:</span><br><span class="line">    image: rocketmqinc&#x2F;rocketmq:4.3.2</span><br><span class="line">    container_name: rmqnamesrv-b</span><br><span class="line">    ports:</span><br><span class="line">      - 9877:9877</span><br><span class="line">    volumes:</span><br><span class="line">      - &#x2F;data&#x2F;rocketmq4.3.2&#x2F;logs&#x2F;nameserver-b:&#x2F;opt&#x2F;logs</span><br><span class="line">      - &#x2F;data&#x2F;rocketmq4.3.2&#x2F;store&#x2F;nameserver-b:&#x2F;opt&#x2F;store</span><br><span class="line">    environment:</span><br><span class="line">      JAVA_OPT_EXT: &quot;-server -Xms4g -Xmx4g -Xmn2g&quot;</span><br><span class="line">    command: sh mqnamesrv</span><br><span class="line">    networks:</span><br><span class="line">        rmq:</span><br><span class="line">          aliases:</span><br><span class="line">            - rmqnamesrv-b</span><br><span class="line"></span><br><span class="line">  rmqbroker-a:</span><br><span class="line">    image: rocketmqinc&#x2F;rocketmq:4.3.2</span><br><span class="line">    container_name: rmqbroker-a</span><br><span class="line">    ports:</span><br><span class="line">      - 10911:10911</span><br><span class="line">    volumes:</span><br><span class="line">      - &#x2F;data&#x2F;rocketmq4.3.2&#x2F;logs&#x2F;broker-a:&#x2F;opt&#x2F;logs</span><br><span class="line">      - &#x2F;data&#x2F;rocketmq4.3.2&#x2F;store&#x2F;broker-a:&#x2F;opt&#x2F;store</span><br><span class="line">      - &#x2F;opt&#x2F;rocketmq4.3.2&#x2F;broker-a&#x2F;broker-a.conf:&#x2F;opt&#x2F;rocketmq-4.3.2&#x2F;conf&#x2F;broker.conf </span><br><span class="line">    environment:</span><br><span class="line">        TZ: Asia&#x2F;Shanghai</span><br><span class="line">        NAMESRV_ADDR: &quot;rmqnamesrv-a:9876&quot;</span><br><span class="line">        JAVA_OPTS: &quot; -Duser.home&#x3D;&#x2F;opt&quot;</span><br><span class="line">        JAVA_OPT_EXT: &quot;-server -Xms8g -Xmx8g -Xmn4g&quot;</span><br><span class="line">    command: sh mqbroker -c &#x2F;opt&#x2F;rocketmq-4.3.2&#x2F;conf&#x2F;broker.conf autoCreateTopicEnable&#x3D;true &amp;</span><br><span class="line">    links:</span><br><span class="line">      - rmqnamesrv-a:rmqnamesrv-a</span><br><span class="line">      - rmqnamesrv-b:rmqnamesrv-b</span><br><span class="line">    networks:</span><br><span class="line">      rmq:</span><br><span class="line">        aliases:</span><br><span class="line">          - rmqbroker-a</span><br><span class="line"></span><br><span class="line">  rmqbroker-b:</span><br><span class="line">    image: rocketmqinc&#x2F;rocketmq:4.3.2</span><br><span class="line">    container_name: rmqbroker-b</span><br><span class="line">    ports:</span><br><span class="line">      - 10909:10909</span><br><span class="line">    volumes:</span><br><span class="line">      - &#x2F;data&#x2F;rocketmq4.3.2&#x2F;logs&#x2F;broker-b:&#x2F;opt&#x2F;logs</span><br><span class="line">      - &#x2F;data&#x2F;rocketmq4.3.2&#x2F;store&#x2F;broker-b:&#x2F;opt&#x2F;store</span><br><span class="line">      - &#x2F;opt&#x2F;rocketmq4.3.2&#x2F;broker-b&#x2F;broker-b.conf:&#x2F;opt&#x2F;rocketmq-4.3.2&#x2F;conf&#x2F;broker.conf </span><br><span class="line">    environment:</span><br><span class="line">        TZ: Asia&#x2F;Shanghai</span><br><span class="line">        NAMESRV_ADDR: &quot;rmqnamesrv-b:9876&quot;</span><br><span class="line">        JAVA_OPTS: &quot; -Duser.home&#x3D;&#x2F;opt&quot;</span><br><span class="line">        JAVA_OPT_EXT: &quot;-server -Xms8g -Xmx8g -Xmn4g&quot;</span><br><span class="line">    command: sh mqbroker -c &#x2F;opt&#x2F;rocketmq-4.3.2&#x2F;conf&#x2F;broker.conf autoCreateTopicEnable&#x3D;true &amp;</span><br><span class="line">    links:</span><br><span class="line">      - rmqnamesrv-a:rmqnamesrv-a</span><br><span class="line">      - rmqnamesrv-b:rmqnamesrv-b</span><br><span class="line">    networks:</span><br><span class="line">      rmq:</span><br><span class="line">        aliases:</span><br><span class="line">          - rmqbroker-b</span><br><span class="line">  rmqconsole:</span><br><span class="line">    image: styletang&#x2F;rocketmq-console-ng</span><br><span class="line">    container_name: rmqconsole</span><br><span class="line">    ports:</span><br><span class="line">      - 9001:8080</span><br><span class="line">    environment:</span><br><span class="line">        JAVA_OPTS: -Drocketmq.namesrv.addr&#x3D;rmqnamesrv-a:9876;rmqnamesrv-b:9877 -Dcom.rocketmq.sendMessageWithVIPChannel&#x3D;false -Dserver.port&#x3D;8080</span><br><span class="line">    networks:</span><br><span class="line">      rmq:</span><br><span class="line">        aliases:</span><br><span class="line">          - rmqconsole</span><br><span class="line">networks:</span><br><span class="line">  rmq:</span><br><span class="line">    name: rmq</span><br><span class="line">    driver: bridge</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²-1"><a href="#éƒ¨ç½²-1" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p>æ£€æŸ¥å®Œä¸Šè¿°æ³¨æ„è¦ç‚¹ï¼Œéƒ½æ²¡é—®é¢˜å°±å¼€å§‹éƒ¨ç½²äº†ã€‚<br>å‘½ä»¤å¾ˆç®€å•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f &#x2F;opt&#x2F;rocketmq4.3.2&#x2F;mq.yml up -d</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰“å¼€rmqconsoleé¡µé¢ http:${ip}:9001</p><h1 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h1><p>redisé›†ç¾¤éƒ¨ç½²å‚è€ƒæˆ‘ä¹‹å‰å†™è¿‡çš„æ–‡ç« ï¼Œè¿™é‡Œä¸æ°´æ–‡äº†ã€‚</p><p><a href="https://rugod.cn/2020/05/27/docker/docker-install-db/" target="_blank" rel="noopener">dockerå®‰è£…redisé›†ç¾¤</a></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™ä¸€æ¬¡éƒ¨ç½²è¿˜æ˜¯å‚è€ƒäº†æ¯”è¾ƒå¤šçš„æ–‡ç« ï¼Œå¹¶åœ¨ä»–ä»¬çš„åŸºç¡€ä¸Šæ”¹è¿›ï¼ˆæ·»åŠ dubbo-adminå¯è§†åŒ–å·¥å…·åŠrmqconsoleï¼‰ æ€»ä½“æ¥è¯´æ”¶è·å¾ˆå¤šã€‚è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šéƒ¨ç½²å®Œæˆçš„ç»“æœã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@vm-26-21 rocketmq4.3.2]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                           COMMAND                  CREATED             STATUS              PORTS                                                    NAMES</span><br><span class="line">b11b4fa79636        rocketmqinc&#x2F;rocketmq:4.3.2      &quot;sh mqbroker -c &#x2F;optâ€¦&quot;   About an hour ago   Up About an hour    9876&#x2F;tcp, 10911&#x2F;tcp, 0.0.0.0:10909-&gt;10909&#x2F;tcp            rmqbroker-b</span><br><span class="line">639ae2109d88        rocketmqinc&#x2F;rocketmq:4.3.2      &quot;sh mqbroker -c &#x2F;optâ€¦&quot;   About an hour ago   Up About an hour    9876&#x2F;tcp, 10909&#x2F;tcp, 0.0.0.0:10911-&gt;10911&#x2F;tcp            rmqbroker-a</span><br><span class="line">7f0ae261d8dc        rocketmqinc&#x2F;rocketmq:4.3.2      &quot;sh mqnamesrv&quot;           About an hour ago   Up About an hour    10909&#x2F;tcp, 0.0.0.0:9876-&gt;9876&#x2F;tcp, 10911&#x2F;tcp             rmqnamesrv-a</span><br><span class="line">84b47ba9e473        styletang&#x2F;rocketmq-console-ng   &quot;sh -c &#39;java $JAVA_Oâ€¦&quot;   About an hour ago   Up About an hour    0.0.0.0:9001-&gt;8080&#x2F;tcp                                   rmqconsole</span><br><span class="line">dd43db2703fe        rocketmqinc&#x2F;rocketmq:4.3.2      &quot;sh mqnamesrv&quot;           About an hour ago   Up About an hour    9876&#x2F;tcp, 10909&#x2F;tcp, 10911&#x2F;tcp, 0.0.0.0:9877-&gt;9877&#x2F;tcp   rmqnamesrv-b</span><br><span class="line">ecd8e83e8386        chenchuxin&#x2F;dubbo-admin          &quot;catalina.sh run&quot;        47 hours ago        Up 47 hours         0.0.0.0:8080-&gt;8080&#x2F;tcp                                   dubbo-admin</span><br><span class="line">a3265cddc63a        zookeeper                       &quot;&#x2F;docker-entrypoint.â€¦&quot;   47 hours ago        Up 47 hours         2888&#x2F;tcp, 3888&#x2F;tcp, 8080&#x2F;tcp, 0.0.0.0:2182-&gt;2181&#x2F;tcp     zoo2</span><br><span class="line">1bcea74a1647        zookeeper                       &quot;&#x2F;docker-entrypoint.â€¦&quot;   47 hours ago        Up 47 hours         2888&#x2F;tcp, 3888&#x2F;tcp, 8080&#x2F;tcp, 0.0.0.0:2183-&gt;2181&#x2F;tcp     zoo3</span><br><span class="line">ab4f3f15ce5e        zookeeper                       &quot;&#x2F;docker-entrypoint.â€¦&quot;   47 hours ago        Up 47 hours         2888&#x2F;tcp, 3888&#x2F;tcp, 0.0.0.0:2181-&gt;2181&#x2F;tcp, 8080&#x2F;tcp     zoo1</span><br><span class="line">a9c2598d6809        nacos&#x2F;nacos-server:1.1.3        &quot;bin&#x2F;docker-startup.â€¦&quot;   2 days ago          Up 2 days           0.0.0.0:8848-&gt;8848&#x2F;tcp                                   nacos</span><br><span class="line"></span><br><span class="line">[root@vm-26-21 rocketmq4.3.2]# free -h</span><br><span class="line">              total        used        free      shared  buff&#x2F;cache   available</span><br><span class="line">Mem:            31G         21G        6.1G        9.5M        3.9G        9.5G</span><br><span class="line">Swap:          8.0G          0B        8.0G</span><br><span class="line"></span><br><span class="line">[root@vm-26-21 rocketmq4.3.2]# top</span><br><span class="line">top - 14:52:55 up 2 days, 21:00,  1 user,  load average: 0.09, 0.13, 0.14</span><br><span class="line">Tasks: 247 total,   1 running, 246 sleeping,   0 stopped,   0 zombie</span><br><span class="line">%Cpu(s):  0.5 us,  0.9 sy,  0.0 ni, 98.6 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem : 32780056 total,  6395496 free, 22256968 used,  4127592 buff&#x2F;cache</span><br><span class="line">KiB Swap:  8388604 total,  8388604 free,        0 used.  9945644 avail Mem </span><br><span class="line">  scroll coordinates: y &#x3D; 1&#x2F;247 (tasks), x &#x3D; 1&#x2F;12 (fields)</span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                       </span><br><span class="line">28370 3000      20   0   14.0g   8.4g  14632 S   7.0 27.0   4:59.92 java                                                                                          </span><br><span class="line">28405 3000      20   0   13.8g   8.4g  14488 S   7.0 27.0   4:49.68 java                                                                                          </span><br><span class="line">12884 root      20   0 6330552 613636  14000 S   1.0  1.9  33:52.27 java</span><br></pre></td></tr></table></figure><p>åŸºæœ¬ä¸Šè¿˜æ˜¯mqå ç”¨èµ„æºè¾ƒå¤šï¼Œä¸è¿‡è¿™è¿˜æ²¡å¼€å§‹å‹æµ‹ï¼Œä¼°è®¡å®é™…å‹æµ‹å†…å­˜å’Œcpuå ç”¨ä¼šé«˜å¾ˆå¤šå§ï¼Œç”¨dockeréƒ¨ç½²çš„å¥½å¤„å°±æ˜¯å¯ä»¥æé«˜èµ„æºåˆ©ç”¨ï¼ˆæ ¹æ®æœºå™¨é…ç½®è°ƒæ•´jvmå¯åŠ¨å‚æ•°ï¼‰ï¼Œç»´æŠ¤ä¹Ÿæ›´å®¹æ˜“ï¼ŒæŒ‚äº†ç›´æ¥é‡å¯å°±okï¼Œä¸éœ€è¦å»3å°æœåŠ¡å™¨ä¸Šæ¥å›æ“ä½œã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://www.cnblogs.com/qdhxhz/p/11096682.html" target="_blank" rel="noopener">Dockeré›†ç¾¤éƒ¨ç½²RocketMQ</a></p><p><a href="https://segmentfault.com/a/1190000006907443" target="_blank" rel="noopener">ä½¿ç”¨ Docker ä¸€æ­¥æå®š ZooKeeper é›†ç¾¤çš„æ­å»º</a></p><p><a href="https://nacos.io/zh-cn/" target="_blank" rel="noopener">nacoså®˜ç½‘</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> Docker </tag>
            
            <tag> Nacos </tag>
            
            <tag> Zookeeper </tag>
            
            <tag> Rocketmq </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ¶ä½œCentOS7.xé•œåƒæ¨¡æ¿</title>
      <link href="/2020/06/04/linux/centos7-install/"/>
      <url>/2020/06/04/linux/centos7-install/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æœ€è¿‘å…¬å¸éœ€è¦å®‰è£…å¾ˆå¤šè™šæ‹Ÿæœºï¼Œä¸€æƒ³åˆ°æ™®é€šçš„Centoséœ€è¦å®‰è£…å¾ˆå¤šé¢å¤–çš„ä¸œè¥¿å°±å¤´ç—›ï¼Œå†³å®šè¿˜æ˜¯åšä¸€ä¸ªä¼˜åŒ–è¿‡çš„é•œåƒï¼Œä»¥åç›´æ¥ç”¨è¿™ä¸ªé•œåƒåšè™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿå¯ä»¥èŠ‚çœå¤§é‡æ—¶é—´ã€‚</p><h1 id="é€‰æ‹©è™šæ‹ŸåŒ–ç³»ç»Ÿ"><a href="#é€‰æ‹©è™šæ‹ŸåŒ–ç³»ç»Ÿ" class="headerlink" title="é€‰æ‹©è™šæ‹ŸåŒ–ç³»ç»Ÿ"></a>é€‰æ‹©è™šæ‹ŸåŒ–ç³»ç»Ÿ</h1><p>æˆ‘ä½¿ç”¨çš„VMware Esxiæˆ–VMware Workstation Pro</p><h1 id="å®‰è£…centos7-æœ€å°åŒ–ç³»ç»Ÿ"><a href="#å®‰è£…centos7-æœ€å°åŒ–ç³»ç»Ÿ" class="headerlink" title="å®‰è£…centos7 æœ€å°åŒ–ç³»ç»Ÿ"></a>å®‰è£…centos7 æœ€å°åŒ–ç³»ç»Ÿ</h1><p>ä¸‹è½½é•œåƒ  <a href="http://mirrors.aliyun.com/centos/7/isos/x86_64/" target="_blank" rel="noopener">é˜¿é‡Œäº‘centosé•œåƒ</a></p><p>å¦‚æœæ˜¯å®‰è£…åˆ°è™šæ‹Ÿæœºé‡Œç›´æ¥çœ‹<br><a href="https://blog.csdn.net/capricorn90/article/details/52556174" target="_blank" rel="noopener">CentOS 7 æœ€å°åŒ–å®‰è£…</a></p><p>é‡Œé¢æ³¨æ„å‡ ç‚¹å°±è¡Œï¼š</p><ul><li>æ—¶åŒºè°ƒä¸ºä¸­å›½ä¸Šæµ·</li><li>å®‰è£…è¯­è¨€é€‰æ‹©è‹±è¯­ï¼ˆåˆ«æ•´ä¸­æ–‡äº†ï¼Œå¤šå­¦ç‚¹è‹±è¯­æ²¡æœ‰ä»€ä¹ˆä¸å¥½ï¼‰</li><li>ç£ç›˜å¦‚æœæ‡’å¾—åˆ’åˆ†å°±æŒ‰é»˜è®¤æ ‡å‡†å³å¯</li><li>å¯†ç ä¸€å®šè¦è®¾ç½®</li></ul><h1 id="åˆ¶ä½œé•œåƒæ¨¡æ¿"><a href="#åˆ¶ä½œé•œåƒæ¨¡æ¿" class="headerlink" title="åˆ¶ä½œé•œåƒæ¨¡æ¿"></a>åˆ¶ä½œé•œåƒæ¨¡æ¿</h1><p>è¿›å…¥æ“ä½œç³»ç»Ÿ</p><h2 id="æ”¹ä¸»æœºå-é‡æ–°è¿æ¥ç”Ÿæ•ˆ"><a href="#æ”¹ä¸»æœºå-é‡æ–°è¿æ¥ç”Ÿæ•ˆ" class="headerlink" title="æ”¹ä¸»æœºå(é‡æ–°è¿æ¥ç”Ÿæ•ˆ)"></a>æ”¹ä¸»æœºå(é‡æ–°è¿æ¥ç”Ÿæ•ˆ)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname xxx</span><br></pre></td></tr></table></figure><h2 id="æ”¹yumæºä¸ºé˜¿é‡Œæº-ä¸ªäººä¹ æƒ¯ï¼Œä¸å–œå‹¿å–·"><a href="#æ”¹yumæºä¸ºé˜¿é‡Œæº-ä¸ªäººä¹ æƒ¯ï¼Œä¸å–œå‹¿å–·" class="headerlink" title="æ”¹yumæºä¸ºé˜¿é‡Œæº(ä¸ªäººä¹ æƒ¯ï¼Œä¸å–œå‹¿å–·)"></a>æ”¹yumæºä¸ºé˜¿é‡Œæº(ä¸ªäººä¹ æƒ¯ï¼Œä¸å–œå‹¿å–·)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -o &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure><h2 id="yumå®‰è£…æ’ä»¶-æ ¹æ®å–œå¥½å¢åˆ "><a href="#yumå®‰è£…æ’ä»¶-æ ¹æ®å–œå¥½å¢åˆ " class="headerlink" title="yumå®‰è£…æ’ä»¶(æ ¹æ®å–œå¥½å¢åˆ )"></a>yumå®‰è£…æ’ä»¶(æ ¹æ®å–œå¥½å¢åˆ )</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y lrzsz vim wget ntpdate yum-utils zip unzip tree  gcc gcc-c++  epel-release</span><br></pre></td></tr></table></figure><h2 id="æ”¹dns-å¦‚æœéœ€è¦æ·»åŠ å†…ç½‘åŸŸåçš„è¯ï¼Œå¦åˆ™å¯ä»¥ä¸ç”¨è¿™ä¸€æ­¥"><a href="#æ”¹dns-å¦‚æœéœ€è¦æ·»åŠ å†…ç½‘åŸŸåçš„è¯ï¼Œå¦åˆ™å¯ä»¥ä¸ç”¨è¿™ä¸€æ­¥" class="headerlink" title="æ”¹dns(å¦‚æœéœ€è¦æ·»åŠ å†…ç½‘åŸŸåçš„è¯ï¼Œå¦åˆ™å¯ä»¥ä¸ç”¨è¿™ä¸€æ­¥)"></a>æ”¹dns(å¦‚æœéœ€è¦æ·»åŠ å†…ç½‘åŸŸåçš„è¯ï¼Œå¦åˆ™å¯ä»¥ä¸ç”¨è¿™ä¸€æ­¥)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;resolv.conf</span><br><span class="line">æ·»åŠ dns</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">nameserver xxxx</span><br></pre></td></tr></table></figure><h2 id="æ”¹å¯†ç "><a href="#æ”¹å¯†ç " class="headerlink" title="æ”¹å¯†ç "></a>æ”¹å¯†ç </h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo    &#39;123456&#39;    |     passwd   --stdin  root</span><br></pre></td></tr></table></figure><p>echoçš„å€¼ä¸ºå¯†ç </p><h2 id="å…³é—­é˜²ç«å¢™"><a href="#å…³é—­é˜²ç«å¢™" class="headerlink" title="å…³é—­é˜²ç«å¢™"></a>å…³é—­é˜²ç«å¢™</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line">setenforce 0</span><br><span class="line">sed -i &quot;s&#x2F;SELINUX&#x3D;enforcing&#x2F;SELINUX&#x3D;disabled&#x2F;g&quot; &#x2F;etc&#x2F;selinux&#x2F;config</span><br></pre></td></tr></table></figure><h2 id="æ—¶é—´åŒæ­¥"><a href="#æ—¶é—´åŒæ­¥" class="headerlink" title="æ—¶é—´åŒæ­¥"></a>æ—¶é—´åŒæ­¥</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br><span class="line">#ä¸€å°æ—¶åŒæ­¥ä¸€æ¬¡</span><br><span class="line">0 *&#x2F;1 * * * &#x2F;usr&#x2F;sbin&#x2F;ntpdate ntp1.aliyun.com &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1; &#x2F;sbin&#x2F;hwclock -w</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…docker-ä¸ä¼šè¿˜æœ‰äººä¸è£…dockerå§"><a href="#å®‰è£…docker-ä¸ä¼šè¿˜æœ‰äººä¸è£…dockerå§" class="headerlink" title="å®‰è£…docker(ä¸ä¼šè¿˜æœ‰äººä¸è£…dockerå§)"></a>å®‰è£…docker(ä¸ä¼šè¿˜æœ‰äººä¸è£…dockerå§)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils #å¦‚æœåœ¨å‰é¢å·²ç»å®‰è£…äº†åˆ™ä¸ç”¨æ‰§è¡Œè¿™ä¸ªå‘½ä»¤</span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line"></span><br><span class="line">yum install -y docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line">vim &#x2F;etc&#x2F;docker&#x2F;daemon.json</span><br><span class="line">#æ·»åŠ å›½å†…é•œåƒåŠ é€Ÿ</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;wghlmi3i.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æé«˜èµ„æºé™åˆ¶ä¸Šé™-é‡æ–°è¿æ¥ç”Ÿæ•ˆ"><a href="#æé«˜èµ„æºé™åˆ¶ä¸Šé™-é‡æ–°è¿æ¥ç”Ÿæ•ˆ" class="headerlink" title="æé«˜èµ„æºé™åˆ¶ä¸Šé™(é‡æ–°è¿æ¥ç”Ÿæ•ˆ)"></a>æé«˜èµ„æºé™åˆ¶ä¸Šé™(é‡æ–°è¿æ¥ç”Ÿæ•ˆ)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;* soft nofile 65536&quot; &gt;&gt; &#x2F;etc&#x2F;security&#x2F;limits.conf         </span><br><span class="line">echo &quot;* hard nofile 65536&quot; &gt;&gt; &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br></pre></td></tr></table></figure><h2 id="å…³é—­Swap"><a href="#å…³é—­Swap" class="headerlink" title="å…³é—­Swap"></a>å…³é—­Swap</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">swapoff -a</span><br><span class="line">free -h</span><br><span class="line">              total        used        free      shared  buff&#x2F;cache   available</span><br><span class="line">Mem:           3.7G        132M        3.4G         11M        173M        3.3G</span><br><span class="line">Swap:            0B          0B          0B</span><br></pre></td></tr></table></figure><h2 id="å†…æ ¸è°ƒä¼˜"><a href="#å†…æ ¸è°ƒä¼˜" class="headerlink" title="å†…æ ¸è°ƒä¼˜"></a>å†…æ ¸è°ƒä¼˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;sysctl.conf </span><br><span class="line">vm.swappiness &#x3D; 1</span><br><span class="line">net.ipv6.conf.all.disable_ipv6 &#x3D; 1</span><br><span class="line"></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><h1 id="ä¿å­˜é•œåƒ"><a href="#ä¿å­˜é•œåƒ" class="headerlink" title="ä¿å­˜é•œåƒ"></a>ä¿å­˜é•œåƒ</h1><p>è¿›å…¥è™šæ‹ŸåŒ–æ§åˆ¶å°ï¼Œå¯¼å‡ºä¸º OVF æ ¼å¼å³å¯</p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå®‰è£…Mysqlã€Mongodbã€RedisåŠæ•°æ®è¿ç§»</title>
      <link href="/2020/05/27/docker/docker-install-db/"/>
      <url>/2020/05/27/docker/docker-install-db/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>å…¬å¸ä¹°äº†æ–°ç£ç›˜ã€å†…å­˜æ¡ï¼Œéœ€è¦é‡æ–°è£…æœºï¼Œé¢†å¯¼è¦æ±‚è¿™æ¬¡è¦ç”¨dockeréƒ¨ç½²æ•°æ®åº“åˆ°æœåŠ¡å™¨ä¸Šã€‚</p><h1 id="å®‰è£…mysql"><a href="#å®‰è£…mysql" class="headerlink" title="å®‰è£…mysql"></a>å®‰è£…mysql</h1><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>å®¿ä¸»æœºéœ€è¦å®‰è£…docker<br>æœºå™¨æ€§èƒ½32c 128G å¤–æŒ‚ç¡¬ç›˜åˆ°/dataç›®å½•ï¼ˆæ•°æ®åº“å»ºè®®å¤–æŒ‚ç£ç›˜ï¼‰</p><h2 id="åˆ›å»ºæŒä¹…åŒ–å­˜å‚¨æ–‡ä»¶ç›®å½•"><a href="#åˆ›å»ºæŒä¹…åŒ–å­˜å‚¨æ–‡ä»¶ç›®å½•" class="headerlink" title="åˆ›å»ºæŒä¹…åŒ–å­˜å‚¨æ–‡ä»¶ç›®å½•"></a>åˆ›å»ºæŒä¹…åŒ–å­˜å‚¨æ–‡ä»¶ç›®å½•</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir -vp &#x2F;data&#x2F;mysql</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºé…ç½®æ–‡ä»¶"></a>åˆ›å»ºé…ç½®æ–‡ä»¶</h2><p>[root@localhost ~]#vim /etc/my.cnf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">[client]   </span><br><span class="line">user&#x3D;root</span><br><span class="line">password&#x3D;123456</span><br><span class="line">port    &#x3D; 3306</span><br><span class="line">socket &#x3D; &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock </span><br><span class="line"></span><br><span class="line">[mysql]  </span><br><span class="line">prompt&#x3D;&quot;\u@data \R:\m:\s [\d]&gt; &quot; </span><br><span class="line">no-auto-rehash </span><br><span class="line">default-character-set&#x3D;utf8mb4  </span><br><span class="line"></span><br><span class="line">[mysqld]  </span><br><span class="line">user    &#x3D; mysql</span><br><span class="line">port    &#x3D; 3306</span><br><span class="line">#basedir &#x3D; &#x2F;usr&#x2F;local&#x2F;mysql</span><br><span class="line">datadir &#x3D; &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;</span><br><span class="line">socket  &#x3D; &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock</span><br><span class="line">secure_file_priv&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;</span><br><span class="line">performance_schema &#x3D; 1</span><br><span class="line">character_set_server&#x3D;utf8mb4   </span><br><span class="line">open_files_limit &#x3D; 655350  </span><br><span class="line">transaction_isolation &#x3D; READ-COMMITTED</span><br><span class="line">interactive_timeout &#x3D; 31536000</span><br><span class="line">wait_timeout &#x3D; 31536000</span><br><span class="line">skip_name_resolve &#x3D; 1  </span><br><span class="line">lower_case_table_names&#x3D;1    </span><br><span class="line">back_log &#x3D; 1024</span><br><span class="line">max_connections &#x3D; 10240    </span><br><span class="line">max_connect_errors &#x3D; 1000000</span><br><span class="line">table_open_cache &#x3D; 20480</span><br><span class="line">table_definition_cache &#x3D; 20480</span><br><span class="line">table_open_cache_instances &#x3D; 64</span><br><span class="line">thread_stack &#x3D; 512K</span><br><span class="line">external-locking &#x3D; FALSE</span><br><span class="line">max_allowed_packet &#x3D; 32M</span><br><span class="line">sort_buffer_size &#x3D; 4M</span><br><span class="line">join_buffer_size &#x3D; 4M</span><br><span class="line">thread_cache_size &#x3D; 15360</span><br><span class="line">tmp_table_size &#x3D; 32M</span><br><span class="line">max_heap_table_size &#x3D; 32M</span><br><span class="line">lock_wait_timeout &#x3D; 3600</span><br><span class="line">explicit_defaults_for_timestamp &#x3D; 1</span><br><span class="line">sort_buffer_size &#x3D; 33554432</span><br><span class="line"></span><br><span class="line">slow_query_log_file &#x3D; &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;slow.log</span><br><span class="line">log-error &#x3D; &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;error.log</span><br><span class="line">log-bin &#x3D; &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mybinlog</span><br><span class="line">slow_query_log &#x3D; 1</span><br><span class="line">log_timestamps &#x3D; SYSTEM</span><br><span class="line">long_query_time &#x3D; 1</span><br><span class="line">log_queries_not_using_indexes &#x3D;1</span><br><span class="line">log_throttle_queries_not_using_indexes &#x3D; 60</span><br><span class="line">min_examined_row_limit &#x3D; 100</span><br><span class="line">log_slow_admin_statements &#x3D; 1</span><br><span class="line">log_slow_slave_statements &#x3D; 1</span><br><span class="line">expire_logs_days &#x3D; 7</span><br><span class="line">log_warnings &#x3D; 1</span><br><span class="line">binlog_cache_size &#x3D; 4M</span><br><span class="line">max_binlog_cache_size &#x3D; 4G</span><br><span class="line">max_binlog_size &#x3D; 1G</span><br><span class="line">binlog_checksum &#x3D; 1</span><br><span class="line">binlog_format &#x3D; row</span><br><span class="line">sync_binlog &#x3D; 1</span><br><span class="line"></span><br><span class="line">server-id &#x3D; 213306</span><br><span class="line">master_info_repository &#x3D; TABLE</span><br><span class="line">relay_log_info_repository &#x3D; TABLE</span><br><span class="line">gtid_mode &#x3D; on</span><br><span class="line">enforce-gtid-consistency &#x3D; on</span><br><span class="line">log_slave_updates  &#x3D; on</span><br><span class="line">enforce_gtid_consistency &#x3D; 1</span><br><span class="line">relay_log &#x3D; relay.log</span><br><span class="line">relay_log_recovery &#x3D; 1</span><br><span class="line">relay-log-purge &#x3D; 1</span><br><span class="line">binlog_gtid_simple_recovery &#x3D; 1</span><br><span class="line">slave_skip_errors &#x3D; ddl_exist_errors</span><br><span class="line">slave-rows-search-algorithms &#x3D; &#39;INDEX_SCAN,HASH_SCAN&#39;</span><br><span class="line"></span><br><span class="line">innodb_undo_directory &#x3D; &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;undolog</span><br><span class="line">internal_tmp_disk_storage_engine &#x3D; InnoDB</span><br><span class="line">innodb_page_size &#x3D; 8192</span><br><span class="line">innodb_buffer_pool_size &#x3D; 40960m</span><br><span class="line">innodb_buffer_pool_instances &#x3D; 4</span><br><span class="line">innodb_buffer_pool_load_at_startup &#x3D; 1</span><br><span class="line">innodb_buffer_pool_dump_at_shutdown &#x3D; 1</span><br><span class="line">innodb_data_file_path &#x3D; ibdata1:1G:autoextend</span><br><span class="line">innodb_flush_log_at_trx_commit &#x3D; 1</span><br><span class="line">innodb_log_buffer_size &#x3D; 32M</span><br><span class="line">innodb_log_file_size &#x3D; 1G</span><br><span class="line">innodb_log_files_in_group &#x3D; 4</span><br><span class="line">innodb_max_undo_log_size &#x3D; 4G</span><br><span class="line">innodb_undo_tablespaces &#x3D; 95</span><br><span class="line">innodb_io_capacity &#x3D; 2000</span><br><span class="line">innodb_io_capacity_max &#x3D; 4000</span><br><span class="line">innodb_flush_sync &#x3D; 0</span><br><span class="line">innodb_flush_neighbors &#x3D; 0</span><br><span class="line">innodb_lru_scan_depth &#x3D; 4000</span><br><span class="line">innodb_lock_wait_timeout &#x3D; 5</span><br><span class="line">innodb_write_io_threads &#x3D; 8</span><br><span class="line">innodb_read_io_threads &#x3D; 8</span><br><span class="line">innodb_purge_threads &#x3D; 4</span><br><span class="line">innodb_page_cleaners &#x3D; 4</span><br><span class="line">innodb_max_dirty_pages_pct &#x3D; 50</span><br><span class="line">innodb_flush_method &#x3D; O_DIRECT</span><br><span class="line">innodb_checksum_algorithm &#x3D; crc32</span><br><span class="line">innodb_rollback_on_timeout &#x3D; 1</span><br><span class="line">innodb_print_all_deadlocks &#x3D; 1</span><br><span class="line">innodb_file_per_table &#x3D; 1</span><br><span class="line">innodb_online_alter_log_max_size &#x3D; 4G</span><br><span class="line">innodb_stats_on_metadata &#x3D; 0</span><br><span class="line">innodb_checksums &#x3D; 1</span><br><span class="line">innodb_undo_logs &#x3D; 128</span><br><span class="line">innodb_status_file &#x3D; 1</span><br><span class="line">innodb_status_output &#x3D; 0</span><br><span class="line">innodb_status_output_locks &#x3D; 0</span><br><span class="line">innodb_large_prefix &#x3D; 1</span><br><span class="line">innodb_thread_concurrency &#x3D; 0</span><br><span class="line">innodb_sync_spin_loops &#x3D; 100</span><br><span class="line">innodb_spin_wait_delay &#x3D; 30</span><br><span class="line">innodb_open_files &#x3D; 655350  </span><br><span class="line">innodb_strict_mode &#x3D; 1</span><br><span class="line">innodb_sort_buffer_size &#x3D; 67108864</span><br><span class="line"></span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_innodb&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_server&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_dml&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_ddl&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_trx&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_os&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_purge&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_log&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_lock&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_buffer&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_index&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_ibuf_system&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_buffer_page&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_adaptive_hash&quot;</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>#æ‹‰å–é•œåƒ<br>[root@localhost ~]# docker pull mysql:5.7.28</p><p>#å¯åŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -itd --name mysql -p 3306:3306  --privileged&#x3D;true --restart always -v &#x2F;etc&#x2F;my.cnf:&#x2F;etc&#x2F;mysql&#x2F;my.cnf -v &#x2F;data&#x2F;mysql:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;123456  mysql:5.7.28 </span><br><span class="line"></span><br><span class="line">å‚æ•°è¯´æ˜ï¼š</span><br><span class="line">--privileged&#x3D;true å¼€å¯è¶…çº§æƒé™</span><br><span class="line">-v &#x2F;etc&#x2F;my.cnf:&#x2F;etc&#x2F;mysql&#x2F;my.cnf  æŠŠå¤–é¢è°ƒä¼˜è¿‡åçš„é…ç½®æ–‡ä»¶æŒ‚è½½è¿›å»</span><br><span class="line">-v &#x2F;data&#x2F;mysql:&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">æŠŠæŒä¹…åŒ–å­˜å‚¨æ–‡ä»¶ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨  </span><br><span class="line">--restart always  Dockeré‡å¯æ—¶ï¼Œè¯¥å®¹å™¨è‡ªåŠ¨å¯åŠ¨</span><br></pre></td></tr></table></figure><p>error:å¦‚æœå¯åŠ¨å¤±è´¥ï¼ŒæŸ¥çœ‹æ—¥å¿—docker logs mysqlæç¤º</p><p>chown: cannot read directory â€˜/var/lib/mysql/â€˜: Permission denied</p><p>å®¹å™¨ä¸­æ²¡æœ‰æ‰§è¡Œæƒé™ //æŒ‚è½½å¤–éƒ¨æ•°æ®å·æ—¶,æ— æ³•å¯åŠ¨å®¹å™¨, cannot read directory â€˜/var/lib/mysql/â€˜: Permission denied ç”±</p><p>è¯¥åŸå› ä¸ºcentOs7é»˜è®¤å¼€å¯selinuxå®‰å…¨æ¨¡å—,éœ€è¦ä¸´æ—¶å…³é—­è¯¥å®‰å…¨æ¨¡å—,æˆ–è€…æ·»åŠ ç›®å½•åˆ°ç™½åå• ä¸´æ—¶å…³é—­selinuxï¼šsu -c â€œsetenforce 0â€ </p><p>#æ·»åŠ è¶…çº§ç®¡ç†å‘˜è´¦å·admin<br>[root@localhost data]# docker exec -it mysql bash<br>root@1ef730747ed4:/# mysql -uroot -p123456<br>mysql&gt; GRANT ALL PRIVILEGES ON <em>.</em> TO â€˜adminâ€™@â€™%â€™ IDENTIFIED BY â€˜123456â€™ WITH GRANT OPTION;<br>mysql&gt; flush privileges;<br>mysql&gt; exit</p><h2 id="ç®¡ç†"><a href="#ç®¡ç†" class="headerlink" title="ç®¡ç†"></a>ç®¡ç†</h2><p>docker stop/start mysql å…³é—­/å¯åŠ¨</p><h2 id="æ•°æ®è¿ç§»"><a href="#æ•°æ®è¿ç§»" class="headerlink" title="æ•°æ®è¿ç§»"></a>æ•°æ®è¿ç§»</h2><p>æ—§æ•°æ®åº“æœºå™¨æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p123456 --all-databases  &gt; all.sql</span><br><span class="line">scp all.sql root@æ–°æœºå™¨ip:&#x2F;root</span><br></pre></td></tr></table></figure><p>æ–°æ•°æ®åº“æœºå™¨æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker cp &#x2F;root&#x2F;all.sql mysql:&#x2F;all.sql </span><br><span class="line">docker exec -it mysql bash  </span><br><span class="line">mysql -uroot -p123456 mysql &lt; all.sql</span><br></pre></td></tr></table></figure><h1 id="å®‰è£…mongodb"><a href="#å®‰è£…mongodb" class="headerlink" title="å®‰è£…mongodb"></a>å®‰è£…mongodb</h1><p>è¦æ±‚ï¼š<br>å®¿ä¸»æœºéœ€è¦å®‰è£…docker<br>å¤–æŒ‚ç¡¬ç›˜åˆ°/dataç›®å½•ï¼ˆæ•°æ®åº“å»ºè®®å¤–æŒ‚ç£ç›˜ï¼‰</p><h2 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#åˆ›å»ºæŒä¹…åŒ–å­˜å‚¨æ–‡ä»¶ç›®å½•</span><br><span class="line">mkdir -vp &#x2F;data&#x2F;mongo</span><br><span class="line">#æ‹‰å–é•œåƒ</span><br><span class="line">docker pull mongo:4.2.6</span><br><span class="line"></span><br><span class="line">#å¯åŠ¨mongoï¼Œç”±äºæ•°æ®éœ€è¦è¿ç§»ï¼ˆåŒ…å«äº†ç”¨æˆ·ï¼‰ï¼Œæ‰€ä»¥ä¸èƒ½å…ˆå¼€å¯éªŒè¯æ¨¡å¼</span><br><span class="line">docker run -itd --name mongo -p 27017:27017 -v &#x2F;data&#x2F;mongo:&#x2F;data&#x2F;db mongo:4.2.6 </span><br><span class="line"></span><br><span class="line">-v &#x2F;data&#x2F;mongo:&#x2F;data&#x2F;db æŠŠæŒä¹…åŒ–å­˜å‚¨æ–‡ä»¶ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®è¿ç§»-1"><a href="#æ•°æ®è¿ç§»-1" class="headerlink" title="æ•°æ®è¿ç§»"></a>æ•°æ®è¿ç§»</h2><p>æ—§æœºå™¨æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongodump -h 127.0.0.1 --port 27017 -uroot -p123456 -o &#x2F;root&#x2F;mongodb&#x2F;</span><br><span class="line">scp -r &#x2F;root&#x2F;mongodb&#x2F; root@ip:&#x2F;root&#x2F;mongodb&#x2F;</span><br></pre></td></tr></table></figure><p>æ–°æœºå™¨æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker cp &#x2F;root&#x2F;mongodb&#x2F; mongo:&#x2F;</span><br><span class="line">docker exec -it mongo bash</span><br><span class="line">mongorestore &#x2F;mongodb&#x2F;</span><br></pre></td></tr></table></figure><h2 id="é‡å¯å¹¶å¼€å¯æƒé™éªŒè¯"><a href="#é‡å¯å¹¶å¼€å¯æƒé™éªŒè¯" class="headerlink" title="é‡å¯å¹¶å¼€å¯æƒé™éªŒè¯"></a>é‡å¯å¹¶å¼€å¯æƒé™éªŒè¯</h2><p>æ•°æ®è¿ç§»å®Œåï¼ŒæŸ¥çœ‹æœ¬åœ°å­˜å‚¨æ˜¯å¦æœ‰æ•°æ®äº†ã€‚å¦‚æœå­˜åœ¨ç»§ç»­åé¢çš„æ“ä½œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f mongo</span><br><span class="line">docker run -itd --name mongo --restart always -p 27017:27017 -v &#x2F;data&#x2F;mongo:&#x2F;data&#x2F;db mongo:4.2.6 --auth</span><br></pre></td></tr></table></figure><p>å†æ¬¡å¯åŠ¨mongoå°±å¯ä»¥ç”¨ä»¥å‰çš„æ•°æ®åº“è´¦å·å¯†ç ç™»é™†äº†</p><h2 id="ç®¡ç†-1"><a href="#ç®¡ç†-1" class="headerlink" title="ç®¡ç†"></a>ç®¡ç†</h2><p>docker stop/start mongo å…³é—­/å¯åŠ¨</p><h1 id="å®‰è£…redis"><a href="#å®‰è£…redis" class="headerlink" title="å®‰è£…redis"></a>å®‰è£…redis</h1><p>è¦æ±‚redisç‰ˆæœ¬&gt;5.0<br>å®¿ä¸»æœºéœ€è¦å®‰è£…docker<br>æœºå™¨æ€§èƒ½32c 128G å¤–æŒ‚ç¡¬ç›˜åˆ°/dataç›®å½•ï¼ˆæ•°æ®åº“å»ºè®®å¤–æŒ‚ç£ç›˜ï¼‰</p><h2 id="å‡†å¤‡é…ç½®æ–‡ä»¶"><a href="#å‡†å¤‡é…ç½®æ–‡ä»¶" class="headerlink" title="å‡†å¤‡é…ç½®æ–‡ä»¶"></a>å‡†å¤‡é…ç½®æ–‡ä»¶</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir -vp &#x2F;data&#x2F;redis-cluster</span><br><span class="line">[root@localhost ~]# cd &#x2F;data&#x2F;redis-cluster</span><br><span class="line">[root@localhost redis-cluster]# vi redis-cluster.tmpl</span><br><span class="line">æ·»åŠ ä»¥ä¸‹å†…å®¹  </span><br><span class="line">port $&#123;PORT&#125;</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.31.26.53   #æœ¬æœºip</span><br><span class="line">cluster-announce-port $&#123;PORT&#125;</span><br><span class="line">cluster-announce-bus-port 1$&#123;PORT&#125;</span><br><span class="line">appendonly yes</span><br><span class="line">protected-mode no</span><br><span class="line">#å¯†ç </span><br><span class="line">masterauth 123456     </span><br><span class="line">#å¯†ç </span><br><span class="line">requirepass 123456    </span><br><span class="line">bind 0.0.0.0</span><br><span class="line">timeout 300</span><br><span class="line">tcp-keepalive 300</span><br></pre></td></tr></table></figure><p>åˆ›å»ºé›†ç¾¤é…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost redis-cluster]# for port in $(seq 7010 7015); do   mkdir -p .&#x2F;$&#123;port&#125;&#x2F;conf    &amp;&amp; PORT&#x3D;$&#123;port&#125; envsubst &lt; .&#x2F;redis-cluster.tmpl &gt; .&#x2F;$&#123;port&#125;&#x2F;conf&#x2F;redis.conf   &amp;&amp; mkdir -p .&#x2F;$&#123;port&#125;&#x2F;data; done</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå®Œæˆåçœ‹ä¸‹ç›®å½•ç»“æ„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost redis-cluster]# tree</span><br><span class="line">â”œâ”€â”€ 7010</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ conf</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ redis.conf</span><br><span class="line">â”‚Â Â  â””â”€â”€ data</span><br><span class="line">â”œâ”€â”€ 7011</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ conf</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ redis.conf</span><br><span class="line">â”‚Â Â  â””â”€â”€ data</span><br><span class="line">â”œâ”€â”€ 7012</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ conf</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ redis.conf</span><br><span class="line">â”‚Â Â  â””â”€â”€ data</span><br><span class="line">â”œâ”€â”€ 7013</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ conf</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ redis.conf</span><br><span class="line">â”‚Â Â  â””â”€â”€ data</span><br><span class="line">â”œâ”€â”€ 7014</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ conf</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ redis.conf</span><br><span class="line">â”‚Â Â  â””â”€â”€ data</span><br><span class="line">â”œâ”€â”€ 7015</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ conf</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ redis.conf</span><br><span class="line">â”‚Â Â  â””â”€â”€ data</span><br><span class="line">â””â”€â”€ redis-cluster.tmpl</span><br></pre></td></tr></table></figure><h2 id="æ‹‰é•œåƒ"><a href="#æ‹‰é•œåƒ" class="headerlink" title="æ‹‰é•œåƒ"></a>æ‹‰é•œåƒ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis</span><br></pre></td></tr></table></figure><p>æœ¬ç¤ºä¾‹é•œåƒç‰ˆæœ¬ä¸ºlatestï¼Œå¦‚æœéœ€è¦æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®‰è£…é›†ç¾¤ï¼Œåˆ™åªè¦è¦æ±‚redisç‰ˆæœ¬æ˜¯5.0ä»¥ä¸Š å¦åˆ™ä¼šå‡ºç°é—®é¢˜</p><h2 id="åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šIP"><a href="#åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šIP" class="headerlink" title="åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šIP"></a>åˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šIP</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost redis-cluster]# for port in $(seq 7010 7015); do    docker run -it -d -p $&#123;port&#125;:$&#123;port&#125; -p 1$&#123;port&#125;:1$&#123;port&#125;   --privileged&#x3D;true -v &#x2F;data&#x2F;redis-cluster&#x2F;$&#123;port&#125;&#x2F;conf&#x2F;redis.conf:&#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis&#x2F;redis.conf   --privileged&#x3D;true -v &#x2F;data&#x2F;redis-cluster&#x2F;$&#123;port&#125;&#x2F;data:&#x2F;data   --restart always --name redis-$&#123;port&#125; --net host   --sysctl net.core.somaxconn&#x3D;1024 redis redis-server &#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis&#x2F;redis.conf; done</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºé›†ç¾¤"><a href="#åˆ›å»ºé›†ç¾¤" class="headerlink" title="åˆ›å»ºé›†ç¾¤"></a>åˆ›å»ºé›†ç¾¤</h2><p>è¿›å…¥å®¹å™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost redis-cluster]# docker exec -it redis-7010 bash</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦å¯†ç ï¼Œéœ€è¦åœ¨å‘½ä»¤æœ€ååŠ ä¸Š-a passwd</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster create 172.31.26.53:7010 172.31.26.53:7011 172.31.26.53:7012 172.31.26.53:7013 172.31.26.53:7014 172.31.26.53:7015 --cluster-replicas 1 -a 123456</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è‡³æ­¤ï¼Œmysqlã€mongodbã€redisç”¨dockeréƒ¨ç½²å®Œæˆï¼Œå¹¶å®Œæˆè¿ç§»æ•°æ®,å¦‚æœ‰é—®é¢˜è¯·ç•™è¨€ã€‚</p><h1 id="éƒ¨ç½²é—®é¢˜"><a href="#éƒ¨ç½²é—®é¢˜" class="headerlink" title="éƒ¨ç½²é—®é¢˜"></a>éƒ¨ç½²é—®é¢˜</h1><p>1.mysqlæ ¹æ®é•œåƒä¸åŒéœ€è¦è°ƒæ•´é‡Œé¢æŒ‚è½½ç›®å½•çš„è·¯å¾„ï¼Œè¿™ç‚¹å¾ˆå‘ï¼Œæˆ‘å‡ºç°è¿‡å‡ æ¬¡æ‰¾ä¸åˆ°æŒ‚è½½è·¯å¾„ç„¶åæŠ¥é”™ï¼Œå› ä¸ºå®¹å™¨é‡Œmysqlå¯åŠ¨æ˜¯ä»¥ä½ my.cnfä¸ºä¸»çš„ï¼Œæ‰€ä»¥ä½ åœ¨my.cnfé‡Œæ²¡å®šä¹‰å¥½é‚£äº›å®¹å™¨é‡Œçš„è·¯å¾„å°±ä¼šå¯åŠ¨å¤±è´¥ï¼ŒæŠ¥é”™é—®é¢˜å°±æ˜¯æ‰¾ä¸åˆ°ç›¸å…³è·¯å¾„ã€‚</p><p>2.mongodbæœ€çƒ¦çš„å°±æ˜¯æ•°æ®å¯¼å…¥çš„æ—¶å€™ï¼Œå¦‚æœä½ çš„ç”¨æˆ·åæœ‰å¯†ç ï¼Œä½ éœ€è¦å¼€å¯å…å¯†ç™»é™†æ‰èƒ½å¯¼å…¥ï¼Œæˆ‘è§‰å¾—ç‰¹åˆ«æç¬‘ï¼Œä¸‡ä¸€ç”Ÿäº§çš„æ•°æ®åº“éœ€è¦å¯¼å…¥ï¼Œæ€»ä¸è‡³äºè¦å…ˆå…³é—­mongodbå¼€å¯å…å¯†ç™»é™†ï¼Œå¯¼å…¥å®Œå†å¼€å¯å¯†ç ç™»é™†å§ã€‚ã€‚ã€‚è¿˜æ˜¯æˆ‘æ²¡æ‰¾åˆ°å¯¼å…¥çš„å¥½æ–¹æ³•ï¼Œæ±‚æ•™ï¼ï¼ï¼</p><p>3.redisé›†ç¾¤åˆ›å»ºçš„æ—¶å€™ï¼ŒæŒ‰ç…§<a href="https://www.jianshu.com/p/af8eb110a873" target="_blank" rel="noopener">Dockeræœ€æ–°Redis-cluster é›†ç¾¤é…ç½®</a> åšä¼šå‡ºç°ï¼Œæœ¬åœ°ç½‘æ¡¥è½¬å‘å¤±è´¥çš„æƒ…å†µï¼Œç›´è§‚æ¥çœ‹å°±æ˜¯redis-cli create é›†ç¾¤çš„æ—¶å€™ä¸€ç›´åœ¨ç­‰å¾…ï¼Œè™½ç„¶ä½ èƒ½çœ‹åˆ°è¿™äº›æœ¬åœ°ç½‘æ¡¥å†…çš„ipï¼Œä½†æ˜¯ä»–ä»¬å°±æ˜¯ä¸èƒ½åŠ å…¥ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¤§å‘ï¼Œåæ­£æˆ‘ç›´æ¥å°†ç«¯å£æ˜ å°„åˆ°æœ¬æœºå°±å¯ä»¥ï¼Œæä¸æ‡‚ä¸ºå•¥é‚£ä¸ªä½œè€…éè¦ä¸€ä¸ªç½‘æ¡¥ã€‚ã€‚ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://docs.docker.com/engine/reference/commandline/run/" target="_blank" rel="noopener">Docker runå®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://www.jianshu.com/p/af8eb110a873" target="_blank" rel="noopener">Dockeræœ€æ–°Redis-cluster é›†ç¾¤é…ç½®</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
            <tag> Redis </tag>
            
            <tag> Docker </tag>
            
            <tag> Mongodb </tag>
            
            <tag> æ•°æ®å¤‡ä»½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥æµ…å‡ºDockeråŸç†åŠå®æˆ˜(ä¸€)â€”â€”Dockerçš„åŸºæœ¬ç†å¿µä¸åŸç†</title>
      <link href="/2020/05/24/docker/docker-idea-1/"/>
      <url>/2020/05/24/docker/docker-idea-1/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><p>æ·±å…¥æµ…å‡ºDockeråŸç†åŠå®æˆ˜ç³»åˆ—ç¬¬ä¸€ç¯‡ï¼Œæˆ‘æƒ³å‘å¤§å®¶é˜è¿°åœ¨Dockerçš„åŸºæœ¬ç†å¿µä¸åŸç†ã€‚</p><h1 id="Dockeræ¦‚è¿°"><a href="#Dockeræ¦‚è¿°" class="headerlink" title="Dockeræ¦‚è¿°"></a>Dockeræ¦‚è¿°</h1><p>Dockeræ˜¯ä¸€ä¸ªç”¨äºå¼€å‘ï¼Œäº¤ä»˜å’Œè¿è¡Œåº”ç”¨ç¨‹åºçš„å¼€æ”¾å¹³å°ã€‚Dockerä½¿æˆ‘ä»¬èƒ½å¤Ÿå°†åº”ç”¨ç¨‹åºä¸åŸºç¡€æ¶æ„åˆ†å¼€ï¼Œä»è€Œå¯ä»¥å¿«é€Ÿäº¤ä»˜è½¯ä»¶ã€‚å€ŸåŠ©Dockerï¼Œæˆ‘ä»¬å¯ä»¥ä»¥ä¸ç®¡ç†åº”ç”¨ç¨‹åºç›¸åŒçš„æ–¹å¼æ¥ç®¡ç†åŸºç¡€æ¶æ„ã€‚é€šè¿‡åˆ©ç”¨Dockerçš„æ–¹æ³•æ¥å¿«é€Ÿäº¤ä»˜ï¼Œæµ‹è¯•å’Œéƒ¨ç½²ä»£ç ï¼Œæ‚¨å¯ä»¥å¤§å¤§å‡å°‘ç¼–å†™ä»£ç å’Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œä»£ç ä¹‹é—´çš„å»¶è¿Ÿã€‚</p><p>å®¹å™¨åŒ–è¶Šæ¥è¶Šå—æ¬¢è¿ï¼Œå› ä¸ºå®¹å™¨æ˜¯ï¼š</p><ul><li>çµæ´»ï¼šå³ä½¿æœ€å¤æ‚çš„åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥å®¹å™¨åŒ–ã€‚</li><li>è½»é‡çº§ï¼šå®¹å™¨åˆ©ç”¨å¹¶å…±äº«ä¸»æœºå†…æ ¸ï¼Œåœ¨ç³»ç»Ÿèµ„æºæ–¹é¢æ¯”è™šæ‹Ÿæœºæ•ˆç‡æ›´é«˜ã€‚</li><li>å¯ç§»æ¤æ€§ï¼šæ‚¨å¯ä»¥åœ¨æœ¬åœ°æ„å»ºï¼Œéƒ¨ç½²åˆ°äº‘å¹¶åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œã€‚</li><li>æ¾æ•£è€¦åˆï¼šå®¹å™¨æ˜¯é«˜åº¦è‡ªç»™è‡ªè¶³å¹¶å°è£…çš„å®¹å™¨ï¼Œä½¿æ‚¨å¯ä»¥åœ¨ä¸ç ´åå…¶ä»–å®¹å™¨çš„æƒ…å†µä¸‹æ›´æ¢æˆ–å‡çº§å®ƒä»¬ã€‚</li><li>å¯æ‰©å±•ï¼šæ‚¨å¯ä»¥åœ¨æ•°æ®ä¸­å¿ƒå†…å¢åŠ å¹¶è‡ªåŠ¨åˆ†å¸ƒå®¹å™¨å‰¯æœ¬ã€‚</li><li>å®‰å…¨ï¼šå®¹å™¨å°†ç§¯æçš„çº¦æŸå’Œéš”ç¦»åº”ç”¨äºæµç¨‹ï¼Œè€Œæ— éœ€ç”¨æˆ·æ–¹é¢çš„ä»»ä½•é…ç½®ã€‚</li></ul><h1 id="Dockerå¹³å°"><a href="#Dockerå¹³å°" class="headerlink" title="Dockerå¹³å°"></a>Dockerå¹³å°</h1><p>Dockeræä¾›äº†åœ¨æ¾æ•£éš”ç¦»çš„ç¯å¢ƒï¼ˆç§°ä¸ºå®¹å™¨ï¼‰ä¸­æ‰“åŒ…å’Œè¿è¡Œåº”ç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚éš”ç¦»å’Œå®‰å…¨æ€§ä½¿æˆ‘ä»¬å¯ä»¥åœ¨ç»™å®šä¸»æœºä¸ŠåŒæ—¶è¿è¡Œå¤šä¸ªå®¹å™¨ã€‚å®¹å™¨æ˜¯è½»é‡çº§çš„ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦è™šæ‹Ÿæœºç®¡ç†ç¨‹åºçš„é¢å¤–è´Ÿè½½ï¼Œè€Œæ˜¯ç›´æ¥åœ¨ä¸»æœºçš„å†…æ ¸ä¸­è¿è¡Œã€‚è¿™æ„å‘³ç€ä¸ä½¿ç”¨è™šæ‹Ÿæœºç›¸æ¯”ï¼Œå¯ä»¥åœ¨ç»™å®šçš„ç¡¬ä»¶ç»„åˆä¸Šè¿è¡Œæ›´å¤šçš„å®¹å™¨ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨å®é™…ä¸Šæ˜¯è™šæ‹Ÿæœºçš„ä¸»æœºä¸­è¿è¡ŒDockerå®¹å™¨ï¼</p><p>Dockeræä¾›äº†å·¥å…·å’Œå¹³å°æ¥ç®¡ç†å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼š</p><ul><li>ä½¿ç”¨å®¹å™¨å¼€å‘åº”ç”¨ç¨‹åºåŠå…¶æ”¯æŒç»„ä»¶ã€‚</li><li>å®¹å™¨æˆä¸ºåˆ†å‘å’Œæµ‹è¯•åº”ç”¨ç¨‹åºçš„å•å…ƒã€‚</li><li>å‡†å¤‡å°±ç»ªåï¼Œå¯ä»¥å°†åº”ç”¨ç¨‹åºä½œä¸ºå®¹å™¨æˆ–åè°ƒæœåŠ¡éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚</li></ul><p>Docker vs è™šæ‹Ÿæœº</p><p>å®¹å™¨åœ¨Linuxä¸Šæœ¬åœ°è¿è¡Œï¼Œå¹¶ä¸å…¶ä»–å®¹å™¨å…±äº«ä¸»æœºçš„å†…æ ¸ã€‚å®ƒè¿è¡Œä¸€ä¸ªç¦»æ•£è¿›ç¨‹ï¼Œä¸å ç”¨ä»»ä½•å…¶ä»–å¯æ‰§è¡Œæ–‡ä»¶æ›´å¤šçš„å†…å­˜ï¼Œä»è€Œä½¿å…¶è½»å·§ã€‚</p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œè™šæ‹Ÿæœºï¼ˆVMï¼‰è¿è¡Œæˆç†Ÿçš„â€œæ¥å®¾â€æ“ä½œç³»ç»Ÿï¼Œå¹¶é€šè¿‡è™šæ‹Ÿæœºç®¡ç†ç¨‹åºå¯¹ä¸»æœºèµ„æºè¿›è¡Œè™šæ‹Ÿè®¿é—®ã€‚é€šå¸¸ï¼ŒVMä¼šäº§ç”Ÿå¤§é‡å¼€é”€ï¼Œè¶…å‡ºäº†åº”ç”¨ç¨‹åºé€»è¾‘æ‰€æ¶ˆè€—çš„å¼€é”€ã€‚</p><ul><li>å®¹å™¨æ—¶åœ¨linuxä¸Šæœ¬æœºè¿è¡Œï¼Œå¹¶ä¸å…¶ä»–å®¹å™¨å…±äº«ä¸»æœºçš„å†…æ ¸ï¼Œå®ƒè¿è¡Œçš„ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä¸å ç”¨å…¶ä»–ä»»ä½•å¯æ‰§è¡Œæ–‡ä»¶çš„å†…å­˜ï¼Œéå¸¸è½»é‡ã€‚</li><li>è™šæ‹Ÿæœºè¿è¡Œçš„æ˜¯ä¸€ä¸ªå®Œæˆçš„æ“ä½œç³»ç»Ÿï¼Œé€šè¿‡è™šæ‹Ÿæœºç®¡ç†ç¨‹åºå¯¹ä¸»æœºèµ„æºè¿›è¡Œè™šæ‹Ÿè®¿é—®ï¼Œç›¸æ¯”ä¹‹ä¸‹éœ€è¦çš„èµ„æºæ›´å¤š</li></ul><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Docker/docker_esxi.png"  alt="Docker_esxi"></p><h1 id="Dockerå’ŒDevopsçš„å…³ç³»"><a href="#Dockerå’ŒDevopsçš„å…³ç³»" class="headerlink" title="Dockerå’ŒDevopsçš„å…³ç³»"></a>Dockerå’ŒDevopsçš„å…³ç³»</h1><p>DevOps å¼ºè°ƒçš„æ˜¯é«˜æ•ˆç»„ç»‡å›¢é˜Ÿä¹‹é—´å¦‚ä½•é€šè¿‡è‡ªåŠ¨åŒ–çš„å·¥å…·åä½œå’Œæ²Ÿé€šæ¥å®Œæˆè½¯ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä»è€Œæ›´å¿«ã€æ›´é¢‘ç¹åœ°äº¤ä»˜æ›´ç¨³å®šçš„è½¯ä»¶ã€‚æœ‰å·¥å…·æ”¯æŒï¼Œè¿ç»´å…³æ³¨ä»£ç ï¼Œå¼€å‘å…³æ³¨éƒ¨ç½²ï¼Œæ•ˆç‡å’Œè´¨é‡éƒ½èƒ½å¾—åˆ°æå‡ã€‚</p><p>åœ¨è½¯ä»¶æ—¥è¶‹å¤æ‚çš„æƒ…å†µä¸‹ï¼Œå¾®æœåŠ¡æ¶æ„æ˜¯å¼¹æ€§æ‰©å±•ã€å¿«é€Ÿè¿­ä»£çš„ä¼˜é€‰ï¼Œå¾®æœåŠ¡æœ‰åˆ©äºè´Ÿè´£å•ä¸ªæœåŠ¡çš„å°å›¢é˜Ÿé™ä½æ²Ÿé€šæˆæœ¬ã€æå‡æ•ˆç‡ï¼Œä¼—å¤šçš„æœåŠ¡å´ä¹Ÿè®©ç ”å‘éœ€è¦å…³å¿ƒç¯å¢ƒäº¤ä»˜ï¼Œæ•´ä¸ªè¿ç»´å·¥ä½œå¤æ‚åº¦å‰§å¢ã€‚è¯´åˆ°ç§’çº§å¯åŠ¨ã€ç§’çº§è‡ªåŠ¨ä¿®å¤ã€æœåŠ¡å‘ç°ã€å¼¹æ€§ä¼¸ç¼©ç­‰ç­‰ï¼Œä½¿ç”¨è™šæ‹Ÿæœºå’Œä½¿ç”¨å®¹å™¨å¹¶æ— è´¨çš„å·®è·ï¼Œä½†æœ‰äº†Dockerï¼Œæœ€å¤§çš„å˜åŒ–æ˜¯ç¯å¢ƒäº¤ä»˜å¯ä»¥æå‰ï¼Œæ¯ä¸ªå¼€å‘åªéœ€å¤šèŠ± 5% çš„æ—¶é—´ï¼Œå°±èƒ½æ¢å–è¿ç»´ 200% çš„åŠ³åŠ¨ï¼Œå¹¶ä¸”æé«˜ç¨³å®šæ€§ã€‚</p><h2 id="å¿«é€Ÿï¼Œä¸€è‡´åœ°äº¤ä»˜æ‚¨çš„åº”ç”¨ç¨‹åº"><a href="#å¿«é€Ÿï¼Œä¸€è‡´åœ°äº¤ä»˜æ‚¨çš„åº”ç”¨ç¨‹åº" class="headerlink" title="å¿«é€Ÿï¼Œä¸€è‡´åœ°äº¤ä»˜æ‚¨çš„åº”ç”¨ç¨‹åº"></a>å¿«é€Ÿï¼Œä¸€è‡´åœ°äº¤ä»˜æ‚¨çš„åº”ç”¨ç¨‹åº</h2><p>Dockerå…è®¸å¼€å‘äººå‘˜ä½¿ç”¨æä¾›æ‚¨çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡çš„æœ¬åœ°å®¹å™¨åœ¨æ ‡å‡†åŒ–ç¯å¢ƒä¸­å·¥ä½œï¼Œä»è€Œç®€åŒ–äº†å¼€å‘ç”Ÿå‘½å‘¨æœŸã€‚å®¹å™¨éå¸¸é€‚åˆæŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ï¼ˆCI / CDï¼‰å·¥ä½œæµç¨‹ã€‚</p><p>æµæ°´çº¿å…·ä½“å¦‚ä¸‹ï¼š</p><ul><li>å¼€å‘äººå‘˜åœ¨æœ¬åœ°ç¼–å†™ä»£ç ï¼Œå¹¶ä½¿ç”¨Dockerå®¹å™¨ä¸åŒäº‹å…±äº«ä»–ä»¬çš„å·¥ä½œã€‚</li><li>ä»–ä»¬ä½¿ç”¨Dockerå°†å…¶åº”ç”¨ç¨‹åºæ¨é€åˆ°æµ‹è¯•ç¯å¢ƒä¸­ï¼Œå¹¶æ‰§è¡Œè‡ªåŠ¨å’Œæ‰‹åŠ¨æµ‹è¯•ã€‚</li><li>å½“å¼€å‘äººå‘˜å‘ç°é”™è¯¯æ—¶ï¼Œä»–ä»¬å¯ä»¥åœ¨å¼€å‘ç¯å¢ƒä¸­å¯¹å…¶è¿›è¡Œä¿®å¤ï¼Œç„¶åå°†å…¶é‡æ–°éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒä¸­ä»¥è¿›è¡Œæµ‹è¯•å’ŒéªŒè¯ã€‚</li><li>æµ‹è¯•å®Œæˆåï¼Œå°†ä¿®è¡¥ç¨‹åºæ¨é€ç»™ç”Ÿäº§ç¯å¢ƒå°±åƒå°†æ›´æ–°çš„æ˜ åƒæ¨é€åˆ°ç”Ÿäº§ç¯å¢ƒä¸€æ ·ç®€å•ã€‚</li></ul><h2 id="å“åº”å¼éƒ¨ç½²å’Œæ‰©å±•"><a href="#å“åº”å¼éƒ¨ç½²å’Œæ‰©å±•" class="headerlink" title="å“åº”å¼éƒ¨ç½²å’Œæ‰©å±•"></a>å“åº”å¼éƒ¨ç½²å’Œæ‰©å±•</h2><p>DockeråŸºäºå®¹å™¨çš„å¹³å°å…è®¸é«˜åº¦å¯ç§»æ¤çš„å·¥ä½œè´Ÿè½½ã€‚Dockerå®¹å™¨å¯ä»¥åœ¨å¼€å‘äººå‘˜çš„æœ¬åœ°ç¬”è®°æœ¬ç”µè„‘ä¸Šï¼Œæ•°æ®ä¸­å¿ƒä¸­çš„ç‰©ç†æˆ–è™šæ‹Ÿæœºä¸Šï¼Œäº‘æä¾›å•†ä¸Šæˆ–æ··åˆç¯å¢ƒä¸­è¿è¡Œã€‚</p><p>Dockerçš„å¯ç§»æ¤æ€§å’Œè½»é‡çº§çš„ç‰¹æ€§è¿˜ä½¿æ‚¨å¯ä»¥è½»æ¾åœ°åŠ¨æ€ç®¡ç†å·¥ä½œè´Ÿè½½ï¼Œå¹¶æ ¹æ®ä¸šåŠ¡éœ€æ±‚æŒ‡ç¤ºå®æ—¶æ‰©å±•æˆ–æ‹†é™¤åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚</p><h2 id="åœ¨åŒä¸€ç¡¬ä»¶ä¸Šè¿è¡Œæ›´å¤šå·¥ä½œè´Ÿè½½"><a href="#åœ¨åŒä¸€ç¡¬ä»¶ä¸Šè¿è¡Œæ›´å¤šå·¥ä½œè´Ÿè½½" class="headerlink" title="åœ¨åŒä¸€ç¡¬ä»¶ä¸Šè¿è¡Œæ›´å¤šå·¥ä½œè´Ÿè½½"></a>åœ¨åŒä¸€ç¡¬ä»¶ä¸Šè¿è¡Œæ›´å¤šå·¥ä½œè´Ÿè½½</h2><p>Dockerè½»å·§å¿«é€Ÿã€‚å®ƒä¸ºåŸºäºè™šæ‹Ÿæœºç®¡ç†ç¨‹åºçš„è™šæ‹Ÿæœºæä¾›äº†å¯è¡Œï¼Œç»æµé«˜æ•ˆçš„æ›¿ä»£æ–¹æ¡ˆï¼Œå› æ­¤æ‚¨å¯ä»¥åˆ©ç”¨æ›´å¤šçš„è®¡ç®—èƒ½åŠ›æ¥å®ç°ä¸šåŠ¡ç›®æ ‡ã€‚Dockeréå¸¸é€‚åˆäºé«˜å¯†åº¦ç¯å¢ƒä»¥åŠä¸­å°å‹éƒ¨ç½²ï¼Œè€Œæ‚¨éœ€è¦ç”¨æ›´å°‘çš„èµ„æºåšæ›´å¤šçš„äº‹æƒ…ã€‚</p><h1 id="Dockerå¼•æ“"><a href="#Dockerå¼•æ“" class="headerlink" title="Dockerå¼•æ“"></a>Dockerå¼•æ“</h1><p>Docker Engineæ˜¯å…·æœ‰ä»¥ä¸‹ä¸»è¦ç»„ä»¶çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼š</p><ul><li><p>æœåŠ¡å™¨æ˜¯ä¸€ç§é•¿æœŸè¿è¡Œçš„ç¨‹åºï¼Œç§°ä¸ºå®ˆæŠ¤ç¨‹åºè¿›ç¨‹ï¼ˆ Dockerdå‘½ä»¤ï¼‰ã€‚å®ˆæŠ¤ç¨‹åºåˆ›å»ºå’Œç®¡ç†Docker å¯¹è±¡ï¼Œä¾‹å¦‚å›¾åƒï¼Œå®¹å™¨ï¼Œç½‘ç»œå’Œå·ã€‚</p></li><li><p>REST APIï¼Œå®ƒæŒ‡å®šç¨‹åºå¯ä»¥ç”¨æ¥ä¸å®ˆæŠ¤ç¨‹åºè¿›è¡Œé€šä¿¡å¹¶æŒ‡ç¤ºå…¶æ“ä½œçš„æ¥å£ã€‚</p></li><li><p>å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰å®¢æˆ·ç«¯ï¼ˆDockerå‘½ä»¤ï¼‰ã€‚<br>CLIä½¿ç”¨Docker REST APIé€šè¿‡è„šæœ¬æˆ–ç›´æ¥CLIå‘½ä»¤æ¥æ§åˆ¶Dockerå®ˆæŠ¤ç¨‹åºæˆ–ä¸Dockerå®ˆæŠ¤ç¨‹åºè¿›è¡Œäº¤äº’ã€‚è®¸å¤šå…¶ä»–Dockeråº”ç”¨ç¨‹åºéƒ½ä½¿ç”¨åŸºç¡€APIå’ŒCLIã€‚</p></li><li><p>Dockerå¼•æ“ç»„ä»¶æµç¨‹</p></li></ul><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Docker/docker_engine.png"  alt="Docker_engine"></p><h1 id="Dockeræ¶æ„"><a href="#Dockeræ¶æ„" class="headerlink" title="Dockeræ¶æ„"></a>Dockeræ¶æ„</h1><p>Dockerä½¿ç”¨ç»å…¸çš„CSæ¶æ„ï¼Œå…¶ä¸­æœ€é‡è¦çš„ç»„æˆå…ƒç´ ä¸ºDaemonã€Clientã€Registriesã€Objectsã€‚</p><p>Docker Clientï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸Docker Daemon ï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰è¿›è¡Œå¯¹è¯ï¼Œè¯¥å®ˆæŠ¤è¿›ç¨‹å®Œæˆäº†æ„å»ºï¼Œè¿è¡Œå’Œåˆ†å‘Dockerå®¹å™¨çš„ç¹é‡å·¥ä½œã€‚Dockerå®¢æˆ·ç«¯å’Œå®ˆæŠ¤ç¨‹åºåœ¨UNIXå¥—æ¥å­—æˆ–ç½‘ç»œæ¥å£ä¸Šä½¿ç”¨REST APIè¿›è¡Œé€šä¿¡ã€‚</p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Docker/docker_cs.png"  alt="Docker_cs"></p><h2 id="Docker-Daemon"><a href="#Docker-Daemon" class="headerlink" title="Docker Daemon"></a>Docker Daemon</h2><p>Dockerå®ˆæŠ¤ç¨‹åºï¼ˆDockerdï¼‰ç›‘å¬Docker APIè¯·æ±‚å¹¶ç®¡ç†Dockerå¯¹è±¡ï¼Œä¾‹å¦‚é•œåƒï¼Œå®¹å™¨ï¼Œç½‘ç»œå’Œå·ã€‚å®ˆæŠ¤ç¨‹åºè¿˜å¯ä»¥ä¸å…¶ä»–å®ˆæŠ¤ç¨‹åºé€šä¿¡ä»¥ç®¡ç†DockeræœåŠ¡ã€‚</p><h2 id="Docker-Client"><a href="#Docker-Client" class="headerlink" title="Docker Client"></a>Docker Client</h2><p>Dockerå®¢æˆ·ç«¯ï¼ˆDockerï¼‰æ˜¯è®¸å¤šDockerç”¨æˆ·ä¸Dockeräº¤äº’çš„ä¸»è¦æ–¹å¼ã€‚å½“æˆ‘ä»¬ä½¿ç”¨è¯¸å¦‚ä¹‹ç±»çš„å‘½ä»¤æ—¶Docker runï¼Œå®¢æˆ·ç«¯ä¼šå°†è¿™äº›å‘½ä»¤å‘é€åˆ°Dockerdï¼Œä»¥æ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚è¯¥Dockerå‘½ä»¤ä½¿ç”¨Docker APIã€‚Dockerå®¢æˆ·ç«¯å¯ä»¥ä¸å¤šä¸ªå®ˆæŠ¤ç¨‹åºé€šä¿¡ã€‚</p><h2 id="Docker-Registries"><a href="#Docker-Registries" class="headerlink" title="Docker Registries"></a>Docker Registries</h2><p>Dockerä»“åº“å­˜å‚¨Dockeré•œåƒã€‚Docker Hubæ˜¯ä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨çš„å…¬å…±ä»“åº“ï¼Œå¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹ï¼ŒDockerå·²é…ç½®ä¸ºåœ¨Docker Hubä¸ŠæŸ¥æ‰¾é•œåƒã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿è¡Œè‡ªå·±çš„ç§æœ‰ä»“åº“ã€‚å¦‚æœä½¿ç”¨Dockeræ•°æ®ä¸­å¿ƒï¼ˆDDCï¼‰ï¼Œåˆ™å…¶ä¸­åŒ…æ‹¬Dockerå¯ä¿¡ä»“åº“ï¼ˆDTRï¼‰ã€‚</p><p>ä½¿ç”¨Docker pullæˆ–Docker runå‘½ä»¤æ—¶ï¼Œæ‰€éœ€çš„é•œåƒå°†ä»é…ç½®çš„ä»“åº“ä¸­æå–ã€‚ä½¿ç”¨è¯¥Docker pushå‘½ä»¤æ—¶ï¼Œä¼šå°†é•œåƒæ¨é€åˆ°é…ç½®çš„ä»“åº“ã€‚</p><h2 id="Docker-Objects"><a href="#Docker-Objects" class="headerlink" title="Docker Objects"></a>Docker Objects</h2><p>æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨Dockeræ—¶ï¼Œæ­£åœ¨åˆ›å»ºå’Œä½¿ç”¨é•œåƒï¼Œå®¹å™¨ï¼Œç½‘ç»œï¼Œå·ï¼Œæ’ä»¶å’Œå…¶ä»–å¯¹è±¡ã€‚ä¸‹é¢è®²å‡ ä¸ªæœ€é‡è¦çš„å¯¹è±¡ã€‚</p><h3 id="IMAGES"><a href="#IMAGES" class="headerlink" title="IMAGES"></a>IMAGES</h3><p>é•œåƒæ˜¯ä¸€ä¸ªåªè¯»æ¨¡æ¿ï¼Œå…¶ä¸­åŒ…å«åˆ›å»ºDockerå®¹å™¨çš„è¯´æ˜ã€‚é€šå¸¸ï¼Œä¸€ä¸ªé•œåƒåŸºäºå¦ä¸€ä¸ªé•œåƒï¼Œå¹¶è¿›è¡Œä¸€äº›å…¶ä»–è‡ªå®šä¹‰ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºè‡ªå·±çš„é•œåƒï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–äººåœ¨ä»“åº“ä¸­å‘å¸ƒçš„é•œåƒã€‚è¦æ„å»ºè‡ªå·±çš„é•œåƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç®€å•çš„è¯­æ³•åˆ›å»ºä¸€ä¸ªDockerfileï¼Œä»¥å®šä¹‰åˆ›å»ºé•œåƒå¹¶è¿è¡Œå®ƒæ‰€éœ€çš„æ­¥éª¤ã€‚Dockerfileä¸­çš„æ¯ä¸ªæŒ‡ä»¤éƒ½ä¼šåœ¨é•œåƒä¸­åˆ›å»ºä¸€ä¸ªå±‚ã€‚å½“æ‚¨æ›´æ”¹Dockerfileå¹¶é‡å»ºé•œåƒæ—¶ï¼Œä»…é‡å»ºé‚£äº›å·²æ›´æ”¹çš„å±‚ã€‚ä¸å…¶ä»–è™šæ‹ŸåŒ–æŠ€æœ¯ç›¸æ¯”ï¼Œè¿™æ˜¯ä½¿é•œåƒå¦‚æ­¤è½»å·§ï¼Œå°å‹å’Œå¿«é€Ÿçš„éƒ¨åˆ†åŸå› ã€‚</p><h3 id="CONTAINERS"><a href="#CONTAINERS" class="headerlink" title="CONTAINERS"></a>CONTAINERS</h3><p>å®¹å™¨æ˜¯é•œåƒçš„å¯è¿è¡Œå®ä¾‹ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Docker APIæˆ–CLIåˆ›å»ºï¼Œå¯åŠ¨ï¼Œåœæ­¢ï¼Œç§»åŠ¨æˆ–åˆ é™¤å®¹å™¨ã€‚æˆ‘ä»¬å¯ä»¥å°†å®¹å™¨è¿æ¥åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªç½‘ç»œï¼Œå°†å­˜å‚¨è¿æ¥åˆ°å®ƒï¼Œç”šè‡³æ ¹æ®å…¶å½“å‰çŠ¶æ€åˆ›å»ºæ–°é•œåƒã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨ä¸å…¶ä»–å®¹å™¨åŠå…¶ä¸»æœºä¹‹é—´çš„éš”ç¦»ç¨‹åº¦ç›¸å¯¹è¾ƒé«˜ã€‚æˆ‘ä»¬å¯ä»¥æ§åˆ¶å®¹å™¨çš„ç½‘ç»œï¼Œå­˜å‚¨æˆ–å…¶ä»–åŸºç¡€å­ç³»ç»Ÿä¸å…¶ä»–å®¹å™¨æˆ–ä¸ä¸»æœºçš„éš”ç¦»ç¨‹åº¦ã€‚</p><p>å®¹å™¨ç”±å…¶æ˜ åƒä»¥åŠåœ¨åˆ›å»ºæˆ–å¯åŠ¨æ—¶ä¸ºå…¶æä¾›çš„ä»»ä½•é…ç½®é€‰é¡¹å®šä¹‰ã€‚åˆ é™¤å®¹å™¨åï¼Œæœªå­˜å‚¨åœ¨æŒä¹…æ€§å­˜å‚¨ä¸­çš„çŠ¶æ€æ›´æ”¹å°†æ¶ˆå¤±ã€‚</p><h3 id="SERVICES"><a href="#SERVICES" class="headerlink" title="SERVICES"></a>SERVICES</h3><p>æœåŠ¡å…è®¸æ‰©å±•åœ¨å¤šä¸ªDockerå®ˆæŠ¤è¿›ç¨‹çš„å®¹å™¨ã€‚ç¾¤é›†çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯Dockerå®ˆæŠ¤ç¨‹åºï¼Œæ‰€æœ‰å®ˆæŠ¤ç¨‹åºéƒ½ä½¿ç”¨Docker APIè¿›è¡Œé€šä¿¡ã€‚æœåŠ¡å…è®¸æˆ‘ä»¬å®šä¹‰æ‰€éœ€çš„çŠ¶æ€ï¼Œä¾‹å¦‚åœ¨ä»»ä½•ç»™å®šæ—¶é—´å¿…é¡»å¯ç”¨çš„æœåŠ¡å‰¯æœ¬çš„æ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æœåŠ¡åœ¨æ‰€æœ‰å·¥ä½œèŠ‚ç‚¹ä¹‹é—´æ˜¯è´Ÿè½½å¹³è¡¡çš„ã€‚å¯¹äºæ¶ˆè´¹è€…è€Œè¨€ï¼ŒDockeræœåŠ¡ä¼¼ä¹æ˜¯ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨ç¨‹åºã€‚Docker Engineåœ¨Docker 1.12åŠæ›´é«˜ç‰ˆæœ¬ä¸­æ”¯æŒé›†ç¾¤æ¨¡å¼ã€‚</p><h3 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h3><p>æ•°æ®å·ï¼Œç”¨äºä¿å­˜æŒä¹…åŒ–æ•°æ®ã€‚å½“æˆ‘ä»¬å°†æ•°æ®åº“ä¾‹å¦‚MySQLè¿è¡Œåœ¨Dockerå®¹å™¨ä¸­æ—¶ï¼Œä¸€èˆ¬å°†æ•°æ®é€šè¿‡Docker Volumeä¿å­˜åœ¨ä¸»æœºä¸Šï¼Œè¿™æ ·å³ä½¿åˆ é™¤MySQLå®¹å™¨ï¼Œæ•°æ®ä¾ç„¶ä¿å­˜åœ¨ä¸»æœºä¸Šï¼Œæœ‰æ•ˆä¿è¯äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚</p><h3 id="NETWORK"><a href="#NETWORK" class="headerlink" title="NETWORK"></a>NETWORK</h3><p>Dockerä½¿ç”¨Linuxæ¡¥æ¥ï¼Œåœ¨å®¿ä¸»æœºè™šæ‹Ÿä¸€ä¸ªDockerå®¹å™¨ç½‘æ¡¥(Docker0)ï¼ŒDockerå¯åŠ¨ä¸€ä¸ªå®¹å™¨æ—¶ä¼šæ ¹æ®Dockerç½‘æ¡¥çš„ç½‘æ®µåˆ†é…ç»™å®¹å™¨ä¸€ä¸ªIPåœ°å€ï¼Œç§°ä¸ºContainer-IPï¼ŒåŒæ—¶Dockerç½‘æ¡¥æ˜¯æ¯ä¸ªå®¹å™¨çš„é»˜è®¤ç½‘å…³ã€‚å› ä¸ºåœ¨åŒä¸€å®¿ä¸»æœºå†…çš„å®¹å™¨éƒ½æ¥å…¥åŒä¸€ä¸ªç½‘æ¡¥ï¼Œè¿™æ ·å®¹å™¨ä¹‹é—´å°±èƒ½å¤Ÿé€šè¿‡å®¹å™¨çš„Container-IPç›´æ¥é€šä¿¡ã€‚</p><p>Dockerç½‘æ¡¥æ˜¯å®¿ä¸»æœºè™šæ‹Ÿå‡ºæ¥çš„ï¼Œå¹¶ä¸æ˜¯çœŸå®å­˜åœ¨çš„ç½‘ç»œè®¾å¤‡ï¼Œå¤–éƒ¨ç½‘ç»œæ˜¯æ— æ³•å¯»å€åˆ°çš„ï¼Œè¿™ä¹Ÿæ„å‘³ç€å¤–éƒ¨ç½‘ç»œæ— æ³•é€šè¿‡ç›´æ¥Container-IPè®¿é—®åˆ°å®¹å™¨ã€‚å¦‚æœå®¹å™¨å¸Œæœ›å¤–éƒ¨è®¿é—®èƒ½å¤Ÿè®¿é—®åˆ°ï¼Œå¯ä»¥é€šè¿‡æ˜ å°„å®¹å™¨ç«¯å£åˆ°å®¿ä¸»ä¸»æœºï¼ˆç«¯å£æ˜ å°„ï¼‰ï¼Œå³Docker runåˆ›å»ºå®¹å™¨æ—¶å€™é€šè¿‡ -p æˆ– -P å‚æ•°æ¥å¯ç”¨ï¼Œè®¿é—®å®¹å™¨çš„æ—¶å€™å°±é€šè¿‡[å®¿ä¸»æœºIP]:[å®¹å™¨ç«¯å£]è®¿é—®å®¹å™¨ã€‚</p><h1 id="åº•å±‚åŸç†"><a href="#åº•å±‚åŸç†" class="headerlink" title="åº•å±‚åŸç†"></a>åº•å±‚åŸç†</h1><p>Dockerç”¨Goç¼–å†™ï¼Œå¹¶åˆ©ç”¨Linuxå†…æ ¸çš„å¤šä¸ªåŠŸèƒ½æ¥äº¤ä»˜å…¶åŠŸèƒ½ã€‚</p><p>å‘½åç©ºé—´ã€æ§åˆ¶ç»„ã€è”åˆæ–‡ä»¶ç³»ç»Ÿã€å®¹å™¨æ ¼å¼ã€‚</p><h2 id="Namespacesï¼ˆå‘½åç©ºé—´ï¼‰"><a href="#Namespacesï¼ˆå‘½åç©ºé—´ï¼‰" class="headerlink" title="Namespacesï¼ˆå‘½åç©ºé—´ï¼‰"></a>Namespacesï¼ˆå‘½åç©ºé—´ï¼‰</h2><p>Dockerä½¿ç”¨ä¸€ç§ç§°ä¸ºnamespacesæä¾›å®¹å™¨çš„éš”ç¦»å·¥ä½œåŒºçš„æŠ€æœ¯ã€‚è¿è¡Œå®¹å™¨æ—¶ï¼ŒDockerä¼šä¸ºè¯¥å®¹å™¨åˆ›å»ºä¸€ç»„å‘½åç©ºé—´ã€‚</p><p>è¿™äº›åç§°ç©ºé—´æä¾›äº†ä¸€å±‚éš”ç¦»ã€‚å®¹å™¨çš„æ¯ä¸ªæ–¹é¢éƒ½åœ¨å•ç‹¬çš„åç§°ç©ºé—´ä¸­è¿è¡Œï¼Œå¹¶ä¸”å¯¹å…¶çš„è®¿é—®ä»…é™äºè¯¥åç§°ç©ºé—´ã€‚</p><p>Docker Engineåœ¨Linuxä¸Šä½¿ç”¨ä»¥ä¸‹åç§°ç©ºé—´ï¼š</p><ul><li>The pid namespace: è¿›ç¨‹éš”ç¦» (PID: è¿›ç¨‹ID).</li><li>The net namespace: ç®¡ç†ç½‘ç»œæ¥å£ (NET: ç½‘ç»œ).</li><li>The ipc namespace: ç®¡ç†è®¿é—®IPCèµ„æº (IPC: è¿›ç¨‹é—´é€šä¿¡).</li><li>The mnt namespace: ç®¡ç†æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹ (MNT: æŒ‚è½½).</li><li>The uts namespace: éš”ç¦»å†…æ ¸å’Œç‰ˆæœ¬æ ‡è¯†ç¬¦ã€‚ (UTS:Unixæ—¶é—´å…±äº«ç³»ç»Ÿ).</li></ul><h2 id="Control-groupsï¼ˆæ§åˆ¶ç»„ï¼‰"><a href="#Control-groupsï¼ˆæ§åˆ¶ç»„ï¼‰" class="headerlink" title="Control groupsï¼ˆæ§åˆ¶ç»„ï¼‰"></a>Control groupsï¼ˆæ§åˆ¶ç»„ï¼‰</h2><p>Linuxä¸Šçš„Dockerå¼•æ“è¿˜ä¾èµ–äºå¦ä¸€ç§ç§°ä¸ºæ§åˆ¶ç»„çš„æŠ€æœ¯ã€‚Cgå°†åº”ç”¨ç¨‹åºé™åˆ¶ä¸ºä¸€ç»„ç‰¹å®šçš„èµ„æºã€‚æ§åˆ¶ç»„å…è®¸Docker Engineå°†å¯ç”¨çš„ç¡¬ä»¶èµ„æºå…±äº«ç»™å®¹å™¨ï¼Œå¹¶æœ‰é€‰æ‹©åœ°å®æ–½é™åˆ¶å’Œçº¦æŸã€‚ä¾‹å¦‚ï¼ŒCPUã€å†…å­˜ã€‚</p><h2 id="Union-file-systemsï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰"><a href="#Union-file-systemsï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰" class="headerlink" title="Union file systemsï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰"></a>Union file systemsï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰</h2><p>UnionFSæ˜¯é€šè¿‡åˆ›å»ºå›¾å±‚è¿›è¡Œæ“ä½œçš„æ–‡ä»¶ç³»ç»Ÿ,ä½¿å…¶éå¸¸è½»ä¾¿ä¸”å¿«é€Ÿã€‚Docker Engineä½¿ç”¨UnionFSä¸ºå®¹å™¨æä¾›æ„å»ºæ¨¡å—ã€‚UnionFSå¯ä»¥æŠŠæ–‡ä»¶ç³»ç»Ÿä¸Šå¤šä¸ªç›®å½•(ä¹Ÿå«åˆ†æ”¯)å†…å®¹è”åˆæŒ‚è½½åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œè€Œç›®å½•çš„ç‰©ç†ä½ç½®æ˜¯åˆ†å¼€çš„ã€‚é€šä¿—æ¥è¯´ï¼Œè¿™ä¸ªæŠ€æœ¯å°±æ˜¯Docker imageå®ç°åˆ†å±‚çš„æŠ€æœ¯åŸºç¡€ï¼Œå› ä¸ºé•œåƒå°±æ˜¯ä»åŸºç¡€é•œåƒä¸Šä¸€å±‚å±‚å åŠ æ–°çš„é€»è¾‘æ„æˆçš„ï¼Œè¿™ç§åˆ†å±‚è®¾è®¡ï¼Œä¸€ä¸ªä¼˜ç‚¹å°±æ˜¯èµ„æºå…±äº«ã€‚</p><h2 id="Container-formatï¼ˆå®¹å™¨æ ¼å¼ï¼‰"><a href="#Container-formatï¼ˆå®¹å™¨æ ¼å¼ï¼‰" class="headerlink" title="Container formatï¼ˆå®¹å™¨æ ¼å¼ï¼‰"></a>Container formatï¼ˆå®¹å™¨æ ¼å¼ï¼‰</h2><p>Docker Engineå°†å‘½åç©ºé—´ï¼Œæ§åˆ¶ç»„å’ŒUnionFSç»„åˆåˆ°ä¸€ä¸ªç§°ä¸ºå®¹å™¨æ ¼å¼çš„åŒ…è£…å™¨ä¸­ã€‚é»˜è®¤å®¹å™¨æ ¼å¼ä¸ºlibcontainerã€‚æœªæ¥ï¼ŒDockerå¯èƒ½ä¼šé€šè¿‡ä¸BSD Jailsæˆ–Solaris Zonesç­‰æŠ€æœ¯é›†æˆæ¥æ”¯æŒå…¶ä»–å®¹å™¨æ ¼å¼ã€‚</p><p>libcontaineråŸºäºGoå®ç°ï¼Œç”¨äºåˆ›å»ºå…·æœ‰åç§°ç©ºé—´ï¼Œcgroupï¼ŒåŠŸèƒ½å’Œæ–‡ä»¶ç³»ç»Ÿè®¿é—®æ§åˆ¶çš„è½¯ä»¶åŒ…ã€‚ä½¿ç”¨libcontainerå¯ä»¥ç®¡ç†åˆ›å»ºå®¹å™¨ä»¥åŠæ‰§è¡Œå…¶ä»–æ“ä½œçš„å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚å®ƒå®šä¹‰çš„å®¹å™¨æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ‰§è¡Œç¯å¢ƒï¼Œå®ƒå…±äº«ä¸»æœºç³»ç»Ÿçš„å†…æ ¸ï¼Œå¹¶ä¸”ï¼ˆå¯é€‰ï¼‰ä¸ç³»ç»Ÿä¸­çš„å…¶ä»–å®¹å™¨éš”ç¦»ã€‚</p><p>å®¹å™¨æ˜¯é€šè¿‡ä¸¤æ­¥è¿‡ç¨‹ç”Ÿæˆçš„ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼šè¦åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œæˆ‘ä»¬é¦–å…ˆå¿…é¡»åˆå§‹åŒ–ä¸€ä¸ªå·¥å‚å®ä¾‹ï¼Œè¯¥å®ä¾‹å°†å¤„ç†å®¹å™¨çš„åˆ›å»ºå’Œåˆå§‹åŒ–ã€‚</p><p>ç¬¬äºŒæ­¥ï¼šä¸€æ—¦åˆ›å»ºäº†å·¥å‚çš„å®ä¾‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥æè¿°å¦‚ä½•åˆ›å»ºå®¹å™¨ã€‚</p><p>å¡«å……é…ç½®åï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªå®¹å™¨ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ›¾ç»æœ‰ä½é«˜äººæŒ‡å¯¼è¿‡æˆ‘å­¦ä¹ çš„æ–¹æ³•ï¼šæ•…å¸¸æ— æ¬²ï¼Œä»¥è§‚å…¶å¦™ï¼›å¸¸æœ‰æ¬²ï¼Œä»¥è§‚å…¶å¾¼ã€‚æˆ‘åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ä¸æ–­ç¢ç£¨è¿™å¥è¯çš„çœŸæ­£å«ä¹‰ï¼Œæœ¬ç³»åˆ—æ­£æ˜¯é€šè¿‡è¿™ä¸ªæ€æƒ³ç ”ç©¶Dockerå‡ºç°çš„æ„ä¹‰ã€‚ä»ä¸‹ç¯‡å¼€å§‹ï¼Œæˆ‘å°†æ·±å…¥è®²è§£Dockerçš„æ¯ä¸ªæŠ€æœ¯ç‚¹åŠä½œç”¨ã€‚</p><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><p><a href="https://docs.docker.com/get-started/overview/" target="_blank" rel="noopener">Dockerå®˜æ–¹æ–‡æ¡£</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Devops </tag>
            
            <tag> Docker </tag>
            
            <tag> å®¹å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¡¶çº§ç†è§£ä¹‹äº’è”ç½‘çš„åæµª</title>
      <link href="/2020/05/17/king/king-backwave/"/>
      <url>/2020/05/17/king/king-backwave/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜: é¡¶çº§ç†è§£ç³»åˆ—å…¨éƒ¨æ˜¯æœ¬äººçš„ä¸»è§‚çœ‹æ³•ï¼Œä¹Ÿè®¸åœ¨ä½ çœ‹æ¥ä»¥æˆ‘ç°åœ¨çš„é˜…å†ä¸èƒ½å¯¹æŸäº›äº‹ç‰©æœ‰ç€ç²¾å‡†çš„åˆ¤æ–­ï¼Œæœ›ä¸å–œå‹¿å–·ï¼Œæ±‚åŒå­˜å¼‚ã€‚</p><hr><p>æœ€è¿‘ä¸€ä¸ªæœˆæˆ‘å—åˆ°äº†å¾ˆå¤šå¤§ä½¬å‰è¾ˆä»¬çš„æ•™å¯¼ï¼Œè§è¯äº†ç¤¾ä¼šä¸­ä¸€ä»¶ä»¶å¤§äº‹ä»¶çš„å‘ç”Ÿï¼Œæ¬£èµäº†ä¸€äº›å¯¹äº’è”ç½‘åæ€ã€æ€»ç»“çš„æ–‡ç« ï¼Œæˆ‘æ„Ÿè§¦æŒºå¤šã€‚å’Œèº«è¾¹çš„æœ‹å‹äº¤è°ˆä¸­ä»–ä»¬æ— ä¸€ä¸è¯´ï¼Œå®‡å“¥ï¼Œæ„Ÿè§‰ä½ æœ€è¿‘å˜å¾—æˆç†Ÿäº†ï¼Œå—äº†ä»€ä¹ˆåˆºæ¿€å—ã€‚å…¶å®æ˜¯è¿™æ¬¡ç–«æƒ…çš„å‡ºç°ï¼Œè®©æˆ‘æ›´åŠ çœŸå®åœ°çœ‹è§äº†è‡ªå·±çš„å¾®ä¸è¶³é“ï¼Œåæ€è‡ªå·±ä»å°åˆ°å¤§çš„ç»å†ï¼Œæ€»ç»“å¹¶ä¸æ–­æé«˜è‡ªå·±ï¼Œè§„åˆ’æœªæ¥çš„é‚£ä¸ªè‡ªå·±ï¼Œæ¢¦æƒ³æœ‰ä¸€å¤©æˆä¸ºäº’è”ç½‘ä¸­çš„åæµªï¼Œèƒ½å¥”æ¶Œå‰è¿›ï¼</p><h1 id="æ­£æ–‡å¼€å§‹"><a href="#æ­£æ–‡å¼€å§‹" class="headerlink" title="æ­£æ–‡å¼€å§‹"></a>æ­£æ–‡å¼€å§‹</h1><p>æœ€è¿‘Bç«™çš„åæµªå¾ˆç«ï¼Œå¦‚æœæ²¡æœ‰çœ‹è¿‡çš„å¯ä»¥ç‚¹å‡»ä¸‹é¢çš„ä¼ é€é—¨ï¼Œä¸€è§ˆä½•å†°è€å¸ˆçš„æ…·æ…¨è‡´è¾ã€‚å½“æˆ‘çœ‹å®Œåæµªåï¼Œæˆ‘å¿ƒæƒ…ä¹…ä¹…ä¸èƒ½å¹³é™ï¼Œåˆåå¤è§‚çœ‹å‡ æ¬¡ï¼Œä½“ä¼šç€ä¸Šä¸€ä»£äººå¯¹æˆ‘ä»¬è¿™ä¸€ä»£äººçš„ç¾¡æ…•ã€æ•¬æ„ã€æ„Ÿæ¿€ã€‚åæµªå±•ç¤ºäº†æ˜¯æœ€å¥½çš„æ—¶ä»£ï¼Œè¿™ä¹Ÿæ˜¯æœ€å¥½çš„é’æ˜¥ã€‚æ—¶ä»£çš„é¦ˆèµ ã€ä¸ªäººçš„æ¢ç´¢ï¼Œæ±‡èšæˆé’æ˜¥çš„è“¬å‹ƒã€ç”Ÿå‘½çš„ä¸°ç››ã€‚ä¸€æ¬¡ä¸é’å¹´çš„å¯¹è¯ï¼Œè®©äººæ²‰æ€é’æ˜¥çš„ä»·å€¼ã€æˆé•¿çš„æ„ä¹‰ã€‚</p><p><a href="https://www.bilibili.com/video/BV1FV411d7u7?from=search&seid=6731801181146737106" target="_blank" rel="noopener">åæµª</a></p><p>å…³äºåæµªï¼Œç½‘ä¸Šçš„è¯„è®ºè¤’è´¬ä¸ä¸€ã€‚</p><p>æœ‰äººè¡¨ç¤ºï¼Œã€Šåæµªã€‹æ‰€æç»˜çš„ï¼Œä¸è¿‡æ˜¯ç‰©è´¨æ¡ä»¶æœ€ä¼˜è¶Šçš„å¹´è½»äººå¤„å¢ƒï¼šä»–ä»¬è·³ä¼ã€ç©Cosplayã€å–œæ¬¢æ±‰æœã€æ‘„å½±å’Œæ½œæ°´ï¼Œä»–ä»¬å®¹è²Œä¿Šä¿ã€é²œè¡£æ€’é©¬ï¼Œæ‰èƒ½æœ‰äº«å—è‡ªç”±äººç”Ÿçš„æƒåˆ©ï¼Œè€Œæ›´å¤šçš„äººè¿˜åœ¨è‹¦è‹¦ä¸ºç”Ÿå­˜æŒ£æ‰ã€‚</p><p>è¯šç„¶ï¼ŒBç«™ç‰ˆçš„åæµªç¡®å®å±•ç¤ºäº†æœ€ä¼˜è¶Šçš„å¹´è½»äººçš„é€‰æ‹©çš„æƒåˆ©ï¼Œä»–ä»¬å‡ºèº«ä¼˜è¶Šèƒ½æœ‰è¿™ä¹ˆå¤šé€‰æ‹©ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯åæµªæ‰€è¦å±•ç¤ºçš„ä»·å€¼è§‚ï¼Œå¦‚æœä½ è§‰å¾—åæµªæ‰€å±•ç¤ºçš„ä»·å€¼è§‚å¤ªè„±ç¦»å®é™…ï¼Œæˆ‘å»ºè®®ä½ çœ‹çœ‹å¤®è§†ç‰ˆçš„åæµªã€‚</p><p>æˆ‘è®¤ä¸ºå¤§éƒ¨åˆ†å¹´è½»äººåœ¨å½“ä»Šç¤¾ä¼šä¸€æ ·å…·æœ‰å¾ˆå¤šé€‰æ‹©çš„æƒåŠ›ã€‚æ¯”èµ·æˆ‘ä»¬ä¸Šä¸€è¾ˆï¼Œæˆ‘ä»¬å¤šäº†ä»€ä¹ˆé€‰æ‹©å‘¢ï¼Œå€Ÿç”¨åæµªé‡Œçš„è¯ï¼š</p><hr><p>äººç±»ç§¯æ”’äº†å‡ åƒå¹´çš„è´¢å¯Œ</p><p>æ‰€æœ‰çš„çŸ¥è¯†ã€è§è¯†ã€æ™ºæ…§å’Œè‰ºæœ¯</p><p>åƒæ˜¯ä¸“é—¨ä¸ºä½ ä»¬å‡†å¤‡çš„ç¤¼ç‰©</p><p>ç§‘æŠ€ç¹è£</p><p>æ–‡åŒ–ç¹èŒ‚</p><p>åŸå¸‚ç¹å</p><p>ç°ä»£æ–‡æ˜çš„æˆæœ</p><p>è¢«å±‚å±‚æ‰“å¼€</p><p>å¯ä»¥å°½æƒ…äº«ç”¨</p><hr><p>å…¶ä¸­è¿™é‡Œå°±ä¸å¾—ä¸è¯´åˆ°äº’è”ç½‘ï¼Œç°ä»£æ–‡æ˜çš„æˆæœç¦»ä¸å¼€äº’è”ç½‘çš„è´¡çŒ®ï¼Œæˆ‘ä»¬åœ¨äº’è”ç½‘ä¸­å¯ä»¥é€‰æ‹©å¾ˆå¤šï¼Œå¹¶ä¸”æˆ‘åšä¿¡ï¼Œè¿™åº”è¯¥æ˜¯è¿™ä¸ªç¤¾ä¼šèƒ½å¤Ÿèµ‹äºˆæ¯ä¸ªå¹´è½»äººæœ€åŸºæœ¬çš„é€‰æ‹©æƒåŠ›ä¹‹ä¸€ã€‚</p><ul><li>äº’è”ç½‘çš„æ— é™åŒ…å®¹æ€§ï¼Œæ‰“ç ´äº†ä»¥å¾€çš„ä¿¡æ¯ä¸å¯¹ç§°ï¼Œä½¿å¾—äººä»¬èƒ½è½»è€Œæ˜“ä¸¾åœ°è·å–ä¿¡æ¯ã€æ¥æ”¶çŸ¥è¯†ã€‚</li><li>äº’è”ç½‘å¸¦æ¥çš„æ–°å˜åŒ–ã€æ–°æœºé‡ã€æ–°æ ¼å±€ï¼Œä½¿å¾—ç«äº‰å˜å¾—æ›´ä¸ºæ¿€çƒˆã€æ›´ä¸ºç›´æ¥ã€æ›´ä¸ºé€æ˜ï¼Œå¹¶æ°¸æ— åœæ­¢åœ°åœ¨æŒ‘æˆ˜ç€æ—¢æœ‰å¸‚åœºçš„æ—§æ ¼å±€ã€æ—§è§„åˆ™ã€‚å¢¨å®ˆæˆè§„å·²ç»æ²¡æœ‰å‡ºè·¯ï¼Œäº’è”ç½‘ä¿¡æ¯æ—¶ä»£å·²ç»æå‡ºäº†å¿…é¡»è¦é¢å¯¹æ–°å½¢åŠ¿ä¸‹çš„æ–°æŒ‘æˆ˜è¿™ä¸ªè¿«åœ¨çœ‰ç«çš„è¯¾é¢˜ã€‚</li><li>ç›¸å¯¹äºç°å®ä¸–ç•Œï¼Œäº’è”ç½‘åˆæ˜¯å¦ä¸€ä¸ªè™šæ‹Ÿä¸–ç•Œï¼Œä¸€ä¸ªæ–°çš„ä¸–ç•Œã€‚äººä»¬æ—¢ç”Ÿæ´»åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œä¹Ÿå­˜åœ¨äºäº’è”ç½‘è™šæ‹Ÿä¸–ç•Œé‡Œï¼Œå®ç°ä¸­ï¼Œç›¸å½“ä¸€éƒ¨åˆ†äººç”šè‡³æ˜¯æ— æ³•ç”Ÿæ´»åœ¨æ²¡æœ‰ç½‘ç»œçš„ä¸–ç•Œé‡Œçš„ã€‚</li><li>äº’è”ç½‘ç›´æ¥æˆ–é—´æ¥çš„ä¸ºäººè¿›è¡Œèµ‹èƒ½ï¼Œäº’è”ç½‘æ–°å·¥å…·æ–°æŠ€æœ¯æ–°æ€ç»´è®©äººä¸å†å±€é™äºåŒæ‰‹åŒè„šï¼Œä½†å´æ‹¥æœ‰æ¯”åŸæ¥è¿˜è¦é«˜çº§è¿˜è¦å¼ºå¤§çš„èƒ½åŠ›ï¼Œå¹¶ä¸æ–­çªç ´è‡ªæˆ‘ï¼Œé¢å¯¹æ–°æœºé‡ä¸å†æ˜¾å¾—æŸæ‰‹æ— ç­–ï¼Œä¸ç®¡ä½ è®¤ä¸è®¤å¯ï¼Œäº’è”ç½‘ä»¥ä¸€ç§çœ‹ä¸è§çš„åŠ›é‡æ¨åŠ¨ç€ç¤¾ä¼šå†å²çš„å˜è¿ã€‚</li></ul><p>äº’è”ç½‘æ—¶ä»£æ­£åœ¨æ”¹å˜å’Œå½±å“æˆ‘ä»¬çš„ç”Ÿæ´»ï¼Œé‚£ä¹ˆä¸€ä¸ªæ–°é’å¹´æ€ä¹ˆæ‰èƒ½æˆä¸ºäº’è”ç½‘è¡Œä¸šä¸­ä¸€æœµçœŸæ­£çš„åæµªå‘¢ï¼Ÿæˆ‘è®¤ä¸ºéœ€è¦è¦æœ‰ä»¥ä¸‹3ç‚¹ï¼Œæ´å¯Ÿæ ¼å±€ã€æå‡æŠ€æœ¯ã€ä¸å¿˜åˆå¿ƒã€‚</p><h1 id="æ´å¯Ÿæ ¼å±€"><a href="#æ´å¯Ÿæ ¼å±€" class="headerlink" title="æ´å¯Ÿæ ¼å±€"></a>æ´å¯Ÿæ ¼å±€</h1><p>å½“å‰ä¸­å›½çš„äº’è”ç½‘æ ¼å±€æ˜¯ä»€ä¹ˆï¼Ÿå½“å‰ä¸–ç•Œçš„äº’è”ç½‘æ ¼å±€æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬èº«å¤„çš„äº’è”ç½‘ç¯å¢ƒæ˜¯æ€ä¹ˆæ ·ï¼Ÿ</p><p>æˆ‘ä¸èƒ½å¤Ÿæ¸…æ™°å‡†ç¡®åœ°å›ç­”å¤§å®¶ï¼Œä½†æ˜¯æˆ‘çœ‹åˆ°è¿‡ä¸€ç¯‡æ–‡ç« ï¼Œè¿™ä¹ˆæ¥å½¢å®¹ä¸­å›½äº’è”ç½‘çš„å†å²ã€‚æœ‰åŠ©äºå¤§å®¶æé«˜è‡ªå·±çš„æ ¼å±€ã€‚</p><h2 id="å†å²"><a href="#å†å²" class="headerlink" title="å†å²"></a>å†å²</h2><p><a href="https://www.36kr.com/p/5100918" target="_blank" rel="noopener">ä¸­å›½äº’è”ç½‘å²å°±æ˜¯ä¸€éƒ¨æµæ°“å²</a></p><p>è¯¥æ–‡ç« ä¸»è¦è¯´æ˜äº†å›½å†…çš„äº’è”ç½‘ç¯å¢ƒå¾ˆå·®ã€‚ä¸»è¦å½’ç»“äºå‡ ç‚¹ï¼š</p><ul><li>ç»‘æ¶å²ï¼šè¢«æ’ä»¶å›°æŒ çš„20å¹´</li><li>æŠ„è¢­å²ï¼šåˆ›æ–°æ˜¯äº’è”ç½‘ä¼ä¸šçš„ç»Šè„šçŸ³</li><li>ä½ä¿—å²ï¼šä»ç¤¾ä¼šç²¾è‹±åˆ°ç½‘ç»œå–·å­</li><li>ç›—ç‰ˆå²ï¼šçŸ¥è¯†äº§æƒæ˜¯ä¸ªä»€ä¹ˆç©æ„å„¿</li><li>å„æ–­å²ï¼šä»å»ä¸­å¿ƒåŒ–åˆ°ä¸­å¿ƒåŒ–</li></ul><p>å¼•ç”¨é‡Œé¢çš„ä¸€å¤§æ®µè¯</p><hr><p>wwwçš„è®¾è®¡è€…Tim Berners-Leeè®¤ä¸ºäº’è”ç½‘æœ¬æ¥æ˜¯å»ä¸­å¿ƒåŒ–çš„æ‹“æ‰‘ç»“æ„ï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥å»ºè®¾è‡ªå·±çš„ç½‘ç«™ï¼Œä½†ç°åœ¨ï¼Œäº’è”ç½‘å·²ç»å®Œå…¨æˆä¸ºä¸€ç§ä¸­å¿ƒåŒ–ç»“æ„ã€‚åŸŸåä½ è¦å»æ–°ç½‘æˆ–è€…ä¸‡ç½‘ï¼ˆå·²ç»é˜¿é‡Œç³»çš„äº†ï¼‰ï¼ŒæœåŠ¡å™¨ä½ å¯èƒ½åªä¼šé€‰æ‹©è…¾è®¯äº‘æˆ–è€…é˜¿é‡Œäº‘ã€‚è¿™è¿˜ä¸æ˜¯æœ€åçš„ç»“æœï¼Œæ¯•ç«Ÿä½ è¿˜èƒ½å»ºä¸ªå±äºè‡ªå·±çš„ç½‘ç«™ã€‚æ¯”è¿™ä¸ªæ›´ææ€–çš„æ˜¯è‹¹æœçš„å‡ºç°ï¼Œå®ƒç”¨iOSç³»ç»Ÿå’ŒiPhoneç‰¢ç‰¢çš„æŠŠæ¯ä¸€å®¶äº’è”ç½‘å…¬å¸ç»™é”æ­»ï¼Œå”¯ä¸€èƒ½å¤Ÿä¸ä¹‹æŠ—è¡¡çš„æ˜¯Google / Facebook / Amazonâ€¦â€¦ä½†è¿™äº›å…¬å¸ä½ åŒæ ·ä¼šè§‰å¾—å®ƒä»¬ä¸è‹¹æœæ²¡ä»€ä¹ˆä¸¤æ ·ã€‚</p><p>ä¸­å›½çš„äº’è”ç½‘å…¬å¸çš„ä¸­å¿ƒåŒ–æœ‰è¿‡ä¹‹è€Œæ— ä¸åŠï¼Œç”šè‡³å¯ä»¥è¯´ï¼Œä¸­å›½äº’è”ç½‘çš„å‘å±•å²å°±æ˜¯BATä¸‰è¶³é¼ç«‹çš„å†å²ï¼Œ1998å¹´çš„è…¾è®¯ã€1999å¹´çš„é˜¿é‡Œã€2000å¹´çš„ç™¾åº¦ã€‚ä¼¼ä¹åœ¨20å¹´å‰ï¼Œå®¿å‘½å·²ç»æ³¨å®šã€‚è™½ç„¶2008å¹´ç§»åŠ¨äº’è”ç½‘å‡ºç°åç¨æœ‰å˜æ•°ï¼Œä½†åªè¦ç™¾åº¦ä¸å†å‡ºæ˜æ‹›ï¼Œæ–°æ™‹å°å·¨å¤´TMDï¼ˆä»Šæ—¥å¤´æ¡ã€ç¾å›¢ã€æ»´æ»´ï¼‰è¿˜æ˜¯å¾ˆéš¾è¶…è¶Šçš„ã€‚</p><p>ç°åœ¨æ–°çš„åˆ›ä¸šå…¬å¸éƒ½ä¸æƒ³å»ºç«‹è‡ªå·±çš„ç½‘ç«™äº†ï¼ŒæœåŠ¡åœ¨å…¬ä¼—å·é‡Œå®Œæˆï¼Œå•†å“åœ¨æ·˜å®ä¸Šå¼€ä¸ªåº—ï¼Œæ–°é—»åœ¨å¤´æ¡é‡Œå‘å¸ƒâ€¦â€¦ä½•å¿…è¦è‡ªå·±å»ºç«‹ä¸€ä¸ªä¸­å¿ƒç‚¹å‘¢ï¼Œæµé‡æ˜¯å“ªé‡Œæ¥ï¼Ÿè¿˜ä¸å¦‚å¯„ç”Ÿåœ¨ä¸€ä¸ªå¤§å¹³å°ä¸Šé¢ã€‚ </p><p>ä»Šæ—¥äº’è”ç½‘çš„ä¸­å¿ƒåŒ–ä¹Ÿä¸å®Œå…¨æ˜¯å¸‚åœºç«äº‰çš„ç»“æœï¼Œå¤§å…¬å¸ç”¨æµé‡æ§åˆ¶ä½æ‰€æœ‰æ–°çš„å¯èƒ½ï¼Œä¸€æ—¦æœ‰æ–°ç‰©ç§å‡ºç°ï¼Œå¼„ä¸æ­»ä½ å°±æŠ„è¢­ä¸ªåŒç±»äº§å“å‹åˆ¶ä½ ï¼Œå¦‚æœè¿˜å¼„ä¸æ­»ä½ é‚£å°±æ”¶è´­ä½ ï¼Œåæ­£æ€»æœ‰ä¸€ç§æµæ°“æ‰‹æ®µå¯ä»¥æå®šä½ ã€‚</p><p>äº’è”ç½‘å·²ç»å½»åº•ä¸­å¿ƒåŒ–äº†ï¼Œæˆ‘ä»¬ä»¥ä¸ºäº’è”ç½‘ä¼šç»™æ¯ä¸ªäººå¸¦æ¥è‡ªç”±ï¼Œç°åœ¨æ‰å‘ç°ï¼Œäº’è”ç½‘å…¶å®åœ¨å‰¥å¤ºæˆ‘ä»¬çš„æ€è€ƒã€‚20å¹´æ¥äº’è”ç½‘çš„ä¸­å¿ƒåŒ–å°±æ˜¯å„æ–­åŒ–ï¼Œæœ€åæˆ‘ä»¬çš„å‘½è¿å°†è¢«æ§åˆ¶åœ¨å‡ ä¸ªäººæ‰‹é‡Œã€‚</p><hr><p>æˆ‘ä»ä¸­å¾—åˆ°çš„ç»“è®ºå°±æ˜¯ï¼Œå›½å†…äº’è”ç½‘çš„æ ¼å±€éƒ½ç”±å¤§å‚æ§åˆ¶ä½äº†ï¼Œå°å…¬å¸å¾ˆéš¾æœ‰æ’¼åŠ¨æ•´ä¸ªå›½å†…äº’è”ç½‘çš„èƒ½åŠ›ï¼Œé‚£ä¹ˆè·Ÿç€å¤§å‚çš„æ­¥ä¼èµ°æ‰æ˜¯æ­£é“å—ï¼Ÿæ•æˆ‘ä¸èƒ½å›ç­”ã€‚</p><h2 id="TOP"><a href="#TOP" class="headerlink" title="TOP"></a>TOP</h2><p>ç»™å¤§å®¶ä¸Šä¸¤å¼ å›¾åŠé“¾æ¥ï¼Œä¸­å›½VSä¸–ç•Œã€‚åœ¨2019å¹´ä¸­å›½äº’è”ç½‘å‰10å¼ºé‡Œåªæœ‰2ä¸ªå…¬å¸è¿›å…¥äº†ä¸–ç•Œå‰10å¼ºï¼Œé˜¿é‡Œã€è…¾è®¯ã€‚</p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/King/2019ITTOP.png"  alt="ä¸­å›½"></p><p><a href="https://baike.baidu.com/item/%E4%B8%AD%E5%9B%BD%E4%BA%92%E8%81%94%E7%BD%91%E4%BC%81%E4%B8%9A100%E5%BC%BA/9835904?fr=aladdin" target="_blank" rel="noopener">2019å¹´ä¸­å›½äº’è”ç½‘ä¼ä¸š100å¼º</a></p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/King/2019ITTOP.jpg"  alt="ä¸–ç•Œ"></p><p><a href="http://www.nbyoho.com/news/1660218504261509241.html" target="_blank" rel="noopener">äº’è”ç½‘iTä¸šå…¨å¹´æ•°æ®å…¬å¸ƒ 2019å¹´å…¨çƒåå¤§ITä¼ä¸šæ’åå‡ºç‚‰äº†</a></p><hr><h2 id="è´¡çŒ®"><a href="#è´¡çŒ®" class="headerlink" title="è´¡çŒ®"></a>è´¡çŒ®</h2><p>ä»ç„¶ç»™å¤§å®¶ä¸Šä¸¤æ¡é“¾æ¥ï¼Œä¸­å›½VSä¸–ç•Œã€‚å›½å¤–çš„å¼€æºå…¬å¸å¸–å­ä¸å¥½æ‰¾ï¼Œåªèƒ½æ‰¾åˆ°2017å¹´çš„å¼€æºå…¬å¸åˆ—è¡¨ã€‚è¿™äº›å¸–å­è¯´æ˜ï¼Œé˜¿é‡Œç»™å›½å†…åšå‡ºçš„è´¡çŒ®å¾ˆå¤§ï¼Œä¸–ç•Œä¼ä¸šç»™ä¸–ç•Œçš„äº’è”ç½‘ä¼ä¸šè´¡çŒ®æ›´å¤§ï¼Œè€Œä¸­å›½å¤„åœ¨äº’è”ç½‘çš„æ´ªæµä¸­ï¼Œæ˜¾å¾—å¾®ä¸è¶³é“ã€‚</p><p><a href="https://www.infoq.cn/article/G4O6JUhJF*Tsv9eWM0L6" target="_blank" rel="noopener">2019å¹´ä¸­å›½äº’è”ç½‘å…¬å¸å¼€æºé¡¹ç›®è°ƒç ”æŠ¥å‘Š</a></p><p><a href="https://juejin.im/entry/59d16eb551882516662bffba" target="_blank" rel="noopener">2017å¹´å…¨çƒ 35 å¤§å¼€æºå…¬å¸éƒ½åœ¨è¿™é‡Œï¼</a></p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>é€šè¿‡äº’è”ç½‘ä¼ä¸šæ’åå’Œè´¡çŒ®æ¯”è¾ƒï¼Œä¸€æ–¹é¢æˆ‘æ„Ÿå¹ä¸­å›½å’Œä¸–ç•Œçš„äº’è”ç½‘æŠ€æœ¯çš„å·®è·ä¹‹å¤§ï¼Œå¦ä¸€æ–¹é¢æˆ‘ä¹Ÿçœ‹åˆ°äº†è¿‘å‡ å¹´ä¸­å›½åœ¨å°½å…¨åŠ›è¿½èµ¶ä¸–ç•Œäº’è”ç½‘çš„è„šæ­¥ã€‚</p><p>å›½å†…çš„å¼€æºæŠ€æœ¯è¶Šæ¥è¶Šå¤šï¼Œå›½å†…å¾ˆå¤šä¸­å°å‹å…¬å¸æ¸æ¸æ¨¡ä»¿äº†é˜¿é‡Œç³»ã€è…¾è®¯ç³»ã€ç™¾åº¦ç³»çš„æ¶æ„ä½“ç³»ã€‚åœ¨æˆ‘çœ¼é‡Œï¼Œé˜¿é‡Œå¯è°“æ˜¯ä¸­å›½çš„è°·æ­Œï¼ŒçœŸæ­£çš„ç§‘æŠ€å…¬å¸ï¼Œè®¸å¤šJavaç±»çš„æ¡†æ¶ä¸å¼€åˆ™ä»¥ï¼Œä¸€å¼€æƒŠäººã€‚é˜¿é‡Œäº‘çš„æ ‡ç­¾æ˜¯ä»€ä¹ˆï¼Ÿä¸ºäº†æ— æ³•è®¡ç®—çš„ä»·å€¼ã€‚æ­£æ˜¯é˜¿é‡Œçš„æ— ç§å¥‰çŒ®ï¼Œå›½å†…çš„è®¸å¤šå…¬å¸çº·çº·äº«ç”¨ç€ä¸­å›½äººè‡ªå·±å¼€æºçš„ä¸œè¥¿ã€‚</p><p>è€Œè°·æ­Œçš„å¼€æºé¡¹ç›®æ›´æ˜¯å¤šå¦‚ç‰›æ¯›ï¼Œè¢«å›½å¤–ç¨‹åºå‘˜ç§°ä¸ºå¼€æºå·¨çŒ®ã€‚2014å¹´Googleæ¨å‡ºKubernetesï¼Œè¢«èª‰ä¸ºå®¹å™¨åŒ–å‘å±•çš„é‡Œç¨‹ç¢‘ï¼Œä¸–ç•Œæ‰€æœ‰çš„é¡¶çº§æŠ€æœ¯äººå‘˜ä¸ºå®ƒæ·»ç –åŠ ç“¦ï¼Œä¸€ç›´è‡³ä»Šï¼ŒKubernertesçš„ç”Ÿæ€ç³»ç»Ÿç»§ç»­å¢é•¿ç€ã€‚</p><p>æˆ‘å¸Œæœ›çœ‹åˆ°è¿™çš„ä½ ä»¬èƒ½å¯¹æ•´ä¸ªäº’è”ç½‘çš„æ ¼å±€æœ‰ä¸€ä¸ªæ–°çš„è®¤è¯†ï¼Œä¸è¦æ€»è§‰å¾—è‡ªå·±å­¦çš„çŸ¥è¯†å·²ç»è¶³å¤Ÿäº†ï¼Œä¸è¦å¤œéƒè‡ªå¤§è®¤ä¸ºè‡ªå·±å­¦çš„çŸ¥è¯†ç‰¹åˆ«ç‰›ï¼Œå…¶å®æœ‰å¾ˆå¤šéƒ½æ˜¯åˆ«äººç©å‰©ä¸‹çš„ä¸œè¥¿ã€‚æ²¡äº‹å¤šçœ‹çœ‹å›½å¤–çš„æŠ€æœ¯è®ºå›ã€åšå®¢ï¼Œä¸è¦å±€é™äºå›½å†…çš„æŠ€æœ¯ã€‚</p><h1 id="æå‡æŠ€æœ¯"><a href="#æå‡æŠ€æœ¯" class="headerlink" title="æå‡æŠ€æœ¯"></a>æå‡æŠ€æœ¯</h1><p>å¾ˆå¤šäººä¼šé—®æˆ‘ï¼Œä½ å­¦çš„çŸ¥è¯†å¾ˆå¤šï¼Œå¥½åƒä»€ä¹ˆéƒ½æ‡‚ç‚¹ï¼Œæˆ‘åº”è¯¥æ€ä¹ˆå’Œä½ ä¸€æ ·ï¼Ÿå…¶å®æ¯ä¸ªäººä¸ä¸€å®šè¦å­¦è°ï¼Œæ‰¾åˆ°é€‚åˆè‡ªå·±çš„æ‰æ˜¯æœ€å¥½çš„ã€‚</p><p>æˆ‘å¾ˆæƒ­æ„§ï¼š</p><ul><li>æˆ‘åœ¨2018å¹´11æœˆä¹‹å‰æ²¡æœ‰ä½¿ç”¨è¿‡linuxæ“ä½œç³»ç»Ÿ</li><li>æˆ‘åœ¨2019å¹´9æœˆæ‰å¼€å§‹æ¥è§¦è¿™ä¸ª5å¹´å‰å°±å·²ç»ç«èµ·æ¥çš„kubernetesï¼Œè‡³ä»Šä»ä¸èƒ½è¯´ç²¾é€šå®ƒã€‚</li><li>æˆ‘åœ¨2019å¹´12æœˆä¹‹å‰æ²¡æœ‰ç”¨è¿‡äº‘å¹³å°ï¼Œä¸çŸ¥é“äº‘ä¸ºä½•ç‰©</li><li>æˆ‘åœ¨2020å¹´4æœˆ22æ—¥ä¹‹å‰è¿˜æ²¡æœ‰å¯¹è‡ªå·±çš„å­¦ä¹ çŸ¥è¯†è¿›è¡Œè¿‡å…¨é¢çš„æ€»ç»“</li></ul><p>æˆ‘æŠ€æœ¯æˆé•¿åœ¨æœ€å¿«çš„æ—¶é—´æ®µå°±æ˜¯åœ¨2019å¹´10-12æœˆ3ä¸ªæœˆå†…ï¼Œå…ˆåº”ç”¨åå­¦ä¹ ï¼Œæ˜¯æˆ‘è®¤ä¸ºå­¦ä¹ æ•ˆç‡è‡³å¿«çš„æ³•å®ã€‚å› ä¸ºæˆ‘ä»¬çš„è„šæ­¥å·²ç»å¾ˆæ…¢äº†ï¼Œæ²¡æœ‰æ—¶é—´å’Œç»å†å†ä»å¤´å­¦èµ·äº†ï¼Œä»é¡¹ç›®ä¸­ä½“ä¼šã€å­¦ä¹ ã€ç†è§£æ‰èƒ½æœ€å¿«åœ°äº†è§£æŸä¸€æŠ€æœ¯æ˜¯å¹²å˜›ç”¨çš„ï¼Œç„¶åé€šè¿‡æ—¶é—´ã€ç»éªŒçš„ç´¯ç§¯ï¼Œæ…¢æ…¢æ·±å…¥äº†è§£è¿™äº›æŠ€æœ¯åº•å±‚çš„åŸç†ï¼Œåƒæ‡‚åƒé€ã€‚</p><p>çœ‹åˆ°è¿™ï¼Œæˆ‘ç›¸ä¿¡ä½ ä»¬èƒ½å¤Ÿæ˜ç™½ä¸€ä¸ªé“ç†ï¼ŒæŠ€æœ¯æ˜¯æ°¸è¿œå­¦ä¸å®Œçš„ï¼Œä½†æ˜¯ä½ å¾—å»ä¸æ–­æ€»ç»“è‡ªå·±çš„çŸ¥è¯†æŠ€æœ¯ï¼Œä¸æ–­åæ€ï¼Œæ—¶ä¸æ—¶æ´å¯Ÿæ ¼å±€ï¼Œè‡³å°‘å¾—çŸ¥é“è‡ªå·±æ˜¯ä»€ä¹ˆæ°´å¹³ï¼Œå¦‚æœæ°´å¹³ä½äº†å°±åº”è¯¥èµ¶ç´§è¡¥ä¹ ï¼Œè¿½ä¸Šæ½®æµã€‚æˆ‘ä¹Ÿæ˜¯ä¸æ–­çš„é€¼è‡ªå·±å­¦ä¹ ï¼Œæˆ‘ä¹Ÿä¸æƒ³æ‰é˜Ÿï¼Œæˆ‘ä¹Ÿæƒ³æˆä¸ºè¿ç»´è¡Œä¸šçš„é¢†å†›äººç‰©ï¼Œæ‰€ä»¥åªèƒ½ä¸æ–­çš„å­¦ä¹ ï¼</p><p>ç»™å¤§å®¶æ¨èä¸€ä¸ªæ–¹æ³•ï¼šä¸ç®¡å“ªè¡Œå“ªä¸šï¼Œå¦‚æœä½ è§‰å¾—ä½ æå‡ä¸äº†æŠ€æœ¯äº†æˆ–è€…æ²¡æœ‰åŠ¨åŠ›å­¦ä¸‹å»ï¼Œé‚£ä¹ˆè¯·çœ‹ä¸‹ä½ æ‰€åœ¨å²—ä½çš„æ‹›è˜ç½‘ç«™ï¼Œçœ‹çœ‹ç°åœ¨å¸‚åœºæ‹›è˜çš„æŠ€æœ¯ä½ æ˜¯å¦éƒ½ä¼šï¼Ÿè¡Œä¸šçš„å¹³å‡æ°´å¹³åœ¨å“ªï¼Ÿä½ çš„å·¥èµ„æ˜¯å¦é«˜ä¸å¸‚åœºçš„å¹³å‡æ°´å¹³ï¼Ÿå¦‚æœäº›æ¡ä»¶ä½ éƒ½ä¸èƒ½æ»¡è¶³ï¼Œä½ å°±æœ‰äº†å­¦ä¹ çš„åŠ¨åŠ›åŠæ–¹å‘ï¼Œæœ›å…±å‹‰ä¹‹ã€‚</p><h1 id="ä¸å¿˜åˆå¿ƒ"><a href="#ä¸å¿˜åˆå¿ƒ" class="headerlink" title="ä¸å¿˜åˆå¿ƒ"></a>ä¸å¿˜åˆå¿ƒ</h1><p>å¦‚æœä½ çœ‹è¿‡äººæ°‘çš„åä¹‰ï¼Œä½ åº”è¯¥ä¼šè®°å¾—é«˜è‚²è‰¯ä¹¦è®°æ›¾æ…·æ…¨æ¿€æ˜‚åœ°è¯´è¿‡è¿™æ ·ä¸€å¥è¯ï¼šä¸­å›½çš„æ”¹é©å¼€æ”¾å¯ä»¥è¯´æ˜¯æµ©æµ©è¡è¡ï¼Œæ¯ä¸ªäººéƒ½èº«å¤„æ´ªæµä¹‹ä¸­ï¼ŒæœŸé—´ï¼Œæœ‰è®¸å¤šäººå‡­ç€è‡ªèº«çš„åŠªåŠ›æˆ–è€…è¯´å¹¸è¿ç«™åœ¨äº†æ½®å¤´ä¹‹ä¸Šï¼Œè¿™æ½®å¤´ä¹‹ä¸Šæ˜¯é£å…‰æ— é™ï¼Œè¯±æƒ‘æ— é™ï¼Œä¹Ÿé£é™©æ— é™ï¼Œå°±çœ‹ä½ å¦‚ä½•æŠŠæ¡äº†ã€‚çœ‹æœªæ¥è¿œä¸å¦‚çœ‹è¿‡å»ï¼Œè¦æ¥å¾—æ¸…æ¥šï¼Œæ¿€æ˜‚å’Œå›°æƒ‘ï¼Œäº¤ç»‡åœ¨æ¯ä¸ªäººéƒ½å¿ƒå¤´ï¼Œæ‰€ä»¥è¯´è¦ç•™ä¸€ä»½æ•¬ç•åœ¨å¿ƒä¸­ï¼Œçœ‹åˆ«çš„ä¸œè¥¿å¯ä»¥æ¨¡ç³Šï¼Œä½†çœ‹åº•çº¿ä¸€å®šè¦çœ‹å¾—æ¸…æ™°ã€‚</p><p>è™½ç„¶é«˜è‚²è‰¯æ˜¯åæ´¾ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºä»–è¯´çš„è¯æŒºæœ‰æ ¼å±€ã€‚ï¼ˆä¸æ„§æ˜¯å¤§æ•™æˆï¼‰å³ä½¿ä»–æœ€åè¢«é€®æ•åˆ¤åˆ‘ï¼Œæˆ‘ä»è®¤ä¸ºä»–çš„å®ˆä½äº†è‡ªå·±çš„åº•çº¿ï¼Œè€Œä¸”ä»–ä¹Ÿæ²¡æœ‰ä¸»è§‚ä¸Šè´ªæ±¡è…è´¥ï¼Œåªæ˜¯è¢«ç¯å¢ƒçš„å½±å“å¤ªä¸¥é‡ï¼Œä¸€å¤±è¶³æˆåƒå¤æ¨ï¼Œæ‰€ä»¥ä¸å¿˜åˆå¿ƒçœŸä¸æ˜¯ä¸€ä»¶ç®€å•çš„äº‹ã€‚</p><p>æœ€è¿‘åˆ·Bç«™çœ‹äº†è®¸å¤šéƒ‘å¼ºæ•™æˆçš„æ¼”è®²ï¼Œæµ™æ±Ÿå¤§å­¦æ•™æˆè®²è¯ï¼Œå¥å¥æŒ¯è‹å‘è©ã€‚æˆ‘æ„Ÿè§‰æˆ‘çš„ä»·å€¼è§‚æ­£åœ¨è¢«ä»–çš„æ¼”è®²æ‰€å¼•å¯¼ï¼Œå¼•ç”¨ä»–çš„ä¸¤æ®µè¯ã€‚</p><hr><p>æˆ‘è¯´æˆ‘éƒ‘å¼ºåŒå¿—è‹¦å£å©†å¿ƒçš„æŠŠé«˜åˆ†å­çŸ¥è¯†æ•™äº†ä½ ä»¬,åé¢è¿‡ä¸¤å¤©ä½ ä»¬åˆ°ç¾å›½å»,åœ¨æœé‚¦å…¬å¸å°±èŒ,ç„¶åé‚£ä¸ªå¯¼å¼¹çš„é‚£ä¸ªé˜²æ¼åœˆ,éƒ½æ˜¯é«˜åˆ†å­çš„åœˆ,å…¨ä½ ä»¬åšçš„,ç„¶åè¿‡ä¸¤å¤©â€œå˜Ÿâ€é£å›æ¥æŠŠæˆ‘ç‚¸æ­»äº†ã€‚</p><p>æ•™è‚²åº”è¯¥è®©ä¸­å›½æ‡‚å¾—è‡ªå°Šã€‚ä½†æ˜¯ç°åœ¨æˆ‘ä»¬çœ‹åˆ°å¤–å›½äººå°±ä½å¤´ï¼Œå¥³ç”Ÿçœ‹åˆ°å¤–å›½çš„ç”·äººéƒ½æƒ³è®¨å¥½ã€‚åŒå¿—ä»¬ï¼Œåœ¨å¤–å›½äººé¢å‰æˆ‘ä»¬å¤šä¹ˆåœ°æ²¡æœ‰å°Šä¸¥ã€‚åœ¨ç•™å­¦çš„æ—¥æœ¬äº¬éƒ½å¤§å­¦çš„äººå½“ä¸­ï¼Œæˆ‘æ˜¯å”¯ä¸€å›æ¥çš„ï¼Œä½†æ—¥æœ¬äººåè€Œæ•¬é‡æˆ‘ï¼Œå› ä¸ºæˆ‘æ´»å¾—æœ‰çµé­‚ï¼Œæ´»å¾—æœ‰éª¨æ°”ã€‚</p><hr><p>éƒ‘å¼ºæ•™æˆå‘Šè¯‰æˆ‘åšäººä¸èƒ½å¿˜æœ¬ï¼Œä¸èƒ½å¿˜è®°å…»è‚²è‡ªå·±çš„çˆ¶æ¯å’Œå›½å®¶ï¼Œè€Œæˆ‘çš„åˆå¿ƒå°±æ˜¯å®ˆä½è¿™ä¸ªåº•çº¿ï¼Œå°½è‡ªå·±çš„åŠ›é‡åšå¯¹å›½å®¶æœ‰è´¡çŒ®çš„äº‹æƒ…ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æˆ‘æ˜¯ä¸€ä¸ªå–œæ¬¢å­¦å†å²çš„äººï¼Œä»¥å¤ä¸ºé‰´ï¼Œå¯çŸ¥å…´æ›¿ï¼Œä¸­å›½å†ä»£çš„å‘å±•éƒ½æ˜¯ç”±å…´åˆ°è¡°ï¼Œç”±è¡°åˆ°å…´ã€‚è€Œä¸­å›½ä»1840å¹´è‡³ä»Šåˆ›é€ äº†ä¸€ç³»åˆ—å¥‡è¿¹ï¼š</p><ul><li>ç»¼åˆå›½åŠ›ä»è¡°è´¥åˆ°æ—¥ç›Šå¼ºç››</li><li>äººæ°‘ç”Ÿæ´»æ°´å¹³ä»è´«å›°åˆ°åŸºæœ¬å…¨é¢å°åº·</li><li>å›½é™…åœ°ä½ä»ä»»äººå®°å‰²åˆ°å±¹ç«‹ä¸–ç•Œä¸œæ–¹</li></ul><p>ä»1840å¹´çš„è™šå¼±è½åï¼Œåˆ°1949å¹´çš„å†å²ä½ç‚¹åå¥‹èµ·ï¼Œå†åˆ°ä»Šå¤©çš„å¼ºå›½æ–°è²Œï¼Œæ—¶å…‰èè‹’ï¼Œæ–—è½¬æ˜Ÿç§»ï¼ŒçœŸæ­£æ˜¯æ¢äº†äººé—´ï¼</p><p>è€Œæˆ‘ä»¬åº”è¯¥æ›´å±…å®‰æ€å±ï¼Œåœ¨äº’è”ç½‘æ—¶ä»£ä¸­ï¼Œä¸­å›½çš„æŠ€æœ¯æ­£å¤„åœ¨è“¬å‹ƒå¢é•¿çš„çŠ¶æ€ï¼Œä½†æ˜¯ä¾æ—§ä¸å¯å¦è®¤æˆ‘ä»¬ä¸å›½å¤–çš„å·®è·ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´åº”è¯¥äº‰åšäº’è”ç½‘çš„åæµªï¼Œæ‹¿å‡ºèˆæˆ‘å…¶è°çš„ç²¾ç¥ï¼Œå‹‡å¾€ç›´å‰åœ°å†²åˆ°æœ€å‰æ²¿ï¼Œæˆä¸ºä¸€ä¸ªå›½å®¶æœ€å¥½çœ‹çš„é£æ™¯ï¼</p><p>çœ‹å®Œæˆ‘çš„æ–‡ç« ï¼Œæˆ‘å¸Œæœ›ä½ å…³é—­é¡µé¢çš„æ—¶å€™èƒ½å¤Ÿå˜å¾—ï¼š</p><ul><li>å–„è‰¯ </li><li>å‹‡æ•¢ </li><li>æ— ç§ </li><li>æ— æ‰€ç•æƒ§</li><li>æ˜¯å¿ƒé‡Œæœ‰ç« çœ¼é‡Œæœ‰å…‰</li><li>è¡¨è¾¾è‡ªæˆ‘ æ‹¥æŠ±ä¸–ç•Œ</li></ul><p>å…±å‹‰ä¹‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¡¶çº§ç†è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¶çº§ç†è§£ </tag>
            
            <tag> äº’è”ç½‘ </tag>
            
            <tag> åæµª </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è·Ÿæˆ‘å­¦Devopsä¹‹å·¥å…·ç¯‡ï¼ˆAnsbileï¼‰</title>
      <link href="/2020/05/17/devops/devops-ansible/"/>
      <url>/2020/05/17/devops/devops-ansible/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><p>ä»è‡ªåŠ¨åŒ–è¿ç»´å…¥é—¨å¼€å§‹ï¼Œç¬¬ä¸€ä¸ªå­¦ä¹ çš„è‡ªåŠ¨åŒ–å·¥å…·å°±æ˜¯ansibleã€‚</p><h1 id="ç™¾åº¦è§£é‡Š"><a href="#ç™¾åº¦è§£é‡Š" class="headerlink" title="ç™¾åº¦è§£é‡Š"></a>ç™¾åº¦è§£é‡Š</h1><p>ansibleæ˜¯æ–°å‡ºç°çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼ŒåŸºäºPythonå¼€å‘ï¼Œé›†åˆäº†ä¼—å¤šè¿ç»´å·¥å…·ï¼ˆpuppetã€cfengineã€chefã€funcã€fabricï¼‰çš„ä¼˜ç‚¹ï¼Œå®ç°äº†æ‰¹é‡ç³»ç»Ÿé…ç½®ã€æ‰¹é‡ç¨‹åºéƒ¨ç½²ã€æ‰¹é‡è¿è¡Œå‘½ä»¤ç­‰åŠŸèƒ½ã€‚</p><p>ansibleæ˜¯åŸºäºæ¨¡å—å·¥ä½œçš„ï¼Œæœ¬èº«æ²¡æœ‰æ‰¹é‡éƒ¨ç½²çš„èƒ½åŠ›ã€‚çœŸæ­£å…·æœ‰æ‰¹é‡éƒ¨ç½²çš„æ˜¯ansibleæ‰€è¿è¡Œçš„æ¨¡å—ï¼Œansibleåªæ˜¯æä¾›ä¸€ç§æ¡†æ¶ã€‚ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li>è¿æ¥æ’ä»¶connection pluginsï¼šè´Ÿè´£å’Œè¢«ç›‘æ§ç«¯å®ç°é€šä¿¡ï¼›</li><li>host inventoryï¼šæŒ‡å®šæ“ä½œçš„ä¸»æœºï¼Œæ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶é‡Œé¢å®šä¹‰ç›‘æ§çš„ä¸»æœºï¼›</li><li>å„ç§æ¨¡å—æ ¸å¿ƒæ¨¡å—ã€commandæ¨¡å—ã€è‡ªå®šä¹‰æ¨¡å—ï¼›</li><li>å€ŸåŠ©äºæ’ä»¶å®Œæˆè®°å½•æ—¥å¿—é‚®ä»¶ç­‰åŠŸèƒ½ï¼›</li><li>playbookï¼šå‰§æœ¬æ‰§è¡Œå¤šä¸ªä»»åŠ¡æ—¶ï¼Œéå¿…éœ€å¯ä»¥è®©èŠ‚ç‚¹ä¸€æ¬¡æ€§è¿è¡Œå¤šä¸ªä»»åŠ¡ã€‚</li></ul><h1 id="ä¸ªäººç†è§£"><a href="#ä¸ªäººç†è§£" class="headerlink" title="ä¸ªäººç†è§£"></a>ä¸ªäººç†è§£</h1><p>ç”¨é€šä¿—çš„è¯æ¥è§£é‡Šï¼Œansbileå¯ä»¥åˆ†ç»„ï¼Œæ¯ä¸ªç»„é‡Œæ·»åŠ ç›®æ ‡æœºå™¨ipï¼Œé€šè¿‡å¯†é’¥æˆ–è€…å¯†ç è¿æ¥æˆåŠŸç»„é‡Œçš„æœºå™¨åï¼Œä½ å°±å¯ä»¥ç”¨ansbileå‘½ä»¤æ“ä½œæ¯ä¸ªç»„çš„æœºå™¨äº†ã€‚å¯¹äºå¤§è§„æ¨¡çš„æœºå™¨ç¾¤æ¥è¯´ï¼Œansbileæ˜¯å¿…ä¸å¯å°‘çš„è¿ç»´å·¥å…·ã€‚</p><p>ansbileçš„ç‰¹ç‚¹ï¼š</p><ul><li>éƒ¨ç½²ç®€å•ï¼Œåªéœ€åœ¨ä¸»æ§ç«¯éƒ¨ç½²Ansibleç¯å¢ƒï¼Œè¢«æ§ç«¯æ— éœ€åšä»»ä½•æ“ä½œï¼›</li><li>é»˜è®¤ä½¿ç”¨SSHåè®®å¯¹è®¾å¤‡è¿›è¡Œç®¡ç†ï¼›</li><li>æœ‰å¤§é‡å¸¸è§„è¿ç»´æ“ä½œæ¨¡å—ï¼Œå¯å®ç°æ—¥å¸¸ç»å¤§éƒ¨åˆ†æ“ä½œï¼›</li><li>é…ç½®ç®€å•ã€åŠŸèƒ½å¼ºå¤§ã€æ‰©å±•æ€§å¼ºï¼›</li><li>æ”¯æŒAPIåŠè‡ªå®šä¹‰æ¨¡å—ï¼Œå¯é€šè¿‡Pythonè½»æ¾æ‰©å±•ï¼›</li><li>é€šè¿‡Playbooksæ¥å®šåˆ¶å¼ºå¤§çš„é…ç½®ã€çŠ¶æ€ç®¡ç†ï¼›</li><li>è½»é‡çº§ï¼Œæ— éœ€åœ¨å®¢æˆ·ç«¯å®‰è£…agentï¼Œæ›´æ–°æ—¶ï¼Œåªéœ€åœ¨æ“ä½œæœºä¸Šè¿›è¡Œä¸€æ¬¡æ›´æ–°å³å¯ï¼›</li><li>æä¾›ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€æ“ä½œæ€§å¼ºçš„Webç®¡ç†ç•Œé¢å’ŒREST APIæ¥å£â€”â€”AWXå¹³å°ã€‚</li></ul><p>å½“ç„¶ä½ å¯èƒ½ä¸éœ€è¦ç”¨åˆ°ansbileæ‰€æœ‰åŠŸèƒ½ï¼Œä»¥ä¸‹æ˜¯æˆ‘è®¤ä¸ºå®æˆ˜ä¸­ansbileç”¨çš„æœ€çˆ½çš„å‡ ä¸ªç‚¹ï¼š</p><ul><li>é…ç½®ç®¡ç†ï¼šå°†é…ç½®æ–‡ä»¶æ‰¹é‡æ”¾åˆ°ä½ æŒ‡å®šç»„çš„æœºå™¨æŸä¸€ç›®å½•ä¸‹ï¼Œæˆ–è€…æŒ‡å®šè·¯å¾„åä¸€æ¬¡æ€§ä¿®æ”¹æŒ‡å®šç»„çš„æœºå™¨è¯¥è·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶</li><li>åº”ç”¨éƒ¨ç½²ï¼šå¦‚javaåº”ç”¨ç¼–è¯‘å¥½æˆjaråŒ…ï¼Œansbileç›´æ¥å°†jaråŒ…åˆ†å‘åˆ°æŒ‡å®šç»„çš„æœºå™¨æŸä¸€ç›®å½•ä¸‹ï¼Œæ‰§è¡Œå¯åŠ¨å‘½ä»¤</li><li>æ»šåŠ¨å‘å¸ƒï¼šæœ‰äººå¯èƒ½ä¼šé—®äº†ï¼Œansibleä¹Ÿèƒ½æ»šåŠ¨å‘å¸ƒï¼Ÿå…¶å®åªè¦äº†è§£æ»šåŠ¨å‘å¸ƒçš„åŸç†ï¼Œç”¨ansbileä¸€æ ·å¯ä»¥åšåˆ°ã€‚ä¾‹å¦‚åœ¨ç”Ÿäº§ç¯å¢ƒåˆ©ç”¨è´Ÿè½½å‡è¡¡åˆ†å‘æµé‡åˆ°åº•å±‚å­˜åœ¨å¤šä¸ªè¿è¡Œjavaåº”ç”¨çš„å®ä¾‹ä¸­ï¼Œé‚£ä¹ˆæ»šåŠ¨æ›´æ–°å°±æ˜¯å…ˆæ§åˆ¶ä¸€å°ç»„é‡Œçš„æœºå™¨ï¼Œæ€è¿›ç¨‹ï¼Œå¯åŠ¨æ–°çš„jaråŒ…ï¼Œç›‘æ§jaråŒ…å¯åŠ¨æˆåŠŸç­‰ï¼Œå¦‚æœè¿™å°ç»„é‡Œçš„æœºå™¨æˆåŠŸï¼Œåˆ™è®©åç»­ç»„é‡Œçš„æœºå™¨ç»§ç»­æ›´æ–°ï¼Œå¦åˆ™ç»ˆæ­¢ã€‚</li></ul><h1 id="å¼€å§‹ansibleä¹‹æ—…"><a href="#å¼€å§‹ansibleä¹‹æ—…" class="headerlink" title="å¼€å§‹ansibleä¹‹æ—…"></a>å¼€å§‹ansibleä¹‹æ—…</h1><h2 id="å®‰è£…ansible"><a href="#å®‰è£…ansible" class="headerlink" title="å®‰è£…ansible"></a>å®‰è£…ansible</h2><p>ä¸¤ç§å®‰è£…æ–¹å¼éƒ½è¡Œ</p><ul><li>pipå®‰è£…</li></ul><p>yum install python-pip</p><p>pip install ansible</p><ul><li>yumå®‰è£…</li></ul><p>yum install epel-release -y</p><p>yum install ansible â€“y</p><p>å®‰è£…å®Œæˆåæ‰§è¡Œansible â€“version</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ansible --version</span><br><span class="line">ansible 2.9.7</span><br><span class="line">  config file &#x3D; &#x2F;etc&#x2F;ansible&#x2F;ansible.cfg</span><br><span class="line">  configured module search path &#x3D; [u&#39;&#x2F;root&#x2F;.ansible&#x2F;plugins&#x2F;modules&#39;, u&#39;&#x2F;usr&#x2F;share&#x2F;ansible&#x2F;plugins&#x2F;modules&#39;]</span><br><span class="line">  ansible python module location &#x3D; &#x2F;usr&#x2F;lib&#x2F;python2.7&#x2F;site-packages&#x2F;ansible</span><br><span class="line">  executable location &#x3D; &#x2F;usr&#x2F;bin&#x2F;ansible</span><br><span class="line">  python version &#x3D; 2.7.5 (default, Oct 30 2018, 23:45:53) [GCC 4.8.5 20150623 (Red Hat 4.8.5-36)]</span><br></pre></td></tr></table></figure><h2 id="é…ç½®ansible"><a href="#é…ç½®ansible" class="headerlink" title="é…ç½®ansible"></a>é…ç½®ansible</h2><h3 id="é»˜è®¤é…ç½®æ–‡ä»¶"><a href="#é»˜è®¤é…ç½®æ–‡ä»¶" class="headerlink" title="é»˜è®¤é…ç½®æ–‡ä»¶"></a>é»˜è®¤é…ç½®æ–‡ä»¶</h3><p>é…ç½®æ–‡ä»¶è·¯å¾„åœ¨/etc/ansible</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ansible]# pwd</span><br><span class="line">&#x2F;etc&#x2F;ansible</span><br><span class="line">[root@localhost ansible]# ll</span><br><span class="line">total 24</span><br><span class="line">-rw-r--r--. 1 root root 19985 Apr 19 05:24 ansible.cfg</span><br><span class="line">-rw-r--r--. 1 root root  1016 Apr 19 05:24 hosts</span><br><span class="line">drwxr-xr-x. 2 root root     6 Apr 19 05:24 roles</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ansible.cfg<br>å°†ä»¥ä¸‹å‡ ä¸ªå‚æ•°çš„æ³¨é‡Šå»æ‰å¹¶ä¿®æ”¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">host_key_checking&#x3D; False   </span><br><span class="line">timeout &#x3D; 30  å¢åŠ sshçš„è¶…æ—¶æ—¶é—´</span><br><span class="line">log_path &#x3D; &#x2F;var&#x2F;log&#x2F;ansible.log å­˜æ—¥å¿—</span><br></pre></td></tr></table></figure><h3 id="ä¸»æœºæ¸…å•"><a href="#ä¸»æœºæ¸…å•" class="headerlink" title="ä¸»æœºæ¸…å•"></a>ä¸»æœºæ¸…å•</h3><p>ansibleæœ‰2ç§è¿æ¥ä¸»æœºæ¸…å•çš„æ–¹å¼</p><h4 id="åŸºäºå¯†ç è¿æ¥"><a href="#åŸºäºå¯†ç è¿æ¥" class="headerlink" title="åŸºäºå¯†ç è¿æ¥"></a>åŸºäºå¯†ç è¿æ¥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ansible]# vim &#x2F;etc&#x2F;ansible&#x2F;hosts</span><br><span class="line">#æ·»åŠ ä¸¤ä¸ªç»„devã€test</span><br><span class="line">[dev]</span><br><span class="line">172.31.22.31  ansible_ssh_port&#x3D;22 ansible_ssh_user&#x3D;root ansible_ssh_pass&#x3D;&quot;123456&quot;</span><br><span class="line">172.31.22.33  ansible_ssh_port&#x3D;22 ansible_ssh_user&#x3D;root ansible_ssh_pass&#x3D;&quot;123456&quot;</span><br><span class="line">172.31.22.35  ansible_ssh_port&#x3D;22 ansible_ssh_user&#x3D;root ansible_ssh_pass&#x3D;&quot;123456&quot;</span><br><span class="line"></span><br><span class="line">[test]</span><br><span class="line">172.31.24.31  ansible_ssh_port&#x3D;22 ansible_ssh_user&#x3D;root ansible_ssh_pass&#x3D;&quot;123456&quot;</span><br><span class="line">172.31.24.33  ansible_ssh_port&#x3D;22 ansible_ssh_user&#x3D;root ansible_ssh_pass&#x3D;&quot;123456&quot;</span><br><span class="line">172.31.24.35  ansible_ssh_port&#x3D;22 ansible_ssh_user&#x3D;root ansible_ssh_pass&#x3D;&quot;123456&quot;</span><br><span class="line"></span><br><span class="line">ä¿®æ”¹å®Œåpingä¸‹è¯¥ç»„ä¸»æœºæ˜¯å¦éƒ½èƒ½è¿ä¸Š</span><br><span class="line"></span><br><span class="line">[root@localhost ansible]# ansible dev -m ping</span><br><span class="line">172.31.22.33 | SUCCESS &#x3D;&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;python&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">172.31.22.31 | SUCCESS &#x3D;&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;python&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">172.31.22.35 | SUCCESS &#x3D;&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;python&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŸºäºç§˜é’¥è¿æ¥"><a href="#åŸºäºç§˜é’¥è¿æ¥" class="headerlink" title="åŸºäºç§˜é’¥è¿æ¥"></a>åŸºäºç§˜é’¥è¿æ¥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ansible]# ssh-keygen</span><br><span class="line">[root@localhost ansible]# for i in &#123;1,3,5&#125;; do ssh-copy-id -i 172.31.22.3$i ; done</span><br><span class="line">[root@localhost ansible]# for i in &#123;1,3,5&#125;; do ssh-copy-id -i 172.31.24.3$i ; done</span><br><span class="line">[root@localhost ansible]# vim &#x2F;etc&#x2F;ansible&#x2F;hosts</span><br><span class="line">#æ·»åŠ ä¸¤ä¸ªç»„devã€test</span><br><span class="line">[dev]</span><br><span class="line">172.31.22.31  </span><br><span class="line">172.31.22.33  </span><br><span class="line">172.31.22.35  </span><br><span class="line"></span><br><span class="line">[test]</span><br><span class="line">172.31.24.31  </span><br><span class="line">172.31.24.33  </span><br><span class="line">172.31.24.35  </span><br><span class="line"></span><br><span class="line">ä¿®æ”¹å®Œåpingä¸‹è¯¥ç»„ä¸»æœºæ˜¯å¦éƒ½èƒ½è¿ä¸Š</span><br><span class="line"></span><br><span class="line">[root@localhost ansible]# ansible test -m ping</span><br><span class="line">172.31.24.33 | SUCCESS &#x3D;&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;python&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">172.31.24.31 | SUCCESS &#x3D;&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;python&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">172.31.24.35 | SUCCESS &#x3D;&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;python&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ansbileå¸¸ç”¨æ¨¡å—"><a href="#ansbileå¸¸ç”¨æ¨¡å—" class="headerlink" title="ansbileå¸¸ç”¨æ¨¡å—"></a>ansbileå¸¸ç”¨æ¨¡å—</h2><p>ä¸‹é¢ä¸¾å‡ ä¸ªæ—¥å¸¸ç”¨çš„æ¯”è¾ƒå¤šçš„æ¨¡å—ï¼Œæ²¡æœ‰åˆ—ä¸¾å®Œæ‰€æœ‰çš„ï¼Œä¸‹åˆ—æ¨¡å—æŒæ¡ä¹‹åæ—¥å¸¸å¯¹ä»˜æ‰¹é‡æ“ä½œè™šæ‹Ÿæœºçš„ä»»åŠ¡æ˜¯æ²¡é—®é¢˜çš„ã€‚</p><h3 id="pingæ¨¡å—"><a href="#pingæ¨¡å—" class="headerlink" title="pingæ¨¡å—"></a>pingæ¨¡å—</h3><p>æµ‹è¯•ä¸»æœºè¿é€šæ€§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible $1 -m ping</span><br><span class="line"></span><br><span class="line">$1ï¼šç»„å    egï¼šdev</span><br></pre></td></tr></table></figure><h3 id="commandæ¨¡å—"><a href="#commandæ¨¡å—" class="headerlink" title="commandæ¨¡å—"></a>commandæ¨¡å—</h3><p>è¿™ä¸ªæ¨¡å—å¯ä»¥ç›´æ¥åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å°†ç»“æœè¿”å›æœ¬ä¸»æœºã€‚</p><p>æ³¨æ„ï¼Œè¯¥å‘½ä»¤ä¸æ”¯æŒ| ç®¡é“å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ansible $1 -m command -a $2</span><br><span class="line"></span><br><span class="line">$1ï¼šç»„å    egï¼šdev</span><br><span class="line"></span><br><span class="line">$2ï¼šå‘½ä»¤    eg:&#39;ip add&#39;</span><br></pre></td></tr></table></figure><h3 id="shellæ¨¡å—"><a href="#shellæ¨¡å—" class="headerlink" title="shellæ¨¡å—"></a>shellæ¨¡å—</h3><p>shellæ¨¡å—å¯ä»¥åœ¨è¿œç¨‹ä¸»æœºä¸Šè°ƒç”¨shellè§£é‡Šå™¨è¿è¡Œå‘½ä»¤ï¼Œæ”¯æŒshellçš„å„ç§åŠŸèƒ½ï¼Œä¾‹å¦‚ç®¡é“ç­‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ansible $1 -m shell -a $2</span><br><span class="line"></span><br><span class="line">$1ï¼šç»„å    egï¼šdev</span><br><span class="line"></span><br><span class="line">$2ï¼šå‘½ä»¤    eg:&#39;ps -aux|grep java&#39;</span><br></pre></td></tr></table></figure><p>shellæ¨¡å— vs commandæ¨¡å—</p><p>è¿™ä¸¤ä¸ªæ¨¡å—åœ¨å¾ˆå¤šæƒ…å†µä¸‹éƒ½èƒ½å®ŒæˆåŒæ ·çš„å·¥ä½œï¼Œä»¥ä¸‹æ˜¯ä¸¤ä¸ªæ¨¡å—ä¹‹å‰çš„åŒºåˆ«ï¼š</p><ul><li><p>command æ¨¡å—å‘½ä»¤å°†ä¸ä¼šä½¿ç”¨ shell æ‰§è¡Œã€‚</p></li><li><p>å› æ­¤, åƒ $HOME è¿™æ ·çš„å˜é‡æ˜¯ä¸å¯ç”¨çš„ã€‚è¿˜æœ‰åƒ&lt;, &gt;, |, ;, &amp;éƒ½å°†ä¸å¯ç”¨ã€‚</p></li><li><p>shell æ¨¡å—é€šè¿‡shellç¨‹åºæ‰§è¡Œï¼Œ é»˜è®¤æ˜¯/bin/sh, &lt;, &gt;, |, ;, &amp; å¯ç”¨ï¼Œä½†è¿™æ ·æœ‰æ½œåœ¨çš„ shell æ³¨å…¥é£é™©ã€‚</p></li><li><p>command æ¨¡å—æ›´å®‰å…¨ï¼Œå› ä¸ºä»–ä¸å—ç”¨æˆ·ç¯å¢ƒçš„å½±å“ã€‚ ä¹Ÿå¾ˆå¤§çš„é¿å…äº†æ½œåœ¨çš„ shell æ³¨å…¥é£é™©ã€‚</p></li></ul><h3 id="copyæ¨¡å—"><a href="#copyæ¨¡å—" class="headerlink" title="copyæ¨¡å—"></a>copyæ¨¡å—</h3><p>è¿™ä¸ªæ¨¡å—ç”¨äºå°†æ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºï¼ŒåŒæ—¶æ”¯æŒç»™å®šå†…å®¹ç”Ÿæˆæ–‡ä»¶å’Œä¿®æ”¹æƒé™ç­‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ansible $1 -m copy -a $2</span><br><span class="line"></span><br><span class="line">$1ï¼šç»„å    egï¼šdev</span><br><span class="line"></span><br><span class="line">$2ï¼šå‘½ä»¤    egï¼š&#39;src&#x3D;&#x2F;data&#x2F;test.sh dest&#x3D;&#x2F;data mode&#x3D;777 &#39;</span><br><span class="line"></span><br><span class="line">å‚æ•°è¯¦è§£</span><br><span class="line"></span><br><span class="line">srcã€€ã€€ã€€ã€€  #è¢«å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºçš„æœ¬åœ°æ–‡ä»¶ã€‚å¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ã€‚å¦‚æœè·¯å¾„æ˜¯ä¸€ä¸ªç›®å½•ï¼Œåˆ™ä¼šé€’å½’å¤åˆ¶ï¼Œç”¨æ³•ç±»ä¼¼äº&quot;rsync&quot;</span><br><span class="line">contentã€€ã€€ã€€#ç”¨äºæ›¿æ¢&quot;src&quot;ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šæ–‡ä»¶çš„å€¼</span><br><span class="line">destã€€ã€€ã€€ã€€ #å¿…é€‰é¡¹ï¼Œå°†æºæ–‡ä»¶å¤åˆ¶åˆ°çš„è¿œç¨‹ä¸»æœºçš„ç»å¯¹è·¯å¾„</span><br><span class="line">backupã€€ã€€ã€€ #å½“æ–‡ä»¶å†…å®¹å‘ç”Ÿæ”¹å˜åï¼Œåœ¨è¦†ç›–ä¹‹å‰æŠŠæºæ–‡ä»¶å¤‡ä»½ï¼Œå¤‡ä»½æ–‡ä»¶åŒ…å«æ—¶é—´ä¿¡æ¯</span><br><span class="line">modeã€€ã€€ã€€ã€€ #é€’å½’è®¾å®šç›®å½•çš„æƒé™ï¼Œé»˜è®¤ä¸ºç³»ç»Ÿé»˜è®¤æƒé™</span><br><span class="line">forceã€€ã€€ã€€ã€€#å½“ç›®æ ‡ä¸»æœºåŒ…å«è¯¥æ–‡ä»¶ï¼Œä½†å†…å®¹ä¸åŒæ—¶ï¼Œè®¾ä¸º&quot;yes&quot;ï¼Œè¡¨ç¤ºå¼ºåˆ¶è¦†ç›–ï¼›è®¾ä¸º&quot;no&quot;ï¼Œè¡¨ç¤ºç›®æ ‡ä¸»æœºçš„ç›®æ ‡ä½ç½®ä¸å­˜åœ¨è¯¥æ–‡ä»¶æ‰å¤åˆ¶ã€‚é»˜è®¤ä¸º&quot;yes&quot;</span><br><span class="line">othersã€€ã€€ã€€ #æ‰€æœ‰çš„ file æ¨¡å—ä¸­çš„é€‰é¡¹å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨</span><br></pre></td></tr></table></figure><h3 id="fetchæ¨¡å—"><a href="#fetchæ¨¡å—" class="headerlink" title="fetchæ¨¡å—"></a>fetchæ¨¡å—</h3><p>è¯¥æ¨¡å—ç”¨äºä»è¿œç¨‹æŸä¸»æœºè·å–ï¼ˆå¤åˆ¶ï¼‰æ–‡ä»¶åˆ°æœ¬åœ°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">ansible $1 -m fetch -a $2</span><br><span class="line"></span><br><span class="line">$1ï¼šç»„å    egï¼šdev</span><br><span class="line"></span><br><span class="line">$2ï¼šå‘½ä»¤    egï¼š&#39;src&#x3D;&#x2F;data&#x2F;test.sh dest&#x3D;&#x2F;data &#39;</span><br><span class="line"></span><br><span class="line">destï¼šç”¨æ¥å­˜æ”¾æ–‡ä»¶çš„ç›®å½•</span><br><span class="line">srcï¼šåœ¨è¿œç¨‹æ‹‰å–çš„æ–‡ä»¶ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ä¸€ä¸ªfileï¼Œä¸èƒ½æ˜¯ç›®å½•</span><br><span class="line"></span><br><span class="line">æ–‡ä»¶ä¿å­˜çš„è·¯å¾„æ˜¯æˆ‘ä»¬è®¾ç½®çš„æ¥æ”¶ç›®å½•ä¸‹çš„è¢«ç®¡åˆ¶ä¸»æœºipç›®å½•ä¸‹</span><br><span class="line"></span><br><span class="line">[root@localhost data]# ansible dev -m fetch -a &#39;src&#x3D;&#x2F;data&#x2F;test.sh dest&#x3D;&#x2F;data&#39;</span><br><span class="line">172.31.22.33 | CHANGED &#x3D;&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;checksum&quot;: &quot;d53a75b15c0c9eaf4633e26442f4cca32c600c00&quot;, </span><br><span class="line">    &quot;dest&quot;: &quot;&#x2F;data&#x2F;172.31.22.33&#x2F;data&#x2F;test.sh&quot;, </span><br><span class="line">    &quot;md5sum&quot;: &quot;2da6c61e985bf3cece7ece373c3976b0&quot;, </span><br><span class="line">    &quot;remote_checksum&quot;: &quot;d53a75b15c0c9eaf4633e26442f4cca32c600c00&quot;, </span><br><span class="line">    &quot;remote_md5sum&quot;: null</span><br><span class="line">&#125;</span><br><span class="line">172.31.22.31 | CHANGED &#x3D;&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;checksum&quot;: &quot;d53a75b15c0c9eaf4633e26442f4cca32c600c00&quot;, </span><br><span class="line">    &quot;dest&quot;: &quot;&#x2F;data&#x2F;172.31.22.31&#x2F;data&#x2F;test.sh&quot;, </span><br><span class="line">    &quot;md5sum&quot;: &quot;2da6c61e985bf3cece7ece373c3976b0&quot;, </span><br><span class="line">    &quot;remote_checksum&quot;: &quot;d53a75b15c0c9eaf4633e26442f4cca32c600c00&quot;, </span><br><span class="line">    &quot;remote_md5sum&quot;: null</span><br><span class="line">&#125;</span><br><span class="line">172.31.22.35 | CHANGED &#x3D;&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;checksum&quot;: &quot;d53a75b15c0c9eaf4633e26442f4cca32c600c00&quot;, </span><br><span class="line">    &quot;dest&quot;: &quot;&#x2F;data&#x2F;172.31.22.35&#x2F;data&#x2F;test.sh&quot;, </span><br><span class="line">    &quot;md5sum&quot;: &quot;2da6c61e985bf3cece7ece373c3976b0&quot;, </span><br><span class="line">    &quot;remote_checksum&quot;: &quot;d53a75b15c0c9eaf4633e26442f4cca32c600c00&quot;, </span><br><span class="line">    &quot;remote_md5sum&quot;: null</span><br><span class="line">&#125;</span><br><span class="line">[root@localhost data]# ll</span><br><span class="line">total 28</span><br><span class="line">drwxr-xr-x.  3 root root 4096 May 15 10:08 172.31.22.31</span><br><span class="line">drwxr-xr-x.  3 root root 4096 May 15 10:08 172.31.22.33</span><br><span class="line">drwxr-xr-x.  3 root root 4096 May 15 10:08 172.31.22.35</span><br><span class="line">[root@localhost data]# cd 172.31.22.31&#x2F;data</span><br><span class="line">[root@localhost data]# ll</span><br><span class="line">total 4</span><br><span class="line">-rwxr-xr-x. 1 root root 352 May 15 10:08 test.sh</span><br></pre></td></tr></table></figure><h3 id="yumæ¨¡å—"><a href="#yumæ¨¡å—" class="headerlink" title="yumæ¨¡å—"></a>yumæ¨¡å—</h3><p>è¯¥æ¨¡å—ä¸»è¦ç”¨äºè½¯ä»¶çš„å®‰è£…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">ansible $1 -m yum -a $2</span><br><span class="line"></span><br><span class="line">$1ï¼šç»„å    egï¼šdev</span><br><span class="line"></span><br><span class="line">$2ï¼šå‘½ä»¤    egï¼š&#39;name&#x3D;tree  state&#x3D;present&#39;</span><br><span class="line"></span><br><span class="line">name&#x3D;ã€€ã€€#æ‰€å®‰è£…çš„åŒ…çš„åç§°</span><br><span class="line">state&#x3D;ã€€ã€€#present å®‰è£…ï¼Œ latest å®‰è£…æœ€æ–°çš„, absent å¸è½½è½¯ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# ansible dev -m yum -a &#39;name&#x3D;tree  state&#x3D;present&#39;</span><br><span class="line">172.31.22.31 | SUCCESS &#x3D;&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;python&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;msg&quot;: &quot;&quot;, </span><br><span class="line">    &quot;rc&quot;: 0, </span><br><span class="line">    &quot;results&quot;: [</span><br><span class="line">        &quot;tree-1.6.0-10.el7.x86_64 providing tree is already installed&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">172.31.22.35 | CHANGED &#x3D;&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;python&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;changes&quot;: &#123;</span><br><span class="line">        &quot;installed&quot;: [</span><br><span class="line">            &quot;tree&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;msg&quot;: &quot;&quot;, </span><br><span class="line">    &quot;rc&quot;: 0, </span><br><span class="line">    &quot;results&quot;: [</span><br><span class="line">        &quot;Loaded plugins: fastestmirror\nLoading mirror speeds from cached hostfile\n * base: mirrors.aliyun.com\n * elrepo: mirrors.tuna.tsinghua.edu.cn\n * epel: mirrors.tuna.tsinghua.edu.cn\n * extras: mirrors.aliyun.com\n * updates: mirrors.aliyun.com\nResolving Dependencies\n--&gt; Running transaction check\n---&gt; Package tree.x86_64 0:1.6.0-10.el7 will be installed\n--&gt; Finished Dependency Resolution\n\nDependencies Resolved\n\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\n Package        Arch             Version                   Repository      Size\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\nInstalling:\n tree           x86_64           1.6.0-10.el7              base            46 k\n\nTransaction Summary\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\nInstall  1 Package\n\nTotal download size: 46 k\nInstalled size: 87 k\nDownloading packages:\nRunning transaction check\nRunning transaction test\nTransaction test succeeded\nRunning transaction\n  Installing : tree-1.6.0-10.el7.x86_64                                     1&#x2F;1 \n  Verifying  : tree-1.6.0-10.el7.x86_64                                     1&#x2F;1 \n\nInstalled:\n  tree.x86_64 0:1.6.0-10.el7                                                    \n\nComplete!\n&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">172.31.22.33 | CHANGED &#x3D;&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;python&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;changes&quot;: &#123;</span><br><span class="line">        &quot;installed&quot;: [</span><br><span class="line">            &quot;tree&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;msg&quot;: &quot;&quot;, </span><br><span class="line">    &quot;rc&quot;: 0, </span><br><span class="line">    &quot;results&quot;: [</span><br><span class="line">        &quot;Loaded plugins: fastestmirror\nLoading mirror speeds from cached hostfile\n * base: mirrors.aliyun.com\n * elrepo: mirrors.tuna.tsinghua.edu.cn\n * epel: mirrors.tuna.tsinghua.edu.cn\n * extras: mirrors.aliyun.com\n * updates: mirrors.aliyun.com\nResolving Dependencies\n--&gt; Running transaction check\n---&gt; Package tree.x86_64 0:1.6.0-10.el7 will be installed\n--&gt; Finished Dependency Resolution\n\nDependencies Resolved\n\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\n Package        Arch             Version                   Repository      Size\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\nInstalling:\n tree           x86_64           1.6.0-10.el7              base            46 k\n\nTransaction Summary\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\nInstall  1 Package\n\nTotal download size: 46 k\nInstalled size: 87 k\nDownloading packages:\nRunning transaction check\nRunning transaction test\nTransaction test succeeded\nRunning transaction\n  Installing : tree-1.6.0-10.el7.x86_64                                     1&#x2F;1 \n  Verifying  : tree-1.6.0-10.el7.x86_64                                     1&#x2F;1 \n\nInstalled:\n  tree.x86_64 0:1.6.0-10.el7                                                    \n\nComplete!\n&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå·²å®‰è£…ç›®æ ‡è½¯ä»¶çš„æœºå™¨ä¸ä¼šå†æ‰§è¡Œå®‰è£…</p><h2 id="ansible-playbook"><a href="#ansible-playbook" class="headerlink" title="ansible playbook"></a>ansible playbook</h2><p>playbook æ˜¯ ansible ç”¨äºé…ç½®ï¼Œéƒ¨ç½²ï¼Œå’Œç®¡ç†è¢«æ§èŠ‚ç‚¹çš„å‰§æœ¬ã€‚å³å†™å¥½ä¸€ä¸ªå‰§æœ¬åï¼Œæ ¹æ®ç»„çš„ä¸åŒå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå‰§æœ¬æ¥æ‰¹é‡æ“ä½œæœåŠ¡å™¨ï¼Œæ¯”å¦‚è¿™ä¸ªå‰§æœ¬åˆ¶ä½œå¥½äº†åï¼Œå¯ä»¥ç»™devç»„å®‰è£…javaç¯å¢ƒï¼Œå®‰è£…å®Œæˆåï¼Œè¿˜å¯ä»¥ç»™testç»„å®‰è£…ï¼Œæœ‰ç‚¹æ¨¡æ¿çš„æ„æ€ã€‚</p><h3 id="æ ¼å¼"><a href="#æ ¼å¼" class="headerlink" title="æ ¼å¼"></a>æ ¼å¼</h3><p>åˆ›å»ºä¸€ä¸ªå¸¦.ymlç»“å°¾çš„æ–‡æœ¬ï¼Œæ–‡æœ¬å†…å®¹åº”è¯¥éµå¾ªä¸‹é¢å‡ ç‚¹</p><ul><li>æ–‡ä»¶çš„ç¬¬ä¸€è¡Œåº”è¯¥ä»¥ â€œâ€”â€œ (ä¸‰ä¸ªè¿å­—ç¬¦)å¼€å§‹ï¼Œè¡¨æ˜æ–‡ä»¶çš„å¼€å§‹ã€‚</li><li>åœ¨åŒä¸€è¡Œä¸­ï¼Œ#ä¹‹åçš„å†…å®¹è¡¨ç¤ºæ³¨é‡Šã€‚</li><li>YMLä¸­çš„åˆ—è¡¨å…ƒç´ ä»¥â€-â€å¼€å¤´ç„¶åç´§è·Ÿç€ä¸€ä¸ªç©ºæ ¼ï¼Œåé¢ä¸ºå…ƒç´ å†…å®¹ã€‚</li><li>åŒä¸€ä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ åº”è¯¥ä¿æŒç›¸åŒçš„ç¼©è¿›ã€‚å¦åˆ™ä¼šè¢«å½“åšé”™è¯¯å¤„ç†ã€‚</li><li>playä¸­hostsï¼Œvariablesï¼Œrolesï¼Œtasksç­‰å¯¹è±¡çš„è¡¨ç¤ºæ–¹æ³•éƒ½æ˜¯é”®å€¼ä¸­é—´ä»¥â€:â€åˆ†éš”è¡¨ç¤ºï¼Œâ€:â€åé¢è¿˜è¦å¢åŠ ä¸€ä¸ªç©ºæ ¼ã€‚</li></ul><p>Playbookçš„æ ¸å¿ƒå…ƒç´ ï¼š</p><ul><li>Hostsï¼šä¸»æœºç»„</li><li>Tasksï¼šä»»åŠ¡åˆ—è¡¨</li><li>Variablesï¼šå˜é‡ï¼Œè®¾ç½®æ–¹å¼æœ‰å››ç§</li><li>Templatesï¼šåŒ…å«äº†æ¨¡æ¿è¯­æ³•çš„æ–‡æœ¬æ–‡ä»¶â€”â€”Jinjaæ˜¯ä¸€ç§ç°ä»£ä¸”è®¾è®¡å‹å¥½çš„Pythonæ¨¡æ¿è¯­è¨€ï¼Œä»¥Djangoçš„æ¨¡æ¿ä¸ºæ¨¡å‹ã€‚å€ŸåŠ©å¯é€‰çš„æ²™ç›’æ¨¡æ¿æ‰§è¡Œç¯å¢ƒï¼Œå®ƒå¯ä»¥å¿«é€Ÿï¼Œå¹¿æ³›åœ°ä½¿ç”¨å¹¶ä¸”å®‰å…¨</li><li>Handlersï¼šç”±ç‰¹å®šæ¡ä»¶è§¦å‘çš„ä»»åŠ¡</li></ul><p>Playbooksé…ç½®æ–‡ä»¶çš„åŸºç¡€ç»„ä»¶ï¼š</p><ul><li>Hostsï¼šè¿è¡ŒæŒ‡å®šä»»åŠ¡çš„ç›®æ ‡ä¸»æœº</li><li>remoute_userï¼šåœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œä»»åŠ¡çš„ç”¨æˆ·</li><li>tasksï¼šä»»åŠ¡åˆ—è¡¨</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">æ ¼å¼ï¼š</span><br><span class="line">     tasksï¼š</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€â€“ name: TASK_NAME   </span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ã€€module: arguments</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ã€€notify: HANDLER_NAME</span><br><span class="line">ã€€ã€€ handlers:</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€â€“ name: HANDLER_NAME</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ã€€module: arguments</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ã€€</span><br><span class="line">handlersï¼šä»»åŠ¡ï¼Œåœ¨ç‰¹å®šæ¡ä»¶ä¸‹è§¦å‘ï¼›æ¥æ”¶åˆ°å…¶å®ƒä»»åŠ¡çš„é€šçŸ¥æ—¶è¢«è§¦å‘ï¼›ã€€ã€€ã€€</span><br><span class="line">ã€€  (1) æŸä»»åŠ¡çš„çŠ¶æ€åœ¨è¿è¡Œåä¸ºchangedæ—¶ï¼Œå¯é€šè¿‡â€œnotifyâ€é€šçŸ¥ç»™ç›¸åº”çš„handlersï¼›</span><br><span class="line">ã€€ã€€(2) ä»»åŠ¡å¯ä»¥é€šè¿‡â€œtagsâ€œæ‰“æ ‡ç­¾ï¼Œè€Œåå¯åœ¨ansible-playbookå‘½ä»¤ä¸Šä½¿ç”¨-tæŒ‡å®šè¿›è¡Œè°ƒç”¨ï¼›</span><br><span class="line">ã€€ã€€</span><br><span class="line">ansible-playbookå‘½ä»¤çš„å‘½ä»¤è¡Œä¸­çš„-e vars&#x3D;VARSï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥æŠŠè‡ªå®šä¹‰çš„å˜é‡ä¼ å…¥ã€‚</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚ä¸‹é¢çš„playbook </span><br><span class="line">ä½ éœ€è¦æ”¹http_port ç«¯å£å¯ä»¥è¿™æ ·æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">ansible-playbook ansible_httpd.yml -e http_port&#x3D;81 </span><br><span class="line"></span><br><span class="line">ä½ éœ€è¦å®šå‘æ‰§è¡Œtagï¼šstartapacheçš„æ–¹æ³•</span><br><span class="line"></span><br><span class="line">ansible-playbook ansible_httpd.yml -t startapache</span><br></pre></td></tr></table></figure><h3 id="å®˜ç½‘çš„ç¬¬ä¸€ä¸ªçš„playbook"><a href="#å®˜ç½‘çš„ç¬¬ä¸€ä¸ªçš„playbook" class="headerlink" title="å®˜ç½‘çš„ç¬¬ä¸€ä¸ªçš„playbook"></a>å®˜ç½‘çš„ç¬¬ä¸€ä¸ªçš„playbook</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim ansible_httpd.yml</span><br><span class="line">---</span><br><span class="line">- hosts: dev       #ansbileå®šä¹‰çš„ç»„å</span><br><span class="line">  vars:            #å˜é‡,å¯ä»¥ä¼ åˆ°templateé‡Œçš„httpd.j2é‡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨ymlæ–‡ä»¶é‡Œåˆ©ç”¨</span><br><span class="line">    http_port: 80   </span><br><span class="line">    max_clients: 200</span><br><span class="line">#è¿œç¨‹æ‰§è¡Œçš„ç”¨æˆ·</span><br><span class="line">  remote_user: root  </span><br><span class="line">  tasks:</span><br><span class="line">  - name: ensure apache is at the latest version   #æ–¹æ³•å</span><br><span class="line">#åŸºç¡€æ¨¡å—ï¼šå‚æ•°</span><br><span class="line">    yum: pkg&#x3D;httpd state&#x3D;latest                   </span><br><span class="line">  - name: write the apache config file</span><br><span class="line">    template: src&#x3D;&#x2F;srv&#x2F;httpd.j2 dest&#x3D;&#x2F;etc&#x2F;httpd.conf</span><br><span class="line">#æ‰§è¡Œnameä¸ºrestart apacheçš„æ–¹æ³•</span><br><span class="line">    notify:         </span><br><span class="line">    - restart apache  </span><br><span class="line">  - name: ensure apache is running</span><br><span class="line">    service: name&#x3D;httpd state&#x3D;started </span><br><span class="line">    tag:startapache</span><br><span class="line">#è¿™é‡Œçš„restart apacheå’Œä¸Šé¢çš„è§¦å‘æ˜¯é…å¯¹çš„ã€‚è¿™å°±æ˜¯handlersçš„ä½œç”¨ã€‚ç›¸å½“äºtag</span><br><span class="line">  handlers:          </span><br><span class="line">    - name: restart apache</span><br><span class="line">      service: name&#x3D;httpd state&#x3D;restarted   #é‡å¯æœåŠ¡å™¨</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ansibleæœ€åŸºæœ¬çš„çŸ¥è¯†å°±æ¢³ç†åˆ°è¿™äº†ï¼Œå…¶å®å¯¹äºå¤§éƒ¨åˆ†åœºæ™¯å·²ç»å¤Ÿç”¨äº†ã€‚å¦‚æœéœ€è¦å®šåˆ¶åŒ–é•¿æœŸä½¿ç”¨ansibleç¼–æ’ï¼Œæ¨èç”¨ansbile-playbookçš„æ¨¡å¼ï¼Œè¿™æ ·å¯¹äºå¤§å‹é›†ç¾¤ç»´æŠ¤æ›´æ–¹ä¾¿ï¼Œä¾‹å¦‚æ”¹è„šæœ¬ã€é…ç½®æ›´æ–°ã€é‡å¯ç­‰ã€‚å¦‚æœæ˜¯å¶å°”ç”¨ansbileå¯ä»¥ç›´æ¥ä½¿ç”¨æ™®é€šå‘½ä»¤ã€‚æœ¬æ–‡å±•ç¤ºçš„ansibleåªæ˜¯ä¸€ä¸ªå…¥é—¨æ•™ç¨‹ï¼Œå®é™…ä½¿ç”¨ä¸­å¯¹äºæ›´å¤šä¸°å¯Œæ¨¡å—çš„åˆ©ç”¨ã€ä»¥åŠä¼˜åŒ–ansibleçš„æ€§èƒ½çš„æ–¹æ³•å¯ä»¥çœ‹ä¸‹é¢å‚è€ƒèµ„æ–™çš„å®˜æ–¹æ–‡æ¡£ã€‚</p><p>ä¸‹æœŸé€šè¿‡ansibleé…åˆjenkinså±•ç°å®æˆ˜ä¸­ansbileçš„å¯ç”¨æ€§ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://docs.ansible.com/" target="_blank" rel="noopener">ansibleå®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://jinja.palletsprojects.com/en/2.11.x/" target="_blank" rel="noopener">jinja2å®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://www.cnblogs.com/keerya/p/7987886.html#_label0_0" target="_blank" rel="noopener">è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·â€”â€”ansibleè¯¦è§£ï¼ˆä¸€ï¼‰</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è·Ÿæˆ‘å­¦Devops </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Devops </tag>
            
            <tag> è‡ªåŠ¨åŒ– </tag>
            
            <tag> Ansible </tag>
            
            <tag> Python </tag>
            
            <tag> Jinja </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®ç°è´Ÿè½½å‡è¡¡å™¨æ­é…Nacosé›†ç¾¤çš„é«˜å¯ç”¨æ¡†æ¶</title>
      <link href="/2020/05/14/slb/slb-nacos/"/>
      <url>/2020/05/14/slb/slb-nacos/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><p>æœ¬æ–‡æ¥ä¸ŠæœŸï¼Œæ•™å¤§å®¶åœ¨é¡¹ç›®ä¸­çš„å¦‚ä½•åˆ©ç”¨è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨ç»„ä»¶æ­å»ºnacosé›†ç¾¤ã€‚</p><p>æ¶æ„å›¾å¦‚ä¸‹<br><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/SLB/nacos_ha.jpg"  alt="nacos_ha.jpg"></p><h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><p>è¯·ç¡®ä¿æ˜¯åœ¨ç¯å¢ƒä¸­å®‰è£…ä½¿ç”¨:</p><ul><li>64 bit JDK 1.8+ï¼›ä¸‹è½½.é…ç½®ã€‚</li><li>Maven 3.2.x+ï¼›ä¸‹è½½.é…ç½®ã€‚</li><li>3ä¸ªæˆ–3ä¸ªä»¥ä¸ŠNacosèŠ‚ç‚¹æ‰èƒ½æ„æˆé›†ç¾¤ã€‚</li><li>keepalived</li><li>nginx</li><li>mysql5.7.28</li></ul><table><thead><tr><th>æœåŠ¡å™¨</th><th>IP</th></tr></thead><tbody><tr><td>nginx+keepalived(ä¸»)</td><td>172.31.26.11</td></tr><tr><td>nginx+keepalived(å¤‡)</td><td>172.31.26.12</td></tr><tr><td>mysql</td><td>172.31.26.13</td></tr><tr><td>nacos-01</td><td>172.31.26.14</td></tr><tr><td>nacos-02</td><td>172.31.26.15</td></tr><tr><td>nacos-03</td><td>172.31.26.16</td></tr><tr><td>VIP</td><td>172.31.26.200</td></tr></tbody></table><h1 id="å®‰è£…å¯åŠ¨æ­¥éª¤"><a href="#å®‰è£…å¯åŠ¨æ­¥éª¤" class="headerlink" title="å®‰è£…å¯åŠ¨æ­¥éª¤"></a>å®‰è£…å¯åŠ¨æ­¥éª¤</h1><h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><table><thead><tr><th>æœåŠ¡å™¨</th><th>IP</th></tr></thead><tbody><tr><td>mysql</td><td>172.31.26.13</td></tr></tbody></table><h3 id="å®‰è£…Mysql"><a href="#å®‰è£…Mysql" class="headerlink" title="å®‰è£…Mysql"></a>å®‰è£…Mysql</h3><p><a href="https://rugod.cn/2020/05/01/mysql/mysql-install/" target="_blank" rel="noopener">ç¦»çº¿å®‰è£…Mysql5.7.28åŠè°ƒä¼˜</a></p><h3 id="åˆå§‹åŒ–-MySQL-æ•°æ®åº“"><a href="#åˆå§‹åŒ–-MySQL-æ•°æ®åº“" class="headerlink" title="åˆå§‹åŒ– MySQL æ•°æ®åº“"></a>åˆå§‹åŒ– MySQL æ•°æ®åº“</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">&#x2F;*   æ•°æ®åº“å…¨å &#x3D; nacos_config   *&#x2F;</span><br><span class="line">&#x2F;*   è¡¨åç§° &#x3D; config_info   *&#x2F;</span><br><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">CREATE TABLE &#96;config_info&#96; (</span><br><span class="line">  &#96;id&#96; bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#39;id&#39;,</span><br><span class="line">  &#96;data_id&#96; varchar(255) NOT NULL COMMENT &#39;data_id&#39;,</span><br><span class="line">  &#96;group_id&#96; varchar(255) DEFAULT NULL,</span><br><span class="line">  &#96;content&#96; longtext NOT NULL COMMENT &#39;content&#39;,</span><br><span class="line">  &#96;md5&#96; varchar(32) DEFAULT NULL COMMENT &#39;md5&#39;,</span><br><span class="line">  &#96;gmt_create&#96; datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">  &#96;gmt_modified&#96; datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;,</span><br><span class="line">  &#96;src_user&#96; text COMMENT &#39;source user&#39;,</span><br><span class="line">  &#96;src_ip&#96; varchar(20) DEFAULT NULL COMMENT &#39;source ip&#39;,</span><br><span class="line">  &#96;app_name&#96; varchar(128) DEFAULT NULL,</span><br><span class="line">  &#96;tenant_id&#96; varchar(128) DEFAULT &#39;&#39; COMMENT &#39;ç§Ÿæˆ·å­—æ®µ&#39;,</span><br><span class="line">  &#96;c_desc&#96; varchar(256) DEFAULT NULL,</span><br><span class="line">  &#96;c_use&#96; varchar(64) DEFAULT NULL,</span><br><span class="line">  &#96;effect&#96; varchar(64) DEFAULT NULL,</span><br><span class="line">  &#96;type&#96; varchar(64) DEFAULT NULL,</span><br><span class="line">  &#96;c_schema&#96; text,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">  UNIQUE KEY &#96;uk_configinfo_datagrouptenant&#96; (&#96;data_id&#96;,&#96;group_id&#96;,&#96;tenant_id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COLLATE&#x3D;utf8_bin COMMENT&#x3D;&#39;config_info&#39;;</span><br><span class="line"></span><br><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">&#x2F;*   æ•°æ®åº“å…¨å &#x3D; nacos_config   *&#x2F;</span><br><span class="line">&#x2F;*   è¡¨åç§° &#x3D; config_info_aggr   *&#x2F;</span><br><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">CREATE TABLE &#96;config_info_aggr&#96; (</span><br><span class="line">  &#96;id&#96; bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#39;id&#39;,</span><br><span class="line">  &#96;data_id&#96; varchar(255) NOT NULL COMMENT &#39;data_id&#39;,</span><br><span class="line">  &#96;group_id&#96; varchar(255) NOT NULL COMMENT &#39;group_id&#39;,</span><br><span class="line">  &#96;datum_id&#96; varchar(255) NOT NULL COMMENT &#39;datum_id&#39;,</span><br><span class="line">  &#96;content&#96; longtext NOT NULL COMMENT &#39;å†…å®¹&#39;,</span><br><span class="line">  &#96;gmt_modified&#96; datetime NOT NULL COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;,</span><br><span class="line">  &#96;app_name&#96; varchar(128) DEFAULT NULL,</span><br><span class="line">  &#96;tenant_id&#96; varchar(128) DEFAULT &#39;&#39; COMMENT &#39;ç§Ÿæˆ·å­—æ®µ&#39;,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">  UNIQUE KEY &#96;uk_configinfoaggr_datagrouptenantdatum&#96; (&#96;data_id&#96;,&#96;group_id&#96;,&#96;tenant_id&#96;,&#96;datum_id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COLLATE&#x3D;utf8_bin COMMENT&#x3D;&#39;å¢åŠ ç§Ÿæˆ·å­—æ®µ&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">&#x2F;*   æ•°æ®åº“å…¨å &#x3D; nacos_config   *&#x2F;</span><br><span class="line">&#x2F;*   è¡¨åç§° &#x3D; config_info_beta   *&#x2F;</span><br><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">CREATE TABLE &#96;config_info_beta&#96; (</span><br><span class="line">  &#96;id&#96; bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#39;id&#39;,</span><br><span class="line">  &#96;data_id&#96; varchar(255) NOT NULL COMMENT &#39;data_id&#39;,</span><br><span class="line">  &#96;group_id&#96; varchar(128) NOT NULL COMMENT &#39;group_id&#39;,</span><br><span class="line">  &#96;app_name&#96; varchar(128) DEFAULT NULL COMMENT &#39;app_name&#39;,</span><br><span class="line">  &#96;content&#96; longtext NOT NULL COMMENT &#39;content&#39;,</span><br><span class="line">  &#96;beta_ips&#96; varchar(1024) DEFAULT NULL COMMENT &#39;betaIps&#39;,</span><br><span class="line">  &#96;md5&#96; varchar(32) DEFAULT NULL COMMENT &#39;md5&#39;,</span><br><span class="line">  &#96;gmt_create&#96; datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">  &#96;gmt_modified&#96; datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;,</span><br><span class="line">  &#96;src_user&#96; text COMMENT &#39;source user&#39;,</span><br><span class="line">  &#96;src_ip&#96; varchar(20) DEFAULT NULL COMMENT &#39;source ip&#39;,</span><br><span class="line">  &#96;tenant_id&#96; varchar(128) DEFAULT &#39;&#39; COMMENT &#39;ç§Ÿæˆ·å­—æ®µ&#39;,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">  UNIQUE KEY &#96;uk_configinfobeta_datagrouptenant&#96; (&#96;data_id&#96;,&#96;group_id&#96;,&#96;tenant_id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COLLATE&#x3D;utf8_bin COMMENT&#x3D;&#39;config_info_beta&#39;;</span><br><span class="line"></span><br><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">&#x2F;*   æ•°æ®åº“å…¨å &#x3D; nacos_config   *&#x2F;</span><br><span class="line">&#x2F;*   è¡¨åç§° &#x3D; config_info_tag   *&#x2F;</span><br><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">CREATE TABLE &#96;config_info_tag&#96; (</span><br><span class="line">  &#96;id&#96; bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#39;id&#39;,</span><br><span class="line">  &#96;data_id&#96; varchar(255) NOT NULL COMMENT &#39;data_id&#39;,</span><br><span class="line">  &#96;group_id&#96; varchar(128) NOT NULL COMMENT &#39;group_id&#39;,</span><br><span class="line">  &#96;tenant_id&#96; varchar(128) DEFAULT &#39;&#39; COMMENT &#39;tenant_id&#39;,</span><br><span class="line">  &#96;tag_id&#96; varchar(128) NOT NULL COMMENT &#39;tag_id&#39;,</span><br><span class="line">  &#96;app_name&#96; varchar(128) DEFAULT NULL COMMENT &#39;app_name&#39;,</span><br><span class="line">  &#96;content&#96; longtext NOT NULL COMMENT &#39;content&#39;,</span><br><span class="line">  &#96;md5&#96; varchar(32) DEFAULT NULL COMMENT &#39;md5&#39;,</span><br><span class="line">  &#96;gmt_create&#96; datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">  &#96;gmt_modified&#96; datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;,</span><br><span class="line">  &#96;src_user&#96; text COMMENT &#39;source user&#39;,</span><br><span class="line">  &#96;src_ip&#96; varchar(20) DEFAULT NULL COMMENT &#39;source ip&#39;,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">  UNIQUE KEY &#96;uk_configinfotag_datagrouptenanttag&#96; (&#96;data_id&#96;,&#96;group_id&#96;,&#96;tenant_id&#96;,&#96;tag_id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COLLATE&#x3D;utf8_bin COMMENT&#x3D;&#39;config_info_tag&#39;;</span><br><span class="line"></span><br><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">&#x2F;*   æ•°æ®åº“å…¨å &#x3D; nacos_config   *&#x2F;</span><br><span class="line">&#x2F;*   è¡¨åç§° &#x3D; config_tags_relation   *&#x2F;</span><br><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">CREATE TABLE &#96;config_tags_relation&#96; (</span><br><span class="line">  &#96;id&#96; bigint(20) NOT NULL COMMENT &#39;id&#39;,</span><br><span class="line">  &#96;tag_name&#96; varchar(128) NOT NULL COMMENT &#39;tag_name&#39;,</span><br><span class="line">  &#96;tag_type&#96; varchar(64) DEFAULT NULL COMMENT &#39;tag_type&#39;,</span><br><span class="line">  &#96;data_id&#96; varchar(255) NOT NULL COMMENT &#39;data_id&#39;,</span><br><span class="line">  &#96;group_id&#96; varchar(128) NOT NULL COMMENT &#39;group_id&#39;,</span><br><span class="line">  &#96;tenant_id&#96; varchar(128) DEFAULT &#39;&#39; COMMENT &#39;tenant_id&#39;,</span><br><span class="line">  &#96;nid&#96; bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  PRIMARY KEY (&#96;nid&#96;),</span><br><span class="line">  UNIQUE KEY &#96;uk_configtagrelation_configidtag&#96; (&#96;id&#96;,&#96;tag_name&#96;,&#96;tag_type&#96;),</span><br><span class="line">  KEY &#96;idx_tenant_id&#96; (&#96;tenant_id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COLLATE&#x3D;utf8_bin COMMENT&#x3D;&#39;config_tag_relation&#39;;</span><br><span class="line"></span><br><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">&#x2F;*   æ•°æ®åº“å…¨å &#x3D; nacos_config   *&#x2F;</span><br><span class="line">&#x2F;*   è¡¨åç§° &#x3D; group_capacity   *&#x2F;</span><br><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">CREATE TABLE &#96;group_capacity&#96; (</span><br><span class="line">  &#96;id&#96; bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;ä¸»é”®ID&#39;,</span><br><span class="line">  &#96;group_id&#96; varchar(128) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;Group IDï¼Œç©ºå­—ç¬¦è¡¨ç¤ºæ•´ä¸ªé›†ç¾¤&#39;,</span><br><span class="line">  &#96;quota&#96; int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#39;,</span><br><span class="line">  &#96;usage&#96; int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;ä½¿ç”¨é‡&#39;,</span><br><span class="line">  &#96;max_size&#96; int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#39;,</span><br><span class="line">  &#96;max_aggr_count&#96; int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°ï¼Œï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#39;,</span><br><span class="line">  &#96;max_aggr_size&#96; int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#39;,</span><br><span class="line">  &#96;max_history_count&#96; int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;æœ€å¤§å˜æ›´å†å²æ•°é‡&#39;,</span><br><span class="line">  &#96;gmt_create&#96; datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">  &#96;gmt_modified&#96; datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">  UNIQUE KEY &#96;uk_group_id&#96; (&#96;group_id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COLLATE&#x3D;utf8_bin COMMENT&#x3D;&#39;é›†ç¾¤ã€å„Groupå®¹é‡ä¿¡æ¯è¡¨&#39;;</span><br><span class="line"></span><br><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">&#x2F;*   æ•°æ®åº“å…¨å &#x3D; nacos_config   *&#x2F;</span><br><span class="line">&#x2F;*   è¡¨åç§° &#x3D; his_config_info   *&#x2F;</span><br><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">CREATE TABLE &#96;his_config_info&#96; (</span><br><span class="line">  &#96;id&#96; bigint(64) unsigned NOT NULL,</span><br><span class="line">  &#96;nid&#96; bigint(20) unsigned NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;data_id&#96; varchar(255) NOT NULL,</span><br><span class="line">  &#96;group_id&#96; varchar(128) NOT NULL,</span><br><span class="line">  &#96;app_name&#96; varchar(128) DEFAULT NULL COMMENT &#39;app_name&#39;,</span><br><span class="line">  &#96;content&#96; longtext NOT NULL,</span><br><span class="line">  &#96;md5&#96; varchar(32) DEFAULT NULL,</span><br><span class="line">  &#96;gmt_create&#96; datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  &#96;gmt_modified&#96; datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  &#96;src_user&#96; text,</span><br><span class="line">  &#96;src_ip&#96; varchar(20) DEFAULT NULL,</span><br><span class="line">  &#96;op_type&#96; char(10) DEFAULT NULL,</span><br><span class="line">  &#96;tenant_id&#96; varchar(128) DEFAULT &#39;&#39; COMMENT &#39;ç§Ÿæˆ·å­—æ®µ&#39;,</span><br><span class="line">  PRIMARY KEY (&#96;nid&#96;),</span><br><span class="line">  KEY &#96;idx_gmt_create&#96; (&#96;gmt_create&#96;),</span><br><span class="line">  KEY &#96;idx_gmt_modified&#96; (&#96;gmt_modified&#96;),</span><br><span class="line">  KEY &#96;idx_did&#96; (&#96;data_id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COLLATE&#x3D;utf8_bin COMMENT&#x3D;&#39;å¤šç§Ÿæˆ·æ”¹é€ &#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">&#x2F;*   æ•°æ®åº“å…¨å &#x3D; nacos_config   *&#x2F;</span><br><span class="line">&#x2F;*   è¡¨åç§° &#x3D; tenant_capacity   *&#x2F;</span><br><span class="line">&#x2F;******************************************&#x2F;</span><br><span class="line">CREATE TABLE &#96;tenant_capacity&#96; (</span><br><span class="line">  &#96;id&#96; bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;ä¸»é”®ID&#39;,</span><br><span class="line">  &#96;tenant_id&#96; varchar(128) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;Tenant ID&#39;,</span><br><span class="line">  &#96;quota&#96; int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#39;,</span><br><span class="line">  &#96;usage&#96; int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;ä½¿ç”¨é‡&#39;,</span><br><span class="line">  &#96;max_size&#96; int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#39;,</span><br><span class="line">  &#96;max_aggr_count&#96; int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°&#39;,</span><br><span class="line">  &#96;max_aggr_size&#96; int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#39;,</span><br><span class="line">  &#96;max_history_count&#96; int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;æœ€å¤§å˜æ›´å†å²æ•°é‡&#39;,</span><br><span class="line">  &#96;gmt_create&#96; datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">  &#96;gmt_modified&#96; datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">  UNIQUE KEY &#96;uk_tenant_id&#96; (&#96;tenant_id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COLLATE&#x3D;utf8_bin COMMENT&#x3D;&#39;ç§Ÿæˆ·å®¹é‡ä¿¡æ¯è¡¨&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE &#96;tenant_info&#96; (</span><br><span class="line">  &#96;id&#96; bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#39;id&#39;,</span><br><span class="line">  &#96;kp&#96; varchar(128) NOT NULL COMMENT &#39;kp&#39;,</span><br><span class="line">  &#96;tenant_id&#96; varchar(128) default &#39;&#39; COMMENT &#39;tenant_id&#39;,</span><br><span class="line">  &#96;tenant_name&#96; varchar(128) default &#39;&#39; COMMENT &#39;tenant_name&#39;,</span><br><span class="line">  &#96;tenant_desc&#96; varchar(256) DEFAULT NULL COMMENT &#39;tenant_desc&#39;,</span><br><span class="line">  &#96;create_source&#96; varchar(32) DEFAULT NULL COMMENT &#39;create_source&#39;,</span><br><span class="line">  &#96;gmt_create&#96; bigint(20) NOT NULL COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">  &#96;gmt_modified&#96; bigint(20) NOT NULL COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">  UNIQUE KEY &#96;uk_tenant_info_kptenantid&#96; (&#96;kp&#96;,&#96;tenant_id&#96;),</span><br><span class="line">  KEY &#96;idx_tenant_id&#96; (&#96;tenant_id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COLLATE&#x3D;utf8_bin COMMENT&#x3D;&#39;tenant_info&#39;;</span><br><span class="line"></span><br><span class="line">CREATE TABLE &#96;users&#96; (</span><br><span class="line">&#96;username&#96; varchar(50) NOT NULL PRIMARY KEY,</span><br><span class="line">&#96;password&#96; varchar(500) NOT NULL,</span><br><span class="line">&#96;enabled&#96; boolean NOT NULL</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE TABLE &#96;roles&#96; (</span><br><span class="line">&#96;username&#96; varchar(50) NOT NULL,</span><br><span class="line">&#96;role&#96; varchar(50) NOT NULL,</span><br><span class="line">UNIQUE INDEX &#96;idx_user_role&#96; (&#96;username&#96; ASC, &#96;role&#96; ASC) USING BTREE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE TABLE &#96;permissions&#96; (</span><br><span class="line">    &#96;role&#96; varchar(50) NOT NULL,</span><br><span class="line">    &#96;resource&#96; varchar(512) NOT NULL,</span><br><span class="line">    &#96;action&#96; varchar(8) NOT NULL,</span><br><span class="line">    UNIQUE INDEX &#96;uk_role_permission&#96; (&#96;role&#96;,&#96;resource&#96;,&#96;action&#96;) USING BTREE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO users (username, password, enabled) VALUES (&#39;nacos&#39;, &#39;$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#39;, TRUE);</span><br><span class="line"></span><br><span class="line">INSERT INTO roles (username, role) VALUES (&#39;nacos&#39;, &#39;ROLE_ADMIN&#39;);</span><br></pre></td></tr></table></figure><h2 id="nacosé›†ç¾¤"><a href="#nacosé›†ç¾¤" class="headerlink" title="nacosé›†ç¾¤"></a>nacosé›†ç¾¤</h2><table><thead><tr><th>æœåŠ¡å™¨</th><th>IP</th></tr></thead><tbody><tr><td>nacos-01</td><td>172.31.26.14</td></tr><tr><td>nacos-02</td><td>172.31.26.15</td></tr><tr><td>nacos-03</td><td>172.31.26.16</td></tr></tbody></table><p>ä»¥ä¸‹æ˜¯æ¯å°èŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œçš„æ“ä½œ</p><h3 id="å®‰è£…java"><a href="#å®‰è£…java" class="headerlink" title="å®‰è£…java"></a>å®‰è£…java</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y java-1.8.0-openjdk</span><br><span class="line">yum install -y java-devel</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…maven"><a href="#å®‰è£…maven" class="headerlink" title="å®‰è£…maven"></a>å®‰è£…maven</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;opt</span><br><span class="line">wget https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;maven&#x2F;maven-3&#x2F;3.6.3&#x2F;binaries&#x2F;apache-maven-3.6.3-bin.tar.gz</span><br><span class="line">tar -zxvf apache-maven-3.6.3-bin.tar.gz</span><br><span class="line">mv apache-maven-3.6.3 maven</span><br><span class="line"></span><br><span class="line">é…ç½®ç¯å¢ƒå˜é‡</span><br><span class="line">vi &#x2F;etc&#x2F;profile </span><br><span class="line">export M2_HOME&#x3D;&#x2F;opt&#x2F;maven                       </span><br><span class="line">export PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin:$M2_HOME&#x2F;bin</span><br><span class="line">ä¿®æ”¹å®Œåsource &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# mvn -v</span><br><span class="line">Apache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f)</span><br><span class="line">Maven home: &#x2F;opt&#x2F;maven</span><br><span class="line">Java version: 1.8.0_252, vendor: Oracle Corporation, runtime: &#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-1.8.0-openjdk-1.8.0.252.b09-2.el7_8.x86_64&#x2F;jre</span><br><span class="line">Default locale: en_US, platform encoding: UTF-8</span><br><span class="line">OS name: &quot;linux&quot;, version: &quot;5.3.11-1.el7.elrepo.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…nacos"><a href="#å®‰è£…nacos" class="headerlink" title="å®‰è£…nacos"></a>å®‰è£…nacos</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;alibaba&#x2F;nacos&#x2F;releases&#x2F;download&#x2F;1.1.3&#x2F;nacos-server-1.1.3.tar.gz</span><br><span class="line">tar -zxvf nacos-server-1.1.3.tar.gz</span><br></pre></td></tr></table></figure><h3 id="cluster-conf-é…ç½®"><a href="#cluster-conf-é…ç½®" class="headerlink" title="cluster.conf é…ç½®"></a>cluster.conf é…ç½®</h3><p>vim /opt/nacos/conf/cluster.conf </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#æ·»åŠ é›†ç¾¤ä¿¡æ¯</span><br><span class="line"># ip:port</span><br><span class="line">172.31.26.14:8848</span><br><span class="line">172.31.26.15:8848</span><br><span class="line">172.31.26.16:8848</span><br></pre></td></tr></table></figure><h3 id="application-properties-é…ç½®"><a href="#application-properties-é…ç½®" class="headerlink" title="application.properties é…ç½®"></a>application.properties é…ç½®</h3><p>vim /opt/nacos/conf/application.properties</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#æ·»åŠ æ•°æ®åº“è¿æ¥ä¿¡æ¯</span><br><span class="line">db.num&#x3D;1    </span><br><span class="line">db.url.0&#x3D;jdbc:mysql:&#x2F;&#x2F;172.31.26.13:3306&#x2F;nacos_config?characterEncoding&#x3D;utf8&amp;connectTimeout&#x3D;1000&amp;socketTimeout&#x3D;3000&amp;autoReconnect&#x3D;true</span><br><span class="line">db.user&#x3D;admin   </span><br><span class="line">db.password&#x3D;123456</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨é›†ç¾¤"><a href="#å¯åŠ¨é›†ç¾¤" class="headerlink" title="å¯åŠ¨é›†ç¾¤"></a>å¯åŠ¨é›†ç¾¤</h3><p>è¿›å…¥æ¯å°nacosèŠ‚ç‚¹ï¼Œå¯åŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cd &#x2F;opt&#x2F;nacos&#x2F;bin</span><br><span class="line">[root@localhost bin]# sh startup.sh </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-1.8.0-openjdk-1.8.0.252.b09-2.el7_8.x86_64&#x2F;bin&#x2F;java  -server -Xms2g -Xmx2g -Xmn1g -XX:MetaspaceSize&#x3D;128m -XX:MaxMetaspaceSize&#x3D;320m -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath&#x3D;&#x2F;opt&#x2F;nacos&#x2F;logs&#x2F;java_heapdump.hprof -XX:-UseLargePages -Djava.ext.dirs&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-1.8.0-openjdk-1.8.0.252.b09-2.el7_8.x86_64&#x2F;jre&#x2F;lib&#x2F;ext:&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-1.8.0-openjdk-1.8.0.252.b09-2.el7_8.x86_64&#x2F;lib&#x2F;ext:&#x2F;opt&#x2F;nacos&#x2F;plugins&#x2F;cmdb:&#x2F;opt&#x2F;nacos&#x2F;plugins&#x2F;mysql -Xloggc:&#x2F;opt&#x2F;nacos&#x2F;logs&#x2F;nacos_gc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles&#x3D;10 -XX:GCLogFileSize&#x3D;100M -Dnacos.home&#x3D;&#x2F;opt&#x2F;nacos -Dloader.path&#x3D;&#x2F;opt&#x2F;nacos&#x2F;plugins&#x2F;health -jar &#x2F;opt&#x2F;nacos&#x2F;target&#x2F;nacos-server.jar  --spring.config.location&#x3D;classpath:&#x2F;,classpath:&#x2F;config&#x2F;,file:.&#x2F;,file:.&#x2F;config&#x2F;,file:&#x2F;opt&#x2F;nacos&#x2F;conf&#x2F; --logging.config&#x3D;&#x2F;opt&#x2F;nacos&#x2F;conf&#x2F;nacos-logback.xml --server.max-http-header-size&#x3D;524288</span><br><span class="line">nacos is starting with cluster</span><br><span class="line">nacos is startingï¼Œyou can check the &#x2F;opt&#x2F;nacos&#x2F;logs&#x2F;start.out</span><br></pre></td></tr></table></figure><h2 id="nginx-keepalived"><a href="#nginx-keepalived" class="headerlink" title="nginx+keepalived"></a>nginx+keepalived</h2><table><thead><tr><th>æœåŠ¡å™¨</th><th>IP</th></tr></thead><tbody><tr><td>nginx+keepalived(ä¸»)</td><td>172.31.26.11</td></tr><tr><td>nginx+keepalived(å¤‡)</td><td>172.31.26.12</td></tr></tbody></table><p>ä»¥ä¸‹æ˜¯æ¯å°èŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œçš„æ“ä½œ</p><h3 id="å®‰è£…nginx"><a href="#å®‰è£…nginx" class="headerlink" title="å®‰è£…nginx"></a>å®‰è£…nginx</h3><p>yum install epel-release -y<br>yum install nginx httpd-tools -y</p><h3 id="é…ç½®nginx"><a href="#é…ç½®nginx" class="headerlink" title="é…ç½®nginx"></a>é…ç½®nginx</h3><p>vim /etc/nginx/nginx.conf æ·»åŠ ä¸‹é¢çš„é…ç½®åˆ°http{}ä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">upstream nacos &#123;</span><br><span class="line">    #server nacosåœ°å€:ç«¯å£å· </span><br><span class="line">    #weightè¡¨ç¤ºæƒé‡   é»˜è®¤æƒ…å†µä¸‹ä¸º1ã€‚</span><br><span class="line">    #max_fails è®¾ç½®åœ¨fail_timeout å‚æ•°è®¾ç½®çš„æŒç»­æ—¶é—´å†…åº”ä¸æœåŠ¡å™¨é€šä¿¡å¤±è´¥çš„å°è¯•æ¬¡æ•°ï¼Œä»¥è®¤ä¸ºæœåŠ¡å™¨åœ¨fail_timeoutå‚æ•°è®¾ç½®çš„æŒç»­æ—¶é—´å†…ä¸å¯ç”¨ ã€‚</span><br><span class="line">    #fail_timeout åœ¨æŒ‡å®šæ¬¡æ•°çš„ä¸æˆåŠŸå°è¯•ä¸æœåŠ¡å™¨é€šä¿¡çš„æ—¶é—´å†…åº”è¯¥ç¢°å·§è®¤ä¸ºæœåŠ¡å™¨ä¸å¯ç”¨</span><br><span class="line">    server 172.31.26.14:8848 weight&#x3D;4 max_fails&#x3D;2 fail_timeout&#x3D;30s;   </span><br><span class="line">    server 172.31.26.15:8848 weight&#x3D;4 max_fails&#x3D;2 fail_timeout&#x3D;30s;</span><br><span class="line">    server 172.31.26.16:8848 weight&#x3D;4 max_fails&#x3D;2 fail_timeout&#x3D;30s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line"> listen       80;</span><br><span class="line"> server_name  nacoscluster.com;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">location &#x2F; &#123;</span><br><span class="line">     proxy_pass http:&#x2F;&#x2F;nacos&#x2F; ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨-å…³é—­nginx"><a href="#å¯åŠ¨-å…³é—­nginx" class="headerlink" title="å¯åŠ¨/å…³é—­nginx"></a>å¯åŠ¨/å…³é—­nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx    å¯åŠ¨</span><br><span class="line">nginx -s stop   å…³é—­</span><br><span class="line">nginx -s reload é‡å¯</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…keepalived"><a href="#å®‰è£…keepalived" class="headerlink" title="å®‰è£…keepalived"></a>å®‰è£…keepalived</h3><p>yum install -y keepalived</p><h3 id="é…ç½®keepalived"><a href="#é…ç½®keepalived" class="headerlink" title="é…ç½®keepalived"></a>é…ç½®keepalived</h3><p>vim /etc/keepalived/keepalived.conf</p><p>ä¸»èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">   router_id nginx_master    # è®¾ç½®nginx masterçš„idï¼Œåœ¨ä¸€ä¸ªç½‘ç»œåº”è¯¥æ˜¯å”¯ä¸€çš„</span><br><span class="line">   script_user root</span><br><span class="line">   enable_script_security</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#VRRPè„šæœ¬å®šä¹‰</span><br><span class="line">vrrp_script chk_nginx</span><br><span class="line">&#123;</span><br><span class="line">    script &quot;&#x2F;etc&#x2F;keepalived&#x2F;check_nginx.sh&quot;</span><br><span class="line">    interval 2</span><br><span class="line">    weight -2   #è‹¥è„šæœ¬è¿”å›ä¸º1 åˆ™å‡è¿™å°æœºå™¨keepalivedçš„å®æ—¶æƒé‡</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER            # æŒ‡å®škeepalivedçš„è§’è‰²ï¼ŒMASTERä¸ºä¸»ï¼ŒBACKUPä¸ºå¤‡</span><br><span class="line">    interface ens192          # å½“å‰è¿›è¡Œvrrpé€šè®¯çš„ç½‘ç»œæ¥å£å¡(å½“å‰centosçš„ç½‘å¡)</span><br><span class="line">    virtual_router_id 51    # è™šæ‹Ÿè·¯ç”±ç¼–å·ï¼Œä¸»ä»è¦ä¸€è‡´</span><br><span class="line">    priority 100         # æƒé‡ï¼Œæ•°å€¼è¶Šå¤§ï¼Œè·å–å¤„ç†è¯·æ±‚çš„ä¼˜å…ˆçº§è¶Šé«˜</span><br><span class="line">    unicast_src_ip  172.31.26.51   #æœ¬æœºip</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">        172.31.26.52      #å¯¹ç«¯ip</span><br><span class="line">    &#125;</span><br><span class="line">    advert_int 1            # æ£€æŸ¥é—´éš”ï¼Œé»˜è®¤ä¸º1s(vrrpç»„æ’­å‘¨æœŸç§’æ•°)</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">         chk_nginx</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">       172.31.26.200</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤‡ç”¨èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">   router_id nginx_backup</span><br><span class="line">   script_user root</span><br><span class="line">   enable_script_security</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#VRRPè„šæœ¬å®šä¹‰</span><br><span class="line">vrrp_script chk_nginx</span><br><span class="line">&#123;</span><br><span class="line">    script &quot;&#x2F;etc&#x2F;keepalived&#x2F;check_nginx.sh&quot;</span><br><span class="line">    interval 2</span><br><span class="line">    weight -2    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface ens192</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 99    #æƒé‡è¦æ¯”ä¸»èŠ‚ç‚¹ä½</span><br><span class="line">    unicast_src_ip  172.31.26.52   #æœ¬æœºip</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">        172.31.26.51      #å¯¹ç«¯ip</span><br><span class="line">    &#125;</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">         chk_nginx</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.31.26.200</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™nginxç›‘æ§æ£€æŸ¥è„šæœ¬ï¼Œæ”¾åˆ°/etc/keepalivedç›®å½•ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;etc&#x2F;keepalived</span><br><span class="line">vim check_nginx.sh</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">A&#x3D;&#96;ps -C nginx --no-header |wc -l&#96;  #æ£€æŸ¥nginxè¿›ç¨‹æ˜¯å¦å­˜åœ¨</span><br><span class="line">if [ $A -eq 0 ];then</span><br><span class="line">    &#x2F;usr&#x2F;sbin&#x2F;nginx                #é‡å¯nginx</span><br><span class="line">    echo &quot;1&quot;</span><br><span class="line">    if [ &#96;ps -C nginx --no-header |wc -l&#96; -eq 0 ];then    #nginxé‡å¯å¤±è´¥</span><br><span class="line">        exit 1</span><br><span class="line">    else</span><br><span class="line">        exit 0</span><br><span class="line">    fi</span><br><span class="line">else</span><br><span class="line">    exit 0</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>å†™å®Œåè®°å¾—åŠ å¯æ‰§è¡Œçš„æƒé™,è„šæœ¬ç›‘æ§nginxè¿›ç¨‹ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™é‡å¯ï¼Œå¦‚æœé‡å¯å¤±è´¥åˆ™è¿”å›1,keepalivedé…ç½®æ–‡ä»¶é€šè¿‡è¿”å›å€¼ä¸º1å¯ä»¥å®æ—¶å‡2ç‚¹keepalivedçš„æƒé‡ï¼Œè‹¥ä¸»æœºçš„å®æ—¶æƒé‡ä½äºå¤‡ç”¨æœºï¼Œåˆ™è§¦å‘VIPåˆ‡æ¢ï¼Œç”±å¤‡ç”¨æœºä»£ç†VIPã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x check_nginx.sh</span><br></pre></td></tr></table></figure><p>éªŒè¯è„šæœ¬æ˜¯å¦å¯è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh  check_nginx.sh</span><br></pre></td></tr></table></figure><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/SLB/keepalived_check.jpg"  alt="keepalived_check.jpg"></p><p>nginxè¿›ç¨‹ä¸å­˜åœ¨åˆ™é‡å¯ï¼ŒéªŒè¯æˆåŠŸ</p><h3 id="å¯åŠ¨keepalived"><a href="#å¯åŠ¨keepalived" class="headerlink" title="å¯åŠ¨keepalived"></a>å¯åŠ¨keepalived</h3><p>systemctl start keepalived</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">ä¸»èŠ‚ç‚¹</span><br><span class="line">[root@localhost nginx]# ip add</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1&#x2F;128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link&#x2F;ether 00:50:56:99:10:75 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.31.26.51&#x2F;24 brd 172.31.26.255 scope global noprefixroute ens192</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 172.31.26.200&#x2F;32 scope global ens192</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">å¤‡ç”¨èŠ‚ç‚¹</span><br><span class="line">[root@localhost nginx]# ip add</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1&#x2F;128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link&#x2F;ether 00:50:56:99:84:51 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.31.26.52&#x2F;24 brd 172.31.26.255 scope global noprefixroute ens192</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><p>ä¸»èŠ‚ç‚¹ä¼šç”Ÿæˆè™šæ‹Ÿip172.31.26.200 è€Œå¤‡ç”¨èŠ‚ç‚¹ä¸ä¼šç”Ÿæˆ172.31.26.200</p><h2 id="åŸŸåæ˜ å°„"><a href="#åŸŸåæ˜ å°„" class="headerlink" title="åŸŸåæ˜ å°„"></a>åŸŸåæ˜ å°„</h2><p>å°†nacoscluster.comæ˜ å°„åˆ°172.31.26.200ä¸Š</p><p>å°†nacoscluster.comçš„è¯·æ±‚éƒ½è½¬å‘åˆ°ä¸‹é¢çš„3å°æœåŠ¡å™¨ä¸Šï¼Œ</p><h1 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h1><h2 id="è®¿é—®é¡µé¢"><a href="#è®¿é—®é¡µé¢" class="headerlink" title="è®¿é—®é¡µé¢"></a>è®¿é—®é¡µé¢</h2><p>è®¿é—®é¡µé¢ <a href="http://www.nacoscluster.com/nacos" target="_blank" rel="noopener">www.nacoscluster.com/nacos</a> å¯ä»¥æ­£å¸¸æ‰“å¼€é¡µé¢è¯´æ˜é«˜å¯ç”¨é›†ç¾¤é…ç½®å®Œæˆ</p><p>æ¥ä¸‹æ¥å¼€å§‹éªŒè¯è¿™ä¸ªé›†ç¾¤æ˜¯å¦çœŸçš„é«˜å¯ç”¨</p><h2 id="ç¨‹åºå¾ªç¯è¯»å–nacosä¸­çš„é…ç½®æ–‡ä»¶"><a href="#ç¨‹åºå¾ªç¯è¯»å–nacosä¸­çš„é…ç½®æ–‡ä»¶" class="headerlink" title="ç¨‹åºå¾ªç¯è¯»å–nacosä¸­çš„é…ç½®æ–‡ä»¶"></a>ç¨‹åºå¾ªç¯è¯»å–nacosä¸­çš„é…ç½®æ–‡ä»¶</h2><p>è¯»å–æ“ä½œç”±æˆ‘å’Œlilu.org.cnçš„åšä¸»åŠxiongyj.cnçš„åšä¸»åˆä½œä¸€èµ·å°†è¿™ä¸ªå®éªŒåšå®Œï¼Œåœ¨æ­¤æ„Ÿè°¢ä»–ä»¬ã€‚</p><h2 id="å…³é—­ä¸»æœºnginx"><a href="#å…³é—­ä¸»æœºnginx" class="headerlink" title="å…³é—­ä¸»æœºnginx"></a>å…³é—­ä¸»æœºnginx</h2><p>æ³¨æ„ï¼Œä¸ºäº†æ–¹ä¾¿æµ‹è¯•keepalivedçš„å®æ—¶æƒé‡å¢å‡ï¼Œåœ¨è¿™é‡Œå…ˆä¿®æ”¹è„šæœ¬<br>check_nginx.shï¼Œæ³¨é‡Šè¿™ä¸€è¡Œï¼Œå¦åˆ™nginxé‡å¯çœ‹ä¸åˆ°VIPæ¼‚ç§»çš„æ•ˆæœã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;sbin&#x2F;nginx                #é‡å¯nginx</span><br></pre></td></tr></table></figure><p>ä¸»æœºæ‰§è¡Œå…³é—­nginx</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost keepalived]# nginx -s stop</span><br></pre></td></tr></table></figure><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/SLB/keepalived_nginx_down.jpg"  alt="keepalived_nginx_down.jpg"><br>ä¸»æœº </p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/SLB/keepalived_nginx_up.jpg"  alt="keepalived_nginx_uo.jpg"><br>å¤‡ç”¨æœº</p><p>ç”±å›¾å¯ä»¥çœ‹å‡ºï¼Œä¸»æœºnginxæŒ‚æ‰åï¼Œæƒé‡ç”±100-2=98 ä½äºå¤‡ç”¨æœºçš„99 VIPåˆ‡æ¢ã€‚</p><p>ç¨‹åºå¾ªç¯è¯»å–æ•°æ®æˆåŠŸ</p><h2 id="å…³é—­ä¸»æœºkeepalived"><a href="#å…³é—­ä¸»æœºkeepalived" class="headerlink" title="å…³é—­ä¸»æœºkeepalived"></a>å…³é—­ä¸»æœºkeepalived</h2><p>ä¸»æœºæ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost keepalived]# systemctl stop keepalived</span><br></pre></td></tr></table></figure><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/SLB/keepalived_down.jpg"  alt="keepalived_down.jpg"><br>ä¸»æœº </p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/SLB/keepalived_up.jpg"  alt="keepalived_up.jpg"><br>å¤‡ç”¨æœº</p><p>ç”±å›¾å¯ä»¥çœ‹å‡ºï¼Œä¸»æœºkeepailivedå…³é—­æœåŠ¡åï¼ŒVIPç›´æ¥åˆ‡æ¢åˆ°å¤‡ç”¨æœº</p><p>ç¨‹åºå¾ªç¯è¯»å–æ•°æ®æˆåŠŸ</p><h2 id="å…³é—­nacos"><a href="#å…³é—­nacos" class="headerlink" title="å…³é—­nacos"></a>å…³é—­nacos</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost bin]# sh shutdown.sh</span><br><span class="line">The nacosServer(36354) is running...</span><br><span class="line">Send shutdown request to nacosServer(36354) OK</span><br></pre></td></tr></table></figure><p>è®¿é—®<a href="http://www.nacoscluster.com/nacosä»ç„¶å¯ä»¥æ‰“å¼€ï¼Œè¯´æ˜nginxåå‘ä»£ç†æ²¡é—®é¢˜" target="_blank" rel="noopener">www.nacoscluster.com/nacosä»ç„¶å¯ä»¥æ‰“å¼€ï¼Œè¯´æ˜nginxåå‘ä»£ç†æ²¡é—®é¢˜</a></p><p>ç¨‹åºå¾ªç¯è¯»å–æ•°æ®æˆåŠŸ</p><h1 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h1><p>è‡³æ­¤ï¼Œkeepalived+nginx+nacos+mysqlé«˜å¯ç”¨é›†ç¾¤æ­å»ºå®Œæˆï¼Œå®æˆ˜ä¸­è¿˜æ˜¯æŸ¥è¯¢äº†è®¸å¤šæ–‡æ¡£ï¼Œä¸æ‡‚å°±é—®åº¦å¨˜ï¼Œè¸©è¿‡å¥½å¤šå‘ï¼Œè¿˜æœ‰æ„å¤–çš„æ”¶è·ï¼ˆè¯¦æƒ…è§æ€»ç»“ï¼‰ã€‚</p><p>è¡¥å……å‡ ç‚¹æ­¤é›†ç¾¤æ­å»ºçš„ä¸è¶³ä¹‹å¤„ï¼Œå¦‚æœè§‰å¾—å»ºè®®å¥½å¯ä»¥æŒ‰ç…§æˆ‘çš„æ€è·¯åšä¸‹å»ï¼š</p><ul><li>mysqlè‹¥æ˜¯æ”¾åœ¨ç”Ÿäº§ç¯å¢ƒå»ºè®®ä¸»å¤‡é›†ç¾¤æ­å»ºï¼Œæœ¬ç¯‡å›¾ç®€å•æ²¡æœ‰è¿™ä¹ˆåš</li><li>nignxçš„è½®è¯¢ç®—æ³•æœ¬ç¯‡ç”¨çš„åŠ æƒè½®è¯¢ï¼Œå®é™…ä¸Šæ ¹æ®nacosçš„æœåŠ¡å™¨æ€§èƒ½å·®å¼‚å¯ä»¥é‡‡ç”¨å…¶ä»–çš„è´Ÿè½½å‡è¡¡è°ƒåº¦ç®—æ³•ï¼Œæœ¬ç¯‡nacosæœåŠ¡å™¨é…ç½®å‡ç­‰ï¼Œæ‰€ä»¥åŠ æƒæ— æ‰€è°“ã€‚</li></ul><h1 id="æŠ¥é”™æ€»ç»“"><a href="#æŠ¥é”™æ€»ç»“" class="headerlink" title="æŠ¥é”™æ€»ç»“"></a>æŠ¥é”™æ€»ç»“</h1><h2 id="keepalivedä¸»ä»åˆ‡æ¢å¤±è´¥"><a href="#keepalivedä¸»ä»åˆ‡æ¢å¤±è´¥" class="headerlink" title="keepalivedä¸»ä»åˆ‡æ¢å¤±è´¥"></a>keepalivedä¸»ä»åˆ‡æ¢å¤±è´¥</h2><p>å¦‚æœä¸¤èŠ‚ç‚¹çš„ä¸Šè”äº¤æ¢æœºç¦ç”¨äº†ç»„æ’­ï¼Œåˆ™åªèƒ½é‡‡ç”¨vrrpå•æ’­é€šå‘Šçš„æ–¹å¼ã€‚éœ€è¦åœ¨vrrp_instance VI_1 {}ä¸­æ·»åŠ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ä¸»èŠ‚ç‚¹</span><br><span class="line">unicast_src_ip  172.31.26.51   #æœ¬æœºip</span><br><span class="line">unicast_peer &#123;</span><br><span class="line">    172.31.26.52      #å¯¹ç«¯ip</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¤‡ç”¨èŠ‚ç‚¹</span><br><span class="line">unicast_src_ip  172.31.26.52   #æœ¬æœºip</span><br><span class="line">unicast_peer &#123;</span><br><span class="line">    172.31.26.51      #å¯¹ç«¯ip</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="keepalivedä»ä¸»èŠ‚ç‚¹åˆ‡æ¢æˆå¤‡ç”¨èŠ‚ç‚¹åï¼Œvipå·²ç»ç”Ÿæˆåˆ°å¤‡ç”¨èŠ‚ç‚¹ä¸Šï¼Œä½†æ˜¯å´ä¸èƒ½è®¿é—®"><a href="#keepalivedä»ä¸»èŠ‚ç‚¹åˆ‡æ¢æˆå¤‡ç”¨èŠ‚ç‚¹åï¼Œvipå·²ç»ç”Ÿæˆåˆ°å¤‡ç”¨èŠ‚ç‚¹ä¸Šï¼Œä½†æ˜¯å´ä¸èƒ½è®¿é—®" class="headerlink" title="keepalivedä»ä¸»èŠ‚ç‚¹åˆ‡æ¢æˆå¤‡ç”¨èŠ‚ç‚¹åï¼Œvipå·²ç»ç”Ÿæˆåˆ°å¤‡ç”¨èŠ‚ç‚¹ä¸Šï¼Œä½†æ˜¯å´ä¸èƒ½è®¿é—®"></a>keepalivedä»ä¸»èŠ‚ç‚¹åˆ‡æ¢æˆå¤‡ç”¨èŠ‚ç‚¹åï¼Œvipå·²ç»ç”Ÿæˆåˆ°å¤‡ç”¨èŠ‚ç‚¹ä¸Šï¼Œä½†æ˜¯å´ä¸èƒ½è®¿é—®</h2><p>è·Ÿè¸ªiptablesè§„åˆ™å‘ç°ï¼Œé»˜è®¤çš„iptablesè§„åˆ™ä»…å…è®¸22ç«¯å£å’ŒicmpæŠ¥æ–‡é€šè¿‡ï¼Œéœ€è¦åˆ é™¤è§„åˆ™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost keepalived ~]# iptables -F #åˆ é™¤æ‰€æœ‰iptablesè§„åˆ™</span><br><span class="line">[root@localhost keepalived ~]# iptables -X #åˆ é™¤é™¤é»˜è®¤é“¾ä¹‹å¤–çš„æ‰€æœ‰iptablesé“¾</span><br></pre></td></tr></table></figure><h2 id="å…³é—­Linuxé˜²ç«å¢™Selinuxå’Œfirewalld"><a href="#å…³é—­Linuxé˜²ç«å¢™Selinuxå’Œfirewalld" class="headerlink" title="å…³é—­Linuxé˜²ç«å¢™Selinuxå’Œfirewalld"></a>å…³é—­Linuxé˜²ç«å¢™Selinuxå’Œfirewalld</h2><p>systemctl stop firewalld<br>systemctl disable firewalld<br>setenforce 0<br>sed -i â€œs/SELINUX=enforcing/SELINUX=disabled/gâ€ /etc/selinux/config </p><h2 id="nacos"><a href="#nacos" class="headerlink" title="nacos"></a>nacos</h2><p>1.ä¸­é€”å‡ºç°nacosç”¨åŸŸåè¿æ¥å¤±è´¥çš„æƒ…å†µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: lilu</span><br><span class="line">  profiles:</span><br><span class="line">    active: dev</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      config:</span><br><span class="line">        server-addr: nacoscluster.com</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢èµ„æ–™æ‰çŸ¥é“åœ°å€å¿…é¡»ä¸ºnacoscluster.com+ç«¯å£<br>ä¹Ÿå°±æ˜¯ nacoscluster.com:80</p><p>2.æˆ‘å°†åå°nacoså…¨éƒ¨æ–­æ‰è¿æ¥åï¼Œä»–ä»¬çš„ç¨‹åºè°ƒç”¨nacosä»ç„¶æœ‰è¿”å›å€¼ï¼Œç»Debugåå‘ç°è¯·æ±‚è¶…æ—¶ï¼Œä½†æ˜¯è¿˜æ˜¯èƒ½ä¼ å›æ¥å€¼ï¼Œè€Œä¸”è¿™ä¸ªå€¼ä¸€ç›´ä¸æ›´æ–°ã€‚æˆ‘ä»¬å‡ ä¸ªç™¾æ€ä¸å¾—å…¶è§£ï¼Œå…³äº†ideã€å…³äº†æœåŠ¡å™¨éƒ½ä¸è¡Œï¼Œä¸€ä¸ªè¿æ¥ä¸ä¸Šnacosçš„ç¨‹åºå±…ç„¶èƒ½æœ‰è¿”å›ï¼Œç»xiongyj.cnçš„åšä¸»æŸ¥çœ‹æºä»£ç å‘ç°ï¼Œnacosæœ‰å¤‡ä»½ç­–ç•¥ã€‚</p><p>ç”±äºæˆ‘ä¸æ˜¯å­¦javaçš„ï¼Œå…·ä½“æºç å°±ä¸å±•å¼€è¯´äº†ï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯nacosæ¯è¯»å–ä¸€æ¬¡é…ç½®åå°±ä¿ç•™åˆ°æœ¬åœ°ï¼Œå½“ç¨‹åºè¿˜æ˜¯é€šè¿‡ç›¸åŒçš„nacosåœ°å€å»è¯»å–é…ç½®çš„æ—¶å€™ï¼Œå³ä½¿è¿æ¥ä¸ä¸Šï¼Œä½†æ˜¯ä¸ä¼šæŠ¥è¿æ¥å¤±è´¥çš„é”™è¯¯ï¼Œè€Œæ˜¯ä¼šä»æœ¬åœ°å»è¯»æœ€åä¸€æ¬¡è¿æ¥æ—¶çš„é…ç½®æ–‡ä»¶ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœä½ åªæŠŠnacoså½“é…ç½®ä¸­å¿ƒï¼Œå³ä½¿nacosé›†ç¾¤éƒ½æŒ‚æ‰äº†ï¼Œä¹Ÿä¸ä¼šå½±å“æœåŠ¡ï¼Œå½“ç„¶ï¼Œå¦‚æœä½ æŠŠnacoså½“æ³¨å†Œä¸­å¿ƒçš„è¯é‚£è¿˜æ˜¯ä¼šæœ‰å½±å“ã€‚</p><p>å£®å“‰æˆ‘å¤§é˜¿é‡Œï¼Œnacosè¿™ä¸ªä¸­é—´ä»¶è®¾è®¡çš„çœŸå¿ƒé«˜å¯ç”¨ï¼Œè€ƒè™‘å¤ªå‘¨å…¨äº†ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html" target="_blank" rel="noopener">nacoså®˜ç½‘</a></p><p><a href="https://blog.51cto.com/13599730/2161622" target="_blank" rel="noopener">keepalivedä¸»å¤‡èŠ‚ç‚¹éƒ½é…ç½®vipï¼Œvipåˆ‡æ¢å¼‚å¸¸æ¡ˆä¾‹åˆ†æ</a></p><p><a href="https://www.cnblogs.com/netonline/p/7642595.html" target="_blank" rel="noopener">Keepalivedä¸¤èŠ‚ç‚¹å‡ºç°åŒVIPçš„æƒ…å†µ</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> SLB </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nacos </tag>
            
            <tag> SLB </tag>
            
            <tag> è´Ÿè½½å‡è¡¡ </tag>
            
            <tag> Keepalived </tag>
            
            <tag> HA </tag>
            
            <tag> Cluster </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mongodb3.4ç¦»çº¿å‡çº§åˆ°4.2</title>
      <link href="/2020/05/12/mongodb/mongodb-update/"/>
      <url>/2020/05/12/mongodb/mongodb-update/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„mongodbç”¨çš„æ˜¯4.2ï¼Œçº¿ä¸‹å¼€å‘æµ‹è¯•ç¯å¢ƒä¸€ç›´ç”¨çš„æ˜¯3.4ï¼Œæœ‰éœ€æ±‚è¦ç”¨åˆ°mongodbçš„æ–°ç‰¹æ€§ï¼Œå‡†å¤‡å¼€å§‹å‡çº§ã€‚</p><h1 id="è°ƒæŸ¥"><a href="#è°ƒæŸ¥" class="headerlink" title="è°ƒæŸ¥"></a>è°ƒæŸ¥</h1><p>ç”±äºæ˜¯çº¿ä¸‹ç¯å¢ƒçš„å‡çº§ï¼Œæ‰€ä»¥æš‚æ—¶å…³é—­mongodbæ²¡æœ‰å½±å“ï¼Œå¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒåœ¨çº¿å‡çº§å»ºè®®æ‰¾ä¸‹å…¶ä»–æ–‡æ¡£ã€‚</p><h2 id="ç›´æ¥å‡çº§"><a href="#ç›´æ¥å‡çº§" class="headerlink" title="ç›´æ¥å‡çº§"></a>ç›´æ¥å‡çº§</h2><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Mongodb/mongodb-update.jpg"  alt="mongodb-update.jpg"></p><p>å®˜æ–¹è¯´æ˜æœåŠ¡å‡çº§éœ€è¦ä¸Šä¸€ä¸ªç‰¹å®šç‰ˆæœ¬</p><p>å¦‚æœæŒ‰ç…§å®˜æ–¹æ¥åšï¼Œæˆ‘éœ€è¦å…ˆå‡çº§3.4åˆ°3.6 å†ä»3.6å‡çº§åˆ°4.0 æœ€åä»4.0å‡çº§åˆ°4.2 </p><p>emmmmmmï¼Œäººå‚»äº†</p><h2 id="åˆ é™¤é‡è£…"><a href="#åˆ é™¤é‡è£…" class="headerlink" title="åˆ é™¤é‡è£…"></a>åˆ é™¤é‡è£…</h2><p>è°ƒç ”äº†ç½‘ä¸Šçš„æ–‡æ¡£ï¼Œæ²¡æ‰¾åˆ°ç”¨è¿™ç§æ–¹å¼å»å‡çº§çš„ä¾‹å­ï¼Œä½†æ˜¯æ„Ÿè§‰é—®é¢˜ä¸å¤§ã€‚</p><h1 id="å¤‡ä»½é‡è£…"><a href="#å¤‡ä»½é‡è£…" class="headerlink" title="å¤‡ä»½é‡è£…"></a>å¤‡ä»½é‡è£…</h1><h2 id="å¤‡ä»½"><a href="#å¤‡ä»½" class="headerlink" title="å¤‡ä»½"></a>å¤‡ä»½</h2><p>æ³¨æ„ mongodumpå¹¶ä¸”ä¸èƒ½ä½œä¸ºæ­£åœ¨è¿›è¡Œåˆ†ç‰‡äº‹åŠ¡çš„4.2+åˆ†ç‰‡ç¾¤é›†çš„å¤‡ä»½ç­–ç•¥çš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºä½¿ç”¨åˆ›å»ºçš„å¤‡ä»½ ä¸èƒ½ä¿æŒåˆ†ç‰‡äº‹åŠ¡çš„åŸå­æ€§ä¿è¯ã€‚</p><p>ç”±äºåº”ç”¨ä¸­ä¸æ¶‰åŠmongodbäº‹åŠ¡ï¼Œæ‰€ä»¥ä½¿ç”¨mongodump/mongorestoreç›´æ¥å…¨åº“å¯¼å…¥å¯¼å‡ºå³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¯¼å‡º</span><br><span class="line">mongodump -h IP --port ç«¯å£ -u ç”¨æˆ·å -p å¯†ç  -d æ•°æ®åº“ -o æ–‡ä»¶å­˜åœ¨è·¯å¾„ </span><br><span class="line">å¯¼å…¥</span><br><span class="line">mongorestore -h IP --port ç«¯å£ -u ç”¨æˆ·å -p å¯†ç  -d æ•°æ®åº“ --drop æ–‡ä»¶å­˜åœ¨è·¯å¾„</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³å¯¼å‡ºæ‰€æœ‰æ•°æ®åº“ï¼Œå¯ä»¥å»æ‰-d</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@dev-data-01 mongodb]# pwd</span><br><span class="line">&#x2F;root&#x2F;mongodb</span><br><span class="line">[root@dev-data-01 mongodb]# mongodump -h 127.0.0.1 --port 27017 -uroot -p123456 -o &#x2F;root&#x2F;mongodb&#x2F;</span><br><span class="line">[root@dev-data-01 mongodb]# ll</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x. 2 root root 4096 May 12 15:13 admin</span><br><span class="line">drwxr-xr-x. 2 root root   98 May 12 15:13 mercury</span><br><span class="line">drwxr-xr-x. 2 root root 4096 May 12 15:13 xc_cms</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯¼å‡ºæ¥äº†</p><h2 id="é‡è£…"><a href="#é‡è£…" class="headerlink" title="é‡è£…"></a>é‡è£…</h2><p>é‡è£…æˆ‘è¸©è¿‡å¾ˆå¤šå‘ï¼Œä½†æ˜¯éƒ½åœ¨ä¸€ä¸ªåšå®¢ä¸­æ‰¾åˆ°äº†æ‰€æœ‰çš„æŠ¥é”™è§£å†³æ–¹æ¡ˆï¼Œå†™çš„æ¯”è¾ƒå…¨é¢ï¼Œè¯¦æƒ…è¯·çœ‹å‚è€ƒèµ„æ–™</p><p>æˆ‘ç”¨çš„æ˜¯yumå®‰è£…ï¼Œå¦‚æœæ˜¯ç”¨äºŒè¿›åˆ¶åŒ…å®‰è£…çš„æ€è·¯ä¹Ÿä¸€æ ·</p><p>1.åœæ­¢mongodbæœåŠ¡</p><p>2.å¸è½½mongodbåŠæ—¥å¿—ã€æ•°æ®ç­‰</p><p>3.é‡è£…æ–°çš„mongodb</p><h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop mongod</span><br><span class="line">yum erase $(rpm -qa | grep mongodb-org)  #å¸è½½</span><br><span class="line">rm -rf &#x2F;var&#x2F;log&#x2F;mongodb   #åˆ é™¤æ—¥å¿—</span><br><span class="line">rm -rf &#x2F;var&#x2F;lib&#x2F;mongo     #åˆ é™¤æ•°æ®</span><br><span class="line">rm -rf &#x2F;etc&#x2F;yum.repos.d&#x2F;mongodb-org-3.4.repo #åˆ é™¤åŸmongodbçš„yumæº</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">æ·»åŠ yumæº</span><br><span class="line">vim &#x2F;etc&#x2F;yum.repos.d&#x2F;mongodb-org-4.2.repo</span><br><span class="line"></span><br><span class="line">[mongodb-org-4.2]</span><br><span class="line">name&#x3D;MongoDB Repository</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;repo.mongodb.org&#x2F;yum&#x2F;redhat&#x2F;$releasever&#x2F;mongodb-org&#x2F;4.2&#x2F;x86_64&#x2F;</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">gpgkey&#x3D;https:&#x2F;&#x2F;www.mongodb.org&#x2F;static&#x2F;pgp&#x2F;server-4.2.asc</span><br><span class="line"></span><br><span class="line">å®‰è£…</span><br><span class="line">yum install mongodb-org -y</span><br><span class="line"></span><br><span class="line">é…ç½®</span><br><span class="line">vim &#x2F;etc&#x2F;mongod.conf</span><br><span class="line">å°†bindIp: 127.0.0.1æ”¹æˆbindIp: 0.0.0.0 </span><br><span class="line"></span><br><span class="line">å¯åŠ¨</span><br><span class="line">systemctl start mongod</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹çŠ¶æ€</span><br><span class="line">systemctl status mongod</span><br></pre></td></tr></table></figure><h3 id="å¯¼å…¥"><a href="#å¯¼å…¥" class="headerlink" title="å¯¼å…¥"></a>å¯¼å…¥</h3><p>æ³¨æ„ï¼ åœ¨å¯¼å…¥æ•°æ®å‰ä¸è¦å¼€å¯å®‰å…¨è®¤è¯ï¼Œå¦åˆ™å¯èƒ½å‡ºç°æƒé™ä¸è¶³ç­‰é—®é¢˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@dev-data-01 mongodb]# mongorestore &#x2F;root&#x2F;mongodb&#x2F;</span><br><span class="line"></span><br><span class="line">ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¼€å¯å¯†ç éªŒè¯</span><br><span class="line">vim &#x2F;etc&#x2F;mongod.conf</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">       authorization: enabled</span><br><span class="line">       </span><br><span class="line">é‡å¯mongodb</span><br><span class="line">systemctl restart mongod</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œmongodbå‡çº§å®Œæˆ<del>~</del></p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://www.jb51.net/article/109091.htm" target="_blank" rel="noopener">Mongodbå¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ³•å°ç»“(Mongodbä¸­ç»å¸¸å‡ºç°çš„é”™è¯¯)</a></p><p><a href="https://docs.mongodb.com/manual/core/backups/" target="_blank" rel="noopener">Mongodbå®˜æ–¹å¤‡ä»½å‘½ä»¤</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Mongodb </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mongodb </tag>
            
            <tag> æ•°æ®å¤‡ä»½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµ…è°ˆé«˜å¯ç”¨çš„è´Ÿè½½å‡è¡¡é›†ç¾¤å®ç°åŸç†åŠæ–¹æ¡ˆ</title>
      <link href="/2020/05/11/slb/slb-ha/"/>
      <url>/2020/05/11/slb/slb-ha/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><p>ç°åœ¨å¾ˆå¤šä¼ä¸šçš„åº”ç”¨éƒ½ä¸Šäº‘äº†ï¼Œåˆ©ç”¨å„ç§äº‘å¹³å°çš„è´Ÿè½½å‡è¡¡ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡æµé‡åˆ†å‘æ‰©å±•åº”ç”¨ç³»ç»Ÿå¯¹å¤–çš„æœåŠ¡èƒ½åŠ›ï¼Œé€šè¿‡æ¶ˆé™¤å•ç‚¹æ•…éšœæå‡åº”ç”¨ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚ä¸‹é¢å°±æ¥èŠèŠæœ€å¸¸ç”¨çš„äº’è”ç½‘é«˜å¯ç”¨çš„è´Ÿè½½å‡è¡¡é›†ç¾¤å®ç°æ–¹æ¡ˆã€‚</p><h1 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h1><p>åœ¨ä»‹ç»æ¶æ„ä¹‹å‰ï¼Œä¸ºäº†é¿å…éƒ¨åˆ†è¯»è€…å¯¹æ¶æ„è®¾è®¡ä¸­çš„ä¸€äº›æ¦‚å¿µä¸äº†è§£ï¼Œä¸‹é¢å¯¹å‡ ä¸ªæœ€åŸºç¡€çš„æ¦‚å¿µè¿›è¡Œä»‹ç»ã€‚</p><h2 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h2><p>è´Ÿè½½å‡è¡¡å»ºç«‹åœ¨ç°æœ‰ç½‘ç»œç»“æ„ä¹‹ä¸Šï¼Œå®ƒæä¾›äº†ä¸€ç§å»‰ä»·æœ‰æ•ˆé€æ˜çš„æ–¹æ³•æ‰©å±•ç½‘ç»œè®¾å¤‡å’ŒæœåŠ¡å™¨çš„å¸¦å®½ã€å¢åŠ ååé‡ã€åŠ å¼ºç½‘ç»œæ•°æ®å¤„ç†èƒ½åŠ›ã€æé«˜ç½‘ç»œçš„çµæ´»æ€§å’Œå¯ç”¨æ€§ã€‚</p><p>å½“è¯·æ±‚å‘é€åˆ°ç³»ç»Ÿæ—¶ï¼Œé€šè¿‡æŸäº›æ–¹å¼æŠŠè¯·æ±‚å‡åŒ€åˆ†å‘åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œä½¿ç³»ç»Ÿä¸­æ¯ä¸ªèŠ‚ç‚¹èƒ½å¤Ÿå‡åŒ€çš„å¤„ç†è¯·æ±‚è´Ÿè½½ï¼Œåˆ™å¯è®¤ä¸ºç³»ç»Ÿæ˜¯è´Ÿè½½å‡è¡¡çš„ã€‚</p><h2 id="é«˜å¯ç”¨"><a href="#é«˜å¯ç”¨" class="headerlink" title="é«˜å¯ç”¨"></a>é«˜å¯ç”¨</h2><p>ç³»ç»Ÿä¸­éƒ¨åˆ†èŠ‚ç‚¹å¤±æ•ˆæ—¶ï¼Œå…¶ä»–èŠ‚ç‚¹èƒ½å¤Ÿæ¥æ›¿å®ƒç»§ç»­æä¾›æœåŠ¡ï¼Œåˆ™å¯è®¤ä¸ºç³»ç»Ÿå…·æœ‰é«˜å¯ç”¨æ€§ã€‚</p><h2 id="é›†ç¾¤å’Œåˆ†å¸ƒå¼"><a href="#é›†ç¾¤å’Œåˆ†å¸ƒå¼" class="headerlink" title="é›†ç¾¤å’Œåˆ†å¸ƒå¼"></a>é›†ç¾¤å’Œåˆ†å¸ƒå¼</h2><p>ä¸¤è€…å¾ˆç±»ä¼¼ï¼Œä½†æ˜¯å´æœ‰åŒºåˆ«ã€‚</p><ul><li><p>é›†ç¾¤ï¼šå°†å‡ å°æœåŠ¡å™¨é›†ä¸­åœ¨ä¸€èµ·ï¼Œå®åœ¨åŒä¸€ä¸ªä¸šåŠ¡ã€‚</p></li><li><p>åˆ†å¸ƒå¼ï¼šæŒ‡å°†ä¸åŒçš„ä¸šåŠ¡åˆ†å¸ƒåˆ°ä¸åŒçš„åœ°æ–¹ã€‚</p></li></ul><p>åˆ†å¸ƒå¼çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œéƒ½å¯ä»¥ç”¨æ¥åšé›†ç¾¤ã€‚è€Œé›†ç¾¤ä¸ä¸€å®šå°±æ˜¯åˆ†å¸ƒå¼äº†ã€‚</p><p>ä¾‹å¦‚ï¼šzk 1ä¸»2ä» æ•´ä½“æ˜¯é›†ç¾¤ ä¸šåŠ¡æ˜¯æ³¨å†Œä¸­å¿ƒ ä½†æ˜¯ä¸»èŠ‚ç‚¹å’Œ2ä¸ªä»èŠ‚ç‚¹æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ å¤„ç†ä¸åŒçš„é—®é¢˜</p><h1 id="å®ç°è´Ÿè½½å‡è¡¡çš„ç»„ä»¶åŠåŸç†"><a href="#å®ç°è´Ÿè½½å‡è¡¡çš„ç»„ä»¶åŠåŸç†" class="headerlink" title="å®ç°è´Ÿè½½å‡è¡¡çš„ç»„ä»¶åŠåŸç†"></a>å®ç°è´Ÿè½½å‡è¡¡çš„ç»„ä»¶åŠåŸç†</h1><p>ç°åœ¨ç½‘ç»œä¸­å¸¸è§çš„çš„è´Ÿè½½å‡è¡¡ä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li><p>ç¡¬ä»¶ï¼šå¸¸è§çš„ç¡¬ä»¶æœ‰æ¯”è¾ƒæ˜‚è´µçš„NetScalerã€F5ã€Radwareå’ŒArrayç­‰å•†ç”¨çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œä¸è¿‡å•†ç”¨è´Ÿè½½å‡è¡¡ç”±äºå¯ä»¥å»ºç«‹åœ¨å››~ä¸ƒå±‚åè®®ä¹‹ä¸Šï¼Œå› æ­¤é€‚ç”¨é¢æ›´å¹¿æ‰€ä»¥æœ‰å…¶ä¸å¯æ›¿ä»£æ€§ï¼Œ</p><pre><code>ä»–çš„ä¼˜ç‚¹å°±æ˜¯æœ‰ä¸“ä¸šçš„ç»´æŠ¤å›¢é˜Ÿæ¥å¯¹è¿™äº›æœåŠ¡è¿›è¡Œç»´æŠ¤ã€ç¼ºç‚¹å°±æ˜¯èŠ±é”€å¤ªå¤§ï¼Œæ‰€ä»¥å¯¹äºè§„æ¨¡è¾ƒå°çš„ç½‘ç»œæœåŠ¡æ¥è¯´æš‚æ—¶è¿˜æ²¡æœ‰éœ€è¦ä½¿ç”¨ã€‚</code></pre></li><li><p>è½¯ä»¶ï¼šæ¯”è¾ƒå¸¸è§çš„æœ‰LVSã€Nginxã€HAproxyç­‰ï¼Œ</p><pre><code>å…¶ä¸­LVSæ˜¯å»ºç«‹åœ¨å››å±‚åè®®ä¸Šé¢çš„ï¼Œè€Œå¦å¤–Nginxå’ŒHAproxyæ˜¯å»ºç«‹åœ¨ä¸ƒå±‚åè®®ä¹‹ä¸Šçš„</code></pre></li></ul><p>æœ¬æ–‡ä¸»è¦è®²è§£å¦‚ä½•é€šè¿‡è½¯ä»¶å®ç°è´Ÿè½½å‡è¡¡ã€‚</p><h2 id="ç»„ä»¶ç‰¹ç‚¹"><a href="#ç»„ä»¶ç‰¹ç‚¹" class="headerlink" title="ç»„ä»¶ç‰¹ç‚¹"></a>ç»„ä»¶ç‰¹ç‚¹</h2><h3 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h3><ul><li>å·¥ä½œåœ¨ç½‘ç»œçš„7å±‚ä¹‹ä¸Šï¼Œå¯ä»¥é’ˆå¯¹httpåº”ç”¨åšä¸€äº›åˆ†æµçš„ç­–ç•¥ï¼Œæ¯”å¦‚é’ˆå¯¹åŸŸåã€ç›®å½•ç»“æ„</li><li>Nginxå¯¹ç½‘ç»œçš„ä¾èµ–æ¯”è¾ƒå°</li><li>Nginxå®‰è£…å’Œé…ç½®æ¯”è¾ƒç®€å•ï¼Œæµ‹è¯•èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿</li><li>ä¹Ÿå¯ä»¥æ‰¿æ‹…é«˜çš„è´Ÿè½½å‹åŠ›ä¸”ç¨³å®šï¼Œä¸€èˆ¬èƒ½æ”¯æ’‘è¶…è¿‡1ä¸‡æ¬¡çš„å¹¶å‘</li><li>Nginxå¯ä»¥é€šè¿‡ç«¯å£æ£€æµ‹åˆ°æœåŠ¡å™¨å†…éƒ¨çš„æ•…éšœï¼Œæ¯”å¦‚æ ¹æ®æœåŠ¡å™¨å¤„ç†ç½‘é¡µè¿”å›çš„çŠ¶æ€ç ã€è¶…æ—¶ç­‰ç­‰ï¼Œå¹¶ä¸”ä¼šæŠŠè¿”å›é”™è¯¯çš„è¯·æ±‚é‡æ–°æäº¤åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸è¿‡å…¶ä¸­ç¼ºç‚¹å°±æ˜¯ä¸æ”¯æŒurlæ¥æ£€æµ‹ï¼›</li><li>Nginxå¯¹è¯·æ±‚çš„å¼‚æ­¥å¤„ç†å¯ä»¥å¸®åŠ©èŠ‚ç‚¹æœåŠ¡å™¨å‡è½»è´Ÿè½½ï¼›</li><li>Nginxèƒ½æ”¯æŒhttpå’ŒEmailï¼Œè¿™æ ·å°±åœ¨é€‚ç”¨èŒƒå›´ä¸Šé¢å°å¾ˆå¤šï¼›</li><li>ä¸æ”¯æŒSessionçš„ä¿æŒã€å¯¹Big requestï¼Œheaderçš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œå¦å¤–é»˜è®¤çš„åªæœ‰Round-robinå’ŒIP-hashä¸¤ç§è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚</li></ul><h3 id="lvs"><a href="#lvs" class="headerlink" title="lvs"></a>lvs</h3><ul><li>æŠ—è´Ÿè½½èƒ½åŠ›å¼ºã€æ˜¯å·¥ä½œåœ¨ç½‘ç»œ4å±‚ä¹‹ä¸Šä»…ä½œåˆ†å‘ä¹‹ç”¨ï¼Œæ²¡æœ‰æµé‡çš„äº§ç”Ÿï¼›</li><li>é…ç½®æ€§æ¯”è¾ƒä½ï¼Œè¿™æ˜¯ä¸€ä¸ªç¼ºç‚¹ä¹Ÿæ˜¯ä¸€ä¸ªä¼˜ç‚¹ï¼Œå› ä¸ºæ²¡æœ‰å¯å¤ªå¤šé…ç½®çš„ä¸œè¥¿ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦å¤ªå¤šæ¥è§¦ï¼Œå¤§å¤§å‡å°‘äº†äººä¸ºå‡ºé”™çš„å‡ ç‡ï¼›</li><li>å·¥ä½œç¨³å®šï¼Œè‡ªèº«æœ‰å®Œæ•´çš„åŒæœºçƒ­å¤‡æ–¹æ¡ˆï¼›</li><li>æ— æµé‡ï¼Œä¿è¯äº†å‡è¡¡å™¨IOçš„æ€§èƒ½ä¸ä¼šæ”¶åˆ°å¤§æµé‡çš„å½±å“ï¼›</li><li>åº”ç”¨èŒƒå›´æ¯”è¾ƒå¹¿ï¼Œå¯ä»¥å¯¹æ‰€æœ‰åº”ç”¨åšè´Ÿè½½å‡è¡¡ï¼›</li><li>LVSéœ€è¦å‘IDCå¤šç”³è¯·ä¸€ä¸ªIPæ¥åšVisual IPï¼Œå› æ­¤éœ€è¦ä¸€å®šçš„ç½‘ç»œçŸ¥è¯†ï¼Œæ‰€ä»¥å¯¹æ“ä½œäººçš„è¦æ±‚æ¯”è¾ƒé«˜ã€‚</li></ul><h3 id="HAProxy"><a href="#HAProxy" class="headerlink" title="HAProxy"></a>HAProxy</h3><ul><li>HAProxyæ˜¯å·¥ä½œåœ¨ç½‘ç»œ7å±‚ä¹‹ä¸Šã€‚</li><li>èƒ½å¤Ÿè¡¥å……Nginxçš„ä¸€äº›ç¼ºç‚¹æ¯”å¦‚Sessionçš„ä¿æŒï¼ŒCookieçš„å¼•å¯¼ç­‰å·¥ä½œ</li><li>æ”¯æŒurlæ£€æµ‹åç«¯çš„æœåŠ¡å™¨å‡ºé—®é¢˜çš„æ£€æµ‹ä¼šæœ‰å¾ˆå¥½çš„å¸®åŠ©ã€‚</li><li>æ›´å¤šçš„è´Ÿè½½å‡è¡¡ç­–ç•¥æ¯”å¦‚ï¼šåŠ¨æ€åŠ æƒè½®å¾ª(Dynamic Round Robin)ï¼ŒåŠ æƒæºåœ°å€å“ˆå¸Œ(Weighted Source Hash)ï¼ŒåŠ æƒURLå“ˆå¸Œå’ŒåŠ æƒå‚æ•°å“ˆå¸Œ(Weighted Parameter Hash)å·²ç»å®ç°</li><li>å•çº¯ä»æ•ˆç‡ä¸Šæ¥è®²HAProxyæ›´ä¼šæ¯”Nginxæœ‰æ›´å‡ºè‰²çš„è´Ÿè½½å‡è¡¡é€Ÿåº¦ã€‚</li><li>HAProxyå¯ä»¥å¯¹Mysqlè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå¯¹åç«¯çš„DBèŠ‚ç‚¹è¿›è¡Œæ£€æµ‹å’Œè´Ÿè½½å‡è¡¡ã€‚</li></ul><h3 id="traefik"><a href="#traefik" class="headerlink" title="traefik"></a>traefik</h3><ul><li>Golangç¼–å†™ï¼Œå•æ–‡ä»¶éƒ¨ç½²ï¼Œä¸ç³»ç»Ÿæ— å…³ï¼ŒåŒæ—¶ä¹Ÿæä¾›å°å°ºå¯¸Dockeré•œåƒã€‚</li><li>æ”¯æŒDocker/Etcdåç«¯ï¼Œå¤©ç„¶è¿æ¥æˆ‘ä»¬çš„å¾®æœåŠ¡é›†ç¾¤ã€‚</li><li>å†…ç½®Web UIï¼Œç®¡ç†ç›¸å¯¹æ–¹ä¾¿ã€‚</li><li>è‡ªåŠ¨é…ç½®ACME(Letâ€™s Encrypt)è¯ä¹¦åŠŸèƒ½ã€‚</li><li>æ€§èƒ½å°šå¯ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰åˆ°å‹æ¦¨LBæ€§èƒ½çš„é˜¶æ®µï¼Œæ˜“ç”¨æ€§æ›´é‡è¦ã€‚</li><li>Restful APIæ”¯æŒã€‚</li><li>æ”¯æŒåç«¯å¥åº·çŠ¶æ€æ£€æŸ¥ï¼Œæ ¹æ®çŠ¶æ€è‡ªåŠ¨é…ç½®ã€‚</li><li>æ”¯æŒWebSocketå’ŒHTTP/2ã€‚</li><li>traefikè¿‘å‡ å¹´ç«èµ·æ¥æœ€é‡è¦çš„åŸå› ä¹‹ä¸€å°±æ˜¯èƒ½å¤Ÿä¸å¸¸è§çš„å¾®æœåŠ¡ç³»ç»Ÿç›´æ¥æ•´åˆï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åŒ–åŠ¨æ€é…ç½®ã€‚</li></ul><p>ä¸‹é¢ç”¨ä¸€å›¾è¯´æ˜traefikçš„ç‰¹ç‚¹<br><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/SLB/traefik.jpg"  alt="traefik.jpg"></p><h2 id="ä¸»æµç®—æ³•"><a href="#ä¸»æµç®—æ³•" class="headerlink" title="ä¸»æµç®—æ³•"></a>ä¸»æµç®—æ³•</h2><ul><li>è½®è¯¢è°ƒåº¦(Round Robin ç®€ç§°â€™RRâ€™) å°±æ˜¯æŒ‰ä¾æ¬¡å¾ªç¯çš„æ–¹å¼å°†è¯·æ±‚è°ƒåº¦åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œè¯¥ç®—æ³•æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å®ç°ç®€å•ã€‚è½®è¯¢ç®—æ³•å‡è®¾æ‰€æœ‰çš„æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„èƒ½åŠ›éƒ½ä¸€æ ·çš„ï¼Œè°ƒåº¦å™¨ä¼šå°†æ‰€æœ‰çš„è¯·æ±‚å¹³å‡åˆ†é…ç»™æ¯ä¸ªçœŸå®æœåŠ¡å™¨ã€‚</li><li>åŠ æƒè½®è¯¢(Weight Round Robin ç®€ç§°â€™WRRâ€™) ä¸»è¦æ˜¯å¯¹è½®è¯¢ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ä¸è¡¥å……ï¼Œä¼ å…¥çš„è¯·æ±‚æŒ‰é¡ºåºè¢«åˆ†é…åˆ°é›†ç¾¤ä¸­æœåŠ¡å™¨ï¼Œä½†æ˜¯ä¼šè€ƒè™‘æå‰ä¸ºæ¯å°æœåŠ¡å™¨åˆ†é…çš„æƒé‡ã€‚ä¾‹å¦‚ï¼Œèƒ½åŠ›æœ€å¼ºçš„æœåŠ¡å™¨Aç»™çš„æƒé‡æ˜¯100ï¼ŒåŒæ—¶èƒ½åŠ›æœ€ä½çš„æœåŠ¡å™¨ç»™çš„æƒé‡æ˜¯50ã€‚è¿™æ„å‘³ç€åœ¨æœåŠ¡å™¨Bæ¥æ”¶åˆ°ç¬¬ä¸€ä¸ª è¯·æ±‚ä¹‹å‰å‰ï¼ŒæœåŠ¡å™¨Aä¼šè¿ç»­çš„æ¥å—åˆ°2ä¸ªè¯·æ±‚ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li><li>éšæœºï¼ˆRandomï¼‰<br>é€šè¿‡ç³»ç»Ÿçš„éšæœºç®—æ³•ï¼Œæ ¹æ®åç«¯æœåŠ¡å™¨çš„åˆ—è¡¨å¤§å°å€¼æ¥éšæœºé€‰å–å…¶ä¸­çš„ä¸€å°æœåŠ¡å™¨è¿›è¡Œè®¿é—®ã€‚åŸºäºæ¦‚ç‡ç»Ÿè®¡çš„ç†è®ºï¼Œååé‡è¶Šå¤§ï¼Œéšæœºç®—æ³•çš„æ•ˆæœè¶Šæ¥è¿‘äºè½®è¯¢ç®—æ³•çš„æ•ˆæœã€‚</li><li>åŠ æƒéšæœºï¼ˆWeight Randomï¼‰<br>ä¸åŠ æƒè½®è¯¢æ³•ä¸€æ ·ï¼ŒåŠ æƒéšæœºæ³•ä¹Ÿæ ¹æ®åç«¯æœºå™¨çš„é…ç½®ï¼Œç³»ç»Ÿçš„è´Ÿè½½åˆ†é…ä¸åŒçš„æƒé‡ã€‚ä¸åŒçš„æ˜¯ï¼Œå®ƒæ˜¯æŒ‰ç…§æƒé‡éšæœºè¯·æ±‚åç«¯æœåŠ¡å™¨ï¼Œè€Œéé¡ºåºã€‚</li><li>æœ€å°‘è¿æ¥æ•°(Least Connection)<br>ä»¥ä¸Šä¸¤ç§æ–¹æ³•éƒ½æ²¡æœ‰è€ƒè™‘çš„æ˜¯ç³»ç»Ÿä¸èƒ½è¯†åˆ«åœ¨ç»™å®šçš„æ—¶é—´é‡Œä¿æŒäº†å¤šå°‘è¿æ¥ã€‚æœ€å°è¿æ¥æ•°ç®—æ³•æ¯”è¾ƒçµæ´»å’Œæ™ºèƒ½ï¼Œç”±äºåç«¯æœåŠ¡å™¨çš„é…ç½®ä¸å°½ç›¸åŒï¼Œå¯¹äºè¯·æ±‚çš„å¤„ç†æœ‰å¿«æœ‰æ…¢ï¼Œå®ƒæ˜¯æ ¹æ®åç«¯æœåŠ¡å™¨å½“å‰çš„è¿æ¥æƒ…å†µï¼ŒåŠ¨æ€åœ°é€‰å–å…¶ä¸­å½“å‰ç§¯å‹è¿æ¥æ•°æœ€å°‘çš„ä¸€å°æœåŠ¡å™¨æ¥å¤„ç†å½“å‰çš„è¯·æ±‚ï¼Œå°½å¯èƒ½åœ°æé«˜åç«¯æœåŠ¡çš„åˆ©ç”¨æ•ˆç‡ï¼Œå°†è´Ÿè´£åˆç†åœ°åˆ†æµåˆ°æ¯ä¸€å°æœåŠ¡å™¨ã€‚</li><li>æºIPå“ˆå¸Œ(Source IP Hash) æºåœ°å€å“ˆå¸Œçš„æ€æƒ³æ˜¯æ ¹æ®è·å–å®¢æˆ·ç«¯çš„IPåœ°å€ï¼Œé€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—å¾—åˆ°çš„ä¸€ä¸ªæ•°å€¼ï¼Œç”¨è¯¥æ•°å€¼å¯¹æœåŠ¡å™¨åˆ—è¡¨çš„å¤§å°è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œå¾—åˆ°çš„ç»“æœä¾¿æ˜¯å®¢æˆ·ç«¯è¦è®¿é—®æœåŠ¡å™¨çš„åºå·ã€‚</li></ul><h1 id="å¢å¼ºè´Ÿè½½å‡è¡¡å™¨å¯ç”¨æ€§ï¼ˆHAï¼‰"><a href="#å¢å¼ºè´Ÿè½½å‡è¡¡å™¨å¯ç”¨æ€§ï¼ˆHAï¼‰" class="headerlink" title="å¢å¼ºè´Ÿè½½å‡è¡¡å™¨å¯ç”¨æ€§ï¼ˆHAï¼‰"></a>å¢å¼ºè´Ÿè½½å‡è¡¡å™¨å¯ç”¨æ€§ï¼ˆHAï¼‰</h1><h2 id="ä»€ä¹ˆæ˜¯keepalived"><a href="#ä»€ä¹ˆæ˜¯keepalived" class="headerlink" title="ä»€ä¹ˆæ˜¯keepalived"></a>ä»€ä¹ˆæ˜¯keepalived</h2><p>Keepalivedæ˜¯ç”¨Cè¯­è¨€ç¼–å†™çš„è·¯ç”±è½¯ä»¶ã€‚è¯¥é¡¹ç›®çš„ä¸»è¦ç›®æ ‡æ˜¯ä¸ºLinuxç³»ç»Ÿå’ŒåŸºäºLinuxçš„åŸºç¡€ç»“æ„æä¾›è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§çš„ç®€å•è€Œå¼ºå¤§çš„åŠŸèƒ½ã€‚Keepalivedå®ç°äº†ä¸€ç»„æ£€æŸ¥å™¨ï¼Œä»¥æ ¹æ®å…¶è¿è¡ŒçŠ¶å†µåŠ¨æ€ï¼Œè‡ªé€‚åº”åœ°ç»´æŠ¤å’Œç®¡ç†è´Ÿè½½å¹³è¡¡çš„æœåŠ¡å™¨æ± ã€‚å¦ä¸€æ–¹é¢ï¼ŒVRRPå®ç°äº†é«˜å¯ç”¨æ€§åè®®ã€‚VRRPæ˜¯è·¯ç”±å™¨æ•…éšœè½¬ç§»çš„åŸºç¡€ç –ã€‚æ­¤å¤–ï¼ŒKeepalivedè¿˜å®ç°äº†ä¸€ç»„VRRPæœ‰é™çŠ¶æ€æœºçš„æŒ‚é’©ï¼Œä»è€Œæä¾›äº†ä½çº§å’Œé«˜é€Ÿåè®®äº¤äº’ã€‚</p><h2 id="VRRPåè®®"><a href="#VRRPåè®®" class="headerlink" title="VRRPåè®®"></a>VRRPåè®®</h2><p>è™šæ‹Ÿè·¯ç”±å™¨å†—ä½™åè®®ï¼ˆVirtual Router Redundancy Protocol ï¼‰</p><p>VRRPæ˜¯ä¸€ç§é€‰æ‹©åè®®ï¼Œå®ƒå¯ä»¥æŠŠä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨çš„è´£ä»»åŠ¨æ€åˆ†é…åˆ°å±€åŸŸç½‘ä¸Šçš„ VRRP è·¯ç”±å™¨ä¸­çš„ä¸€å°ã€‚æ§åˆ¶è™šæ‹Ÿè·¯ç”±å™¨ IP åœ°å€çš„ VRRP è·¯ç”±å™¨ç§°ä¸ºä¸»è·¯ç”±å™¨ï¼Œå®ƒè´Ÿè´£è½¬å‘æ•°æ®åŒ…åˆ°è¿™äº›è™šæ‹Ÿ IP åœ°å€ã€‚</p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>keepalivedä¹Ÿæ˜¯æ¨¡å—åŒ–è®¾è®¡ï¼Œä¸åŒæ¨¡å—å¤æ‚ä¸åŒçš„åŠŸèƒ½ï¼Œä¸‹é¢æ˜¯keepalivedçš„ç»„ä»¶</p><p>core check vrrp libipfwc libipvs-2.4 libipvs-2.6</p><ul><li>coreï¼šæ˜¯keepalivedçš„æ ¸å¿ƒï¼Œå¤æ‚ä¸»è¿›ç¨‹çš„å¯åŠ¨å’Œç»´æŠ¤ï¼Œå…¨å±€é…ç½®æ–‡ä»¶çš„åŠ è½½è§£æç­‰</li><li>checkï¼šè´Ÿè´£healthchecker(å¥åº·æ£€æŸ¥)ï¼ŒåŒ…æ‹¬äº†å„ç§å¥åº·æ£€æŸ¥æ–¹å¼ï¼Œä»¥åŠå¯¹åº”çš„é…ç½®çš„è§£æåŒ…æ‹¬LVSçš„é…ç½®è§£æ</li><li>vrrpï¼šVRRPDå­è¿›ç¨‹ï¼ŒVRRPDå­è¿›ç¨‹å°±æ˜¯æ¥å®ç°VRRPåè®®çš„</li><li>libipfwcï¼šiptables(ipchains)åº“ï¼Œé…ç½®LVSä¼šç”¨åˆ°</li><li>libipvs*ï¼šé…ç½®LVSä¼šç”¨åˆ°</li></ul><p>keepalivedå¯åŠ¨åä¼šæœ‰ä¸‰ä¸ªè¿›ç¨‹<br>çˆ¶è¿›ç¨‹ï¼šå†…å­˜ç®¡ç†ï¼Œå­è¿›ç¨‹ç®¡ç†ç­‰ç­‰<br>å­è¿›ç¨‹ï¼šVRRPå­è¿›ç¨‹<br>å­è¿›ç¨‹ï¼šhealthcheckerså­è¿›ç¨‹</p><h1 id="è®¾è®¡nginx-keepalived-nacos-mysqlå®ç°é…ç½®åŠæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨æ¡†æ¶"><a href="#è®¾è®¡nginx-keepalived-nacos-mysqlå®ç°é…ç½®åŠæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨æ¡†æ¶" class="headerlink" title="è®¾è®¡nginx+keepalived+nacos+mysqlå®ç°é…ç½®åŠæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨æ¡†æ¶"></a>è®¾è®¡nginx+keepalived+nacos+mysqlå®ç°é…ç½®åŠæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨æ¡†æ¶</h1><p>æœ¬æ–‡è®¾è®¡çš„æ¡†æ¶æ˜¯åŸºäºnacoså®˜æ–¹æ–‡æ¡£é’ˆå¯¹ç”Ÿäº§ç¯å¢ƒçš„nacosæ­å»ºçš„è¡¥å……ã€‚</p><p>naocsæ¡†æ¶ä¸º<br><a href="http://nacos.com:port/openAPI">http://nacos.com:port/openAPI</a> åŸŸå + VIPæ¨¡å¼ï¼Œå¯è¯»æ€§å¥½ï¼Œè€Œä¸”æ¢ipæ–¹ä¾¿</p><p>nginxä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ï¼Œkeepalivedä¿è¯nginxçš„é«˜å¯ç”¨</p><p>å…·ä½“å®ç°å¦‚å›¾<br><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/SLB/nacos_ha.jpg"  alt="nacos_ha.jpg"></p><p>æœ¬æœŸä¸åšéƒ¨ç½²è¯´æ˜ï¼Œä¸‹æœŸå…·ä½“è¯´æ˜å¦‚ä½•åœ¨å®æˆ˜ä¸­éƒ¨ç½²æ­¤æ¶æ„ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="http://thesecretlivesofdata.com/raft/" target="_blank" rel="noopener">åˆ†å¸ƒå¼å…±è¯†ç®—æ³•å›¾è§£</a></p><p><a href="https://blog.csdn.net/cc1949/article/details/79063439" target="_blank" rel="noopener">ç½‘ç»œ7å±‚åè®®å›¾è§£</a></p><p><a href="https://blog.csdn.net/liuxl57805678/article/details/103033268" target="_blank" rel="noopener">æ·˜å®åŒ11ï¼Œäº¿çº§æµé‡é«˜å¹¶å‘æ˜¯æ€ä¹ˆæŠ—ä½çš„ï¼Ÿçœ‹å®Œè¿™ç¯‡ä½ å°±æ˜ç™½äº†!</a></p><p><a href="https://blog.csdn.net/selina361/article/details/79949689?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.nonecase" target="_blank" rel="noopener">å‡ ç§å¸¸è§è´Ÿè½½å‡è¡¡æ¯”è¾ƒ</a></p><p><a href="https://www.keepalived.org/" target="_blank" rel="noopener">keepalivedå®˜ç½‘</a></p><p><a href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html" target="_blank" rel="noopener">nacoså®˜ç½‘</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> SLB </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nacos </tag>
            
            <tag> SLB </tag>
            
            <tag> è´Ÿè½½å‡è¡¡ </tag>
            
            <tag> Keepalived </tag>
            
            <tag> HA </tag>
            
            <tag> Cluster </tag>
            
            <tag> è°ƒåº¦ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¡¶çº§ç†è§£ä¹‹æ¸¸æˆäººç”Ÿï¼ˆDNFç¯‡ï¼‰</title>
      <link href="/2020/05/09/king/king-dnf/"/>
      <url>/2020/05/09/king/king-dnf/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜: é¡¶çº§ç†è§£ç³»åˆ—å…¨éƒ¨æ˜¯æœ¬äººçš„ä¸»è§‚çœ‹æ³•ï¼Œæœ›ä¸å–œå‹¿å–·ï¼Œæ±‚åŒå­˜å¼‚ã€‚</p><hr><p>æœ¬æ–‡åˆ†äº«äº†å®‡ç¥ä¹‹æ¯åœ¨DNFé‡Œçš„ç»å†ï¼Œæ˜ å°„ä¸€ä¸ªäººçš„æˆé•¿ç»å†ã€‚</p><p>å¼€å±€å…ˆå£°æ˜æˆ‘çš„DNFæ¸¸æˆå¹´é¾„ï¼Œ10å¹´ï¼Œ2009-2019ã€‚</p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/King/dnf.png"  alt="dnf.png"></p><p>æ²¡ä»å¤´å…¥å‘ï¼Œä¹Ÿæ²¡èƒ½ç­‰åˆ°å…³æœå°±ç¦»å¼€ã€‚</p><h1 id="æ¸¸æˆé˜¶æ®µ"><a href="#æ¸¸æˆé˜¶æ®µ" class="headerlink" title="æ¸¸æˆé˜¶æ®µ"></a>æ¸¸æˆé˜¶æ®µ</h1><p>æˆ‘ç©dnfå¯ä»¥åˆ†ä¸º3ä¸ªé˜¶æ®µ</p><ul><li>å¼€å¿ƒé˜¶æ®µ</li><li>å¥‹æ–—é˜¶æ®µ</li><li>ç–²ç´¯é˜¶æ®µ</li></ul><p>å¦‚æœä½ å¯¹dnfä¸æ„Ÿå…´è¶£ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡è¿™å‡ ä¸ªé˜¶æ®µï¼Œç›´å¥”ç»“è®ºã€‚ã€‚ã€‚</p><h2 id="å¼€å¿ƒé˜¶æ®µ"><a href="#å¼€å¿ƒé˜¶æ®µ" class="headerlink" title="å¼€å¿ƒé˜¶æ®µ"></a>å¼€å¿ƒé˜¶æ®µ</h2><p>å¼€å§‹é˜¶æ®µæˆ‘è®¤ä¸ºæœ€æè‡´çš„æ¸¸æˆï¼Œæœ€çº¯ç²¹çš„äº«å—ç©æ¸¸æˆçš„è¿‡ç¨‹ã€‚</p><p>è¿™ä¸ªé˜¶æ®µåº”è¯¥éƒ½æ˜¯è€ç©å®¶æ‰æœ‰çš„ä½“éªŒï¼Œå¯¹äº2018å¹´åå…¥å‘çš„ç©å®¶ä»¬å¯èƒ½æ„Ÿå—ä¸åˆ°ã€‚</p><p>60-85ç‰ˆæœ¬çš„ä¹è¶£åœ¨äºï¼Œæ‰“æ€ªå‡çº§ã€çˆ†è£…å¤‡ã€å¸ˆå¾’å…³ç³»ã€æˆå°±æ„Ÿç­‰ç­‰ã€‚</p><ul><li>é‚£ä¸ªæ—¶ä»£æ»¡çº§æ¯”è¾ƒéš¾ï¼Œä¸å’Œç°åœ¨ä¸€æ ·ï¼Œéšä¾¿åˆ›æ–°å·åˆ°æ»¡çº§ä¸€å¤©å°±å¯ä»¥å®Œæˆã€‚</li><li>è£…å¤‡çš„çˆ†ç‡ä½ï¼Œssæ›´æ˜¯éš¾å¾—æœ‰ä¸€ä»¶ï¼Œå› ä¸ºæ·±æ¸Šéƒ½æ‰“ä¸èµ¢ï¼Œèƒ½å‡ºç´«å¥—è£…ã€ç²‰è£…éƒ½å¯ä»¥é«˜å…´å¾ˆä¹…å¾ˆä¹…ï¼Œçº¯ç²¹çš„å¿«ä¹</li><li>æ‹œå¸ˆå¸¦äººåˆ·å›¾ï¼Œ50å¤šçº§çš„å¸¦30å¤šçº§çš„åˆ·å›¾æ‰“ä¸è¿‡ä¹Ÿå¾ˆæ­£å¸¸ï¼Œæ€ªç‰©è¡€é‡é«˜ï¼Œä¼¤å®³é«˜ï¼Œä¸åƒç°åœ¨ç§’ç§’ç§’ã€‚</li><li>é‚£æ—¶å€™çš„DNFå®Œæˆè¿™äº›äº‹æœ€å¤§çš„ä¹è¶£å°±æ˜¯è·å¾—æˆå°±æ„Ÿï¼Œæ˜¯å…¶ä»–è¡—æœºæ¸¸æˆæ‰€ä¸èƒ½æ¯”æ‹Ÿçš„</li></ul><h2 id="å¥‹æ–—é˜¶æ®µ"><a href="#å¥‹æ–—é˜¶æ®µ" class="headerlink" title="å¥‹æ–—é˜¶æ®µ"></a>å¥‹æ–—é˜¶æ®µ</h2><p>å¥‹æ–—é˜¶æ®µå¾—ä»æˆ‘å¤§å­¦å®¤å‹ç½—æŸæ‹‰æˆ‘å›å‘è¯´èµ·äº†ï¼Œå½“æ—¶åˆšåˆšå®‰å›¾æ©å‰¯æœ¬å·²ç»å¼€äº†ä¸€å¹´å¤šäº†ï¼Œä½†æ˜¯ç”±äºssæ²¡æœ‰æ™®åŠï¼Œå³ä½¿è¿‡äº†ä¸€å¹´ï¼Œèƒ½æ‰“å›¢æœ¬çš„äººä»ç„¶å¾ˆå°‘ã€‚æˆ‘ä»è¿™ä¸ªæ—¶å€™å¼€å§‹æ‰“é€ è‡ªå·±å·²ç»è„±å‘4å¹´çš„å·ï¼Œä»å¼‚ç•Œæ‰“èµ·ï¼Œæˆ‘çš„çå­å¼€å§‹åšæš—å½±ä¹ï¼Œæ‰“èˆ°ç‚®ï¼›åšå‡çŒª6ï¼Œå®ˆéœ‡é¢¤ï¼›é‚£ä¸€å¹´æ˜¥èŠ‚ï¼Œä¹°ä¸€å¥—å¹´å¥—ï¼Œæœ‰äº†å¹´å® ï¼Œå¼€å§‹æ‰“æ“å¤©ï¼›åˆ°åé¢åˆ·æ·±æ¸Šç»ˆäºé›†é½é­”æˆ˜å¥—ï¼Œå¼€å§‹æ‰“ç«å±±ã€‚ç­‰åˆ°å¢å…‹å‰¯æœ¬å¼€äº†åï¼Œæˆ‘å°±æˆä¸ºç¬¬ä¸€æ‰¹å¼€è’äººå‘˜ï¼Œæ‰“äº†ä¸€å¹´å‰¯æœ¬æ¯•ä¸šã€‚</p><hr><p>å¼€å§‹<br><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/King/kaihuang.png"  alt="kaihuang.png"><br>ç»“æŸ<br><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/King/luke.png"  alt="luke.png"></p><hr><p>å°±å’Œæˆ‘è¯´è¯´é‡Œä¸€æ ·ï¼Œä¸€å¹´çš„æ—¶é—´å¢å…‹å…¨å‹¤ï¼Œä¸€æ¬¡ä¸æ¼ï¼Œå› ä¸ºæˆ‘çƒ­çˆ±è¿™ä¸ªæ¸¸æˆï¼Œæ‰€ä»¥æˆ‘èƒ½åšæŒä¸‹æ¥ã€‚</p><h2 id="ç–²ç´¯é˜¶æ®µ"><a href="#ç–²ç´¯é˜¶æ®µ" class="headerlink" title="ç–²ç´¯é˜¶æ®µ"></a>ç–²ç´¯é˜¶æ®µ</h2><p>ä»95çº§å¼€å§‹ï¼Œè¶…æ—¶ç©ºæ¼©æ¶¡ã€ä¼Šè¥¿æ–¯å‰¯æœ¬ï¼Œç­–åˆ’ä¼¼ä¹å·²ç»è§‰å¾—dnfæ¨¡å¼å°±æ˜¯å¦‚æ­¤äº†ï¼Œæ‰“å›¢æœ¬ï¼Œå‡çº§è£…å¤‡ï¼Œå†å‡ºæ–°å›¢æœ¬ï¼Œå†å‡çº§æ–°è£…å¤‡ã€‚ä¸€ç›´å¦‚æ­¤çš„æ¨¡å¼å¯¼è‡´dnfç©å®¶æµé€çš„è¶Šæ¥è¶Šå¤šï¼Œå› ä¸ºå‰¯æœ¬ä¸å†åƒä»¥å‰é‚£ä¹ˆéš¾ï¼Œç”šè‡³åˆ°äº†ä¸€å‡ºå¤§å‰¯æœ¬å½“å¤©å°±æœ‰é‡‘å›¢ï¼ˆèŠ±é’±ï¼Œå¸¦äººçš„å›¢ï¼‰å‡ºç°ã€‚</p><p>è€Œä¸”ä»¥å‰æŠ•å…¥å°‘ï¼Œæ”¶è·å¤šï¼Œç°åœ¨æŠ•å…¥å¤šï¼Œæ”¶è·å°‘ã€‚è¯´ä¸ªå¾ˆç®€å•çš„é“ç†ï¼Œé©¬æœç‰¹è‰²ï¼šç”¨è–ªåˆ›é€ æ¸¸æˆï¼Œæ²¡é’±ç©ä¸ªæ¯›ã€‚<br><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/King/chongqian.jpg"  alt="chongqian.jpg"></p><ul><li><p>ä»¥å‰æŠ•å…¥åŸºæœ¬ä¸Šåªæœ‰æ—¶é—´ï¼Œå……é’±åªæ˜¯æ¬¡è¦çš„ï¼Œä½ å°±å¯ä»¥æ„‰å¿«çš„æ¸¸æˆï¼Œåˆ·å›¾ï¼Œpkï¼Œå……åˆ†ä½“éªŒæ¸¸æˆä¹è¶£</p></li><li><p>ç°åœ¨ä½ ä¸ä»…è¦è‚ï¼Œæ›´è¦æ°ªï¼Œä¸ç„¶å›¢æœ¬æ²¡äººè¦ä½ ï¼Œpkä½ è£…å¤‡åƒåœ¾ï¼ŒæŠ€æœ¯å†å¥½ä¹Ÿå¾ˆå®¹æ˜“ä¸€ä¸ªå¤±è¯¯å°±ç›´æ¥è¢«äººä¸€ä¸ªæŠ€èƒ½ç§’äº†ï¼ˆæ—­æ—­å®å®å¤§è¹¦ç§’äººï¼‰ï¼Œå†æ‹¿å‡ºä¹Œé¾Ÿå¢å…‹æ—¶æœŸå¾ˆæµè¡Œçš„ä¸€å¹…å›¾ã€‚</p></li></ul><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/King/jiaban.jpg"  alt="jiaban.jpg"></p><h1 id="ä¸€å¶çŸ¥ç§‹"><a href="#ä¸€å¶çŸ¥ç§‹" class="headerlink" title="ä¸€å¶çŸ¥ç§‹"></a>ä¸€å¶çŸ¥ç§‹</h1><p>é˜¿æ‹‰å¾·å¤§é™†ä¹Ÿå¯ä»¥æ˜¯ç°å®æŸä¸€éƒ¨åˆ†çš„æ˜ å°„ã€‚</p><h2 id="é˜¶æ®µ"><a href="#é˜¶æ®µ" class="headerlink" title="é˜¶æ®µ"></a>é˜¶æ®µ</h2><p>åœ¨dnfé‡Œçš„å›¢æœ¬æ—¶æœŸåˆ†ä¸º4ä¸ªé˜¶æ®µï¼šå¼€è’å›¢ã€ç¨³å®šå›¢ã€æµæ°´å›¢ã€é‡‘å›¢ã€‚</p><p>è¿™ä¸ªå’Œç°å®ä¸­æŸä¸€è¡Œä¸šçš„å‘å±•æ—¶æœŸå¾ˆåƒï¼Œå¤šçš„ä¹Ÿä¸æ‰¯ï¼Œå°±æ‹¿äº’è”ç½‘è¡Œä¸šæ¥è¯´ã€‚</p><h3 id="å¼€è’é˜¶æ®µï¼š"><a href="#å¼€è’é˜¶æ®µï¼š" class="headerlink" title="å¼€è’é˜¶æ®µï¼š"></a>å¼€è’é˜¶æ®µï¼š</h3><ul><li>dnfï¼šæ‰€æœ‰æˆå‘˜æ‰“é€ æœ€é¡¶å°–è£…å¤‡ï¼Œç»ƒä¹ ä¸åŒèŒä¸šçš„æ‰‹æ³•åˆ°æè‡´ï¼Œå­¦ä¹ å‰¯æœ¬çš„æœºåˆ¶</li><li>äº’è”ç½‘ï¼šæœ€å¥½çš„å¤§å­¦çš„å­¦ç”Ÿï¼Œå­¦ä¹ äº’è”ç½‘çŸ¥è¯†ï¼ŒæŠŠå›½å¤–æœ€é¡¶å°–çš„æŠ€æœ¯å¼•å›å›½å†…</li></ul><p>å½“å¼€è’æˆåŠŸåï¼Œè¿™ä¸€é¢†åŸŸçš„äººä»¬é›†åˆèµ·æ¥åˆ›ç«‹äº†ä¸åŒçš„å›¢é˜Ÿã€å…¬å¸ï¼Œæœ‰å¤§æœ‰å°ï¼Œè‰¯è ä¸é½ã€‚</p><h3 id="ç¨³å®šé˜¶æ®µï¼š"><a href="#ç¨³å®šé˜¶æ®µï¼š" class="headerlink" title="ç¨³å®šé˜¶æ®µï¼š"></a>ç¨³å®šé˜¶æ®µï¼š</h3><ul><li>dnfï¼šä¸ºäº†å°†å›¢é˜Ÿæ‰©å±•å¤§ï¼Œå›¢æœ¬å¼€å§‹å¤§é¢ç§¯æ‹›äººï¼Œè®©è‡ªå·±çš„å°å·ä¹Ÿèƒ½åˆ’æ°´ã€‚</li><li>äº’è”ç½‘ï¼šæœ€æ—©çš„ä¸€æ‰¹åˆ›ä¸šè€…åˆ›ä¸šç¨³å®šåï¼Œå¼€å§‹å¤§é¢ç§¯æ‹›æ½äººæ‰ä¸ºè‡ªå·±æ‰“å·¥ï¼Œè¿™ä¹Ÿæ˜¯ç›®å‰äº’è”ç½‘çš„ç°çŠ¶ã€‚</li></ul><h3 id="æµæ°´é˜¶æ®µï¼š"><a href="#æµæ°´é˜¶æ®µï¼š" class="headerlink" title="æµæ°´é˜¶æ®µï¼š"></a>æµæ°´é˜¶æ®µï¼š</h3><ul><li>dnfï¼šå›¢é˜Ÿæ‰©å¤§åˆ°ä¸€å®šåœ°æ­¥åï¼Œç”±äºäººå¤ªå¤šäº†ï¼Œéœ€è¦é€‰å‡ ä¸ªå›¢é•¿ï¼Œæ¯ä¸ªå›¢é•¿éƒ½å¼€å›¢è‹¥å¹²ä¸ªå°æ—¶ï¼Œç”šè‡³åŒæ—¶å¼€å¤šä¸ªå›¢æœ¬ï¼Œç”±äºå›¢é˜Ÿå¾ˆå¤§ï¼Œæ‰“å›¢ä¸æ€•æ²¡äººæ¥ï¼Œéª—å¥¶éª—cï¼Œè‡ªå·±åˆ’æ°´çš„ç°è±¡æ¯”æ¯”çš†æ˜¯ã€‚</li><li>äº’è”ç½‘ï¼šä¼ä¸šè¶Šæ‰©è¶Šå¤§ï¼Œå¼€å§‹æˆç«‹åˆ†å…¬å¸ï¼Œè®©å¼€è’çš„äººéƒ½å½“è€æ¿ï¼Œå…¸å‹çš„BATï¼Œè€Œä¸”åå£°å¤§ï¼Œä¸æ€•æ²¡äººæ¥ã€‚</li></ul><h3 id="é‡‘å›¢ï¼š"><a href="#é‡‘å›¢ï¼š" class="headerlink" title="é‡‘å›¢ï¼š"></a>é‡‘å›¢ï¼š</h3><ul><li>dnfï¼šé‡‘å›¢å°±æ˜¯äº’è”ç½‘çš„åŸ¹è®­æœºæ„ï¼Œæ¯”å¦‚æŸé©¬ç¨‹åºå‘˜ï¼Œä¸ºäº†èƒ½è¾¾åˆ°è¿›å…¥è¿™äº›é¢†åŸŸçš„é—¨æ§›ï¼Œä½ éœ€è¦èŠ±é’±æ¥è¿‡å›¾/å­¦ä¹ ã€‚</li></ul><h2 id="é—¨æ§›"><a href="#é—¨æ§›" class="headerlink" title="é—¨æ§›"></a>é—¨æ§›</h2><p>é˜¶æ®µè¯´æ¸…æ¥šäº†åï¼Œå†è¯´é—¨æ§›é—®é¢˜ã€‚æˆ‘çš„ç†è§£ï¼šé—¨æ§›å°±æ˜¯ä½ è¿›å…¥æŸä¸€è¡Œä¸šçš„æœ€ä½æ ‡å‡†ã€‚</p><p>dnfçš„å›¢æœ¬å‘å±•éƒ½ä»¥æµæ°´å›¢ã€é‡‘å›¢çš„å¤§è§„æ¨¡å‡ºç°è€Œå±•ç°å‡ºæ¸¸æˆæœ€è¾‰ç…Œçš„æ—¶å€™ã€‚å› ä¸ºæµæ°´å›¢æ‰“çš„è¶Šå¿«ï¼Œå¥–åŠ±è¶Šå¤šã€‚æµæ°´å›¢æ¯æ¬¡ç”³è¯·çš„äººé‚£ä¹ˆå¤šï¼Œä½œä¸ºå›¢é•¿æ€ä¹ˆé€‰æ‹©ï¼Ÿè‚¯å®šæ˜¯è£…å¤‡è¶Šå¥½ï¼Œå›¢æœ¬é€šå…³æ¬¡æ•°è¶Šå¤šçš„äººè¶Šä¼˜å…ˆæ”¾è¿›å›¢é˜¿ï¼Œè¿™å°±æ˜¯é—¨æ§›ã€‚ä½†æ˜¯ä½ å¦‚æœæ²¡æœ‰è£…å¤‡ï¼Œåˆæƒ³ä½“éªŒæ‰“å›¢çš„ä¹è¶£ï¼Œæ€ä¹ˆåŠï¼Ÿä½ åªèƒ½åé‡‘å›¢æˆ–è€…pyï¼ˆå¼€ç©ç¬‘ï¼‰ï¼Œæå‡è£…å¤‡ï¼Œç„¶åè¾¾åˆ°è¿›å…¥æµæ°´å›¢çš„é—¨æ§›ã€‚</p><p>äº’è”ç½‘æ—¶ä»£å·²ç»è¿‡äº†å¼€è’é˜¶æ®µäº†ï¼Œç°åœ¨å¤§éƒ¨åˆ†æŠ€æœ¯éƒ½å·²ç»æˆç†Ÿäº†ï¼Œè™½ç„¶æ•´ä¸ªç¤¾ä¼šæ²¡æœ‰åƒdnfç­–åˆ’åœ¨æ§åˆ¶å›¢æœ¬çš„æ›´æ–°æ¢ä»£ï¼Œä½†æ˜¯ç”Ÿäº§åŠ›çš„æé«˜æ³¨å®šäº†æ•´ä¸ªæ—¶ä»£ä¼šå¾€å‰è¿›æ­¥ã€‚ç°åœ¨äº’è”ç½‘å…¬å¸è¶Šæ¥è¶Šå¤šï¼Œæƒ³å…¥è¿™ä¸€è¡Œçš„äººä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œå…¬å¸è€æ¿æ‹›äººçœ‹ä»€ä¹ˆï¼Ÿå­¦å†ï¼ŒæŠ€æœ¯å°±æ˜¯é—¨æ§›ã€‚é‚£ä½ åˆæ²¡å­¦å†ï¼Œåˆæ²¡æŠ€æœ¯ï¼Œè¿˜æƒ³åƒè¿™è¡Œçš„é¥­ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿæ²¡å­¦å†å°±è€ƒç ”ï¼Œæ²¡æŠ€æœ¯å°±åé‡‘å›¢ï¼ˆåŸ¹è®­ï¼‰ï¼Œè®©åˆ«äººå¸¦ä½ å…¥é—¨ï¼Œæˆ–è€…ä½ è‡ªå­¦æŠ€æœ¯ã€‚ç„¶åå…ˆè¿›å…¥ä¸€å®¶äº’è”ç½‘çš„ä¼ä¸šã€‚</p><h1 id="æ‰“å·¥-åˆ›ä¸š-å˜æˆäº†ä»¥å‰æˆ‘æœ€è®¨åŒçš„æ ·å­"><a href="#æ‰“å·¥-åˆ›ä¸š-å˜æˆäº†ä»¥å‰æˆ‘æœ€è®¨åŒçš„æ ·å­" class="headerlink" title="æ‰“å·¥-åˆ›ä¸š-å˜æˆäº†ä»¥å‰æˆ‘æœ€è®¨åŒçš„æ ·å­"></a>æ‰“å·¥-åˆ›ä¸š-å˜æˆäº†ä»¥å‰æˆ‘æœ€è®¨åŒçš„æ ·å­</h1><p>å½“å¹´æˆ‘åŠ å…¥äº†ä¸€ä¸ªå®‰å›¾æ©çš„å¤§å›¢é˜Ÿåï¼Œå¼€å§‹ä»èˆ°ç‚®å…»è€cæˆé•¿åˆ°ç«å±±cï¼Œæˆä¸ºç«å±±cä¹‹åæˆ‘å¹¶æ²¡æœ‰å¾—åˆ°å›¢é•¿çš„å°Šé‡ï¼Œåè€Œæˆä¸ºäº†å›¢é•¿ä¸“èŒå¸¦åˆ’æ°´çš„è§’è‰²ï¼Œç¾å…¶åæ›°ï¼Œæœ‰èƒ½åŠ›å°±è¦å¸¦é…±æ²¹é˜¿ï¼Œä¸ç„¶ç™½åŸ¹å…»ä½ å¹²å˜›ï¼Œç›´åˆ°æœ‰ä¸€å¤©æˆ‘ä¸ºäº†è¦ä¸€ä¸ªåˆ’æ°´ä½è€Œå’Œå›¢é•¿å‘ç”Ÿäº†å†²çªã€‚æˆ‘æ‹‰äº†ä¸€æ‰¹éƒ½å¿å—ä¸äº†å›¢é•¿çš„ç½‘å‹ï¼Œé€€å‡ºäº†é‚£ä¸ªå›¢é˜Ÿï¼Œè‡ªå·±å¼€å›¢ï¼Œå»ºå…¬ä¼šå»ºç¾¤ï¼Œå–Šå–‡å­æ‹›äººï¼Œæ…¢æ…¢æŠŠç¾¤å£®å¤§èµ·æ¥ã€‚ç„¶åæˆ‘å‘ç°æˆ‘ä¹Ÿæˆäº†å’Œå›¢é•¿ä¸€æ ·çš„äººï¼Œè‡ªå·±åªæœ‰2ä¸ªç«å±±cï¼Œå´å¯ä»¥åˆ’8ä¸ªå°å·ï¼Œæ¯æ¬¡å¼€å›¢éƒ½å…ˆä¸Šå¥¶cï¼Œç­‰äººå¿«æ»¡äº†ç«‹å³æ¢å°å·åˆ’æ°´ï¼Œç„¶åéª—å¤§å¥¶å¤§cï¼ˆä¿—ç§°é‡äººï¼‰ï¼Œè®©é‡äººå…è´¹ç»™ä½ æ‰“å·¥å¸¦å°å·ï¼Œç„¶åä½ è½»è½»æ¾æ¾å°±èƒ½è·å¾—é€šå…³å¥–åŠ±ã€‚ä»¥å‰å¼€å›¢è¿˜æ˜¯éµå¾ªäº’å¸¦åŸåˆ™ï¼Œä½ å¸¦æˆ‘åˆ’æ°´æˆ‘å¸¦ä½ åˆ’æ°´ï¼Œåˆ°äº†åæ¥ï¼Œæˆ‘å˜æœ¬åŠ å‰ï¼Œå¤§å·å¼€é‡‘å›¢èµšé’±ï¼Œå°å·çº¯åˆ’æ°´ï¼Œä¸è´¡çŒ®è‡ªå·±çš„åŠ›é‡ï¼Œåè€ŒæŠŠè‡ªå·±æœ€æ ¸å¿ƒçš„åŠ›é‡æ‹¿å»åƒç‹¬é£Ÿã€‚è¿™ä¸ªæ—¶å€™å¾ˆå¤šçœ‹åˆ°è¿™ä¼°è®¡ä¼šéª‚æˆ‘ï¼Œæ€ä¹ˆè¿™ä¹ˆæ²¡è‰¯å¿ƒï¼Œå…¶å®æˆ‘ä¹Ÿæƒ³éª‚æˆ‘ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¼šå˜çš„è¿™æ ·å‘¢ï¼Œå˜å¾—å’Œä»¥å‰é‚£ä¸ªå›¢é•¿ä¸€æ ·ï¼Œå˜æˆäº†æˆ‘æœ€è®¨åŒçš„æ ·å­ã€‚æˆ‘è‡³ä»Šä¹Ÿæƒ³ä¸æ˜ç™½ï¼Œè¿™éš¾é“å°±æ˜¯ä¸€ä¸ªäººåˆ›ä¸šçš„å¿…ç»ä¹‹è·¯å—ï¼Œèƒ½åŠ›è¶Šå¼ºçš„äººéƒ½æ˜¯å–œæ¬¢å‹æ¦¨åˆ«äººçš„äººï¼Ÿå¦‚æœä½ ä¹Ÿæœ‰ç­”æ¡ˆï¼Œå¯ä»¥ç»™æˆ‘ç•™è¨€ã€‚</p><h1 id="æ¸¸æˆäººç”Ÿ"><a href="#æ¸¸æˆäººç”Ÿ" class="headerlink" title="æ¸¸æˆäººç”Ÿ"></a>æ¸¸æˆäººç”Ÿ</h1><p>å†™è¿™ç¯‡æ–‡ç« çš„ç›®çš„å…¶å®æ˜¯åæ€ã€‚</p><p>å½“å‰è¾¾åˆ°dnfæ¸¸æˆäººç”Ÿçš„æœ€é«˜å¢ƒç•Œå°±æ˜¯åŠªåŠ›æ‰“é€ æˆå…¨æœè£…å¤‡æœ€å¥½çš„ï¼ŒæŠ€æœ¯ä¹Ÿè¦æœ€ç‰›é€¼ï¼Œæ‰“æ¡©æ‰“å‡ºæœ€é«˜çš„ä¼¤å®³æ‰ç‰›é€¼ï¼Œæˆä¸ºè¿™ä¸ªè¡Œä¸šçš„é¢†å¤´ç¾Šã€‚ï¼ˆç±»ä¼¼æ—­æ—­å®å®è¿™æ ·ï¼Œè™½ç„¶è£…å¤‡å¤©ä¸‹ç¬¬ä¸€ï¼Œä½†æ˜¯è€è¢«åæ§½æ‰‹æ³•ï¼Œä½†æ˜¯å·²ç»è¶³å¤Ÿè€€çœ¼ï¼Œæˆ‘ç²‰å®å“¥ï¼Œé™·äºæ‰åï¼Œå¿ äºäººå“ã€‚ï¼‰</p><p>é‚£ä¹ˆäººä¸€ç”Ÿçš„æœ€é«˜å¢ƒç•Œæ˜¯ä»€ä¹ˆå‘¢ï¼ŒæŠ±æ­‰ï¼Œæˆ‘ç°åœ¨ä¹Ÿä¸çŸ¥é“ï¼Œä½†æ˜¯é€šè¿‡dnfï¼Œæˆ‘ä¹Ÿä½“éªŒäº†ä¸€æŠŠä»ä¸€ä¸ªå°ç™½æˆé•¿èµ·æ¥çš„è¿‡ç¨‹ã€‚</p><hr><blockquote><p>ç°ä¸–æŠ¥â€“ä¸æ˜¯åšçš„è¶Šå¤šï¼Œèƒ½åŠ›è¶Šå¼ºå°±è¶Šç‰›é€¼</p></blockquote><p>åœ¨ç°å®ä¸­æˆ‘ä¹Ÿæ˜¯ä¸€ä¸ªåˆšåˆšä»å¤§å­¦æ¯•ä¸šè¿›å…¥äº’è”ç½‘è¿™ä¸€è¡Œçš„å°ç™½ï¼Œç›®å‰æˆ‘ä¹Ÿæˆä¸ºä¸€ä¸ªè¢«å‹æ¦¨çš„æ‰“å·¥ä»”ï¼Œæˆ‘çš„å…¬å¸åŸ¹å…»æˆ‘å­¦ä¹ æˆé•¿ï¼Œç›´åˆ°èƒ½å¤Ÿç‹¬ç«‹æ‰¿æ¥å…¬å¸çš„æ‰€æœ‰ä¸šåŠ¡ï¼Œä½†æ˜¯æˆ‘æ˜æ˜æœ‰èµ„æ ¼åˆ’å°å·äº†ï¼Œä½†æ˜¯å…¬å¸è¿˜æ˜¯è®©æˆ‘ä½¿åŠ²åœ°å¸¦é…±æ²¹ï¼ˆå‹æ¦¨ï¼‰ï¼Œè€Œä¸”åˆä¸è®©æˆ‘åˆ’æ°´ï¼ˆæ¶¨é’±ï¼‰ï¼Œç¾å…¶åæ›°æˆ‘åŸ¹å…»äº†ä½ ï¼Œä½ å°±è¯¥ä¸ºæˆ‘æ‰“å·¥æŠ¥æ©ã€‚å’Œdnfä¸€æ ·ï¼Œå¦‚æœæŸå¤©ï¼ŒæŸä»¶äº‹æˆäº†æˆ‘å‹å®æˆ‘çš„æœ€åä¸€æ ¹ç¨»è‰ï¼Œæˆ‘ä¹Ÿä¼šè¾èŒï¼Œä½†æ˜¯ç°å®ä¸å’Œdnfä¸€æ ·ï¼Œä¸€ä¸ªæ›´æ–°æ¢ä»£çš„å‰¯æœ¬éœ€è¦ç”±ä¸Šä¸€å±Šå‰¯æœ¬çš„é¡¶çº§äººç‰©å¼€è’ï¼Œæˆ‘å¾—å…ˆæˆä¸ºæŸä¸€é¢†åŸŸçš„ä¸“å®¶æ‰èƒ½è€ƒè™‘æ‹‰äººåˆ›ä¸šï¼Œä¸ç„¶åªèƒ½æ¢æµæ°´å›¢ï¼Œè¯´ä¸å®šæŸä¸ªå›¢é•¿èµè¯†æˆ‘çš„æ‰åï¼Œè®©æˆ‘æ‰“ä¸€ä¸ªcå°±èƒ½éšæ„åˆ’æ°´ï¼ˆæ¶¨é’±ï¼‰ã€‚å¦‚æœä½ ä¹Ÿæœ‰ç­”æ¡ˆï¼Œå¯ä»¥ç»™æˆ‘ç•™è¨€ã€‚</p><h1 id="è¿”æœ¬å½’å…ƒ"><a href="#è¿”æœ¬å½’å…ƒ" class="headerlink" title="è¿”æœ¬å½’å…ƒ"></a>è¿”æœ¬å½’å…ƒ</h1><p>æˆ‘èŠ±äº†5298ä¸ªå°æ—¶åœ¨é˜¿æ‹‰å¾·å¤§é™†ç•…ç©ï¼Œå¾—åˆ°çš„æœ€ç»ˆä¸è¿‡æ˜¯ä¸€äº›æ•°æ®ç½¢äº†ï¼Œäººèµ°èŒ¶å‡‰ï¼Œæˆ‘æœ€å¥½çš„æœ‹å‹ä»¬éƒ½ç¦»å¼€äº†ï¼Œæˆ‘è¿˜ä½•è‹¦ä¸€ä¸ªäººç•™ä¸‹ï¼Ÿ</p><p>æœ€åæé†’ä¸‹èƒ½ç ”è¯»æˆ‘è¿™ç¯‡æ–‡ç« çš„äººï¼Œé€‚åº¦æ¸¸æˆç›Šè„‘ï¼Œæ²‰è¿·æ¸¸æˆä¼¤èº«ã€‚</p><p>ä¸è¦æŠŠæ¸¸æˆçœ‹æˆç°å®çš„å†™ç…§ï¼Œå›å½’ç°å®å§ã€‚åŠªåŠ›å­¦ä¹ ï¼Œæ—©æ—¥æˆä¸ºé‚£ä¸ªäººä¸Šäººã€‚</p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¡¶çº§ç†è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¶çº§ç†è§£ </tag>
            
            <tag> DNF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¡¶çº§ç†è§£ä¹‹æˆé•¿ï¼ˆ2018.9-2020.5ï¼‰</title>
      <link href="/2020/05/05/king/king-growup/"/>
      <url>/2020/05/05/king/king-growup/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜: é¡¶çº§ç†è§£ç³»åˆ—å…¨éƒ¨æ˜¯æœ¬äººçš„ä¸»è§‚çœ‹æ³•ï¼Œæœ›ä¸å–œå‹¿å–·ï¼Œæ±‚åŒå­˜å¼‚ã€‚</p><hr><p>æœ¬æ–‡è®°å½•äº†å®‡ç¥ä¹‹æ¯çš„æˆé•¿ä»¥åŠæˆ‘å¯¹æˆé•¿çš„ç†è§£ã€‚</p><h1 id="å®ä¹ æ—¶æœŸå‰ï¼ˆ2018ï¼‰"><a href="#å®ä¹ æ—¶æœŸå‰ï¼ˆ2018ï¼‰" class="headerlink" title="å®ä¹ æ—¶æœŸå‰ï¼ˆ2018ï¼‰"></a>å®ä¹ æ—¶æœŸå‰ï¼ˆ2018ï¼‰</h1><p>å®ä¹ å‰è¿ä»¥ä¸‹æŠ€æœ¯æ˜¯ä»€ä¹ˆéƒ½ä¸çŸ¥é“ã€‚</p><p>Linuxã€macã€gitã€gitlabã€pythonã€nginxã€dockerã€openstackã€‚</p><h1 id="å®ä¹ æ—¶æœŸåï¼ˆ2019ï¼‰"><a href="#å®ä¹ æ—¶æœŸåï¼ˆ2019ï¼‰" class="headerlink" title="å®ä¹ æ—¶æœŸåï¼ˆ2019ï¼‰"></a>å®ä¹ æ—¶æœŸåï¼ˆ2019ï¼‰</h1><p>æˆ‘å·²ç»ä¼šä¸€äº›Linuxã€gitã€dockerçš„åŸºæœ¬å‘½ä»¤ï¼Œèƒ½å¤Ÿç”¨pythonè½»æ¾å†™ä¸€äº›è„šæœ¬ï¼Œä¼šç®€å•åœ°é…ç½®nginxçš„è½¬å‘ï¼Œä½¿ç”¨openstackåˆ›å»ºè™šæ‹Ÿæœºï¼ˆä»…æ­¤è€Œå·²ï¼‰ï¼Œä¿®è¿‡åŒäº‹çš„macç”µè„‘ã€‚</p><h1 id="æ¯•ä¸šå2ä¸ªæœˆï¼ˆ2019ï¼‰"><a href="#æ¯•ä¸šå2ä¸ªæœˆï¼ˆ2019ï¼‰" class="headerlink" title="æ¯•ä¸šå2ä¸ªæœˆï¼ˆ2019ï¼‰"></a>æ¯•ä¸šå2ä¸ªæœˆï¼ˆ2019ï¼‰</h1><p>å¤§å­¦æ¯•ä¸šå3ä¸ªæœˆå†…ï¼Œæˆ‘è¡¥å……äº†æˆ‘çš„ç½‘ç»œã€è®¡ç®—æœºçŸ¥è¯†ã€åšç½‘çº¿ã€å¸®åŒäº‹å®‰è£…æ‰“å°æœºã€é…ç½®å…¬å¸ADåŸŸåŠé‚®ç®±ã€å¹³å¸¸æ’æŸ¥ä¸‹åŒäº‹çš„ç”µè„‘é—®é¢˜ã€‚è¿™æ—¶æˆ‘ä¿¨ç„¶æˆä¸ºäº†ä¸€åæ¡Œé¢è¿ç»´å·¥ç¨‹å¸ˆï¼Œä½†æ˜¯æˆ‘è§‰å¾—ä¸€ç›´åšè¿™äº›é‡å¤çš„äº‹å¾ˆæ²¡æ„æ€ï¼Œæˆ‘å‡†å¤‡è¦åˆ©ç”¨æˆ‘åœ¨å®ä¹ æœŸé—´å­¦ä¹ çš„ä¸œè¥¿äº†ã€‚</p><h1 id="è‡ªå­¦è¿ç»´æŠ€æœ¯ï¼ˆ2019ï¼‰"><a href="#è‡ªå­¦è¿ç»´æŠ€æœ¯ï¼ˆ2019ï¼‰" class="headerlink" title="è‡ªå­¦è¿ç»´æŠ€æœ¯ï¼ˆ2019ï¼‰"></a>è‡ªå­¦è¿ç»´æŠ€æœ¯ï¼ˆ2019ï¼‰</h1><p>å…¬å¸ç»™æˆ‘é…ç½®äº†6å°è™šæ‹Ÿæœºï¼Œ1ä¸ªæœˆçš„æ—¶é—´å†…ï¼Œæˆ‘æŠŠå…¬å¸å®æˆ˜ç”¨åˆ°çš„å„ç§æŠ€æœ¯éƒ½è¿‡äº†ä¸€éï¼ˆå®‰è£…ã€äº†è§£ï¼‰ï¼Œå¹¶è®°å½•æˆæ–‡æ¡£ã€‚</p><p>dockerã€Harborã€jenkinsã€jiraã€confluenceã€gitlabã€lvsã€keepalivedã€Nginxã€ELKã€mavenã€Rocketmqã€Zookpeerã€Nacosã€Redisã€memcachedã€Mysqlã€Skywalkingã€zabbixã€nagiosã€yapi</p><h1 id="ç¬¬ä¸€æ¬¡ä¸Šçº¿éƒ¨ç½²ï¼ˆ2019ï¼‰"><a href="#ç¬¬ä¸€æ¬¡ä¸Šçº¿éƒ¨ç½²ï¼ˆ2019ï¼‰" class="headerlink" title="ç¬¬ä¸€æ¬¡ä¸Šçº¿éƒ¨ç½²ï¼ˆ2019ï¼‰"></a>ç¬¬ä¸€æ¬¡ä¸Šçº¿éƒ¨ç½²ï¼ˆ2019ï¼‰</h1><p>ä¿—è¯è¯´çš„å¥½ï¼Œæœ€å¥½çš„ç»éªŒéƒ½æ˜¯å®æˆ˜ä¸­ç»ƒèµ·æ¥çš„ã€‚9æœˆï¼Œå…¬å¸æ¶æ„è°ƒæ•´ï¼Œéœ€è¦ä»æ€»éƒ¨è¿ç§»4ä¸ªé¡¹ç›®åˆ°åˆ†éƒ¨æ¥ï¼Œä¸ºäº†èƒ½è®©æˆ‘æ¥æ‰‹è¿ç»´ç›¸å…³å·¥ä½œï¼Œæ€»éƒ¨æ´¾äº†ä¸€ä½èµ„æ·±è¿ç»´å·¥ç¨‹å¸ˆåå“¥æ¥åˆ†éƒ¨å¸¦æˆ‘ä¸Šé¡¹ç›®ï¼Œé€šè¿‡å‰æœŸ1ä¸ªæœˆçš„è‡ªå­¦ï¼Œæˆ‘å¸¦ç€é—®é¢˜è¯·æ•™ä»–ï¼Œä»–å¯¹æˆ‘çš„é—®é¢˜è®²è§£çš„å¾ˆæ·±ï¼Œæ¯ç§æŠ€æœ¯ä»–éƒ½èƒ½è®²åˆ°åŸç†å±‚ï¼Œæˆ‘å¾ˆä½©æœä»–ã€‚</p><p>ä¸åˆ°7å¤©çš„æ—¶é—´ï¼Œåå“¥æŠŠä¸Šé¢å¤§éƒ¨åˆ†æŠ€æœ¯éƒ½ç»™æˆ‘è®²äº†ä¸€éï¼Œä»¥åŠæ€ä¹ˆå»å®æˆ˜åº”ç”¨ï¼Œæˆ‘å¦‚è·è‡³å®å¹¶å°†è¿™äº›æŠ€æœ¯è¯¦ç»†è®°å½•åˆ°æ–‡æ¡£ï¼Œè¿™äº›æ–‡æ¡£åˆ°ç°åœ¨å·²ç»æˆä¸ºæˆ‘å·¥ä½œä¸­ä¸å¯æˆ–ç¼ºçš„å­¦ä¹ èµ„æ–™ã€‚</p><p>9æœˆ4æ—¥ï¼Œè¿™ä¸€å¤©æˆ‘å¯èƒ½å¾ˆéš¾å¿˜è®°ï¼Œå…¬å¸çš„ä¸€ä¸ªå¤§ä¸šåŠ¡éœ€è¦åœ¨è¿™å¤©è¿›è¡Œä¸Šçº¿éƒ¨ç½²ã€‚æˆ‘ç‰¹åˆ«ç´§å¼ ï¼Œæ•²å‘½ä»¤éƒ½æ£€æŸ¥å¾—å¾ˆä»”ç»†ã€‚é¡¹ç›®å‘å¸ƒç”¨çš„æ˜¯jenkinsï¼Œå½“æˆ‘æ”¹å¥½é¡¹ç›®é…ç½®æ–‡ä»¶åï¼Œå¼€å§‹æ„å»ºï¼Œç»“æœæŠ¥é”™äº†ï¼Œç”Ÿäº§ç¯å¢ƒçš„é¡¹ç›®å¯åŠ¨å¤±è´¥ï¼Œæˆ‘ä¸çŸ¥æ‰€æªï¼Œåªèƒ½è®©åå“¥å¤„ç†ã€‚è¿™ä¸ªé”™è¯¯æˆ‘ä¹Ÿå¯èƒ½å¾ˆéš¾å¿˜è®°ï¼Œå› ä¸ºæ•°æ®åº“æ–°å¢äº†ä¸€ä¸ªè¡¨ï¼Œè€Œé¡¹ç›®è¿æ¥çš„ç”¨æˆ·åº”è¯¥æ·»åŠ è¿™ä¸ªè¡¨ï¼Œä¸ç„¶å°±æ²¡æœ‰æƒé™è®¿é—®ã€‚ç°åœ¨çœ‹ä¼¼å¾ˆç®€å•çš„ä¸€ä¸ªé—®é¢˜ï¼Œåªéœ€è¦DBAæˆæƒè¿™ä¸ªè´¦æˆ·å³å¯ã€‚åå“¥å½“æ—¶ç«‹é©¬æ‰“ç”µè¯è”ç³»DBAï¼Œè®©ä»–æˆæƒï¼Œç„¶åæ‰§è¡Œäº†ä¸€äº›å½“æ—¶æˆ‘å®Œå…¨çœ‹ä¸æ‡‚çš„æ“ä½œã€‚æœ€åé¡¹ç›®å‘å¸ƒå®Œæˆï¼ŒéªŒæ”¶é€šè¿‡ï¼Œä»å§‹è‡³ç»ˆæˆ‘éƒ½æ˜¯æ‡µé€¼çŠ¶æ€ã€‚</p><h1 id="å…ˆåº”ç”¨åå­¦ä¹ ï¼ˆ2019ï¼‰"><a href="#å…ˆåº”ç”¨åå­¦ä¹ ï¼ˆ2019ï¼‰" class="headerlink" title="å…ˆåº”ç”¨åå­¦ä¹ ï¼ˆ2019ï¼‰"></a>å…ˆåº”ç”¨åå­¦ä¹ ï¼ˆ2019ï¼‰</h1><p>ä»9æœˆ4æ—¥åï¼Œçœ‹ç€æ€»éƒ¨è¿ç»´åŒäº‹çš„ä¸Šçº¿æ–‡æ¡£ï¼Œæˆ‘ä¸€æ­¥ä¸€æ­¥å°†åˆ†å¸ƒçš„ä¸šåŠ¡å…¨éƒ¨æ¥å®Œäº†ï¼ŒKuberneteså¼€å§‹è¿›å…¥åˆ°æˆ‘çš„è§†çº¿ã€‚ç”±äºå†å²åŸå› ï¼Œå…¬å¸è€çš„é¡¹ç›®æ˜¯å•æœºéƒ¨ç½²ï¼ˆè¿›å…¥æœåŠ¡å™¨ï¼Œjava -jarå¯åŠ¨ï¼‰ï¼Œæ–°çš„é¡¹ç›®ç”¨çš„éƒ½æ˜¯Kubernetesã€‚è¿™ä¹ˆä¸€ä¸ªåºå¤§çš„å®¹å™¨ç¼–æ’å·¥å…·å½“åˆåœ¨æˆ‘çœ¼é‡Œä¸è¿‡å°±æ˜¯å‘å¸ƒçš„æ—¶å€™çš„ä¸€æ¡å‘½ä»¤helm upgradeå°±èƒ½æ»šåŠ¨å‘å¸ƒé¡¹ç›®äº†ï¼Œè€Œé‡Œé¢çš„æŠ€æœ¯æˆ‘è‡³ä»Šä¹Ÿæ²¡èƒ½å…¨éƒ¨åƒé€ã€‚</p><h1 id="ä»0åˆ°1çš„æˆé•¿ï¼ˆ2019ï¼‰"><a href="#ä»0åˆ°1çš„æˆé•¿ï¼ˆ2019ï¼‰" class="headerlink" title="ä»0åˆ°1çš„æˆé•¿ï¼ˆ2019ï¼‰"></a>ä»0åˆ°1çš„æˆé•¿ï¼ˆ2019ï¼‰</h1><p>11æœˆï¼Œå…¬å¸åˆ†éƒ¨è¦ä¸Šçº¿ä¸€ä¸ªå…¨æ–°çš„ä¸šåŠ¡ï¼Œéœ€è¦åˆ†éƒ¨å›¢é˜Ÿç‹¬ç«‹å®Œæˆï¼Œä¸å†ä¾èµ–æ€»éƒ¨çš„æŠ€æœ¯äººå‘˜ã€‚æ­¤æ—¶æˆ‘è™½ç„¶å·²ç»èƒ½ç‹¬ç«‹æ‰¿æ¥å‘å¸ƒéœ€æ±‚ï¼Œä½†æ˜¯éƒ½æ˜¯åŸºäºè€çš„é¡¹ç›®ï¼Œç‚¹ä¸€ç‚¹æŒ‰é’®ï¼Œå°±èƒ½å‘å¸ƒäº†ï¼Œå¯¹äºé‡Œé¢çš„æœºåˆ¶åŸç†è¿˜æ˜¯ä¸å¤ªç†Ÿæ‚‰ã€‚å…¬å¸åˆ†éƒ¨ä¹Ÿéœ€è¦ä¸€ä¸ªå®Œæ•´çš„æŠ€æœ¯ä½“ç³»ï¼Œä¸€ä¸ªèµ„æ·±ç½‘ç»œå·¥ç¨‹å¸ˆå¤©å“¥å’Œä¸€ä¸ªèµ„æ·±è¿ç»´å·¥ç¨‹å¸ˆå³°å“¥å°±å¸¦ç€æˆ‘ä¸€ä¸ªå°èœé¸¡å¼€å¹²å•¦ã€‚</p><ul><li>æœºæˆ¿å»ºè®¾ï¼šæ€»éƒ¨å‘åˆ†éƒ¨å¯„äº†å¥½å‡ å°720xdï¼Œå¤©å“¥è§„åˆ’å¥½åˆ†å…¬å¸ç½‘ç»œæ‹“æ‰‘ç»“æ„åï¼Œå¼€å§‹é…ç½®äº¤æ¢æœºåŠé˜²ç«å¢™ã€å»ºç«‹åˆ†éƒ¨æœ‰çº¿/æ— çº¿/è™šæ‹Ÿç½‘ç»œï¼Œè¿™äº›åšå¥½åï¼Œä»–å¼€å§‹æ•™æˆ‘æ‹†æœåŠ¡å™¨è£…ç¡¬ç›˜å’Œå†…å­˜æ¡ï¼Œä»¥åŠéƒ¨ç½²esxié›†ç¾¤ï¼Œç„¶åå³°å“¥å¸¦æˆ‘æŠŠä¸€ä¸ªcentosé•œåƒåšæˆè™šæ‹Ÿæœºçš„æ¨¡æ¿ã€‚</li><li>ç¯å¢ƒå»ºè®¾ï¼šå¤©å“¥åˆ’åˆ†äº†å¼€å‘ç¯å¢ƒ/æµ‹è¯•ç¯å¢ƒ/å‹æµ‹ç¯å¢ƒï¼Œå³°å“¥å¸¦ç€æˆ‘ä¸€èµ·éƒ¨ç½²Kubernetesé›†ç¾¤ã€Mysqlã€Redisé›†ç¾¤ã€Zookeeperé›†ç¾¤ã€Nacosé›†ç¾¤ã€RocketMQé›†ç¾¤ã€Jenkinsã€Harborç­‰ç­‰åˆ°å¼€å‘ç¯å¢ƒï¼Œè¿‡äº†ä¸€éåï¼Œå‰©ä¸‹çš„2ä¸ªç¯å¢ƒå°±ç”±æˆ‘è‡ªå·±æ­å»ºäº†ã€‚</li><li>ç”Ÿäº§éƒ¨ç½²ï¼šæˆ‘ä»¬é¢„ä¼°é¡¹ç›®æ‰€éœ€çš„é…ç½®ï¼Œæ•´ç†é¢„ç®—ï¼Œç”³è¯·èµ„é‡‘ï¼Œæ³¨å†Œé˜¿é‡Œäº‘è´¦å·ï¼Œè´­ä¹°å„ç§èµ„æºã€‚</li><li>Devopsï¼šå³°å“¥å¸¦ç€æˆ‘åˆ¶ä½œKubernetesçš„å®¹å™¨æ¨¡æ¿ã€å†™shellè„šæœ¬ç”¨Jenkinsæ‰“é€šä»å¼€å‘â†’æµ‹è¯•â†’ç”Ÿäº§çš„æµç¨‹ã€‚</li></ul><h1 id="è‡³ä»Šï¼ˆ2020ï¼‰"><a href="#è‡³ä»Šï¼ˆ2020ï¼‰" class="headerlink" title="è‡³ä»Šï¼ˆ2020ï¼‰"></a>è‡³ä»Šï¼ˆ2020ï¼‰</h1><p>ä¸€æ¡Devopsé“è·¯æ‰“é€šåï¼Œå‰©ä¸‹çš„äº‹å°±æ˜¯ç»§ç»­ä¼˜åŒ–åŠå®Œå–„ã€‚</p><p>å®‰å…¨ï¼š</p><ul><li>éƒ¨ç½²ç”Ÿäº§å ¡å’æœºï¼Œè§„èŒƒæ“ä½œ</li><li>éƒ¨ç½²æ•°æ®åº“å®¡è®¡å¹³å°ï¼Œè§„èŒƒsql</li><li>å®‰è£…æ’ä»¶ï¼Œæ‰«ææ¼æ´</li><li>å†™æ—¥å¸¸å·¡æ£€è„šæœ¬ï¼Œç›‘æ§ç”Ÿäº§ç¯å¢ƒèµ„æºçŠ¶æ€</li></ul><p>ä¼˜åŒ–ï¼š</p><ul><li>è‡ªåŠ¨å‘å¸ƒè„šæœ¬ä¼˜åŒ–</li><li>ç”Ÿäº§ç¯å¢ƒå„ä¸ªç»„ä»¶é™é…ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡</li></ul><p>æå‡ï¼š</p><ul><li>æ·±å…¥å­¦ä¹ å„ä¸ªç»„ä»¶åŸç†</li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æˆ‘å¾ˆå¹¸è¿</p><p>åŠå¹´å‰</p><ul><li>èƒ½æœ‰è¿™ä¹ˆå¤šè‰¯å¸ˆç›Šå‹å¸¦æˆ‘å¿«é€Ÿå­¦ä¹ æˆé•¿</li><li>èƒ½è´Ÿè´£ä¸€ä¸ªåˆ†å…¬å¸æ‰€æœ‰çš„ä¸Šçº¿éƒ¨ç½²ä¸šåŠ¡</li><li>èƒ½å­¦ä¹ å¹¶åº”ç”¨ä¸€ä¸ªå…¬æœ‰äº‘å¹³å°çš„éƒ¨åˆ†ç»„ä»¶</li><li>è§è¯å¹¶å‚ä¸åˆ°ä¸€ä¸ªå…¬å¸ä¸šåŠ¡ä»0åˆ°1å»ºæˆçš„è¿‡ç¨‹</li></ul><p>æˆ‘å¾ˆä¸å¹¸</p><p>ç°åœ¨</p><ul><li>å½“åˆå¸¦æˆ‘è‰¯å¸ˆç›Šå‹å·²ç»æœ‰å‡ ä½å±•ç¿…é«˜é£ä¸åœ¨æˆ‘èº«è¾¹</li><li>å·²ç»è¿‡äº†é«˜é€Ÿæˆé•¿æœŸï¼Œå­¦ä¹ æ›²çº¿æ˜æ˜¾å˜æ…¢</li><li>ç®¡ç†çš„äº‹æƒ…å˜å¾—è¶Šæ¥è¶Šå¤šï¼Œå·¥ä½œè¶Šæ¥è¶Šç¹ç</li></ul><p>ä½•å…¶æœ‰å¹¸åˆä½•å…¶ä¸å¹¸ï¼Œè¿™å°±æ˜¯æˆé•¿ã€‚</p><p>æˆé•¿ä¹Ÿæ„å‘³ä¸€ä¸ªäººåœ¨èƒ½åŠ›çš„æå‡çš„åŒæ—¶ä¹Ÿè·å¾—äº†æ›´å¤šçš„æƒåŠ›ï¼Œæ‰¿æ‹…äº†æ›´å¤§çš„è´£ä»»ã€‚</p><p>åšåˆ°ä¸€ä¸ªå…¬å¸ä¸å¯ä»£æ›¿çš„äººç‰©å°±æ˜¯æˆ‘ç›®å‰å¯¹æˆé•¿çš„é¡¶çº§ç†è§£ã€‚ä¸å¯ä»£æ›¿æ€§ï¼ˆ0%-100%ï¼‰ï¼Œä½ èƒ½åˆ°è¾¾ä¸€ä¸ªå…¬å¸ä¸å¯ä»£æ›¿æ€§çš„ç™¾åˆ†ä¹‹å¤šå°‘å°±èƒ½çœŸæ­£åœ°æˆé•¿å¤šå°‘ï¼</p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¡¶çº§ç†è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¶çº§ç†è§£ </tag>
            
            <tag> äº’è”ç½‘ </tag>
            
            <tag> è¿ç»´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è·Ÿæˆ‘å­¦Devopsä¹‹æ€æƒ³ç¯‡ï¼ˆä¸€ï¼‰</title>
      <link href="/2020/05/03/devops/devops-idea-1/"/>
      <url>/2020/05/03/devops/devops-idea-1/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="Devopsç®€ä»‹"><a href="#Devopsç®€ä»‹" class="headerlink" title="Devopsç®€ä»‹"></a>Devopsç®€ä»‹</h1><p>DevOpsï¼ˆDevelopmentå’ŒOperationsçš„ç»„åˆè¯ï¼‰æ˜¯ä¸€ç»„è¿‡ç¨‹ã€æ–¹æ³•ä¸ç³»ç»Ÿçš„ç»Ÿç§°ï¼Œç”¨äºä¿ƒè¿›å¼€å‘ï¼ˆåº”ç”¨ç¨‹åº/è½¯ä»¶å·¥ç¨‹ï¼‰ã€æŠ€æœ¯è¿è¥å’Œè´¨é‡ä¿éšœï¼ˆQAï¼‰éƒ¨é—¨ä¹‹é—´çš„æ²Ÿé€šã€åä½œä¸æ•´åˆã€‚</p><p>å®ƒæ˜¯ä¸€ç§é‡è§†â€œè½¯ä»¶å¼€å‘äººå‘˜ï¼ˆDevï¼‰â€å’Œâ€œITè¿ç»´æŠ€æœ¯äººå‘˜ï¼ˆOpsï¼‰â€ä¹‹é—´æ²Ÿé€šåˆä½œçš„æ–‡åŒ–ã€è¿åŠ¨æˆ–æƒ¯ä¾‹ã€‚é€è¿‡è‡ªåŠ¨åŒ–â€œè½¯ä»¶äº¤ä»˜â€å’Œâ€œæ¶æ„å˜æ›´â€çš„æµç¨‹ï¼Œæ¥ä½¿å¾—æ„å»ºã€æµ‹è¯•ã€å‘å¸ƒè½¯ä»¶èƒ½å¤Ÿæ›´åŠ åœ°å¿«æ·ã€é¢‘ç¹å’Œå¯é ã€‚</p><p>å®ƒçš„å‡ºç°æ˜¯ç”±äºè½¯ä»¶è¡Œä¸šæ—¥ç›Šæ¸…æ™°åœ°è®¤è¯†åˆ°ï¼šä¸ºäº†æŒ‰æ—¶äº¤ä»˜è½¯ä»¶äº§å“å’ŒæœåŠ¡ï¼Œå¼€å‘å’Œè¿ç»´å·¥ä½œå¿…é¡»ç´§å¯†åˆä½œã€‚</p><p>ä¸‹é¢ç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤ºDevopsçš„æ€æƒ³<br><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Blog/devops.jpg"  alt="devopsjpg"></p><h2 id="æ•æ·å¼€å‘"><a href="#æ•æ·å¼€å‘" class="headerlink" title="æ•æ·å¼€å‘"></a>æ•æ·å¼€å‘</h2><p>æ•æ·å¼€å‘ä»¥ç”¨æˆ·çš„éœ€æ±‚è¿›åŒ–ä¸ºæ ¸å¿ƒï¼Œé‡‡ç”¨è¿­ä»£ã€å¾ªåºæ¸è¿›çš„æ–¹æ³•è¿›è¡Œè½¯ä»¶å¼€å‘ã€‚åœ¨æ•æ·å¼€å‘ä¸­ï¼Œè½¯ä»¶é¡¹ç›®åœ¨æ„å»ºåˆæœŸè¢«åˆ‡åˆ†æˆå¤šä¸ªå­é¡¹ç›®ï¼Œå„ä¸ªå­é¡¹ç›®çš„æˆæœéƒ½ç»è¿‡æµ‹è¯•ï¼Œå…·å¤‡å¯è§†ã€å¯é›†æˆå’Œå¯è¿è¡Œä½¿ç”¨çš„ç‰¹å¾ã€‚æ¢è¨€ä¹‹ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªå¤§é¡¹ç›®åˆ†ä¸ºå¤šä¸ªç›¸äº’è”ç³»ï¼Œä½†ä¹Ÿå¯ç‹¬ç«‹è¿è¡Œçš„å°é¡¹ç›®ï¼Œå¹¶åˆ†åˆ«å®Œæˆï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­è½¯ä»¶ä¸€ç›´å¤„äºå¯ä½¿ç”¨çŠ¶æ€ã€‚</p><h2 id="æ•æ·éƒ¨ç½²"><a href="#æ•æ·éƒ¨ç½²" class="headerlink" title="æ•æ·éƒ¨ç½²"></a>æ•æ·éƒ¨ç½²</h2><p>æ•æ·éƒ¨ç½²æ˜¯é€šè¿‡è‡ªåŠ¨åŒ–å·¥å…·æˆ–è„šæœ¬æ¥è¾¾åˆ°é¡¹ç›®è‡ªåŠ¨å‘å¸ƒçš„ç›®çš„ã€‚å¼ºå¤§çš„éƒ¨ç½²è‡ªåŠ¨åŒ–æ‰‹æ®µç¡®ä¿éƒ¨ç½²ä»»åŠ¡çš„å¯é‡å¤æ€§ã€å‡å°‘éƒ¨ç½²å‡ºé”™çš„å¯èƒ½æ€§ã€‚</p><h1 id="ä¸ªäººä»å·¥ä½œä¸­ç†è§£ä»€ä¹ˆå«Devops"><a href="#ä¸ªäººä»å·¥ä½œä¸­ç†è§£ä»€ä¹ˆå«Devops" class="headerlink" title="ä¸ªäººä»å·¥ä½œä¸­ç†è§£ä»€ä¹ˆå«Devops"></a>ä¸ªäººä»å·¥ä½œä¸­ç†è§£ä»€ä¹ˆå«Devops</h1><p>æˆ‘ä»¬å…¬å¸çš„é¡¹ç›®åº”ç”¨å¤§å¤šä»¥Javaä¸ºä¸»ï¼Œç”¨çš„å¾®æœåŠ¡æ¶æ„ã€‚é‚£ä¹ˆåœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨åˆ°devopsä¸­æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿè¯¦æƒ…å¯ä»¥çœ‹ä¸‹å›¾ã€‚<br><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Devops/CICD.png"  alt="devopsjpg"></p><h2 id="æ•´ä¸ªæµç¨‹å¯ä»¥ç»†åˆ†æˆ3ä¸ªé˜¶æ®µ"><a href="#æ•´ä¸ªæµç¨‹å¯ä»¥ç»†åˆ†æˆ3ä¸ªé˜¶æ®µ" class="headerlink" title="æ•´ä¸ªæµç¨‹å¯ä»¥ç»†åˆ†æˆ3ä¸ªé˜¶æ®µ"></a>æ•´ä¸ªæµç¨‹å¯ä»¥ç»†åˆ†æˆ3ä¸ªé˜¶æ®µ</h2><h3 id="å¼€å‘é˜¶æ®µ"><a href="#å¼€å‘é˜¶æ®µ" class="headerlink" title="å¼€å‘é˜¶æ®µ"></a>å¼€å‘é˜¶æ®µ</h3><ul><li>å¼€å‘å›¢é˜Ÿæäº¤ä»£ç åˆ°gitlabçš„devåˆ†æ”¯</li><li>ä»gitlabæ‹‰å»devåˆ†æ”¯ä»£ç </li><li>å•å…ƒæµ‹è¯•</li><li>mavenç¼–è¯‘æ‰“æˆjaråŒ…</li><li>sonarè´¨é‡æ£€æŸ¥</li><li>Dockerfileå°†jaråŒ…æ‰“æˆimage</li><li>å°†imageæ¨é€åˆ°Harborä»“åº“</li><li>å¼€å‘ç¯å¢ƒæœåŠ¡å™¨æ‹‰å–Harborä»“åº“imageå¹¶åˆ›å»ºå®¹å™¨</li><li>éªŒè¯ç›¸å…³åŠŸèƒ½æ­£å¸¸</li></ul><h3 id="æµ‹è¯•é˜¶æ®µ"><a href="#æµ‹è¯•é˜¶æ®µ" class="headerlink" title="æµ‹è¯•é˜¶æ®µ"></a>æµ‹è¯•é˜¶æ®µ</h3><ul><li>æµ‹è¯•ç¯å¢ƒæœåŠ¡å™¨æ‹‰å–Harborä»“åº“imageå¹¶åˆ›å»ºå®¹å™¨</li><li>éªŒè¯ç›¸å…³åŠŸèƒ½æ­£å¸¸</li><li>é€šçŸ¥å¼€å‘åˆå¹¶åˆ†æ”¯åˆ°masteråˆ†æ”¯</li><li>ä»gitlabæ‹‰å»masteråˆ†æ”¯ä»£ç </li><li>å•å…ƒæµ‹è¯•</li><li>mavenç¼–è¯‘æ‰“æˆjaråŒ…</li><li>sonarè´¨é‡æ£€æŸ¥</li><li>Dockerfileå°†jaråŒ…æ‰“æˆimage</li><li>å°†imageæ¨é€åˆ°Harborä»“åº“</li><li>æµ‹è¯•ç¯å¢ƒæœåŠ¡å™¨æ‹‰å–Harborä»“åº“imageå¹¶åˆ›å»ºå®¹å™¨</li><li>éªŒè¯ç›¸å…³åŠŸèƒ½æ­£å¸¸</li></ul><h3 id="æŠ•äº§é˜¶æ®µ"><a href="#æŠ•äº§é˜¶æ®µ" class="headerlink" title="æŠ•äº§é˜¶æ®µ"></a>æŠ•äº§é˜¶æ®µ</h3><ul><li>å°†Harborä»“åº“imageæ¨é€åˆ°ç”Ÿäº§ç¯å¢ƒHarbor</li><li>ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨æ‹‰å–ç”Ÿäº§ç¯å¢ƒHarborä»“åº“imageå¹¶æ»šåŠ¨å‘å¸ƒ</li><li>æµ‹è¯•ã€äº§å“äººå‘˜éªŒæ”¶</li></ul><h2 id="ç»†åˆ†é˜¶æ®µçš„å¥½å¤„"><a href="#ç»†åˆ†é˜¶æ®µçš„å¥½å¤„" class="headerlink" title="ç»†åˆ†é˜¶æ®µçš„å¥½å¤„"></a>ç»†åˆ†é˜¶æ®µçš„å¥½å¤„</h2><p>è¿™æ ·åˆ†é˜¶æ®µçš„Devopsæµç¨‹å¥½å¤„åœ¨äºå…è®¸åˆ†æ•£å¼€çš„å›¢é˜Ÿæ§åˆ¶ä»–ä»¬è‡ªå·±çš„å‘½è¿ï¼š</p><ul><li>å¼€å‘äººå‘˜åªç”¨å…³å¿ƒè‡ªå·±çš„åˆ†æ”¯ä»£ç åŠŸèƒ½ã€ä»£ç è´¨é‡ï¼Œä¸ç”¨è€ƒè™‘éƒ¨ç½²ã€æµ‹è¯•ã€‚</li><li>æµ‹è¯•äººå‘˜åªç”¨å…³å¿ƒå¼€å‘äººå‘˜çš„ä»£ç åŠŸèƒ½ã€å›å½’ã€è‡ªåŠ¨åŒ–ã€æ€§èƒ½æµ‹è¯•ç­‰ï¼Œä¸ç”¨è€ƒè™‘éƒ¨ç½²æµç¨‹ã€‚</li><li>è¿ç»´äººå‘˜åªç”¨å…³å¿ƒå°†é•œåƒå‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Œä¸ç”¨è€ƒè™‘ï¼Œä»£ç åŠŸèƒ½ã€æµ‹è¯•ã€‚</li></ul><p>è¿™æ ·çš„æµæ°´çº¿è®¾è®¡æ˜¯éœ€è¦ä¸€æ®µæ—¶é—´çš„ï¼Œä½†æ˜¯è®¾è®¡å®Œæˆåå¯ä»¥ä¸€åŠ³æ°¸é€¸ï¼Œæ¯ä¸ªå›¢é˜Ÿéƒ½èƒ½ä¸“æ³¨è‡ªå·±çš„å·¥ä½œã€‚ä¹Ÿè®¸ä»¥å‰ä½ æ˜¯å¼€å‘ï¼Œä½ è¿˜éœ€è¦è´Ÿè´£éƒ¨ç½²ã€æµ‹è¯•ï¼›ä¹Ÿè®¸ä»¥å‰ä½ æ˜¯æµ‹è¯•ï¼Œä½ è¿˜éœ€è¦æ¨é€é•œåƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼›æœ‰äº†Devopsåï¼Œä½ åªéœ€è¦åœ¨jenkinsç‚¹ä¸‹æ„å»ºæŒ‰é’®ï¼Œé€‰æ‹©ç¯å¢ƒå°±å¯ä»¥å®ç°ä¸€é”®å‘å¸ƒäº†ï¼Œä¸“æ³¨è‡ªå·±é¢†åŸŸçš„äº‹æœ‰åˆ©äºæé«˜æ•´ä¸ªå›¢é˜Ÿçš„å·¥ä½œæ•ˆç‡ï¼</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä½œä¸ºä¸€ä¸ªè¿ç»´äººå‘˜ï¼Œå½“æˆ‘å­¦ä¹ åˆ°äº†Devopsæ€æƒ³åå°±æ·±æ·±çš„è®¤åŒè¿™ä¸€ç‚¹ï¼šæ‰€æœ‰çš„äººå·¥æ“ä½œéƒ½è¦è½¬æ¢æˆè‡ªåŠ¨åŒ–ã€‚</p><p>Devopsä¸ƒè£ä¸ƒè€»ä¸å¤§å®¶å…±å‹‰</p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Devops/HonorandDisgrace.png"  alt="devops.jpg"></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è·Ÿæˆ‘å­¦Devops </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Devops </tag>
            
            <tag> è‡ªåŠ¨åŒ– </tag>
            
            <tag> æ•æ·å¼€å‘ </tag>
            
            <tag> æ•æ·éƒ¨ç½² </tag>
            
            <tag> CI/CD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è·Ÿæˆ‘å­¦Devopsä¹‹æ€æƒ³ç¯‡ï¼ˆäºŒï¼‰</title>
      <link href="/2020/05/03/devops/devops-idea-2/"/>
      <url>/2020/05/03/devops/devops-idea-2/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="å¾®æœåŠ¡æ¶æ„ç®€ä»‹"><a href="#å¾®æœåŠ¡æ¶æ„ç®€ä»‹" class="headerlink" title="å¾®æœåŠ¡æ¶æ„ç®€ä»‹"></a>å¾®æœåŠ¡æ¶æ„ç®€ä»‹</h1><h2 id="ç™¾åº¦è§£é‡Š"><a href="#ç™¾åº¦è§£é‡Š" class="headerlink" title="ç™¾åº¦è§£é‡Š"></a>ç™¾åº¦è§£é‡Š</h2><p>å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€é¡¹åœ¨äº‘ä¸­éƒ¨ç½²åº”ç”¨å’ŒæœåŠ¡çš„æ–°æŠ€æœ¯ã€‚å¤§éƒ¨åˆ†å›´ç»•å¾®æœåŠ¡çš„äº‰è®ºéƒ½é›†ä¸­åœ¨å®¹å™¨æˆ–å…¶ä»–æŠ€æœ¯æ˜¯å¦èƒ½å¾ˆå¥½çš„å®æ–½å¾®æœåŠ¡ï¼Œè€Œçº¢å¸½è¯´APIåº”è¯¥æ˜¯é‡ç‚¹ã€‚</p><p>å¾®æœåŠ¡å¯ä»¥åœ¨â€œè‡ªå·±çš„ç¨‹åºâ€ä¸­è¿è¡Œï¼Œå¹¶é€šè¿‡â€œè½»é‡çº§è®¾å¤‡ä¸HTTPå‹APIè¿›è¡Œæ²Ÿé€šâ€ã€‚å…³é”®åœ¨äºè¯¥æœåŠ¡å¯ä»¥åœ¨è‡ªå·±çš„ç¨‹åºä¸­è¿è¡Œã€‚é€šè¿‡è¿™ä¸€ç‚¹æˆ‘ä»¬å°±å¯ä»¥å°†æœåŠ¡å…¬å¼€ä¸å¾®æœåŠ¡æ¶æ„ï¼ˆåœ¨ç°æœ‰ç³»ç»Ÿä¸­åˆ†å¸ƒä¸€ä¸ªAPIï¼‰åŒºåˆ†å¼€æ¥ã€‚åœ¨æœåŠ¡å…¬å¼€ä¸­ï¼Œè®¸å¤šæœåŠ¡éƒ½å¯ä»¥è¢«å†…éƒ¨ç‹¬ç«‹è¿›ç¨‹æ‰€é™åˆ¶ã€‚å¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªæœåŠ¡éœ€è¦å¢åŠ æŸç§åŠŸèƒ½ï¼Œé‚£ä¹ˆå°±å¿…é¡»ç¼©å°è¿›ç¨‹èŒƒå›´ã€‚åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œåªéœ€è¦åœ¨ç‰¹å®šçš„æŸç§æœåŠ¡ä¸­å¢åŠ æ‰€éœ€åŠŸèƒ½ï¼Œè€Œä¸å½±å“æ•´ä½“è¿›ç¨‹çš„æ¶æ„ã€‚</p><p>å¾®æœåŠ¡çš„åŸºæœ¬æ€æƒ³åœ¨äºè€ƒè™‘å›´ç»•ç€ä¸šåŠ¡é¢†åŸŸç»„ä»¶æ¥åˆ›å»ºåº”ç”¨ï¼Œè¿™äº›åº”ç”¨å¯ç‹¬ç«‹åœ°è¿›è¡Œå¼€å‘ã€ç®¡ç†å’ŒåŠ é€Ÿã€‚åœ¨åˆ†æ•£çš„ç»„ä»¶ä¸­ä½¿ç”¨å¾®æœåŠ¡äº‘æ¶æ„å’Œå¹³å°ï¼Œä½¿éƒ¨ç½²ã€ç®¡ç†å’ŒæœåŠ¡åŠŸèƒ½äº¤ä»˜å˜å¾—æ›´åŠ ç®€å•ã€‚</p><p>ä½¿ç”¨å¾®æœåŠ¡æ„å»ºç°ä»£åŒ–åº”ç”¨ç¨‹åºæ˜¯å¾ˆæœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºå®ƒè®©ä½ æ—¢åˆ©ç”¨äº†æ‰©å±•æ¨ªå‘æ‰©å±•æ¶æ„ï¼Œä¹Ÿåˆ©ç”¨çºµå‘æ‰©å±•æ¶æ„ï¼›è¿˜é¢å¤–å¾—åˆ°APIçš„ç»„åˆï¼Œä¸”åœ¨æ•´ä¸ªä¸šåŠ¡ä¸­å¯é‡å¤åˆ©ç”¨ã€‚</p><h2 id="ä¸ªäººä»å·¥ä½œä¸­ç†è§£ä»€ä¹ˆå«å¾®æœåŠ¡æ¶æ„"><a href="#ä¸ªäººä»å·¥ä½œä¸­ç†è§£ä»€ä¹ˆå«å¾®æœåŠ¡æ¶æ„" class="headerlink" title="ä¸ªäººä»å·¥ä½œä¸­ç†è§£ä»€ä¹ˆå«å¾®æœåŠ¡æ¶æ„"></a>ä¸ªäººä»å·¥ä½œä¸­ç†è§£ä»€ä¹ˆå«å¾®æœåŠ¡æ¶æ„</h2><p>ä¸€ä¸ªå…¬å¸çš„æ ¸å¿ƒä¸šåŠ¡è´­ä¹°å•†å“ç³»ç»Ÿç”¨å¾®æœåŠ¡æ¶æ„å’Œä¼ ç»Ÿæ¶æ„</p><ul><li>ç”¨å¾®æœåŠ¡æ¡†æ¶æ˜¯è¿™æ ·çš„</li></ul><ol><li>ä¸€ä¸ªç™»é™†æ³¨å†ŒåŠŸèƒ½ï¼Œä¸€ä¸ªæŸ¥è¯¢å•†å“åŠŸèƒ½ï¼Œä¸€ä¸ªå•†å“åº“å­˜åŠŸèƒ½ï¼Œä¸€ä¸ªè´­ä¹°åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½é€šè¿‡APIäº’ç›¸è°ƒç”¨ï¼Œå¹¶ä¸”æ¯ä¸ªåŠŸèƒ½èƒ½åšæˆç‹¬ç«‹çš„åº”ç”¨åˆ†åˆ«éƒ¨ç½²åˆ°å®¹å™¨é‡Œä¸Šï¼Œä¸€ä¸ªå®¹å™¨æŒ‚æ‰/æ›´æ–°ä¸ä¼šå½±å“æ•´ä¸ªé¡¹ç›®çš„è¿è¡Œã€‚</li><li>ç”¨è¿™ç§æ¡†æ¶çš„å¥½å¤„åœ¨äºåœ¨è¿™ä¸ªç³»ç»Ÿç¬¬ä¸€æ¬¡ä¸Šçº¿åˆ°ç”Ÿäº§ç¯å¢ƒåå¹¶ä¸”èƒ½ä¿æŒæ ¸å¿ƒä¸šåŠ¡æ­£å¸¸è¿è¡Œçš„æƒ…å†µä¸‹ï¼Œé¡¹ç›®åæœŸçš„æ›´æ–°åªæ˜¯æŸä¸ªåŠŸèƒ½åº”ç”¨çš„æ›´æ–°ï¼Œä¸ä¼šå½±å“æ•´ä¸ªç”Ÿäº§ç¯å¢ƒçš„ç¨³å®šæ€§ã€‚</li><li>å¦‚æœä½ åªéœ€è¦æ”¹ä¸€ä¸ªæŸ¥è¯¢å•†å“çš„åŠŸèƒ½ï¼Œå³ä½¿è¿™ä¸ªåŠŸèƒ½åæœŸä¸Šçº¿çš„æ—¶å€™å‡ºç°äº†é€»è¾‘é—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿä¸ä¼šå½±å“æ ¸å¿ƒæµç¨‹ï¼ˆè´­ä¹°ï¼‰ï¼Œå¹¶ä¸”ä½ å¯ä»¥é€šè¿‡å®¹å™¨ç¼–æ’å·¥å…·kuberneteså¿«é€Ÿå°†è¿™ä¸€ä¸ªåŠŸèƒ½å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ã€‚</li></ol><ul><li>ç”¨ä¼ ç»Ÿæ¡†æ¶æ˜¯è¿™æ ·çš„<br>æ‰€æœ‰çš„åŠŸèƒ½å†™åˆ°ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œå¯åŠ¨æ…¢ï¼Œå†…å®¹å¤ªå¤šï¼ŒåæœŸæ›´æ–°è¿­ä»£åªä¼šè¶Šæ¥è¶Šéš¾ï¼Œä¸Šçº¿éƒ¨ç½²é£é™©å¤§ï¼ˆéœ€è¦é‡å¯æ•´ä¸ªå¤§é¡¹ç›®ï¼‰ï¼Œç‰¹åˆ«å¾—å‡ºç°äº†é€»è¾‘é—®é¢˜éœ€è¦æŠ€æœ¯äººå‘˜å®šä½é—®é¢˜ï¼Œä»¥åŠå›é€€é¡¹ç›®ï¼Œé€ æˆç”¨æˆ·ä½“éªŒä¸å¥½ã€‚</li></ul><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¦‚æœæ”¯ä»˜å®ã€å¾®ä¿¡è¿™æ ·çš„å¤§åº”ç”¨ç”¨ä¼ ç»Ÿæ¡†æ¶æ›´æ–°ï¼Œæ›´æ–°å®Œå‘ç°æŸä¸ªåŠŸèƒ½ä¸èƒ½ç”¨éœ€è¦å›é€€é‡å¯ï¼Œé€ æˆäº†çŸ­æš‚å‡ åˆ†é’Ÿä¸èƒ½æ‰“å¼€åº”ç”¨ï¼Œè¿™ç§æŸå¤±æ˜¯æ— æ³•ä¼°é‡çš„ã€‚è€Œç”¨å¾®æœåŠ¡æ¶æ„ï¼Œå³ä½¿æ›´æ–°åå‡ºç°äº†é—®é¢˜ï¼Œä¹Ÿåªä¼šæ‰¾æ›´æ–°çš„é‚£ä¸ªåº”ç”¨ç»„ä»¶ï¼Œå®šä½é—®é¢˜+å›é€€é‡å¯ï¼Œè¿™ç§æ–¹å¼å¯ä»¥åœ¨ç”¨æˆ·æ— æ„ŸçŸ¥çš„æƒ…å†µä¸‹è¿›è¡Œï¼Œå½±å“ä¹Ÿä¼šå°å¾ˆå¤šã€‚</p><h1 id="Devopså’Œå¾®æœåŠ¡çš„å…³ç³»"><a href="#Devopså’Œå¾®æœåŠ¡çš„å…³ç³»" class="headerlink" title="Devopså’Œå¾®æœåŠ¡çš„å…³ç³»"></a>Devopså’Œå¾®æœåŠ¡çš„å…³ç³»</h1><p>ä¸€äº›ä¼ä¸šæ€»æ˜¯é¿å¼€å®šæœŸæŠ•èµ„æ¶æ„è§£è€¦å’Œç°ä»£åŒ–æŠ€æœ¯ï¼Œå› æ­¤ç°åœ¨æ— æ³•æ‘†è„±å·¨å¤§çš„äº§å“æ¶æ„ï¼Œä½¿å¾—å‘å¸ƒå˜æˆæ— æ³•é¢„æµ‹ã€‚ä»æŸç§ç¨‹åº¦ä¸Šæ¥è¯´ï¼Œå¾®æœåŠ¡æ¶æ„å’ŒDevopsç›¸è¾…ç›¸æˆï¼Œdevopså’Œå¾®æœåŠ¡æ¶æ„çš„å­˜åœ¨éƒ½æ˜¯ä¸ºäº†è§£å†³è¿™ä¹ˆä¸€ä¸ªé—®é¢˜ï¼šå…¨ä¸–ç•Œçš„æ‰€æœ‰ç»„ç»‡éƒ½è¯•å›¾é¢‘ç¹åœ°å‘å¸ƒé«˜è´¨é‡çš„äº§å“ï¼Œæ¥æé«˜å®¢æˆ·çš„æ»¡æ„åº¦ã€‚</p><h2 id="å¾®æœåŠ¡æ¶æ„å’ŒDevOpså…è®¸åˆ†æ•£å¼€çš„å›¢é˜Ÿæ§åˆ¶ä»–ä»¬è‡ªå·±çš„å‘½è¿"><a href="#å¾®æœåŠ¡æ¶æ„å’ŒDevOpså…è®¸åˆ†æ•£å¼€çš„å›¢é˜Ÿæ§åˆ¶ä»–ä»¬è‡ªå·±çš„å‘½è¿" class="headerlink" title="å¾®æœåŠ¡æ¶æ„å’ŒDevOpså…è®¸åˆ†æ•£å¼€çš„å›¢é˜Ÿæ§åˆ¶ä»–ä»¬è‡ªå·±çš„å‘½è¿"></a>å¾®æœåŠ¡æ¶æ„å’ŒDevOpså…è®¸åˆ†æ•£å¼€çš„å›¢é˜Ÿæ§åˆ¶ä»–ä»¬è‡ªå·±çš„å‘½è¿</h2><p>å¾®æœåŠ¡æ¶æ„å°±æ˜¯å…³äºæŠŠä¸€ä»¶äº‹åšå¥½ï¼Œä»è®¾è®¡ä¸€ä¸ªç”±è®¸å¤šâ€œæœåŠ¡â€é›†ä¸­åˆ°ä¸€ä¸ªçš„åºç„¶å¤§ç‰©ä¸­ï¼Œè¿™æ˜¯ä¸€ç§èŒƒå¼è½¬å˜ã€‚å¯¹åºå¤§ç³»ç»Ÿçš„æ‰¼æ€å‚¬ç”Ÿäº†æ›´å°çš„å¾®æœåŠ¡ï¼Œå¹¶åŠ é€Ÿäº†åºå¤§ç¬¨é‡å›¢é˜Ÿçš„ç“¦è§£ï¼Œç ”å‘å˜æˆäº†å¤šä¸ªæ›´å°ï¼ˆæ›´çµæ´»ï¼‰çš„å›¢é˜Ÿã€‚</p><p>æ­¤å¤–ï¼ŒæƒåŠ›åˆ†æ•£ä¹Ÿæ­£å¥½ç¬¦åˆDevOpsçš„æ ¸å¿ƒåŸåˆ™ï¼Œç¼©å°äº†ä¸¤è€…ä¹‹é—´çš„å·®è·ï¼š</p><ul><li>UIã€ä¸­é—´å±‚å’Œåå°ä¸“å®¶ï¼Œä»–ä»¬å€¾å‘äºåœ¨è‡ªå·±çš„ç­’ä»“ä¸­æ“ä½œã€‚</li><li>ä¸šåŠ¡ã€äº§å“ç®¡ç†ã€å¼€å‘ã€QAã€å‘å¸ƒã€å®‰å…¨ã€è¿è¥ï¼Œä»¥åŠå…¶ä»–æˆå‘˜ï¼Œè¿™äº›äººéƒ½å€¾å‘äºåœ¨è‡ªå·±çš„éƒ¨é—¨å·¥ä½œã€‚</li></ul><p>æœ€é‡è¦çš„æ˜¯ï¼Œå¾®æœåŠ¡æ¶æ„å’ŒDevOpséƒ½æ”¯æŒäº§å“æ¨¡å‹å’Œé¡¹ç›®æ¨¡å‹ï¼Œå³5-7ä¸ªæˆå‘˜å›¢é˜Ÿè®¾è®¡ã€æ„å»ºã€æµ‹è¯•ã€å‘å¸ƒã€ç›‘æ§å’Œç»´æŠ¤ä»–ä»¬åœ¨å¼€å‘/æµ‹è¯•ã€é˜¶æ®µå’Œç”Ÿäº§ä¸Šçš„åº”ç”¨ã€‚</p><h2 id="åŒºåˆ†å¼€çš„æœåŠ¡å¯ä»¥ä½œä¸ºç‹¬ç«‹çš„ã€å¯å±•å¼€çš„æ„ä»¶å‘å¸ƒ"><a href="#åŒºåˆ†å¼€çš„æœåŠ¡å¯ä»¥ä½œä¸ºç‹¬ç«‹çš„ã€å¯å±•å¼€çš„æ„ä»¶å‘å¸ƒ" class="headerlink" title="åŒºåˆ†å¼€çš„æœåŠ¡å¯ä»¥ä½œä¸ºç‹¬ç«‹çš„ã€å¯å±•å¼€çš„æ„ä»¶å‘å¸ƒ"></a>åŒºåˆ†å¼€çš„æœåŠ¡å¯ä»¥ä½œä¸ºç‹¬ç«‹çš„ã€å¯å±•å¼€çš„æ„ä»¶å‘å¸ƒ</h2><ul><li>å¤§å¤šæ•°ç»„ç»‡éƒ½å€¾æ³¨äºè®¾è®¡å’Œå®æ–½æœ‰å¼¹æ€§çš„æŒç»­äº¤ä»˜ç®¡é“ï¼Œè¿™å¯ä»¥å¸®åŠ©ä»–ä»¬ï¼šåœ¨ä¸€ä¸ªå®‰å…¨çš„ã€å—ä¿æŠ¤çš„å’Œå¯å®¡è®¡çš„æ–¹å¼ä¸‹æµ‹è¯•æ–°åŠŸèƒ½ã€‚</li><li>å¾ˆå¿«ä»å¤±è´¥ä¸­æ¢å¤ï¼Œè€Œä¸å»å½±å“å®¢æˆ·ã€‚</li></ul><p>å°½ç®¡æ•´ä½“æ¶æ„æ¨¡å¼æ˜¯æˆåŠŸçš„ï¼Œä½†å¾®æœåŠ¡æä¾›çš„æ¨¡å—æ€§ä½¿å‘å¸ƒèƒ½å¤Ÿå¿«é€Ÿåœ°ä»¥å¢é‡çš„æ–¹å¼è¿›è¡Œã€‚DevOpsä¹Ÿæ”¯æŒå°æ‰¹é‡çš„è§„æ¨¡ï¼Œå¹¶å…è®¸å°å‹å›¢é˜Ÿæ‹¥æœ‰æœåŠ¡å¹¶å°†å…¶äº¤ä»˜ã€‚è¿™æ ·çš„è®¾è®¡èƒ½ä½¿å¾®æœåŠ¡å’ŒDevOpsåœ¨å’Œè°åœ°å‘æŒ¥ä½œç”¨ï¼Œä»¥å¸®åŠ©ç»„ç»‡æ‰©å¤§è§„æ¨¡ã€‚</p><h2 id="å¾®æœåŠ¡å’ŒDevOpsæé«˜äº†æµ‹è¯•å‘¨æœŸï¼Œå¹¶ä¸”åŠ é€Ÿæ¨å‘å¸‚åœº"><a href="#å¾®æœåŠ¡å’ŒDevOpsæé«˜äº†æµ‹è¯•å‘¨æœŸï¼Œå¹¶ä¸”åŠ é€Ÿæ¨å‘å¸‚åœº" class="headerlink" title="å¾®æœåŠ¡å’ŒDevOpsæé«˜äº†æµ‹è¯•å‘¨æœŸï¼Œå¹¶ä¸”åŠ é€Ÿæ¨å‘å¸‚åœº"></a>å¾®æœåŠ¡å’ŒDevOpsæé«˜äº†æµ‹è¯•å‘¨æœŸï¼Œå¹¶ä¸”åŠ é€Ÿæ¨å‘å¸‚åœº</h2><p>ä¸€äº›ç»„ç»‡å¸¸å¸¸é¢ä¸´æ¿€çƒˆçš„ç«äº‰ï¼Œæˆ–è€…è‡³å°‘æ˜¯ä¿æŒä¸æ‰é˜Ÿã€‚ä»–ä»¬æƒ³å»ºç«‹å¯æŒç»­çš„å•†ä¸šæ¨¡å¼ï¼Œè¿™æ ·å°±å¯ä»¥è®©æ–°æƒ³æ³•è¿…é€Ÿä»˜è¯¸å®è·µï¼Œè€Œä¸ä¼šæ¶ˆç£¨å›¢é˜Ÿç²¾åŠ›ã€‚ç„¶è€Œï¼Œç”¨åºå¤§åƒµåŒ–çš„ç³»ç»Ÿæ¥å®ç°è¿™ä¸€ç›®æ ‡æ˜¯æœ‰å¯èƒ½çš„ï¼Œä½†ä¸é¢—ç²’çŠ¶çš„å¾®æœåŠ¡ç›¸æ¯”ï¼Œå¯èƒ½æ€§è¦å°å¾—å¤šã€‚ä¸‹é¢å°±æ˜¯åŸå› ã€‚</p><p>ä¸€ä¸ªåºç„¶çš„ç³»ç»Ÿç»å¸¸å¯¼è‡´ä¸€åœºâ€œåºå¤§æµ‹è¯•â€ï¼š</p><ul><li>ç³»ç»Ÿåœ¨é‡è¦çš„ä¸€æ®µæ—¶é—´å†…è¢«è®¾è®¡å’Œå®æ–½ï¼Œåœ¨æ­¤æœŸé—´å›¢é˜Ÿæˆå‘˜å¯èƒ½å¤šæ¬¡æ”¹åŠ¨ã€‚</li><li>å¯èƒ½ä¸å…è®¸å•ç‹¬æµ‹è¯•ï¼Œå› ä¸ºæµ‹è¯•ç”¨ä¾‹ã€è®¾è®¡æµ‹è¯•æ•°æ®å’Œæµ‹è¯•é…ç½®æ²¡æœ‰è¢«è®¾è®¡ç”¨æ¥ç‹¬ç«‹æ‰§è¡Œã€‚</li><li>ç”±äºæ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæ¯ä¸ªæ–°ç‰ˆæœ¬å°±è¶Šæ¥è¶Šå¤§ã€‚æœ‰æ—¶å€™ï¼Œå³ä½¿æ˜¯åœ¨ç”Ÿäº§ä¸­ä¸å¸¸ç”¨çš„åŠŸèƒ½ï¼Œä¹Ÿä¼šæœ‰ç¼“æ…¢çš„ã€å½’æ¡£çš„è¿‡æœŸæµ‹è¯•ã€‚åœ¨æµ‹è¯•å­˜æ¡£è¿‡ç¨‹ä¸­å¯èƒ½å­˜åœ¨ä¸ç¡®å®šæ€§ï¼Œå› ä¸ºå¯èƒ½æ²¡æœ‰ä¸€ä¸ªäººå®Œå…¨ç†è§£ç³»ç»Ÿæ¶æ„ã€‚</li></ul><p>é¢—ç²’åº¦çš„å¾®æœåŠ¡é€šè¿‡ç‹¬ç«‹çš„ã€å¯éƒ¨ç½²ç‰ˆæœ¬çš„æ„å»ºè¢«å‘å¸ƒåˆ°ç”Ÿäº§ä¸­ï¼Œè¿™äº›æ„ä»¶åˆ†åˆ«è¢«éªŒè¯ã€‚å¾®æœåŠ¡ç›¸äº’ä½œç”¨ï¼Œæä¾›ç‰¹å®šçš„å®¢æˆ·ç”¨ä¾‹ï¼Œå› æ­¤éœ€è¦æ™ºèƒ½é›†æˆæµ‹è¯•ã€‚åœ¨é›†æˆæµ‹è¯•æœŸé—´ï¼Œè¿™äº›é‚»è¿‘çš„æœåŠ¡ä¸­æœ‰ä¸€äº›æ˜¯ç”±å®ƒä»¬çš„æµ‹è¯•æ›¿èº«å’Œæ¸…æ™°å®šä¹‰çš„åˆçº¦æ¥è¡¨ç¤ºçš„ã€‚æµ‹è¯•æ›¿èº«å’Œåˆçº¦åº”è¯¥è¢«é‡è§†ï¼Œå¹¶ä¸”åº”è¯¥ç”±æ‹¥æœ‰ã€äº¤ä»˜å’Œç»´æŠ¤çœŸå®æœåŠ¡å’Œæ¥å£çš„å°å›¢é˜Ÿæ‹¥æœ‰ã€‚</p><h1 id="å¾®æœåŠ¡æ¶æ„é¢ä¸´çš„æŒ‘æˆ˜"><a href="#å¾®æœåŠ¡æ¶æ„é¢ä¸´çš„æŒ‘æˆ˜" class="headerlink" title="å¾®æœåŠ¡æ¶æ„é¢ä¸´çš„æŒ‘æˆ˜"></a>å¾®æœåŠ¡æ¶æ„é¢ä¸´çš„æŒ‘æˆ˜</h1><ol><li>è¿ç»´å¼€é”€ã€‚æ›´å¤šçš„æœåŠ¡ä¹Ÿå°±æ„å‘³ç€æ›´å¤šçš„è¿ç»´ï¼Œäº§å“å›¢é˜Ÿéœ€è¦ä¿è¯æ‰€æœ‰çš„ç›¸å…³æœåŠ¡éƒ½æœ‰å®Œå–„çš„ç›‘æ§ç­‰åŸºç¡€è®¾æ–½ï¼Œä¼ ç»Ÿçš„æ¶æ„å¼€å‘è€…åªéœ€è¦ä¿è¯ä¸€ä¸ªåº”ç”¨æ­£å¸¸è¿è¡Œï¼Œè€Œç°åœ¨å´éœ€è¦ä¿è¯å‡ åç”šè‡³ä¸Šç™¾é“å·¥åºé«˜æ•ˆè¿è½¬ï¼Œè¿™æ˜¯ä¸€ä¸ªè‰°å·¨çš„ä»»åŠ¡ã€‚</li><li>DevOpsè¦æ±‚ã€‚ä½¿ç”¨å¾®æœåŠ¡æ¶æ„åï¼Œè¿™å°±æ„å‘³ç€å›¢é˜Ÿéœ€è¦é«˜å“è´¨çš„DevOpså’Œè‡ªåŠ¨åŒ–æŠ€æœ¯ã€‚è€Œç°åœ¨ï¼Œè¿™æ ·çš„å…¨æ ˆå¼äººæ‰å¾ˆå°‘ã€‚</li><li>éšå¼æ¥å£ã€‚æœåŠ¡å’ŒæœåŠ¡ä¹‹é—´é€šè¿‡æ¥å£æ¥â€œè”ç³»â€ï¼Œå½“æŸä¸€ä¸ªæœåŠ¡æ›´æ”¹æ¥å£æ ¼å¼æ—¶ï¼Œå¯èƒ½æ¶‰åŠåˆ°æ­¤æ¥å£çš„æ‰€æœ‰æœåŠ¡éƒ½éœ€è¦åšè°ƒæ•´ã€‚</li><li>é‡å¤åŠ³åŠ¨ã€‚åœ¨å¾ˆå¤šçš„æœåŠ¡ä¸­å¯èƒ½éƒ½ä¼šä½¿ç”¨åˆ°åŒä¸€ä¸ªåŠŸèƒ½ï¼Œè€Œè¿™ä¸€åŠŸèƒ½ç‚¹æ²¡æœ‰è¶³å¤Ÿå¤§åˆ°æä¾›ä¸€ä¸ªæœåŠ¡çš„ç¨‹åº¦ï¼Œè¿™ä¸ªæ—¶å€™å¯èƒ½ä¸åŒçš„æœåŠ¡å›¢é˜Ÿéƒ½ä¼šå•ç‹¬å¼€å‘è¿™ä¸€åŠŸèƒ½ï¼Œé‡å¤çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿™è¿èƒŒäº†è‰¯å¥½çš„è½¯ä»¶å·¥ç¨‹ä¸­çš„å¾ˆå¤šåŸåˆ™ã€‚</li><li>åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚å¾®æœåŠ¡é€šè¿‡REST APIæˆ–æ¶ˆæ¯æ¥å°†ä¸åŒçš„æœåŠ¡è”ç³»èµ·æ¥ï¼Œè¿™åœ¨ä¹‹å‰å¯èƒ½åªæ˜¯ä¸€ä¸ªç®€å•çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿä¹Ÿå°±æ„å‘³ç€å¼€å‘è€…éœ€è¦è€ƒè™‘ç½‘ç»œå»¶è¿Ÿã€å®¹é”™ã€æ¶ˆæ¯åºåˆ—åŒ–ã€ä¸å¯é çš„ç½‘ç»œã€å¼‚æ­¥ã€ç‰ˆæœ¬æ§åˆ¶ã€è´Ÿè½½ç­‰ï¼Œè€Œé¢å¯¹å¦‚æ­¤å¤šçš„å¾®æœåŠ¡éƒ½éœ€è¦åˆ†å¸ƒå¼æ—¶ï¼Œæ•´ä¸ªäº§å“éœ€è¦æœ‰ä¸€æ•´å¥—å®Œæ•´çš„æœºåˆ¶æ¥ä¿è¯å„ä¸ªæœåŠ¡å¯ä»¥æ­£å¸¸è¿è½¬ã€‚</li></ol><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æˆ‘è®¤ä¸ºå¾®æœåŠ¡æ¶æ„å·²ç»æˆä¸ºäº†äº’è”ç½‘ä¼ä¸šæœ€é‡è¦çš„æŠ€æœ¯ä¹‹ä¸€ï¼Œé…åˆDevopsèƒ½æ›´åŠ ç®€åŒ–äº†è½¯ä»¶çš„äº¤ä»˜æ–¹æ³•ï¼Œå¦‚æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½²ï¼Œå¹¶å¸®åŠ©ç”Ÿæˆå¯ä¼¸ç¼©çš„äº¤ä»˜ç®¡é“ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://baike.baidu.com/item/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84" target="_blank" rel="noopener">ç™¾åº¦ç™¾ç§‘-å¾®æœåŠ¡æ¶æ„</a></p><p><a href="http://dockone.io/article/5976" target="_blank" rel="noopener">å¾®æœåŠ¡ç»™DevOpså¸¦æ¥äº†ä»€ä¹ˆï¼Ÿ</a></p><p><a href="https://blog.csdn.net/enweitech/article/details/51819839" target="_blank" rel="noopener">æ—¶ä¸‹æµè¡Œdevopså…³é”®è¯ï¼šåˆ†å¸ƒå¼æ¶æ„ã€ä¸€ä½“åŒ–æ¶æ„å’Œå¾®æœåŠ¡æ¶æ„</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è·Ÿæˆ‘å­¦Devops </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Devops </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> Rest Api </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¦»çº¿å®‰è£…Mysql5.7.28åŠè°ƒä¼˜</title>
      <link href="/2020/05/01/mysql/mysql-install/"/>
      <url>/2020/05/01/mysql/mysql-install/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h1><ul><li>æ“ä½œç³»ç»Ÿcentos7.6</li><li>æœºå™¨æ€§èƒ½32C 64G å¤–æŒ‚2TSSDåˆ°/dataç›®å½•ï¼ˆæ•°æ®åº“å»ºè®®å¤–æŒ‚ç£ç›˜ï¼‰  </li><li>mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz</li><li>ä¸‹è½½é“¾æ¥</li><li><a href="https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz" target="_blank" rel="noopener">https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz</a></li><li>ç™¾åº¦ç½‘ç›˜é“¾æ¥</li><li><a href="https://pan.baidu.com/s/1cadkpE_lDtaStWxUv17-QQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1cadkpE_lDtaStWxUv17-QQ</a>  æå–ç  54rl</li></ul><h1 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h1><h2 id="è§£å‹"><a href="#è§£å‹" class="headerlink" title="è§£å‹"></a>è§£å‹</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; groupadd mysql</span><br><span class="line">shell&gt; useradd -r -g mysql -s &#x2F;bin&#x2F;false mysql</span><br><span class="line">shell&gt; mkdir -vp &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;&#123;data,logs,tmp&#125;</span><br><span class="line">shell&gt; mkdir -vp &#x2F;opt&#x2F;mysql</span><br><span class="line">shell&gt; cd &#x2F;opt&#x2F;mysql&#x2F;</span><br><span class="line">shell&gt; tar zxvf mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line">shell&gt; cd &#x2F;usr&#x2F;local</span><br><span class="line">shell&gt; ln -s &#x2F;opt&#x2F;mysql&#x2F;mysql-5.7.28-linux-glibc2.12-x86_64  mysql</span><br></pre></td></tr></table></figure><h2 id="ä¼˜åŒ–é…ç½®æ–‡ä»¶"><a href="#ä¼˜åŒ–é…ç½®æ–‡ä»¶" class="headerlink" title="ä¼˜åŒ–é…ç½®æ–‡ä»¶"></a>ä¼˜åŒ–é…ç½®æ–‡ä»¶</h2><p>é‡Œé¢çš„å‚æ•°éƒ½æ˜¯åœ¨é€‚ç”¨äºæœ¬æ–‡ç¯å¢ƒå‡†å¤‡æœºå™¨é…ç½®çš„åŸºç¡€ä¸Šè°ƒä¼˜åçš„ç»“æœï¼Œå¦‚æœä½ æƒ³å®‰è£…Mysqlçš„æœºå™¨é…ç½®ä¸äºæœ¬æ–‡ç¯å¢ƒå‡†å¤‡æœºå™¨é…ç½®ç›¸å·®å¾ˆå¤§è¯·ä¸è¦ç›²ç›®å¤åˆ¶ï¼Œè¯·çœ‹ä¸‹é¢3å¤§é…ç½®é¡¹å†…å®¹é‡Œå…·ä½“å‚æ•°çš„è®²è§£ï¼Œå¤ªé•¿ä¸çœ‹å¯ä»¥ç›´æ¥çœ‹æ€»ç»“çš„é…ç½®æ–‡ä»¶ã€‚</p><h3 id="å®¢æˆ·ç«¯é»˜è®¤è®¾ç½®å†…å®¹"><a href="#å®¢æˆ·ç«¯é»˜è®¤è®¾ç½®å†…å®¹" class="headerlink" title="å®¢æˆ·ç«¯é»˜è®¤è®¾ç½®å†…å®¹"></a>å®¢æˆ·ç«¯é»˜è®¤è®¾ç½®å†…å®¹</h3><ul><li>socket å¯ä»¥æ ¹æ®å®é™…ç£ç›˜æŒ‚è½½çš„ç›®å½•è¿›è¡Œè°ƒæ•´<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[client]   #å®¢æˆ·ç«¯é»˜è®¤è®¾ç½®å†…å®¹</span><br><span class="line"></span><br><span class="line">user&#x3D;root</span><br><span class="line">password&#x3D;123456</span><br><span class="line">port    &#x3D; 3306</span><br><span class="line">socket &#x3D; &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;data&#x2F;mysql.sock </span><br><span class="line">#é¿å…MySQLçš„å¤–éƒ¨é”å®šï¼Œå‡å°‘å‡ºé”™å‡ ç‡å¢å¼ºç¨³å®šæ€§ã€‚</span><br></pre></td></tr></table></figure></li></ul><h3 id="ä½¿ç”¨mysqlå‘½ä»¤ç™»å½•mysqlæ•°æ®åº“æ—¶çš„é»˜è®¤è®¾ç½®"><a href="#ä½¿ç”¨mysqlå‘½ä»¤ç™»å½•mysqlæ•°æ®åº“æ—¶çš„é»˜è®¤è®¾ç½®" class="headerlink" title="ä½¿ç”¨mysqlå‘½ä»¤ç™»å½•mysqlæ•°æ®åº“æ—¶çš„é»˜è®¤è®¾ç½®"></a>ä½¿ç”¨mysqlå‘½ä»¤ç™»å½•mysqlæ•°æ®åº“æ—¶çš„é»˜è®¤è®¾ç½®</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[mysql]  #ä»£è¡¨æˆ‘ä»¬ä½¿ç”¨mysqlå‘½ä»¤ç™»å½•mysqlæ•°æ®åº“æ—¶çš„é»˜è®¤è®¾ç½®</span><br><span class="line"></span><br><span class="line">#å‚æ•°å¯¹äºåšè¿ç»´çš„äººæ¥è¯´å¾ˆé‡è¦ã€‚æˆ‘ä»¬ç™»å…¥mysqlæ•°æ®åº“åï¼Œmysqlçš„æç¤ºç¬¦åªæ˜¯ä¸€ä¸ªå¾ˆç®€å•å†…å®¹ mysql&gt;,æ²¡æœ‰å…¶ä»–ä»»ä½•ä¿¡æ¯ã€‚é€šè¿‡--prompt&#x3D;nameå¯ä»¥è‡ªå®šä¹‰æç¤ºä¿¡æ¯ï¼Œé€šè¿‡é…ç½®æ˜¾ç¤ºç™»å…¥çš„ä¸»æœºåœ°å€ï¼Œç™»é™†ç”¨æˆ·åï¼Œå½“å‰æ—¶é—´ï¼Œå½“å‰æ•°æ®åº“schemaç­‰å¾…ã€‚ä¸ªäººå¼ºçƒˆè¦æ±‚åŠ ä¸Šç™»å…¥ä¸»æœºåï¼Œç™»é™†ç”¨æˆ·åï¼Œå½“å‰åº“è¿™ä¸‰é¡¹åŠ å…¥æç¤ºå†…å®¹ã€‚</span><br><span class="line">prompt&#x3D;&quot;\u@dev-data-01 \R:\m:\s [\d]&gt; &quot; </span><br><span class="line">#è‡ªåŠ¨è¡¥å…¨çš„æ„æ€ï¼Œå°±åƒæˆ‘ä»¬åœ¨linuxå‘½ä»¤è¡Œé‡Œè¾“å…¥å‘½ä»¤çš„æ—¶å€™ï¼Œä½¿ç”¨tabé”®çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„</span><br><span class="line">no-auto-rehash </span><br><span class="line">#utf8mb4å…¼å®¹utf8ï¼Œä¸”æ¯”utf8èƒ½è¡¨ç¤ºæ›´å¤šçš„å­—ç¬¦ï¼Œæ˜¯utf8å­—ç¬¦é›†çš„è¶…é›†ã€‚</span><br><span class="line">default-character-set&#x3D;utf8mb4</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åº“è‡ªèº«çš„é»˜è®¤è®¾ç½®"><a href="#æ•°æ®åº“è‡ªèº«çš„é»˜è®¤è®¾ç½®" class="headerlink" title="æ•°æ®åº“è‡ªèº«çš„é»˜è®¤è®¾ç½®"></a>æ•°æ®åº“è‡ªèº«çš„é»˜è®¤è®¾ç½®</h3><p>æ•°æ®åº“è‡ªèº«é…ç½®åˆ†ä¸º4é¡¹ </p><ul><li><p>basic settings    </p></li><li><p>log settings</p></li><li><p>replication settings</p></li><li><p>innodb settings</p></li></ul><h4 id="basic-settings"><a href="#basic-settings" class="headerlink" title="basic settings"></a>basic settings</h4><ul><li><p>datadir å¯ä»¥æ ¹æ®å®é™…ç£ç›˜æŒ‚è½½çš„ç›®å½•è¿›è¡Œè°ƒæ•´</p></li><li><p>socket å¯ä»¥æ ¹æ®å®é™…ç£ç›˜æŒ‚è½½çš„ç›®å½•è¿›è¡Œè°ƒæ•´</p></li><li><p>secure_file_priv å¯ä»¥æ ¹æ®å®é™…ç£ç›˜æŒ‚è½½çš„ç›®å½•è¿›è¡Œè°ƒæ•´</p></li><li><p>skip_name_resolve  å¦‚æœä½ çš„mysqlä¸»æœºæŸ¥è¯¢DNSå¾ˆæ…¢æˆ–æ˜¯æœ‰å¾ˆå¤šå®¢æˆ·ç«¯ä¸»æœºæ—¶ä¼šå¯¼è‡´è¿æ¥å¾ˆæ…¢ï¼Œæ˜¯å› ä¸ºå¼€å‘çš„æœºå™¨æ˜¯ä¸èƒ½å¤Ÿè¿æ¥å¤–ç½‘çš„ï¼Œæ‰€ä»¥DNSè§£ææ˜¯ä¸å¯èƒ½å®Œæˆçš„ï¼Œè¿™æ—¶å°±éœ€è¦ç¦ç”¨</p></li><li><p>external-locking å¦‚æœæ˜¯å•æœºéƒ¨ç½²éœ€è¦ç¦ç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]  #ä»£è¡¨æ•°æ®åº“è‡ªèº«çš„é»˜è®¤è®¾ç½®</span><br><span class="line">########basic settings########</span><br><span class="line">user    &#x3D; mysql</span><br><span class="line">port    &#x3D; 3306</span><br><span class="line">basedir &#x3D; &#x2F;usr&#x2F;local&#x2F;mysql</span><br><span class="line">datadir &#x3D; &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;data</span><br><span class="line">socket  &#x3D; &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;mysql.sock</span><br><span class="line">#å‚æ•°æ˜¯ç”¨æ¥é™åˆ¶LOAD DATA, SELECT ... OUTFILE, and LOAD_FILE()ä¼ åˆ°å“ªä¸ªæŒ‡å®šç›®å½•çš„ï¼Œä¸é…ç½®ä¸èƒ½ç”¨è¿™ä¸ªå‘½ä»¤å¯¼å‡ºæ–‡ä»¶ã€‚</span><br><span class="line">secure_file_priv&#x3D;&#x2F;data&#x2F;mysql</span><br><span class="line">#è¯¥å˜é‡çš„å€¼æ˜¯ONæˆ– OFFæŒ‡ç¤ºæ˜¯å¦å¯ç”¨äº†æ€§èƒ½æ¨¡å¼ã€‚</span><br><span class="line">performance_schema &#x3D; 1</span><br><span class="line">#æœåŠ¡å™¨å®‰è£…æ—¶æŒ‡å®šçš„é»˜è®¤å­—ç¬¦é›†è®¾å®šã€‚</span><br><span class="line">character_set_server&#x3D;utf8mb4   </span><br><span class="line">#æ“ä½œç³»ç»Ÿå…è®¸mysqldæ‰“å¼€çš„æ–‡ä»¶æ•°é‡ã€‚</span><br><span class="line">open_files_limit &#x3D; 655350  </span><br><span class="line">#äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºREAD COMMITTEDã€‚</span><br><span class="line">transaction_isolation &#x3D; READ-COMMITTED</span><br><span class="line">#é’ˆå¯¹äº¤äº’å¼è¿æ¥æœåŠ¡å™¨å…³é—­è¿æ¥å‰ç­‰å¾…æ´»åŠ¨çš„ç§’æ•°ï¼Œä¾‹å¦‚mysqlå®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“ã€‚</span><br><span class="line">interactive_timeout &#x3D; 31536000</span><br><span class="line">#é’ˆå¯¹éäº¤äº’å¼è¿æ¥æœåŠ¡å™¨å…³é—­è¿æ¥å‰ç­‰å¾…æ´»åŠ¨çš„ç§’æ•°ï¼Œä¾‹å¦‚é€šè¿‡jdbcè¿æ¥æ•°æ®åº“ã€‚</span><br><span class="line">wait_timeout &#x3D; 31536000</span><br><span class="line">#å®¢æˆ·ç«¯è¿æ¥æ˜¯å¦è§£æä¸»æœºåã€‚0ï¼Œmysqldåœ¨æ£€æŸ¥å®¢æˆ·ç«¯è¿æ¥æ—¶è§£æä¸»æœºåï¼›1ï¼Œmysqldä»…ä½¿ç”¨IPç¼–å·ã€‚</span><br><span class="line">skip_name_resolve &#x3D; 1  </span><br><span class="line">#è¯´æ˜æ˜¯å¦æ•°æ®ç›®å½•æ‰€åœ¨çš„æ–‡ä»¶ç³»ç»Ÿå¯¹æ–‡ä»¶åçš„å¤§å°å†™æ•æ„Ÿã€‚1è¯´æ˜å¯¹æ–‡ä»¶åçš„å¤§å°å†™ä¸æ•æ„Ÿã€‚</span><br><span class="line">lower_case_table_names&#x3D;1    </span><br><span class="line">#åœ¨MySQLæš‚æ—¶åœæ­¢å›ç­”æ–°è¯·æ±‚ä¹‹å‰çš„çŸ­æ—¶é—´å†…å¯ä»¥å †å å¤šå°‘ä¸ªè¯·æ±‚ã€‚ä»…å½“æ‚¨æœŸæœ›åœ¨çŸ­æ—¶é—´å†…æœ‰å¤§é‡è¿æ¥æ—¶ï¼Œæ‰éœ€è¦å¢åŠ æ­¤æ•°é‡ã€‚</span><br><span class="line">back_log &#x3D; 1024</span><br><span class="line">#æŒ‡å®šMySQLå…è®¸çš„æœ€å¤§è¿æ¥è¿›ç¨‹æ•°ã€‚å¦‚æœåœ¨è®¿é—®è®ºå›æ—¶ç»å¸¸å‡ºç°Too Many Connectionsçš„é”™è¯¯æç¤ºï¼Œåˆ™éœ€è¦å¢å¤§è¯¥å‚æ•°å€¼ã€‚</span><br><span class="line">max_connections &#x3D; 10240    </span><br><span class="line">#å¦‚æœMySQLæœåŠ¡å™¨è¿ç»­æ¥æ”¶åˆ°æ¥è‡ªåŒä¸€ä¸»æœºçš„è¯·æ±‚ä¸”éƒ½è¢«æ‹’ç»ï¼Œæ¬¡æ•°è¶…è¿‡max_connect_errorsçš„è®¾å®šå€¼æ—¶ï¼ŒMySQLæœåŠ¡å™¨å°±ä¼šé˜»æ­¢è¿™å°ä¸»æœºåç»­çš„æ‰€æœ‰è¯·æ±‚ã€‚</span><br><span class="line">max_connect_errors &#x3D; 1000000</span><br><span class="line">#è¡¨æ–‡ä»¶æè¿°ç¬¦çš„ç¼“å­˜å¤§å°ã€‚</span><br><span class="line">table_open_cache &#x3D; 20480</span><br><span class="line">#å¯ä»¥å­˜å‚¨åœ¨å®šä¹‰é«˜é€Ÿç¼“å­˜ä¸­çš„è¡¨å®šä¹‰ï¼ˆæ¥è‡ªæ–‡ä»¶ï¼‰çš„æ•°é‡ ã€‚</span><br><span class="line">table_definition_cache &#x3D; 20480</span><br><span class="line">#æ‰“å¼€è¡¨ç¼“å­˜å®ä¾‹çš„æ•°é‡ã€‚</span><br><span class="line">table_open_cache_instances &#x3D; 64</span><br><span class="line">#æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°ã€‚</span><br><span class="line">thread_stack &#x3D; 512K</span><br><span class="line">#è·³è¿‡å¤–éƒ¨é”å®šã€‚å¦‚æœæ˜¯å•æœåŠ¡å™¨ç¯å¢ƒï¼Œåˆ™å°†å…¶ç¦ç”¨å³å¯,å¦‚æœæ˜¯å¤šæœåŠ¡å™¨ç¯å¢ƒ,åˆ™æ³¨é‡Šæ‰è¿™ä¸€è¡Œå³å¯ã€‚</span><br><span class="line">external-locking &#x3D; FALSE</span><br><span class="line">#é™åˆ¶serveræ¥å—çš„æ•°æ®åŒ…å¤§å°ã€‚</span><br><span class="line">max_allowed_packet &#x3D; 32M</span><br><span class="line">#æ¯ä¸ªå¿…é¡»æ‰§è¡Œæ’åºçš„ä¼šè¯éƒ½ä¼šåˆ†é…æ­¤å¤§å°çš„ç¼“å†²åŒºã€‚</span><br><span class="line">sort_buffer_size &#x3D; 4M</span><br><span class="line">#ç”¨äºæ™®é€šç´¢å¼•æ‰«æï¼ŒèŒƒå›´ç´¢å¼•æ‰«æå’Œä¸ä½¿ç”¨ç´¢å¼•çš„è”æ¥çš„ç¼“å†²åŒºçš„æœ€å°å¤§å°ï¼Œä»è€Œæ‰§è¡Œå…¨è¡¨æ‰«æã€‚</span><br><span class="line">join_buffer_size &#x3D; 4M</span><br><span class="line">#æœåŠ¡å™¨åº”ç¼“å­˜å¤šå°‘çº¿ç¨‹ä»¥ä¾›é‡ç”¨ã€‚</span><br><span class="line">thread_cache_size &#x3D; 15360</span><br><span class="line">#å†…éƒ¨å†…å­˜ä¸´æ—¶è¡¨çš„æœ€å¤§å¤§å°ã€‚</span><br><span class="line">tmp_table_size &#x3D; 32M</span><br><span class="line">#æ­¤å˜é‡è®¾ç½®MEMORYå…è®¸ç”¨æˆ·åˆ›å»ºçš„è¡¨å¢é•¿åˆ°çš„æœ€å¤§å¤§å°ã€‚å˜é‡çš„å€¼ç”¨äºè®¡ç®—MEMORYè¡¨MAX_ROWSå€¼ã€‚</span><br><span class="line">max_heap_table_size &#x3D; 32M</span><br><span class="line">#æ­¤å˜é‡æŒ‡å®šå°è¯•è·å–å…ƒæ•°æ®é”å®šçš„è¶…æ—¶ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚</span><br><span class="line">lock_wait_timeout &#x3D; 3600</span><br><span class="line">#æ­¤å˜é‡ç¡®å®šæœåŠ¡å™¨å¯¹åˆ—ä¸­çš„é»˜è®¤å€¼å’ŒNULL-valueå¤„ç†å¯ç”¨æŸäº›éæ ‡å‡†è¡Œä¸ºTIMESTAMPã€‚</span><br><span class="line">explicit_defaults_for_timestamp &#x3D; 1</span><br><span class="line">#æ¯ä¸ªå¿…é¡»æ‰§è¡Œæ’åºçš„ä¼šè¯éƒ½ä¼šåˆ†é…æ­¤å¤§å°çš„ç¼“å†²åŒºã€‚</span><br><span class="line">sort_buffer_size &#x3D; 33554432</span><br></pre></td></tr></table></figure></li></ul><h4 id="log-settings"><a href="#log-settings" class="headerlink" title="log settings"></a>log settings</h4><ul><li><p>slow_query_log_file å¯ä»¥æ ¹æ®å®é™…ç£ç›˜æŒ‚è½½çš„ç›®å½•è¿›è¡Œè°ƒæ•´</p></li><li><p>log-bin å¯ä»¥æ ¹æ®å®é™…ç£ç›˜æŒ‚è½½çš„ç›®å½•è¿›è¡Œè°ƒæ•´</p></li><li><p>log-error å¯ä»¥æ ¹æ®å®é™…ç£ç›˜æŒ‚è½½çš„ç›®å½•è¿›è¡Œè°ƒæ•´</p></li><li><p>long_query_time ä¿—ç§°å®šä¹‰æ…¢sqlçš„æ ‡å‡†,å¯ä»¥æ ¹æ®å®é™…é¡¹ç›®å®šä¹‰å…·ä½“æ ‡å‡†</p></li><li><p>log_throttle_queries_not_using_indexeséœ€è¦log_queries_not_using_indexeså¯ç”¨</p></li><li><p>expire_logs_days Binlog è‡ªåŠ¨æ¸…ç†æ—¶é—´</p></li><li><p>max_binlog_cache_size æ¨èçš„æœ€å¤§å€¼ä¸º4GBã€‚è¿™æ˜¯ç”±äºMySQLå½“å‰æ— æ³•ä½¿ç”¨å¤§äº4GBçš„äºŒè¿›åˆ¶æ—¥å¿—ä½ç½®ã€‚</p></li><li><p>binlog_format åœ¨MySQL 5.7.7å’Œæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤å€¼ä¸ºROWã€‚</p></li><li><p>sync_binlog=1ï¼šå¯ç”¨åœ¨æäº¤äº‹åŠ¡ä¹‹å‰å°†äºŒè¿›åˆ¶æ—¥å¿—åŒæ­¥åˆ°ç£ç›˜ã€‚è¿™æ˜¯æœ€å®‰å…¨çš„è®¾ç½®ï¼Œä½†ç”±äºç£ç›˜å†™å…¥æ¬¡æ•°å¢åŠ ï¼Œå¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚</p></li><li><p>sync_binlog=0ï¼šç¦ç”¨MySQLæœåŠ¡å™¨å°†äºŒè¿›åˆ¶æ—¥å¿—åŒæ­¥åˆ°ç£ç›˜çš„åŠŸèƒ½ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼ŒMySQLæœåŠ¡å™¨ä¾é æ“ä½œç³»ç»Ÿä¸æ—¶åœ°å°†äºŒè¿›åˆ¶æ—¥å¿—åˆ·æ–°åˆ°ç£ç›˜ä¸Šï¼Œå°±åƒå¤„ç†å…¶ä»–ä»»ä½•æ–‡ä»¶ä¸€æ ·ã€‚æ­¤è®¾ç½®æä¾›æœ€ä½³æ€§èƒ½ï¼Œä½†æ˜¯åœ¨ç”µæºæ•…éšœæˆ–æ“ä½œç³»ç»Ÿå´©æºƒçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å¯èƒ½æäº¤äº†å°šæœªåŒæ­¥åˆ°äºŒè¿›åˆ¶æ—¥å¿—çš„äº‹åŠ¡ã€‚</p></li><li><p>sync_binlog=Nï¼Œå…¶ä¸­Nçš„å€¼ä¸æ˜¯0æˆ–1ï¼šæ˜¯NäºŒè¿›åˆ¶æ—¥å¿—æäº¤ç»„å·²æ”¶é›†ä¹‹åï¼ŒäºŒè¿›åˆ¶æ—¥å¿—å°†åŒæ­¥åˆ°ç£ç›˜ ã€‚åœ¨ç”µæºæ•…éšœæˆ–æ“ä½œç³»ç»Ÿå´©æºƒçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å¯èƒ½æäº¤äº†å°šæœªåˆ·æ–°åˆ°äºŒè¿›åˆ¶æ—¥å¿—çš„äº‹åŠ¡ã€‚ç”±äºç£ç›˜å†™å…¥æ¬¡æ•°çš„å¢åŠ ï¼Œæ­¤è®¾ç½®å¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚è¾ƒé«˜çš„å€¼å¯ä»¥æé«˜æ€§èƒ½ï¼Œä½†ä¼šå¢åŠ æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚</p></li><li><p>ä¸ºäº†åœ¨InnoDBä¸äº‹åŠ¡ä¸€èµ·ä½¿ç”¨çš„å¤åˆ¶è®¾ç½®ä¸­è·å¾—æœ€å¤§çš„æŒä¹…æ€§å’Œä¸€è‡´æ€§ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹è®¾ç½®ï¼šsync_binlog=1ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">########log settings########</span><br><span class="line">#æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„åç§°</span><br><span class="line">slow_query_log_file &#x3D; &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;logs&#x2F;slow.log</span><br><span class="line">#é”™è¯¯æ—¥å¿—è¾“å‡ºç›®æ ‡ã€‚å¦‚æœç›®æ ‡æ˜¯æ§åˆ¶å°ï¼Œåˆ™å€¼ä¸ºstderrã€‚å¦åˆ™ï¼Œç›®æ ‡æ˜¯æ–‡ä»¶ï¼Œlog_errorå€¼æ˜¯æ–‡ä»¶åã€‚</span><br><span class="line">log-error &#x3D; &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;logs&#x2F;error.log</span><br><span class="line">#å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—è®°å½•ã€‚å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—è®°å½•åï¼ŒæœåŠ¡å™¨ä¼šå°†æ‰€æœ‰æ›´æ”¹æ•°æ®çš„è¯­å¥è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—ä¸­ï¼Œè¯¥æ—¥å¿—ç”¨äºå¤‡ä»½å’Œå¤åˆ¶ã€‚</span><br><span class="line">log-bin &#x3D; &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;logs&#x2F;mybinlog</span><br><span class="line">#æ˜¯å¦å¯ç”¨æ…¢é€ŸæŸ¥è¯¢æ—¥å¿—ã€‚è¯¥å€¼å¯ä»¥æ˜¯0ï¼ˆæˆ–OFFï¼‰ä»¥ç¦ç”¨æ—¥å¿—ï¼Œä¹Ÿå¯ä»¥æ˜¯ 1ï¼ˆæˆ– ONï¼‰ä»¥å¯ç”¨æ—¥å¿—ã€‚</span><br><span class="line">slow_query_log &#x3D; 1</span><br><span class="line">#æ­¤å˜é‡æ§åˆ¶å†™å…¥é”™è¯¯æ—¥å¿—çš„æ¶ˆæ¯ä»¥åŠé€šå¸¸å†™å…¥æ–‡ä»¶çš„æŸ¥è¯¢æ—¥å¿—å’Œæ…¢é€ŸæŸ¥è¯¢æ—¥å¿—æ¶ˆæ¯ä¸­æ—¶é—´æˆ³çš„æ—¶åŒºã€‚è®¾ç½®ä¸ºSYSTEMï¼ˆæœ¬åœ°ç³»ç»Ÿæ—¶åŒºï¼‰ã€‚</span><br><span class="line">log_timestamps &#x3D; SYSTEM</span><br><span class="line">#å¦‚æœæŸ¥è¯¢æ‰€èŠ±çš„æ—¶é—´è¶…è¿‡è®¸å¤šç§’ï¼Œåˆ™æœåŠ¡å™¨å°†å¢åŠ Slow_queriesçŠ¶æ€å˜é‡,å¦‚æœå¯ç”¨äº†æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œåˆ™æŸ¥è¯¢å°†è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ä¸­ã€‚ä¿—ç§°å®šä¹‰æ…¢sqlçš„æ ‡å‡†</span><br><span class="line">long_query_time &#x3D; 1</span><br><span class="line">#å¦‚æœåœ¨å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—çš„æƒ…å†µä¸‹å¯ç”¨æ­¤å˜é‡ï¼Œåˆ™ä¼šè®°å½•é¢„æœŸå°†æ£€ç´¢æ‰€æœ‰è¡Œçš„æŸ¥è¯¢ã€‚</span><br><span class="line">log_queries_not_using_indexes &#x3D;1</span><br><span class="line">#å¦‚æœ log_queries_not_using_indexeså¯ç”¨ï¼Œè¯¥å˜é‡å°†é™åˆ¶æ¯åˆ†é’Ÿå¯å†™å…¥æ…¢é€ŸæŸ¥è¯¢æ—¥å¿—çš„æ­¤ç±»æŸ¥è¯¢çš„æ•°é‡ã€‚</span><br><span class="line">log_throttle_queries_not_using_indexes &#x3D; 60</span><br><span class="line">#æ£€æŸ¥å°‘äºæ­¤è¡Œæ•°çš„æŸ¥è¯¢ä¸ä¼šè®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚</span><br><span class="line">min_examined_row_limit &#x3D; 100</span><br><span class="line">#å¼€å¯åï¼Œåœ¨å†™å…¥æ…¢é€ŸæŸ¥è¯¢æ—¥å¿—çš„è¯­å¥ä¸­åŒ…æ‹¬æ…¢é€Ÿç®¡ç†è¯­å¥ï¼ŒåŒ…æ‹¬ALTER TABLEï¼Œ ANALYZE TABLEï¼Œ CHECK TABLEï¼Œ CREATE INDEXï¼Œ DROP INDEXï¼Œ OPTIMIZE TABLEï¼Œå’Œ REPAIR TABLEã€‚</span><br><span class="line">log_slow_admin_statements &#x3D; 1</span><br><span class="line">#å¯ç”¨æ…¢é€ŸæŸ¥è¯¢æ—¥å¿—åï¼Œæ­¤å˜é‡å°†å¯ç”¨æ—¥å¿—è®°å½•ï¼Œä»¥è®°å½•long_query_timeåœ¨ä»å±æœåŠ¡å™¨ä¸Šæ‰§è¡Œäº†è¶…è¿‡å‡ ç§’é’Ÿçš„æŸ¥è¯¢ ã€‚</span><br><span class="line">log_slow_slave_statements &#x3D; 1</span><br><span class="line">#binlog7å¤©è‡ªåŠ¨æ¸…ç†</span><br><span class="line">expire_logs_days &#x3D; 7</span><br><span class="line">#æ˜¯å¦å¯¹é”™è¯¯æ—¥å¿—ç”Ÿæˆå…¶ä»–è­¦å‘Šæ¶ˆæ¯ã€‚</span><br><span class="line">log_warnings &#x3D; 1</span><br><span class="line">#åœ¨äº‹åŠ¡æœŸé—´ï¼Œç”¨äºä¿å­˜å¯¹äºŒè¿›åˆ¶æ—¥å¿—çš„æ›´æ”¹çš„ç¼“å­˜çš„å¤§å°ã€‚</span><br><span class="line">binlog_cache_size &#x3D; 4M</span><br><span class="line">#å¦‚æœäº‹åŠ¡éœ€è¦çš„å†…å­˜å­—èŠ‚æ•°è¶…è¿‡æ­¤æ•°é‡ï¼Œåˆ™æœåŠ¡å™¨å°†ç”Ÿæˆå¤šè¯­å¥äº‹åŠ¡ï¼Œè€Œè¯¥è¯­å¥éœ€è¦çš„å­˜å‚¨æ•°è¶…è¿‡â€œmax_binlog_cache_sizeâ€å­—èŠ‚ã€‚</span><br><span class="line">max_binlog_cache_size &#x3D; 4G</span><br><span class="line">#å¦‚æœå¯¹äºŒè¿›åˆ¶æ—¥å¿—çš„å†™å…¥å¯¼è‡´å½“å‰æ—¥å¿—æ–‡ä»¶çš„å¤§å°è¶…è¿‡æ­¤å˜é‡çš„å€¼ï¼Œåˆ™æœåŠ¡å™¨å°†æ—‹è½¬äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆå…³é—­å½“å‰æ–‡ä»¶å¹¶æ‰“å¼€ä¸‹ä¸€ä¸ªæ—¥å¿—ï¼‰ã€‚</span><br><span class="line">max_binlog_size &#x3D; 1G</span><br><span class="line">#å¯ç”¨åï¼Œæ­¤å˜é‡ä½¿ä¸»æœåŠ¡å™¨åœ¨äºŒè¿›åˆ¶æ—¥å¿—ä¸­ä¸ºæ¯ä¸ªäº‹ä»¶å†™å…¥ä¸€ä¸ªæ ¡æ­£å’Œã€‚</span><br><span class="line">binlog_checksum &#x3D; 1</span><br><span class="line">#æ­¤å˜é‡è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ï¼Œå¹¶ä¸”å¯ä»¥æ˜¯ä»»ä½•ä¸€ä¸ªSTATEMENTï¼ŒROWæˆ–MIXEDã€‚</span><br><span class="line">binlog_format &#x3D; row</span><br><span class="line">#æ§åˆ¶MySQLæœåŠ¡å™¨å°†äºŒè¿›åˆ¶æ—¥å¿—åŒæ­¥åˆ°ç£ç›˜çš„é¢‘ç‡ã€‚</span><br><span class="line">sync_binlog &#x3D; 1</span><br></pre></td></tr></table></figure></li></ul><h4 id="replication-settings"><a href="#replication-settings" class="headerlink" title="replication settings"></a>replication settings</h4><p>å¦‚æœä½ ä¸æ­å»ºä¸»ä»é›†ç¾¤å¯ä»¥è·³è¿‡è¿™é¡¹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">########replication settings########</span><br><span class="line">#æœåŠ¡å™¨IDã€‚åœ¨ä¸»æœåŠ¡å™¨å’Œæ¯ä¸ªä»å±æœåŠ¡å™¨ä¸Šï¼Œå¿…é¡»è®¾ç½®server_idç³»ç»Ÿå˜é‡ä»¥åœ¨1åˆ°2 32 âˆ’ 1 çš„èŒƒå›´å†…å»ºç«‹å”¯ä¸€çš„å¤åˆ¶ID ã€‚</span><br><span class="line">server-id &#x3D; 213306</span><br><span class="line">#æ­¤å˜é‡çš„è®¾ç½®ç¡®å®šä»å±æœåŠ¡å™¨æ˜¯å°†ä¸»æœåŠ¡å™¨çŠ¶æ€å’Œè¿æ¥ä¿¡æ¯è®°å½•åˆ°FILEï¼ˆmaster.infoï¼‰è¿˜æ˜¯TABLE ï¼ˆmysql.slave_master_infoï¼‰ä¸Šã€‚ä»…å½“æ²¡æœ‰å¤åˆ¶çº¿ç¨‹æ­£åœ¨æ‰§è¡Œæ—¶ï¼Œæ‰èƒ½æ›´æ”¹æ­¤å˜é‡çš„å€¼ã€‚</span><br><span class="line">master_info_repository &#x3D; TABLE</span><br><span class="line">#è¯¥å˜é‡ç¡®å®šä»ç«™åœ¨ç»§ç”µå™¨æ—¥å¿—ä¸­çš„ä½ç½®æ˜¯å†™å…¥FILEï¼ˆrelay-log.infoï¼‰è¿˜æ˜¯å†™å…¥TABLEï¼ˆmysql.slave_relay_log_infoï¼‰ã€‚ä»…å½“æ²¡æœ‰å¤åˆ¶çº¿ç¨‹æ­£åœ¨æ‰§è¡Œæ—¶ï¼Œæ‰èƒ½æ›´æ”¹æ­¤å˜é‡çš„å€¼ã€‚</span><br><span class="line">relay_log_info_repository &#x3D; TABLE</span><br><span class="line">#æ§åˆ¶æ˜¯å¦å¯ç”¨åŸºäºGTIDçš„æ—¥å¿—è®°å½•ä»¥åŠæ—¥å¿—å¯ä»¥åŒ…å«çš„äº‹åŠ¡ç±»å‹ã€‚</span><br><span class="line">gtid_mode &#x3D; on</span><br><span class="line">#æ ¹æ®æ­¤å˜é‡çš„å€¼ï¼ŒæœåŠ¡å™¨é€šè¿‡ä»…å…è®¸æ‰§è¡Œå¯ä»¥ä½¿ç”¨GTIDå®‰å…¨è®°å½•çš„è¯­å¥æ¥å®ç°GTIDä¸€è‡´æ€§ã€‚</span><br><span class="line">enforce-gtid-consistency &#x3D; on</span><br><span class="line">#ä»æœåŠ¡å™¨ä»ä¸»æœåŠ¡å™¨æ”¶åˆ°çš„æ›´æ–°æ˜¯å¦åº”è®°å½•åˆ°ä»æœåŠ¡å™¨è‡ªå·±çš„äºŒè¿›åˆ¶æ—¥å¿—ä¸­ã€‚</span><br><span class="line">log_slave_updates  &#x3D; on</span><br><span class="line">æ ¹æ®æ­¤å˜é‡çš„å€¼ï¼ŒæœåŠ¡å™¨é€šè¿‡ä»…å…è®¸æ‰§è¡Œå¯ä»¥ä½¿ç”¨GTIDå®‰å…¨è®°å½•çš„è¯­å¥æ¥å®ç°GTIDä¸€è‡´æ€§ã€‚</span><br><span class="line">enforce_gtid_consistency &#x3D; 1</span><br><span class="line">#ä¸­ç»§æ—¥å¿—æ–‡ä»¶çš„åŸºæœ¬åç§°ã€‚</span><br><span class="line">relay_log &#x3D; relay.log</span><br><span class="line">#å¦‚æœå¯ç”¨ï¼Œæ­¤å˜é‡å°†åœ¨æœåŠ¡å™¨å¯åŠ¨åç«‹å³å¯ç”¨è‡ªåŠ¨ä¸­ç»§æ—¥å¿—æ¢å¤ã€‚</span><br><span class="line">relay_log_recovery &#x3D; 1</span><br><span class="line">#ä¸€æ—¦ä¸å†éœ€è¦ä¸­ç»§æ—¥å¿—æ–‡ä»¶ï¼Œåˆ™ç¦ç”¨æˆ–å¯ç”¨å®ƒä»¬çš„è‡ªåŠ¨æ¸…é™¤ã€‚</span><br><span class="line">relay-log-purge &#x3D; 1</span><br><span class="line">#æ­¤å˜é‡æ§åˆ¶MySQLå¯åŠ¨æˆ–é‡æ–°å¯åŠ¨æ—¶åœ¨æœç´¢GTIDæœŸé—´å¦‚ä½•è¿­ä»£äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ã€‚</span><br><span class="line">binlog_gtid_simple_recovery &#x3D; 1</span><br><span class="line">#é€šå¸¸ï¼Œå½“ä»å±æœåŠ¡å™¨å‘ç”Ÿé”™è¯¯æ—¶ï¼Œå¤åˆ¶ä¼šåœæ­¢ï¼Œè¿™ä½¿æ‚¨æœ‰æœºä¼šæ‰‹åŠ¨è§£å†³æ•°æ®ä¸­çš„ä¸ä¸€è‡´é—®é¢˜ã€‚</span><br><span class="line">slave_skip_errors &#x3D; ddl_exist_errors</span><br><span class="line">#åœ¨ä¸ºåŸºç¡€è¡Œçš„æ—¥å¿—è®°å½•å’Œå¤åˆ¶å‡†å¤‡å‰¯æœ¬è¡Œæ—¶ï¼Œæ­¤å˜é‡æ§åˆ¶å¦‚ä½•åœ¨è¡Œä¸­æœç´¢åŒ¹é…é¡¹ï¼Œç‰¹åˆ«æ˜¯æ˜¯å¦ä½¿ç”¨å“ˆå¸Œæ‰«æã€‚  </span><br><span class="line">slave-rows-search-algorithms &#x3D; &#39;INDEX_SCAN,HASH_SCAN&#39;</span><br></pre></td></tr></table></figure><h4 id="innodb-settings"><a href="#innodb-settings" class="headerlink" title="innodb settings"></a>innodb settings</h4><ul><li><p>innodb_undo_directory å¯ä»¥æ ¹æ®å®é™…ç£ç›˜æŒ‚è½½çš„ç›®å½•è¿›è¡Œè°ƒæ•´</p></li><li><p>innodb_buffer_pool_size å¦‚æœæœºå™¨å†…å­˜è¾ƒä½ï¼Œå¯ä»¥å°†æ­¤å‚æ•°è°ƒä½ã€‚å‚æ•°æ˜¯åŠ¨æ€çš„ï¼Œå®ƒå…è®¸æ‚¨åœ¨ä¸é‡æ–°å¯åŠ¨æœåŠ¡å™¨çš„æƒ…å†µä¸‹è°ƒæ•´ç¼“å†²æ± çš„å¤§å°ã€‚</p></li><li><p>innodb_buffer_pool_instances æ­¤é€‰é¡¹ä»…åœ¨è®¾ç½®innodb_buffer_pool_sizeä¸º1GBæˆ–æ›´å¤§æ—¶æ‰ç”Ÿæ•ˆ ã€‚æ€»ç¼“å†²æ± å¤§å°åœ¨æ‰€æœ‰ç¼“å†²æ± ä¹‹é—´åˆ†é…ã€‚ä¸ºäº†è·å¾—æœ€ä½³æ•ˆç‡ï¼ŒæŒ‡å®šçš„ç»„åˆ innodb_buffer_pool_instances å’Œinnodb_buffer_pool_size ï¼Œä½¿å¾—æ¯ä¸ªç¼“å†²æ± å®ä¾‹æ˜¯è‡³å°‘ä¸º1GBã€‚</p></li><li><p>innodb_log_file_size  é€šå¸¸ï¼Œæ—¥å¿—æ–‡ä»¶çš„æ€»å¤§å°åº”è¶³å¤Ÿå¤§ï¼Œä»¥ä½¿æœåŠ¡å™¨å¯ä»¥æ¶ˆé™¤å·¥ä½œè´Ÿè½½æ´»åŠ¨ä¸­çš„é«˜å³°å’Œä½è°·ï¼Œè¿™é€šå¸¸æ„å‘³ç€æœ‰è¶³å¤Ÿçš„é‡åšæ—¥å¿—ç©ºé—´æ¥å¤„ç†ä¸€ä¸ªå°æ—¶ä»¥ä¸Šçš„å†™æ´»åŠ¨ã€‚å€¼è¶Šå¤§ï¼Œç¼“å†²æ± ä¸­éœ€è¦çš„æ£€æŸ¥ç‚¹åˆ·æ–°æ´»åŠ¨è¶Šå°‘ï¼Œä»è€ŒèŠ‚çœäº†ç£ç›˜I / Oã€‚</p></li><li><p>innodb_io_capacityã€innodb_io_capacity_max  æ ¹æ®æœåŠ¡å™¨IOPSèƒ½åŠ›é€‚å½“è°ƒæ•´ï¼Œä¸€èˆ¬é…æ™®é€šSSDç›˜çš„è¯ï¼Œå¯ä»¥è°ƒæ•´åˆ° 10000 - 20000ï¼Œé…ç½®é«˜ç«¯PCIe SSDå¡çš„è¯ï¼Œåˆ™å¯ä»¥è°ƒæ•´çš„æ›´é«˜ï¼Œæ¯”å¦‚ 50000 - 80000</p></li><li><p>innodb_lru_scan_depth å°äºé»˜è®¤å€¼ï¼ˆ    1024ï¼‰çš„è®¾ç½®é€šå¸¸é€‚ç”¨äºå¤§å¤šæ•°å·¥ä½œè´Ÿè½½ã€‚é«˜äºå¿…è¦å€¼çš„å€¼å¯èƒ½ä¼šå½±å“æ€§èƒ½ã€‚ä»…åœ¨å…¸å‹å·¥ä½œè´Ÿè½½ä¸‹å…·æœ‰å¤‡ç”¨I / Oå®¹é‡æ—¶ï¼Œæ‰è€ƒè™‘å¢åŠ è¯¥å€¼ã€‚ç›¸åï¼Œå¦‚æœå†™å¯†é›†å‹å·¥ä½œè´Ÿè½½ä½¿æ‚¨çš„I / Oå®¹é‡é¥±å’Œï¼Œè¯·å‡å°è¯¥å€¼ï¼Œå°¤å…¶æ˜¯åœ¨å¤§å‹ç¼“å†²æ± çš„æƒ…å†µä¸‹ã€‚</p></li><li><p>innodb_status_outputã€innodb_status_output_locks å¼€å¯å¯èƒ½ä¼šå¯¼è‡´log-erroræ–‡ä»¶å¢é•¿è¾ƒå¿«</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">########innodb settings########</span><br><span class="line">#InnoDBåˆ›å»ºæ’¤æ¶ˆè¡¨ç©ºé—´çš„è·¯å¾„ã€‚é€šå¸¸ç”¨äºå°†æ’¤æ¶ˆæ—¥å¿—æ”¾ç½®åœ¨å…¶ä»–å­˜å‚¨è®¾å¤‡ä¸Šã€‚</span><br><span class="line">innodb_undo_directory &#x3D; &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;data&#x2F;undolog</span><br><span class="line">#ç£ç›˜ä¸Šå†…éƒ¨ä¸´æ—¶è¡¨çš„å­˜å‚¨å¼•æ“ã€‚å…è®¸çš„å€¼ä¸ºMYISAMå’ŒINNODB ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚</span><br><span class="line">internal_tmp_disk_storage_engine &#x3D; InnoDB</span><br><span class="line">#æŒ‡å®šInnoDBè¡¨çš„å¤§å°ã€‚</span><br><span class="line">innodb_page_size &#x3D; 8192</span><br><span class="line">#innodb_buffer_pool_chunk_sizeå®šä¹‰InnoDBç¼“å†²æ± å¤§å°è°ƒæ•´æ“ä½œçš„å—å¤§å°</span><br><span class="line">innodb_buffer_pool_size &#x3D; 40960m</span><br><span class="line"># InnoDB æ± ç¼“å†²åˆ’åˆ†ä¸ºçš„åŒºåŸŸæ•°ã€‚ </span><br><span class="line">innodb_buffer_pool_instances &#x3D; 4</span><br><span class="line">#æŒ‡å®šåœ¨MySQLæœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œé€šè¿‡åŠ è½½å…ˆå‰ä¿å­˜çš„ç›¸åŒé¡µé¢æ¥è‡ªåŠ¨é¢„çƒ­InnoDB ç¼“å†²æ± ã€‚</span><br><span class="line">innodb_buffer_pool_load_at_startup &#x3D; 1</span><br><span class="line">#æŒ‡å®šåœ¨å…³é—­MySQLæœåŠ¡å™¨æ—¶æ˜¯å¦è®°å½•InnoDBç¼“å†²æ± ä¸­ç¼“å­˜çš„é¡µé¢ï¼Œä»¥ç¼©çŸ­ä¸‹æ¬¡é‡å¯æ—¶çš„é¢„çƒ­è¿‡ç¨‹ã€‚</span><br><span class="line">innodb_buffer_pool_dump_at_shutdown &#x3D; 1</span><br><span class="line">#å®šä¹‰InnoDBç³»ç»Ÿè¡¨ç©ºé—´æ•°æ®æ–‡ä»¶çš„åç§°ï¼Œå¤§å°å’Œå±æ€§ ã€‚</span><br><span class="line">innodb_data_file_path &#x3D; ibdata1:1G:autoextend</span><br><span class="line">#æ¯ç§’é’Ÿå†™å…¥å¹¶åˆ·æ–°æ—¥å¿—Nã€‚ã€‚</span><br><span class="line">innodb_flush_log_at_trx_commit &#x3D; 1</span><br><span class="line">#InnoDB ç”¨äºå†™å…¥ç£ç›˜ä¸Šçš„æ—¥å¿—æ–‡ä»¶çš„ç¼“å†²åŒºçš„å¤§å°ã€‚</span><br><span class="line">innodb_log_buffer_size &#x3D; 32M</span><br><span class="line">#åœ¨æ¯ä¸ªå­—èŠ‚å¤§å°æ—¥å¿—æ–‡ä»¶åœ¨æ—¥å¿—ç»„ã€‚</span><br><span class="line">innodb_log_file_size &#x3D; 1G</span><br><span class="line">#æ—¥å¿—æ–‡ä»¶ä¸­æ—¥å¿—ç»„æ•°é‡ï¼ŒInnoDBä»¥å¾ªç¯æ–¹å¼å†™å…¥æ–‡ä»¶ã€‚</span><br><span class="line">innodb_log_files_in_group &#x3D; 4</span><br><span class="line">#å®šä¹‰æ’¤æ¶ˆè¡¨ç©ºé—´çš„é˜ˆå€¼å¤§å°ã€‚</span><br><span class="line">innodb_max_undo_log_size &#x3D; 4G</span><br><span class="line">#æ‰€ä½¿ç”¨çš„æ’¤æ¶ˆè¡¨ç©ºé—´çš„InnoDBæ•°é‡ã€‚</span><br><span class="line">innodb_undo_tablespaces &#x3D; 95</span><br><span class="line">#å˜é‡å®šä¹‰äº†å¯ç”¨äºInnoDBåå°ä»»åŠ¡çš„IOPSï¼Œä¾‹å¦‚ä»ç¼“å†²æ± åˆ·æ–°é¡µé¢å’Œåˆå¹¶æ¥è‡ªæ›´æ”¹ç¼“å†²åŒºçš„æ•°æ®ã€‚</span><br><span class="line">innodb_io_capacity &#x3D; 2000</span><br><span class="line">#å¦‚æœåˆ·æ–°è¾ƒæ…¢ï¼Œåˆ™InnoDBå¯ä»¥æ¯”innodb_io_capacityå˜é‡å®šä¹‰æ›´é«˜çš„IOPSæ›´ç§¯æåœ°è¿›è¡Œåˆ·æ–°ã€‚</span><br><span class="line">innodb_io_capacity_max &#x3D; 4000</span><br><span class="line">#0ä¸ºéµå®ˆinnodb_io_capacityå®šä¹‰ 1ä¸ºä¸éµå®ˆinnodb_io_capacityå®šä¹‰ ã€‚</span><br><span class="line">innodb_flush_sync &#x3D; 0</span><br><span class="line">#æŒ‡å®šæ˜¯å¦å†²æ´—ä»ä¸€ä¸ªé¡µé¢InnoDB ç¼“å†²æ± ä¹Ÿå¯ä»¥æ¸…ç©ºå…¶ä»–è„é¡µåœ¨ç›¸åŒçš„ç¨‹åº¦ã€‚</span><br><span class="line">innodb_flush_neighbors &#x3D; 0</span><br><span class="line">#ä¸€ä¸ªå½±å“ç¼“å†²æ± åˆ·æ–°æ“ä½œçš„ç®—æ³•å’Œå¯å‘å¼æ–¹æ³•çš„å‚æ•°ã€‚</span><br><span class="line">innodb_lru_scan_depth &#x3D; 4000</span><br><span class="line">#InnoDB äº‹åŠ¡åœ¨æ”¾å¼ƒä¹‹å‰ç­‰å¾…è¡Œé”å®šçš„æ—¶é—´é•¿åº¦ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚</span><br><span class="line">innodb_lock_wait_timeout &#x3D; 5</span><br><span class="line">#å†™å…¥æ“ä½œçš„I &#x2F; Oçº¿ç¨‹æ•° InnoDBã€‚</span><br><span class="line">innodb_write_io_threads &#x3D; 8</span><br><span class="line">#è¯»å–æ“ä½œçš„I &#x2F; Oçº¿ç¨‹æ•° InnoDBã€‚</span><br><span class="line">innodb_read_io_threads &#x3D; 8</span><br><span class="line">#ä¸“ç”¨äºInnoDBæ¸…é™¤æ“ä½œçš„åå°çº¿ç¨‹æ•° ã€‚</span><br><span class="line">innodb_purge_threads &#x3D; 4</span><br><span class="line">#ä»ç¼“å†²æ± å®ä¾‹ä¸­åˆ·æ–°è„é¡µé¢çš„é¡µé¢æ¸…æ´ç¨‹åºçº¿ç¨‹æ•°ã€‚</span><br><span class="line">innodb_page_cleaners &#x3D; 4</span><br><span class="line">#InnoDBå°è¯•ä»ç¼“å†²æ± åˆ·æ–°æ•°æ®ï¼Œä½¿è„é¡µç™¾åˆ†æ¯”ä¸è¶…è¿‡æ­¤å€¼ã€‚</span><br><span class="line">innodb_max_dirty_pages_pct &#x3D; 50</span><br><span class="line">#å®šä¹‰ç”¨äºå°†æ•°æ®åˆ·æ–°åˆ°InnoDBæ•°æ®æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶çš„æ–¹æ³•ï¼Œè¿™ä¼šå½±å“I&#x2F;Oååé‡ã€‚</span><br><span class="line">innodb_flush_method &#x3D; O_DIRECT</span><br><span class="line">#æŒ‡å®šå¦‚ä½•ç”Ÿæˆå’ŒéªŒè¯å­˜å‚¨åœ¨è¡¨ç©ºé—´çš„ç£ç›˜å—ä¸­çš„æ ¡éªŒã€‚</span><br><span class="line">innodb_checksum_algorithm &#x3D; crc32</span><br><span class="line">#InnoDB é»˜è®¤æƒ…å†µä¸‹ï¼Œä»…å›æ»šäº‹åŠ¡è¶…æ—¶ä¸Šçš„æœ€åä¸€æ¡è¯­å¥ã€‚</span><br><span class="line">innodb_rollback_on_timeout &#x3D; 1</span><br><span class="line">#å½“å¯ç”¨è¯¥é€‰é¡¹ï¼Œæ‰€æœ‰ä¿¡æ¯æ­»é”åœ¨InnoDBç”¨æˆ·äº¤æ˜“è¢«è®°å½•åœ¨ mysqld é”™è¯¯æ—¥å¿—ã€‚</span><br><span class="line">innodb_print_all_deadlocks &#x3D; 1</span><br><span class="line">#å½“innodb_file_per_tableå¯ç”¨æ—¶ï¼Œåœ¨æ–‡ä»¶çš„æ¯ä¸ªè¡¨çš„è¡¨ç©ºé—´é»˜è®¤åˆ›å»ºçš„è¡¨ã€‚</span><br><span class="line">innodb_file_per_table &#x3D; 1</span><br><span class="line">#æŒ‡å®šåœ¨è¡¨çš„åœ¨çº¿DDLæ“ä½œæœŸé—´ä½¿ç”¨çš„ä¸´æ—¶æ—¥å¿—æ–‡ä»¶çš„å¤§å°çš„ä¸Šé™ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰InnoDBã€‚</span><br><span class="line">innodb_online_alter_log_max_size &#x3D; 4G</span><br><span class="line">#ä»…å½“ä¼˜åŒ–å™¨ç»Ÿè®¡ä¿¡æ¯é…ç½®ä¸ºéæŒä¹…æ€§æ—¶ï¼Œæ­¤é€‰é¡¹æ‰é€‚ç”¨ ã€‚</span><br><span class="line">innodb_stats_on_metadata &#x3D; 0</span><br><span class="line">#InnoDBå¯ä»¥åœ¨ä»ç£ç›˜è¯»å–çš„æ‰€æœ‰è¡¨ç©ºé—´é¡µä¸Šä½¿ç”¨æ ¡éªŒå’ŒéªŒè¯ï¼Œä»¥ç¡®ä¿å¯¹ç¡¬ä»¶æ•…éšœæˆ–æŸåçš„æ•°æ®æ–‡ä»¶å…·æœ‰é¢å¤–çš„å®¹é”™èƒ½åŠ›ã€‚</span><br><span class="line">innodb_checksums &#x3D; 1</span><br><span class="line">#å®šä¹‰æ‰€ä½¿ç”¨çš„å›æ»šæ®µæ•° InnoDBã€‚</span><br><span class="line">innodb_undo_logs &#x3D; 128</span><br><span class="line">##å¯ç”¨InnoDBçš„status fileï¼Œä¾¿äºç®¡ç†å‘˜æŸ¥çœ‹ä»¥åŠç›‘æ§ç­‰</span><br><span class="line">innodb_status_file &#x3D; 1</span><br><span class="line">#å¯ç”¨æˆ–ç¦ç”¨æ ‡å‡†InnoDBMonitorçš„å®šæœŸè¾“å‡ºã€‚</span><br><span class="line">innodb_status_output &#x3D; 0</span><br><span class="line">#å¯ç”¨æˆ–ç¦ç”¨InnoDBé”å®šç›‘è§†å™¨</span><br><span class="line">innodb_status_output_locks &#x3D; 0</span><br><span class="line">#å¯ç”¨æ­¤é€‰é¡¹åInnoDBï¼Œä½¿ç”¨DYNAMIC æˆ– COMPRESSED è¡Œæ ¼å¼çš„è¡¨ å…è®¸é•¿åº¦è¶…è¿‡767å­—èŠ‚ï¼ˆæœ€å¤§3072å­—èŠ‚ï¼‰çš„ç´¢å¼•é”®å‰ç¼€ ã€‚</span><br><span class="line">innodb_large_prefix &#x3D; 1</span><br><span class="line">#InnoDBå°è¯•ä½¿å†…éƒ¨å¹¶å‘çš„æ“ä½œç³»ç»Ÿçº¿ç¨‹æ•°ä¿æŒInnoDBå°äºæˆ–ç­‰äºæ­¤å˜é‡ç»™å®šçš„é™åˆ¶ï¼ˆInnoDBä½¿ç”¨æ“ä½œç³»ç»Ÿçº¿ç¨‹æ¥å¤„ç†ç”¨æˆ·äº‹åŠ¡ï¼‰å€¼0ï¼ˆé»˜è®¤å€¼ï¼‰è¢«è§£é‡Šä¸ºæ— é™å¹¶å‘ï¼ˆä¸è¿›è¡Œå¹¶å‘æ£€æŸ¥ï¼‰</span><br><span class="line">innodb_thread_concurrency &#x3D; 0</span><br><span class="line">#InnoDBçº¿ç¨‹åœ¨æŒ‚èµ·çº¿ç¨‹ä¹‹å‰ ç­‰å¾… äº’æ–¥é‡é‡Šæ”¾çš„æ¬¡æ•°ã€‚</span><br><span class="line">innodb_sync_spin_loops &#x3D; 100</span><br><span class="line">#è‡ªæ—‹é”å®šçš„ ä¸¤æ¬¡è½®è¯¢ä¹‹é—´çš„æœ€å¤§å»¶è¿Ÿ </span><br><span class="line">innodb_spin_wait_delay &#x3D; 30</span><br><span class="line">#æŒ‡å®šMySQLå¯åŒæ—¶æ‰“å¼€.ibdæ–‡ä»¶çš„æœ€å¤§ä¸ªæ•°ï¼Œæœ€å°ä¸º10ï¼Œé»˜è®¤300ã€‚æ­¤é€‰é¡¹åªé’ˆå¯¹InnoDBè¡¨æ‰“å¼€çš„.ibdæ–‡ä»¶æè¿°ç¬¦ï¼Œç‹¬ç«‹äºopen_files_limitã€‚</span><br><span class="line">innodb_open_files &#x3D; 655350  </span><br><span class="line">#å½“innodb_strict_modeå¯ç”¨æ—¶ï¼ŒInnoDBå°†è¿”å›é”™è¯¯ï¼Œè€Œä¸æ˜¯è­¦å‘Šäº†ä¸€å®šçš„æ¡ä»¶ã€‚</span><br><span class="line">innodb_strict_mode &#x3D; 1</span><br><span class="line">#æŒ‡å®šåœ¨åˆ›å»ºInnoDBç´¢å¼•æœŸé—´ç”¨äºå¯¹æ•°æ®è¿›è¡Œæ’åºçš„æ’åºç¼“å†²åŒºçš„å¤§å°ã€‚</span><br><span class="line">innodb_sort_buffer_size &#x3D; 67108864 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#innodb monitor</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_innodb&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_server&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_dml&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_ddl&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_trx&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_os&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_purge&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_log&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_lock&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_buffer&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_index&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_ibuf_system&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_buffer_page&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_adaptive_hash&quot;</span><br></pre></td></tr></table></figure></li></ul><h3 id="æ€»ç»“é…ç½®æ–‡ä»¶"><a href="#æ€»ç»“é…ç½®æ–‡ä»¶" class="headerlink" title="æ€»ç»“é…ç½®æ–‡ä»¶"></a>æ€»ç»“é…ç½®æ–‡ä»¶</h3><p>vim /etc/my.cnf<br>å¤åˆ¶ç²˜è´´ä¸‹é¢çš„é…ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">[client]   </span><br><span class="line">user&#x3D;root</span><br><span class="line">password&#x3D;123456</span><br><span class="line">port    &#x3D; 3306</span><br><span class="line">socket &#x3D; &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;data&#x2F;mysql.sock </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysql] </span><br><span class="line">prompt&#x3D;&quot;\u@dev-data-01 \R:\m:\s [\d]&gt; &quot; </span><br><span class="line">no-auto-rehash </span><br><span class="line">default-character-set&#x3D;utf8mb4  </span><br><span class="line"></span><br><span class="line">[mysqld] </span><br><span class="line">########basic settings########</span><br><span class="line">user    &#x3D; mysql</span><br><span class="line">port    &#x3D; 3306</span><br><span class="line">basedir &#x3D; &#x2F;usr&#x2F;local&#x2F;mysql</span><br><span class="line">datadir &#x3D; &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;data</span><br><span class="line">socket  &#x3D; &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;mysql.sock</span><br><span class="line">secure_file_priv&#x3D;&#x2F;data&#x2F;mysql&#x2F;</span><br><span class="line">performance_schema &#x3D; 1</span><br><span class="line">character_set_server&#x3D;utf8mb4   </span><br><span class="line">open_files_limit &#x3D; 655350  </span><br><span class="line">transaction_isolation &#x3D; READ-COMMITTED</span><br><span class="line">interactive_timeout &#x3D; 31536000</span><br><span class="line">wait_timeout &#x3D; 31536000</span><br><span class="line">skip_name_resolve &#x3D; 1  </span><br><span class="line">lower_case_table_names&#x3D;1    </span><br><span class="line">back_log &#x3D; 1024</span><br><span class="line">max_connections &#x3D; 10240    </span><br><span class="line">max_connect_errors &#x3D; 1000000</span><br><span class="line">table_open_cache &#x3D; 20480</span><br><span class="line">table_definition_cache &#x3D; 20480</span><br><span class="line">table_open_cache_instances &#x3D; 64</span><br><span class="line">thread_stack &#x3D; 512K</span><br><span class="line">external-locking &#x3D; FALSE</span><br><span class="line">max_allowed_packet &#x3D; 32M</span><br><span class="line">sort_buffer_size &#x3D; 4M</span><br><span class="line">join_buffer_size &#x3D; 4M</span><br><span class="line">thread_cache_size &#x3D; 15360</span><br><span class="line">tmp_table_size &#x3D; 32M</span><br><span class="line">max_heap_table_size &#x3D; 32M</span><br><span class="line">lock_wait_timeout &#x3D; 3600</span><br><span class="line">explicit_defaults_for_timestamp &#x3D; 1</span><br><span class="line">sort_buffer_size &#x3D; 33554432</span><br><span class="line"></span><br><span class="line">########log settings########</span><br><span class="line">slow_query_log_file &#x3D; &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;slow.log</span><br><span class="line">log-error &#x3D; &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;error.log</span><br><span class="line">log-bin &#x3D; &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;logs&#x2F;mybinlog</span><br><span class="line">slow_query_log &#x3D; 1</span><br><span class="line">log_timestamps &#x3D; SYSTEM</span><br><span class="line">long_query_time &#x3D; 1</span><br><span class="line">log_queries_not_using_indexes &#x3D;1</span><br><span class="line">log_throttle_queries_not_using_indexes &#x3D; 60</span><br><span class="line">min_examined_row_limit &#x3D; 100</span><br><span class="line">log_slow_admin_statements &#x3D; 1</span><br><span class="line">log_slow_slave_statements &#x3D; 1</span><br><span class="line">expire_logs_days &#x3D; 7</span><br><span class="line">log_warnings &#x3D; 1</span><br><span class="line">binlog_cache_size &#x3D; 4M</span><br><span class="line">max_binlog_cache_size &#x3D; 4G</span><br><span class="line">max_binlog_size &#x3D; 1G</span><br><span class="line">binlog_checksum &#x3D; 1</span><br><span class="line">binlog_format &#x3D; row</span><br><span class="line">sync_binlog &#x3D; 1</span><br><span class="line"></span><br><span class="line">########replication settings########</span><br><span class="line">server-id &#x3D; 213306</span><br><span class="line">master_info_repository &#x3D; TABLE</span><br><span class="line">relay_log_info_repository &#x3D; TABLE</span><br><span class="line">gtid_mode &#x3D; on</span><br><span class="line">enforce-gtid-consistency &#x3D; on</span><br><span class="line">log_slave_updates  &#x3D; on</span><br><span class="line">enforce_gtid_consistency &#x3D; 1</span><br><span class="line">relay_log &#x3D; relay.log</span><br><span class="line">relay_log_recovery &#x3D; 1</span><br><span class="line">relay-log-purge &#x3D; 1</span><br><span class="line">binlog_gtid_simple_recovery &#x3D; 1</span><br><span class="line">slave_skip_errors &#x3D; ddl_exist_errors</span><br><span class="line">slave-rows-search-algorithms &#x3D; &#39;INDEX_SCAN,HASH_SCAN&#39;</span><br><span class="line"></span><br><span class="line">########innodb settings########</span><br><span class="line">innodb_undo_directory &#x3D; &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;data&#x2F;undolog</span><br><span class="line">internal_tmp_disk_storage_engine &#x3D; InnoDB</span><br><span class="line">innodb_page_size &#x3D; 8192</span><br><span class="line">innodb_buffer_pool_size &#x3D; 40960m </span><br><span class="line">innodb_buffer_pool_instances &#x3D; 4</span><br><span class="line">innodb_buffer_pool_load_at_startup &#x3D; 1</span><br><span class="line">innodb_buffer_pool_dump_at_shutdown &#x3D; 1</span><br><span class="line">innodb_data_file_path &#x3D; ibdata1:1G:autoextend</span><br><span class="line">innodb_flush_log_at_trx_commit &#x3D; 1</span><br><span class="line">innodb_log_buffer_size &#x3D; 32M</span><br><span class="line">innodb_log_file_size &#x3D; 1G</span><br><span class="line">innodb_log_files_in_group &#x3D; 4</span><br><span class="line">innodb_max_undo_log_size &#x3D; 4G</span><br><span class="line">innodb_undo_tablespaces &#x3D; 95</span><br><span class="line">innodb_io_capacity &#x3D; 2000</span><br><span class="line">innodb_io_capacity_max &#x3D; 4000</span><br><span class="line">innodb_flush_sync &#x3D; 0</span><br><span class="line">innodb_flush_neighbors &#x3D; 0</span><br><span class="line">innodb_lru_scan_depth &#x3D; 4000</span><br><span class="line">innodb_lock_wait_timeout &#x3D; 5</span><br><span class="line">innodb_write_io_threads &#x3D; 8</span><br><span class="line">innodb_read_io_threads &#x3D; 8</span><br><span class="line">innodb_purge_threads &#x3D; 4</span><br><span class="line">innodb_page_cleaners &#x3D; 4</span><br><span class="line">innodb_max_dirty_pages_pct &#x3D; 50</span><br><span class="line">innodb_flush_method &#x3D; O_DIRECT</span><br><span class="line">innodb_checksum_algorithm &#x3D; crc32</span><br><span class="line">innodb_rollback_on_timeout &#x3D; 1</span><br><span class="line">innodb_print_all_deadlocks &#x3D; 1</span><br><span class="line">innodb_file_per_table &#x3D; 1</span><br><span class="line">innodb_online_alter_log_max_size &#x3D; 4G</span><br><span class="line">innodb_stats_on_metadata &#x3D; 0</span><br><span class="line">innodb_checksums &#x3D; 1</span><br><span class="line">innodb_undo_logs &#x3D; 128</span><br><span class="line">innodb_status_file &#x3D; 1</span><br><span class="line">innodb_status_output &#x3D; 0</span><br><span class="line">innodb_status_output_locks &#x3D; 0</span><br><span class="line">innodb_large_prefix &#x3D; 1</span><br><span class="line">innodb_thread_concurrency &#x3D; 0</span><br><span class="line">innodb_sync_spin_loops &#x3D; 100</span><br><span class="line">innodb_spin_wait_delay &#x3D; 30</span><br><span class="line">innodb_open_files &#x3D; 655350  </span><br><span class="line">innodb_strict_mode &#x3D; 1</span><br><span class="line">innodb_sort_buffer_size &#x3D; 67108864 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_innodb&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_server&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_dml&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_ddl&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_trx&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_os&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_purge&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_log&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_lock&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_buffer&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_index&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_ibuf_system&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_buffer_page&quot;</span><br><span class="line">innodb_monitor_enable&#x3D;&quot;module_adaptive_hash&quot;</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><p>é…ç½®ç¯å¢ƒå˜é‡ vim /etc/profile</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH&#x3D;&#x2F;usr&#x2F;lib64&#x2F;qt-3.3&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;root&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin</span><br></pre></td></tr></table></figure><p>åŠ è½½é…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; cd &#x2F;usr&#x2F;local&#x2F;mysql</span><br><span class="line">shell&gt; bin&#x2F;mysqld  --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf --basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F; --datadir&#x3D;&#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;data&#x2F; --user&#x3D;mysql  --initialize</span><br><span class="line">shell&gt; cp support-files&#x2F;mysql.server &#x2F;etc&#x2F;init.d&#x2F;mysql.server</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–æ•°æ®åº“ï¼ˆä¸ºäº†å®‰å…¨ç®¡ç†ï¼Œrootè´¦å·åªèƒ½æœ¬æœºç™»é™†ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; &#x2F;etc&#x2F;init.d&#x2F;mysql.server start&#x2F;stop</span><br><span class="line">#å¯åŠ¨&#x2F;å…³é—­mysql</span><br><span class="line">shell&gt; cat &#x2F;data&#x2F;mysql&#x2F;mysql3306&#x2F;data&#x2F;error.log|grep pass</span><br><span class="line">#æŸ¥è¯¢çš„å¯†ç æ˜¯ç¬¬ä¸€æ¬¡ç™»é™†çš„å¯†ç </span><br><span class="line">mysql -u root -p</span><br><span class="line">#å¯†ç ä¸ºcatåˆ°çš„å¯†ç </span><br><span class="line">root@dev-data-01 15:49:  [(none)]&gt; set password&#x3D;&#39;123456&#39;;</span><br><span class="line">#è¿›å…¥æ•°æ®åº“ç¬¬ä¸€æ¬¡éœ€è¦ä¿®æ”¹å¯†ç </span><br><span class="line"></span><br><span class="line">æ·»åŠ è¶…çº§ç®¡ç†å‘˜å¹¶ä¸”æ”¯æŒè¿œç¨‹ç™»é™†</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#39;admin&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39; WITH GRANT OPTION;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h1 id="è‡³æ­¤ï¼Œmysqlå®‰è£…å·²å®Œæˆ"><a href="#è‡³æ­¤ï¼Œmysqlå®‰è£…å·²å®Œæˆ" class="headerlink" title="è‡³æ­¤ï¼Œmysqlå®‰è£…å·²å®Œæˆ"></a>è‡³æ­¤ï¼Œmysqlå®‰è£…å·²å®Œæˆ</h1><p>æœ‰å»ºè®®æˆ–ç–‘é—®æ¬¢è¿ç•™è¨€</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://dev.mysql.com/doc/refman/5.7/en/mysqldump-sql-format.html" target="_blank" rel="noopener">mysqlå®˜æ–¹æ–‡æ¡£</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…è´¹ç”³è¯·è¯ä¹¦çš„æ–¹æ³•</title>
      <link href="/2020/04/30/ssl/ssl-request/"/>
      <url>/2020/04/30/ssl/ssl-request/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="ç”³è¯·åœ°å€"><a href="#ç”³è¯·åœ°å€" class="headerlink" title="ç”³è¯·åœ°å€"></a>ç”³è¯·åœ°å€</h1><p><a href="https://freessl.cn/" target="_blank" rel="noopener">https://freessl.cn/</a></p><h1 id="ç”³è¯·æ­¥éª¤"><a href="#ç”³è¯·æ­¥éª¤" class="headerlink" title="ç”³è¯·æ­¥éª¤"></a>ç”³è¯·æ­¥éª¤</h1><h2 id="é€‰æ‹©éœ€è¦ç”³è¯·SSLè¯ä¹¦åŸŸå"><a href="#é€‰æ‹©éœ€è¦ç”³è¯·SSLè¯ä¹¦åŸŸå" class="headerlink" title="é€‰æ‹©éœ€è¦ç”³è¯·SSLè¯ä¹¦åŸŸå"></a>é€‰æ‹©éœ€è¦ç”³è¯·SSLè¯ä¹¦åŸŸå</h2><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/SSL/SSL01.jpg"  alt="SSL01.jpg"></p><h2 id="é€‰æ‹©è¯ä¹¦ç±»å‹å¹¶åˆ›å»º"><a href="#é€‰æ‹©è¯ä¹¦ç±»å‹å¹¶åˆ›å»º" class="headerlink" title="é€‰æ‹©è¯ä¹¦ç±»å‹å¹¶åˆ›å»º"></a>é€‰æ‹©è¯ä¹¦ç±»å‹å¹¶åˆ›å»º</h2><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/SSL/SSL02.jpg"  alt="SSL02.jpg"></p><h2 id="ä¸‹è½½KeyManagerå®¢æˆ·ç«¯"><a href="#ä¸‹è½½KeyManagerå®¢æˆ·ç«¯" class="headerlink" title="ä¸‹è½½KeyManagerå®¢æˆ·ç«¯"></a>ä¸‹è½½KeyManagerå®¢æˆ·ç«¯</h2><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/SSL/SSL03.jpg"  alt="SSL03.jpg"></p><h2 id="DNSéªŒè¯"><a href="#DNSéªŒè¯" class="headerlink" title="DNSéªŒè¯"></a>DNSéªŒè¯</h2><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/SSL/SSL04.jpg"  alt="SSL04.jpg"></p><h2 id="å¯¼å‡ºè¯ä¹¦"><a href="#å¯¼å‡ºè¯ä¹¦" class="headerlink" title="å¯¼å‡ºè¯ä¹¦"></a>å¯¼å‡ºè¯ä¹¦</h2><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/SSL/SSL05.jpg"  alt="SSL05.jpg"></p><h1 id="é…ç½®è¯ä¹¦"><a href="#é…ç½®è¯ä¹¦" class="headerlink" title="é…ç½®è¯ä¹¦"></a>é…ç½®è¯ä¹¦</h1><h2 id="Nginxé…ç½®"><a href="#Nginxé…ç½®" class="headerlink" title="Nginxé…ç½®"></a>Nginxé…ç½®</h2><p>è§£å‹è¯ä¹¦å¹¶æ”¾åˆ°æœåŠ¡å™¨æ–‡ä»¶é‡Œï¼Œè§£å‹å®Œçš„æ–‡ä»¶æœ‰2ä¸ª:xxx.crtã€xxx.key</p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/SSL/SSL06.jpg"  alt="SSL06.jpg"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx CA]#cd &#x2F;CA</span><br><span class="line">[root@nginx CA]# ll</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r-- 1 root root 3570 Apr 30 14:15 xxx.crt</span><br><span class="line">-rw-r--r-- 1 root root 1679 Apr 30 14:15 xxx.key</span><br></pre></td></tr></table></figure><p>é…ç½®nginx.conf æ·»åŠ æ­¤è¯ä¹¦</p><pre><code>server {    listen       443 ssl http2;    server_name  xxx.com;    root         /usr/share/nginx/html;    ssl_certificate &quot;/ca/xxx.crt&quot;;    ssl_certificate_key &quot;/ca/xxx.key&quot;;    ssl_session_cache shared:SSL:1m;    ssl_session_timeout  10m;    ssl_ciphers HIGH:!aNULL:!MD5;    ssl_prefer_server_ciphers on;    include /etc/nginx/default.d/*.conf;    location / {        proxy_pass http://172.31.22.31:8082;        proxy_set_header   Host             $proxy_host;        proxy_set_header   X-Real-IP        $remote_addr;        proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;        proxy_set_header   X-Forwarded-Host $host;        proxy_set_header   X-Forwarded-Server $host;        client_max_body_size 100m;        client_body_buffer_size 100m;    }    error_page 404 /404.html;        location = /40x.html {    }    error_page 500 502 503 504 /50x.html;        location = /50x.html {    }}</code></pre><p>æ·»åŠ å®Œæˆåéœ€è¦é‡å¯nginx</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx -s stop</span><br><span class="line">nginx</span><br></pre></td></tr></table></figure><h2 id="kubernetesé›†ç¾¤æ·»åŠ è¯ä¹¦"><a href="#kubernetesé›†ç¾¤æ·»åŠ è¯ä¹¦" class="headerlink" title="kubernetesé›†ç¾¤æ·»åŠ è¯ä¹¦"></a>kubernetesé›†ç¾¤æ·»åŠ è¯ä¹¦</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@dev-master-01 CA]#cd &#x2F;CA</span><br><span class="line">[root@dev-master-01 CA]# ll</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r-- 1 root root 3570 Apr 30 14:15 xxx.crt</span><br><span class="line">-rw-r--r-- 1 root root 1679 Apr 30 14:15 xxx.key</span><br><span class="line"></span><br><span class="line">kubectl create secret tls xxx.com --cert&#x3D;xxx.crt --key&#x3D;xxx.key</span><br></pre></td></tr></table></figure><h2 id="è…¾è®¯äº‘å¹³å°æ·»åŠ è¯ä¹¦"><a href="#è…¾è®¯äº‘å¹³å°æ·»åŠ è¯ä¹¦" class="headerlink" title="è…¾è®¯äº‘å¹³å°æ·»åŠ è¯ä¹¦"></a>è…¾è®¯äº‘å¹³å°æ·»åŠ è¯ä¹¦</h2><p>ç™»é™†è…¾è®¯äº‘<br><a href="https://console.cloud.tencent.com/ssl" target="_blank" rel="noopener">https://console.cloud.tencent.com/ssl</a><br><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/SSL/SSL07.jpg"  alt="SSL07.jpg"><br>ä¸Šä¼ è¯ä¹¦ä¿å­˜å³å¯</p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> SSL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿ç»´æ‰‹å†Œâ€”â€”Mysqlå¯¼å…¥å¯¼å‡ºäº¿æ¡æ•°æ®ï¼ˆæ’å‘ç¯‡ï¼‰</title>
      <link href="/2020/04/28/bug/mysql-climbing/"/>
      <url>/2020/04/28/bug/mysql-climbing/</url>
      
        <content type="html"><![CDATA[<p>å£°æ˜:è¿™æ˜¯æˆ‘åœ¨å¤§å­¦æ¯•ä¸šåè¿›å…¥ç¬¬ä¸€å®¶äº’è”ç½‘å…¬å¸å­¦ä¹ çš„å†…å®¹</p><hr><h1 id="èƒŒæ™¯ï¼šå…¬å¸ä¸šåŠ¡éœ€è¦ç»™æŸä¸ªæ´»åŠ¨çš„æ”¯ä»˜å®ç”¨æˆ·å‘é€æ¨¡æ¿æ¶ˆæ¯"><a href="#èƒŒæ™¯ï¼šå…¬å¸ä¸šåŠ¡éœ€è¦ç»™æŸä¸ªæ´»åŠ¨çš„æ”¯ä»˜å®ç”¨æˆ·å‘é€æ¨¡æ¿æ¶ˆæ¯" class="headerlink" title="èƒŒæ™¯ï¼šå…¬å¸ä¸šåŠ¡éœ€è¦ç»™æŸä¸ªæ´»åŠ¨çš„æ”¯ä»˜å®ç”¨æˆ·å‘é€æ¨¡æ¿æ¶ˆæ¯"></a>èƒŒæ™¯ï¼šå…¬å¸ä¸šåŠ¡éœ€è¦ç»™æŸä¸ªæ´»åŠ¨çš„æ”¯ä»˜å®ç”¨æˆ·å‘é€æ¨¡æ¿æ¶ˆæ¯</h1><p>ç»è°ƒæŸ¥å‘ç°ï¼Œæ­¤æ¬¡æ´»åŠ¨çš„ç”¨æˆ·æ•°é‡å¤§çº¦2äº¿ï¼Œä¸ºäº†æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒï¼Œé¢†å¯¼è®©æˆ‘æŠŠç”Ÿäº§åº“çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆè„±æ•ï¼‰æ‹‰åˆ°å¼€å‘åº“ï¼Œè®©å¼€å‘å†™å¥½ç¨‹åºè¯»å–æ•°æ®å¹¶æ¨é€æ¶ˆæ¯ã€‚</p><h2 id="æ’å‘1ï¼šNavicat"><a href="#æ’å‘1ï¼šNavicat" class="headerlink" title="æ’å‘1ï¼šNavicat"></a>æ’å‘1ï¼šNavicat</h2><p>ç”±äºæˆ‘å¯¹Mysqlä¸æ˜¯å¾ˆäº†è§£ï¼Œåœ¨æ•°æ®åŒæ­¥å‰æˆ‘äº‹å…ˆé—®äº†ä¸‹å…¬å¸çš„DBAåº”è¯¥å¦‚ä½•æ“ä½œï¼šä½¿ç”¨navicatçš„æ•°æ®ä¼ è¾“åŠŸèƒ½ã€‚</p><h3 id="ç¯å¢ƒï¼šNavicat-Premium-12"><a href="#ç¯å¢ƒï¼šNavicat-Premium-12" class="headerlink" title="ç¯å¢ƒï¼šNavicat Premium 12"></a>ç¯å¢ƒï¼šNavicat Premium 12</h3><ul><li>æ“ä½œï¼š</li><li>1.ç‚¹å‡»å·¥å…·åˆ—è¡¨çš„æ•°æ®ä¼ è¾“ </li><li>2.é€‰æ‹©æºæ•°æ®åº“åŠç›®æ ‡æ•°æ®åº“</li><li>3.é€‰æ‹©è¡¨ï¼ˆé»˜è®¤å…¨è¡¨ï¼‰</li><li>4.ç‚¹å‡»å¼€å§‹<br><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Mysql/navicat/mysql01.jpg"  alt="mysql01.jpg"></li></ul><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Mysql/navicat/mysql02.jpg"  alt="mysql02.jpg"></p><p><img src="/" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/chenyu1st/chenyu-cdn@master/rugod.cn/Mysql/navicat/mysql03.jpg"  alt="mysql03.jpg"></p><h3 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><p>æ•°æ®ä¼ è¾“é€Ÿåº¦å¤§çº¦1åˆ†é’Ÿ20wæ¡æ•°æ®ï¼Œä¼ å®Œå¤§æ¦‚å¾—8ä¸ªå¤šå°æ—¶ï¼Œæˆ‘æŒ‚æœºäº†ä¸€æ®µæ—¶é—´åå†çœ‹è¿›åº¦å‘ç°æ•°æ®ä¼ è¾“åˆ°ç™¾åˆ†ä¹‹11çš„æ—¶å€™å¤±è´¥äº†ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Multi-statement transaction required more than â€˜max_binlog_cache_sizeâ€™ bytes of storage; increase this mysqld variable and try again</span><br></pre></td></tr></table></figure><p>ç™¾åº¦ä¹‹åå‘ç°<br>è¿™æ˜¯ç”±äºæ›´æ–°å’Œåˆ é™¤çš„å¤§äº‹åŠ¡ä¼šå†™å…¥å¤§é‡binlogï¼Œå¯èƒ½ä¼šé€ æˆbinlog cacheè¿‡å°è€Œå¯¼è‡´æ‰§è¡Œå¤±è´¥ã€‚</p><p>å…·ä½“è§£å†³æ–¹æ³•ä¸ºå¦‚ä¸‹ï¼š</p><p>æŸ¥çœ‹max_binlog_cache_sizeå¤§å°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;max_binlog_cache_size&#39;;</span><br><span class="line">+-----------------------+-----------+</span><br><span class="line">| Variable_name         | Value     |</span><br><span class="line">+-----------------------+-----------+</span><br><span class="line">| max_binlog_cache_size | 134217728 |</span><br><span class="line">+-----------------------+-----------+</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¯¥å‚æ•°è®¾ç½®ä¸º134217728Bï¼Œå³128MBã€‚</p><p>æ­¤å‚æ•°å¯ä»¥åŠ¨æ€ä¿®æ”¹ï¼Œä¿®æ”¹è¯¥å‚æ•°ä¸º40GBã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set global max_binlog_cache_size&#x3D;40*1024*1024*1024;</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br></pre></td></tr></table></figure><p>ä¸ºäº†é˜²æ­¢æ•°æ®åº“é‡å¯åè¿˜å‡ºç°æ­¤é—®é¢˜ï¼Œè¿˜éœ€è¦åœ¨/etc/my.cnfé‡Œä¿®æ”¹max_binlog_cache_sizeçš„å€¼ã€‚</p><h2 id="æ’å‘2ï¼šmysqldump"><a href="#æ’å‘2ï¼šmysqldump" class="headerlink" title="æ’å‘2ï¼šmysqldump"></a>æ’å‘2ï¼šmysqldump</h2><p>ç”±äºç”¨navicatä¼ è¾“é€Ÿåº¦å®åœ¨è¿‡æ…¢ï¼Œå¬å–DBAå»ºè®®åç›´æ¥é‡‡ç”¨mysqldumpçš„æ–¹å¼ã€‚</p><p>åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¯¼å‡º</span><br><span class="line">mysqldump -uxxx -pxx åº“å   è¡¨å  &gt; bak.sql</span><br><span class="line">è¿˜åŸ</span><br><span class="line">mysql -uxxx -pxxx åº“å &lt; bak.sql</span><br></pre></td></tr></table></figure><p>å¯¼å‡ºå®Œä¹‹åå†è¿˜åŸåˆ°ç›®æ ‡æ•°æ®åº“åå‡ºç°äº†å’Œä¸Šä¸ªå‘ä¸€æ ·çš„é—®é¢˜ï¼šmax_binlog_cache_sizeè¿‡å°ã€‚</p><h2 id="æ’å‘3ï¼šselect-into-outfile"><a href="#æ’å‘3ï¼šselect-into-outfile" class="headerlink" title="æ’å‘3ï¼šselect into outfile"></a>æ’å‘3ï¼šselect into outfile</h2><p>åœ¨ä¸Šè¿°é—®é¢˜è¿˜æ²¡æ‰¾åˆ°è§£å†³æ–¹æ³•çš„æ—¶å€™ç»§ç»­ç™¾åº¦å‘ç°äº†è¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è§£å†³é—®é¢˜ã€‚</p><p>MySQLè‡ªå¸¦çš„å¯¼å‡ºè¯­å¥ï¼šselect into outfileè¯­å¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM db --å¯ä»¥åŠ whereæ¡ä»¶</span><br><span class="line">INTO OUTFILE &quot;&#x2F;data&#x2F;bak.txt&quot; --å¯¼å‡ºæ–‡ä»¶ä½ç½®</span><br><span class="line">FIELDS TERMINATED BY &#39;,&#39; OPTIONALLY ENCLOSED BY &#39;&quot;&#39; -- å­—æ®µåˆ†å‰²ç¬¦å’ŒåŒ…å«ç¬¦</span><br><span class="line">LINES TERMINATED BY &#39;\n&#39;;--æ¢è¡Œç¬¦</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨æ‰§è¡Œçš„æ—¶å€™å‡ºç°æŠ¥é”™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1290 (HY000): The MySQL server is running with the --secure-file-priv option so it cannot execute this statement</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œsecure_file_privå‚æ•°ç”¨äºé™åˆ¶LOAD DATA, SELECT â€¦OUTFILE, LOAD_FILE()ä¼ åˆ°å“ªä¸ªæŒ‡å®šç›®å½•ã€‚</p><ul><li>secure_file_priv ä¸º null æ—¶ï¼Œè¡¨ç¤ºé™åˆ¶mysqldä¸å…è®¸å¯¼å…¥æˆ–å¯¼å‡ºã€‚</li><li>secure_file_priv ä¸º /tmp æ—¶ï¼Œè¡¨ç¤ºé™åˆ¶mysqldåªèƒ½åœ¨/tmpç›®å½•ä¸­æ‰§è¡Œå¯¼å…¥å¯¼å‡ºï¼Œå…¶ä»–ç›®å½•ä¸èƒ½æ‰§è¡Œã€‚</li><li>secure_file_priv æ²¡æœ‰å€¼æ—¶ï¼Œè¡¨ç¤ºä¸é™åˆ¶mysqldåœ¨ä»»æ„ç›®å½•çš„å¯¼å…¥å¯¼å‡ºã€‚</li></ul><p>æŸ¥çœ‹secure_file_privå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global variables like &#39;%secure_file_priv%&#39;;</span><br></pre></td></tr></table></figure><p>è€Œä¸”æ­¤å‚æ•°ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œå¿…é¡»åœ¨/ete/my.cnfé‡Œæ·»åŠ ï¼ˆé»˜è®¤æ²¡æœ‰è¿™ä¸ªå‚æ•°ï¼‰å¹¶ä¸”é‡å¯mysqlã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secure_file_priv&#x3D;&#39;&#x2F;data&#39;</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œå®Œå¯¼å‡ºè¯­å¥åå‘ç°åˆæŠ¥é”™ï¼šæ–‡ä»¶æƒé™ä¸è¶³ï¼ŒåŸå› æ˜¯dataæ–‡ä»¶å¤¹æ˜¯rootæ‰€æœ‰ï¼Œè€Œmysqlå¯¼å‡ºåˆ°æ–‡ä»¶çš„æ‰§è¡Œè€…ä¸ºmysqlç”¨æˆ·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 &#x2F;data</span><br></pre></td></tr></table></figure><p>èµ‹æƒåå¯¼å‡ºæ–‡ä»¶ç»ˆäºæ²¡é—®é¢˜äº†ï¼Œç„¶åå†æ‰§è¡Œå¯¼å…¥æ–‡ä»¶çš„çš„å‘½ä»¤ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">load data infile &#39;&#x2F;data&#x2F;bak.txt&#39; --é»˜è®¤æŒ‡å®šæœåŠ¡å™¨æ–‡ä»¶å¤¹</span><br><span class="line">ignore into table xx --å…è®¸é‡å¤è®°å½•æ’å…¥</span><br><span class="line">fields terminated by &#39;,&#39;  --åˆ¤æ–­å­—æ®µé€šè¿‡é€—å·æ ‡è¯†æ¥åˆ†éš”å¼€</span><br><span class="line">lines terminated by &#39;\n&#39;(CustID,DeviceNo,logintype);--é€šè¿‡æ¢è¡Œæ ‡è¯†æ¥è§£ææˆä¸ºæ¯ä¸€æ¡æ•°æ®å’Œæ’å…¥åˆ°æˆ‘æŒ‡å®šçš„å­—æ®µ</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>2äº¿å¤šæ¡æ•°æ®çš„æ–‡ä»¶29Gï¼Œå¯¼å‡ºé€Ÿåº¦æœ€å¿«çš„è¿˜æ˜¯mysqldumpæ–¹æ³•ï¼Œä½†æ˜¯å¯¼å…¥æœ€ç¨³å®šçš„æˆ‘è®¤ä¸ºè¿˜æ˜¯select into outfileæ–¹æ³•ï¼Œå› ä¸ºå®¹é”™é«˜ï¼Œmysqldumpçš„æ–‡ä»¶å°±ä¸€å¥insertï¼ˆ29G<br>çš„æ•°æ®ï¼‰ï¼Œæ‰§è¡Œå¤±è´¥å°±æµªè´¹äº†å¤ªå¤šæ—¶é—´ï¼Œä½†æ˜¯select into outfileå³ä½¿æ‰§è¡Œå¤±è´¥ä¹Ÿèƒ½æ’å…¥æ‰§è¡ŒæˆåŠŸçš„æ•°æ®ï¼ˆè¦æ˜¯ä¸€æ¡éƒ½æ²¡æ’è¿›å»å½“æˆ‘æ²¡è¯´- -ï¼‰ä¸ä¼šå¤ªæµªè´¹æ—¶é—´ã€‚æœ€åæé†’å¤§å®¶ï¼Œå¤§æ•°æ®é‡çš„ä¼ è¾“åƒä¸‡ä¸è¦ç”¨navicatï¼Œå¾ˆå®¹æ˜“å‡æ­»ã€‚æœ€åè¡¥ä¸€å¥ï¼šå¤ªä¾èµ–å¯è§†åŒ–ç•Œé¢çš„è½¯ä»¶å¾ˆéš¾æˆé•¿èµ·æ¥ï¼Œä»¥åæˆ‘å°½é‡è¿›æœåŠ¡å™¨æ•²å‘½ä»¤ã€‚</p><p>ä»»åŠ¡æ€»ç®—å®Œæˆäº†ï¼ŒèŠ±äº†ä¸å°‘æ—¶é—´ï¼Œè¶æœºè¡¥ä¹ äº†å¥½å¤šmysqlçš„çŸ¥è¯†ï¼Œå¯¹äºä¸Šé¢çš„é—®é¢˜å…¶å®è¿˜æœ‰ä¼˜åŒ–çš„æ€è·¯ï¼Œåªä¸è¿‡æ²¡æ—¶é—´å»å®éªŒäº†ï¼Œå¦‚æœæœ‰å¹¸çœ‹åˆ°æˆ‘çš„åšå®¢å¹¶ä¸”ä¹Ÿå‡ºç°äº†æˆ‘é‡åˆ°çš„é—®é¢˜å¯ä»¥å°è¯•ä¸‹æˆ‘çš„æƒ³æ³•ã€‚</p><ul><li>ä¸´æ—¶å…³é—­binlogæ—¥å¿—ã€‚</li><li>å¦‚æœä½ çš„ç›®æ ‡è¡¨æ•°æ®ä¸ºç©ºï¼Œå¯ä»¥å…ˆåˆ ç´¢å¼•ï¼Œå†å¯¼å…¥æ•°æ®ï¼Œæœ€åå†åŠ ä¸Šç´¢å¼•ã€‚</li></ul><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://blog.csdn.net/qq_21108311/java/article/details/82559119" target="_blank" rel="noopener">MySQL äº¿çº§æ•°æ®å¯¼å…¥å¯¼å‡º/æ•°æ®è¿ç§»ç¬”è®°</a></p><p><a href="https://www.cnblogs.com/gjc592/p/12774209.html" target="_blank" rel="noopener">mysqlå‚æ•°max_binlog_cache_sizeè®¾ç½®ä¸å½“å¼•å‘çš„è¡€æ¡ˆ</a></p><p><a href="https://dev.mysql.com/doc/refman/5.7/en/mysqldump-sql-format.html" target="_blank" rel="noopener">mysqlå®˜æ–¹æ–‡æ¡£</a></p><hr><p>ç‰ˆæƒå£°æ˜ï¼š</p><p>åŸåˆ›ä¸æ˜“ï¼Œæ´—æ–‡å¯è€»ã€‚é™¤éæ³¨æ˜ï¼Œæœ¬åšæ–‡ç« å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·ä»¥é“¾æ¥å½¢å¼æ ‡æ˜æœ¬æ–‡åœ°å€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Operation Manual </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
